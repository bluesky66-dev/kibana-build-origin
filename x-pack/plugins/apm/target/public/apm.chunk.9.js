/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window["apm_bundle_jsonpfunction"]=window["apm_bundle_jsonpfunction"]||[]).push([[9],{1414:function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;
/*!
  Copyright (c) 2017 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/(function(){"use strict";var hasOwn={}.hasOwnProperty;function classNames(){var classes=[];for(var i=0;i<arguments.length;i++){var arg=arguments[i];if(!arg)continue;var argType=typeof arg;if(argType==="string"||argType==="number"){classes.push(arg)}else if(Array.isArray(arg)&&arg.length){var inner=classNames.apply(null,arg);if(inner){classes.push(inner)}}else if(argType==="object"){for(var key in arg){if(hasOwn.call(arg,key)&&arg[key]){classes.push(key)}}}}return classes.join(" ")}if(true&&module.exports){classNames.default=classNames;module.exports=classNames}else if(true){!(__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function(){return classNames}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}else{}})()},1415:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var react_1=__webpack_require__(2);var util_1=__webpack_require__(251);var defaultTarget=util_1.isClient?window:null;var isListenerType1=function(target){return!!target.addEventListener};var isListenerType2=function(target){return!!target.on};var useEvent=function(name,handler,target,options){if(target===void 0){target=defaultTarget}react_1.useEffect((function(){if(!handler){return}if(!target){return}if(isListenerType1(target)){target.addEventListener(name,handler,options)}else if(isListenerType2(target)){target.on(name,handler,options)}return function(){if(isListenerType1(target)){target.removeEventListener(name,handler,options)}else if(isListenerType2(target)){target.off(name,handler,options)}}}),[name,handler,target,JSON.stringify(options)])};exports.default=useEvent},1421:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"rumRoutes",(function(){return rumRoutes}));__webpack_require__.d(__webpack_exports__,"CsmAppRoot",(function(){return CsmAppRoot}));__webpack_require__.d(__webpack_exports__,"renderApp",(function(){return renderApp}));var external_kbnSharedDeps_Theme_euiDarkVars_=__webpack_require__(27);var external_kbnSharedDeps_Theme_euiDarkVars_default=__webpack_require__.n(external_kbnSharedDeps_Theme_euiDarkVars_);var external_kbnSharedDeps_Theme_euiLightVars_=__webpack_require__(20);var external_kbnSharedDeps_Theme_euiLightVars_default=__webpack_require__.n(external_kbnSharedDeps_Theme_euiLightVars_);var external_kbnSharedDeps_React_=__webpack_require__(2);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_ReactDom_=__webpack_require__(30);var external_kbnSharedDeps_ReactDom_default=__webpack_require__.n(external_kbnSharedDeps_ReactDom_);var external_kbnSharedDeps_ReactRouterDom_=__webpack_require__(11);var external_kbnSharedDeps_StyledComponents_=__webpack_require__(16);var external_kbnSharedDeps_StyledComponents_default=__webpack_require__.n(external_kbnSharedDeps_StyledComponents_);var common_=__webpack_require__(13);var public_=__webpack_require__(18);var route_config=__webpack_require__(573);var ScrollToTopOnPathChange=__webpack_require__(570);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(10);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(0);var observability_public_=__webpack_require__(14);var variables=__webpack_require__(6);const BadgeText=common_["euiStyled"].div`
  display: inline-block;
  ${Object(variables["truncate"])(Object(variables["px"])(variables["unit"]*8))};
  vertical-align: middle;
`;const removeFilterLabel=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.uifilter.badge.removeFilter",{defaultMessage:"Remove filter"});function FilterBadgeList({onRemove:onRemove,value:value,name:name}){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGrid"],{gutterSize:"s",id:`local-filter-values-${name}`},value.map(val=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{key:val,grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBadge"],{color:"hollow",onClick:()=>{onRemove(val)},onClickAriaLabel:removeFilterLabel,iconOnClick:()=>{onRemove(val)},iconOnClickAriaLabel:removeFilterLabel,iconType:"cross",iconSide:"right"},external_kbnSharedDeps_React_default.a.createElement(BadgeText,null,val)))))}const Button=Object(common_["euiStyled"])(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"]).attrs(()=>({contentProps:{className:"alignLeft"},color:"text"}))`
  width: 100%;

  .alignLeft {
    justify-content: flex-start;
    padding-left: 0;
  }
`;function FilterTitleButton(props){return external_kbnSharedDeps_React_default.a.createElement(Button,props,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xxxs",textTransform:"uppercase"},external_kbnSharedDeps_React_default.a.createElement("h4",null,props.children)))}const Popover=Object(common_["euiStyled"])(external_kbnSharedDeps_ElasticEui_["EuiPopover"]).attrs(()=>({anchorClassName:"anchor"}))`
  .anchor {
    display: block;
  }
`;const SelectContainer=common_["euiStyled"].div`
  width: ${Object(variables["px"])(variables["unit"]*16)};
`;const Counter=common_["euiStyled"].div`
  border-radius: ${({theme:theme})=>theme.eui.euiBorderRadius};
  background: ${({theme:theme})=>theme.eui.euiColorLightShade};
  padding: 0 ${({theme:theme})=>theme.eui.paddingSizes.xs};
`;const ApplyButton=Object(common_["euiStyled"])(external_kbnSharedDeps_ElasticEui_["EuiButton"])`
  align-self: flex-end;
`;const FlexItem=Object(common_["euiStyled"])(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"])`
  flex-basis: auto !important;
`;function Filter({name:name,title:title,options:options,onChange:onChange,value:value,showCount:showCount}){const[showPopover,setShowPopover]=Object(external_kbnSharedDeps_React_["useState"])(false);const toggleShowPopover=()=>setShowPopover(show=>!show);const button=external_kbnSharedDeps_React_default.a.createElement(FilterTitleButton,{onClick:toggleShowPopover},title);const items=Object(external_kbnSharedDeps_React_["useMemo"])(()=>options.map(option=>({label:option.name,append:showCount?external_kbnSharedDeps_React_default.a.createElement(Counter,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs"},option.count)):null,checked:value.includes(option.name)?"on":undefined})),[value,options,showCount]);const[visibleOptions,setVisibleOptions]=Object(external_kbnSharedDeps_React_["useState"])(items);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setVisibleOptions(items)},[items]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(Popover,{id:`local-filter-${name}`,closePopover:toggleShowPopover,button:button,isOpen:showPopover,panelPaddingSize:"s",anchorPosition:"downLeft"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelectable"],{onChange:selectedOptions=>{setVisibleOptions(selectedOptions)},options:visibleOptions,searchable:true},(list,search)=>external_kbnSharedDeps_React_default.a.createElement(SelectContainer,{id:`local-filter-popover-${name}`},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"column",gutterSize:"none"},external_kbnSharedDeps_React_default.a.createElement(FlexItem,{grow:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xxxs",textTransform:"uppercase"},external_kbnSharedDeps_React_default.a.createElement("h4",null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.applyFilter",{defaultMessage:"Apply {title} filter",values:{title:title}}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"none"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),search,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),list,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"})),external_kbnSharedDeps_React_default.a.createElement(FlexItem,{grow:false},external_kbnSharedDeps_React_default.a.createElement(ApplyButton,{"data-cy":"applyFilter",color:"primary",fill:true,onClick:()=>{const newValue=visibleOptions.filter(option=>option.checked==="on").map(option=>option.label);setShowPopover(false);onChange(newValue)},size:"s"},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.applyOptions",{defaultMessage:"Apply options"}))))))),value.length?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(FilterBadgeList,{name:name,onRemove:val=>{onChange(value.filter(v=>val!==v))},value:value}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"})):null)}var external_kbnSharedDeps_Lodash_=__webpack_require__(12);var pick_keys=__webpack_require__(84);var local_ui_filters_config=__webpack_require__(226);var url_helpers=__webpack_require__(42);var helpers=__webpack_require__(129);var use_url_params=__webpack_require__(36);var use_fetcher=__webpack_require__(37);const getInitialData=filterNames=>filterNames.map(filterName=>({options:[],...local_ui_filters_config["b"][filterName]}));function useLocalUIFilters({filterNames:filterNames,params:params,shouldFetch:shouldFetch}){const history=Object(external_kbnSharedDeps_ReactRouterDom_["useHistory"])();const{uiFilters:uiFilters,urlParams:urlParams}=Object(use_url_params["a"])();const values=Object(pick_keys["a"])(uiFilters,...filterNames);const setFilterValue=(name,value)=>{const search=Object(external_kbnSharedDeps_Lodash_["omit"])(Object(url_helpers["e"])(history.location.search),name);history.push({...history.location,search:Object(url_helpers["b"])(Object(helpers["b"])({...search,[name]:value.length?value.join(","):undefined}))})};const clearValues=()=>{const search=Object(external_kbnSharedDeps_Lodash_["omit"])(Object(url_helpers["e"])(history.location.search),filterNames);history.push({...history.location,search:Object(url_helpers["b"])(search)})};const{data:data=getInitialData(filterNames),status:status}=Object(use_fetcher["b"])(callApmApi=>{if(shouldFetch&&urlParams.start&&urlParams.end){return callApmApi({endpoint:"GET /api/apm/rum/local_filters",params:{query:{uiFilters:JSON.stringify(uiFilters),start:urlParams.start,end:urlParams.end,filterNames:JSON.stringify(filterNames),...params}}})}},[uiFilters,urlParams.start,urlParams.end,filterNames,params,shouldFetch]);const filters=data.map(filter=>({...filter,value:values[filter.name]||[]}));return{filters:filters,status:status,setFilterValue:setFilterValue,clearValues:clearValues}}var use_break_points=__webpack_require__(88);function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}const ButtonWrapper=common_["euiStyled"].div`
  display: inline-block;
`;function LocalUIFilters({params:params,filterNames:filterNames,children:children,showCount:showCount=true,shouldFetch:shouldFetch=true}){const{filters:filters,setFilterValue:setFilterValue,clearValues:clearValues}=useLocalUIFilters({filterNames:filterNames,params:params,shouldFetch:shouldFetch});const hasValues=filters.some(filter=>filter.value.length>0);const{isSmall:isSmall}=Object(use_break_points["a"])();const title=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h3",null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.localFiltersTitle",{defaultMessage:"Filters"})));const content=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children,filters.map(filter=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,{key:filter.name},external_kbnSharedDeps_React_default.a.createElement(Filter,_extends({},filter,{onChange:value=>{setFilterValue(filter.name,value)},showCount:showCount})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"none"}))),hasValues?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(ButtonWrapper,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{size:"xs",iconType:"cross",flush:"left",onClick:clearValues,"data-cy":"clearFilters"},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.clearFilters",{defaultMessage:"Clear filters"})))):null);return isSmall?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiAccordion"],{id:"uxFilterAccordion",buttonContent:title},content):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,title,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),content)}const I18LABELS={dataMissing:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.dashboard.dataMissing",{defaultMessage:"N/A"}),totalPageLoad:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.dashboard.totalPageLoad",{defaultMessage:"Total"}),backEnd:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.dashboard.backend",{defaultMessage:"Backend"}),frontEnd:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.dashboard.frontend",{defaultMessage:"Frontend"}),pageViews:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.dashboard.pageViews",{defaultMessage:"Total page views"}),percPageLoaded:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.dashboard.pagesLoaded.label",{defaultMessage:"Pages loaded"}),pageLoadTime:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.dashboard.pageLoadTime.label",{defaultMessage:"Page load time (seconds)"}),pageLoadTimes:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.dashboard.pageLoadTimes.label",{defaultMessage:"Page load times"}),pageLoadDuration:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.dashboard.pageLoadDuration.label",{defaultMessage:"Page load duration"}),pageLoad:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.dashboard.pageLoad.label",{defaultMessage:"Page load"}),pageLoadDistribution:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.dashboard.pageLoadDistribution.label",{defaultMessage:"Page load distribution"}),jsErrors:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.dashboard.impactfulMetrics.jsErrors",{defaultMessage:"JavaScript errors"}),highTrafficPages:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.dashboard.impactfulMetrics.highTrafficPages",{defaultMessage:"High traffic pages"}),resetZoom:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.dashboard.resetZoom.label",{defaultMessage:"Reset zoom"}),overall:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.dashboard.overall.label",{defaultMessage:"Overall"}),selectBreakdown:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.filterGroup.selectBreakdown",{defaultMessage:"Select breakdown"}),breakdown:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.filterGroup.breakdown",{defaultMessage:"Breakdown"}),seconds:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.filterGroup.seconds",{defaultMessage:"seconds"}),coreWebVitals:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.filterGroup.coreWebVitals",{defaultMessage:"Core web vitals"}),browser:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.visitorBreakdown.browser",{defaultMessage:"Browser"}),operatingSystem:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.visitorBreakdown.operatingSystem",{defaultMessage:"Operating system"}),metrics:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.ux.metrics",{defaultMessage:"Metrics"}),median:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.ux.median",{defaultMessage:"median"}),avgPageLoadDuration:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.visitorBreakdownMap.avgPageLoadDuration",{defaultMessage:"Average page load duration"}),pageLoadDurationByRegion:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.visitorBreakdownMap.pageLoadDurationByRegion",{defaultMessage:"Page load duration by region (avg.)"}),searchByUrl:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.filters.searchByUrl",{defaultMessage:"Search by URL"}),getSearchResultsLabel:total=>external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.filters.searchResults",{defaultMessage:"{total} Search results",values:{total:total}}),topPages:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.filters.topPages",{defaultMessage:"Top pages"}),select:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.filters.select",{defaultMessage:"Select"}),url:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.filters.url",{defaultMessage:"Url"}),loadingResults:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.filters.url.loadingResults",{defaultMessage:"Loading results"}),noResults:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.filters.url.noResults",{defaultMessage:"No results available"}),totalErrors:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.jsErrors.totalErrors",{defaultMessage:"Total errors"}),errorRate:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.jsErrors.errorRate",{defaultMessage:"Error rate"}),errorMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.jsErrors.errorMessage",{defaultMessage:"Error message"}),impactedPageLoads:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.jsErrors.impactedPageLoads",{defaultMessage:"Impacted page loads"}),percentile:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.ux.percentile.label",{defaultMessage:"Percentile"}),percentile50thMedian:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.ux.percentile.50thMedian",{defaultMessage:"50th (Median)"}),percentile75th:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.ux.percentile.75th",{defaultMessage:"75th"}),percentile90th:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.ux.percentile.90th",{defaultMessage:"90th"}),percentile95th:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.ux.percentile.95th",{defaultMessage:"95th"}),percentile99th:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.ux.percentile.99th",{defaultMessage:"99th"}),noData:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.ux.visitorBreakdown.noData",{defaultMessage:"No data."}),totalPageLoadTooltip:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.dashboard.tooltips.totalPageLoad",{defaultMessage:"Total represents the full page load duration"}),frontEndTooltip:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.dashboard.tooltips.frontEnd",{defaultMessage:"Frontend time represents the total page load duration minus the backend time"}),backEndTooltip:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.dashboard.tooltips.backEnd",{defaultMessage:"Backend time represents time to first byte (TTFB), which is when the first response packet is received after the request has been made"})};const VisitorBreakdownLabel=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.visitorBreakdown",{defaultMessage:"Visitor breakdown"});var external_kbnSharedDeps_ElasticNumeral_=__webpack_require__(19);var external_kbnSharedDeps_ElasticNumeral_default=__webpack_require__.n(external_kbnSharedDeps_ElasticNumeral_);const DATA_UNDEFINED_LABEL=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.coreVitals.dataUndefined",{defaultMessage:"N/A"});const FCP_LABEL=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.coreVitals.fcp",{defaultMessage:"First contentful paint"});const FCP_TOOLTIP=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.coreVitals.fcpTooltip",{defaultMessage:"First contentful paint (FCP) focusses on the initial rendering and measures the time from when the page starts loading to when any part of the pageâ€™s content is displayed on the screen."});const TBT_LABEL=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.coreVitals.tbt",{defaultMessage:"Total blocking time"});const TBT_TOOLTIP=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.coreVitals.tbtTooltip",{defaultMessage:"Total blocking time (TBT) is the sum of the blocking time (duration above 50 ms) for each long task that occurs between the First contentful paint and the time when the transaction is completed."});const NO_OF_LONG_TASK=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.uxMetrics.noOfLongTasks",{defaultMessage:"No. of long tasks"});const NO_OF_LONG_TASK_TOOLTIP=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.uxMetrics.noOfLongTasksTooltip",{defaultMessage:"The number of long tasks, a long task is defined as any user activity or browser task that monopolizes the UI thread for extended periods (greater than 50 milliseconds) and blocks other critical tasks (frame rate or input latency) from being executed."});const LONGEST_LONG_TASK=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.uxMetrics.longestLongTasks",{defaultMessage:"Longest long task duration"});const LONGEST_LONG_TASK_TOOLTIP=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.uxMetrics.longestLongTasksTooltip",{defaultMessage:"The duration of the longest long task, a long task is defined as any user activity or browser task that monopolizes the UI thread for extended periods (greater than 50 milliseconds) and blocks other critical tasks (frame rate or input latency) from being executed."});const SUM_LONG_TASKS=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.uxMetrics.sumLongTasks",{defaultMessage:"Total long tasks duration"});const SUM_LONG_TASKS_TOOLTIP=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.rum.uxMetrics.sumLongTasksTooltip",{defaultMessage:"The total duration of long tasks, a long task is defined as any user activity or browser task that monopolizes the UI thread for extended periods (greater than 50 milliseconds) and blocks other critical tasks (frame rate or input latency) from being executed."});const getPercentileLabel=value=>{if(value===50)return I18LABELS.median;return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.ux.percentiles.label",{defaultMessage:"{value}th Perc.",values:{value:value}})};function useUxQuery(){const{urlParams:urlParams,uiFilters:uiFilters}=Object(use_url_params["a"])();const{start:start,end:end,searchTerm:searchTerm,percentile:percentile}=urlParams;const queryParams=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{const{serviceName:serviceName}=uiFilters;if(start&&end&&serviceName&&percentile){return{start:start,end:end,percentile:String(percentile),urlQuery:searchTerm||undefined,uiFilters:JSON.stringify(uiFilters)}}return null},[start,end,searchTerm,percentile,uiFilters]);return queryParams}function formatToSec(value,fromUnit="MicroSec"){const valueInMs=Number(value!==null&&value!==void 0?value:0)/(fromUnit==="MicroSec"?1e3:1);if(valueInMs<1e3){return valueInMs.toFixed(0)+" ms"}return(valueInMs/1e3).toFixed(2)+" s"}const KeyUXMetrics_STAT_STYLE={width:"200px"};function formatTitle(unit,value){if(typeof value==="undefined"||value===null)return DATA_UNDEFINED_LABEL;return formatToSec(value,unit)}function KeyUXMetrics({data:data,loading:loading}){const uxQuery=useUxQuery();const{data:longTaskData,status:status}=Object(use_fetcher["b"])(callApmApi=>{if(uxQuery){return callApmApi({endpoint:"GET /api/apm/rum-client/long-task-metrics",params:{query:{...uxQuery}}})}return Promise.resolve(null)},[uxQuery]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{wrap:true,responsive:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:KeyUXMetrics_STAT_STYLE},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiStat"],{titleSize:"s",title:formatTitle("ms",data===null||data===void 0?void 0:data.fcp),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,FCP_LABEL,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIconTip"],{content:FCP_TOOLTIP,type:"questionInCircle"})),isLoading:loading})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:KeyUXMetrics_STAT_STYLE},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiStat"],{titleSize:"s",title:formatTitle("ms",data===null||data===void 0?void 0:data.tbt),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,TBT_LABEL,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIconTip"],{content:TBT_TOOLTIP,type:"questionInCircle"})),isLoading:loading})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:KeyUXMetrics_STAT_STYLE},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiStat"],{titleSize:"s",title:(longTaskData===null||longTaskData===void 0?void 0:longTaskData.noOfLongTasks)!==undefined?external_kbnSharedDeps_ElasticNumeral_default()(longTaskData===null||longTaskData===void 0?void 0:longTaskData.noOfLongTasks).format("0,0"):DATA_UNDEFINED_LABEL,description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,NO_OF_LONG_TASK,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIconTip"],{content:NO_OF_LONG_TASK_TOOLTIP,type:"questionInCircle"})),isLoading:status!=="success"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:KeyUXMetrics_STAT_STYLE},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiStat"],{titleSize:"s",title:formatTitle("ms",longTaskData===null||longTaskData===void 0?void 0:longTaskData.longestLongTask),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,LONGEST_LONG_TASK,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIconTip"],{content:LONGEST_LONG_TASK_TOOLTIP,type:"questionInCircle"})),isLoading:status!=="success"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:KeyUXMetrics_STAT_STYLE},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiStat"],{titleSize:"s",title:formatTitle("ms",longTaskData===null||longTaskData===void 0?void 0:longTaskData.sumOfLongTasks),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,SUM_LONG_TASKS,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIconTip"],{content:SUM_LONG_TASKS_TOOLTIP,type:"questionInCircle"})),isLoading:status!=="success"})))}const defaultContext={sharedData:{totalPageViews:0},setSharedData:d=>{throw new Error("setSharedData was not initialized, set it when you invoke the context")}};const CsmSharedContext=Object(external_kbnSharedDeps_React_["createContext"])(defaultContext);function CsmSharedContextProvider({children:children}){const[newData,setNewData]=Object(external_kbnSharedDeps_React_["useState"])({totalPageViews:0});const setSharedData=external_kbnSharedDeps_React_default.a.useCallback(data=>{setNewData(data)},[]);const value=Object(external_kbnSharedDeps_React_["useMemo"])(()=>({sharedData:newData,setSharedData:setSharedData}),[newData,setSharedData]);return external_kbnSharedDeps_React_default.a.createElement(CsmSharedContext.Provider,{value:value,children:children})}function UXMetrics(){const{urlParams:{percentile:percentile}}=Object(use_url_params["a"])();const uxQuery=useUxQuery();const{data:data,status:status}=Object(use_fetcher["b"])(callApmApi=>{if(uxQuery){return callApmApi({endpoint:"GET /api/apm/rum-client/web-core-vitals",params:{query:uxQuery}})}return Promise.resolve(null)},[uxQuery]);const{sharedData:{totalPageViews:totalPageViews}}=Object(external_kbnSharedDeps_React_["useContext"])(CsmSharedContext);const CoreVitals=Object(external_kbnSharedDeps_React_["useMemo"])(()=>Object(observability_public_["getCoreVitalsComponent"])({data:data,totalPageViews:totalPageViews,loading:status!=="success",displayTrafficMetric:true}),[status]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween",wrap:true,responsive:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:1,"data-cy":`client-metrics`},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h3",null,I18LABELS.metrics," (",getPercentileLabel(percentile),")")),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(KeyUXMetrics,{data:data,loading:status!=="success"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xs"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"xs"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween",wrap:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:1,"data-cy":`client-metrics`},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),CoreVitals)))}var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(21);var ErrorDetailLink=__webpack_require__(156);function JSErrors(){var _data$totalErrors,_data$items,_data$totalErrorGroup;const{urlParams:urlParams,uiFilters:uiFilters}=Object(use_url_params["a"])();const{start:start,end:end,serviceName:serviceName,searchTerm:searchTerm}=urlParams;const[pagination,setPagination]=Object(external_kbnSharedDeps_React_["useState"])({pageIndex:0,pageSize:5});const{data:data,status:status}=Object(use_fetcher["b"])(callApmApi=>{if(start&&end&&serviceName){return callApmApi({endpoint:"GET /api/apm/rum-client/js-errors",params:{query:{start:start,end:end,urlQuery:searchTerm||undefined,uiFilters:JSON.stringify(uiFilters),pageSize:String(pagination.pageSize),pageIndex:String(pagination.pageIndex)}}})}return Promise.resolve(null)},[start,end,serviceName,uiFilters,pagination,searchTerm]);const{sharedData:{totalPageViews:totalPageViews}}=Object(external_kbnSharedDeps_React_["useContext"])(CsmSharedContext);const cols=[{field:"errorMessage",name:I18LABELS.errorMessage,render:(errorMessage,item)=>external_kbnSharedDeps_React_default.a.createElement(ErrorDetailLink["a"],{serviceName:serviceName,errorGroupId:item.errorGroupId},errorMessage)},{name:I18LABELS.impactedPageLoads,field:"count",align:"right",render:count=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.apm.ux.jsErrors.percent",defaultMessage:"{pageLoadPercent} %",values:{pageLoadPercent:(count/totalPageViews*100).toFixed(1)}})}];const onTableChange=({page:page})=>{setPagination({pageIndex:page.index,pageSize:page.size})};const totalErrors=(_data$totalErrors=data===null||data===void 0?void 0:data.totalErrors)!==null&&_data$totalErrors!==void 0?_data$totalErrors:0;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h3",null,I18LABELS.jsErrors)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiStat"],{"data-test-subj":"uxJsErrorsTotal",titleSize:"s",title:totalErrors<1e3?totalErrors:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{content:totalErrors},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_ElasticNumeral_default()(totalErrors).format("0 a"))),description:I18LABELS.totalErrors,isLoading:status!=="success"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBasicTable"],{"data-test-subj":"uxJsErrorTable",loading:status!=="success",responsive:false,compressed:true,columns:cols,items:(_data$items=data===null||data===void 0?void 0:data.items)!==null&&_data$items!==void 0?_data$items:[],onChange:onTableChange,pagination:{...pagination,totalItemCount:(_data$totalErrorGroup=data===null||data===void 0?void 0:data.totalErrorGroups)!==null&&_data$totalErrorGroup!==void 0?_data$totalErrorGroup:0}}))}function ImpactfulMetrics(){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xs"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{wrap:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{style:{flexBasis:650}},external_kbnSharedDeps_React_default.a.createElement(JSErrors,null))))}var elasticsearch_fieldnames=__webpack_require__(53);function BreakdownFilter({selectedBreakdown:selectedBreakdown,onBreakdownChange:onBreakdownChange,dataTestSubj:dataTestSubj}){var _selectedBreakdown$fi;const NO_BREAKDOWN="noBreakdown";const items=[{name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.csm.breakDownFilter.noBreakdown",{defaultMessage:"No breakdown"}),fieldName:NO_BREAKDOWN,type:"category"},{name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.csm.breakdownFilter.browser",{defaultMessage:"Browser"}),fieldName:elasticsearch_fieldnames["w"],type:"category"},{name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.csm.breakdownFilter.os",{defaultMessage:"OS"}),fieldName:elasticsearch_fieldnames["x"],type:"category"},{name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.csm.breakdownFilter.device",{defaultMessage:"Device"}),fieldName:elasticsearch_fieldnames["v"],type:"category"},{name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.csm.breakdownFilter.location",{defaultMessage:"Location"}),fieldName:elasticsearch_fieldnames["b"],type:"category"}];const options=items.map(({name:name,fieldName:fieldName})=>({inputDisplay:fieldName===NO_BREAKDOWN?name:external_kbnSharedDeps_React_default.a.createElement("strong",null,name),value:fieldName,dropdownDisplay:name}));const onOptionChange=value=>{if(value===NO_BREAKDOWN){onBreakdownChange(null)}else{onBreakdownChange(items.find(({fieldName:fieldName})=>fieldName===value))}};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSuperSelect"],{fullWidth:true,compressed:true,options:options,valueOfSelected:(_selectedBreakdown$fi=selectedBreakdown===null||selectedBreakdown===void 0?void 0:selectedBreakdown.fieldName)!==null&&_selectedBreakdown$fi!==void 0?_selectedBreakdown$fi:NO_BREAKDOWN,onChange:value=>onOptionChange(value),"data-test-subj":dataTestSubj})}var external_kbnSharedDeps_ElasticCharts_=__webpack_require__(15);var external_kbnSharedDeps_ElasticEuiChartsTheme_=__webpack_require__(26);function generateAnnotationData(values){return Object.entries(values!==null&&values!==void 0?values:{}).map(value=>({dataValue:value[1],details:`${(+value[0]).toFixed(0)}`}))}function PercentileAnnotations({percentiles:percentiles}){var _generateAnnotationDa;const dataValues=(_generateAnnotationDa=generateAnnotationData(percentiles))!==null&&_generateAnnotationDa!==void 0?_generateAnnotationDa:[];const style={line:{strokeWidth:1,stroke:external_kbnSharedDeps_Theme_euiLightVars_default.a.euiColorSecondary,opacity:1}};function PercentileTooltip({annotation:annotation}){return external_kbnSharedDeps_React_["createElement"]("span",{"data-cy":"percentileTooltipTitle"},annotation.details,"th Percentile")}return external_kbnSharedDeps_React_["createElement"](external_kbnSharedDeps_React_["Fragment"],null,dataValues.map((annotation,index)=>external_kbnSharedDeps_React_["createElement"](external_kbnSharedDeps_ElasticCharts_["LineAnnotation"],{id:index+"annotation_"+annotation.dataValue,key:index+"percentile_"+annotation.dataValue,domainType:external_kbnSharedDeps_ElasticCharts_["AnnotationDomainTypes"].XDomain,dataValues:[annotation],style:style,hideTooltips:true,markerPosition:external_kbnSharedDeps_ElasticCharts_["Position"].Top,marker:external_kbnSharedDeps_React_["createElement"]("span",{"data-cy":"percentile-markers"},external_kbnSharedDeps_React_["createElement"](external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{title:external_kbnSharedDeps_React_["createElement"](PercentileTooltip,{annotation:annotation}),content:external_kbnSharedDeps_React_["createElement"]("span",null,"Pages loaded: ",Math.round(annotation.dataValue))},external_kbnSharedDeps_React_["createElement"](external_kbnSharedDeps_React_["Fragment"],null,annotation.details,"th")))})))}function ChartWrapper_extends(){ChartWrapper_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return ChartWrapper_extends.apply(this,arguments)}function ChartWrapper({loading:loading=false,height:height="100%",maxWidth:maxWidth,children:children,...rest}){const opacity=loading===true?.3:1;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiErrorBoundary"],null,external_kbnSharedDeps_React_default.a.createElement("div",ChartWrapper_extends({style:{height:height,opacity:opacity,transition:"opacity 0.2s",...maxWidth?{maxWidth:maxWidth}:{}}},rest),children),loading===true&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceAround",alignItems:"center",style:{height:height,marginTop:`-${height}`,marginBottom:0,...maxWidth?{maxWidth:maxWidth}:{}}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLoadingChart"],{size:"xl"}))))}const useBreakdowns=({percentileRange:percentileRange,field:field,value:value})=>{const{urlParams:urlParams,uiFilters:uiFilters}=Object(use_url_params["a"])();const{start:start,end:end,searchTerm:searchTerm}=urlParams;const{min:minP,max:maxP}=percentileRange!==null&&percentileRange!==void 0?percentileRange:{};return Object(use_fetcher["b"])(callApmApi=>{if(start&&end&&field&&value){return callApmApi({endpoint:"GET /api/apm/rum-client/page-load-distribution/breakdown",params:{query:{start:start,end:end,breakdown:value,uiFilters:JSON.stringify(uiFilters),urlQuery:searchTerm,...minP&&maxP?{minPercentile:String(minP),maxPercentile:String(maxP)}:{}}}})}},[end,start,uiFilters,field,value,minP,maxP,searchTerm])};function BreakdownSeries({field:field,value:value,percentileRange:percentileRange,onLoadingChange:onLoadingChange}){const[darkMode]=Object(public_["useUiSetting$"])("theme:darkMode");const euiChartTheme=darkMode?external_kbnSharedDeps_ElasticEuiChartsTheme_["EUI_CHARTS_THEME_DARK"]:external_kbnSharedDeps_ElasticEuiChartsTheme_["EUI_CHARTS_THEME_LIGHT"];const{data:data,status:status}=useBreakdowns({field:field,value:value,percentileRange:percentileRange});Object(external_kbnSharedDeps_React_["useEffect"])(()=>{onLoadingChange(status!=="success")},[status,onLoadingChange]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,data===null||data===void 0?void 0:data.map(({data:seriesData,name:name},sortIndex)=>{var _euiChartTheme$theme$,_euiChartTheme$theme$2;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["LineSeries"],{id:`${field}-${value}-${name}`,key:`${field}-${value}-${name}`,name:name,xScaleType:external_kbnSharedDeps_ElasticCharts_["ScaleType"].Linear,yScaleType:external_kbnSharedDeps_ElasticCharts_["ScaleType"].Linear,curve:external_kbnSharedDeps_ElasticCharts_["CurveType"].CURVE_CATMULL_ROM,data:seriesData!==null&&seriesData!==void 0?seriesData:[],lineSeriesStyle:{point:{visible:false}},fit:external_kbnSharedDeps_ElasticCharts_["Fit"].Linear,color:(_euiChartTheme$theme$=euiChartTheme.theme.colors)===null||_euiChartTheme$theme$===void 0?void 0:(_euiChartTheme$theme$2=_euiChartTheme$theme$.vizColors)===null||_euiChartTheme$theme$2===void 0?void 0:_euiChartTheme$theme$2[sortIndex===0?0:sortIndex+1],tickFormat:d=>external_kbnSharedDeps_ElasticNumeral_default()(d).format("0.0")+" %"})}))}const PageLoadChart=external_kbnSharedDeps_StyledComponents_default()(external_kbnSharedDeps_ElasticCharts_["Chart"]).withConfig({displayName:"PageLoadChart",componentId:"h0xeca-0"})([".echAnnotation{pointer-events:initial;}"]);function PageLoadDistChart({onPercentileChange:onPercentileChange,data:data,breakdown:breakdown,loading:loading,percentileRange:percentileRange}){var _data$pageLoadDistrib,_euiChartTheme$theme$,_euiChartTheme$theme$2;const[breakdownLoading,setBreakdownLoading]=Object(external_kbnSharedDeps_React_["useState"])(false);const onBrushEnd=({x:x})=>{if(!x){return}const[minX,maxX]=x;onPercentileChange(minX,maxX)};const headerFormatter=tooltip=>external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement("p",null,tooltip.value," ",I18LABELS.seconds));const tooltipProps={headerFormatter:headerFormatter};const[darkMode]=Object(public_["useUiSetting$"])("theme:darkMode");const euiChartTheme=darkMode?external_kbnSharedDeps_ElasticEuiChartsTheme_["EUI_CHARTS_THEME_DARK"]:external_kbnSharedDeps_ElasticEuiChartsTheme_["EUI_CHARTS_THEME_LIGHT"];return external_kbnSharedDeps_React_default.a.createElement(ChartWrapper,{loading:loading||breakdownLoading,height:"250px"},(!loading||data)&&external_kbnSharedDeps_React_default.a.createElement(PageLoadChart,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Settings"],{baseTheme:darkMode?external_kbnSharedDeps_ElasticCharts_["DARK_THEME"]:external_kbnSharedDeps_ElasticCharts_["LIGHT_THEME"],theme:euiChartTheme.theme,onBrushEnd:onBrushEnd,tooltip:tooltipProps,showLegend:true}),external_kbnSharedDeps_React_default.a.createElement(PercentileAnnotations,{percentiles:data===null||data===void 0?void 0:data.percentiles}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Axis"],{id:"bottom",title:I18LABELS.pageLoadTime,position:external_kbnSharedDeps_ElasticCharts_["Position"].Bottom}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Axis"],{id:"left",title:I18LABELS.percPageLoaded,position:external_kbnSharedDeps_ElasticCharts_["Position"].Left,labelFormat:d=>d+" %"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["LineSeries"],{sortIndex:0,fit:external_kbnSharedDeps_ElasticCharts_["Fit"].Linear,id:"PagesPercentage",name:I18LABELS.overall,xScaleType:external_kbnSharedDeps_ElasticCharts_["ScaleType"].Linear,yScaleType:external_kbnSharedDeps_ElasticCharts_["ScaleType"].Linear,data:(_data$pageLoadDistrib=data===null||data===void 0?void 0:data.pageLoadDistribution)!==null&&_data$pageLoadDistrib!==void 0?_data$pageLoadDistrib:[],curve:external_kbnSharedDeps_ElasticCharts_["CurveType"].CURVE_CATMULL_ROM,lineSeriesStyle:{point:{visible:false},line:{strokeWidth:3}},color:(_euiChartTheme$theme$=euiChartTheme.theme.colors)===null||_euiChartTheme$theme$===void 0?void 0:(_euiChartTheme$theme$2=_euiChartTheme$theme$.vizColors)===null||_euiChartTheme$theme$2===void 0?void 0:_euiChartTheme$theme$2[1],tickFormat:d=>external_kbnSharedDeps_ElasticNumeral_default()(d).format("0.0")+" %"}),breakdown&&external_kbnSharedDeps_React_default.a.createElement(BreakdownSeries,{key:`${breakdown.type}-${breakdown.name}`,field:breakdown.type,value:breakdown.name,percentileRange:percentileRange,onLoadingChange:bLoading=>{setBreakdownLoading(bLoading)}})))}function ResetPercentileZoom({percentileRange:percentileRange,setPercentileRange:setPercentileRange}){const isDisabled=percentileRange.min===null&&percentileRange.max===null;const onClick=()=>{setPercentileRange({min:null,max:null})};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiShowFor"],{sizes:["xs"]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{iconType:"inspect",size:"s","aria-label":I18LABELS.resetZoom,onClick:onClick,disabled:isDisabled})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHideFor"],{sizes:["xs"]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{iconType:"inspect",size:"s",onClick:onClick,disabled:isDisabled},I18LABELS.resetZoom)))}function PageLoadDistribution(){const{urlParams:urlParams,uiFilters:uiFilters}=Object(use_url_params["a"])();const{start:start,end:end,searchTerm:searchTerm}=urlParams;const[percentileRange,setPercentileRange]=Object(external_kbnSharedDeps_React_["useState"])({min:null,max:null});const[breakdown,setBreakdown]=Object(external_kbnSharedDeps_React_["useState"])(null);const{data:data,status:status}=Object(use_fetcher["b"])(callApmApi=>{const{serviceName:serviceName}=uiFilters;if(start&&end&&serviceName){return callApmApi({endpoint:"GET /api/apm/rum-client/page-load-distribution",params:{query:{start:start,end:end,uiFilters:JSON.stringify(uiFilters),urlQuery:searchTerm,...percentileRange.min&&percentileRange.max?{minPercentile:String(percentileRange.min),maxPercentile:String(percentileRange.max)}:{}}}})}return Promise.resolve(null)},[end,start,uiFilters,percentileRange.min,percentileRange.max,searchTerm]);const onPercentileChange=(min,max)=>{setPercentileRange({min:min,max:max})};return external_kbnSharedDeps_React_default.a.createElement("div",{"data-cy":"pageLoadDist"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{responsive:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h3",null,I18LABELS.pageLoadDistribution))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(ResetPercentileZoom,{percentileRange:percentileRange,setPercentileRange:setPercentileRange})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:{width:170}},external_kbnSharedDeps_React_default.a.createElement(BreakdownFilter,{selectedBreakdown:breakdown,onBreakdownChange:setBreakdown,dataTestSubj:"pldBreakdownFilter"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(PageLoadDistChart,{data:data,onPercentileChange:onPercentileChange,loading:status!=="success",breakdown:breakdown,percentileRange:{max:percentileRange.max||(data===null||data===void 0?void 0:data.maxDuration),min:percentileRange.min||(data===null||data===void 0?void 0:data.minDuration)}}))}var external_kbnSharedDeps_Moment_=__webpack_require__(17);var external_kbnSharedDeps_Moment_default=__webpack_require__.n(external_kbnSharedDeps_Moment_);function PageViewsChart({data:data,loading:loading}){var _data$topItems,_data$topItems2,_data$items,_euiChartTheme$theme$,_euiChartTheme$theme$2;const history=Object(external_kbnSharedDeps_ReactRouterDom_["useHistory"])();const{urlParams:urlParams}=Object(use_url_params["a"])();const{start:start,end:end}=urlParams;const diffInDays=external_kbnSharedDeps_Moment_default()(new Date(end)).diff(external_kbnSharedDeps_Moment_default()(new Date(start)),"day");const formatter=Object(external_kbnSharedDeps_ElasticCharts_["timeFormatter"])(Object(external_kbnSharedDeps_ElasticCharts_["niceTimeFormatByDay"])(diffInDays>1?2:1));const onBrushEnd=({x:x})=>{if(!x){return}const[minX,maxX]=x;const rangeFrom=external_kbnSharedDeps_Moment_default()(minX).toISOString();const rangeTo=external_kbnSharedDeps_Moment_default()(maxX).toISOString();history.push({...history.location,search:Object(url_helpers["b"])({...Object(url_helpers["e"])(history.location.search),rangeFrom:rangeFrom,rangeTo:rangeTo})})};const hasBreakdowns=!!(data!==null&&data!==void 0&&(_data$topItems=data.topItems)!==null&&_data$topItems!==void 0&&_data$topItems.length);const breakdownAccessors=data!==null&&data!==void 0&&(_data$topItems2=data.topItems)!==null&&_data$topItems2!==void 0&&_data$topItems2.length?data===null||data===void 0?void 0:data.topItems:["y"];const[darkMode]=Object(public_["useUiSetting$"])("theme:darkMode");const customSeriesNaming=({yAccessor:yAccessor})=>{if(yAccessor==="y"){return I18LABELS.overall}return yAccessor};const euiChartTheme=darkMode?external_kbnSharedDeps_ElasticEuiChartsTheme_["EUI_CHARTS_THEME_DARK"]:external_kbnSharedDeps_ElasticEuiChartsTheme_["EUI_CHARTS_THEME_LIGHT"];return external_kbnSharedDeps_React_default.a.createElement(ChartWrapper,{loading:loading,height:"250px"},(!loading||data)&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Chart"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Settings"],{baseTheme:darkMode?external_kbnSharedDeps_ElasticCharts_["DARK_THEME"]:external_kbnSharedDeps_ElasticCharts_["LIGHT_THEME"],theme:euiChartTheme.theme,showLegend:true,onBrushEnd:onBrushEnd,xDomain:{min:new Date(start).valueOf(),max:new Date(end).valueOf()}}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Axis"],{id:"date_time",position:external_kbnSharedDeps_ElasticCharts_["Position"].Bottom,tickFormat:formatter}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Axis"],{id:"page_views",title:I18LABELS.pageViews,position:external_kbnSharedDeps_ElasticCharts_["Position"].Left,tickFormat:d=>external_kbnSharedDeps_ElasticNumeral_default()(d).format("0"),labelFormat:d=>external_kbnSharedDeps_ElasticNumeral_default()(d).format("0a")}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["BarSeries"],{id:I18LABELS.pageViews,xScaleType:external_kbnSharedDeps_ElasticCharts_["ScaleType"].Time,yScaleType:external_kbnSharedDeps_ElasticCharts_["ScaleType"].Linear,xAccessor:"x",yAccessors:Array.from(breakdownAccessors),stackAccessors:["x"],data:(_data$items=data===null||data===void 0?void 0:data.items)!==null&&_data$items!==void 0?_data$items:[],name:customSeriesNaming,color:!hasBreakdowns?(_euiChartTheme$theme$=euiChartTheme.theme.colors)===null||_euiChartTheme$theme$===void 0?void 0:(_euiChartTheme$theme$2=_euiChartTheme$theme$.vizColors)===null||_euiChartTheme$theme$2===void 0?void 0:_euiChartTheme$theme$2[1]:undefined})))}function PageViewsTrend(){const{urlParams:urlParams,uiFilters:uiFilters}=Object(use_url_params["a"])();const{start:start,end:end,searchTerm:searchTerm}=urlParams;const[breakdown,setBreakdown]=Object(external_kbnSharedDeps_React_["useState"])(null);const{data:data,status:status}=Object(use_fetcher["b"])(callApmApi=>{const{serviceName:serviceName}=uiFilters;if(start&&end&&serviceName){return callApmApi({endpoint:"GET /api/apm/rum-client/page-view-trends",params:{query:{start:start,end:end,uiFilters:JSON.stringify(uiFilters),urlQuery:searchTerm,...breakdown?{breakdowns:JSON.stringify(breakdown)}:{}}}})}return Promise.resolve(undefined)},[end,start,uiFilters,breakdown,searchTerm]);return external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{responsive:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h3",null,I18LABELS.pageViews))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:{width:170}},external_kbnSharedDeps_React_default.a.createElement(BreakdownFilter,{selectedBreakdown:breakdown,onBreakdownChange:setBreakdown,dataTestSubj:"pvBreakdownFilter"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(PageViewsChart,{data:data,loading:status!=="success"}))}function PageLoadAndViews(){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"s",wrap:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{style:{flexBasis:650}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],null,external_kbnSharedDeps_React_default.a.createElement(PageLoadDistribution,null))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{style:{flexBasis:650}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],null,external_kbnSharedDeps_React_default.a.createElement(PageViewsTrend,null))))}const StyleChart=external_kbnSharedDeps_StyledComponents_default.a.div.withConfig({displayName:"StyleChart",componentId:"sc-1d1m9rm-0"})(["height:100%;"]);const theme={legend:{verticalWidth:100}};function VisitorBreakdownChart({loading:loading,options:options}){const[darkMode]=Object(public_["useUiSetting$"])("theme:darkMode");const euiChartTheme=darkMode?external_kbnSharedDeps_ElasticEuiChartsTheme_["EUI_CHARTS_THEME_DARK"]:external_kbnSharedDeps_ElasticEuiChartsTheme_["EUI_CHARTS_THEME_LIGHT"];return external_kbnSharedDeps_React_default.a.createElement(ChartWrapper,{loading:loading,height:"245px",maxWidth:"430px"},external_kbnSharedDeps_React_default.a.createElement(StyleChart,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Chart"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Settings"],{showLegend:true,baseTheme:darkMode?external_kbnSharedDeps_ElasticCharts_["DARK_THEME"]:external_kbnSharedDeps_ElasticCharts_["LIGHT_THEME"],theme:theme}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Partition"],{id:"spec_1",data:options!==null&&options!==void 0&&options.length?options:[{count:1,name:I18LABELS.noData}],valueAccessor:d=>d.count,valueGetter:"percent",percentFormatter:d=>`${Math.round((d+Number.EPSILON)*100)/100}%`,layers:[{groupByRollup:d=>d.name,shape:{fillColor:d=>{var _euiChartTheme$theme$,_euiChartTheme$theme$2;return(_euiChartTheme$theme$=euiChartTheme.theme.colors)===null||_euiChartTheme$theme$===void 0?void 0:(_euiChartTheme$theme$2=_euiChartTheme$theme$.vizColors)===null||_euiChartTheme$theme$2===void 0?void 0:_euiChartTheme$theme$2[d.sortIndex]}}}],config:{partitionLayout:external_kbnSharedDeps_ElasticCharts_["PartitionLayout"].sunburst,linkLabel:{maximumSection:Infinity,maxCount:0},margin:{top:0,bottom:0,left:0,right:0},outerSizeRatio:1,circlePadding:4,clockwiseSectors:false}}))))}function VisitorBreakdown(){const{urlParams:urlParams,uiFilters:uiFilters}=Object(use_url_params["a"])();const{start:start,end:end,searchTerm:searchTerm}=urlParams;const{data:data,status:status}=Object(use_fetcher["b"])(callApmApi=>{const{serviceName:serviceName}=uiFilters;if(start&&end&&serviceName){return callApmApi({endpoint:"GET /api/apm/rum-client/visitor-breakdown",params:{query:{start:start,end:end,uiFilters:JSON.stringify(uiFilters),urlQuery:searchTerm}}})}return Promise.resolve(null)},[end,start,uiFilters,searchTerm]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h3",null,VisitorBreakdownLabel)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{style:{height:"calc(100% - 32px)"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h4",null,I18LABELS.browser)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(VisitorBreakdownChart,{options:data===null||data===void 0?void 0:data.browsers,loading:status!=="success"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h4",null,I18LABELS.operatingSystem)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(VisitorBreakdownChart,{options:data===null||data===void 0?void 0:data.os,loading:status!=="success"}))))}var uuid=__webpack_require__(544);var uuid_default=__webpack_require__.n(uuid);var constants_=__webpack_require__(31);var embeddable_public_=__webpack_require__(35);var apmOss_public_=__webpack_require__(28);var transaction_types=__webpack_require__(72);const ES_TERM_SOURCE_COUNTRY={type:constants_["SOURCE_TYPES"].ES_TERM_SOURCE,id:"3657625d-17b0-41ef-99ba-3a2b2938655c",indexPatternTitle:"apm-*",term:"client.geo.country_iso_code",metrics:[{type:constants_["AGG_TYPE"].AVG,field:"transaction.duration.us",label:"Page load duration"}],indexPatternId:apmOss_public_["APM_STATIC_INDEX_PATTERN_ID"],applyGlobalQuery:true,applyGlobalTime:true};const ES_TERM_SOURCE_REGION={type:constants_["SOURCE_TYPES"].ES_TERM_SOURCE,id:"e62a1b9c-d7ff-4fd4-a0f6-0fdc44bb9e41",indexPatternTitle:"apm-*",term:"client.geo.region_iso_code",metrics:[{type:constants_["AGG_TYPE"].AVG,field:"transaction.duration.us"}],whereQuery:{query:'transaction.type : "page-load"',language:"kuery"},indexPatternId:apmOss_public_["APM_STATIC_INDEX_PATTERN_ID"],applyGlobalQuery:true,applyGlobalTime:true};const getWhereQuery=serviceName=>({query:`${elasticsearch_fieldnames["t"]} : "${transaction_types["a"]}" and ${elasticsearch_fieldnames["i"]} : "${serviceName}"`,language:"kuery"});const REGION_NAME="region_name";const COUNTRY_NAME="name";const TRANSACTION_DURATION_REGION="__kbnjoin__avg_of_transaction.duration.us__e62a1b9c-d7ff-4fd4-a0f6-0fdc44bb9e41";const TRANSACTION_DURATION_COUNTRY="__kbnjoin__avg_of_transaction.duration.us__3657625d-17b0-41ef-99ba-3a2b2938655c";function useLayerList(){const{urlParams:urlParams}=Object(use_url_params["a"])();const{serviceName:serviceName}=urlParams;ES_TERM_SOURCE_COUNTRY.whereQuery=getWhereQuery(serviceName);const getLayerStyle=fieldName=>({type:"VECTOR",properties:{icon:{type:constants_["STYLE_TYPE"].STATIC,options:{value:"marker"}},fillColor:{type:constants_["STYLE_TYPE"].DYNAMIC,options:{color:"Blue to Red",colorCategory:"palette_0",fieldMetaOptions:{isEnabled:true,sigma:3},type:constants_["COLOR_MAP_TYPE"].ORDINAL,field:{name:fieldName,origin:constants_["FIELD_ORIGIN"].JOIN},useCustomColorRamp:false}},lineColor:{type:constants_["STYLE_TYPE"].DYNAMIC,options:{color:"#3d3d3d",fieldMetaOptions:{isEnabled:true}}},lineWidth:{type:constants_["STYLE_TYPE"].STATIC,options:{size:1}},iconSize:{type:constants_["STYLE_TYPE"].STATIC,options:{size:6}},iconOrientation:{type:constants_["STYLE_TYPE"].STATIC,options:{orientation:0}},labelText:{type:constants_["STYLE_TYPE"].STATIC,options:{value:""}},labelColor:{type:constants_["STYLE_TYPE"].STATIC,options:{color:"#000000"}},labelSize:{type:constants_["STYLE_TYPE"].STATIC,options:{size:14}},labelBorderColor:{type:constants_["STYLE_TYPE"].STATIC,options:{color:"#FFFFFF"}},symbolizeAs:{options:{value:constants_["SYMBOLIZE_AS_TYPES"].CIRCLE}},labelBorderSize:{options:{size:constants_["LABEL_BORDER_SIZES"].SMALL}}},isTimeAware:true});const pageLoadDurationByCountryLayer={joins:[{leftField:"iso2",right:ES_TERM_SOURCE_COUNTRY}],sourceDescriptor:{type:"EMS_FILE",id:"world_countries",tooltipProperties:[COUNTRY_NAME]},style:getLayerStyle(TRANSACTION_DURATION_COUNTRY),id:"e8d1d974-eed8-462f-be2c-f0004b7619b2",label:null,minZoom:0,maxZoom:24,alpha:.75,visible:true,type:"VECTOR"};ES_TERM_SOURCE_REGION.whereQuery=getWhereQuery(serviceName);const pageLoadDurationByAdminRegionLayer={joins:[{leftField:"region_iso_code",right:ES_TERM_SOURCE_REGION}],sourceDescriptor:{type:"EMS_FILE",id:"administrative_regions_lvl2",tooltipProperties:["region_iso_code",REGION_NAME]},style:getLayerStyle(TRANSACTION_DURATION_REGION),id:"0e936d41-8765-41c9-97f0-05e166391366",label:null,minZoom:3,maxZoom:24,alpha:.75,visible:true,type:"VECTOR"};return[pageLoadDurationByCountryLayer,pageLoadDurationByAdminRegionLayer]}var use_apm_plugin_context=__webpack_require__(39);const DescriptionItem=external_kbnSharedDeps_StyledComponents_default()(external_kbnSharedDeps_ElasticEui_["EuiDescriptionListDescription"]).withConfig({displayName:"DescriptionItem",componentId:"sc-2807r4-0"})(["&&&{width:25%;}"]);const TitleItem=external_kbnSharedDeps_StyledComponents_default()(external_kbnSharedDeps_ElasticEui_["EuiDescriptionListTitle"]).withConfig({displayName:"TitleItem",componentId:"sc-2807r4-1"})(["&&&{width:75%;}"]);function MapToolTipComponent({closeTooltip:closeTooltip,features:features=[],loadFeatureProperties:loadFeatureProperties}){var _features$;const{id:featureId,layerId:layerId}=(_features$=features[0])!==null&&_features$!==void 0?_features$:{};const[regionName,setRegionName]=Object(external_kbnSharedDeps_React_["useState"])(featureId);const[pageLoadDuration,setPageLoadDuration]=Object(external_kbnSharedDeps_React_["useState"])("");const formatPageLoadValue=val=>{const valInMs=val/1e3;if(valInMs>1e3){return(valInMs/1e3).toFixed(2)+" sec"}return(valInMs/1e3).toFixed(0)+" ms"};Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const loadRegionInfo=async()=>{if(loadFeatureProperties){const items=await loadFeatureProperties({layerId:layerId,featureId:featureId});items.forEach(item=>{if(item.getPropertyKey()===COUNTRY_NAME||item.getPropertyKey()===REGION_NAME){setRegionName(item.getRawValue())}if(item.getPropertyKey()===TRANSACTION_DURATION_REGION||item.getPropertyKey()===TRANSACTION_DURATION_COUNTRY){setPageLoadDuration(formatPageLoadValue(+item.getRawValue()))}})}};loadRegionInfo()});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiOutsideClickDetector"],{onOutsideClick:()=>{if(closeTooltip!=null){closeTooltip()}}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopoverTitle"],null,regionName),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{type:"column",textStyle:"reverse",compressed:true,style:{width:300}},external_kbnSharedDeps_React_default.a.createElement(TitleItem,{className:"eui-textNoWrap"},I18LABELS.avgPageLoadDuration),external_kbnSharedDeps_React_default.a.createElement(DescriptionItem,null,pageLoadDuration))))}const MapToolTip=external_kbnSharedDeps_React_default.a.memo(MapToolTipComponent);const getWildcardFilter=(field,value)=>({meta:{index:apmOss_public_["APM_STATIC_INDEX_PATTERN_ID"],alias:null,negate:false,disabled:false,type:"term",key:field,params:{query:value}},query:{wildcard:{[field]:{value:`*${value}*`}}}});const getMatchFilter=(field,value)=>({meta:{index:apmOss_public_["APM_STATIC_INDEX_PATTERN_ID"],alias:null,negate:false,disabled:false,type:"phrase",key:field,params:{query:value}},query:{term:{[field]:value}}});const getMultiMatchFilter=(field,values)=>({meta:{index:apmOss_public_["APM_STATIC_INDEX_PATTERN_ID"],type:"phrases",key:field,value:values.join(", "),params:values,alias:null,negate:false,disabled:false},query:{bool:{should:values.map(value=>({match_phrase:{[field]:value}})),minimum_should_match:1}}});const useMapFilters=()=>{const{urlParams:urlParams,uiFilters:uiFilters}=Object(use_url_params["a"])();const{serviceName:serviceName,searchTerm:searchTerm}=urlParams;const{browser:browser,device:device,os:os,location:location,transactionUrl:transactionUrl}=uiFilters;const existFilter={meta:{index:apmOss_public_["APM_STATIC_INDEX_PATTERN_ID"],alias:null,negate:false,disabled:false,type:"exists",key:"transaction.marks.navigationTiming.fetchStart",value:"exists"},exists:{field:"transaction.marks.navigationTiming.fetchStart"}};return Object(external_kbnSharedDeps_React_["useMemo"])(()=>{const filters=[existFilter];if(serviceName){filters.push(getMatchFilter(elasticsearch_fieldnames["i"],serviceName))}if(browser){filters.push(getMultiMatchFilter(elasticsearch_fieldnames["w"],browser))}if(device){filters.push(getMultiMatchFilter(elasticsearch_fieldnames["v"],device))}if(os){filters.push(getMultiMatchFilter(elasticsearch_fieldnames["x"],os))}if(location){filters.push(getMultiMatchFilter(elasticsearch_fieldnames["b"],location))}if(transactionUrl){filters.push(getMultiMatchFilter(elasticsearch_fieldnames["u"],transactionUrl))}if(searchTerm){filters.push(getWildcardFilter(elasticsearch_fieldnames["u"],searchTerm))}return filters},[serviceName,browser,device,os,location,searchTerm])};function EmbeddedMap_extends(){EmbeddedMap_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return EmbeddedMap_extends.apply(this,arguments)}const EmbeddedPanel=external_kbnSharedDeps_StyledComponents_default.a.div.withConfig({displayName:"EmbeddedPanel",componentId:"fmxjbq-0"})(["z-index:auto;flex:1;display:flex;flex-direction:column;height:100%;position:relative;.embPanel__content{display:flex;flex:1 1 100%;z-index:1;min-height:0;}&&& .mapboxgl-canvas{animation:none !important;}"]);function EmbeddedMapComponent(){const{urlParams:urlParams}=Object(use_url_params["a"])();const apmPluginContext=Object(use_apm_plugin_context["a"])();const{start:start,end:end,serviceName:serviceName}=urlParams;const mapFilters=useMapFilters();const layerList=useLayerList();const[embeddable,setEmbeddable]=Object(external_kbnSharedDeps_React_["useState"])();const embeddableRoot=Object(external_kbnSharedDeps_React_["useRef"])(null);const{services:{embeddable:embeddablePlugin}}=Object(public_["useKibana"])();if(!embeddablePlugin){throw new Error("Embeddable start plugin not found")}const factory=embeddablePlugin.getEmbeddableFactory(constants_["MAP_SAVED_OBJECT_TYPE"]);const input={attributes:{title:""},id:uuid_default.a.v4(),filters:mapFilters,refreshConfig:{value:0,pause:false},viewMode:embeddable_public_["ViewMode"].VIEW,isLayerTOCOpen:false,query:{query:'transaction.type : "page-load"',language:"kuery"},...start&&{timeRange:{from:new Date(start).toISOString(),to:new Date(end).toISOString()}},hideFilterActions:true};function renderTooltipContent({addFilters:addFilters,closeTooltip:closeTooltip,features:features,isLocked:isLocked,getLayerName:getLayerName,loadFeatureProperties:loadFeatureProperties,loadFeatureGeometry:loadFeatureGeometry}){const props={addFilters:addFilters,closeTooltip:closeTooltip,isLocked:isLocked,getLayerName:getLayerName,loadFeatureProperties:loadFeatureProperties,loadFeatureGeometry:loadFeatureGeometry};return external_kbnSharedDeps_React_default.a.createElement(MapToolTip,EmbeddedMap_extends({},props,{features:features}))}Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(embeddable!=null&&serviceName){embeddable.updateInput({filters:mapFilters})}},[mapFilters]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(embeddable!=null&&start!=null&&end!=null){const timeRange={from:new Date(start).toISOString(),to:new Date(end).toISOString()};embeddable.updateInput({timeRange:timeRange})}},[start,end]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{async function setupEmbeddable(){if(!factory){throw new Error("Map embeddable not found.")}const embeddableObject=await factory.create({...input,title:"Visitors by region"});if(embeddableObject&&!Object(embeddable_public_["isErrorEmbeddable"])(embeddableObject)){embeddableObject.setRenderTooltipContent(renderTooltipContent);const basemapLayerDescriptor=apmPluginContext.plugins.maps?await apmPluginContext.plugins.maps.createLayerDescriptors.createBasemapLayerDescriptor():null;if(basemapLayerDescriptor){layerList.unshift(basemapLayerDescriptor)}await embeddableObject.setLayerList(layerList)}setEmbeddable(embeddableObject)}setupEmbeddable()},[]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(embeddableRoot.current&&embeddable&&serviceName){embeddable.render(embeddableRoot.current)}},[embeddable,embeddableRoot,serviceName]);return external_kbnSharedDeps_React_default.a.createElement(EmbeddedPanel,null,external_kbnSharedDeps_React_default.a.createElement("div",{"data-test-subj":"xpack.apm.regionMap.embeddedPanel",className:"embPanel__content",ref:embeddableRoot}))}EmbeddedMapComponent.displayName="EmbeddedMap";const EmbeddedMap=external_kbnSharedDeps_React_default.a.memo(EmbeddedMapComponent);function VisitorBreakdownMap(){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h3",null,I18LABELS.pageLoadDurationByRegion)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement("div",{style:{height:400}},external_kbnSharedDeps_React_default.a.createElement(EmbeddedMap,null)))}function VisitorBreakdownsPanel(){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"s",wrap:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{style:{flexBasis:650}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],null,external_kbnSharedDeps_React_default.a.createElement(VisitorBreakdownMap,null))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{style:{flexBasis:650}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],null,external_kbnSharedDeps_React_default.a.createElement(VisitorBreakdown,null))))}const ClFlexGroup=external_kbnSharedDeps_StyledComponents_default()(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"]).withConfig({displayName:"ClFlexGroup",componentId:"sc-1fsyoq8-0"})(["flex-direction:row;@media only screen and (max-width:768px){flex-direction:row;justify-content:space-between;}"]);function Metrics_formatTitle(unit,value){if(typeof value==="undefined")return I18LABELS.dataMissing;return formatToSec(value,unit)}function PageViewsTotalTitle({pageViews:pageViews}){if(typeof pageViews==="undefined"){return external_kbnSharedDeps_React_["createElement"](external_kbnSharedDeps_React_["Fragment"],null,I18LABELS.dataMissing)}return pageViews<1e4?external_kbnSharedDeps_React_["createElement"](external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_ElasticNumeral_default()(pageViews).format("0,0")):external_kbnSharedDeps_React_["createElement"](external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{content:external_kbnSharedDeps_ElasticNumeral_default()(pageViews).format("0,0")},external_kbnSharedDeps_React_["createElement"](external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_ElasticNumeral_default()(pageViews).format("0 a")))}function Metrics(){var _data$totalPageLoadDu,_data$backEnd,_data$frontEnd,_data$pageViews2;const uxQuery=useUxQuery();const{data:data,status:status}=Object(use_fetcher["b"])(callApmApi=>{if(uxQuery){return callApmApi({endpoint:"GET /api/apm/rum/client-metrics",params:{query:{...uxQuery}}})}return Promise.resolve(null)},[uxQuery]);const{setSharedData:setSharedData}=Object(external_kbnSharedDeps_React_["useContext"])(CsmSharedContext);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{var _data$pageViews$value,_data$pageViews;setSharedData({totalPageViews:(_data$pageViews$value=data===null||data===void 0?void 0:(_data$pageViews=data.pageViews)===null||_data$pageViews===void 0?void 0:_data$pageViews.value)!==null&&_data$pageViews$value!==void 0?_data$pageViews$value:0})},[data,setSharedData]);const STAT_STYLE={minWidth:"150px",maxWidth:"250px"};return external_kbnSharedDeps_React_["createElement"](ClFlexGroup,{wrap:true,responsive:false},external_kbnSharedDeps_React_["createElement"](external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{style:STAT_STYLE},external_kbnSharedDeps_React_["createElement"](external_kbnSharedDeps_ElasticEui_["EuiStat"],{titleSize:"l",title:Metrics_formatTitle("ms",data===null||data===void 0?void 0:(_data$totalPageLoadDu=data.totalPageLoadDuration)===null||_data$totalPageLoadDu===void 0?void 0:_data$totalPageLoadDu.value),description:external_kbnSharedDeps_React_["createElement"](external_kbnSharedDeps_React_["Fragment"],null,I18LABELS.totalPageLoad,external_kbnSharedDeps_React_["createElement"](external_kbnSharedDeps_ElasticEui_["EuiIconTip"],{content:I18LABELS.totalPageLoadTooltip,type:"questionInCircle"})),isLoading:status!=="success"})),external_kbnSharedDeps_React_["createElement"](external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{style:STAT_STYLE},external_kbnSharedDeps_React_["createElement"](external_kbnSharedDeps_ElasticEui_["EuiStat"],{titleSize:"l",title:Metrics_formatTitle("ms",data===null||data===void 0?void 0:(_data$backEnd=data.backEnd)===null||_data$backEnd===void 0?void 0:_data$backEnd.value),description:external_kbnSharedDeps_React_["createElement"](external_kbnSharedDeps_React_["Fragment"],null,I18LABELS.backEnd,external_kbnSharedDeps_React_["createElement"](external_kbnSharedDeps_ElasticEui_["EuiIconTip"],{content:I18LABELS.backEndTooltip,type:"questionInCircle"})),isLoading:status!=="success"})),external_kbnSharedDeps_React_["createElement"](external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{style:STAT_STYLE},external_kbnSharedDeps_React_["createElement"](external_kbnSharedDeps_ElasticEui_["EuiStat"],{titleSize:"l",title:Metrics_formatTitle("ms",data===null||data===void 0?void 0:(_data$frontEnd=data.frontEnd)===null||_data$frontEnd===void 0?void 0:_data$frontEnd.value),description:external_kbnSharedDeps_React_["createElement"](external_kbnSharedDeps_React_["Fragment"],null,I18LABELS.frontEnd,external_kbnSharedDeps_React_["createElement"](external_kbnSharedDeps_ElasticEui_["EuiIconTip"],{content:I18LABELS.frontEndTooltip,type:"questionInCircle"})),isLoading:status!=="success"})),external_kbnSharedDeps_React_["createElement"](external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{style:STAT_STYLE},external_kbnSharedDeps_React_["createElement"](external_kbnSharedDeps_ElasticEui_["EuiStat"],{titleSize:"l",title:external_kbnSharedDeps_React_["createElement"](PageViewsTotalTitle,{pageViews:data===null||data===void 0?void 0:(_data$pageViews2=data.pageViews)===null||_data$pageViews2===void 0?void 0:_data$pageViews2.value}),description:I18LABELS.pageViews,isLoading:status!=="success"})))}function ClientMetrics(){const{urlParams:{percentile:percentile}}=Object(use_url_params["a"])();return external_kbnSharedDeps_React_["createElement"](external_kbnSharedDeps_ElasticEui_["EuiPanel"],null,external_kbnSharedDeps_React_["createElement"](external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween"},external_kbnSharedDeps_React_["createElement"](external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:1,"data-cy":`client-metrics`},external_kbnSharedDeps_React_["createElement"](external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_["createElement"]("h3",null,I18LABELS.pageLoad," (",getPercentileLabel(percentile),")")),external_kbnSharedDeps_React_["createElement"](external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_["createElement"](Metrics,null))))}function RumDashboard(){const{isSmall:isSmall}=Object(use_break_points["a"])();return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:isSmall?"row":"column",gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(ClientMetrics,null)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(UXMetrics,null)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(PageLoadAndViews,null)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(VisitorBreakdownsPanel,null)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(ImpactfulMetrics,null)))}var useDebounce=__webpack_require__(252);var useDebounce_default=__webpack_require__.n(useDebounce);var useEvent=__webpack_require__(1415);var useEvent_default=__webpack_require__.n(useEvent);var classnames=__webpack_require__(1414);var classnames_default=__webpack_require__.n(classnames);const StyledSpan=external_kbnSharedDeps_StyledComponents_default.a.span.withConfig({displayName:"StyledSpan",componentId:"ywvq47-0"})(["color:",";font-weight:500;:not(:last-of-type)::after{content:'â€¢';margin:0 4px;}"],external_kbnSharedDeps_Theme_euiLightVars_default.a.euiColorSecondaryText);const StyledListSpan=external_kbnSharedDeps_StyledComponents_default.a.span.withConfig({displayName:"StyledListSpan",componentId:"ywvq47-1"})(["display:block;margin-top:4px;font-size:12px;"]);const formatOptions=options=>options.map(item=>({title:item.label,...item,className:classnames_default()("euiSelectableTemplateSitewide__listItem",item.className)}));function selectableRenderOptions(option,searchValue){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHighlight"],{className:"euiSelectableTemplateSitewide__listItemTitle",search:searchValue},option.label),renderOptionMeta(option.meta))}function renderOptionMeta(meta){if(!meta||meta.length<1)return;return external_kbnSharedDeps_React_default.a.createElement(StyledListSpan,null,meta.map(item=>external_kbnSharedDeps_React_default.a.createElement(StyledSpan,{key:item},item)))}const StyledRow=external_kbnSharedDeps_StyledComponents_default.a.div.withConfig({displayName:"StyledRow",componentId:"sc-1uwqtk-0"})(["text-align:center;padding:8px 0px;background-color:",";border-bottom:1px solid ",";"],props=>props.darkMode?external_kbnSharedDeps_Theme_euiDarkVars_default.a.euiPageBackgroundColor:external_kbnSharedDeps_Theme_euiLightVars_default.a.euiPageBackgroundColor,props=>props.darkMode?external_kbnSharedDeps_Theme_euiDarkVars_default.a.euiColorLightestShade:external_kbnSharedDeps_Theme_euiLightVars_default.a.euiColorLightestShade);function SelectableUrlList({data:data,loading:loading,onInputChange:onInputChange,onTermChange:onTermChange,onChange:onChange,searchValue:searchValue,onClose:onClose,popoverIsOpen:popoverIsOpen,setPopoverIsOpen:setPopoverIsOpen,initialValue:initialValue}){var _data$items,_data$total;const[darkMode]=Object(public_["useUiSetting$"])("theme:darkMode");const[popoverRef,setPopoverRef]=Object(external_kbnSharedDeps_React_["useState"])(null);const[searchRef,setSearchRef]=Object(external_kbnSharedDeps_React_["useState"])(null);const titleRef=Object(external_kbnSharedDeps_React_["useRef"])(null);const onEnterKey=evt=>{if(evt.key.toLowerCase()==="enter"){onTermChange();setPopoverIsOpen(false);if(searchRef){searchRef.blur()}}};useEvent_default()("keydown",onEnterKey,searchRef);const searchOnFocus=e=>{setPopoverIsOpen(true)};const onSearchInput=e=>{onInputChange(e);setPopoverIsOpen(true)};const searchOnBlur=e=>{if(!(popoverRef!==null&&popoverRef!==void 0&&popoverRef.contains(e.relatedTarget))&&!(popoverRef!==null&&popoverRef!==void 0&&popoverRef.contains(titleRef.current))){setPopoverIsOpen(false)}};const formattedOptions=formatOptions((_data$items=data.items)!==null&&_data$items!==void 0?_data$items:[]);const closePopover=()=>{setPopoverIsOpen(false);onClose();if(searchRef){searchRef.blur()}};Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(searchRef&&initialValue){searchRef.value=initialValue}},[searchRef]);const loadingMessage=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelectableMessage"],{style:{minHeight:300}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLoadingSpinner"],{size:"l"}),external_kbnSharedDeps_React_default.a.createElement("br",null),external_kbnSharedDeps_React_default.a.createElement("p",null,I18LABELS.loadingResults));const emptyMessage=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelectableMessage"],{style:{minHeight:300}},external_kbnSharedDeps_React_default.a.createElement("p",null,I18LABELS.noResults));const titleText=searchValue?I18LABELS.getSearchResultsLabel((_data$total=data===null||data===void 0?void 0:data.total)!==null&&_data$total!==void 0?_data$total:0):I18LABELS.topPages;function PopOverTitle(){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopoverTitle"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{ref:titleRef,gutterSize:"xs"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{style:{justifyContent:"center"}},loading?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLoadingSpinner"],null):titleText)))}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelectable"],{searchable:true,onChange:onChange,isLoading:loading,options:formattedOptions,renderOption:selectableRenderOptions,singleSelection:false,searchProps:{isClearable:true,onFocus:searchOnFocus,onBlur:searchOnBlur,onInput:onSearchInput,inputRef:setSearchRef,placeholder:I18LABELS.searchByUrl},listProps:{rowHeight:68,showIcons:true,onFocusBadge:false},loadingMessage:loadingMessage,emptyMessage:emptyMessage,noMatchesMessage:emptyMessage},(list,search)=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopover"],{panelPaddingSize:"none",isOpen:popoverIsOpen,display:"block",panelRef:setPopoverRef,button:search,closePopover:closePopover,style:{minWidth:200}},external_kbnSharedDeps_React_default.a.createElement("div",{style:{width:600,maxWidth:"100%"}},external_kbnSharedDeps_React_default.a.createElement(PopOverTitle,null),searchValue&&external_kbnSharedDeps_React_default.a.createElement(StyledRow,{darkMode:darkMode},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.apm.ux.url.hitEnter.include",defaultMessage:"Hit {icon} or click apply to include all urls matching {searchValue}",values:{searchValue:external_kbnSharedDeps_React_default.a.createElement("strong",null,searchValue),icon:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBadge"],{color:"hollow"},"Enter ",external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:"returnKey"}))}}))),list,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopoverFooter"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{style:{justifyContent:"flex-end"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{fill:true,size:"s",onClick:()=>{onTermChange();closePopover()}},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.apply.label",{defaultMessage:"Apply"}))))))))}function URLSearch({onChange:onFilterChange}){var _data$items,_data$total;const history=Object(external_kbnSharedDeps_ReactRouterDom_["useHistory"])();const{uiFilters:uiFilters,urlParams:urlParams}=Object(use_url_params["a"])();const{searchTerm:searchTerm,percentile:percentile}=urlParams;const[popoverIsOpen,setPopoverIsOpen]=Object(external_kbnSharedDeps_React_["useState"])(false);const[searchValue,setSearchValue]=Object(external_kbnSharedDeps_React_["useState"])(searchTerm!==null&&searchTerm!==void 0?searchTerm:"");const[debouncedValue,setDebouncedValue]=Object(external_kbnSharedDeps_React_["useState"])(searchTerm!==null&&searchTerm!==void 0?searchTerm:"");useDebounce_default()(()=>{setSearchValue(debouncedValue)},250,[debouncedValue]);const updateSearchTerm=Object(external_kbnSharedDeps_React_["useCallback"])(searchTermN=>{const newQuery={...Object(url_helpers["e"])(history.location.search),searchTerm:searchTermN||undefined};if(!searchTermN){delete newQuery.searchTerm}const newLocation={...history.location,search:Object(url_helpers["b"])(newQuery)};history.push(newLocation)},[history]);const[checkedUrls,setCheckedUrls]=Object(external_kbnSharedDeps_React_["useState"])([]);const uxQuery=useUxQuery();const{data:data,status:status}=Object(use_fetcher["b"])(callApmApi=>{if(uxQuery&&popoverIsOpen){const{transactionUrl:transactionUrl,...restFilters}=uiFilters;return callApmApi({endpoint:"GET /api/apm/rum-client/url-search",params:{query:{...uxQuery,uiFilters:JSON.stringify(restFilters),urlQuery:searchValue}}})}return Promise.resolve(null)},[uxQuery,searchValue,popoverIsOpen]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setCheckedUrls(uiFilters.transactionUrl||[])},[uiFilters]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(searchTerm&&searchValue===""){updateSearchTerm("")}},[searchValue,updateSearchTerm,searchTerm]);const onChange=updatedOptions=>{const clickedItems=updatedOptions.filter(option=>option.checked==="on");setCheckedUrls(clickedItems.map(item=>item.url))};const percTitle=getPercentileLabel(percentile);const items=((_data$items=data===null||data===void 0?void 0:data.items)!==null&&_data$items!==void 0?_data$items:[]).map(item=>({label:item.url,key:item.url,meta:[I18LABELS.pageViews+": "+item.count,I18LABELS.pageLoadDuration+": "+formatToSec(item.pld)+` (${percTitle})`],url:item.url,checked:checkedUrls!==null&&checkedUrls!==void 0&&checkedUrls.includes(item.url)?"on":undefined}));const onInputChange=e=>{setDebouncedValue(e.currentTarget.value)};const isLoading=status!=="success";const onTermChange=()=>{updateSearchTerm(searchValue)};const onClose=()=>{if(uiFilters.transactionUrl||checkedUrls.length>0){onFilterChange(checkedUrls)}};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xxxs",textTransform:"uppercase"},external_kbnSharedDeps_React_default.a.createElement("h4",null,I18LABELS.url)),external_kbnSharedDeps_React_default.a.createElement(SelectableUrlList,{initialValue:searchTerm,loading:isLoading,onInputChange:onInputChange,onTermChange:onTermChange,data:{items:items,total:(_data$total=data===null||data===void 0?void 0:data.total)!==null&&_data$total!==void 0?_data$total:0},onChange:onChange,onClose:onClose,searchValue:searchValue,popoverIsOpen:popoverIsOpen,setPopoverIsOpen:setPopoverIsOpen}))}const UrlList_BadgeText=external_kbnSharedDeps_StyledComponents_default.a.div.withConfig({displayName:"BadgeText",componentId:"go8jvw-0"})(["display:inline-block;",";vertical-align:middle;"],Object(variables["truncate"])(Object(variables["px"])(variables["unit"]*12)));const formatUrlValue=val=>{const maxUrlToDisplay=30;const urlLength=val.length;if(urlLength<maxUrlToDisplay){return val}const urlObj=new URL(val);if(urlObj.pathname==="/"){return val}const domainVal=urlObj.hostname;const extraLength=urlLength-maxUrlToDisplay;const extraDomain=domainVal.substring(0,extraLength);if(urlObj.pathname.length+7>maxUrlToDisplay){return val.replace(domainVal,"..")}return val.replace(extraDomain,"..")};const UrlList_removeFilterLabel=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.uifilter.badge.removeFilter",{defaultMessage:"Remove filter"});function UrlList({onRemove:onRemove,value:value}){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGrid"],{gutterSize:"s"},value.map(val=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{key:val,grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBadge"],{color:"hollow",onClick:()=>{onRemove(val)},onClickAriaLabel:UrlList_removeFilterLabel,iconOnClick:()=>{onRemove(val)},iconOnClickAriaLabel:UrlList_removeFilterLabel,iconType:"cross",iconSide:"right"},external_kbnSharedDeps_React_default.a.createElement(UrlList_BadgeText,null,formatUrlValue(val))))))}function URLFilter(){const history=Object(external_kbnSharedDeps_ReactRouterDom_["useHistory"])();const setFilterValue=(name,value)=>{const search=Object(external_kbnSharedDeps_Lodash_["omit"])(Object(url_helpers["e"])(history.location.search),name);history.push({...history.location,search:Object(url_helpers["b"])(Object(helpers["b"])({...search,[name]:value.length?value.join(","):undefined}))})};const name="transactionUrl";const{uiFilters:uiFilters}=Object(use_url_params["a"])();const{transactionUrl:transactionUrl}=uiFilters;const filterValue=transactionUrl!==null&&transactionUrl!==void 0?transactionUrl:[];return external_kbnSharedDeps_React_default.a.createElement("span",{"data-cy":"csmUrlFilter"},external_kbnSharedDeps_React_default.a.createElement(URLSearch,{onChange:value=>{setFilterValue("transactionUrl",value)}}),filterValue.length>0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(UrlList,{onRemove:val=>{setFilterValue(name,filterValue.filter(v=>val!==v))},value:filterValue})))}function RumDashboard_extends(){RumDashboard_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return RumDashboard_extends.apply(this,arguments)}function RumOverview(){Object(observability_public_["useTrackPageview"])({app:"ux",path:"home"});Object(observability_public_["useTrackPageview"])({app:"ux",path:"home",delay:15e3});const localUIFiltersConfig=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{const config={filterNames:["location","device","os","browser"]};return config},[]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:1},external_kbnSharedDeps_React_default.a.createElement(LocalUIFilters,RumDashboard_extends({},localUIFiltersConfig,{showCount:true}),external_kbnSharedDeps_React_default.a.createElement(URLFilter,null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:7},external_kbnSharedDeps_React_default.a.createElement(RumDashboard,null))))}var EnvironmentFilter=__webpack_require__(239);function ServiceNameFilter({loading:loading,serviceNames:serviceNames}){const history=Object(external_kbnSharedDeps_ReactRouterDom_["useHistory"])();const{urlParams:{serviceName:selectedServiceName}}=Object(use_url_params["a"])();const options=serviceNames.map(type=>({text:type,value:type}));const updateServiceName=Object(external_kbnSharedDeps_React_["useCallback"])((serviceN,replaceHistory)=>{const newLocation={...history.location,search:Object(url_helpers["b"])({...Object(url_helpers["e"])(history.location.search),serviceName:serviceN})};if(replaceHistory){history.replace(newLocation)}else{history.push(newLocation)}},[history]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if((serviceNames===null||serviceNames===void 0?void 0:serviceNames.length)>0){if(!selectedServiceName){updateServiceName(serviceNames[0],true)}if(selectedServiceName&&!serviceNames.includes(selectedServiceName)){updateServiceName(serviceNames[0],true)}}if(selectedServiceName&&serviceNames.length===0&&!loading){updateServiceName("")}},[serviceNames,selectedServiceName,updateServiceName,loading]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{prepend:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.ux.localFilters.titles.webApplication",{defaultMessage:"Web application"}),isLoading:loading,"data-cy":"serviceNameFilter",options:options,value:selectedServiceName,onChange:event=>{updateServiceName(event.target.value)}}))}var agent_name=__webpack_require__(58);const DEFAULT_P=50;function UserPercentile(){const history=Object(external_kbnSharedDeps_ReactRouterDom_["useHistory"])();const{urlParams:{percentile:percentile}}=Object(use_url_params["a"])();const updatePercentile=Object(external_kbnSharedDeps_React_["useCallback"])((percentileN,replaceHistory)=>{const newLocation={...history.location,search:Object(url_helpers["b"])({...Object(url_helpers["e"])(history.location.search),percentile:percentileN})};if(replaceHistory){history.replace(newLocation)}else{history.push(newLocation)}},[history]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(!percentile){updatePercentile(DEFAULT_P,true)}});const options=[{value:"50",text:I18LABELS.percentile50thMedian,"data-test-subj":"p50Percentile"},{value:"75",text:I18LABELS.percentile75th,"data-test-subj":"p75Percentile"},{value:"90",text:I18LABELS.percentile90th,"data-test-subj":"p90Percentile"},{value:"95",text:I18LABELS.percentile95th,"data-test-subj":"p95Percentile"},{value:"99",text:I18LABELS.percentile99th,"data-test-subj":"p99Percentile"}];const onChange=val=>{updatePercentile(Number(val))};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{prepend:I18LABELS.percentile,"data-test-subj":"uxPercentileSelect",style:{width:150},options:options,onChange:evt=>onChange(evt.target.value)})}function MainFilters(){const{urlParams:{start:start,end:end}}=Object(use_url_params["a"])();const{data:data,status:status}=Object(use_fetcher["b"])(callApmApi=>{if(start&&end){return callApmApi({endpoint:"GET /api/apm/rum-client/services",params:{query:{start:start,end:end,uiFilters:JSON.stringify({agentName:agent_name["b"]})}}})}},[start,end]);const{isSmall:isSmall}=Object(use_break_points["a"])();const envStyle=isSmall?{}:{maxWidth:200};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(ServiceNameFilter,{loading:status!=="success",serviceNames:data!==null&&data!==void 0?data:[]})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:envStyle},external_kbnSharedDeps_React_default.a.createElement(EnvironmentFilter["a"],null)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(UserPercentile,null)))}var DatePicker=__webpack_require__(169);const UX_LABEL=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.apm.ux.title",{defaultMessage:"User Experience"});function RumHome(){return external_kbnSharedDeps_React_default.a.createElement(CsmSharedContextProvider,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{wrap:true,justifyContent:"flexEnd",responsive:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],null,external_kbnSharedDeps_React_default.a.createElement("h1",{className:"eui-textNoWrap"},UX_LABEL))),external_kbnSharedDeps_React_default.a.createElement(MainFilters,null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(DatePicker["a"],null))),external_kbnSharedDeps_React_default.a.createElement(RumOverview,null))}var apm_plugin_context=__webpack_require__(167);var url_params_context=__webpack_require__(225);var use_breadcrumbs=__webpack_require__(571);var createCallApmApi=__webpack_require__(57);var index_pattern=__webpack_require__(572);const CsmMainContainer=common_["euiStyled"].div`
  padding: ${Object(variables["px"])(variables["units"].plus)};
  height: 100%;
`;const rumRoutes=[{exact:true,path:"/",render:Object(route_config["a"])("/ux"),breadcrumb:UX_LABEL}];function CsmApp(){const[darkMode]=Object(public_["useUiSetting$"])("theme:darkMode");Object(use_breadcrumbs["a"])(rumRoutes);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_StyledComponents_["ThemeProvider"],{theme:outerTheme=>({...outerTheme,eui:darkMode?external_kbnSharedDeps_Theme_euiDarkVars_default.a:external_kbnSharedDeps_Theme_euiLightVars_default.a,darkMode:darkMode})},external_kbnSharedDeps_React_default.a.createElement(CsmMainContainer,{"data-test-subj":"csmMainContainer",role:"main"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ReactRouterDom_["Route"],{component:ScrollToTopOnPathChange["a"]}),external_kbnSharedDeps_React_default.a.createElement(RumHome,null)))}function CsmAppRoot({appMountParameters:appMountParameters,core:core,deps:deps,config:config,corePlugins:{embeddable:embeddable,maps:maps}}){const{history:history}=appMountParameters;const i18nCore=core.i18n;const plugins={...deps,maps:maps};const apmPluginContextValue={appMountParameters:appMountParameters,config:config,core:core,plugins:plugins};return external_kbnSharedDeps_React_default.a.createElement(public_["RedirectAppLinks"],{application:core.application},external_kbnSharedDeps_React_default.a.createElement(apm_plugin_context["a"].Provider,{value:apmPluginContextValue},external_kbnSharedDeps_React_default.a.createElement(public_["KibanaContextProvider"],{services:{...core,...plugins,embeddable:embeddable}},external_kbnSharedDeps_React_default.a.createElement(i18nCore.Context,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ReactRouterDom_["Router"],{history:history},external_kbnSharedDeps_React_default.a.createElement(url_params_context["b"],null,external_kbnSharedDeps_React_default.a.createElement(CsmApp,null)))))))}const renderApp=(core,deps,appMountParameters,config,corePlugins)=>{const{element:element}=appMountParameters;Object(createCallApmApi["b"])(core.http);Object(index_pattern["a"])().catch(e=>{console.log("Error creating static index pattern",e)});external_kbnSharedDeps_ReactDom_default.a.render(external_kbnSharedDeps_React_default.a.createElement(CsmAppRoot,{appMountParameters:appMountParameters,core:core,deps:deps,config:config,corePlugins:corePlugins}),element);return()=>{external_kbnSharedDeps_ReactDom_default.a.unmountComponentAtNode(element)}}}}]);