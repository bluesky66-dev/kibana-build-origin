(window["data_bundle_jsonpfunction"]=window["data_bundle_jsonpfunction"]||[]).push([[9],{219:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",(function(){return QueryBarTopRow}));var elastic_datemath=__webpack_require__(18);var elastic_datemath_default=__webpack_require__.n(elastic_datemath);var classnames=__webpack_require__(214);var classnames_default=__webpack_require__.n(classnames);var external_kbnSharedDeps_React_=__webpack_require__(3);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(0);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(13);var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(44);var public_=__webpack_require__(23);var query_string_input=__webpack_require__(218);var common=__webpack_require__(1);var public_query=__webpack_require__(14);const NO_DATA_POPOVER_STORAGE_KEY="data.noDataPopover";function NoDataPopover({showNoDataPopover:showNoDataPopover,storage:storage,children:children}){const[noDataPopoverDismissed,setNoDataPopoverDismissed]=Object(external_kbnSharedDeps_React_["useState"])(()=>Boolean(storage.get(NO_DATA_POPOVER_STORAGE_KEY)));const[noDataPopoverVisible,setNoDataPopoverVisible]=Object(external_kbnSharedDeps_React_["useState"])(false);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(showNoDataPopover&&!noDataPopoverDismissed){setNoDataPopoverVisible(true)}},[noDataPopoverDismissed,showNoDataPopover]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTourStep"],{onFinish:()=>{},closePopover:()=>{setNoDataPopoverVisible(false)},content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("p",{style:{maxWidth:300}},external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.noDataPopover.content",{defaultMessage:"This time range doesn't contain any data. Increase or adjust the time range to see more fields and create charts."}))),minWidth:300,anchorPosition:"downCenter",anchorClassName:"eui-displayBlock",step:1,stepsTotal:1,isStepOpen:noDataPopoverVisible,subtitle:external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.noDataPopover.subtitle",{defaultMessage:"Tip"}),title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.noDataPopover.title",{defaultMessage:"Empty dataset"}),footerAction:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{size:"xs",flush:"right",color:"text","data-test-subj":"noDataPopoverDismissButton",onClick:()=>{storage.set(NO_DATA_POPOVER_STORAGE_KEY,true);setNoDataPopoverDismissed(true);setNoDataPopoverVisible(false)}},external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.noDataPopover.dismissAction",{defaultMessage:"Don't show again"}))},external_kbnSharedDeps_React_default.a.createElement("div",{onFocus:()=>{setNoDataPopoverVisible(false)}},children))}const QueryStringInput=Object(public_["withKibana"])(query_string_input["default"]);function QueryBarTopRow(props){const[isDateRangeInvalid,setIsDateRangeInvalid]=Object(external_kbnSharedDeps_React_["useState"])(false);const[isQueryInputFocused,setIsQueryInputFocused]=Object(external_kbnSharedDeps_React_["useState"])(false);const kibana=Object(public_["useKibana"])();const{uiSettings:uiSettings,notifications:notifications,storage:storage,appName:appName,docLinks:docLinks}=kibana.services;const kueryQuerySyntaxLink=docLinks.links.query.kueryQuerySyntax;const queryLanguage=props.query&&props.query.language;const persistedLog=external_kbnSharedDeps_React_default.a.useMemo(()=>queryLanguage&&uiSettings&&storage&&appName?Object(public_query["v"])(uiSettings,storage,appName,queryLanguage):undefined,[appName,queryLanguage,uiSettings,storage]);function onClickSubmitButton(event){if(persistedLog&&props.query){persistedLog.add(props.query.query)}event.preventDefault();onSubmit({query:props.query,dateRange:getDateRange()})}function getDateRange(){const defaultTimeSetting=uiSettings.get(common["UI_SETTINGS"].TIMEPICKER_TIME_DEFAULTS);return{from:props.dateRangeFrom||defaultTimeSetting.from,to:props.dateRangeTo||defaultTimeSetting.to}}function onQueryChange(query){props.onChange({query:query,dateRange:getDateRange()})}function onChangeQueryInputFocus(isFocused){setIsQueryInputFocused(isFocused)}function onTimeChange({start:start,end:end,isInvalid:isInvalid,isQuickSelection:isQuickSelection}){setIsDateRangeInvalid(isInvalid);const retVal={query:props.query,dateRange:{from:start,to:end}};if(isQuickSelection){props.onSubmit(retVal)}else{props.onChange(retVal)}}function onRefresh({start:start,end:end}){const retVal={dateRange:{from:start,to:end}};if(props.onRefresh){props.onRefresh(retVal)}}function onSubmit({query:query,dateRange:dateRange}){handleLuceneSyntaxWarning();if(props.timeHistory){props.timeHistory.add(dateRange)}props.onSubmit({query:query,dateRange:dateRange})}function onInputSubmit(query){onSubmit({query:query,dateRange:getDateRange()})}function toAbsoluteString(value,roundUp=false){const valueAsMoment=elastic_datemath_default.a.parse(value,{roundUp:roundUp});if(!valueAsMoment){return value}return valueAsMoment.toISOString()}function renderQueryInput(){if(!shouldRenderQueryInput())return;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(QueryStringInput,{disableAutoFocus:props.disableAutoFocus,indexPatterns:props.indexPatterns,prepend:props.prepend,query:props.query,screenTitle:props.screenTitle,onChange:onQueryChange,onChangeQueryInputFocus:onChangeQueryInputFocus,onSubmit:onInputSubmit,persistedLog:persistedLog,dataTestSubj:props.dataTestSubj}))}function renderSharingMetaFields(){const{from:from,to:to}=getDateRange();const dateRangePretty=Object(external_kbnSharedDeps_ElasticEui_["prettyDuration"])(toAbsoluteString(from),toAbsoluteString(to),[],uiSettings.get("dateFormat"));return external_kbnSharedDeps_React_default.a.createElement("div",{"data-shared-timefilter-duration":dateRangePretty,"data-test-subj":"dataSharedTimefilterDuration"})}function shouldRenderDatePicker(){return Boolean(props.showDatePicker||props.showAutoRefreshOnly)}function shouldRenderQueryInput(){return Boolean(props.showQueryInput&&props.indexPatterns&&props.query&&storage)}function renderUpdateButton(){const button=props.customSubmitButton?external_kbnSharedDeps_React_default.a.cloneElement(props.customSubmitButton,{onClick:onClickSubmitButton}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSuperUpdateButton"],{needsUpdate:props.isDirty,isDisabled:isDateRangeInvalid,isLoading:props.isLoading,onClick:onClickSubmitButton,"data-test-subj":"querySubmitButton"});if(!shouldRenderDatePicker()){return button}return external_kbnSharedDeps_React_default.a.createElement(NoDataPopover,{storage:storage,showNoDataPopover:props.indicateNoData},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{responsive:false,gutterSize:"s"},renderDatePicker(),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},button)))}function renderDatePicker(){if(!shouldRenderDatePicker()){return null}let recentlyUsedRanges;if(props.timeHistory){recentlyUsedRanges=props.timeHistory.get().map(({from:from,to:to})=>({start:from,end:to}))}const commonlyUsedRanges=uiSettings.get(common["UI_SETTINGS"].TIMEPICKER_QUICK_RANGES).map(({from:from,to:to,display:display})=>({start:from,end:to,label:display}));const wrapperClasses=classnames_default()("kbnQueryBar__datePickerWrapper",{"kbnQueryBar__datePickerWrapper-isHidden":isQueryInputFocused});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{className:wrapperClasses},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSuperDatePicker"],{start:props.dateRangeFrom,end:props.dateRangeTo,isPaused:props.isRefreshPaused,refreshInterval:props.refreshInterval,onTimeChange:onTimeChange,onRefresh:onRefresh,onRefreshChange:props.onRefreshChange,showUpdateButton:false,recentlyUsedRanges:recentlyUsedRanges,commonlyUsedRanges:commonlyUsedRanges,dateFormat:uiSettings.get("dateFormat"),isAutoRefreshOnly:props.showAutoRefreshOnly,className:"kbnQueryBar__datePicker"}))}function handleLuceneSyntaxWarning(){if(!props.query)return;const{query:query,language:language}=props.query;if(language==="kuery"&&typeof query==="string"&&(!storage||!storage.get("kibana.luceneSyntaxWarningOptOut"))&&Object(common["doesKueryExpressionHaveLuceneSyntaxError"])(query)){const toast=notifications.toasts.addWarning({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.query.queryBar.luceneSyntaxWarningTitle",{defaultMessage:"Lucene syntax warning"}),text:Object(public_["toMountPoint"])(external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"data.query.queryBar.luceneSyntaxWarningMessage",defaultMessage:"It looks like you may be trying to use Lucene query syntax, although you have Kibana Query Language (KQL) selected. Please review the KQL docs {link}.",values:{link:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{href:kueryQuerySyntaxLink,target:"_blank"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"data.query.queryBar.syntaxOptionsDescription.docsLinkText",defaultMessage:"here"}))}})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"flexEnd",gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{size:"s",onClick:()=>onLuceneSyntaxWarningOptOut(toast)},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"data.query.queryBar.luceneSyntaxWarningOptOutText",defaultMessage:"Don't show again"}))))))})}}function onLuceneSyntaxWarningOptOut(toast){if(!storage)return;storage.set("kibana.luceneSyntaxWarningOptOut",true);notifications.toasts.remove(toast)}const classes=classnames_default()("kbnQueryBar",{"kbnQueryBar--withDatePicker":props.showDatePicker});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{className:classes,responsive:!!props.showDatePicker,gutterSize:"s",justifyContent:"flexEnd"},renderQueryInput(),renderSharingMetaFields(),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},renderUpdateButton()))}QueryBarTopRow.defaultProps={showQueryInput:true,showDatePicker:true,showAutoRefreshOnly:false}}}]);