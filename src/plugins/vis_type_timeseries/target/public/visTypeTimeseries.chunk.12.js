(window["visTypeTimeseries_bundle_jsonpfunction"]=window["visTypeTimeseries_bundle_jsonpfunction"]||[]).push([[12],{352:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",(function(){return TopNVisualization}));var services=__webpack_require__(0);var tick_formatter=__webpack_require__(46);var external_kbnSharedDeps_React_=__webpack_require__(1);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(3);var get_last_value=__webpack_require__(48);var label_date_formatter=__webpack_require__(54);var lib=__webpack_require__(88);var lib_default=__webpack_require__.n(lib);function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const RENDER_MODES={POSITIVE:"positive",NEGATIVE:"negative",MIXED:"mixed"};class top_n_TopN extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);this.tableRef=external_kbnSharedDeps_React_default.a.createRef();this.state={labelMaxWidth:150}}get labelMaxWidth(){return this.tableRef.current.offsetWidth*.35}componentDidMount(){this.setState({labelMaxWidth:this.labelMaxWidth})}componentDidUpdate(prevProps,prevState){if(prevState.labelMaxWidth!==this.labelMaxWidth){this.setState({labelMaxWidth:this.labelMaxWidth})}}handleClick(item){return()=>{if(this.props.onClick){this.props.onClick(item)}}}renderRow({min:min,max:max}){return item=>{const renderMode=top_n_TopN.getRenderMode(min,max);const key=`${item.id||item.label}`;const lastValue=Object(get_last_value["a"])(item.data);const formatter=item.tickFormatter||this.props.tickFormatter;const isPositiveValue=lastValue>=0;const intervalLength=top_n_TopN.calcDomain(renderMode,min,max);const width=100*(Math.abs(lastValue)/intervalLength)||0;const label=item.labelFormatted?Object(label_date_formatter["a"])(item.labelFormatted):item.label;const styles=lib_default()({default:{innerBar:{...top_n_TopN.calcInnerBarStyles(renderMode,isPositiveValue)},innerBarValue:{...top_n_TopN.calcInnerBarDivStyles(item,width,isPositiveValue)},label:{maxWidth:this.state.labelMaxWidth}},onClick:{row:{cursor:"pointer"}}},this.props);return external_kbnSharedDeps_React_default.a.createElement("tr",{key:key,onClick:this.handleClick({lastValue:lastValue,...item}),style:styles.row},external_kbnSharedDeps_React_default.a.createElement("td",{title:item.label,className:"tvbVisTopN__label",style:styles.label},label||external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeTimeseries.emptyTextValue",{defaultMessage:"(empty)"})),external_kbnSharedDeps_React_default.a.createElement("td",{width:"100%",className:"tvbVisTopN__bar"},external_kbnSharedDeps_React_default.a.createElement("div",{className:"tvbVisTopN__innerBar",style:styles.innerBar},external_kbnSharedDeps_React_default.a.createElement("div",{style:styles.innerBarValue}))),external_kbnSharedDeps_React_default.a.createElement("td",{className:"tvbVisTopN__value","data-test-subj":"tsvbTopNValue"},formatter(lastValue)))}}render(){if(!this.props.series)return null;const intervalSettings=this.props.series.reduce((acc,series,index)=>{const value=Object(get_last_value["a"])(series.data);return{min:!index||value<acc.min?value:acc.min,max:!index||value>acc.max?value:acc.max}},{min:undefined,max:undefined});const rows=this.props.series.map(this.renderRow(intervalSettings));let className="tvbVisTopN";if(this.props.reversed){className+=" tvbVisTopN--reversed"}return external_kbnSharedDeps_React_default.a.createElement("div",{className:className},external_kbnSharedDeps_React_default.a.createElement("table",{className:"tvbVisTopN__table","data-test-subj":"tvbVisTopNTable",ref:this.tableRef},external_kbnSharedDeps_React_default.a.createElement("tbody",null,rows)))}}_defineProperty(top_n_TopN,"getRenderMode",(min,max)=>{if(min>=0){return RENDER_MODES.POSITIVE}else if(max<0){return RENDER_MODES.NEGATIVE}return RENDER_MODES.MIXED});_defineProperty(top_n_TopN,"calcInnerBarStyles",(renderMode,isPositive)=>{if(renderMode===RENDER_MODES.MIXED){return{[isPositive?"marginLeft":"marginRight"]:"50%"}}return{}});_defineProperty(top_n_TopN,"calcInnerBarDivStyles",(item,width,isPositive)=>({backgroundColor:item.color,width:width+"%",float:isPositive?"left":"right"}));_defineProperty(top_n_TopN,"calcDomain",(renderMode,min,max)=>{if(renderMode===RENDER_MODES.MIXED){return Math.max(max,Math.abs(min))}else if(renderMode===RENDER_MODES.NEGATIVE){return Math.abs(min)}return max});top_n_TopN.defaultProps={tickFormatter:n=>n,onClick:i=>i,direction:"desc"};var set_is_reversed=__webpack_require__(75);var replace_vars=__webpack_require__(57);var external_kbnSharedDeps_Lodash_=__webpack_require__(31);const OPERATORS={gt:external_kbnSharedDeps_Lodash_["gt"],gte:external_kbnSharedDeps_Lodash_["gte"],lt:external_kbnSharedDeps_Lodash_["lt"],lte:external_kbnSharedDeps_Lodash_["lte"]};function sortByDirection(data,direction,fn){if(direction==="desc"){return Object(external_kbnSharedDeps_Lodash_["sortBy"])(data,fn).reverse()}return Object(external_kbnSharedDeps_Lodash_["sortBy"])(data,fn)}function sortSeries(visData,model){const series=Object(external_kbnSharedDeps_Lodash_["get"])(visData,`${model.id}.series`,[]);return model.series.reduce((acc,item)=>{const itemSeries=series.filter(s=>{const id=Object(external_kbnSharedDeps_Lodash_["first"])(s.id.split(/:/));return id===item.id});const direction=item.terms_direction||"desc";if(item.terms_order_by==="_key")return acc.concat(itemSeries);return acc.concat(sortByDirection(itemSeries,direction,s=>Object(get_last_value["a"])(s.data)))},[])}function TopNVisualization(props){const{backgroundColor:backgroundColor,model:model,visData:visData}=props;const series=sortSeries(visData,model).map(item=>{const id=Object(external_kbnSharedDeps_Lodash_["first"])(item.id.split(/:/));const seriesConfig=model.series.find(s=>s.id===id);if(seriesConfig){const tickFormatter=Object(tick_formatter["a"])(seriesConfig.formatter,seriesConfig.value_template,props.getConfig);const value=Object(get_last_value["a"])(item.data);let color=item.color||seriesConfig.color;if(model.bar_color_rules){model.bar_color_rules.forEach(rule=>{if(rule.operator&&rule.value!=null&&rule.bar_color){if(OPERATORS[rule.operator](value,rule.value)){color=rule.bar_color}}})}return{...item,color:color,tickFormatter:tickFormatter}}return item});const panelBackgroundColor=model.background_color||backgroundColor;const style={backgroundColor:panelBackgroundColor};const params={series:series,reversed:Object(set_is_reversed["b"])(panelBackgroundColor)};if(model.drilldown_url){params.onClick=item=>{const url=Object(replace_vars["a"])(model.drilldown_url,{},{key:item.label});Object(services["b"])().application.navigateToUrl(url)}}return external_kbnSharedDeps_React_default.a.createElement("div",{className:"tvbVis",style:style},external_kbnSharedDeps_React_default.a.createElement(top_n_TopN,params))}},57:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return replaceVars}));var lodash__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(31);var lodash__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);var handlebars_dist_handlebars__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(65);var handlebars_dist_handlebars__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(handlebars_dist_handlebars__WEBPACK_IMPORTED_MODULE_1__);var _kbn_i18n__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(3);var _kbn_i18n__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_kbn_i18n__WEBPACK_IMPORTED_MODULE_2__);function replaceVars(str,args={},vars={}){try{const template=handlebars_dist_handlebars__WEBPACK_IMPORTED_MODULE_1___default.a.compile(str,{strict:true,knownHelpersOnly:true});const string=template(lodash__WEBPACK_IMPORTED_MODULE_0___default.a.assign({},vars,{args:args}));return string}catch(e){if(e.toString().indexOf("Parse error")!==-1){return str}else if(e.message.indexOf("not defined in")!==-1){const badVar=e.message.split(/"/)[1];e.error={caused_by:{reason:_kbn_i18n__WEBPACK_IMPORTED_MODULE_2__["i18n"].translate("visTypeTimeseries.replaceVars.errors.unknownVarDescription",{defaultMessage:"{badVar} is an unknown variable",values:{badVar:"{{"+badVar+"}}"}}),title:_kbn_i18n__WEBPACK_IMPORTED_MODULE_2__["i18n"].translate("visTypeTimeseries.replaceVars.errors.unknownVarTitle",{defaultMessage:"Error processing your markdown"})}}}else{e.error={caused_by:{reason:_kbn_i18n__WEBPACK_IMPORTED_MODULE_2__["i18n"].translate("visTypeTimeseries.replaceVars.errors.markdownErrorDescription",{defaultMessage:"Please verify you are only using markdown, known variables, and built-in Handlebars expressions"}),title:_kbn_i18n__WEBPACK_IMPORTED_MODULE_2__["i18n"].translate("visTypeTimeseries.replaceVars.errors.markdownErrorTitle",{defaultMessage:"Error processing your markdown"})}}}return e}}}}]);