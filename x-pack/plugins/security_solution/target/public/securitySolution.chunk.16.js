/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window["securitySolution_bundle_jsonpfunction"]=window["securitySolution_bundle_jsonpfunction"]||[]).push([[16],{1172:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",(function(){return ServiceNowITSMFieldsComponent}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(6);var react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);var _elastic_eui__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(72);var _elastic_eui__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_elastic_eui__WEBPACK_IMPORTED_MODULE_1__);var _translations__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(24);var _case_common_api_connectors__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(10);var _common_lib_kibana__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(104);var _card__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(251);var _use_get_choices__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(516);var _helpers__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(503);const useGetChoicesFields=["urgency","severity","impact","category","subcategory"];const defaultFields={urgency:[],severity:[],impact:[],category:[],subcategory:[]};const ServiceNowITSMFieldsComponent=({isEdit:isEdit=true,fields:fields,connector:connector,onChange:onChange})=>{const init=Object(react__WEBPACK_IMPORTED_MODULE_0__["useRef"])(true);const{severity:severity=null,urgency:urgency=null,impact:impact=null,category:category=null,subcategory:subcategory=null}=fields!==null&&fields!==void 0?fields:{};const{http:http,notifications:notifications}=Object(_common_lib_kibana__WEBPACK_IMPORTED_MODULE_4__["h"])().services;const[choices,setChoices]=Object(react__WEBPACK_IMPORTED_MODULE_0__["useState"])(defaultFields);const categoryOptions=Object(react__WEBPACK_IMPORTED_MODULE_0__["useMemo"])(()=>Object(_helpers__WEBPACK_IMPORTED_MODULE_7__["a"])(choices.category),[choices.category]);const urgencyOptions=Object(react__WEBPACK_IMPORTED_MODULE_0__["useMemo"])(()=>Object(_helpers__WEBPACK_IMPORTED_MODULE_7__["a"])(choices.urgency),[choices.urgency]);const severityOptions=Object(react__WEBPACK_IMPORTED_MODULE_0__["useMemo"])(()=>Object(_helpers__WEBPACK_IMPORTED_MODULE_7__["a"])(choices.severity),[choices.severity]);const impactOptions=Object(react__WEBPACK_IMPORTED_MODULE_0__["useMemo"])(()=>Object(_helpers__WEBPACK_IMPORTED_MODULE_7__["a"])(choices.impact),[choices.impact]);const subcategoryOptions=Object(react__WEBPACK_IMPORTED_MODULE_0__["useMemo"])(()=>Object(_helpers__WEBPACK_IMPORTED_MODULE_7__["a"])(choices.subcategory.filter(choice=>choice.dependent_value===category)),[choices.subcategory,category]);const listItems=Object(react__WEBPACK_IMPORTED_MODULE_0__["useMemo"])(()=>{var _urgencyOptions$find,_severityOptions$find,_impactOptions$find,_categoryOptions$find,_subcategoryOptions$f;return[...urgency!=null&&urgency.length>0?[{title:_translations__WEBPACK_IMPORTED_MODULE_2__["m"],description:(_urgencyOptions$find=urgencyOptions.find(option=>`${option.value}`===urgency))===null||_urgencyOptions$find===void 0?void 0:_urgencyOptions$find.text}]:[],...severity!=null&&severity.length>0?[{title:_translations__WEBPACK_IMPORTED_MODULE_2__["j"],description:(_severityOptions$find=severityOptions.find(option=>`${option.value}`===severity))===null||_severityOptions$find===void 0?void 0:_severityOptions$find.text}]:[],...impact!=null&&impact.length>0?[{title:_translations__WEBPACK_IMPORTED_MODULE_2__["f"],description:(_impactOptions$find=impactOptions.find(option=>`${option.value}`===impact))===null||_impactOptions$find===void 0?void 0:_impactOptions$find.text}]:[],...category!=null&&category.length>0?[{title:_translations__WEBPACK_IMPORTED_MODULE_2__["c"],description:(_categoryOptions$find=categoryOptions.find(option=>`${option.value}`===category))===null||_categoryOptions$find===void 0?void 0:_categoryOptions$find.text}]:[],...subcategory!=null&&subcategory.length>0?[{title:_translations__WEBPACK_IMPORTED_MODULE_2__["l"],description:(_subcategoryOptions$f=subcategoryOptions.find(option=>`${option.value}`===subcategory))===null||_subcategoryOptions$f===void 0?void 0:_subcategoryOptions$f.text}]:[]]},[category,categoryOptions,impact,impactOptions,severity,severityOptions,subcategory,subcategoryOptions,urgency,urgencyOptions]);const onChoicesSuccess=values=>{setChoices(values.reduce((acc,value)=>({...acc,[value.element]:[...acc[value.element]!=null?acc[value.element]:[],value]}),defaultFields))};const{isLoading:isLoadingChoices}=Object(_use_get_choices__WEBPACK_IMPORTED_MODULE_6__["a"])({http:http,toastNotifications:notifications.toasts,connector:connector,fields:useGetChoicesFields,onSuccess:onChoicesSuccess});const onChangeCb=Object(react__WEBPACK_IMPORTED_MODULE_0__["useCallback"])((key,value)=>{onChange({...fields,[key]:value})},[fields,onChange]);Object(react__WEBPACK_IMPORTED_MODULE_0__["useEffect"])(()=>{if(init.current){init.current=false;onChange({urgency:urgency,severity:severity,impact:impact,category:category,subcategory:subcategory})}},[category,impact,onChange,severity,subcategory,urgency]);return isEdit?react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div",{"data-test-subj":"connector-fields-sn-itsm"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_1__["EuiFormRow"],{fullWidth:true,label:_translations__WEBPACK_IMPORTED_MODULE_2__["m"]},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_1__["EuiSelect"],{fullWidth:true,"data-test-subj":"urgencySelect",options:urgencyOptions,value:urgency!==null&&urgency!==void 0?urgency:undefined,isLoading:isLoadingChoices,disabled:isLoadingChoices,hasNoInitialSelection:true,onChange:e=>onChangeCb("urgency",e.target.value)})),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_1__["EuiSpacer"],{size:"m"}),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_1__["EuiFlexGroup"],null,react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_1__["EuiFlexItem"],null,react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_1__["EuiFormRow"],{fullWidth:true,label:_translations__WEBPACK_IMPORTED_MODULE_2__["j"]},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_1__["EuiSelect"],{fullWidth:true,"data-test-subj":"severitySelect",options:severityOptions,value:severity!==null&&severity!==void 0?severity:undefined,isLoading:isLoadingChoices,disabled:isLoadingChoices,hasNoInitialSelection:true,onChange:e=>onChangeCb("severity",e.target.value)}))),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_1__["EuiFlexItem"],null,react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_1__["EuiFormRow"],{fullWidth:true,label:_translations__WEBPACK_IMPORTED_MODULE_2__["f"]},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_1__["EuiSelect"],{fullWidth:true,"data-test-subj":"impactSelect",options:impactOptions,value:impact!==null&&impact!==void 0?impact:undefined,isLoading:isLoadingChoices,disabled:isLoadingChoices,hasNoInitialSelection:true,onChange:e=>onChangeCb("impact",e.target.value)})))),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_1__["EuiFlexGroup"],null,react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_1__["EuiFlexItem"],null,react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_1__["EuiFormRow"],{fullWidth:true,label:_translations__WEBPACK_IMPORTED_MODULE_2__["c"]},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_1__["EuiSelect"],{fullWidth:true,"data-test-subj":"categorySelect",options:categoryOptions,value:category!==null&&category!==void 0?category:undefined,isLoading:isLoadingChoices,disabled:isLoadingChoices,hasNoInitialSelection:true,onChange:e=>onChange({...fields,category:e.target.value,subcategory:null})}))),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_1__["EuiFlexItem"],null,react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_1__["EuiFormRow"],{fullWidth:true,label:_translations__WEBPACK_IMPORTED_MODULE_2__["l"]},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_1__["EuiSelect"],{fullWidth:true,"data-test-subj":"subcategorySelect",options:subcategoryOptions,value:subcategory!==null&&subcategory!==void 0?subcategory:"",isLoading:isLoadingChoices,disabled:isLoadingChoices,hasNoInitialSelection:true,onChange:e=>onChangeCb("subcategory",e.target.value)}))))):react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_card__WEBPACK_IMPORTED_MODULE_5__["a"],{connectorType:_case_common_api_connectors__WEBPACK_IMPORTED_MODULE_3__["c"].serviceNowITSM,title:connector.name,listItems:listItems,isLoading:false})}},251:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return ConnectorCard}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(6);var react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);var _elastic_eui__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(72);var _elastic_eui__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_elastic_eui__WEBPACK_IMPORTED_MODULE_1__);var styled_components__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(73);var styled_components__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(styled_components__WEBPACK_IMPORTED_MODULE_2__);var ___WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(40);const StyledText=styled_components__WEBPACK_IMPORTED_MODULE_2___default.a.span.withConfig({displayName:"StyledText",componentId:"sc-15m9dva-0"})(["span{display:block;}"]);const ConnectorCardDisplay=({connectorType:connectorType,title:title,listItems:listItems,isLoading:isLoading})=>{const description=Object(react__WEBPACK_IMPORTED_MODULE_0__["useMemo"])(()=>react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(StyledText,null,listItems.length>0&&listItems.map((item,i)=>react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("span",{"data-test-subj":"card-list-item",key:`${item.title}-${i}`},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("strong",null,`${item.title}: `),item.description))),[listItems]);const icon=Object(react__WEBPACK_IMPORTED_MODULE_0__["useMemo"])(()=>{var _connectorsConfigurat,_connectorsConfigurat2;return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_1__["EuiIcon"],{size:"xl",type:(_connectorsConfigurat=(_connectorsConfigurat2=___WEBPACK_IMPORTED_MODULE_3__["a"][`${connectorType}`])===null||_connectorsConfigurat2===void 0?void 0:_connectorsConfigurat2.logo)!==null&&_connectorsConfigurat!==void 0?_connectorsConfigurat:""})},[connectorType]);return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_0___default.a.Fragment,null,isLoading&&react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_1__["EuiLoadingSpinner"],{"data-test-subj":"connector-card-loading"}),!isLoading&&react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_1__["EuiCard"],{"data-test-subj":`connector-card`,description:description,display:"plain",icon:icon,layout:"horizontal",paddingSize:"none",title:title,titleSize:"xs"}))};const ConnectorCard=Object(react__WEBPACK_IMPORTED_MODULE_0__["memo"])(ConnectorCardDisplay)},503:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return choicesToEuiOptions}));const choicesToEuiOptions=choices=>choices.map(choice=>({value:choice.value,text:choice.label}))},516:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return useGetChoices}));var external_kbnSharedDeps_React_=__webpack_require__(6);const BASE_ACTION_API_PATH="/api/actions";async function getChoices({http:http,signal:signal,connectorId:connectorId,fields:fields}){return http.post(`${BASE_ACTION_API_PATH}/action/${connectorId}/_execute`,{body:JSON.stringify({params:{subAction:"getChoices",subActionParams:{fields:fields}}}),signal:signal})}var translations=__webpack_require__(24);const useGetChoices=({http:http,connector:connector,toastNotifications:toastNotifications,fields:fields,onSuccess:onSuccess})=>{const[isLoading,setIsLoading]=Object(external_kbnSharedDeps_React_["useState"])(false);const[choices,setChoices]=Object(external_kbnSharedDeps_React_["useState"])([]);const didCancel=Object(external_kbnSharedDeps_React_["useRef"])(false);const abortCtrl=Object(external_kbnSharedDeps_React_["useRef"])(new AbortController);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const fetchData=async()=>{if(!connector){setIsLoading(false);return}try{abortCtrl.current=new AbortController;setIsLoading(true);const res=await getChoices({http:http,signal:abortCtrl.current.signal,connectorId:connector.id,fields:fields});if(!didCancel.current){var _res$data;setIsLoading(false);setChoices((_res$data=res.data)!==null&&_res$data!==void 0?_res$data:[]);if(res.status&&res.status==="error"){var _res$serviceMessage;toastNotifications.addDanger({title:translations["d"],text:`${(_res$serviceMessage=res.serviceMessage)!==null&&_res$serviceMessage!==void 0?_res$serviceMessage:res.message}`})}else if(onSuccess){var _res$data2;onSuccess((_res$data2=res.data)!==null&&_res$data2!==void 0?_res$data2:[])}}}catch(error){if(!didCancel.current){setIsLoading(false);if(error.name!=="AbortError"){toastNotifications.addDanger({title:translations["d"],text:error.message})}}}};didCancel.current=false;abortCtrl.current.abort();fetchData();return()=>{didCancel.current=true;abortCtrl.current.abort()}},[http,connector,toastNotifications,fields]);return{choices:choices,isLoading:isLoading}}}}]);