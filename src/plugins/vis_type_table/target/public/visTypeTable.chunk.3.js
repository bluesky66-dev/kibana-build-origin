(window["visTypeTable_bundle_jsonpfunction"]=window["visTypeTable_bundle_jsonpfunction"]||[]).push([[3],{24:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return VIS_TYPE_TABLE}));__webpack_require__.d(__webpack_exports__,"a",(function(){return AggTypes}));const VIS_TYPE_TABLE="table";let AggTypes;(function(AggTypes){AggTypes["SUM"]="sum";AggTypes["AVG"]="avg";AggTypes["MIN"]="min";AggTypes["MAX"]="max";AggTypes["COUNT"]="count"})(AggTypes||(AggTypes={}))},25:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return TableOptions}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5);var react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);var _elastic_eui__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(8);var _elastic_eui__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_elastic_eui__WEBPACK_IMPORTED_MODULE_1__);const TableOptionsComponent=Object(react__WEBPACK_IMPORTED_MODULE_0__["lazy"])(()=>__webpack_require__.e(5).then(__webpack_require__.bind(null,28)));const TableOptions=props=>react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_0__["Suspense"],{fallback:react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_1__["EuiLoadingSpinner"],null)},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(TableOptionsComponent,props))},26:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return toExpressionAst}));var _expressions_public__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(13);var _expressions_public__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_expressions_public__WEBPACK_IMPORTED_MODULE_0__);var _visualizations_public__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(9);var _visualizations_public__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_visualizations_public__WEBPACK_IMPORTED_MODULE_1__);const buildTableVisConfig=(schemas,visParams)=>{const metrics=schemas.metric;const buckets=schemas.bucket||[];const visConfig={dimensions:{metrics:metrics,buckets:buckets,splitRow:schemas.split_row,splitColumn:schemas.split_column}};if(visParams.showPartialRows&&!visParams.showMetricsAtAllLevels){const metricsPerBucket=metrics.length/buckets.length;visConfig.dimensions.metrics.splice(0,metricsPerBucket*buckets.length-metricsPerBucket)}return visConfig};const toExpressionAst=(vis,params)=>{const esaggs=Object(_expressions_public__WEBPACK_IMPORTED_MODULE_0__["buildExpressionFunction"])("esaggs",{index:Object(_expressions_public__WEBPACK_IMPORTED_MODULE_0__["buildExpression"])([Object(_expressions_public__WEBPACK_IMPORTED_MODULE_0__["buildExpressionFunction"])("indexPatternLoad",{id:vis.data.indexPattern.id})]),metricsAtAllLevels:vis.isHierarchical(),partialRows:vis.params.showPartialRows,aggs:vis.data.aggs.aggs.map(agg=>Object(_expressions_public__WEBPACK_IMPORTED_MODULE_0__["buildExpression"])(agg.toExpressionAst()))});const schemas=Object(_visualizations_public__WEBPACK_IMPORTED_MODULE_1__["getVisSchemas"])(vis,params);const visConfig={...vis.params,...buildTableVisConfig(schemas,vis.params),title:vis.title};const table=Object(_expressions_public__WEBPACK_IMPORTED_MODULE_0__["buildExpressionFunction"])("kibana_table",{visConfig:JSON.stringify(visConfig)});const ast=Object(_expressions_public__WEBPACK_IMPORTED_MODULE_0__["buildExpression"])([esaggs,table]);return ast.toAst()}},27:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return usePagination}));__webpack_require__.d(__webpack_exports__,"c",(function(){return useUiState}));__webpack_require__.d(__webpack_exports__,"a",(function(){return tableVisResponseHandler}));var external_kbnSharedDeps_React_=__webpack_require__(5);const usePagination=(visParams,rowCount)=>{const[pagination,setPagination]=Object(external_kbnSharedDeps_React_["useState"])({pageIndex:0,pageSize:visParams.perPage||0});const onChangeItemsPerPage=Object(external_kbnSharedDeps_React_["useCallback"])(pageSize=>setPagination(pag=>({...pag,pageSize:pageSize,pageIndex:0})),[]);const onChangePage=Object(external_kbnSharedDeps_React_["useCallback"])(pageIndex=>setPagination(pag=>({...pag,pageIndex:pageIndex})),[]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const pageSize=visParams.perPage||0;const lastPageIndex=Math.ceil(rowCount/pageSize)-1;setPagination(pag=>({pageIndex:pag.pageIndex>lastPageIndex?lastPageIndex:pag.pageIndex,pageSize:pageSize}))},[visParams.perPage,rowCount]);const paginationMemoized=Object(external_kbnSharedDeps_React_["useMemo"])(()=>pagination.pageSize?{...pagination,onChangeItemsPerPage:onChangeItemsPerPage,onChangePage:onChangePage}:undefined,[onChangeItemsPerPage,onChangePage,pagination]);return paginationMemoized};var external_kbnSharedDeps_Lodash_=__webpack_require__(7);const defaultSort={columnIndex:null,direction:null};const useUiState=uiState=>{const[sort,setSortState]=Object(external_kbnSharedDeps_React_["useState"])((uiState===null||uiState===void 0?void 0:uiState.get("vis.params.sort"))||defaultSort);const[columnsWidth,setColumnsWidthState]=Object(external_kbnSharedDeps_React_["useState"])((uiState===null||uiState===void 0?void 0:uiState.get("vis.params.colWidth"))||[]);const uiStateValues=Object(external_kbnSharedDeps_React_["useRef"])({columnsWidth:uiState===null||uiState===void 0?void 0:uiState.get("vis.params.colWidth"),sort:uiState===null||uiState===void 0?void 0:uiState.get("vis.params.sort"),pendingUpdate:false});const setSort=Object(external_kbnSharedDeps_React_["useCallback"])((s=defaultSort)=>{setSortState(s||defaultSort);uiStateValues.current.sort=s;uiStateValues.current.pendingUpdate=true;setTimeout(()=>{uiState===null||uiState===void 0?void 0:uiState.set("vis.params.sort",s);uiStateValues.current.pendingUpdate=false})},[uiState]);const setColumnsWidth=Object(external_kbnSharedDeps_React_["useCallback"])(col=>{setColumnsWidthState(prevState=>{const updated=[...prevState];const idx=prevState.findIndex(c=>c.colIndex===col.colIndex);if(idx>=0){updated[idx]=col}else{updated.push(col)}uiStateValues.current.columnsWidth=updated;uiStateValues.current.pendingUpdate=true;setTimeout(()=>{uiState===null||uiState===void 0?void 0:uiState.set("vis.params.colWidth",updated);uiStateValues.current.pendingUpdate=false});return updated})},[uiState]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const updateOnChange=Object(external_kbnSharedDeps_Lodash_["debounce"])(()=>{if(uiStateValues.current.pendingUpdate){return}const{vis:vis}=uiState===null||uiState===void 0?void 0:uiState.getChanges();if(!Object(external_kbnSharedDeps_Lodash_["isEqual"])(vis===null||vis===void 0?void 0:vis.params.colWidth,uiStateValues.current.columnsWidth)){uiStateValues.current.columnsWidth=vis===null||vis===void 0?void 0:vis.params.colWidth;setColumnsWidthState((vis===null||vis===void 0?void 0:vis.params.colWidth)||[])}if(!Object(external_kbnSharedDeps_Lodash_["isEqual"])(vis===null||vis===void 0?void 0:vis.params.sort,uiStateValues.current.sort)){uiStateValues.current.sort=vis===null||vis===void 0?void 0:vis.params.sort;setSortState((vis===null||vis===void 0?void 0:vis.params.sort)||defaultSort)}});uiState===null||uiState===void 0?void 0:uiState.on("change",updateOnChange);return()=>{uiState===null||uiState===void 0?void 0:uiState.off("change",updateOnChange)}},[uiState]);return{columnsWidth:columnsWidth,sort:sort,setColumnsWidth:setColumnsWidth,setSort:setSort}};var services=__webpack_require__(0);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(6);function insertColumn(arr,index,col){const newArray=[...arr];newArray.splice(index+1,0,col);return newArray}function addPercentageColumn(table,name){const{columns:columns,rows:rows,formattedColumns:formattedColumns}=table;const insertAtIndex=Object(external_kbnSharedDeps_Lodash_["findIndex"])(columns,{name:name});if(insertAtIndex<0)return table;const{id:id}=columns[insertAtIndex];const{sumTotal:sumTotal}=formattedColumns[id];const percentageColumnId=`${id}-percents`;const formatter=Object(services["a"])().deserialize({id:"percent"});const percentageColumnName=external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeTable.params.percentageTableColumnName",{defaultMessage:"{title} percentages",values:{title:name}});const newCols=insertColumn(columns,insertAtIndex,{name:percentageColumnName,id:percentageColumnId,meta:{type:"number",params:{id:"percent"}}});const newFormattedColumns={...formattedColumns,[percentageColumnId]:{title:percentageColumnName,formatter:formatter,filterable:false}};const newRows=rows.map(row=>({[percentageColumnId]:row[id]/sumTotal,...row}));return{columns:newCols,rows:newRows,formattedColumns:newFormattedColumns}}var common=__webpack_require__(24);const createFormattedTable=(table,visConfig)=>{const{buckets:buckets,metrics:metrics}=visConfig.dimensions;const formattedColumns=table.columns.reduce((acc,col,i)=>{var _dimension$format$par;const isBucket=buckets.find(({accessor:accessor})=>accessor===i);const dimension=isBucket||metrics.find(({accessor:accessor})=>accessor===i);if(!dimension)return acc;const formatter=Object(services["a"])().deserialize(dimension.format);const formattedColumn={title:col.name,formatter:formatter,filterable:!!isBucket};const isDate=dimension.format.id==="date"||((_dimension$format$par=dimension.format.params)===null||_dimension$format$par===void 0?void 0:_dimension$format$par.id)==="date";const allowsNumericalAggregations=formatter.allowsNumericalAggregations;if(allowsNumericalAggregations||isDate||visConfig.totalFunc===common["a"].COUNT){const sumOfColumnValues=table.rows.reduce((prev,curr)=>{if(curr[col.id]===undefined)return prev;return prev+curr[col.id]},0);formattedColumn.sumTotal=sumOfColumnValues;switch(visConfig.totalFunc){case common["a"].SUM:{if(!isDate){formattedColumn.formattedTotal=formatter.convert(sumOfColumnValues);formattedColumn.total=sumOfColumnValues}break}case common["a"].AVG:{if(!isDate){const total=sumOfColumnValues/table.rows.length;formattedColumn.formattedTotal=formatter.convert(total);formattedColumn.total=total}break}case common["a"].MIN:{const total=Object(external_kbnSharedDeps_Lodash_["chain"])(table.rows).map(col.id).min().value();formattedColumn.formattedTotal=formatter.convert(total);formattedColumn.total=total;break}case common["a"].MAX:{const total=Object(external_kbnSharedDeps_Lodash_["chain"])(table.rows).map(col.id).max().value();formattedColumn.formattedTotal=formatter.convert(total);formattedColumn.total=total;break}case common["a"].COUNT:{const total=table.rows.length;formattedColumn.formattedTotal=total;formattedColumn.total=total;break}default:break}}acc[col.id]=formattedColumn;return acc},{});return{columns:table.columns.filter(col=>formattedColumns[col.id]),rows:table.rows,formattedColumns:formattedColumns}};function tableVisResponseHandler(input,visConfig){const tables=[];let table;let direction;const split=visConfig.dimensions.splitColumn||visConfig.dimensions.splitRow;if(split){direction=visConfig.dimensions.splitRow?"row":"column";const splitColumnIndex=split[0].accessor;const splitColumnFormatter=Object(services["a"])().deserialize(split[0].format);const splitColumn=input.columns[splitColumnIndex];const splitMap={};let splitIndex=0;input.rows.forEach(row=>{const splitValue=row[splitColumn.id];if(!splitMap.hasOwnProperty(splitValue)){splitMap[splitValue]=splitIndex++;const tableGroup={title:`${splitColumnFormatter.convert(splitValue)}: ${splitColumn.name}`,table:{columns:input.columns,rows:[],formattedColumns:{}}};tables.push(tableGroup)}const tableIndex=splitMap[splitValue];tables[tableIndex].table.rows.push(row)});tables.forEach(tg=>{tg.table=createFormattedTable(tg.table,visConfig);if(visConfig.percentageCol){tg.table=addPercentageColumn(tg.table,visConfig.percentageCol)}})}else{table=createFormattedTable(input,visConfig);if(visConfig.percentageCol){table=addPercentageColumn(table,visConfig.percentageCol)}}return{direction:direction,table:table,tables:tables}}},57:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"registerTableVis",(function(){return registerTableVis}));var external_kbnSharedDeps_KbnI18n_=__webpack_require__(6);var common=__webpack_require__(24);var utils=__webpack_require__(27);const createTableVisFn=()=>({name:"kibana_table",type:"render",inputTypes:["datatable"],help:external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeTable.function.help",{defaultMessage:"Table visualization"}),args:{visConfig:{types:["string","null"],default:'"{}"',help:""}},fn(input,args,handlers){var _handlers$inspectorAd;const visConfig=args.visConfig&&JSON.parse(args.visConfig);const convertedData=Object(utils["a"])(input,visConfig);if(handlers!==null&&handlers!==void 0&&(_handlers$inspectorAd=handlers.inspectorAdapters)!==null&&_handlers$inspectorAd!==void 0&&_handlers$inspectorAd.tables){handlers.inspectorAdapters.tables.logDatatable("default",input)}return{type:"render",as:"table_vis",value:{visData:convertedData,visType:common["b"],visConfig:visConfig}}}});var external_kbnSharedDeps_React_=__webpack_require__(5);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_ReactDom_=__webpack_require__(18);var public_=__webpack_require__(9);const TableVisualizationComponent=Object(external_kbnSharedDeps_React_["lazy"])(()=>__webpack_require__.e(2).then(__webpack_require__.bind(null,56)));const getTableVisRenderer=core=>({name:"table_vis",reuseDomNode:true,render:async(domNode,{visData:visData,visConfig:visConfig},handlers)=>{var _visData$table;handlers.onDestroy(()=>{Object(external_kbnSharedDeps_ReactDom_["unmountComponentAtNode"])(domNode)});const showNoResult=((_visData$table=visData.table)===null||_visData$table===void 0?void 0:_visData$table.rows.length)===0||!visData.table&&visData.tables.length===0;Object(external_kbnSharedDeps_ReactDom_["render"])(external_kbnSharedDeps_React_default.a.createElement(public_["VisualizationContainer"],{"data-test-subj":"tbvChartContainer",handlers:handlers,showNoResult:showNoResult},external_kbnSharedDeps_React_default.a.createElement(TableVisualizationComponent,{core:core,handlers:handlers,visData:visData,visConfig:visConfig})),domNode)}});var data_public_=__webpack_require__(10);var table_vis_options_lazy=__webpack_require__(25);var to_ast=__webpack_require__(26);const tableVisTypeDefinition={name:common["b"],title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeTable.tableVisTitle",{defaultMessage:"Data table"}),icon:"visTable",description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeTable.tableVisDescription",{defaultMessage:"Display data in rows and columns."}),getSupportedTriggers:()=>[public_["VIS_EVENT_TO_TRIGGER"].filter],visConfig:{defaults:{perPage:10,showPartialRows:false,showMetricsAtAllLevels:false,showTotal:false,showToolbar:false,totalFunc:"sum",percentageCol:""}},editorConfig:{optionsTemplate:table_vis_options_lazy["a"],schemas:[{group:data_public_["AggGroupNames"].Metrics,name:"metric",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeTable.tableVisEditorConfig.schemas.metricTitle",{defaultMessage:"Metric"}),aggFilter:["!geo_centroid","!geo_bounds"],aggSettings:{top_hits:{allowStrings:true}},min:1,defaults:[{type:"count",schema:"metric"}]},{group:data_public_["AggGroupNames"].Buckets,name:"bucket",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeTable.tableVisEditorConfig.schemas.bucketTitle",{defaultMessage:"Split rows"}),aggFilter:["!filter"]},{group:data_public_["AggGroupNames"].Buckets,name:"split",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("visTypeTable.tableVisEditorConfig.schemas.splitTitle",{defaultMessage:"Split table"}),min:0,max:1,aggFilter:["!filter"]}]},toExpressionAst:to_ast["a"],hierarchicalData:vis=>vis.params.showPartialRows||vis.params.showMetricsAtAllLevels,requiresSearch:true};const registerTableVis=async(core,{expressions:expressions,visualizations:visualizations},context)=>{const[coreStart]=await core.getStartServices();expressions.registerFunction(createTableVisFn);expressions.registerRenderer(getTableVisRenderer(coreStart));visualizations.createBaseVisualization(tableVisTypeDefinition)}}}]);