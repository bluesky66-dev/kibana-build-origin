/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window["security_bundle_jsonpfunction"]=window["security_bundle_jsonpfunction"]||[]).push([[3],{244:function(module,exports,__webpack_require__){switch(window.__kbnThemeTag__){case"v7dark":return __webpack_require__(245);case"v7light":return __webpack_require__(247);case"v8dark":return __webpack_require__(249);case"v8light":return __webpack_require__(251)}},245:function(module,exports,__webpack_require__){var api=__webpack_require__(11);var content=__webpack_require__(246);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},246:function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(12);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".collapsiblePanel__logo {\n  margin-right: 8px;\n  vertical-align: text-bottom; }\n",""]);module.exports=exports},247:function(module,exports,__webpack_require__){var api=__webpack_require__(11);var content=__webpack_require__(248);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},248:function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(12);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".collapsiblePanel__logo {\n  margin-right: 8px;\n  vertical-align: text-bottom; }\n",""]);module.exports=exports},249:function(module,exports,__webpack_require__){var api=__webpack_require__(11);var content=__webpack_require__(250);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},250:function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(12);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".collapsiblePanel__logo {\n  margin-right: 8px;\n  vertical-align: text-bottom; }\n",""]);module.exports=exports},251:function(module,exports,__webpack_require__){var api=__webpack_require__(11);var content=__webpack_require__(252);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},252:function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(12);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".collapsiblePanel__logo {\n  margin-right: 8px;\n  vertical-align: text-bottom; }\n",""]);module.exports=exports},253:function(module,exports,__webpack_require__){switch(window.__kbnThemeTag__){case"v7dark":return __webpack_require__(254);case"v7light":return __webpack_require__(256);case"v8dark":return __webpack_require__(258);case"v8light":return __webpack_require__(260)}},254:function(module,exports,__webpack_require__){var api=__webpack_require__(11);var content=__webpack_require__(255);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},255:function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(12);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".secPrivilegeFeatureChangeAllLink {\n  margin-left: 8px; }\n",""]);module.exports=exports},256:function(module,exports,__webpack_require__){var api=__webpack_require__(11);var content=__webpack_require__(257);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},257:function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(12);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".secPrivilegeFeatureChangeAllLink {\n  margin-left: 8px; }\n",""]);module.exports=exports},258:function(module,exports,__webpack_require__){var api=__webpack_require__(11);var content=__webpack_require__(259);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},259:function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(12);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".secPrivilegeFeatureChangeAllLink {\n  margin-left: 8px; }\n",""]);module.exports=exports},260:function(module,exports,__webpack_require__){var api=__webpack_require__(11);var content=__webpack_require__(261);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},261:function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(12);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".secPrivilegeFeatureChangeAllLink {\n  margin-left: 8px; }\n",""]);module.exports=exports},262:function(module,exports,__webpack_require__){switch(window.__kbnThemeTag__){case"v7dark":return __webpack_require__(263);case"v7light":return __webpack_require__(265);case"v8dark":return __webpack_require__(267);case"v8light":return __webpack_require__(269)}},263:function(module,exports,__webpack_require__){var api=__webpack_require__(11);var content=__webpack_require__(264);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},264:function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(12);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".subFeaturePrivilegeExpandedRegion {\n  background-color: #25262E;\n  padding-left: 40px;\n  padding-top: 8px; }\n",""]);module.exports=exports},265:function(module,exports,__webpack_require__){var api=__webpack_require__(11);var content=__webpack_require__(266);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},266:function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(12);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".subFeaturePrivilegeExpandedRegion {\n  background-color: #F5F7FA;\n  padding-left: 40px;\n  padding-top: 8px; }\n",""]);module.exports=exports},267:function(module,exports,__webpack_require__){var api=__webpack_require__(11);var content=__webpack_require__(268);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},268:function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(12);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".subFeaturePrivilegeExpandedRegion {\n  background-color: #25262E;\n  padding-left: 40px;\n  padding-top: 8px; }\n",""]);module.exports=exports},269:function(module,exports,__webpack_require__){var api=__webpack_require__(11);var content=__webpack_require__(270);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},270:function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(12);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".subFeaturePrivilegeExpandedRegion {\n  background-color: #F5F7FA;\n  padding-left: 40px;\n  padding-top: 8px; }\n",""]);module.exports=exports},271:function(module,exports,__webpack_require__){switch(window.__kbnThemeTag__){case"v7dark":return __webpack_require__(272);case"v7light":return __webpack_require__(274);case"v8dark":return __webpack_require__(276);case"v8light":return __webpack_require__(278)}},272:function(module,exports,__webpack_require__){var api=__webpack_require__(11);var content=__webpack_require__(273);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},273:function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(12);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".secPrivilegeTable__row--isGlobalSpace {\n  background-color: #25262E; }\n",""]);module.exports=exports},274:function(module,exports,__webpack_require__){var api=__webpack_require__(11);var content=__webpack_require__(275);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},275:function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(12);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".secPrivilegeTable__row--isGlobalSpace {\n  background-color: #F5F7FA; }\n",""]);module.exports=exports},276:function(module,exports,__webpack_require__){var api=__webpack_require__(11);var content=__webpack_require__(277);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},277:function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(12);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".secPrivilegeTable__row--isGlobalSpace {\n  background-color: #25262E; }\n",""]);module.exports=exports},278:function(module,exports,__webpack_require__){var api=__webpack_require__(11);var content=__webpack_require__(279);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},279:function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(12);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".secPrivilegeTable__row--isGlobalSpace {\n  background-color: #F5F7FA; }\n",""]);module.exports=exports},280:function(module,exports,__webpack_require__){switch(window.__kbnThemeTag__){case"v7dark":return __webpack_require__(281);case"v7light":return __webpack_require__(283);case"v8dark":return __webpack_require__(285);case"v8light":return __webpack_require__(287)}},281:function(module,exports,__webpack_require__){var api=__webpack_require__(11);var content=__webpack_require__(282);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},282:function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(12);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".secSpacesPopoverList__buttonText {\n  font-size: 12px; }\n",""]);module.exports=exports},283:function(module,exports,__webpack_require__){var api=__webpack_require__(11);var content=__webpack_require__(284);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},284:function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(12);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".secSpacesPopoverList__buttonText {\n  font-size: 12px; }\n",""]);module.exports=exports},285:function(module,exports,__webpack_require__){var api=__webpack_require__(11);var content=__webpack_require__(286);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},286:function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(12);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".secSpacesPopoverList__buttonText {\n  font-size: 12px; }\n",""]);module.exports=exports},287:function(module,exports,__webpack_require__){var api=__webpack_require__(11);var content=__webpack_require__(288);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},288:function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(12);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".secSpacesPopoverList__buttonText {\n  font-size: 12px; }\n",""]);module.exports=exports},296:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"EditRolePage",(function(){return EditRolePage}));var external_kbnSharedDeps_ElasticEui_=__webpack_require__(2);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(1);var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(5);var external_kbnSharedDeps_React_=__webpack_require__(0);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var model=__webpack_require__(13);var constants=__webpack_require__(15);function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class validate_role_RoleValidator{constructor(options={}){_defineProperty(this,"shouldValidate",void 0);this.shouldValidate=options.shouldValidate}enableValidation(){this.shouldValidate=true}disableValidation(){this.shouldValidate=false}validateRoleName(role){if(!this.shouldValidate){return valid()}if(!role.name){return invalid(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.validateRole.provideRoleNameWarningMessage",{defaultMessage:"Please provide a role name."}))}if(role.name.length>constants["d"]){return invalid(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.validateRole.nameLengthWarningMessage",{defaultMessage:"Name must not exceed {maxLength} characters.",values:{maxLength:constants["d"]}}))}if(role.name.trim()!==role.name){return invalid(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.validateRole.nameWhitespaceWarningMessage",{defaultMessage:`Name must not contain leading or trailing spaces.`}))}if(!role.name.match(constants["e"])){return invalid(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.validateRole.nameAllowedCharactersWarningMessage",{defaultMessage:"Name must contain only letters, numbers, spaces, punctuation and printable symbols."}))}return valid()}validateIndexPrivileges(role){if(!this.shouldValidate){return valid()}if(!Array.isArray(role.elasticsearch.indices)){throw new TypeError(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.validateRole.indicesTypeErrorMessage",{defaultMessage:"Expected {elasticIndices} to be an array",values:{elasticIndices:'"role.elasticsearch.indices"'}}))}const areIndicesValid=role.elasticsearch.indices.map(indexPriv=>this.validateIndexPrivilege(indexPriv)).find(result=>result.isInvalid)==null;if(areIndicesValid){return valid()}return invalid()}validateIndexPrivilege(indexPrivilege){if(!this.shouldValidate){return valid()}if(indexPrivilege.names.length&&!indexPrivilege.privileges.length){return invalid(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.validateRole.onePrivilegeRequiredWarningMessage",{defaultMessage:"At least one privilege is required"}))}return valid()}validateSelectedSpaces(spaceIds,privilege){if(!this.shouldValidate){return valid()}if(!privilege){return valid()}if(Array.isArray(spaceIds)&&spaceIds.length>0){return valid()}return invalid(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.validateRole.oneSpaceRequiredWarningMessage",{defaultMessage:"At least one space is required"}))}validateSelectedPrivilege(spaceIds,privilege){if(!this.shouldValidate){return valid()}if(!spaceIds||spaceIds.length===0){return valid()}if(privilege){return valid()}return invalid(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.validateRole.privilegeRequiredWarningMessage",{defaultMessage:"Privilege is required"}))}validateSpacePrivileges(role){if(!this.shouldValidate){return valid()}const privileges=role.kibana||[];const arePrivilegesValid=privileges.every(assignedPrivilege=>assignedPrivilege.base.length>0||Object.keys(assignedPrivilege.feature).length>0);if(arePrivilegesValid){return valid()}return invalid()}validateForSave(role){const{isInvalid:isNameInvalid}=this.validateRoleName(role);const{isInvalid:areIndicesInvalid}=this.validateIndexPrivileges(role);const{isInvalid:areSpacePrivilegesInvalid}=this.validateSpacePrivileges(role);if(isNameInvalid||areIndicesInvalid||areSpacePrivilegesInvalid){return invalid()}return valid()}}function invalid(error){return{isInvalid:true,error:error}}function valid(){return{isInvalid:false}}function delete_role_button_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class delete_role_button_DeleteRoleButton extends external_kbnSharedDeps_React_["Component"]{constructor(...args){super(...args);delete_role_button_defineProperty(this,"state",{showModal:false});delete_role_button_defineProperty(this,"maybeShowModal",()=>{if(!this.state.showModal){return null}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiConfirmModal"],{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.deleteRoleButton.deleteRoleTitle",defaultMessage:"Delete Role"}),onCancel:this.closeModal,onConfirm:this.onConfirmDelete,cancelButtonText:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.deleteRoleButton.cancelButtonLabel",defaultMessage:"No, don't delete"}),confirmButtonText:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.deleteRoleButton.confirmButtonLabel",defaultMessage:"Yes, delete role"}),buttonColor:"danger"},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.deleteRoleButton.deletingRoleConfirmationText",defaultMessage:"Are you sure you want to delete this role?"})),external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.deleteRoleButton.deletingRoleWarningText",defaultMessage:"This action cannot be undone!"})))});delete_role_button_defineProperty(this,"closeModal",()=>{this.setState({showModal:false})});delete_role_button_defineProperty(this,"showModal",()=>{this.setState({showModal:true})});delete_role_button_defineProperty(this,"onConfirmDelete",()=>{this.closeModal();this.props.onDelete()})}render(){if(!this.props.canDelete){return null}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{color:"danger",onClick:this.showModal},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.deleteRoleButton.deleteRoleButtonLabel",defaultMessage:"Delete role"})),this.maybeShowModal())}}var collapsible_panel=__webpack_require__(244);function collapsible_panel_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class collapsible_panel_CollapsiblePanel extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);collapsible_panel_defineProperty(this,"state",{collapsed:false});collapsible_panel_defineProperty(this,"getTitle",()=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"baseline",gutterSize:"s",responsive:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],null,external_kbnSharedDeps_React_default.a.createElement("h2",null,this.props.iconType&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:this.props.iconType,size:"xl",className:"collapsiblePanel__logo"})," "),this.props.title))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{"data-test-subj":"showHidePrivilege",onClick:this.toggleCollapsed},this.state.collapsed?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.collapsiblePanel.showLinkText",defaultMessage:"show"}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.collapsiblePanel.hideLinkText",defaultMessage:"hide"})))));collapsible_panel_defineProperty(this,"getForm",()=>{if(this.state.collapsed){return null}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),this.props.children)});collapsible_panel_defineProperty(this,"toggleCollapsed",()=>{this.setState({collapsed:!this.state.collapsed})});this.state={collapsed:props.initiallyCollapsed||false}}render(){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],null,this.getTitle(),this.getForm())}}var external_kbnSharedDeps_Lodash_=__webpack_require__(14);var external_kbnSharedDeps_Lodash_default=__webpack_require__.n(external_kbnSharedDeps_Lodash_);function cluster_privileges_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class cluster_privileges_ClusterPrivileges extends external_kbnSharedDeps_React_["Component"]{constructor(...args){super(...args);cluster_privileges_defineProperty(this,"buildComboBox",items=>{const role=this.props.role;const options=items.map(i=>({label:i}));const selectedOptions=(role.elasticsearch.cluster||[]).map(k=>({label:k}));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{key:"clusterPrivs"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{"data-test-subj":"cluster-privileges-combobox",options:options,selectedOptions:selectedOptions,onChange:this.onClusterPrivilegesChange,onCreateOption:this.onCreateCustomPrivilege,isDisabled:Object(model["i"])(role)}))});cluster_privileges_defineProperty(this,"onClusterPrivilegesChange",selectedPrivileges=>{this.props.onChange(selectedPrivileges.map(priv=>priv.label))});cluster_privileges_defineProperty(this,"onCreateCustomPrivilege",customPrivilege=>{this.props.onChange([...this.props.role.elasticsearch.cluster,customPrivilege])});cluster_privileges_defineProperty(this,"getAvailableClusterPrivileges",()=>{const availableClusterPrivileges=[...this.props.builtinClusterPrivileges,...this.props.role.elasticsearch.cluster];return external_kbnSharedDeps_Lodash_default.a.uniq(availableClusterPrivileges)})}render(){const availableClusterPrivileges=this.getAvailableClusterPrivileges();return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,this.buildComboBox(availableClusterPrivileges))}}function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}function index_privilege_form_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const fromOption=option=>option.label;const toOption=value=>({label:value});class index_privilege_form_IndexPrivilegeForm extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);index_privilege_form_defineProperty(this,"getPrivilegeForm",()=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],_extends({label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.indexPrivilegeForm.indicesFormRowLabel",defaultMessage:"Indices"}),fullWidth:true},this.props.validator.validateIndexPrivilege(this.props.indexPrivilege)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{"data-test-subj":`indicesInput${this.props.formIndex}`,options:this.props.indexPatterns.map(toOption),selectedOptions:this.props.indexPrivilege.names.map(toOption),onCreateOption:this.onCreateIndexPatternOption,onChange:this.onIndexPatternsChange,isDisabled:this.props.isRoleReadOnly}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.indexPrivilegeForm.privilegesFormRowLabel",defaultMessage:"Privileges"}),fullWidth:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{"data-test-subj":`privilegesInput${this.props.formIndex}`,options:this.props.availableIndexPrivileges.map(toOption),selectedOptions:this.props.indexPrivilege.privileges.map(toOption),onChange:this.onPrivilegeChange,onCreateOption:this.onCreateCustomPrivilege,isDisabled:this.props.isRoleReadOnly})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),this.getFieldLevelControls(),this.getGrantedDocumentsControl()));index_privilege_form_defineProperty(this,"getFieldLevelControls",()=>{const{allowFieldLevelSecurity:allowFieldLevelSecurity,allowDocumentLevelSecurity:allowDocumentLevelSecurity,availableFields:availableFields,indexPrivilege:indexPrivilege,isRoleReadOnly:isRoleReadOnly}=this.props;if(!allowFieldLevelSecurity){return null}const{grant:grant,except:except}=this.getFieldSecurity(indexPrivilege);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"column"},!isRoleReadOnly&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{"data-test-subj":`restrictFieldsQuery${this.props.formIndex}`,label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRoles.indexPrivilegeForm.grantFieldPrivilegesLabel",defaultMessage:"Grant access to specific fields"}),compressed:true,checked:this.state.fieldSecurityExpanded,onChange:this.toggleFieldSecurity})),this.state.fieldSecurityExpanded&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRoles.indexPrivilegeForm.grantedFieldsFormRowLabel",defaultMessage:"Granted fields"}),fullWidth:true,className:"indexPrivilegeForm__grantedFieldsRow",helpText:!isRoleReadOnly&&grant.length===0?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRoles.indexPrivilegeForm.grantedFieldsFormRowHelpText",defaultMessage:"If no fields are granted, then users assigned to this role will not be able to see any data for this index."}):undefined},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{"data-test-subj":`fieldInput${this.props.formIndex}`,options:availableFields?availableFields.map(toOption):[],selectedOptions:grant.map(toOption),onCreateOption:this.onCreateGrantedField,onChange:this.onGrantedFieldsChange,isDisabled:this.props.isRoleReadOnly})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRoles.indexPrivilegeForm.deniedFieldsFormRowLabel",defaultMessage:"Denied fields"}),fullWidth:true,className:"indexPrivilegeForm__deniedFieldsRow"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{"data-test-subj":`deniedFieldInput${this.props.formIndex}`,options:availableFields?availableFields.map(toOption):[],selectedOptions:except.map(toOption),onCreateOption:this.onCreateDeniedField,onChange:this.onDeniedFieldsChange,isDisabled:isRoleReadOnly}))))))),allowDocumentLevelSecurity&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null))});index_privilege_form_defineProperty(this,"getGrantedDocumentsControl",()=>{const{allowDocumentLevelSecurity:allowDocumentLevelSecurity,indexPrivilege:indexPrivilege,isRoleReadOnly:isRoleReadOnly}=this.props;if(!allowDocumentLevelSecurity){return null}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"column"},!this.props.isRoleReadOnly&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{"data-test-subj":`restrictDocumentsQuery${this.props.formIndex}`,label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.indexPrivilegeForm.grantReadPrivilegesLabel",defaultMessage:"Grant read privileges to specific documents"}),compressed:true,checked:this.state.queryExpanded,onChange:this.toggleDocumentQuery,disabled:isRoleReadOnly})),this.state.queryExpanded&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.indexPrivilegeForm.grantedDocumentsQueryFormRowLabel",defaultMessage:"Granted documents query"}),fullWidth:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTextArea"],{"data-test-subj":`queryInput${this.props.formIndex}`,style:{resize:"none"},fullWidth:true,value:indexPrivilege.query,onChange:this.onQueryChange,readOnly:this.props.isRoleReadOnly}))))});index_privilege_form_defineProperty(this,"toggleDocumentQuery",()=>{const willToggleOff=this.state.queryExpanded;const willToggleOn=!willToggleOff;this.setState({queryExpanded:!this.state.queryExpanded,documentQuery:willToggleOff?this.props.indexPrivilege.query:this.state.documentQuery});if(willToggleOff){this.props.onChange({...this.props.indexPrivilege,query:""})}if(willToggleOn&&!this.props.indexPrivilege.query&&this.state.documentQuery){this.props.onChange({...this.props.indexPrivilege,query:this.state.documentQuery})}});index_privilege_form_defineProperty(this,"toggleFieldSecurity",()=>{const willToggleOff=this.state.fieldSecurityExpanded;const willToggleOn=!willToggleOff;const{grant:grant,except:except}=this.getFieldSecurity(this.props.indexPrivilege);this.setState({fieldSecurityExpanded:!this.state.fieldSecurityExpanded,grantedFields:willToggleOff?grant:this.state.grantedFields,exceptedFields:willToggleOff?except:this.state.exceptedFields});if(willToggleOff){this.props.onChange({...this.props.indexPrivilege,field_security:{grant:["*"],except:[]}})}const hasConfiguredFieldSecurity=this.isFieldSecurityConfigured(this.props.indexPrivilege);const hasSavedFieldSecurity=this.state.exceptedFields.length>0||this.state.grantedFields.length>0;if(willToggleOn&&!hasConfiguredFieldSecurity&&hasSavedFieldSecurity){this.props.onChange({...this.props.indexPrivilege,field_security:{grant:this.state.grantedFields,except:this.state.exceptedFields}})}});index_privilege_form_defineProperty(this,"onCreateIndexPatternOption",option=>{const newIndexPatterns=this.props.indexPrivilege.names.concat([option]);this.props.onChange({...this.props.indexPrivilege,names:newIndexPatterns})});index_privilege_form_defineProperty(this,"onIndexPatternsChange",newPatterns=>{this.props.onChange({...this.props.indexPrivilege,names:newPatterns.map(fromOption)})});index_privilege_form_defineProperty(this,"onPrivilegeChange",newPrivileges=>{this.props.onChange({...this.props.indexPrivilege,privileges:newPrivileges.map(fromOption)})});index_privilege_form_defineProperty(this,"onCreateCustomPrivilege",customPrivilege=>{this.props.onChange({...this.props.indexPrivilege,privileges:[...this.props.indexPrivilege.privileges,customPrivilege]})});index_privilege_form_defineProperty(this,"onQueryChange",e=>{this.props.onChange({...this.props.indexPrivilege,query:e.target.value})});index_privilege_form_defineProperty(this,"onCreateGrantedField",grant=>{if(!this.props.indexPrivilege.field_security||!this.props.indexPrivilege.field_security.grant){return}const newGrants=this.props.indexPrivilege.field_security.grant.concat([grant]);this.props.onChange({...this.props.indexPrivilege,field_security:{...this.props.indexPrivilege.field_security,grant:newGrants}})});index_privilege_form_defineProperty(this,"onGrantedFieldsChange",grantedFields=>{this.props.onChange({...this.props.indexPrivilege,field_security:{...this.props.indexPrivilege.field_security,grant:grantedFields.map(fromOption)}})});index_privilege_form_defineProperty(this,"onCreateDeniedField",except=>{if(!this.props.indexPrivilege.field_security||!this.props.indexPrivilege.field_security.except){return}const newExcepts=this.props.indexPrivilege.field_security.except.concat([except]);this.props.onChange({...this.props.indexPrivilege,field_security:{...this.props.indexPrivilege.field_security,except:newExcepts}})});index_privilege_form_defineProperty(this,"onDeniedFieldsChange",deniedFields=>{this.props.onChange({...this.props.indexPrivilege,field_security:{...this.props.indexPrivilege.field_security,except:deniedFields.map(fromOption)}})});index_privilege_form_defineProperty(this,"getFieldSecurity",indexPrivilege=>{const{grant:grant=[],except:except=[]}=indexPrivilege.field_security||{};return{grant:grant,except:except}});index_privilege_form_defineProperty(this,"isFieldSecurityConfigured",indexPrivilege=>{const{grant:grant,except:except}=this.getFieldSecurity(indexPrivilege);return except.length>0||grant.length>0&&!external_kbnSharedDeps_Lodash_default.a.isEqual(grant,["*"])});const{grant:_grant,except:_except}=this.getFieldSecurity(props.indexPrivilege);this.state={queryExpanded:!!props.indexPrivilege.query,fieldSecurityExpanded:this.isFieldSecurityConfigured(props.indexPrivilege),grantedFields:_grant,exceptedFields:_except,documentQuery:props.indexPrivilege.query}}render(){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{className:"index-privilege-form"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,this.getPrivilegeForm()),!this.props.isRoleReadOnly&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{hasEmptyLabelSpace:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.indexPrivilegeForm.deleteSpacePrivilegeAriaLabel",{defaultMessage:"Delete index privilege"}),color:"danger",onClick:this.props.onDelete,iconType:"trash"})))))}}function index_privileges_extends(){index_privileges_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return index_privileges_extends.apply(this,arguments)}function index_privileges_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class index_privileges_IndexPrivileges extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);index_privileges_defineProperty(this,"addIndexPrivilege",()=>{const{role:role}=this.props;const newIndices=[...role.elasticsearch.indices,{names:[],privileges:[],field_security:{grant:["*"]}}];this.props.onChange({...this.props.role,elasticsearch:{...this.props.role.elasticsearch,indices:newIndices}})});index_privileges_defineProperty(this,"onIndexPrivilegeChange",privilegeIndex=>updatedPrivilege=>{const{role:role}=this.props;const{indices:indices}=role.elasticsearch;const newIndices=[...indices];newIndices[privilegeIndex]=updatedPrivilege;this.props.onChange({...this.props.role,elasticsearch:{...this.props.role.elasticsearch,indices:newIndices}});this.loadAvailableFields(newIndices)});index_privileges_defineProperty(this,"onIndexPrivilegeDelete",privilegeIndex=>()=>{const{role:role}=this.props;const newIndices=[...role.elasticsearch.indices];newIndices.splice(privilegeIndex,1);this.props.onChange({...this.props.role,elasticsearch:{...this.props.role.elasticsearch,indices:newIndices}})});index_privileges_defineProperty(this,"isPlaceholderPrivilege",indexPrivilege=>indexPrivilege.names.length===0);index_privileges_defineProperty(this,"loadFieldsForPattern",async pattern=>{if(!pattern){return{[pattern]:[]}}try{return{[pattern]:await this.props.indicesAPIClient.getFields(pattern)}}catch(e){return{[pattern]:[]}}});this.state={availableFields:{}}}componentDidMount(){this.loadAvailableFields(this.props.role.elasticsearch.indices)}render(){const{indices:indices=[]}=this.props.role.elasticsearch;const{indexPatterns:indexPatterns,license:license,availableIndexPrivileges:availableIndexPrivileges}=this.props;const{allowRoleDocumentLevelSecurity:allowRoleDocumentLevelSecurity,allowRoleFieldLevelSecurity:allowRoleFieldLevelSecurity}=license.getFeatures();const props={indexPatterns:indexPatterns,allowDocumentLevelSecurity:allowRoleDocumentLevelSecurity||!Object(model["h"])(this.props.role),allowFieldLevelSecurity:allowRoleFieldLevelSecurity||!Object(model["h"])(this.props.role),isRoleReadOnly:Object(model["i"])(this.props.role)};const forms=indices.map((indexPrivilege,idx)=>external_kbnSharedDeps_React_default.a.createElement(index_privilege_form_IndexPrivilegeForm,index_privileges_extends({key:idx},props,{formIndex:idx,validator:this.props.validator,availableIndexPrivileges:availableIndexPrivileges,indexPrivilege:indexPrivilege,availableFields:this.state.availableFields[indexPrivilege.names.join(",")],onChange:this.onIndexPrivilegeChange(idx),onDelete:this.onIndexPrivilegeDelete(idx)})));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,forms)}loadAvailableFields(privileges){if(Object(model["i"])(this.props.role)){return}const patterns=privileges.map(index=>index.names.join(","));const cachedPatterns=Object.keys(this.state.availableFields);const patternsToFetch=external_kbnSharedDeps_Lodash_default.a.difference(patterns,cachedPatterns);const fetchRequests=patternsToFetch.map(this.loadFieldsForPattern);Promise.all(fetchRequests).then(response=>{this.setState({availableFields:{...this.state.availableFields,...response.reduce((acc,o)=>({...acc,...o}),{})}})})}}function elasticsearch_privileges_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class elasticsearch_privileges_ElasticsearchPrivileges extends external_kbnSharedDeps_React_["Component"]{constructor(...args){super(...args);elasticsearch_privileges_defineProperty(this,"getForm",()=>{const{role:role,indicesAPIClient:indicesAPIClient,docLinks:docLinks,validator:validator,onChange:onChange,editable:editable,indexPatterns:indexPatterns,license:license,builtinESPrivileges:builtinESPrivileges}=this.props;const indexProps={role:role,indicesAPIClient:indicesAPIClient,validator:validator,indexPatterns:indexPatterns,license:license,onChange:onChange,availableIndexPrivileges:builtinESPrivileges.index};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{title:external_kbnSharedDeps_React_default.a.createElement("h3",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.elasticSearchPrivileges.clusterPrivilegesTitle",defaultMessage:"Cluster privileges"})),description:external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.elasticSearchPrivileges.manageRoleActionsDescription",defaultMessage:"Manage the actions this role can perform against your cluster. "}),this.learnMore(docLinks.links.security.clusterPrivileges))},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true,hasEmptyLabelSpace:true},external_kbnSharedDeps_React_default.a.createElement(cluster_privileges_ClusterPrivileges,{role:this.props.role,onChange:this.onClusterPrivilegesChange,builtinClusterPrivileges:builtinESPrivileges.cluster}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{title:external_kbnSharedDeps_React_default.a.createElement("h3",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.elasticSearchPrivileges.runAsPrivilegesTitle",defaultMessage:"Run As privileges"})),description:external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.elasticSearchPrivileges.howToBeSubmittedOnBehalfOfOtherUsersDescription",defaultMessage:"Allow requests to be submitted on the behalf of other users. "}),this.learnMore(docLinks.links.security.runAsPrivilege))},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{hasEmptyLabelSpace:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{placeholder:this.props.editable?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.elasticSearchPrivileges.addUserTitle",{defaultMessage:"Add a user…"}):undefined,options:this.props.runAsUsers.map(username=>({id:username,label:username,isGroupLabelOption:false})),selectedOptions:this.props.role.elasticsearch.run_as.map(u=>({label:u})),onCreateOption:this.onCreateRunAsOption,onChange:this.onRunAsUserChange,isDisabled:!editable}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h3",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.elasticSearchPrivileges.indexPrivilegesTitle",defaultMessage:"Index privileges"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s",color:"subdued"},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.elasticSearchPrivileges.controlAccessToClusterDataDescription",defaultMessage:"Control access to the data in your cluster. "}),this.learnMore(docLinks.links.security.indicesPrivileges))),external_kbnSharedDeps_React_default.a.createElement(index_privileges_IndexPrivileges,indexProps),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],null),this.props.editable&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{iconType:"plusInCircleFilled",onClick:this.addIndexPrivilege},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.elasticSearchPrivileges.addIndexPrivilegesButtonLabel",defaultMessage:"Add index privilege"})))});elasticsearch_privileges_defineProperty(this,"learnMore",href=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{className:"editRole__learnMore",href:href,target:"_blank"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.elasticSearchPrivileges.learnMoreLinkText",defaultMessage:"Learn more"})));elasticsearch_privileges_defineProperty(this,"addIndexPrivilege",()=>{const{role:role}=this.props;const newIndices=[...role.elasticsearch.indices,{names:[],privileges:[],field_security:{grant:["*"]}}];this.props.onChange({...this.props.role,elasticsearch:{...this.props.role.elasticsearch,indices:newIndices}})});elasticsearch_privileges_defineProperty(this,"onClusterPrivilegesChange",cluster=>{const role={...this.props.role,elasticsearch:{...this.props.role.elasticsearch,cluster:cluster}};this.props.onChange(role)});elasticsearch_privileges_defineProperty(this,"onRunAsUserChange",users=>{const role={...this.props.role,elasticsearch:{...this.props.role.elasticsearch,run_as:users.map(u=>u.label)}};this.props.onChange(role)});elasticsearch_privileges_defineProperty(this,"onCreateRunAsOption",option=>{const newRunAsUsers=this.props.role.elasticsearch.run_as.concat(option);const role={...this.props.role,elasticsearch:{...this.props.role.elasticsearch,run_as:newRunAsUsers}};this.props.onChange(role)})}render(){return external_kbnSharedDeps_React_default.a.createElement(collapsible_panel_CollapsiblePanel,{iconType:"logoElasticsearch",title:"Elasticsearch"},this.getForm())}}var privilege_utils=__webpack_require__(25);const NO_PRIVILEGE_VALUE="none";const CUSTOM_PRIVILEGE_VALUE="custom";var change_all_privileges=__webpack_require__(253);function change_all_privileges_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class change_all_privileges_ChangeAllPrivilegesControl extends external_kbnSharedDeps_React_["Component"]{constructor(...args){super(...args);change_all_privileges_defineProperty(this,"state",{isPopoverOpen:false});change_all_privileges_defineProperty(this,"onSelectPrivilege",privilege=>{this.props.onChange(privilege);this.setState({isPopoverOpen:false})});change_all_privileges_defineProperty(this,"onButtonClick",()=>{this.setState({isPopoverOpen:!this.state.isPopoverOpen})});change_all_privileges_defineProperty(this,"closePopover",()=>{this.setState({isPopoverOpen:false})})}render(){const button=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{onClick:this.onButtonClick,className:"secPrivilegeFeatureChangeAllLink","data-test-subj":"changeAllPrivilegesButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.changeAllPrivilegesLink",defaultMessage:"Bulk actions"})," ",external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{size:"s",type:"arrowDown"})));const items=this.props.privileges.map(privilege=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiContextMenuItem"],{key:privilege.id,"data-test-subj":`changeAllPrivileges-${privilege.id}`,onClick:()=>{this.onSelectPrivilege(privilege.id)},disabled:this.props.disabled},external_kbnSharedDeps_Lodash_default.a.upperFirst(privilege.id)));items.push(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiContextMenuItem"],{key:NO_PRIVILEGE_VALUE,"data-test-subj":`changeAllPrivileges-${NO_PRIVILEGE_VALUE}`,onClick:()=>{this.onSelectPrivilege(NO_PRIVILEGE_VALUE)},disabled:this.props.disabled},external_kbnSharedDeps_Lodash_default.a.upperFirst(NO_PRIVILEGE_VALUE)));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopover"],{id:"changeAllFeaturePrivilegesPopover",button:button,isOpen:this.state.isPopoverOpen,closePopover:this.closePopover,panelPaddingSize:"none",anchorPosition:"downLeft"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiContextMenuPanel"],{items:items}))}}const SubFeatureForm=props=>{const groupsWithPrivileges=props.subFeature.getPrivilegeGroups().filter(group=>group.privileges.length>0);if(groupsWithPrivileges.length===0){return null}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s"},props.subFeature.name)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,groupsWithPrivileges.map(renderPrivilegeGroup)));function renderPrivilegeGroup(privilegeGroup,index){switch(privilegeGroup.groupType){case"independent":return renderIndependentPrivilegeGroup(privilegeGroup,index);case"mutually_exclusive":return renderMutuallyExclusivePrivilegeGroup(privilegeGroup,index);default:throw new Error(`Unsupported privilege group type: ${privilegeGroup.groupType}`)}}function renderIndependentPrivilegeGroup(privilegeGroup,index){return external_kbnSharedDeps_React_default.a.createElement("div",{key:index},privilegeGroup.privileges.map(privilege=>{const isGranted=props.privilegeCalculator.isIndependentSubFeaturePrivilegeGranted(props.featureId,privilege.id,props.privilegeIndex);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCheckbox"],{key:privilege.id,id:`${props.featureId}_${privilege.id}`,label:privilege.name,"data-test-subj":"independentSubFeaturePrivilegeControl",onChange:e=>{const{checked:checked}=e.target;if(checked){props.onChange([...props.selectedFeaturePrivileges,privilege.id])}else{props.onChange(props.selectedFeaturePrivileges.filter(sp=>sp!==privilege.id))}},checked:isGranted,disabled:props.disabled,compressed:true})}))}function renderMutuallyExclusivePrivilegeGroup(privilegeGroup,index){var _firstSelectedPrivile;const firstSelectedPrivilege=props.privilegeCalculator.getSelectedMutuallyExclusiveSubFeaturePrivilege(props.featureId,privilegeGroup,props.privilegeIndex);const options=[...privilegeGroup.privileges.map((privilege,privilegeIndex)=>({id:privilege.id,label:privilege.name,isDisabled:props.disabled}))];options.push({id:NO_PRIVILEGE_VALUE,label:"None",isDisabled:props.disabled});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonGroup"],{key:index,buttonSize:"compressed","data-test-subj":"mutexSubFeaturePrivilegeControl",options:options,idSelected:(_firstSelectedPrivile=firstSelectedPrivilege===null||firstSelectedPrivilege===void 0?void 0:firstSelectedPrivilege.id)!==null&&_firstSelectedPrivile!==void 0?_firstSelectedPrivile:NO_PRIVILEGE_VALUE,isDisabled:props.disabled,onChange:selectedPrivilegeId=>{const privilegesWithoutGroupEntries=props.selectedFeaturePrivileges.filter(sp=>!privilegeGroup.privileges.some(privilege=>privilege.id===sp));if(selectedPrivilegeId===NO_PRIVILEGE_VALUE){props.onChange(privilegesWithoutGroupEntries)}else{props.onChange([...privilegesWithoutGroupEntries,selectedPrivilegeId])}},legend:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.subFeatureForm.controlLegendText",{defaultMessage:"{subFeatureName} sub-feature privilege",values:{subFeatureName:props.subFeature.name}})})}};const FeatureTableExpandedRow=({feature:feature,onChange:onChange,privilegeIndex:privilegeIndex,privilegeCalculator:privilegeCalculator,selectedFeaturePrivileges:selectedFeaturePrivileges,disabled:disabled})=>{const[isCustomizing,setIsCustomizing]=Object(external_kbnSharedDeps_React_["useState"])(()=>feature.getMinimalFeaturePrivileges().some(p=>selectedFeaturePrivileges.includes(p.id)));Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const hasMinimalFeaturePrivilegeSelected=feature.getMinimalFeaturePrivileges().some(p=>selectedFeaturePrivileges.includes(p.id));if(!hasMinimalFeaturePrivilegeSelected&&isCustomizing){setIsCustomizing(false)}},[feature,isCustomizing,selectedFeaturePrivileges]);const onCustomizeSubFeatureChange=e=>{onChange(feature.id,privilegeCalculator.updateSelectedFeaturePrivilegesForCustomization(feature.id,privilegeIndex,e.target.checked));setIsCustomizing(e.target.checked)};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"column"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.featureTable.customizeSubFeaturePrivilegesSwitchLabel",defaultMessage:"Customize sub-feature privileges"}),checked:isCustomizing,onChange:onCustomizeSubFeatureChange,"data-test-subj":"customizeSubFeaturePrivileges",disabled:disabled||!privilegeCalculator.canCustomizeSubFeaturePrivileges(feature.id,privilegeIndex)})),feature.getSubFeatures().map(subFeature=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{key:subFeature.name},external_kbnSharedDeps_React_default.a.createElement(SubFeatureForm,{privilegeCalculator:privilegeCalculator,privilegeIndex:privilegeIndex,featureId:feature.id,subFeature:subFeature,onChange:updatedPrivileges=>onChange(feature.id,updatedPrivileges),selectedFeaturePrivileges:selectedFeaturePrivileges,disabled:disabled||!isCustomizing}))))};const FeatureTableCell=({feature:feature})=>{let tooltipElement=null;if(feature.getPrivilegesTooltip()){const tooltipContent=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement("p",null,feature.getPrivilegesTooltip()));tooltipElement=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIconTip"],{iconProps:{className:"eui-alignTop"},type:"iInCircle",color:"subdued",content:tooltipContent})}return external_kbnSharedDeps_React_default.a.createElement("span",{"data-test-subj":`featureTableCell`},feature.name," ",tooltipElement)};var feature_table=__webpack_require__(262);function feature_table_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class feature_table_FeatureTable extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);feature_table_defineProperty(this,"featureCategories",new Map);feature_table_defineProperty(this,"renderPrivilegeControlsForFeature",feature=>{const renderFeatureMarkup=(buttonContent,extraAction,warningIcon)=>{var _this$props$role$kiba;const{canCustomizeSubFeaturePrivileges:canCustomizeSubFeaturePrivileges}=this.props;const hasSubFeaturePrivileges=feature.getSubFeaturePrivileges().length>0;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"s",alignItems:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},warningIcon),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiAccordion"],{id:`featurePrivilegeControls_${feature.id}`,"data-test-subj":"featurePrivilegeControls",buttonContent:buttonContent,extraAction:extraAction,forceState:canCustomizeSubFeaturePrivileges&&hasSubFeaturePrivileges?undefined:"closed",arrowDisplay:canCustomizeSubFeaturePrivileges&&hasSubFeaturePrivileges?"left":"none"},external_kbnSharedDeps_React_default.a.createElement("div",{className:"subFeaturePrivilegeExpandedRegion"},external_kbnSharedDeps_React_default.a.createElement(FeatureTableExpandedRow,{feature:feature,privilegeIndex:this.props.privilegeIndex,onChange:this.props.onChange,privilegeCalculator:this.props.privilegeCalculator,selectedFeaturePrivileges:(_this$props$role$kiba=this.props.role.kibana[this.props.privilegeIndex].feature[feature.id])!==null&&_this$props$role$kiba!==void 0?_this$props$role$kiba:[],disabled:this.props.disabled})))))};const primaryFeaturePrivileges=feature.getPrimaryFeaturePrivileges();if(feature.reserved&&primaryFeaturePrivileges.length===0){const buttonContent=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:"empty",size:"l"})," ",external_kbnSharedDeps_React_default.a.createElement(FeatureTableCell,{feature:feature}));const extraAction=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{style:{maxWidth:200},size:"xs","data-test-subj":"reservedFeatureDescription"},feature.reserved.description);return renderFeatureMarkup(buttonContent,extraAction,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:"empty"}))}if(primaryFeaturePrivileges.length===0){return null}const selectedPrivilegeId=this.props.privilegeCalculator.getDisplayedPrimaryFeaturePrivilegeId(feature.id,this.props.privilegeIndex);const options=primaryFeaturePrivileges.map(privilege=>({id:`${feature.id}_${privilege.id}`,label:privilege.name,isDisabled:this.props.disabled}));options.push({id:`${feature.id}_${NO_PRIVILEGE_VALUE}`,label:"None",isDisabled:this.props.disabled});let warningIcon=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIconTip"],{type:"empty",content:null});if(this.props.privilegeCalculator.hasCustomizedSubFeaturePrivileges(feature.id,this.props.privilegeIndex)){warningIcon=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIconTip"],{type:"alert",content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.featureTable.privilegeCustomizationTooltip",defaultMessage:"Feature has customized sub-feature privileges. Expand this row for more information."})})}const{canCustomizeSubFeaturePrivileges:canCustomizeSubFeaturePrivileges}=this.props;const hasSubFeaturePrivileges=feature.getSubFeaturePrivileges().length>0;const showAccordionArrow=canCustomizeSubFeaturePrivileges&&hasSubFeaturePrivileges;const buttonContent=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,!showAccordionArrow&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:"empty",size:"l"})," ",external_kbnSharedDeps_React_default.a.createElement(FeatureTableCell,{feature:feature}));const extraAction=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonGroup"],{name:`featurePrivilege_${feature.id}`,"data-test-subj":`primaryFeaturePrivilegeControl`,isFullWidth:true,options:options,idSelected:`${feature.id}_${selectedPrivilegeId!==null&&selectedPrivilegeId!==void 0?selectedPrivilegeId:NO_PRIVILEGE_VALUE}`,onChange:this.onChange(feature.id),legend:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.featureTable.actionLegendText",{defaultMessage:"{featureName} feature privilege",values:{featureName:feature.name}}),style:{minWidth:200}});return renderFeatureMarkup(buttonContent,extraAction,warningIcon)});feature_table_defineProperty(this,"onChange",featureId=>featurePrivilegeId=>{const privilege=featurePrivilegeId.substr(`${featureId}_`.length);if(privilege===NO_PRIVILEGE_VALUE){this.props.onChange(featureId,[])}else{this.props.onChange(featureId,[privilege])}});feature_table_defineProperty(this,"onChangeAllFeaturePrivileges",privilege=>{if(privilege===NO_PRIVILEGE_VALUE){this.props.onChangeAll([])}else{this.props.onChangeAll([privilege])}});feature_table_defineProperty(this,"getCategoryHelpText",category=>{if(category.id==="management"){return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.featureTable.managementCategoryHelpText",{defaultMessage:"Access to Stack Management is determined by both Elasticsearch and Kibana privileges, and cannot be explicitly disabled."})}});props.kibanaPrivileges.getSecuredFeatures().filter(feature=>feature.privileges!=null||feature.reserved!=null).forEach(feature=>{if(!this.featureCategories.has(feature.category.id)){this.featureCategories.set(feature.category.id,[])}this.featureCategories.get(feature.category.id).push(feature)})}render(){const basePrivileges=this.props.kibanaPrivileges.getBasePrivileges(this.props.role.kibana[this.props.privilegeIndex]);const accordions=[];this.featureCategories.forEach(featuresInCategory=>{var _category$order;const{category:category}=featuresInCategory[0];const featureCount=featuresInCategory.length;const grantedCount=featuresInCategory.filter(feature=>this.props.privilegeCalculator.getEffectivePrimaryFeaturePrivilege(feature.id,this.props.privilegeIndex)!=null).length;const canExpandCategory=true;const buttonContent=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{"data-test-subj":`featureCategoryButton_${category.id}`,alignItems:"center",responsive:false,gutterSize:"m"},category.euiIconType?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{size:"m",type:category.euiIconType})):null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h4",{className:"eui-displayInlineBlock"},category.label))));const label=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.featureTable.featureAccordionSwitchLabel",{defaultMessage:"{grantedCount} / {featureCount} {featureCount, plural, one {feature} other {features}} granted",values:{grantedCount:grantedCount,featureCount:featureCount}});const extraAction=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s","aria-hidden":"true",color:"subdued","data-test-subj":"categoryLabel"},label);const helpText=this.getCategoryHelpText(category);const accordion=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiAccordion"],{id:`featureCategory_${category.id}`,"data-test-subj":`featureCategory_${category.id}`,key:category.id,arrowDisplay:canExpandCategory?"left":"none",forceState:canExpandCategory?undefined:"closed",buttonContent:buttonContent,extraAction:canExpandCategory?extraAction:undefined},external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),helpText&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{iconType:"iInCircle",size:"s"},helpText),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"column",gutterSize:"s"},featuresInCategory.map(feature=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{key:feature.id},this.renderPrivilegeControlsForFeature(feature))))));accordions.push({order:(_category$order=category.order)!==null&&_category$order!==void 0?_category$order:Number.MAX_SAFE_INTEGER,element:accordion})});accordions.sort((a1,a2)=>a1.order-a2.order);return external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"flexEnd"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("b",null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.featureTable.featureVisibilityTitle",{defaultMessage:"Customize feature privileges"})))),!this.props.disabled&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(change_all_privileges_ChangeAllPrivilegesControl,{privileges:basePrivileges,onChange:this.onChangeAllFeaturePrivileges}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"m"}),accordions.flatMap((a,idx)=>[a.element,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{key:`accordion-hr-${idx}`,margin:"m"})]))}}feature_table_defineProperty(feature_table_FeatureTable,"defaultProps",{privilegeIndex:-1,showLocks:true});function unsupported_space_privileges_warning_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class unsupported_space_privileges_warning_UnsupportedSpacePrivilegesWarning extends external_kbnSharedDeps_React_["Component"]{constructor(...args){super(...args);unsupported_space_privileges_warning_defineProperty(this,"getMessage",()=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.simplePrivilegeForm.unsupportedSpacePrivilegesWarning",defaultMessage:"This role contains privilege definitions for spaces, but spaces are not enabled in Kibana. Saving this role will remove these privileges."}))}render(){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{iconType:"alert",color:"warning",title:this.getMessage()})}}class privilege_form_calculator_PrivilegeFormCalculator{constructor(kibanaPrivileges,role){this.kibanaPrivileges=kibanaPrivileges;this.role=role}getBasePrivilege(privilegeIndex){const entry=this.role.kibana[privilegeIndex];const basePrivileges=this.kibanaPrivileges.getBasePrivileges(entry);return basePrivileges.find(bp=>entry.base.includes(bp.id))}getDisplayedPrimaryFeaturePrivilegeId(featureId,privilegeIndex){var _this$getDisplayedPri;return(_this$getDisplayedPri=this.getDisplayedPrimaryFeaturePrivilege(featureId,privilegeIndex))===null||_this$getDisplayedPri===void 0?void 0:_this$getDisplayedPri.id}hasCustomizedSubFeaturePrivileges(featureId,privilegeIndex){const feature=this.kibanaPrivileges.getSecuredFeature(featureId);const displayedPrimary=this.getDisplayedPrimaryFeaturePrivilege(featureId,privilegeIndex);const formPrivileges=this.kibanaPrivileges.createCollectionFromRoleKibanaPrivileges([this.role.kibana[privilegeIndex]]);return feature.getSubFeaturePrivileges().some(sfp=>{var _displayedPrimary$gra;const isGranted=formPrivileges.grantsPrivilege(sfp);const isGrantedByDisplayedPrimary=(_displayedPrimary$gra=displayedPrimary===null||displayedPrimary===void 0?void 0:displayedPrimary.grantsPrivilege(sfp))!==null&&_displayedPrimary$gra!==void 0?_displayedPrimary$gra:isGranted;return isGranted!==isGrantedByDisplayedPrimary})}getEffectivePrimaryFeaturePrivilege(featureId,privilegeIndex){const feature=this.kibanaPrivileges.getSecuredFeature(featureId);const basePrivilege=this.getBasePrivilege(privilegeIndex);const selectedFeaturePrivileges=this.getSelectedFeaturePrivileges(featureId,privilegeIndex);return feature.getPrimaryFeaturePrivileges({includeMinimalFeaturePrivileges:true}).find(fp=>selectedFeaturePrivileges.includes(fp.id)||(basePrivilege===null||basePrivilege===void 0?void 0:basePrivilege.grantsPrivilege(fp)))}isIndependentSubFeaturePrivilegeGranted(featureId,privilegeId,privilegeIndex){const kibanaPrivilege=this.role.kibana[privilegeIndex];const feature=this.kibanaPrivileges.getSecuredFeature(featureId);const subFeaturePrivilege=feature.getSubFeaturePrivileges().find(ap=>ap.id===privilegeId);const assignedPrivileges=this.kibanaPrivileges.createCollectionFromRoleKibanaPrivileges([kibanaPrivilege]);return assignedPrivileges.grantsPrivilege(subFeaturePrivilege)}getSelectedMutuallyExclusiveSubFeaturePrivilege(featureId,subFeatureGroup,privilegeIndex){const kibanaPrivilege=this.role.kibana[privilegeIndex];const assignedPrivileges=this.kibanaPrivileges.createCollectionFromRoleKibanaPrivileges([kibanaPrivilege]);return subFeatureGroup.privileges.find(p=>assignedPrivileges.grantsPrivilege(p))}canCustomizeSubFeaturePrivileges(featureId,privilegeIndex){const selectedFeaturePrivileges=this.getSelectedFeaturePrivileges(featureId,privilegeIndex);const feature=this.kibanaPrivileges.getSecuredFeature(featureId);return feature.getPrimaryFeaturePrivileges({includeMinimalFeaturePrivileges:true}).some(apfp=>selectedFeaturePrivileges.includes(apfp.id))}updateSelectedFeaturePrivilegesForCustomization(featureId,privilegeIndex,willBeCustomizing){const primary=this.getDisplayedPrimaryFeaturePrivilege(featureId,privilegeIndex);const selectedFeaturePrivileges=this.getSelectedFeaturePrivileges(featureId,privilegeIndex);if(!primary){return selectedFeaturePrivileges}const nextPrivileges=[];if(willBeCustomizing){const feature=this.kibanaPrivileges.getSecuredFeature(featureId);const startingPrivileges=feature.getSubFeaturePrivileges().filter(ap=>primary.grantsPrivilege(ap)).map(p=>p.id);nextPrivileges.push(primary.getMinimalPrivilegeId(),...startingPrivileges)}else{nextPrivileges.push(primary.id)}return nextPrivileges}hasSupersededInheritedPrivileges(privilegeIndex){const global=this.locateGlobalPrivilege(this.role);const entry=this.role.kibana[privilegeIndex];if(Object(privilege_utils["a"])(entry)||!global){return false}const globalPrivileges=this.kibanaPrivileges.createCollectionFromRoleKibanaPrivileges([global]);const formPrivileges=this.kibanaPrivileges.createCollectionFromRoleKibanaPrivileges([entry]);const hasAssignedBasePrivileges=this.kibanaPrivileges.getBasePrivileges(entry).some(base=>entry.base.includes(base.id));const featuresWithDirectlyAssignedPrivileges=this.kibanaPrivileges.getSecuredFeatures().filter(feature=>feature.getAllPrivileges().some(privilege=>{var _entry$feature$featur;return(_entry$feature$featur=entry.feature[feature.id])===null||_entry$feature$featur===void 0?void 0:_entry$feature$featur.includes(privilege.id)}));const hasSupersededBasePrivileges=hasAssignedBasePrivileges&&this.kibanaPrivileges.getBasePrivileges(entry).some(privilege=>globalPrivileges.grantsPrivilege(privilege)&&!formPrivileges.grantsPrivilege(privilege));const hasSupersededFeaturePrivileges=featuresWithDirectlyAssignedPrivileges.some(feature=>feature.getAllPrivileges().some(fp=>globalPrivileges.grantsPrivilege(fp)&&!formPrivileges.grantsPrivilege(fp)));return hasSupersededBasePrivileges||hasSupersededFeaturePrivileges}getDisplayedPrimaryFeaturePrivilege(featureId,privilegeIndex){const feature=this.kibanaPrivileges.getSecuredFeature(featureId);const basePrivilege=this.getBasePrivilege(privilegeIndex);const selectedFeaturePrivileges=this.getSelectedFeaturePrivileges(featureId,privilegeIndex);return feature.getPrimaryFeaturePrivileges().find(fp=>{const correspondingMinimalPrivilegeId=fp.getMinimalPrivilegeId();const correspendingMinimalPrivilege=feature.getMinimalFeaturePrivileges().find(mp=>mp.id===correspondingMinimalPrivilegeId);const hasMinimalPrivileges=feature.subFeatures.length>0&&fp.grantsPrivilege(correspendingMinimalPrivilege);return selectedFeaturePrivileges.includes(fp.id)||hasMinimalPrivileges&&selectedFeaturePrivileges.includes(correspondingMinimalPrivilegeId)||(basePrivilege===null||basePrivilege===void 0?void 0:basePrivilege.grantsPrivilege(fp))})}getSelectedFeaturePrivileges(featureId,privilegeIndex){var _this$role$kibana$pri;return(_this$role$kibana$pri=this.role.kibana[privilegeIndex].feature[featureId])!==null&&_this$role$kibana$pri!==void 0?_this$role$kibana$pri:[]}locateGlobalPrivilege(role){return role.kibana.find(entry=>Object(privilege_utils["a"])(entry))}}function simple_privilege_section_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class simple_privilege_section_SimplePrivilegeSection extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);simple_privilege_section_defineProperty(this,"getDisplayedBasePrivilege",()=>{if(this.state.isCustomizingGlobalPrivilege){return CUSTOM_PRIVILEGE_VALUE}const{role:role}=this.props;const form=this.locateGlobalPrivilege(role);return form&&form.base.length>0?form.base[0]:NO_PRIVILEGE_VALUE});simple_privilege_section_defineProperty(this,"onKibanaPrivilegeChange",privilege=>{const role=Object(model["c"])(this.props.role);const form=this.locateGlobalPrivilege(role)||this.createGlobalPrivilegeEntry(role);if(privilege===NO_PRIVILEGE_VALUE){role.kibana=role.kibana.filter(entry=>!Object(privilege_utils["a"])(entry))}else if(privilege===CUSTOM_PRIVILEGE_VALUE){form.base=[]}else{form.base=[privilege];form.feature={}}this.props.onChange(role);this.setState({isCustomizingGlobalPrivilege:privilege===CUSTOM_PRIVILEGE_VALUE,globalPrivsIndex:role.kibana.indexOf(form)})});simple_privilege_section_defineProperty(this,"onFeaturePrivilegeChange",(featureId,privileges)=>{const role=Object(model["c"])(this.props.role);const form=this.locateGlobalPrivilege(role)||this.createGlobalPrivilegeEntry(role);if(privileges.length>0){form.feature[featureId]=[...privileges]}else{delete form.feature[featureId]}this.props.onChange(role)});simple_privilege_section_defineProperty(this,"onChangeAllFeaturePrivileges",privileges=>{const role=Object(model["c"])(this.props.role);const form=this.locateGlobalPrivilege(role)||this.createGlobalPrivilegeEntry(role);if(privileges.length>0){this.props.kibanaPrivileges.getSecuredFeatures().forEach(feature=>{form.feature[feature.id]=[...privileges]})}else{form.feature={}}this.props.onChange(role)});simple_privilege_section_defineProperty(this,"maybeRenderSpacePrivilegeWarning",()=>{const kibanaPrivileges=this.props.role.kibana;const hasSpacePrivileges=kibanaPrivileges.some(privilege=>!Object(privilege_utils["a"])(privilege));if(hasSpacePrivileges){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true},external_kbnSharedDeps_React_default.a.createElement(unsupported_space_privileges_warning_UnsupportedSpacePrivilegesWarning,null))}return null});simple_privilege_section_defineProperty(this,"locateGlobalPrivilegeIndex",role=>role.kibana.findIndex(privileges=>Object(privilege_utils["a"])(privileges)));simple_privilege_section_defineProperty(this,"locateGlobalPrivilege",role=>{const spacePrivileges=role.kibana;return spacePrivileges.find(privileges=>Object(privilege_utils["a"])(privileges))});const globalPrivs=this.locateGlobalPrivilege(props.role);const globalPrivsIndex=this.locateGlobalPrivilegeIndex(props.role);this.state={isCustomizingGlobalPrivilege:Boolean(globalPrivs&&Object.keys(globalPrivs.feature).length>0),globalPrivsIndex:globalPrivsIndex}}render(){var _this$props$role$kiba,_this$props$role$kiba2;const kibanaPrivilege=this.getDisplayedBasePrivilege();const reservedPrivileges=(_this$props$role$kiba=(_this$props$role$kiba2=this.props.role.kibana[this.state.globalPrivsIndex])===null||_this$props$role$kiba2===void 0?void 0:_this$props$role$kiba2._reserved)!==null&&_this$props$role$kiba!==void 0?_this$props$role$kiba:[];const title=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.simplePrivilegeForm.kibanaPrivilegesTitle",defaultMessage:"Kibana privileges"});const description=external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.simplePrivilegeForm.specifyPrivilegeForRoleDescription",defaultMessage:"Specifies the Kibana privilege for this role."}));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"column"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s",color:"subdued"},description)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:title},reservedPrivileges.length>0?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{fullWidth:true,selectedOptions:reservedPrivileges.map(rp=>({label:rp})),isDisabled:true}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSuperSelect"],{disabled:!this.props.editable,onChange:this.onKibanaPrivilegeChange,options:[{value:NO_PRIVILEGE_VALUE,inputDisplay:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.simplePrivilegeForm.noPrivilegeInput",defaultMessage:"None"})),dropdownDisplay:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement("strong",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.simplePrivilegeForm.noPrivilegeDropdown",defaultMessage:"None"})),external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.simplePrivilegeForm.noPrivilegeDropdownDescription",defaultMessage:"No access to Kibana"})))},{value:CUSTOM_PRIVILEGE_VALUE,inputDisplay:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.simplePrivilegeForm.customPrivilegeInput",defaultMessage:"Custom"})),dropdownDisplay:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement("strong",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.simplePrivilegeForm.customPrivilegeDropdown",defaultMessage:"Custom"})),external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.simplePrivilegeForm.customPrivilegeDropdownDescription",defaultMessage:"Customize access to Kibana"})))},{value:"read",inputDisplay:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.simplePrivilegeForm.readPrivilegeInput",defaultMessage:"Read"})),dropdownDisplay:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement("strong",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.simplePrivilegeForm.readPrivilegeDropdown",defaultMessage:"Read"})),external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.simplePrivilegeForm.readPrivilegeDropdownDescription",defaultMessage:"Grants read-only access to all of Kibana"})))},{value:"all",inputDisplay:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.simplePrivilegeForm.allPrivilegeInput",defaultMessage:"All"})),dropdownDisplay:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement("strong",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.simplePrivilegeForm.allPrivilegeDropdown",defaultMessage:"All"})),external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.simplePrivilegeForm.allPrivilegeDropdownDescription",defaultMessage:"Grants full access to all of Kibana"})))}],hasDividers:true,valueOfSelected:kibanaPrivilege})),this.state.isCustomizingGlobalPrivilege&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true},external_kbnSharedDeps_React_default.a.createElement(feature_table_FeatureTable,{role:this.props.role,kibanaPrivileges:this.props.kibanaPrivileges,privilegeCalculator:new privilege_form_calculator_PrivilegeFormCalculator(this.props.kibanaPrivileges,this.props.role),onChange:this.onFeaturePrivilegeChange,onChangeAll:this.onChangeAllFeaturePrivileges,privilegeIndex:this.props.role.kibana.findIndex(k=>Object(privilege_utils["a"])(k)),canCustomizeSubFeaturePrivileges:this.props.canCustomizeSubFeaturePrivileges})),this.maybeRenderSpacePrivilegeWarning())))}createGlobalPrivilegeEntry(role){const newEntry={spaces:["*"],base:[],feature:{}};role.kibana.push(newEntry);return newEntry}}var privilege_space_table=__webpack_require__(271);var public_=__webpack_require__(75);const PrivilegeDisplay=props=>external_kbnSharedDeps_React_default.a.createElement(SimplePrivilegeDisplay,props);const SimplePrivilegeDisplay=props=>{const{privilege:privilege,...rest}=props;const text=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],rest,getDisplayValue(privilege));return text};PrivilegeDisplay.defaultProps={privilege:[]};function getDisplayValue(privilege){const privileges=coerceToArray(privilege);let displayValue;const isPrivilegeMissing=privileges.length===0||privileges.length===1&&privileges.includes(NO_PRIVILEGE_VALUE);if(isPrivilegeMissing){displayValue=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{color:"subdued",type:"minusInCircle"})}else{displayValue=privileges.map(p=>external_kbnSharedDeps_Lodash_default.a.upperFirst(p)).join(", ")}return displayValue}function coerceToArray(privilege){if(privilege===undefined){return[]}if(Array.isArray(privilege)){return privilege}return[privilege]}function privilege_space_table_extends(){privilege_space_table_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return privilege_space_table_extends.apply(this,arguments)}function privilege_space_table_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const SPACES_DISPLAY_COUNT=4;class privilege_space_table_PrivilegeSpaceTable extends external_kbnSharedDeps_React_["Component"]{constructor(...args){super(...args);privilege_space_table_defineProperty(this,"state",{expandedSpacesGroups:[]});privilege_space_table_defineProperty(this,"renderKibanaPrivileges",()=>{const{privilegeCalculator:privilegeCalculator,displaySpaces:displaySpaces}=this.props;const spacePrivileges=this.getSortedPrivileges();const rows=spacePrivileges.map((spacePrivs,privilegeIndex)=>{const spaces=spacePrivs.spaces.map(spaceId=>displaySpaces.find(space=>space.id===spaceId)||{id:spaceId,name:spaceId,disabledFeatures:[],deleted:true});return{spaces:spaces,privilegeIndex:privilegeIndex,isGlobal:Object(privilege_utils["a"])(spacePrivs),privileges:{spaces:spacePrivs.spaces,base:spacePrivs.base||[],feature:spacePrivs.feature||{},reserved:spacePrivs._reserved||[]}}});const getExtraBadgeProps=space=>{if(space.deleted){return{iconType:"trash"}}return{}};const columns=[{field:"spaces",name:"Spaces",width:"60%",render:(spaces,record)=>{const isExpanded=this.state.expandedSpacesGroups.includes(record.privilegeIndex);const displayedSpaces=isExpanded?spaces:spaces.slice(0,SPACES_DISPLAY_COUNT);let button=null;if(spaces.length>displayedSpaces.length){button=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{size:"xs",onClick:()=>this.toggleExpandSpacesGroup(record.privilegeIndex)},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.spacePrivilegeTable.showNMoreSpacesLink",defaultMessage:"+{count} more",values:{count:spaces.length-displayedSpaces.length}}))}else if(isExpanded){button=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{size:"xs",onClick:()=>this.toggleExpandSpacesGroup(record.privilegeIndex)},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.spacePrivilegeTable.showLessSpacesLink",defaultMessage:"show less"}))}return external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement("span",{"data-test-subj":"spacesColumn"},displayedSpaces.map(space=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBadge"],privilege_space_table_extends({key:space.id},getExtraBadgeProps(space),{color:Object(public_["getSpaceColor"])(space)}),space.name))),button)}},{field:"privileges",name:"Privileges",render:(privileges,record)=>{var _privilegeCalculator$,_privilegeCalculator$2;if(privileges.reserved.length>0){return external_kbnSharedDeps_React_default.a.createElement(PrivilegeDisplay,{privilege:privileges.reserved,"data-test-subj":`privilegeColumn`})}let icon=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:"empty",size:"s"});if(privilegeCalculator.hasSupersededInheritedPrivileges(record.privilegeIndex)){icon=external_kbnSharedDeps_React_default.a.createElement("span",{"data-test-subj":"spaceTablePrivilegeSupersededWarning"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIconTip"],{type:"alert",size:"s",content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.spacePrivilegeTable.supersededPrivilegeWarning",defaultMessage:"Privileges are superseded by configured global privilege. View the privilege summary to see effective privileges."})}))}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xs",alignItems:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},icon),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(PrivilegeDisplay,{privilege:(_privilegeCalculator$=(_privilegeCalculator$2=privilegeCalculator.getBasePrivilege(record.privilegeIndex))===null||_privilegeCalculator$2===void 0?void 0:_privilegeCalculator$2.id)!==null&&_privilegeCalculator$!==void 0?_privilegeCalculator$:CUSTOM_PRIVILEGE_VALUE,"data-test-subj":`privilegeColumn`})))}}];if(!this.props.disabled){columns.push({name:"Actions",actions:[{render:record=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.spacePrivilegeTable.editPrivilegesLabel",{defaultMessage:`Edit privileges for the following spaces: {spaceNames}.`,values:{spaceNames:record.spaces.map(s=>s.name).join(", ")}}),color:"primary",iconType:"pencil",onClick:()=>this.props.onEdit(record.privilegeIndex)})},{render:record=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.spacePrivilegeTable.deletePrivilegesLabel",{defaultMessage:`Delete privileges for the following spaces: {spaceNames}.`,values:{spaceNames:record.spaces.map(s=>s.name).join(", ")}}),color:"danger",iconType:"trash",onClick:()=>this.onDeleteSpacePrivilege(record)})}]})}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiInMemoryTable"],{columns:columns,items:rows,hasActions:true,rowProps:item=>({className:Object(privilege_utils["a"])(item.privileges)?"secPrivilegeTable__row--isGlobalSpace":""})})});privilege_space_table_defineProperty(this,"getSortedPrivileges",()=>{const spacePrivileges=this.props.role.kibana;return spacePrivileges.sort((priv1,priv2)=>Object(privilege_utils["a"])(priv1)?-1:Object(privilege_utils["a"])(priv2)?1:0)});privilege_space_table_defineProperty(this,"toggleExpandSpacesGroup",privilegeIndex=>{if(this.state.expandedSpacesGroups.includes(privilegeIndex)){this.setState({expandedSpacesGroups:this.state.expandedSpacesGroups.filter(i=>i!==privilegeIndex)})}else{this.setState({expandedSpacesGroups:[...this.state.expandedSpacesGroups,privilegeIndex]})}});privilege_space_table_defineProperty(this,"onDeleteSpacePrivilege",item=>{const roleCopy=Object(model["c"])(this.props.role);roleCopy.kibana.splice(item.privilegeIndex,1);this.props.onChange(roleCopy);this.setState({expandedSpacesGroups:this.state.expandedSpacesGroups.filter(i=>i!==item.privilegeIndex)})})}render(){return this.renderKibanaPrivileges()}}function space_selector_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const spaceToOption=(space,currentSelection)=>{if(!space){return}return{id:`spaceOption_${space.id}`,label:space.name,color:Object(public_["getSpaceColor"])(space),disabled:currentSelection==="global"&&space.id!=="*"||currentSelection==="spaces"&&space.id==="*"}};const spaceIdToOption=spaces=>s=>spaceToOption(spaces.find(space=>space.id===s));class space_selector_SpaceSelector extends external_kbnSharedDeps_React_["Component"]{constructor(...args){super(...args);space_selector_defineProperty(this,"onChange",selectedSpaces=>{this.props.onChange(selectedSpaces.map(s=>s.id.split("spaceOption_")[1]))});space_selector_defineProperty(this,"getOptions",()=>{const options=this.props.spaces.map(space=>spaceToOption(space,this.props.selectedSpaceIds.includes("*")?"global":this.props.selectedSpaceIds.length>0?"spaces":undefined));return options.filter(Boolean)});space_selector_defineProperty(this,"getSelectedOptions",()=>{const options=this.props.selectedSpaceIds.map(spaceIdToOption(this.props.spaces));return options.filter(Boolean)})}render(){const renderOption=(option,searchValue,contentClassName)=>{const{color:color,label:label}=option;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHealth"],{color:color},external_kbnSharedDeps_React_default.a.createElement("span",{className:contentClassName},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHighlight"],{search:searchValue},label)))};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{"data-test-subj":"spaceSelectorComboBox","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.spaceSelectorLabel",{defaultMessage:"Spaces"}),fullWidth:true,options:this.getOptions(),renderOption:renderOption,selectedOptions:this.getSelectedOptions(),isDisabled:this.props.disabled,onChange:this.onChange})}}function privilege_space_form_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class privilege_space_form_PrivilegeSpaceForm extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);privilege_space_form_defineProperty(this,"getForm",()=>{const{spaces:spaces}=this.props;const hasSelectedSpaces=this.state.selectedSpaceIds.length>0;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiForm"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true,label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.spacePrivilegeForm.spaceSelectorFormLabel",{defaultMessage:"Spaces"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.spacePrivilegeForm.spaceSelectorFormHelpText",{defaultMessage:"Select one or more Kibana spaces to which you wish to assign privileges."})},external_kbnSharedDeps_React_default.a.createElement(space_selector_SpaceSelector,{selectedSpaceIds:this.state.selectedSpaceIds,onChange:this.onSelectedSpacesChange,spaces:spaces})),this.getPrivilegeCallout(),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true,label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.spacePrivilegeForm.privilegeSelectorFormLabel",{defaultMessage:"Privileges for all features"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.spacePrivilegeForm.privilegeSelectorFormHelpText",{defaultMessage:"Assign the privilege level you wish to grant to all present and future features across this space."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonGroup"],{name:`basePrivilegeButtonGroup`,"data-test-subj":`basePrivilegeButtonGroup`,isFullWidth:true,color:"primary",options:[{id:"basePrivilege_all",label:"All",["data-test-subj"]:"basePrivilege_all"},{id:"basePrivilege_read",label:"Read",["data-test-subj"]:"basePrivilege_read"},{id:"basePrivilege_custom",label:"Customize",["data-test-subj"]:"basePrivilege_custom"}],idSelected:this.getDisplayedBasePrivilege(),isDisabled:!hasSelectedSpaces,onChange:this.onSpaceBasePrivilegeChange,legend:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.spacePrivilegeForm.basePrivilegeControlLegend",{defaultMessage:"Privileges for all features"})})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xxs"},external_kbnSharedDeps_React_default.a.createElement("h3",null,this.getFeatureListLabel(this.state.selectedBasePrivilege.length>0))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xs"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("p",null,this.getFeatureListDescription(this.state.selectedBasePrivilege.length>0))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}),external_kbnSharedDeps_React_default.a.createElement(feature_table_FeatureTable,{role:this.state.role,privilegeCalculator:this.state.privilegeCalculator,onChange:this.onFeaturePrivilegesChange,onChangeAll:this.onChangeAllFeaturePrivileges,kibanaPrivileges:this.props.kibanaPrivileges,privilegeIndex:this.state.privilegeIndex,canCustomizeSubFeaturePrivileges:this.props.canCustomizeSubFeaturePrivileges,disabled:this.state.selectedBasePrivilege.length>0||!hasSelectedSpaces}),this.requiresGlobalPrivilegeWarning()&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{color:"warning",iconType:"alert","data-test-subj":"globalPrivilegeWarning",title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.spacePrivilegeForm.globalPrivilegeWarning",defaultMessage:"Creating a global privilege might impact your other space privileges."})})))});privilege_space_form_defineProperty(this,"getSaveButton",()=>{const{mode:mode}=this.state;const isGlobal=this.isDefiningGlobalPrivilege();let buttonText;switch(mode){case"create":if(isGlobal){buttonText=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRolespacePrivilegeForm.createGlobalPrivilegeButton",defaultMessage:"Create global privilege"})}else{buttonText=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRolespacePrivilegeForm.createPrivilegeButton",defaultMessage:"Add Kibana privilege"})}break;case"update":if(isGlobal){buttonText=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRolespacePrivilegeForm.updateGlobalPrivilegeButton",defaultMessage:"Update global privilege"})}else{buttonText=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRolespacePrivilegeForm.updatePrivilegeButton",defaultMessage:"Update space privilege"})}break;default:throw new Error(`Unsupported mode: ${mode}`)}let buttonColor="primary";if(this.requiresGlobalPrivilegeWarning()){buttonColor="warning"}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:this.onSaveClick,fill:true,disabled:!this.canSave(),color:buttonColor,"data-test-subj":"createSpacePrivilegeButton"},buttonText)});privilege_space_form_defineProperty(this,"getFeatureListLabel",disabled=>{if(disabled){return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.spacePrivilegeForm.summaryOfFeaturePrivileges",{defaultMessage:"Summary of feature privileges"})}else{return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.spacePrivilegeForm.customizeFeaturePrivileges",{defaultMessage:"Customize by feature"})}});privilege_space_form_defineProperty(this,"getFeatureListDescription",disabled=>{if(disabled){return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.spacePrivilegeForm.featurePrivilegeSummaryDescription",{defaultMessage:"Some features might be hidden by the space or affected by a global space privilege."})}else{return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.spacePrivilegeForm.customizeFeaturePrivilegeDescription",{defaultMessage:"Increase privilege levels on a per feature basis. Some features might be hidden by the space or affected by a global space privilege."})}});privilege_space_form_defineProperty(this,"getPrivilegeCallout",()=>{if(this.isDefiningGlobalPrivilege()){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{color:"primary",iconType:"iInCircle",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.spacePrivilegeForm.globalPrivilegeNotice",{defaultMessage:"These privileges will apply to all current and future spaces."})}))}return null});privilege_space_form_defineProperty(this,"closeFlyout",()=>{this.props.onCancel()});privilege_space_form_defineProperty(this,"onSaveClick",()=>{const role=Object(model["c"])(this.state.role);const form=role.kibana[this.state.privilegeIndex];if(!this.isDefiningGlobalPrivilege()){form.spaces=form.spaces.filter(spaceId=>this.props.spaces.find(space=>space.id===spaceId))}this.props.onChange(role)});privilege_space_form_defineProperty(this,"onSelectedSpacesChange",selectedSpaceIds=>{const role=Object(model["c"])(this.state.role);const form=role.kibana[this.state.privilegeIndex];form.spaces=[...selectedSpaceIds];this.setState({selectedSpaceIds:selectedSpaceIds,role:role,privilegeCalculator:new privilege_form_calculator_PrivilegeFormCalculator(this.props.kibanaPrivileges,role)})});privilege_space_form_defineProperty(this,"onSpaceBasePrivilegeChange",basePrivilege=>{const role=Object(model["c"])(this.state.role);const form=role.kibana[this.state.privilegeIndex];const privilegeName=basePrivilege.split("basePrivilege_")[1];let isCustomizingFeaturePrivileges=false;if(privilegeName===CUSTOM_PRIVILEGE_VALUE){form.base=[];isCustomizingFeaturePrivileges=true}else{form.base=[privilegeName];form.feature={}}this.setState({selectedBasePrivilege:privilegeName===CUSTOM_PRIVILEGE_VALUE?[]:[privilegeName],role:role,isCustomizingFeaturePrivileges:isCustomizingFeaturePrivileges,privilegeCalculator:new privilege_form_calculator_PrivilegeFormCalculator(this.props.kibanaPrivileges,role)})});privilege_space_form_defineProperty(this,"getDisplayedBasePrivilege",()=>{const basePrivilege=this.state.privilegeCalculator.getBasePrivilege(this.state.privilegeIndex);if(basePrivilege){return`basePrivilege_${basePrivilege.id}`}return`basePrivilege_${CUSTOM_PRIVILEGE_VALUE}`});privilege_space_form_defineProperty(this,"onFeaturePrivilegesChange",(featureId,privileges)=>{const role=Object(model["c"])(this.state.role);const form=role.kibana[this.state.privilegeIndex];if(privileges.length===0){delete form.feature[featureId]}else{form.feature[featureId]=[...privileges]}this.setState({role:role,privilegeCalculator:new privilege_form_calculator_PrivilegeFormCalculator(this.props.kibanaPrivileges,role)})});privilege_space_form_defineProperty(this,"onChangeAllFeaturePrivileges",privileges=>{const role=Object(model["c"])(this.state.role);const entry=role.kibana[this.state.privilegeIndex];if(privileges.length===0){entry.feature={}}else{this.props.kibanaPrivileges.getSecuredFeatures().forEach(feature=>{const nextFeaturePrivilege=feature.getPrimaryFeaturePrivileges().find(pfp=>privileges.includes(pfp.id));if(nextFeaturePrivilege){entry.feature[feature.id]=[nextFeaturePrivilege.id]}})}this.setState({role:role,privilegeCalculator:new privilege_form_calculator_PrivilegeFormCalculator(this.props.kibanaPrivileges,role)})});privilege_space_form_defineProperty(this,"canSave",()=>{if(this.state.selectedSpaceIds.length===0){return false}const form=this.state.role.kibana[this.state.privilegeIndex];if(form.base.length===0&&Object.keys(form.feature).length===0){return false}return true});privilege_space_form_defineProperty(this,"isDefiningGlobalPrivilege",()=>this.state.selectedSpaceIds.includes("*"));privilege_space_form_defineProperty(this,"requiresGlobalPrivilegeWarning",()=>{const hasOtherSpacePrivilegesDefined=this.props.role.kibana.length>0;return this.state.mode==="create"&&this.isDefiningGlobalPrivilege()&&hasOtherSpacePrivilegesDefined});const _role=Object(model["c"])(props.role);let privilegeIndex=props.privilegeIndex;if(privilegeIndex<0){privilegeIndex=_role.kibana.push({spaces:[],base:[],feature:{}})-1}this.state={role:_role,privilegeIndex:privilegeIndex,selectedSpaceIds:[..._role.kibana[privilegeIndex].spaces],selectedBasePrivilege:[..._role.kibana[privilegeIndex].base||[]],mode:props.privilegeIndex<0?"create":"update",isCustomizingFeaturePrivileges:false,privilegeCalculator:new privilege_form_calculator_PrivilegeFormCalculator(props.kibanaPrivileges,_role)}}render(){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiOverlayMask"],{headerZindexLocation:"below"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyout"],{onClose:this.closeFlyout,size:"m",maxWidth:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutHeader"],{hasBorder:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"m"},external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.spacePrivilegeForm.modalTitle",defaultMessage:"Kibana privileges"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiErrorBoundary"],null,this.getForm())),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutFooter"],null,this.state.privilegeCalculator.hasSupersededInheritedPrivileges(this.state.privilegeIndex)&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{color:"warning",iconType:"alert","data-test-subj":"spaceFormGlobalPermissionsSupersedeWarning",title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.spacePrivilegeForm.supersededWarningTitle",defaultMessage:"Superseded by global privileges"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.spacePrivilegeForm.supersededWarning",defaultMessage:"Declared privileges are less permissive than configured global privileges. View the privilege summary to see effective privileges."})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{iconType:"cross",onClick:this.closeFlyout,flush:"left","data-test-subj":"cancelSpacePrivilegeButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.spacePrivilegeForm.cancelButton",defaultMessage:"Cancel"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},this.getSaveButton())))))}}privilege_space_form_defineProperty(privilege_space_form_PrivilegeSpaceForm,"defaultProps",{privilegeIndex:-1});var spaces_popover_list=__webpack_require__(280);var common_=__webpack_require__(79);function spaces_popover_list_extends(){spaces_popover_list_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return spaces_popover_list_extends.apply(this,arguments)}function spaces_popover_list_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class spaces_popover_list_SpacesPopoverList extends external_kbnSharedDeps_React_["Component"]{constructor(...args){super(...args);spaces_popover_list_defineProperty(this,"state",{searchTerm:"",allowSpacesListFocus:false,isPopoverOpen:false});spaces_popover_list_defineProperty(this,"getMenuPanel",()=>{const{searchTerm:searchTerm}=this.state;const items=this.getVisibleSpaces(searchTerm).map(this.renderSpaceMenuItem);const panelProps={className:"spcMenu",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.spacesPopoverList.popoverTitle",{defaultMessage:"Spaces"}),watchedItemProps:["data-search-term"]};if(this.props.spaces.length>=common_["SPACE_SEARCH_COUNT_THRESHOLD"]){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiContextMenuPanel"],panelProps,this.renderSearchField(),this.renderSpacesListPanel(items,searchTerm))}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiContextMenuPanel"],spaces_popover_list_extends({},panelProps,{items:items}))});spaces_popover_list_defineProperty(this,"onButtonClick",()=>{this.setState({isPopoverOpen:!this.state.isPopoverOpen,searchTerm:""})});spaces_popover_list_defineProperty(this,"closePopover",()=>{this.setState({isPopoverOpen:false,searchTerm:""})});spaces_popover_list_defineProperty(this,"getVisibleSpaces",searchTerm=>{const{spaces:spaces}=this.props;let filteredSpaces=spaces;if(searchTerm){filteredSpaces=spaces.filter(space=>{const{name:name,description:description=""}=space;return name.toLowerCase().indexOf(searchTerm)>=0||description.toLowerCase().indexOf(searchTerm)>=0})}return filteredSpaces});spaces_popover_list_defineProperty(this,"renderSpacesListPanel",(items,searchTerm)=>{if(items.length===0){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{color:"subdued",className:"eui-textCenter"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.spacesPopoverList.noSpacesFoundTitle",defaultMessage:" no spaces found "}))}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiContextMenuPanel"],{key:`spcMenuList`,"data-search-term":searchTerm,className:"spcMenu__spacesList",hasFocus:this.state.allowSpacesListFocus,initialFocusedItemIndex:this.state.allowSpacesListFocus?0:undefined,items:items})});spaces_popover_list_defineProperty(this,"renderSearchField",()=>external_kbnSharedDeps_React_default.a.createElement("div",{key:"manageSpacesSearchField",className:"spcMenu__searchFieldWrapper"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldSearch"],{placeholder:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.spacesPopoverList.findSpacePlaceholder",{defaultMessage:"Find a space"}),incremental:true,onSearch:this.onSearch,onKeyDown:this.onSearchKeyDown,onFocus:this.onSearchFocus,compressed:true})));spaces_popover_list_defineProperty(this,"onSearchKeyDown",e=>{const focusableKeyCodes=[9,13,40];const keyCode=e.keyCode;if(focusableKeyCodes.includes(keyCode)){this.setState({allowSpacesListFocus:true})}});spaces_popover_list_defineProperty(this,"onSearchFocus",()=>{this.setState({allowSpacesListFocus:false})});spaces_popover_list_defineProperty(this,"onSearch",searchTerm=>{this.setState({searchTerm:searchTerm.trim().toLowerCase()})});spaces_popover_list_defineProperty(this,"renderSpaceMenuItem",space=>{const icon=external_kbnSharedDeps_React_default.a.createElement(public_["SpaceAvatar"],{space:space,size:"s"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiContextMenuItem"],{key:space.id,icon:icon,toolTipTitle:space.description&&space.name,toolTipContent:space.description},space.name)})}render(){const button=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{size:"xs",onClick:this.onButtonClick},external_kbnSharedDeps_React_default.a.createElement("span",{className:"secSpacesPopoverList__buttonText"},this.props.buttonText));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopover"],{id:"spacesPopoverList",button:button,isOpen:this.state.isPopoverOpen,closePopover:this.closePopover,panelPaddingSize:"none",anchorPosition:"downLeft",ownFocus:true},this.getMenuPanel())}}const space_column_header_SPACES_DISPLAY_COUNT=4;const SpaceColumnHeader=props=>{const isGlobal=Object(privilege_utils["a"])(props.entry);const entrySpaces=props.entry.spaces.map(spaceId=>{var _props$spaces$find;return(_props$spaces$find=props.spaces.find(s=>s.id===spaceId))!==null&&_props$spaces$find!==void 0?_props$spaces$find:{id:spaceId,name:spaceId,disabledFeatures:[]}});return external_kbnSharedDeps_React_default.a.createElement("div",null,entrySpaces.slice(0,space_column_header_SPACES_DISPLAY_COUNT).map(space=>external_kbnSharedDeps_React_default.a.createElement("span",{key:space.id},external_kbnSharedDeps_React_default.a.createElement(public_["SpaceAvatar"],{size:"s",space:space})," ",isGlobal&&external_kbnSharedDeps_React_default.a.createElement("span",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.spacePrivilegeMatrix.globalSpaceName",defaultMessage:"All Spaces"})))),entrySpaces.length>space_column_header_SPACES_DISPLAY_COUNT&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement("br",null),external_kbnSharedDeps_React_default.a.createElement(spaces_popover_list_SpacesPopoverList,{spaces:entrySpaces,buttonText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.spacePrivilegeMatrix.showNMoreSpacesLink",{defaultMessage:"+{count} more",values:{count:entrySpaces.length-space_column_header_SPACES_DISPLAY_COUNT}})})))};const PrivilegeSummaryExpandedRow=props=>{return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"column"},props.feature.getSubFeatures().map(subFeature=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{key:subFeature.name,"data-test-subj":"subFeatureEntry"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s","data-test-subj":"subFeatureName"},subFeature.name)),props.effectiveFeaturePrivileges.map((privs,index)=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{key:index,"data-test-subj":`entry-${index}`},subFeature.getPrivilegeGroups().map(renderPrivilegeGroup(privs.subFeature))))))));function renderPrivilegeGroup(effectiveSubFeaturePrivileges){return(privilegeGroup,index)=>{switch(privilegeGroup.groupType){case"independent":return renderIndependentPrivilegeGroup(effectiveSubFeaturePrivileges,privilegeGroup,index);case"mutually_exclusive":return renderMutuallyExclusivePrivilegeGroup(effectiveSubFeaturePrivileges,privilegeGroup,index);default:throw new Error(`Unsupported privilege group type: ${privilegeGroup.groupType}`)}}}function renderIndependentPrivilegeGroup(effectiveSubFeaturePrivileges,privilegeGroup,index){return external_kbnSharedDeps_React_default.a.createElement("div",{key:index},privilegeGroup.privileges.map(privilege=>{const isGranted=effectiveSubFeaturePrivileges.includes(privilege.id);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"s","data-test-subj":"independentPrivilege",key:privilege.id},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIconTip"],{type:isGranted?"check":"cross",color:isGranted?"primary":"danger",content:isGranted?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.privilegeSummary.privilegeGrantedIconTip",{defaultMessage:"Privilege is granted"}):external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.privilegeSummary.privilegeNotGrantedIconTip",{defaultMessage:"Privilege is not granted"})})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s","data-test-subj":"privilegeName"},privilege.name)))}))}function renderMutuallyExclusivePrivilegeGroup(effectiveSubFeaturePrivileges,privilegeGroup,index){var _privilegeGroup$privi;const firstSelectedPrivilege=(_privilegeGroup$privi=privilegeGroup.privileges.find(p=>effectiveSubFeaturePrivileges.includes(p.id)))===null||_privilegeGroup$privi===void 0?void 0:_privilegeGroup$privi.name;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"s",key:index,"data-test-subj":"mutexPrivilege"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIconTip"],{type:firstSelectedPrivilege?"check":"cross",color:firstSelectedPrivilege?"primary":"danger",content:firstSelectedPrivilege?"Privilege is granted":"Privilege is not granted"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s","data-test-subj":"privilegeName"},firstSelectedPrivilege!==null&&firstSelectedPrivilege!==void 0?firstSelectedPrivilege:"None")))}};class privilege_summary_calculator_PrivilegeSummaryCalculator{constructor(kibanaPrivileges,role){this.kibanaPrivileges=kibanaPrivileges;this.role=role}getEffectiveFeaturePrivileges(entry){const assignedPrivileges=this.collectAssignedPrivileges(entry);const features=this.kibanaPrivileges.getSecuredFeatures();return features.reduce((acc,feature)=>{const displayedPrimaryFeaturePrivilege=this.getDisplayedPrimaryFeaturePrivilege(assignedPrivileges,feature);const effectiveSubPrivileges=feature.getSubFeaturePrivileges().filter(ap=>assignedPrivileges.grantsPrivilege(ap));const hasCustomizedSubFeaturePrivileges=this.hasCustomizedSubFeaturePrivileges(feature,displayedPrimaryFeaturePrivilege,entry);return{...acc,[feature.id]:{primary:displayedPrimaryFeaturePrivilege,hasCustomizedSubFeaturePrivileges:hasCustomizedSubFeaturePrivileges,subFeature:effectiveSubPrivileges.map(p=>p.id)}}},{})}hasCustomizedSubFeaturePrivileges(feature,displayedPrimaryFeaturePrivilege,entry){const formPrivileges=this.collectAssignedPrivileges(entry);return feature.getSubFeaturePrivileges().some(sfp=>{var _displayedPrimaryFeat;const isGranted=formPrivileges.grantsPrivilege(sfp);const isGrantedByDisplayedPrimary=(_displayedPrimaryFeat=displayedPrimaryFeaturePrivilege===null||displayedPrimaryFeaturePrivilege===void 0?void 0:displayedPrimaryFeaturePrivilege.grantsPrivilege(sfp))!==null&&_displayedPrimaryFeat!==void 0?_displayedPrimaryFeat:isGranted;return isGranted!==isGrantedByDisplayedPrimary})}getDisplayedPrimaryFeaturePrivilege(assignedPrivileges,feature){const primaryFeaturePrivileges=feature.getPrimaryFeaturePrivileges();const minimalPrimaryFeaturePrivileges=feature.getMinimalFeaturePrivileges();const hasMinimalPrivileges=feature.subFeatures.length>0;const effectivePrivilege=primaryFeaturePrivileges.find(pfp=>{const isPrimaryGranted=assignedPrivileges.grantsPrivilege(pfp);if(!isPrimaryGranted&&hasMinimalPrivileges){const correspondingMinimal=minimalPrimaryFeaturePrivileges.find(mpfp=>mpfp.id===pfp.getMinimalPrivilegeId());return assignedPrivileges.grantsPrivilege(correspondingMinimal)}return isPrimaryGranted});return effectivePrivilege}collectAssignedPrivileges(entry){if(Object(privilege_utils["a"])(entry)){return this.kibanaPrivileges.createCollectionFromRoleKibanaPrivileges([entry])}const globalPrivilege=this.locateGlobalPrivilege(this.role);return this.kibanaPrivileges.createCollectionFromRoleKibanaPrivileges(globalPrivilege?[globalPrivilege,entry]:[entry])}locateGlobalPrivilege(role){return role.kibana.find(entry=>Object(privilege_utils["a"])(entry))}}function getColumnKey(entry){return`privilege_entry_${entry.spaces.join("|")}`}const PrivilegeSummaryTable=props=>{const[expandedFeatures,setExpandedFeatures]=Object(external_kbnSharedDeps_React_["useState"])([]);const featureCategories=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{const featureCategoryMap=new Map;props.kibanaPrivileges.getSecuredFeatures().filter(feature=>feature.privileges!=null||feature.reserved!=null).forEach(feature=>{if(!featureCategoryMap.has(feature.category.id)){featureCategoryMap.set(feature.category.id,[])}featureCategoryMap.get(feature.category.id).push(feature)});return featureCategoryMap},[props.kibanaPrivileges]);const calculator=new privilege_summary_calculator_PrivilegeSummaryCalculator(props.kibanaPrivileges,props.role);const toggleExpandedFeature=featureId=>{if(expandedFeatures.includes(featureId)){setExpandedFeatures(expandedFeatures.filter(ef=>ef!==featureId))}else{setExpandedFeatures([...expandedFeatures,featureId])}};const featureColumn={name:"Feature",field:"feature",render:feature=>external_kbnSharedDeps_React_default.a.createElement(FeatureTableCell,{feature:feature})};const rowExpanderColumn={align:"right",width:"40px",isExpander:true,field:"featureId",name:"",render:(featureId,record)=>{const feature=record.feature;const hasSubFeaturePrivileges=feature.getSubFeaturePrivileges().length>0;if(!hasSubFeaturePrivileges){return null}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{onClick:()=>toggleExpandedFeature(featureId),"data-test-subj":`expandPrivilegeSummaryRow`,"aria-label":expandedFeatures.includes(featureId)?"Collapse":"Expand",iconType:expandedFeatures.includes(featureId)?"arrowUp":"arrowDown"})}};const rawKibanaPrivileges=[...props.role.kibana].sort((entry1,entry2)=>{if(Object(privilege_utils["a"])(entry1)){return-1}if(Object(privilege_utils["a"])(entry2)){return 1}return 0});const privilegeColumns=rawKibanaPrivileges.map(entry=>{const key=getColumnKey(entry);return{name:external_kbnSharedDeps_React_default.a.createElement(SpaceColumnHeader,{entry:entry,spaces:props.spaces}),field:key,render:(kibanaPrivilege,record)=>{var _primary$name;const{primary:primary,hasCustomizedSubFeaturePrivileges:hasCustomizedSubFeaturePrivileges}=kibanaPrivilege[record.featureId];let iconTip=null;if(hasCustomizedSubFeaturePrivileges){iconTip=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIconTip"],{size:"s",type:"iInCircle",content:external_kbnSharedDeps_React_default.a.createElement("span",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.privilegeSummary.additionalPrivilegesGrantedIconTip",defaultMessage:"Additional privileges granted. Expand this row for more information."}))})}else{iconTip=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{size:"s",type:"empty"})}return external_kbnSharedDeps_React_default.a.createElement("span",{"data-test-subj":`privilegeColumn ${hasCustomizedSubFeaturePrivileges?"additionalPrivilegesGranted":""}`},(_primary$name=primary===null||primary===void 0?void 0:primary.name)!==null&&_primary$name!==void 0?_primary$name:"None"," ",iconTip)}}});const columns=[];if(props.canCustomizeSubFeaturePrivileges){columns.push(rowExpanderColumn)}columns.push(featureColumn,...privilegeColumns);const privileges=rawKibanaPrivileges.reduce((acc,entry)=>({...acc,[getColumnKey(entry)]:calculator.getEffectiveFeaturePrivileges(entry)}),{});const accordions=[];featureCategories.forEach(featuresInCategory=>{const{category:category}=featuresInCategory[0];const buttonContent=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{"data-test-subj":`featureCategoryButton_${category.id}`,alignItems:"center",responsive:false,gutterSize:"m"},category.euiIconType?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{size:"m",type:category.euiIconType})):null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h4",{className:"eui-displayInlineBlock"},category.label))));const categoryItems=featuresInCategory.map(feature=>({feature:feature,featureId:feature.id,...privileges}));accordions.push(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiAccordion"],{id:`privilegeSummaryFeatureCategory_${category.id}`,"data-test-subj":`privilegeSummaryFeatureCategory_${category.id}`,key:category.id,buttonContent:buttonContent,initialIsOpen:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiInMemoryTable"],{columns:columns,items:categoryItems,itemId:"featureId",rowProps:record=>({"data-test-subj":`summaryTableRow-${record.featureId}`}),itemIdToExpandedRowMap:expandedFeatures.reduce((acc,featureId)=>({...acc,[featureId]:external_kbnSharedDeps_React_default.a.createElement(PrivilegeSummaryExpandedRow,{feature:props.kibanaPrivileges.getSecuredFeature(featureId),effectiveFeaturePrivileges:Object.values(privileges).map(p=>p[featureId])})}),{})})))});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,accordions.map((a,idx)=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],{key:idx},a,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null))))};const PrivilegeSummary=props=>{const[isOpen,setIsOpen]=Object(external_kbnSharedDeps_React_["useState"])(false);const numberOfPrivilegeDefinitions=props.role.kibana.length;const flyoutSize=numberOfPrivilegeDefinitions>5?"l":"m";return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:()=>setIsOpen(true),"data-test-subj":"viewPrivilegeSummaryButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.privilegeSummary.viewSummaryButtonText",defaultMessage:"View privilege summary"})),isOpen&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiOverlayMask"],{headerZindexLocation:"below"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyout"],{onClose:()=>setIsOpen(false),size:flyoutSize},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"m"},external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.privilegeSummary.modalHeaderTitle",defaultMessage:"Privilege summary"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutBody"],null,external_kbnSharedDeps_React_default.a.createElement(PrivilegeSummaryTable,{role:props.role,spaces:props.spaces,kibanaPrivileges:props.kibanaPrivileges,canCustomizeSubFeaturePrivileges:props.canCustomizeSubFeaturePrivileges})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutFooter"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:()=>setIsOpen(false)},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.privilegeSummary.closeSummaryButtonText",defaultMessage:"Close"}))))))};function space_aware_privilege_section_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class space_aware_privilege_section_SpaceAwarePrivilegeSection extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);space_aware_privilege_section_defineProperty(this,"globalSpaceEntry",{id:"*",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.spaceAwarePrivilegeForm.globalSpacesName",{defaultMessage:"* All Spaces"}),color:"#D3DAE6",initials:"*",disabledFeatures:[]});space_aware_privilege_section_defineProperty(this,"renderKibanaPrivileges",()=>{const{role:role}=this.props;const spacePrivileges=role.kibana;const hasAnyPrivileges=spacePrivileges.length>0;if(hasAnyPrivileges){const table=external_kbnSharedDeps_React_default.a.createElement(privilege_space_table_PrivilegeSpaceTable,{role:this.props.role,displaySpaces:this.getDisplaySpaces(),privilegeCalculator:new privilege_form_calculator_PrivilegeFormCalculator(this.props.kibanaPrivileges,this.props.role),onChange:this.props.onChange,onEdit:this.onEditSpacesPrivileges,disabled:!this.props.editable});return external_kbnSharedDeps_React_default.a.createElement("div",null,table,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),this.getAvailablePrivilegeButtons(true))}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiEmptyPrompt"],{iconType:"lock",title:external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.spacePrivilegeSection.noAccessToKibanaTitle",defaultMessage:"This role does not grant access to Kibana"})),titleSize:"s",actions:this.getAvailablePrivilegeButtons(false)})});space_aware_privilege_section_defineProperty(this,"getAvailablePrivilegeButtons",hasPrivilegesAssigned=>{const hasAvailableSpaces=this.getAvailableSpaces().length>0;if(!hasAvailableSpaces&&!hasPrivilegesAssigned){return null}const addPrivilegeButton=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{color:"primary",onClick:this.addSpacePrivilege,iconType:"plusInCircleFilled","data-test-subj":"addSpacePrivilegeButton",isDisabled:!hasAvailableSpaces||!this.props.editable},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.spacePrivilegeSection.addSpacePrivilegeButton",defaultMessage:"Add Kibana privilege"}));if(!hasPrivilegesAssigned){return addPrivilegeButton}const viewMatrixButton=external_kbnSharedDeps_React_default.a.createElement(PrivilegeSummary,{role:this.props.role,spaces:this.getDisplaySpaces(),kibanaPrivileges:this.props.kibanaPrivileges,canCustomizeSubFeaturePrivileges:this.props.canCustomizeSubFeaturePrivileges});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},addPrivilegeButton),hasPrivilegesAssigned&&!Object(model["j"])(this.props.role)&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},viewMatrixButton))});space_aware_privilege_section_defineProperty(this,"getDisplaySpaces",()=>[this.globalSpaceEntry,...this.props.spaces]);space_aware_privilege_section_defineProperty(this,"getAvailableSpaces",(includeSpacesFromPrivilegeIndex=-1)=>{const spacesToExclude=external_kbnSharedDeps_Lodash_default.a.uniq(external_kbnSharedDeps_Lodash_default.a.flatten(this.props.role.kibana.map((entry,index)=>{if(includeSpacesFromPrivilegeIndex===index){return[]}return entry.spaces})));return this.getDisplaySpaces().filter(displaySpace=>!spacesToExclude.includes(displaySpace.id))});space_aware_privilege_section_defineProperty(this,"addSpacePrivilege",()=>{this.setState({showSpacePrivilegeEditor:true,privilegeIndex:-1})});space_aware_privilege_section_defineProperty(this,"onSpacesPrivilegeChange",role=>{this.setState({showSpacePrivilegeEditor:false,privilegeIndex:-1});this.props.onChange(role)});space_aware_privilege_section_defineProperty(this,"onEditSpacesPrivileges",privilegeIndex=>{this.setState({privilegeIndex:privilegeIndex,showSpacePrivilegeEditor:true})});space_aware_privilege_section_defineProperty(this,"onCancelEditPrivileges",()=>{this.setState({showSpacePrivilegeEditor:false})});this.state={showSpacePrivilegeEditor:false,showPrivilegeMatrix:false,role:null,privilegeIndex:-1}}render(){const{uiCapabilities:uiCapabilities}=this.props;if(!uiCapabilities.spaces.manage){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.spaceAwarePrivilegeForm.insufficientPrivilegesDescription",defaultMessage:"Insufficient Privileges"})),iconType:"alert",color:"danger","data-test-subj":"userCannotManageSpacesCallout"},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.spaceAwarePrivilegeForm.howToViewAllAvailableSpacesDescription",defaultMessage:"You are not authorized to view all available spaces."})),external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.spaceAwarePrivilegeForm.ensureAccountHasAllPrivilegesGrantedDescription",defaultMessage:"Please ensure your account has all privileges granted by the {kibanaAdmin} role, and try again.",values:{kibanaAdmin:external_kbnSharedDeps_React_default.a.createElement("strong",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.spaceAwarePrivilegeForm.kibanaAdminTitle",defaultMessage:"kibana_admin"}))}})))}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiErrorBoundary"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,this.renderKibanaPrivileges(),this.state.showSpacePrivilegeEditor&&external_kbnSharedDeps_React_default.a.createElement(privilege_space_form_PrivilegeSpaceForm,{role:this.props.role,kibanaPrivileges:this.props.kibanaPrivileges,onChange:this.onSpacesPrivilegeChange,onCancel:this.onCancelEditPrivileges,spaces:this.getAvailableSpaces(this.state.privilegeIndex),privilegeIndex:this.state.privilegeIndex,canCustomizeSubFeaturePrivileges:this.props.canCustomizeSubFeaturePrivileges})))}}class transform_error_section_TransformErrorSection extends external_kbnSharedDeps_React_["PureComponent"]{render(){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiEmptyPrompt"],{color:"danger",iconType:"alert",title:external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.transformErrorSectionTitle",defaultMessage:"Malformed role"})),body:external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.transformErrorSectionDescription",defaultMessage:"This role definition is invalid, and cannot be edited through this screen."}))})}}function kibana_privileges_region_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class kibana_privileges_region_KibanaPrivilegesRegion extends external_kbnSharedDeps_React_["Component"]{constructor(...args){super(...args);kibana_privileges_region_defineProperty(this,"getForm",()=>{const{kibanaPrivileges:kibanaPrivileges,role:role,spacesEnabled:spacesEnabled,canCustomizeSubFeaturePrivileges:canCustomizeSubFeaturePrivileges,spaces:spaces=[],uiCapabilities:uiCapabilities,onChange:onChange,editable:editable,validator:validator}=this.props;if(role._transform_error&&role._transform_error.includes("kibana")){return external_kbnSharedDeps_React_default.a.createElement(transform_error_section_TransformErrorSection,null)}if(spacesEnabled){return external_kbnSharedDeps_React_default.a.createElement(space_aware_privilege_section_SpaceAwarePrivilegeSection,{kibanaPrivileges:kibanaPrivileges,role:role,spaces:spaces,uiCapabilities:uiCapabilities,onChange:onChange,editable:editable,canCustomizeSubFeaturePrivileges:canCustomizeSubFeaturePrivileges,validator:validator})}else{return external_kbnSharedDeps_React_default.a.createElement(simple_privilege_section_SimplePrivilegeSection,{kibanaPrivileges:kibanaPrivileges,role:role,onChange:onChange,editable:editable,canCustomizeSubFeaturePrivileges:canCustomizeSubFeaturePrivileges})}})}render(){return external_kbnSharedDeps_React_default.a.createElement(collapsible_panel_CollapsiblePanel,{iconType:"logoKibana",title:"Kibana"},this.getForm())}}const ReservedRoleBadge=props=>{const{role:role}=props;if(Object(model["j"])(role)){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{"data-test-subj":"reservedRoleBadgeTooltip",content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.reversedRoleBadge.reservedRolesCanNotBeModifiedTooltip",defaultMessage:"Reserved roles are built-in and cannot be removed or modified."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{style:{verticalAlign:"super"},type:"lock"}))}return null};var features_common_=__webpack_require__(76);class kibana_privilege_KibanaPrivilege{constructor(id,actions=[]){this.id=id;this.actions=actions}get name(){return external_kbnSharedDeps_Lodash_default.a.upperFirst(this.id)}grantsPrivilege(candidatePrivilege){return this.checkActions(this.actions,candidatePrivilege.actions).hasAllRequested}checkActions(knownActions,candidateActions){const missing=candidateActions.filter(action=>!knownActions.includes(action));const hasAllRequested=knownActions.length>0&&candidateActions.length>0&&missing.length===0;return{missing:missing,hasAllRequested:hasAllRequested}}}class primary_feature_privilege_PrimaryFeaturePrivilege extends kibana_privilege_KibanaPrivilege{constructor(id,config,actions=[]){super(id,actions);this.config=config;this.actions=actions}isMinimalFeaturePrivilege(){return this.id.startsWith("minimal_")}getMinimalPrivilegeId(){if(this.isMinimalFeaturePrivilege()){return this.id}return`minimal_${this.id}`}}class sub_feature_privilege_SubFeaturePrivilege extends kibana_privilege_KibanaPrivilege{constructor(subPrivilegeConfig,actions=[]){super(subPrivilegeConfig.id,actions);this.subPrivilegeConfig=subPrivilegeConfig;this.actions=actions}get name(){return this.subPrivilegeConfig.name}}class sub_feature_privilege_group_SubFeaturePrivilegeGroup{constructor(config,actionMapping={}){this.config=config;this.actionMapping=actionMapping}get groupType(){return this.config.groupType}get privileges(){return this.config.privileges.map(p=>new sub_feature_privilege_SubFeaturePrivilege(p,this.actionMapping[p.id]||[]))}}function secured_sub_feature_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class secured_sub_feature_SecuredSubFeature extends features_common_["SubFeature"]{constructor(config,actionMapping={}){super(config);this.actionMapping=actionMapping;secured_sub_feature_defineProperty(this,"privileges",void 0);this.privileges=[];for(const privilege of this.privilegeIterator()){this.privileges.push(privilege)}}getPrivilegeGroups(){return this.privilegeGroups.map(pg=>new sub_feature_privilege_group_SubFeaturePrivilegeGroup(pg,this.actionMapping))}*privilegeIterator({predicate:predicate=(()=>true)}={}){for(const group of this.privilegeGroups){yield*group.privileges.map(gp=>new sub_feature_privilege_SubFeaturePrivilege(gp,this.actionMapping[gp.id])).filter(privilege=>predicate(privilege,this))}}}function secured_feature_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class secured_feature_SecuredFeature extends features_common_["KibanaFeature"]{constructor(config,actionMapping={}){var _this$config$subFeatu,_this$config$subFeatu2,_this$config$subFeatu3,_this$config$subFeatu4;super(config);secured_feature_defineProperty(this,"primaryFeaturePrivileges",void 0);secured_feature_defineProperty(this,"minimalPrimaryFeaturePrivileges",void 0);secured_feature_defineProperty(this,"subFeaturePrivileges",void 0);secured_feature_defineProperty(this,"securedSubFeatures",void 0);this.primaryFeaturePrivileges=Object.entries(this.config.privileges||{}).map(([id,privilege])=>new primary_feature_privilege_PrimaryFeaturePrivilege(id,privilege,actionMapping[id]));if((_this$config$subFeatu=(_this$config$subFeatu2=this.config.subFeatures)===null||_this$config$subFeatu2===void 0?void 0:_this$config$subFeatu2.length)!==null&&_this$config$subFeatu!==void 0?_this$config$subFeatu:0>0){this.minimalPrimaryFeaturePrivileges=Object.entries(this.config.privileges||{}).map(([id,privilege])=>new primary_feature_privilege_PrimaryFeaturePrivilege(`minimal_${id}`,privilege,actionMapping[`minimal_${id}`]))}else{this.minimalPrimaryFeaturePrivileges=[]}this.securedSubFeatures=(_this$config$subFeatu3=(_this$config$subFeatu4=this.config.subFeatures)===null||_this$config$subFeatu4===void 0?void 0:_this$config$subFeatu4.map(sf=>new secured_sub_feature_SecuredSubFeature(sf,actionMapping)))!==null&&_this$config$subFeatu3!==void 0?_this$config$subFeatu3:[];this.subFeaturePrivileges=this.securedSubFeatures.reduce((acc,subFeature)=>[...acc,...subFeature.privilegeIterator()],[])}getPrivilegesTooltip(){return this.config.privilegesTooltip}getAllPrivileges(){return[...this.primaryFeaturePrivileges,...this.minimalPrimaryFeaturePrivileges,...this.subFeaturePrivileges]}getPrimaryFeaturePrivileges({includeMinimalFeaturePrivileges:includeMinimalFeaturePrivileges}={includeMinimalFeaturePrivileges:false}){return includeMinimalFeaturePrivileges?[this.primaryFeaturePrivileges,this.minimalPrimaryFeaturePrivileges].flat():[...this.primaryFeaturePrivileges]}getMinimalFeaturePrivileges(){return[...this.minimalPrimaryFeaturePrivileges]}getSubFeaturePrivileges(){return[...this.subFeaturePrivileges]}getSubFeatures(){return[...this.securedSubFeatures]}}function privilege_collection_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class PrivilegeCollection{constructor(privileges){privilege_collection_defineProperty(this,"actions",void 0);this.actions=new Set(privileges.reduce((acc,priv)=>[...acc,...priv.actions],[]))}grantsPrivilege(privilege){return this.checkActions(this.actions,privilege.actions).hasAllRequested}checkActions(knownActions,candidateActions){const missing=candidateActions.filter(action=>!knownActions.has(action));const hasAllRequested=knownActions.size>0&&candidateActions.length>0&&missing.length===0;return{missing:missing,hasAllRequested:hasAllRequested}}}function kibana_privileges_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function toBasePrivilege(entry){const[privilegeId,actions]=entry;return[privilegeId,new kibana_privilege_KibanaPrivilege(privilegeId,actions)]}function recordsToBasePrivilegeMap(record){return new Map(Object.entries(record).map(entry=>toBasePrivilege(entry)))}class kibana_privileges_KibanaPrivileges{constructor(rawKibanaPrivileges,features){kibana_privileges_defineProperty(this,"global",void 0);kibana_privileges_defineProperty(this,"spaces",void 0);kibana_privileges_defineProperty(this,"feature",void 0);this.global=recordsToBasePrivilegeMap(rawKibanaPrivileges.global);this.spaces=recordsToBasePrivilegeMap(rawKibanaPrivileges.space);this.feature=new Map(features.map(feature=>{const rawPrivs=rawKibanaPrivileges.features[feature.id];return[feature.id,new secured_feature_SecuredFeature(feature.toRaw(),rawPrivs)]}))}getBasePrivileges(entry){if(Object(privilege_utils["a"])(entry)){return Array.from(this.global.values())}return Array.from(this.spaces.values())}getSecuredFeature(featureId){return this.feature.get(featureId)}getSecuredFeatures(){return Array.from(this.feature.values())}createCollectionFromRoleKibanaPrivileges(roleKibanaPrivileges){const filterAssigned=assignedPrivileges=>privilege=>assignedPrivileges.includes(privilege.id);const privileges=roleKibanaPrivileges.map(entry=>{const assignedBasePrivileges=this.getBasePrivileges(entry).filter(filterAssigned(entry.base));const assignedFeaturePrivileges=Object.entries(entry.feature).map(([featureId,assignedFeaturePrivs])=>this.getFeaturePrivileges(featureId).filter(filterAssigned(assignedFeaturePrivs)));return[assignedBasePrivileges,assignedFeaturePrivileges].flat(2)}).flat();return new PrivilegeCollection(privileges)}getFeaturePrivileges(featureId){var _this$getSecuredFeatu,_this$getSecuredFeatu2;return(_this$getSecuredFeatu=(_this$getSecuredFeatu2=this.getSecuredFeature(featureId))===null||_this$getSecuredFeatu2===void 0?void 0:_this$getSecuredFeatu2.getAllPrivileges())!==null&&_this$getSecuredFeatu!==void 0?_this$getSecuredFeatu:[]}}var kibanaReact_public_=__webpack_require__(6);function edit_role_page_extends(){edit_role_page_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return edit_role_page_extends.apply(this,arguments)}function useRunAsUsers(userAPIClient,fatalErrors){const[userNames,setUserNames]=Object(external_kbnSharedDeps_React_["useState"])(null);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{userAPIClient.getUsers().then(users=>setUserNames(users.map(user=>user.username)),err=>fatalErrors.add(err))},[fatalErrors,userAPIClient]);return userNames}function useIndexPatternsTitles(indexPatterns,fatalErrors,notifications){const[indexPatternsTitles,setIndexPatternsTitles]=Object(external_kbnSharedDeps_React_["useState"])(null);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{indexPatterns.getTitles().catch(err=>{var _err$response;if(((_err$response=err.response)===null||_err$response===void 0?void 0:_err$response.status)===403){notifications.toasts.addDanger({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.roles.noIndexPatternsPermission",{defaultMessage:"You need permission to access the list of available index patterns."})});return[]}fatalErrors.add(err);throw err}).then(setIndexPatternsTitles)},[fatalErrors,indexPatterns,notifications]);return indexPatternsTitles}function usePrivileges(privilegesAPIClient,fatalErrors){const[privileges,setPrivileges]=Object(external_kbnSharedDeps_React_["useState"])(null);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{Promise.all([privilegesAPIClient.getAll({includeActions:true}),privilegesAPIClient.getBuiltIn()]).then(([kibanaPrivileges,builtInESPrivileges])=>setPrivileges([kibanaPrivileges,builtInESPrivileges]),err=>fatalErrors.add(err))},[privilegesAPIClient,fatalErrors]);return privileges}function useRole(rolesAPIClient,fatalErrors,notifications,license,action,backToRoleList,roleName){const[role,setRole]=Object(external_kbnSharedDeps_React_["useState"])(null);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const rolePromise=roleName?rolesAPIClient.getRole(roleName):Promise.resolve({name:"",elasticsearch:{cluster:[],indices:[],run_as:[]},kibana:[],_unrecognized_applications:[]});rolePromise.then(fetchedRole=>{if(action==="clone"&&Object(model["j"])(fetchedRole)){backToRoleList();return}if(fetchedRole.elasticsearch.indices.length===0){const emptyOption={names:[],privileges:[]};const{allowRoleDocumentLevelSecurity:allowRoleDocumentLevelSecurity,allowRoleFieldLevelSecurity:allowRoleFieldLevelSecurity}=license.getFeatures();if(allowRoleFieldLevelSecurity){emptyOption.field_security={grant:["*"],except:[]}}if(allowRoleDocumentLevelSecurity){emptyOption.query=""}fetchedRole.elasticsearch.indices.push(emptyOption)}setRole(action==="clone"?Object(model["l"])(fetchedRole):Object(model["c"])(fetchedRole))}).catch(err=>{var _err$response2;if(((_err$response2=err.response)===null||_err$response2===void 0?void 0:_err$response2.status)===404){notifications.toasts.addDanger({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.roles.roleNotFound",{defaultMessage:'No "{roleName}" role found.',values:{roleName:roleName}})});backToRoleList()}else{fatalErrors.add(err)}})},[roleName,action,fatalErrors,rolesAPIClient,notifications,license,backToRoleList]);return[role,setRole]}function useSpaces(http,fatalErrors){const[spaces,setSpaces]=Object(external_kbnSharedDeps_React_["useState"])(null);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{http.get("/api/spaces/space").then(fetchedSpaces=>setSpaces({enabled:true,list:fetchedSpaces}),err=>{var _err$response3;if(((_err$response3=err.response)===null||_err$response3===void 0?void 0:_err$response3.status)===404){setSpaces({enabled:false,list:[]})}else{fatalErrors.add(err)}})},[http,fatalErrors]);return spaces}function useFeatures(getFeatures,fatalErrors){const[features,setFeatures]=Object(external_kbnSharedDeps_React_["useState"])(null);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{getFeatures().catch(err=>{var _err$response4;const unauthorizedForFeatures=((_err$response4=err.response)===null||_err$response4===void 0?void 0:_err$response4.status)===403;if(unauthorizedForFeatures){return[]}fatalErrors.add(err)}).then(retrievedFeatures=>{setFeatures(retrievedFeatures)})},[fatalErrors,getFeatures]);return features}const EditRolePage=({userAPIClient:userAPIClient,indexPatterns:indexPatterns,rolesAPIClient:rolesAPIClient,indicesAPIClient:indicesAPIClient,privilegesAPIClient:privilegesAPIClient,getFeatures:getFeatures,http:http,roleName:roleName,action:action,fatalErrors:fatalErrors,license:license,docLinks:docLinks,uiCapabilities:uiCapabilities,notifications:notifications,history:history})=>{const backToRoleList=Object(external_kbnSharedDeps_React_["useCallback"])(()=>history.push("/"),[history]);const{current:validator}=Object(external_kbnSharedDeps_React_["useRef"])(new validate_role_RoleValidator({shouldValidate:false}));const[formError,setFormError]=Object(external_kbnSharedDeps_React_["useState"])(null);const runAsUsers=useRunAsUsers(userAPIClient,fatalErrors);const indexPatternsTitles=useIndexPatternsTitles(indexPatterns,fatalErrors,notifications);const privileges=usePrivileges(privilegesAPIClient,fatalErrors);const spaces=useSpaces(http,fatalErrors);const features=useFeatures(getFeatures,fatalErrors);const[role,setRole]=useRole(rolesAPIClient,fatalErrors,notifications,license,action,backToRoleList,roleName);if(!role||!runAsUsers||!indexPatternsTitles||!privileges||!spaces||!features){return null}const isEditingExistingRole=!!roleName&&action==="edit";const isRoleReadOnly=Object(model["i"])(role);const isRoleReserved=Object(model["j"])(role);const isDeprecatedRole=Object(model["g"])(role);const[kibanaPrivileges,builtInESPrivileges]=privileges;const getFormTitle=()=>{let titleText;const props={tabIndex:0};if(isRoleReserved){titleText=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.viewingRoleTitle",defaultMessage:"Viewing role"});props["aria-describedby"]="reservedRoleDescription"}else if(isEditingExistingRole){titleText=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.editRoleTitle",defaultMessage:"Edit role"})}else{titleText=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.createRoleTitle",defaultMessage:"Create role"})}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"l"},external_kbnSharedDeps_React_default.a.createElement("h1",props,titleText," ",external_kbnSharedDeps_React_default.a.createElement(ReservedRoleBadge,{role:role})))};const getActionButton=()=>{if(isEditingExistingRole&&!isRoleReadOnly){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(delete_role_button_DeleteRoleButton,{canDelete:true,onDelete:handleDeleteRole}))}return null};const getRoleName=()=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],edit_role_page_extends({label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.roleNameFormRowTitle",defaultMessage:"Role name"}),helpText:!isRoleReserved&&isEditingExistingRole?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.roleNameFormRowHelpText",defaultMessage:"A role's name cannot be changed once it has been created."}):undefined},validator.validateRoleName(role)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{name:"name",value:role.name||"",onChange:onNameChange,"data-test-subj":"roleFormNameInput",readOnly:isRoleReserved||isEditingExistingRole})));const onNameChange=e=>setRole({...role,name:e.target.value});const getElasticsearchPrivileges=()=>external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement(elasticsearch_privileges_ElasticsearchPrivileges,{role:role,editable:!isRoleReadOnly,indicesAPIClient:indicesAPIClient,onChange:onRoleChange,runAsUsers:runAsUsers,validator:validator,indexPatterns:indexPatternsTitles,builtinESPrivileges:builtInESPrivileges,license:license,docLinks:docLinks}));const onRoleChange=newRole=>setRole(newRole);const getKibanaPrivileges=()=>external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement(kibana_privileges_region_KibanaPrivilegesRegion,{kibanaPrivileges:new kibana_privileges_KibanaPrivileges(kibanaPrivileges,features),spaces:spaces.list,spacesEnabled:spaces.enabled,uiCapabilities:uiCapabilities,canCustomizeSubFeaturePrivileges:license.getFeatures().allowSubFeaturePrivileges,editable:!isRoleReadOnly,role:role,onChange:onRoleChange,validator:validator}));const getFormButtons=()=>{if(isRoleReadOnly){return getReturnToRoleListButton()}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{responsive:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},getSaveButton()),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},getCancelButton()),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:true}),getActionButton())};const getReturnToRoleListButton=()=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],edit_role_page_extends({},Object(kibanaReact_public_["reactRouterNavigate"])(history,""),{"data-test-subj":"roleFormReturnButton"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.returnToRoleListButtonLabel",defaultMessage:"Return to role list"}));const getSaveButton=()=>{const saveText=isEditingExistingRole?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.updateRoleText",defaultMessage:"Update role"}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.createRoleText",defaultMessage:"Create role"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{"data-test-subj":`roleFormSaveButton`,fill:true,onClick:saveRole,disabled:isRoleReserved},saveText)};const getCancelButton=()=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{"data-test-subj":`roleFormCancelButton`,onClick:backToRoleList},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.cancelButtonLabel",defaultMessage:"Cancel"}));const saveRole=async()=>{validator.enableValidation();const result=validator.validateForSave(role);if(result.isInvalid){setFormError(result)}else{setFormError(null);try{await rolesAPIClient.saveRole({role:role,spacesEnabled:spaces.enabled})}catch(error){var _error$body$message,_error$body;notifications.toasts.addDanger((_error$body$message=error===null||error===void 0?void 0:(_error$body=error.body)===null||_error$body===void 0?void 0:_error$body.message)!==null&&_error$body$message!==void 0?_error$body$message:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.errorSavingRoleError",{defaultMessage:"Error saving role"}));return}notifications.toasts.addSuccess(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.roleSuccessfullySavedNotificationMessage",{defaultMessage:"Saved role"}));backToRoleList()}};const handleDeleteRole=async()=>{try{await rolesAPIClient.deleteRole(role.name)}catch(error){var _error$data$message,_error$data;notifications.toasts.addDanger((_error$data$message=error===null||error===void 0?void 0:(_error$data=error.data)===null||_error$data===void 0?void 0:_error$data.message)!==null&&_error$data$message!==void 0?_error$data$message:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.errorDeletingRoleError",{defaultMessage:"Error deleting role"}));return}notifications.toasts.addSuccess(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.security.management.editRole.roleSuccessfullyDeletedNotificationMessage",{defaultMessage:"Deleted role"}));backToRoleList()};const description=spaces.enabled?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.setPrivilegesToKibanaSpacesDescription",defaultMessage:"Set privileges on your Elasticsearch data and control access to your Kibana spaces."}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.setPrivilegesToKibanaDescription",defaultMessage:"Set privileges on your Elasticsearch data and control access to Kibana."});return external_kbnSharedDeps_React_default.a.createElement("div",{className:"editRolePage"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiForm"],formError,getFormTitle(),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s"},description),isRoleReserved&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s",color:"subdued"},external_kbnSharedDeps_React_default.a.createElement("p",{id:"reservedRoleDescription",tabIndex:0},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.security.management.editRole.modifyingReversedRolesDescription",defaultMessage:"Reserved roles are built-in and cannot be removed or modified."})))),isDeprecatedRole&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:Object(model["d"])(role),color:"warning",iconType:"alert"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),getRoleName(),getElasticsearchPrivileges(),getKibanaPrivileges(),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),getFormButtons()))}}}]);