/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */(function(modules){function webpackJsonpCallback(data){var chunkIds=data[0];var moreModules=data[1];var moduleId,chunkId,i=0,resolves=[];for(;i<chunkIds.length;i++){chunkId=chunkIds[i];if(Object.prototype.hasOwnProperty.call(installedChunks,chunkId)&&installedChunks[chunkId]){resolves.push(installedChunks[chunkId][0])}installedChunks[chunkId]=0}for(moduleId in moreModules){if(Object.prototype.hasOwnProperty.call(moreModules,moduleId)){modules[moduleId]=moreModules[moduleId]}}if(parentJsonpFunction)parentJsonpFunction(data);while(resolves.length){resolves.shift()()}}var installedModules={};var installedChunks={1:0};function jsonpScriptSrc(chunkId){return __webpack_require__.p+"lens.chunk."+chunkId+".js"}function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.e=function requireEnsure(chunkId){var promises=[];var installedChunkData=installedChunks[chunkId];if(installedChunkData!==0){if(installedChunkData){promises.push(installedChunkData[2])}else{var promise=new Promise((function(resolve,reject){installedChunkData=installedChunks[chunkId]=[resolve,reject]}));promises.push(installedChunkData[2]=promise);var script=document.createElement("script");var onScriptComplete;script.charset="utf-8";script.timeout=120;if(__webpack_require__.nc){script.setAttribute("nonce",__webpack_require__.nc)}script.src=jsonpScriptSrc(chunkId);var error=new Error;onScriptComplete=function(event){script.onerror=script.onload=null;clearTimeout(timeout);var chunk=installedChunks[chunkId];if(chunk!==0){if(chunk){var errorType=event&&(event.type==="load"?"missing":event.type);var realSrc=event&&event.target&&event.target.src;error.message="Loading chunk "+chunkId+" failed.\n("+errorType+": "+realSrc+")";error.name="ChunkLoadError";error.type=errorType;error.request=realSrc;chunk[1](error)}installedChunks[chunkId]=undefined}};var timeout=setTimeout((function(){onScriptComplete({type:"timeout",target:script})}),12e4);script.onerror=script.onload=onScriptComplete;document.head.appendChild(script)}}return Promise.all(promises)};__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";__webpack_require__.oe=function(err){console.error(err);throw err};var jsonpArray=window["lens_bundle_jsonpfunction"]=window["lens_bundle_jsonpfunction"]||[];var oldJsonpFunction=jsonpArray.push.bind(jsonpArray);jsonpArray.push=webpackJsonpCallback;jsonpArray=jsonpArray.slice();for(var i=0;i<jsonpArray.length;i++)webpackJsonpCallback(jsonpArray[i]);var parentJsonpFunction=oldJsonpFunction;return __webpack_require__(__webpack_require__.s=16)})([function(module,exports){module.exports=__kbnSharedDeps__.KbnI18n},function(module,__webpack_exports__,__webpack_require__){"use strict";var _api__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(12);var _api__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_api__WEBPACK_IMPORTED_MODULE_0__);if(__webpack_require__.o(_api__WEBPACK_IMPORTED_MODULE_0__,"APP_ID"))__webpack_require__.d(__webpack_exports__,"APP_ID",(function(){return _api__WEBPACK_IMPORTED_MODULE_0__["APP_ID"]}));if(__webpack_require__.o(_api__WEBPACK_IMPORTED_MODULE_0__,"BASE_API_URL"))__webpack_require__.d(__webpack_exports__,"BASE_API_URL",(function(){return _api__WEBPACK_IMPORTED_MODULE_0__["BASE_API_URL"]}));if(__webpack_require__.o(_api__WEBPACK_IMPORTED_MODULE_0__,"DOC_TYPE"))__webpack_require__.d(__webpack_exports__,"DOC_TYPE",(function(){return _api__WEBPACK_IMPORTED_MODULE_0__["DOC_TYPE"]}));if(__webpack_require__.o(_api__WEBPACK_IMPORTED_MODULE_0__,"LENS_EDIT_BY_VALUE"))__webpack_require__.d(__webpack_exports__,"LENS_EDIT_BY_VALUE",(function(){return _api__WEBPACK_IMPORTED_MODULE_0__["LENS_EDIT_BY_VALUE"]}));if(__webpack_require__.o(_api__WEBPACK_IMPORTED_MODULE_0__,"LENS_EMBEDDABLE_TYPE"))__webpack_require__.d(__webpack_exports__,"LENS_EMBEDDABLE_TYPE",(function(){return _api__WEBPACK_IMPORTED_MODULE_0__["LENS_EMBEDDABLE_TYPE"]}));if(__webpack_require__.o(_api__WEBPACK_IMPORTED_MODULE_0__,"NOT_INTERNATIONALIZED_PRODUCT_NAME"))__webpack_require__.d(__webpack_exports__,"NOT_INTERNATIONALIZED_PRODUCT_NAME",(function(){return _api__WEBPACK_IMPORTED_MODULE_0__["NOT_INTERNATIONALIZED_PRODUCT_NAME"]}));if(__webpack_require__.o(_api__WEBPACK_IMPORTED_MODULE_0__,"getBasePath"))__webpack_require__.d(__webpack_exports__,"getBasePath",(function(){return _api__WEBPACK_IMPORTED_MODULE_0__["getBasePath"]}));if(__webpack_require__.o(_api__WEBPACK_IMPORTED_MODULE_0__,"getEditPath"))__webpack_require__.d(__webpack_exports__,"getEditPath",(function(){return _api__WEBPACK_IMPORTED_MODULE_0__["getEditPath"]}));if(__webpack_require__.o(_api__WEBPACK_IMPORTED_MODULE_0__,"getFullPath"))__webpack_require__.d(__webpack_exports__,"getFullPath",(function(){return _api__WEBPACK_IMPORTED_MODULE_0__["getFullPath"]}));var _constants__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7);__webpack_require__.d(__webpack_exports__,"APP_ID",(function(){return _constants__WEBPACK_IMPORTED_MODULE_1__["APP_ID"]}));__webpack_require__.d(__webpack_exports__,"BASE_API_URL",(function(){return _constants__WEBPACK_IMPORTED_MODULE_1__["BASE_API_URL"]}));__webpack_require__.d(__webpack_exports__,"DOC_TYPE",(function(){return _constants__WEBPACK_IMPORTED_MODULE_1__["DOC_TYPE"]}));__webpack_require__.d(__webpack_exports__,"LENS_EDIT_BY_VALUE",(function(){return _constants__WEBPACK_IMPORTED_MODULE_1__["LENS_EDIT_BY_VALUE"]}));__webpack_require__.d(__webpack_exports__,"LENS_EMBEDDABLE_TYPE",(function(){return _constants__WEBPACK_IMPORTED_MODULE_1__["LENS_EMBEDDABLE_TYPE"]}));__webpack_require__.d(__webpack_exports__,"NOT_INTERNATIONALIZED_PRODUCT_NAME",(function(){return _constants__WEBPACK_IMPORTED_MODULE_1__["NOT_INTERNATIONALIZED_PRODUCT_NAME"]}));__webpack_require__.d(__webpack_exports__,"getBasePath",(function(){return _constants__WEBPACK_IMPORTED_MODULE_1__["getBasePath"]}));__webpack_require__.d(__webpack_exports__,"getEditPath",(function(){return _constants__WEBPACK_IMPORTED_MODULE_1__["getEditPath"]}));__webpack_require__.d(__webpack_exports__,"getFullPath",(function(){return _constants__WEBPACK_IMPORTED_MODULE_1__["getFullPath"]}));var _types__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(13);var _types__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_types__WEBPACK_IMPORTED_MODULE_2__)},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/uiActions/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,exports){module.exports=__kbnSharedDeps__.React},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("entry/core/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/embeddable/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,exports){module.exports=__kbnSharedDeps__.ReactDom},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"PLUGIN_ID",(function(){return PLUGIN_ID}));__webpack_require__.d(__webpack_exports__,"APP_ID",(function(){return APP_ID}));__webpack_require__.d(__webpack_exports__,"LENS_EMBEDDABLE_TYPE",(function(){return LENS_EMBEDDABLE_TYPE}));__webpack_require__.d(__webpack_exports__,"DOC_TYPE",(function(){return DOC_TYPE}));__webpack_require__.d(__webpack_exports__,"NOT_INTERNATIONALIZED_PRODUCT_NAME",(function(){return NOT_INTERNATIONALIZED_PRODUCT_NAME}));__webpack_require__.d(__webpack_exports__,"BASE_API_URL",(function(){return BASE_API_URL}));__webpack_require__.d(__webpack_exports__,"LENS_EDIT_BY_VALUE",(function(){return LENS_EDIT_BY_VALUE}));__webpack_require__.d(__webpack_exports__,"getBasePath",(function(){return getBasePath}));__webpack_require__.d(__webpack_exports__,"getEditPath",(function(){return getEditPath}));__webpack_require__.d(__webpack_exports__,"getFullPath",(function(){return getFullPath}));const PLUGIN_ID="lens";const APP_ID="lens";const LENS_EMBEDDABLE_TYPE="lens";const DOC_TYPE="lens";const NOT_INTERNATIONALIZED_PRODUCT_NAME="Lens Visualizations";const BASE_API_URL="/api/lens";const LENS_EDIT_BY_VALUE="edit_by_value";function getBasePath(){return`#/`}function getEditPath(id){return id?`#/edit/${encodeURIComponent(id)}`:`#/${LENS_EDIT_BY_VALUE}`}function getFullPath(id){return`/app/${PLUGIN_ID}${id?getEditPath(id):getBasePath()}`}},function(module,exports){module.exports=__kbnSharedDeps__.Rxjs},function(module,exports){module.exports=__kbnSharedDeps__.KbnI18nReact},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/data/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/kibanaUtils/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,exports){},function(module,exports){},function(module,exports){module.exports=__kbnSharedDeps__.MomentTimezone},function(module,exports,__webpack_require__){"use strict";module.exports=function(){function _min(d0,d1,d2,bx,ay){return d0<d1||d2<d1?d0>d2?d2+1:d0+1:bx===ay?d1:d1+1}return function(a,b){if(a===b){return 0}if(a.length>b.length){var tmp=a;a=b;b=tmp}var la=a.length;var lb=b.length;while(la>0&&a.charCodeAt(la-1)===b.charCodeAt(lb-1)){la--;lb--}var offset=0;while(offset<la&&a.charCodeAt(offset)===b.charCodeAt(offset)){offset++}la-=offset;lb-=offset;if(la===0||lb<3){return lb}var x=0;var y;var d0;var d1;var d2;var d3;var dd;var dy;var ay;var bx0;var bx1;var bx2;var bx3;var vector=[];for(y=0;y<la;y++){vector.push(y+1);vector.push(a.charCodeAt(offset+y))}var len=vector.length-1;for(;x<lb-3;){bx0=b.charCodeAt(offset+(d0=x));bx1=b.charCodeAt(offset+(d1=x+1));bx2=b.charCodeAt(offset+(d2=x+2));bx3=b.charCodeAt(offset+(d3=x+3));dd=x+=4;for(y=0;y<len;y+=2){dy=vector[y];ay=vector[y+1];d0=_min(dy,d0,d1,bx0,ay);d1=_min(d0,d1,d2,bx1,ay);d2=_min(d1,d2,d3,bx2,ay);dd=_min(d2,d3,dd,bx3,ay);vector[y]=dd;d3=d2;d2=d1;d1=d0;d0=dy}}for(;x<lb;){bx0=b.charCodeAt(offset+(d0=x));dd=++x;for(y=0;y<len;y+=2){dy=vector[y];vector[y]=dd=_min(dy,d0,dd,bx0,vector[y+1]);d0=dy}}return dd}}()},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _node_modules_val_loader_dist_cjs_js_key_lens_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(17);var _node_modules_val_loader_dist_cjs_js_key_lens_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_val_loader_dist_cjs_js_key_lens_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0__);__kbnBundles__.define("plugin/lens/public",__webpack_require__,18);__kbnBundles__.define("plugin/lens/common/constants",__webpack_require__,7)},function(module,exports,__webpack_require__){__webpack_require__.p=window.__kbnPublicPath__["lens"]},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"EmbeddableComponentProps",(function(){return undefined}));__webpack_require__.d(__webpack_exports__,"TypedLensByValueInput",(function(){return undefined}));__webpack_require__.d(__webpack_exports__,"LensPublicStart",(function(){return undefined}));__webpack_require__.d(__webpack_exports__,"plugin",(function(){return public_plugin}));var public_=__webpack_require__(5);var external_kbnSharedDeps_React_=__webpack_require__(3);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_ReactDom_=__webpack_require__(6);var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(9);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(0);var data_public_=__webpack_require__(10);const{toAbsoluteDates:toAbsoluteDates}=data_public_["search"].aggs;const mergeTables={name:"lens_merge_tables",type:"lens_multitable",help:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.lens.functions.mergeTables.help",{defaultMessage:"A helper to merge any number of kibana tables into a single table and expose it via inspector adapter"}),args:{layerIds:{types:["string"],help:"",multi:true},tables:{types:["datatable"],help:"",multi:true}},inputTypes:["kibana_context","null"],fn(input,{layerIds:layerIds,tables:tables},context){const resultTables={};tables.forEach((table,index)=>{var _context$inspectorAda;resultTables[layerIds[index]]=table;if(context!==null&&context!==void 0&&(_context$inspectorAda=context.inspectorAdapters)!==null&&_context$inspectorAda!==void 0&&_context$inspectorAda.tables){context.inspectorAdapters.tables.allowCsvExport=true;context.inspectorAdapters.tables.logDatatable(layerIds[index],table)}});return{type:"lens_multitable",tables:resultTables,dateRange:getDateRange(input)}}};function getDateRange(value){if(!value||!value.timeRange){return}const dateRange=toAbsoluteDates(value.timeRange);if(!dateRange){return}return{fromDate:dateRange.from,toDate:dateRange.to}}var common=__webpack_require__(1);function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class embeddable_factory_EmbeddableFactory{constructor(getStartServices){this.getStartServices=getStartServices;_defineProperty(this,"type",common["DOC_TYPE"]);_defineProperty(this,"savedObjectMetaData",{name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.lens.lensSavedObjectLabel",{defaultMessage:"Lens Visualization"}),type:common["DOC_TYPE"],getIconForSavedObject:()=>"lensApp"});_defineProperty(this,"isEditable",async()=>{var _capabilities$dashboa;const{capabilities:capabilities}=await this.getStartServices();return Boolean(capabilities.visualize.save||((_capabilities$dashboa=capabilities.dashboard)===null||_capabilities$dashboa===void 0?void 0:_capabilities$dashboa.showWriteControls))});_defineProperty(this,"createFromSavedObject",async(savedObjectId,input,parent)=>{if(!input.savedObjectId){input.savedObjectId=savedObjectId}return this.create(input,parent)})}canCreateNew(){return false}getDisplayName(){return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.lens.embeddableDisplayName",{defaultMessage:"lens"})}async create(input,parent){var _capabilities$dashboa2;const{timefilter:timefilter,expressionRenderer:expressionRenderer,documentToExpression:documentToExpression,uiActions:uiActions,coreHttp:coreHttp,attributeService:attributeService,indexPatternService:indexPatternService,capabilities:capabilities}=await this.getStartServices();const{Embeddable:Embeddable}=await __webpack_require__.e(0).then(__webpack_require__.bind(null,312));return new Embeddable({attributeService:attributeService,indexPatternService:indexPatternService,timefilter:timefilter,expressionRenderer:expressionRenderer,basePath:coreHttp.basePath,getTrigger:uiActions===null||uiActions===void 0?void 0:uiActions.getTrigger,getTriggerCompatibleActions:uiActions===null||uiActions===void 0?void 0:uiActions.getTriggerCompatibleActions,documentToExpression:documentToExpression,capabilities:{canSaveDashboards:Boolean((_capabilities$dashboa2=capabilities.dashboard)===null||_capabilities$dashboa2===void 0?void 0:_capabilities$dashboa2.showWriteControls),canSaveVisualizations:Boolean(capabilities.visualize.save)}},input,parent)}extract(state){let references=[];const typedState=state;if("attributes"in typedState&&typedState.attributes!==undefined){references=typedState.attributes.references}return{state:state,references:references}}}function service_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}async function collectAsyncDefinitions(definitions){const resolvedDefinitions=await Promise.all(definitions.map(definition=>typeof definition==="function"?definition():definition));const definitionMap={};resolvedDefinitions.forEach(definition=>{definitionMap[definition.id]=definition});return definitionMap}class service_EditorFrameService{constructor(){service_defineProperty(this,"datasources",[]);service_defineProperty(this,"visualizations",[]);service_defineProperty(this,"documentToExpression",async doc=>{const[resolvedDatasources,resolvedVisualizations]=await Promise.all([collectAsyncDefinitions(this.datasources),collectAsyncDefinitions(this.visualizations)]);const{persistedStateToExpression:persistedStateToExpression}=await __webpack_require__.e(0).then(__webpack_require__.bind(null,312));return await persistedStateToExpression(resolvedDatasources,resolvedVisualizations,doc)})}setup(core,plugins,getAttributeService){plugins.expressions.registerFunction(()=>mergeTables);const getStartServices=async()=>{const[coreStart,deps]=await core.getStartServices();return{attributeService:await getAttributeService(),capabilities:coreStart.application.capabilities,coreHttp:coreStart.http,timefilter:deps.data.query.timefilter.timefilter,expressionRenderer:deps.expressions.ReactExpressionRenderer,documentToExpression:this.documentToExpression,indexPatternService:deps.data.indexPatterns,uiActions:deps.uiActions}};if(plugins.embeddable){plugins.embeddable.registerEmbeddableFactory("lens",new embeddable_factory_EmbeddableFactory(getStartServices))}return{registerDatasource:datasource=>{this.datasources.push(datasource)},registerVisualization:visualization=>{this.visualizations.push(visualization)}}}start(core,plugins){const createInstance=async()=>{let domElement;const[resolvedDatasources,resolvedVisualizations]=await Promise.all([collectAsyncDefinitions(this.datasources),collectAsyncDefinitions(this.visualizations)]);const unmount=()=>{if(domElement){Object(external_kbnSharedDeps_ReactDom_["unmountComponentAtNode"])(domElement)}};return{mount:async(element,{doc:doc,onError:onError,dateRange:dateRange,query:query,filters:filters,savedQuery:savedQuery,onChange:onChange,showNoDataPopover:showNoDataPopover,initialContext:initialContext,searchSessionId:searchSessionId})=>{if(domElement!==element){unmount()}domElement=element;const firstDatasourceId=Object.keys(resolvedDatasources)[0];const firstVisualizationId=Object.keys(resolvedVisualizations)[0];const{EditorFrame:EditorFrame,getActiveDatasourceIdFromDoc:getActiveDatasourceIdFromDoc}=await __webpack_require__.e(0).then(__webpack_require__.bind(null,312));const palettes=await plugins.charts.palettes.getPalettes();Object(external_kbnSharedDeps_ReactDom_["render"])(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["I18nProvider"],null,external_kbnSharedDeps_React_default.a.createElement(EditorFrame,{"data-test-subj":"lnsEditorFrame",onError:onError,datasourceMap:resolvedDatasources,visualizationMap:resolvedVisualizations,initialDatasourceId:getActiveDatasourceIdFromDoc(doc)||firstDatasourceId||null,initialVisualizationId:doc&&doc.visualizationType||firstVisualizationId||null,key:doc===null||doc===void 0?void 0:doc.savedObjectId,core:core,plugins:plugins,ExpressionRenderer:plugins.expressions.ReactExpressionRenderer,palettes:palettes,doc:doc,dateRange:dateRange,query:query,filters:filters,savedQuery:savedQuery,onChange:onChange,showNoDataPopover:showNoDataPopover,initialContext:initialContext,searchSessionId:searchSessionId})),domElement)},unmount:unmount}};return{createInstance:createInstance}}}var kibanaUtils_public_=__webpack_require__(11);class indexpattern_datasource_IndexPatternDatasource{constructor(){}setup(core,{expressions:expressions,editorFrame:editorFrame,charts:charts}){editorFrame.registerDatasource(async()=>{const{getIndexPatternDatasource:getIndexPatternDatasource,renameColumns:renameColumns,formatColumn:formatColumn,counterRate:counterRate,getTimeScaleFunction:getTimeScaleFunction,getSuffixFormatter:getSuffixFormatter}=await __webpack_require__.e(0).then(__webpack_require__.bind(null,312));return core.getStartServices().then(([coreStart,{data:data}])=>{data.fieldFormats.register([getSuffixFormatter(data.fieldFormats.deserialize)]);expressions.registerFunction(getTimeScaleFunction(data));expressions.registerFunction(counterRate);expressions.registerFunction(renameColumns);expressions.registerFunction(formatColumn);return getIndexPatternDatasource({core:coreStart,storage:new kibanaUtils_public_["Storage"](localStorage),data:data,charts:charts})})})}}var external_kbnSharedDeps_MomentTimezone_=__webpack_require__(14);var external_kbnSharedDeps_MomentTimezone_default=__webpack_require__.n(external_kbnSharedDeps_MomentTimezone_);function getTimeZone(uiSettings){const configuredTimeZone=uiSettings.get("dateFormat:tz");if(configuredTimeZone==="Browser"){return external_kbnSharedDeps_MomentTimezone_default.a.tz.guess()}return configuredTimeZone}class XyVisualization{constructor(){}setup(core,{expressions:expressions,formatFactory:formatFactory,editorFrame:editorFrame,charts:charts}){editorFrame.registerVisualization(async()=>{const{legendConfig:legendConfig,yAxisConfig:yAxisConfig,tickLabelsConfig:tickLabelsConfig,gridlinesConfig:gridlinesConfig,axisTitlesVisibilityConfig:axisTitlesVisibilityConfig,layerConfig:layerConfig,xyChart:xyChart,getXyChartRenderer:getXyChartRenderer,getXyVisualization:getXyVisualization}=await __webpack_require__.e(0).then(__webpack_require__.bind(null,312));const[,{data:data}]=await core.getStartServices();const palettes=await charts.palettes.getPalettes();expressions.registerFunction(()=>legendConfig);expressions.registerFunction(()=>yAxisConfig);expressions.registerFunction(()=>tickLabelsConfig);expressions.registerFunction(()=>gridlinesConfig);expressions.registerFunction(()=>axisTitlesVisibilityConfig);expressions.registerFunction(()=>layerConfig);expressions.registerFunction(()=>xyChart);expressions.registerRenderer(getXyChartRenderer({formatFactory:formatFactory,chartsThemeService:charts.theme,paletteService:palettes,timeZone:getTimeZone(core.uiSettings),getIntervalByColumn:data.search.aggs.getDateMetaByDatatableColumn}));return getXyVisualization({paletteService:palettes,data:data})})}}class MetricVisualization{constructor(){}setup(_core,{expressions:expressions,formatFactory:formatFactory,editorFrame:editorFrame}){editorFrame.registerVisualization(async()=>{const{metricVisualization:metricVisualization,metricChart:metricChart,getMetricChartRenderer:getMetricChartRenderer}=await __webpack_require__.e(0).then(__webpack_require__.bind(null,312));expressions.registerFunction(()=>metricChart);expressions.registerRenderer(()=>getMetricChartRenderer(formatFactory));return metricVisualization})}}class DatatableVisualization{constructor(){}setup(core,{expressions:expressions,formatFactory:formatFactory,editorFrame:editorFrame}){editorFrame.registerVisualization(async()=>{const{getDatatable:getDatatable,datatableColumn:datatableColumn,getDatatableRenderer:getDatatableRenderer,datatableVisualization:datatableVisualization}=await __webpack_require__.e(0).then(__webpack_require__.bind(null,312));const resolvedFormatFactory=await formatFactory;expressions.registerFunction(()=>datatableColumn);expressions.registerFunction(()=>getDatatable({formatFactory:resolvedFormatFactory}));expressions.registerRenderer(()=>getDatatableRenderer({formatFactory:resolvedFormatFactory,getType:core.getStartServices().then(([_,{data:dataStart}])=>dataStart.search.aggs.types.get)}));return datatableVisualization})}}class PieVisualization{constructor(){}setup(core,{expressions:expressions,formatFactory:formatFactory,editorFrame:editorFrame,charts:charts}){editorFrame.registerVisualization(async()=>{const{getPieVisualization:getPieVisualization,pie:pie,getPieRenderer:getPieRenderer}=await __webpack_require__.e(0).then(__webpack_require__.bind(null,312));const palettes=await charts.palettes.getPalettes();expressions.registerFunction(()=>pie);expressions.registerRenderer(getPieRenderer({formatFactory:formatFactory,chartsThemeService:charts.theme,paletteService:palettes}));return getPieVisualization({paletteService:palettes})})}}var core_public_=__webpack_require__(4);var uiActions_public_=__webpack_require__(2);const getLensAliasConfig=()=>({aliasPath:Object(common["getBasePath"])(),aliasApp:"lens",name:"lens",promotion:true,title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.lens.visTypeAlias.title",{defaultMessage:"Lens"}),description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.lens.visTypeAlias.description",{defaultMessage:"Create visualizations with our drag and drop editor. Switch between visualization types at any time."}),note:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.lens.visTypeAlias.note",{defaultMessage:"Recommended for most users."}),icon:"lensApp",stage:"production",appExtensions:{visualizations:{docTypes:["lens"],searchFields:["title^3"],toListItem(savedObject){const{id:id,type:type,attributes:attributes}=savedObject;const{title:title,description:description}=attributes;return{id:id,title:title,description:description,editUrl:Object(common["getEditPath"])(id),editApp:"lens",icon:"lensApp",stage:"production",savedObjectType:type,typeTitle:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.lens.visTypeAlias.type",{defaultMessage:"Lens"})}}}}});const visualizeFieldAction=application=>Object(uiActions_public_["createAction"])({type:uiActions_public_["ACTION_VISUALIZE_LENS_FIELD"],id:uiActions_public_["ACTION_VISUALIZE_LENS_FIELD"],getDisplayName:()=>external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.lens.discover.visualizeFieldLegend",{defaultMessage:"Visualize field"}),isCompatible:async()=>!!application.capabilities.visualize.show,execute:async context=>{application.navigateToApp("lens",{state:{type:uiActions_public_["ACTION_VISUALIZE_LENS_FIELD"],payload:context}})}});var js_levenshtein=__webpack_require__(15);var js_levenshtein_default=__webpack_require__.n(js_levenshtein);var external_kbnSharedDeps_Rxjs_=__webpack_require__(8);const getSearchProvider=uiCapabilities=>({id:"lens",find:({term:term="",types:types,tags:tags})=>{if(tags||types&&!types.includes("application")){return Object(external_kbnSharedDeps_Rxjs_["of"])([])}return Object(external_kbnSharedDeps_Rxjs_["from"])(uiCapabilities.then(({navLinks:{visualize:visualizeNavLink}})=>{if(!visualizeNavLink){return[]}const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.lens.searchTitle",{defaultMessage:"Lens: create visualizations",description:"Lens is a product name and should not be translated"});const searchableTitle=title.toLowerCase();term=term.toLowerCase();let score=0;if(searchableTitle===term){score=100}else if(searchableTitle.startsWith(term)){score=90}else if(searchableTitle.includes(term)){score=75}else{const length=Math.max(term.length,searchableTitle.length);const distance=js_levenshtein_default()(term,searchableTitle);const ratio=Math.floor((1-distance/length)*100);if(ratio>=60){score=ratio}}if(score===0)return[];return[{id:"lens",title:title,type:"application",icon:"logoKibana",meta:{categoryId:core_public_["DEFAULT_APP_CATEGORIES"].kibana.id,categoryLabel:core_public_["DEFAULT_APP_CATEGORIES"].kibana.label},score:score,url:Object(common["getFullPath"])()}]}))},getSearchableTypes:()=>["application"]});function getEmbeddableComponent(embeddableStart){return props=>{const factory=embeddableStart.getEmbeddableFactory("lens");return external_kbnSharedDeps_React_default.a.createElement(public_["EmbeddableRenderer"],{factory:factory,input:props})}}function plugin_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class plugin_LensPlugin{constructor(){plugin_defineProperty(this,"datatableVisualization",void 0);plugin_defineProperty(this,"editorFrameService",void 0);plugin_defineProperty(this,"createEditorFrame",null);plugin_defineProperty(this,"attributeService",null);plugin_defineProperty(this,"indexpatternDatasource",void 0);plugin_defineProperty(this,"xyVisualization",void 0);plugin_defineProperty(this,"metricVisualization",void 0);plugin_defineProperty(this,"pieVisualization",void 0);plugin_defineProperty(this,"stopReportManager",void 0);this.datatableVisualization=new DatatableVisualization;this.editorFrameService=new service_EditorFrameService;this.indexpatternDatasource=new indexpattern_datasource_IndexPatternDatasource;this.xyVisualization=new XyVisualization;this.metricVisualization=new MetricVisualization;this.pieVisualization=new PieVisualization}setup(core,{urlForwarding:urlForwarding,expressions:expressions,data:data,embeddable:embeddable,visualizations:visualizations,charts:charts,globalSearch:globalSearch}){this.attributeService=async()=>{const{getLensAttributeService:getLensAttributeService}=await __webpack_require__.e(0).then(__webpack_require__.bind(null,312));const[coreStart,startDependencies]=await core.getStartServices();return getLensAttributeService(coreStart,startDependencies)};const editorFrameSetupInterface=this.editorFrameService.setup(core,{data:data,embeddable:embeddable,charts:charts,expressions:expressions},this.attributeService);const dependencies={expressions:expressions,data:data,charts:charts,editorFrame:editorFrameSetupInterface,formatFactory:core.getStartServices().then(([_,{data:dataStart}])=>dataStart.fieldFormats.deserialize)};this.indexpatternDatasource.setup(core,dependencies);this.xyVisualization.setup(core,dependencies);this.datatableVisualization.setup(core,dependencies);this.metricVisualization.setup(core,dependencies);this.pieVisualization.setup(core,dependencies);visualizations.registerAlias(getLensAliasConfig());const getByValueFeatureFlag=async()=>{const[,deps]=await core.getStartServices();return deps.dashboard.dashboardFeatureFlagConfig};const getPresentationUtilContext=async()=>{const[,deps]=await core.getStartServices();const{ContextProvider:ContextProvider}=deps.presentationUtil;return ContextProvider};core.application.register({id:common["APP_ID"],title:common["NOT_INTERNATIONALIZED_PRODUCT_NAME"],navLinkStatus:core_public_["AppNavLinkStatus"].hidden,mount:async params=>{const{mountApp:mountApp,stopReportManager:stopReportManager}=await __webpack_require__.e(0).then(__webpack_require__.bind(null,312));this.stopReportManager=stopReportManager;return mountApp(core,params,{createEditorFrame:this.createEditorFrame,attributeService:this.attributeService,getByValueFeatureFlag:getByValueFeatureFlag,getPresentationUtilContext:getPresentationUtilContext})}});if(globalSearch){globalSearch.registerResultProvider(getSearchProvider(core.getStartServices().then(([{application:{capabilities:capabilities}}])=>capabilities)))}urlForwarding.forwardApp("lens","lens")}start(core,startDependencies){const frameStart=this.editorFrameService.start(core,startDependencies);this.createEditorFrame=frameStart.createInstance;if(startDependencies.uiActions.hasAction(uiActions_public_["ACTION_VISUALIZE_FIELD"])){startDependencies.uiActions.unregisterAction(uiActions_public_["ACTION_VISUALIZE_FIELD"])}startDependencies.uiActions.addTriggerAction(uiActions_public_["VISUALIZE_FIELD_TRIGGER"],visualizeFieldAction(core.application));return{EmbeddableComponent:getEmbeddableComponent(startDependencies.embeddable),navigateToPrefilledEditor:input=>{if(input.timeRange){startDependencies.data.query.timefilter.timefilter.setTime(input.timeRange)}const transfer=new public_["EmbeddableStateTransfer"](core.application.navigateToApp,core.application.currentAppId$);transfer.navigateToEditor("lens",{path:Object(common["getEditPath"])(undefined),state:{originatingApp:"",valueInput:input}})},canUseEditor:()=>{var _core$application$cap;return Boolean((_core$application$cap=core.application.capabilities.visualize)===null||_core$application$cap===void 0?void 0:_core$application$cap.show)}}}stop(){if(this.stopReportManager){this.stopReportManager()}}}const public_plugin=()=>new plugin_LensPlugin},function(module,exports){module.exports=__kbnSharedDeps__.ElasticEui},function(module,exports){module.exports=__kbnSharedDeps__.Lodash},function(module,exports){module.exports=__kbnSharedDeps__.ElasticCharts},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/expressions/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/kibanaReact/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,exports){module.exports=__kbnSharedDeps__.TsLib},function(module,exports){module.exports=__kbnSharedDeps__.Moment},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/savedObjects/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/expressions/common");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/visualizations/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,exports){module.exports=__kbnSharedDeps__.RxjsOperators},function(module,exports){module.exports=__kbnSharedDeps__.ReactRouterDom},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/share/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/presentationUtil/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))}]);