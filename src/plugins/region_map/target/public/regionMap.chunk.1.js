(window["regionMap_bundle_jsonpfunction"]=window["regionMap_bundle_jsonpfunction"]||[]).push([[1],[,,,,,,,,,,,,,,,,,function(module,exports,__webpack_require__){"use strict";var isOldIE=function isOldIE(){var memo;return function memorize(){if(typeof memo==="undefined"){memo=Boolean(window&&document&&document.all&&!window.atob)}return memo}}();var getTarget=function getTarget(){var memo={};return function memorize(target){if(typeof memo[target]==="undefined"){var styleTarget=document.querySelector(target);if(window.HTMLIFrameElement&&styleTarget instanceof window.HTMLIFrameElement){try{styleTarget=styleTarget.contentDocument.head}catch(e){styleTarget=null}}memo[target]=styleTarget}return memo[target]}}();var stylesInDom=[];function getIndexByIdentifier(identifier){var result=-1;for(var i=0;i<stylesInDom.length;i++){if(stylesInDom[i].identifier===identifier){result=i;break}}return result}function modulesToDom(list,options){var idCountMap={};var identifiers=[];for(var i=0;i<list.length;i++){var item=list[i];var id=options.base?item[0]+options.base:item[0];var count=idCountMap[id]||0;var identifier="".concat(id," ").concat(count);idCountMap[id]=count+1;var index=getIndexByIdentifier(identifier);var obj={css:item[1],media:item[2],sourceMap:item[3]};if(index!==-1){stylesInDom[index].references++;stylesInDom[index].updater(obj)}else{stylesInDom.push({identifier:identifier,updater:addStyle(obj,options),references:1})}identifiers.push(identifier)}return identifiers}function insertStyleElement(options){var style=document.createElement("style");var attributes=options.attributes||{};if(typeof attributes.nonce==="undefined"){var nonce=true?__webpack_require__.nc:undefined;if(nonce){attributes.nonce=nonce}}Object.keys(attributes).forEach((function(key){style.setAttribute(key,attributes[key])}));if(typeof options.insert==="function"){options.insert(style)}else{var target=getTarget(options.insert||"head");if(!target){throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.")}target.appendChild(style)}return style}function removeStyleElement(style){if(style.parentNode===null){return false}style.parentNode.removeChild(style)}var replaceText=function replaceText(){var textStore=[];return function replace(index,replacement){textStore[index]=replacement;return textStore.filter(Boolean).join("\n")}}();function applyToSingletonTag(style,index,remove,obj){var css=remove?"":obj.media?"@media ".concat(obj.media," {").concat(obj.css,"}"):obj.css;if(style.styleSheet){style.styleSheet.cssText=replaceText(index,css)}else{var cssNode=document.createTextNode(css);var childNodes=style.childNodes;if(childNodes[index]){style.removeChild(childNodes[index])}if(childNodes.length){style.insertBefore(cssNode,childNodes[index])}else{style.appendChild(cssNode)}}}function applyToTag(style,options,obj){var css=obj.css;var media=obj.media;var sourceMap=obj.sourceMap;if(media){style.setAttribute("media",media)}else{style.removeAttribute("media")}if(sourceMap&&btoa){css+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))))," */")}if(style.styleSheet){style.styleSheet.cssText=css}else{while(style.firstChild){style.removeChild(style.firstChild)}style.appendChild(document.createTextNode(css))}}var singleton=null;var singletonCounter=0;function addStyle(obj,options){var style;var update;var remove;if(options.singleton){var styleIndex=singletonCounter++;style=singleton||(singleton=insertStyleElement(options));update=applyToSingletonTag.bind(null,style,styleIndex,false);remove=applyToSingletonTag.bind(null,style,styleIndex,true)}else{style=insertStyleElement(options);update=applyToTag.bind(null,style,options);remove=function remove(){removeStyleElement(style)}}update(obj);return function updateStyle(newObj){if(newObj){if(newObj.css===obj.css&&newObj.media===obj.media&&newObj.sourceMap===obj.sourceMap){return}update(obj=newObj)}else{remove()}}}module.exports=function(list,options){options=options||{};if(!options.singleton&&typeof options.singleton!=="boolean"){options.singleton=isOldIE()}list=list||[];var lastIdentifiers=modulesToDom(list,options);return function update(newList){newList=newList||[];if(Object.prototype.toString.call(newList)!=="[object Array]"){return}for(var i=0;i<lastIdentifiers.length;i++){var identifier=lastIdentifiers[i];var index=getIndexByIdentifier(identifier);stylesInDom[index].references--}var newLastIdentifiers=modulesToDom(newList,options);for(var _i=0;_i<lastIdentifiers.length;_i++){var _identifier=lastIdentifiers[_i];var _index=getIndexByIdentifier(_identifier);if(stylesInDom[_index].references===0){stylesInDom[_index].updater();stylesInDom.splice(_index,1)}}lastIdentifiers=newLastIdentifiers}}},function(module,exports,__webpack_require__){"use strict";module.exports=function(useSourceMap){var list=[];list.toString=function toString(){return this.map((function(item){var content=cssWithMappingToString(item,useSourceMap);if(item[2]){return"@media ".concat(item[2]," {").concat(content,"}")}return content})).join("")};list.i=function(modules,mediaQuery,dedupe){if(typeof modules==="string"){modules=[[null,modules,""]]}var alreadyImportedModules={};if(dedupe){for(var i=0;i<this.length;i++){var id=this[i][0];if(id!=null){alreadyImportedModules[id]=true}}}for(var _i=0;_i<modules.length;_i++){var item=[].concat(modules[_i]);if(dedupe&&alreadyImportedModules[item[0]]){continue}if(mediaQuery){if(!item[2]){item[2]=mediaQuery}else{item[2]="".concat(mediaQuery," and ").concat(item[2])}}list.push(item)}};return list};function cssWithMappingToString(item,useSourceMap){var content=item[1]||"";var cssMapping=item[3];if(!cssMapping){return content}if(useSourceMap&&typeof btoa==="function"){var sourceMapping=toComment(cssMapping);var sourceURLs=cssMapping.sources.map((function(source){return"/*# sourceURL=".concat(cssMapping.sourceRoot||"").concat(source," */")}));return[content].concat(sourceURLs).concat([sourceMapping]).join("\n")}return[content].join("\n")}function toComment(sourceMap){var base64=btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));var data="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(base64);return"/*# ".concat(data," */")}},function(module,exports,__webpack_require__){switch(window.__kbnThemeTag__){case"v7dark":return __webpack_require__(20);case"v7light":return __webpack_require__(22);case"v8dark":return __webpack_require__(24);case"v8light":return __webpack_require__(26)}},function(module,exports,__webpack_require__){var api=__webpack_require__(17);var content=__webpack_require__(21);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(18);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".rgmChart__wrapper, .rgmChart {\n  flex: 1 1 0;\n  display: flex; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(17);var content=__webpack_require__(23);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(18);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".rgmChart__wrapper, .rgmChart {\n  flex: 1 1 0;\n  display: flex; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(17);var content=__webpack_require__(25);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(18);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".rgmChart__wrapper, .rgmChart {\n  flex: 1 1 0;\n  display: flex; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(17);var content=__webpack_require__(27);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(18);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".rgmChart__wrapper, .rgmChart {\n  flex: 1 1 0;\n  display: flex; }\n",""]);module.exports=exports},,,,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",(function(){return RegionMapVisualization}));var external_kbnSharedDeps_React_=__webpack_require__(2);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(12);var external_kbnSharedDeps_Lodash_=__webpack_require__(13);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(1);var kibana_services=__webpack_require__(0);var public_=__webpack_require__(11);function tooltipFormatter(metric,fieldFormatter,fieldName,metricName){if(!metric){return""}const details=[];if(fieldName&&metric){details.push({label:fieldName,value:metric.term})}if(metric){details.push({label:metricName,value:fieldFormatter?fieldFormatter.convert(metric.value,"text"):metric.value})}return details}var mapsLegacy_public_=__webpack_require__(4);function createRegionMapVisualization({regionmapsConfig:regionmapsConfig,uiSettings:uiSettings,BaseMapsVisualization:BaseMapsVisualization,getServiceSettings:getServiceSettings}){return class RegionMapsVisualization extends BaseMapsVisualization{constructor(container,handlers,initialVisParams){super(container,handlers,initialVisParams);this._choroplethLayer=null;this._tooltipFormatter=Object(mapsLegacy_public_["mapTooltipProvider"])(container,tooltipFormatter)}async render(esResponse,visParams){Object(kibana_services["c"])().loadFontAwesome();await super.render(esResponse,visParams);if(this._choroplethLayer){await this._choroplethLayer.whenDataLoaded()}}async _updateData(table){this._chartData=table;const termColumn=this._params.bucket?table.columns[this._params.bucket.accessor]:null;const valueColumn=table.columns[this._params.metric.accessor];let results;if(!this._hasColumns()||!table.rows.length){results=[]}else{results=table.rows.map(row=>{const term=row[termColumn.id];const value=row[valueColumn.id];return{term:term,value:value}})}const selectedLayer=await this._loadConfig(this._params.selectedLayer);if(!this._params.selectedJoinField&&selectedLayer){this._params.selectedJoinField=selectedLayer.fields[0]}if(!selectedLayer){return}await this._updateChoroplethLayerForNewMetrics(selectedLayer.name,selectedLayer.attribution,this._params.showAllShapes,results);const metricFieldFormatter=Object(kibana_services["b"])().deserialize(this._params.metric.format);this._choroplethLayer.setMetrics(results,metricFieldFormatter,valueColumn.name);if(termColumn&&valueColumn){this._choroplethLayer.setTooltipFormatter(this._tooltipFormatter,metricFieldFormatter,termColumn.name,valueColumn.name)}this._kibanaMap.useUiStateFromVisualization(this.handlers.uiState)}async _loadConfig(fileLayerConfig){const{escape:escape}=await Promise.resolve().then(__webpack_require__.t.bind(null,13,7));if(fileLayerConfig.isEMS||fileLayerConfig.layerId&&fileLayerConfig.layerId.startsWith(`${mapsLegacy_public_["ORIGIN"].EMS}.`)){const serviceSettings=await getServiceSettings();return await serviceSettings.loadFileLayerConfig(fileLayerConfig)}const configuredLayer=regionmapsConfig.layers.find(layer=>layer.name===fileLayerConfig.name);if(configuredLayer){return{...configuredLayer,attribution:escape(configuredLayer.attribution?configuredLayer.attribution:"")}}return null}async _updateParams(){await super._updateParams();const selectedLayer=await this._loadConfig(this._params.selectedLayer);if(!this._params.selectedJoinField&&selectedLayer){this._params.selectedJoinField=selectedLayer.fields[0]}if(!this._params.selectedJoinField||!selectedLayer){return}await this._updateChoroplethLayerForNewProperties(selectedLayer.name,selectedLayer.attribution,this._params.showAllShapes);const metricFieldFormatter=Object(kibana_services["b"])().deserialize(this._params.metric.format);this._choroplethLayer.setJoinField(this._params.selectedJoinField.name);this._choroplethLayer.setColorRamp(public_["truncatedColorMaps"][this._params.colorSchema].value);this._choroplethLayer.setLineWeight(this._params.outlineWeight);this._choroplethLayer.setTooltipFormatter(this._tooltipFormatter,metricFieldFormatter,this._metricLabel)}async _updateChoroplethLayerForNewMetrics(name,attribution,showAllData,newMetrics){if(this._choroplethLayer&&this._choroplethLayer.canReuseInstanceForNewMetrics(name,showAllData,newMetrics)){return}await this._recreateChoroplethLayer(name,attribution,showAllData)}async _updateChoroplethLayerForNewProperties(name,attribution,showAllData){if(this._choroplethLayer&&this._choroplethLayer.canReuseInstance(name,showAllData)){return}await this._recreateChoroplethLayer(name,attribution,showAllData)}async _recreateChoroplethLayer(name,attribution,showAllData){const selectedLayer=await this._loadConfig(this._params.selectedLayer);this._kibanaMap.removeLayer(this._choroplethLayer);if(this._choroplethLayer){this._choroplethLayer=this._choroplethLayer.cloneChoroplethLayerForNewData(name,attribution,selectedLayer.format,showAllData,selectedLayer.meta,selectedLayer,await getServiceSettings(),(await Object(mapsLegacy_public_["lazyLoadMapsLegacyModules"])()).L)}else{const{ChoroplethLayer:ChoroplethLayer}=await __webpack_require__.e(2).then(__webpack_require__.bind(null,31));this._choroplethLayer=new ChoroplethLayer(name,attribution,selectedLayer.format,showAllData,selectedLayer.meta,selectedLayer,await getServiceSettings(),(await Object(mapsLegacy_public_["lazyLoadMapsLegacyModules"])()).L)}this._choroplethLayer.on("select",event=>{const{rows:rows,columns:columns}=this._chartData;const rowIndex=rows.findIndex(row=>row[columns[0].id]===event);this.handlers.event({name:"filterBucket",data:{data:[{table:this._chartData,column:0,row:rowIndex,value:event}]}})});this._choroplethLayer.on("styleChanged",event=>{const shouldShowWarning=this._params.isDisplayWarning&&uiSettings.get("visualization:regionmap:showWarnings");if(event.mismatches.length>0&&shouldShowWarning){Object(kibana_services["d"])().toasts.addWarning({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("regionMap.visualization.unableToShowMismatchesWarningTitle",{defaultMessage:"Unable to show {mismatchesLength} {oneMismatch, plural, one {result} other {results}} on map",values:{mismatchesLength:event.mismatches.length,oneMismatch:event.mismatches.length>1?0:1}}),text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("regionMap.visualization.unableToShowMismatchesWarningText",{defaultMessage:"Ensure that each of these term matches a shape on that shape's join field: {mismatches}",values:{mismatches:event.mismatches?event.mismatches.join(", "):""}})})}});this._kibanaMap.addLayer(this._choroplethLayer)}_hasColumns(){return this._chartData&&this._chartData.columns.length===2}}}var region_map_visualization=__webpack_require__(19);const RegionMapVisualization=({deps:deps,handlers:handlers,visData:visData,visConfig:visConfig})=>{const chartDiv=Object(external_kbnSharedDeps_React_["useRef"])(null);const visController=Object(external_kbnSharedDeps_React_["useRef"])(null);const isFirstRender=Object(external_kbnSharedDeps_React_["useRef"])(true);const uiState=handlers.uiState;Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(chartDiv.current&&isFirstRender.current){isFirstRender.current=false;const Controller=createRegionMapVisualization(deps);visController.current=new Controller(chartDiv.current,handlers,visConfig)}},[deps,handlers,visConfig,visData]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{var _visController$curren;(_visController$curren=visController.current)===null||_visController$curren===void 0?void 0:_visController$curren.render(visData,visConfig).then(handlers.done)},[visData,visConfig,handlers.done]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const onUiStateChange=()=>{var _visController$curren2;(_visController$curren2=visController.current)===null||_visController$curren2===void 0?void 0:_visController$curren2.render().then(handlers.done)};uiState===null||uiState===void 0?void 0:uiState.on("change",onUiStateChange);return()=>{uiState===null||uiState===void 0?void 0:uiState.off("change",onUiStateChange)}},[uiState,handlers.done]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>()=>{var _visController$curren3;(_visController$curren3=visController.current)===null||_visController$curren3===void 0?void 0:_visController$curren3.destroy();visController.current=null},[]);const updateChartSize=Object(external_kbnSharedDeps_React_["useMemo"])(()=>Object(external_kbnSharedDeps_Lodash_["throttle"])(()=>{var _visController$curren4;return(_visController$curren4=visController.current)===null||_visController$curren4===void 0?void 0:_visController$curren4.resize()},300),[]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiResizeObserver"],{onResize:updateChartSize},resizeRef=>external_kbnSharedDeps_React_default.a.createElement("div",{className:"rgmChart__wrapper",ref:resizeRef},external_kbnSharedDeps_React_default.a.createElement("div",{className:"rgmChart",ref:chartDiv})))}}]]);