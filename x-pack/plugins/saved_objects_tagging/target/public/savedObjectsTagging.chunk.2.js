/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window["savedObjectsTagging_bundle_jsonpfunction"]=window["savedObjectsTagging_bundle_jsonpfunction"]||[]).push([[2],{43:function(module,exports,__webpack_require__){switch(window.__kbnThemeTag__){case"v7dark":return __webpack_require__(44);case"v7light":return __webpack_require__(46);case"v8dark":return __webpack_require__(48);case"v8light":return __webpack_require__(50)}},44:function(module,exports,__webpack_require__){var api=__webpack_require__(27);var content=__webpack_require__(45);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},45:function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(28);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".tagAssignFlyout__selectionIcon {\n  margin-right: 12px;\n  margin-left: 12px; }\n\n.tagAssignFlyout_searchContainer {\n  padding: 16px 24px 8px; }\n\n.tagAssignFlyout__actionBar {\n  margin-top: 4px; }\n",""]);module.exports=exports},46:function(module,exports,__webpack_require__){var api=__webpack_require__(27);var content=__webpack_require__(47);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},47:function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(28);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".tagAssignFlyout__selectionIcon {\n  margin-right: 12px;\n  margin-left: 12px; }\n\n.tagAssignFlyout_searchContainer {\n  padding: 16px 24px 8px; }\n\n.tagAssignFlyout__actionBar {\n  margin-top: 4px; }\n",""]);module.exports=exports},48:function(module,exports,__webpack_require__){var api=__webpack_require__(27);var content=__webpack_require__(49);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},49:function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(28);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".tagAssignFlyout__selectionIcon {\n  margin-right: 12px;\n  margin-left: 12px; }\n\n.tagAssignFlyout_searchContainer {\n  padding: 16px 24px 8px; }\n\n.tagAssignFlyout__actionBar {\n  margin-top: 4px; }\n",""]);module.exports=exports},50:function(module,exports,__webpack_require__){var api=__webpack_require__(27);var content=__webpack_require__(51);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},51:function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(28);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".tagAssignFlyout__selectionIcon {\n  margin-right: 12px;\n  margin-left: 12px; }\n\n.tagAssignFlyout_searchContainer {\n  padding: 16px 24px 8px; }\n\n.tagAssignFlyout__actionBar {\n  margin-top: 4px; }\n",""]);module.exports=exports},55:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"AssignFlyout",(function(){return AssignFlyout}));var external_kbnSharedDeps_React_=__webpack_require__(0);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(1);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(5);function parseQuery(query){let queryText;let selectedTypes;if(query){if(query.ast.getTermClauses().length){queryText=query.ast.getTermClauses().map(clause=>clause.value).join(" ")}if(query.ast.getFieldClauses("type")){selectedTypes=query.ast.getFieldClauses("type")[0].value}}return{queryText:queryText,selectedTypes:selectedTypes}}var external_kbnSharedDeps_Lodash_=__webpack_require__(13);const getKey=({id:id,type:type})=>`${type}|${id}`;const getOverriddenStatus=(initialStatus,override)=>{if(override){return override==="selected"?"full":"none"}return initialStatus};const getAssignmentAction=(initialStatus,override)=>{const overriddenStatus=getOverriddenStatus(initialStatus,override);if(initialStatus!==overriddenStatus){if(overriddenStatus==="full"){return"added"}if(overriddenStatus==="none"){return"removed"}}return"unchanged"};const statusPriority={full:1,partial:2,none:3};const sortByStatusAndTitle=(objects,statusMap)=>Object(external_kbnSharedDeps_Lodash_["sortBy"])(objects,[obj=>`${statusPriority[statusMap[getKey(obj)]]}-${obj.title}`]);const computeRequiredChanges=({objects:objects,initialStatus:initialStatus,overrides:overrides})=>{const assigned=[];const unassigned=[];objects.forEach(object=>{const key=getKey(object);const status=initialStatus[key];const override=overrides[key];const action=getAssignmentAction(status,override);if(action==="added"){assigned.push(object)}if(action==="removed"){unassigned.push(object)}});return{assigned:assigned,unassigned:unassigned}};var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(11);var base=__webpack_require__(3);const AssignFlyoutHeader=({tagCache:tagCache,tagIds:tagIds})=>{const tags=Object(external_kbnSharedDeps_React_["useMemo"])(()=>tagCache.getState().filter(tag=>tagIds.includes(tag.id)),[tagCache,tagIds]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"m"},external_kbnSharedDeps_React_default.a.createElement("h3",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.savedObjectsTagging.assignFlyout.title",defaultMessage:"Manage tag assignments"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(base["b"],{tags:tags}))};const AssignFlyoutActionBar=({resultCount:resultCount,initiallyAssigned:initiallyAssigned,pendingChanges:pendingChanges,onReset:onReset,onSelectAll:onSelectAll,onDeselectAll:onDeselectAll})=>external_kbnSharedDeps_React_default.a.createElement("div",{className:"tagAssignFlyout__actionBar"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween",alignItems:"center",gutterSize:"m"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",color:"subdued"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.savedObjectsTagging.assignFlyout.actionBar.totalResultsLabel",defaultMessage:"{count, plural, one {1 saved object} other {# saved objects}}",values:{count:resultCount}}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement("div",{className:"tagMgt__actionBarDivider"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",color:"subdued"},pendingChanges>0?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.savedObjectsTagging.assignFlyout.actionBar.pendingChanges",defaultMessage:"{count} pending changes",values:{count:pendingChanges}}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.savedObjectsTagging.assignFlyout.actionBar.currentlyAssigned",defaultMessage:"{count} currently assigned",values:{count:initiallyAssigned}}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{onClick:onReset,"data-test-subj":"assignFlyout-resetButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.savedObjectsTagging.assignFlyout.actionBar.resetLabel",defaultMessage:"Reset"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{onClick:onSelectAll,"data-test-subj":"assignFlyout-selectAllButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.savedObjectsTagging.assignFlyout.actionBar.selectedAllLabel",defaultMessage:"Select all"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{onClick:onDeselectAll,"data-test-subj":"assignFlyout-deselectAllButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.savedObjectsTagging.assignFlyout.actionBar.deselectedAllLabel",defaultMessage:"Deselect all"}))))));const AssignFlyoutFooter=({isSaving:isSaving,hasPendingChanges:hasPendingChanges,onCancel:onCancel,onSave:onSave})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:onCancel,"data-test-subj":"assignFlyoutCancelButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.savedObjectsTagging.assignFlyout.cancelButtonLabel",defaultMessage:"Cancel"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:onSave,isLoading:isSaving,disabled:!hasPendingChanges,fill:true,iconType:"save","data-test-subj":"assignFlyoutConfirmButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.savedObjectsTagging.assignFlyout.confirmButtonLabel",defaultMessage:"Save tag assignments"}))));const AssignFlyoutResultList=({results:results,isLoading:isLoading,initialStatus:initialStatus,overrides:overrides,onChange:onChange})=>{const options=results.map(result=>{var _result$icon;const key=getKey(result);const overriddenStatus=getOverriddenStatus(initialStatus[key],overrides[key]);const checkedStatus=overriddenStatus==="full"?"on":undefined;const statusIcon=overriddenStatus==="full"?"check":overriddenStatus==="none"?"empty":"partial";const assignmentAction=getAssignmentAction(initialStatus[key],overrides[key]);return{label:result.title,key:key,"data-test-subj":`assign-result-${result.type}-${result.id}`,checked:checkedStatus,previously:checkedStatus,showIcons:false,prepend:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{className:`tagAssignFlyout__selectionIcon status-${overriddenStatus}`,type:statusIcon,"data-test-subj":"assign-result-status"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:(_result$icon=result.icon)!==null&&_result$icon!==void 0?_result$icon:"empty",title:result.type})),append:external_kbnSharedDeps_React_default.a.createElement(ResultActionLabel,{action:assignmentAction})}});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelectable"],{height:"full","data-test-subj":"assignFlyoutResultList",options:options,allowExclusions:false,isLoading:isLoading,onChange:newOptions=>{const newOverrides=newOptions.reduce((memo,option)=>{if(option.checked===option.previously){return memo}return{...memo,[option.key]:option.checked==="on"?"selected":"deselected"}},{});onChange(newOverrides)}},list=>list)};const ResultActionLabel=({action:action})=>{if(action==="unchanged"){return null}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",color:"subdued",style:{display:"inline-block"}},action==="added"?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.savedObjectsTagging.assignFlyout.resultList.addedLabel",defaultMessage:"Added"}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.savedObjectsTagging.assignFlyout.resultList.removedLabel",defaultMessage:"Removed"}))};const AssignFlyoutSearchBar=({onChange:onChange,types:types,isLoading:isLoading})=>{const filters=Object(external_kbnSharedDeps_React_["useMemo"])(()=>[{type:"field_value_selection",field:"type",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.savedObjectsTagging.assignFlyout.typeFilterName",{defaultMessage:"Type"}),multiSelect:"or",options:types.map(type=>({value:type,name:type}))}],[types]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSearchBar"],{box:{"data-test-subj":"assignFlyoutSearchBar",placeholder:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.savedObjectsTagging.assignFlyout.searchPlaceholder",{defaultMessage:"Search by saved object name"}),isLoading:isLoading},onChange:onChange,filters:filters})};var assign_flyout=__webpack_require__(43);const getObjectStatus=(object,assignedTags)=>{const assignedCount=assignedTags.reduce((count,tagId)=>count+(object.tags.includes(tagId)?1:0),0);return assignedCount===0?"none":assignedCount===assignedTags.length?"full":"partial"};const AssignFlyout=({tagIds:tagIds,tagCache:tagCache,allowedTypes:allowedTypes,notifications:notifications,assignmentService:assignmentService,onClose:onClose})=>{const[results,setResults]=Object(external_kbnSharedDeps_React_["useState"])([]);const[query,setQuery]=Object(external_kbnSharedDeps_React_["useState"])(external_kbnSharedDeps_ElasticEui_["Query"].parse(""));const[initialStatus,setInitialStatus]=Object(external_kbnSharedDeps_React_["useState"])({});const[overrides,setOverrides]=Object(external_kbnSharedDeps_React_["useState"])({});const[isLoading,setLoading]=Object(external_kbnSharedDeps_React_["useState"])(false);const[isSaving,setSaving]=Object(external_kbnSharedDeps_React_["useState"])(false);const[initiallyAssigned,setInitiallyAssigned]=Object(external_kbnSharedDeps_React_["useState"])(0);const[pendingChangeCount,setPendingChangeCount]=Object(external_kbnSharedDeps_React_["useState"])(0);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const refreshResults=async()=>{setLoading(true);const{queryText:queryText,selectedTypes:selectedTypes}=parseQuery(query);const fetched=await assignmentService.findAssignableObjects({search:queryText?`${queryText}*`:undefined,types:selectedTypes,maxResults:1e3});const fetchedStatus=fetched.reduce((status,result)=>({...status,[getKey(result)]:getObjectStatus(result,tagIds)}),{});const assignedCount=Object.values(fetchedStatus).filter(status=>status!=="none").length;setResults(sortByStatusAndTitle(fetched,fetchedStatus));setOverrides({});setInitialStatus(fetchedStatus);setInitiallyAssigned(assignedCount);setPendingChangeCount(0);setLoading(false)};refreshResults()},[query,assignmentService,tagIds]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const changes=computeRequiredChanges({objects:results,initialStatus:initialStatus,overrides:overrides});setPendingChangeCount(changes.assigned.length+changes.unassigned.length)},[initialStatus,overrides,results]);const onSave=Object(external_kbnSharedDeps_React_["useCallback"])(async()=>{setSaving(true);const changes=computeRequiredChanges({objects:results,initialStatus:initialStatus,overrides:overrides});await assignmentService.updateTagAssignments({tags:tagIds,assign:changes.assigned.map(({type:type,id:id})=>({type:type,id:id})),unassign:changes.unassigned.map(({type:type,id:id})=>({type:type,id:id}))});notifications.toasts.addSuccess(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.savedObjectsTagging.assignFlyout.successNotificationTitle",{defaultMessage:"Saved assignments to {count, plural, one {1 saved object} other {# saved objects}}",values:{count:changes.assigned.length+changes.unassigned.length}}));onClose()},[tagIds,results,initialStatus,overrides,notifications,assignmentService,onClose]);const resetAll=Object(external_kbnSharedDeps_React_["useCallback"])(()=>{setOverrides({})},[]);const selectAll=Object(external_kbnSharedDeps_React_["useCallback"])(()=>{setOverrides(results.reduce((status,result)=>({...status,[getKey(result)]:"selected"}),{}))},[results]);const deselectAll=Object(external_kbnSharedDeps_React_["useCallback"])(()=>{setOverrides(results.reduce((status,result)=>({...status,[getKey(result)]:"deselected"}),{}))},[results]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutHeader"],{hasBorder:true},external_kbnSharedDeps_React_default.a.createElement(AssignFlyoutHeader,{tagIds:tagIds,tagCache:tagCache})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutHeader"],{hasBorder:true,className:"tagAssignFlyout_searchContainer"},external_kbnSharedDeps_React_default.a.createElement(AssignFlyoutSearchBar,{onChange:({query:newQuery})=>{setQuery(newQuery)},isLoading:isLoading,types:allowedTypes}),external_kbnSharedDeps_React_default.a.createElement(AssignFlyoutActionBar,{resultCount:results.length,initiallyAssigned:initiallyAssigned,pendingChanges:pendingChangeCount,onReset:resetAll,onSelectAll:selectAll,onDeselectAll:deselectAll})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:1},external_kbnSharedDeps_React_default.a.createElement(AssignFlyoutResultList,{results:results,isLoading:isLoading,initialStatus:initialStatus,overrides:overrides,onChange:newOverrides=>{setOverrides(oldOverrides=>({...oldOverrides,...newOverrides}))}})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutFooter"],null,external_kbnSharedDeps_React_default.a.createElement(AssignFlyoutFooter,{isSaving:isSaving,hasPendingChanges:pendingChangeCount>0,onSave:onSave,onCancel:onClose})))}}}]);