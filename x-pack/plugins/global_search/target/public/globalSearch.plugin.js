/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=11)})([function(module,exports){module.exports=__kbnSharedDeps__.Rxjs},function(module,exports){},function(module,exports){module.exports=__kbnSharedDeps__.RxjsOperators},function(module,exports){},function(module,exports){},function(module,exports){var getRandomValues=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(getRandomValues){var rnds8=new Uint8Array(16);module.exports=function whatwgRNG(){getRandomValues(rnds8);return rnds8}}else{var rnds=new Array(16);module.exports=function mathRNG(){for(var i=0,r;i<16;i++){if((i&3)===0)r=Math.random()*4294967296;rnds[i]=r>>>((i&3)<<3)&255}return rnds}}},function(module,exports){var byteToHex=[];for(var i=0;i<256;++i){byteToHex[i]=(i+256).toString(16).substr(1)}function bytesToUuid(buf,offset){var i=offset||0;var bth=byteToHex;return[bth[buf[i++]],bth[buf[i++]],bth[buf[i++]],bth[buf[i++]],"-",bth[buf[i++]],bth[buf[i++]],"-",bth[buf[i++]],bth[buf[i++]],"-",bth[buf[i++]],bth[buf[i++]],"-",bth[buf[i++]],bth[buf[i++]],bth[buf[i++]],bth[buf[i++]],bth[buf[i++]],bth[buf[i++]]].join("")}module.exports=bytesToUuid},function(module,exports){module.exports=__kbnSharedDeps__.Lodash},function(module,exports){module.exports=__kbnSharedDeps__.Moment},function(module,exports){module.exports=__kbnSharedDeps__.KbnI18n},function(module,exports,__webpack_require__){var v1=__webpack_require__(13);var v4=__webpack_require__(14);var uuid=v4;uuid.v1=v1;uuid.v4=v4;module.exports=uuid},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _node_modules_val_loader_dist_cjs_js_key_globalSearch_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(12);var _node_modules_val_loader_dist_cjs_js_key_globalSearch_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_val_loader_dist_cjs_js_key_globalSearch_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0__);__kbnBundles__.define("plugin/globalSearch/public",__webpack_require__,15)},function(module,exports,__webpack_require__){__webpack_require__.p=window.__kbnPublicPath__["globalSearch"]},function(module,exports,__webpack_require__){var rng=__webpack_require__(5);var bytesToUuid=__webpack_require__(6);var _nodeId;var _clockseq;var _lastMSecs=0;var _lastNSecs=0;function v1(options,buf,offset){var i=buf&&offset||0;var b=buf||[];options=options||{};var node=options.node||_nodeId;var clockseq=options.clockseq!==undefined?options.clockseq:_clockseq;if(node==null||clockseq==null){var seedBytes=rng();if(node==null){node=_nodeId=[seedBytes[0]|1,seedBytes[1],seedBytes[2],seedBytes[3],seedBytes[4],seedBytes[5]]}if(clockseq==null){clockseq=_clockseq=(seedBytes[6]<<8|seedBytes[7])&16383}}var msecs=options.msecs!==undefined?options.msecs:(new Date).getTime();var nsecs=options.nsecs!==undefined?options.nsecs:_lastNSecs+1;var dt=msecs-_lastMSecs+(nsecs-_lastNSecs)/1e4;if(dt<0&&options.clockseq===undefined){clockseq=clockseq+1&16383}if((dt<0||msecs>_lastMSecs)&&options.nsecs===undefined){nsecs=0}if(nsecs>=1e4){throw new Error("uuid.v1(): Can't create more than 10M uuids/sec")}_lastMSecs=msecs;_lastNSecs=nsecs;_clockseq=clockseq;msecs+=122192928e5;var tl=((msecs&268435455)*1e4+nsecs)%4294967296;b[i++]=tl>>>24&255;b[i++]=tl>>>16&255;b[i++]=tl>>>8&255;b[i++]=tl&255;var tmh=msecs/4294967296*1e4&268435455;b[i++]=tmh>>>8&255;b[i++]=tmh&255;b[i++]=tmh>>>24&15|16;b[i++]=tmh>>>16&255;b[i++]=clockseq>>>8|128;b[i++]=clockseq&255;for(var n=0;n<6;++n){b[i+n]=node[n]}return buf?buf:bytesToUuid(b)}module.exports=v1},function(module,exports,__webpack_require__){var rng=__webpack_require__(5);var bytesToUuid=__webpack_require__(6);function v4(options,buf,offset){var i=buf&&offset||0;if(typeof options=="string"){buf=options==="binary"?new Array(16):null;options=null}options=options||{};var rnds=options.random||(options.rng||rng)();rnds[6]=rnds[6]&15|64;rnds[8]=rnds[8]&63|128;if(buf){for(var ii=0;ii<16;++ii){buf[i+ii]=rnds[ii]}}return buf||bytesToUuid(rnds)}module.exports=v4},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"plugin",(function(){return public_plugin}));__webpack_require__.d(__webpack_exports__,"GlobalSearchBatchedResults",(function(){return common_types["GlobalSearchBatchedResults"]}));__webpack_require__.d(__webpack_exports__,"GlobalSearchProviderFindOptions",(function(){return common_types["GlobalSearchProviderFindOptions"]}));__webpack_require__.d(__webpack_exports__,"GlobalSearchProviderResult",(function(){return common_types["GlobalSearchProviderResult"]}));__webpack_require__.d(__webpack_exports__,"GlobalSearchProviderResultUrl",(function(){return common_types["GlobalSearchProviderResultUrl"]}));__webpack_require__.d(__webpack_exports__,"GlobalSearchResult",(function(){return common_types["GlobalSearchResult"]}));__webpack_require__.d(__webpack_exports__,"GlobalSearchFindParams",(function(){return common_types["GlobalSearchFindParams"]}));__webpack_require__.d(__webpack_exports__,"GlobalSearchProviderFindParams",(function(){return common_types["GlobalSearchProviderFindParams"]}));__webpack_require__.d(__webpack_exports__,"GlobalSearchPluginSetup",(function(){return public_types["GlobalSearchPluginSetup"]}));__webpack_require__.d(__webpack_exports__,"GlobalSearchPluginStart",(function(){return public_types["GlobalSearchPluginStart"]}));__webpack_require__.d(__webpack_exports__,"GlobalSearchResultProvider",(function(){return public_types["GlobalSearchResultProvider"]}));__webpack_require__.d(__webpack_exports__,"GlobalSearchFindOptions",(function(){return types["GlobalSearchFindOptions"]}));function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const checkLicense=license=>{const check=license.check("globalSearch","basic");switch(check.state){case"expired":return{valid:false,message:"expired"};case"invalid":return{valid:false,message:"invalid"};case"unavailable":return{valid:false,message:"unavailable"};case"valid":return{valid:true};default:throw new Error(`Invalid license state: ${check.state}`)}};class LicenseChecker{constructor(license$){_defineProperty(this,"subscription",void 0);_defineProperty(this,"state",{valid:false,message:"unknown"});this.subscription=license$.subscribe(license=>{this.state=checkLicense(license)})}getState(){return this.state}clean(){this.subscription.unsubscribe()}}var external_kbnSharedDeps_Rxjs_=__webpack_require__(0);var external_kbnSharedDeps_RxjsOperators_=__webpack_require__(2);var external_kbnSharedDeps_Lodash_=__webpack_require__(7);var external_kbnSharedDeps_Moment_=__webpack_require__(8);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(9);class GlobalSearchFindError extends Error{static invalidLicense(message){return new GlobalSearchFindError("invalid-license",message)}constructor(type,message){super(message);this.type=type;Object.setPrototypeOf(this,GlobalSearchFindError.prototype)}}function take_in_array_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function takeInArray(count){return function takeLastOperatorFunction(source){if(count===0){return external_kbnSharedDeps_Rxjs_["EMPTY"]}else{return source.lift(new TakeInArray(count))}}}class TakeInArray{constructor(total){this.total=total;if(this.total<0){throw new Error("Cannot take a negative number of items")}}call(subscriber,source){return source.subscribe(new take_in_array_TakeInArraySubscriber(subscriber,this.total))}}class take_in_array_TakeInArraySubscriber extends external_kbnSharedDeps_Rxjs_["Subscriber"]{constructor(destination,total){super(destination);this.total=total;take_in_array_defineProperty(this,"current",0)}_next(value){const remaining=this.total-this.current;if(remaining>value.length){this.destination.next(value);this.current+=value.length}else{this.destination.next(value.slice(0,remaining));this.destination.complete();this.unsubscribe()}}}const defaultMaxProviderResults=40;const convertResultUrl=(url,basePath)=>{if(typeof url==="string"){if(url.startsWith("/")){return basePath.prepend(url)}return url}if(url.prependBasePath){return basePath.prepend(url.path)}return url.path};const processProviderResult=(result,basePath)=>({...result,url:convertResultUrl(result.url,basePath)});var uuid=__webpack_require__(10);var uuid_default=__webpack_require__.n(uuid);const defaultPrefStorageKey="globalSearch:defaultPref";const getDefaultPreference=(storage=window.sessionStorage)=>{let pref=storage.getItem(defaultPrefStorageKey);if(pref){return pref}pref=uuid_default.a.v4();storage.setItem(defaultPrefStorageKey,pref);return pref};const fetchServerResults=(http,params,{preference:preference,aborted$:aborted$})=>{var _controller;let controller;if(aborted$){controller=new AbortController;aborted$.subscribe(()=>{controller.abort()})}return Object(external_kbnSharedDeps_Rxjs_["from"])(http.post("/internal/global_search/find",{body:JSON.stringify({params:params,options:{preference:preference}}),signal:(_controller=controller)===null||_controller===void 0?void 0:_controller.signal})).pipe(Object(external_kbnSharedDeps_RxjsOperators_["takeUntil"])(aborted$!==null&&aborted$!==void 0?aborted$:external_kbnSharedDeps_Rxjs_["EMPTY"]),Object(external_kbnSharedDeps_RxjsOperators_["map"])(response=>response.results))};const fetchServerSearchableTypes=async http=>{const{types:types}=await http.get("/internal/global_search/searchable_types");return types};function search_service_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const mapToUndefined=()=>undefined;class search_service_SearchService{constructor(){search_service_defineProperty(this,"providers",new Map);search_service_defineProperty(this,"config",void 0);search_service_defineProperty(this,"http",void 0);search_service_defineProperty(this,"maxProviderResults",defaultMaxProviderResults);search_service_defineProperty(this,"licenseChecker",void 0);search_service_defineProperty(this,"serverTypes",void 0)}setup({config:config,maxProviderResults:maxProviderResults=defaultMaxProviderResults}){this.config=config;this.maxProviderResults=maxProviderResults;return{registerResultProvider:provider=>{if(this.providers.has(provider.id)){throw new Error(`trying to register duplicate provider: ${provider.id}`)}this.providers.set(provider.id,provider)}}}start({http:http,licenseChecker:licenseChecker}){this.http=http;this.licenseChecker=licenseChecker;return{find:(params,options)=>this.performFind(params,options),getSearchableTypes:()=>this.getSearchableTypes()}}async getSearchableTypes(){const providerTypes=(await Promise.all([...this.providers.values()].map(provider=>provider.getSearchableTypes()))).flat();if(!this.serverTypes){this.serverTypes=await fetchServerSearchableTypes(this.http)}return Object(external_kbnSharedDeps_Lodash_["uniq"])([...providerTypes,...this.serverTypes])}performFind(params,options){var _options$preference;const licenseState=this.licenseChecker.getState();if(!licenseState.valid){return Object(external_kbnSharedDeps_Rxjs_["throwError"])(GlobalSearchFindError.invalidLicense(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.globalSearch.find.invalidLicenseError",{defaultMessage:`GlobalSearch API is disabled because of invalid license state: {errorMessage}`,values:{errorMessage:licenseState.message}})))}const timeout=Object(external_kbnSharedDeps_Moment_["duration"])(this.config.search_timeout).asMilliseconds();const timeout$=Object(external_kbnSharedDeps_Rxjs_["timer"])(timeout).pipe(Object(external_kbnSharedDeps_RxjsOperators_["map"])(mapToUndefined));const aborted$=options.aborted$?Object(external_kbnSharedDeps_Rxjs_["merge"])(options.aborted$,timeout$):timeout$;const preference=(_options$preference=options.preference)!==null&&_options$preference!==void 0?_options$preference:getDefaultPreference();const providerOptions={...options,preference:preference,maxResults:this.maxProviderResults,aborted$:aborted$};const processResult=result=>processProviderResult(result,this.http.basePath);const serverResults$=fetchServerResults(this.http,params,{preference:preference,aborted$:aborted$});const providersResults$=[...this.providers.values()].map(provider=>provider.find(params,providerOptions).pipe(takeInArray(this.maxProviderResults),Object(external_kbnSharedDeps_RxjsOperators_["takeUntil"])(aborted$),Object(external_kbnSharedDeps_RxjsOperators_["map"])(results=>results.map(r=>processResult(r)))));return Object(external_kbnSharedDeps_Rxjs_["merge"])(...providersResults$,serverResults$).pipe(Object(external_kbnSharedDeps_RxjsOperators_["map"])(results=>({results:results})))}}var types=__webpack_require__(3);function plugin_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class plugin_GlobalSearchPlugin{constructor(context){plugin_defineProperty(this,"config",void 0);plugin_defineProperty(this,"licenseChecker",void 0);plugin_defineProperty(this,"searchService",new search_service_SearchService);this.config=context.config.get()}setup(core){const{registerResultProvider:registerResultProvider}=this.searchService.setup({config:this.config});return{registerResultProvider:registerResultProvider}}start({http:http},{licensing:licensing}){this.licenseChecker=new LicenseChecker(licensing.license$);const{find:find,getSearchableTypes:getSearchableTypes}=this.searchService.start({http:http,licenseChecker:this.licenseChecker});return{find:find,getSearchableTypes:getSearchableTypes}}stop(){if(this.licenseChecker){this.licenseChecker.clean()}}}var common_types=__webpack_require__(1);var public_types=__webpack_require__(4);const public_plugin=context=>new plugin_GlobalSearchPlugin(context)}]);