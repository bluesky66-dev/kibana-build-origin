/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=4)})([function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/embeddable/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,exports){module.exports=__kbnSharedDeps__.KbnI18n},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/uiActionsEnhanced/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,exports){},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _node_modules_val_loader_dist_cjs_js_key_embeddableEnhanced_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5);var _node_modules_val_loader_dist_cjs_js_key_embeddableEnhanced_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_val_loader_dist_cjs_js_key_embeddableEnhanced_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0__);__kbnBundles__.define("plugin/embeddableEnhanced/public",__webpack_require__,6)},function(module,exports,__webpack_require__){__webpack_require__.p=window.__kbnPublicPath__["embeddableEnhanced"]},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"EmbeddableEnhancedSetupContract",(function(){return undefined}));__webpack_require__.d(__webpack_exports__,"EmbeddableEnhancedSetupDependencies",(function(){return undefined}));__webpack_require__.d(__webpack_exports__,"EmbeddableEnhancedStartContract",(function(){return undefined}));__webpack_require__.d(__webpack_exports__,"EmbeddableEnhancedStartDependencies",(function(){return undefined}));__webpack_require__.d(__webpack_exports__,"plugin",(function(){return public_plugin}));__webpack_require__.d(__webpack_exports__,"EnhancedEmbeddable",(function(){return types["EnhancedEmbeddable"]}));__webpack_require__.d(__webpack_exports__,"EnhancedEmbeddableContext",(function(){return types["EnhancedEmbeddableContext"]}));__webpack_require__.d(__webpack_exports__,"isEnhancedEmbeddable",(function(){return isEnhancedEmbeddable}));__webpack_require__.d(__webpack_exports__,"embeddableEnhancedDrilldownGrouping",(function(){return drilldownGrouping}));var public_=__webpack_require__(0);var uiActionsEnhanced_public_=__webpack_require__(2);class embeddable_action_storage_EmbeddableActionStorage extends uiActionsEnhanced_public_["UiActionsEnhancedAbstractActionStorage"]{constructor(embbeddable){super();this.embbeddable=embbeddable}put(input,events){var _input$enhancements;this.embbeddable.updateInput({enhancements:{...input.enhancements||{},dynamicActions:{...((_input$enhancements=input.enhancements)===null||_input$enhancements===void 0?void 0:_input$enhancements.dynamicActions)||{},events:events}}})}async create(event){const input=this.embbeddable.getInput();const events=this.getEventsFromEmbeddable();const exists=!!events.find(({eventId:eventId})=>eventId===event.eventId);if(exists){throw new Error(`[EEXIST]: Event with [eventId = ${event.eventId}] already exists on `+`[embeddable.id = ${input.id}, embeddable.title = ${input.title}].`)}this.put(input,[...events,event])}async update(event){const input=this.embbeddable.getInput();const events=this.getEventsFromEmbeddable();const index=events.findIndex(({eventId:eventId})=>eventId===event.eventId);if(index===-1){throw new Error(`[ENOENT]: Event with [eventId = ${event.eventId}] could not be `+`updated as it does not exist in `+`[embeddable.id = ${input.id}, embeddable.title = ${input.title}].`)}this.put(input,[...events.slice(0,index),event,...events.slice(index+1)])}async remove(eventId){const input=this.embbeddable.getInput();const events=this.getEventsFromEmbeddable();const index=events.findIndex(event=>eventId===event.eventId);if(index===-1){throw new Error(`[ENOENT]: Event with [eventId = ${eventId}] could not be `+`removed as it does not exist in `+`[embeddable.id = ${input.id}, embeddable.title = ${input.title}].`)}this.put(input,[...events.slice(0,index),...events.slice(index+1)])}async read(eventId){const input=this.embbeddable.getInput();const events=this.getEventsFromEmbeddable();const event=events.find(ev=>eventId===ev.eventId);if(!event){throw new Error(`[ENOENT]: Event with [eventId = ${eventId}] could not be found in `+`[embeddable.id = ${input.id}, embeddable.title = ${input.title}].`)}return event}async list(){return this.getEventsFromEmbeddable()}getEventsFromEmbeddable(){var _input$enhancements2,_input$enhancements2$;const input=this.embbeddable.getInput();const events=((_input$enhancements2=input.enhancements)===null||_input$enhancements2===void 0?void 0:(_input$enhancements2$=_input$enhancements2.dynamicActions)===null||_input$enhancements2$===void 0?void 0:_input$enhancements2$.events)||[];return this.migrate(events)}migrate(events){return events.map(event=>{if(event.action.factoryId==="DASHBOARD_TO_DASHBOARD_DRILLDOWN"){return{...event,triggers:["FILTER_TRIGGER"]}}return event})}}var external_kbnSharedDeps_KbnI18n_=__webpack_require__(1);function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const txtOneDrilldown=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.embeddableEnhanced.actions.panelNotifications.oneDrilldown",{defaultMessage:"Panel has 1 drilldown"});const txtManyDrilldowns=count=>external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.embeddableEnhanced.actions.panelNotifications.manyDrilldowns",{defaultMessage:"Panel has {count} drilldowns",values:{count:String(count)}});const ACTION_PANEL_NOTIFICATIONS="ACTION_PANEL_NOTIFICATIONS";class panel_notifications_action_PanelNotificationsAction{constructor(){_defineProperty(this,"id",ACTION_PANEL_NOTIFICATIONS);_defineProperty(this,"getDisplayName",({embeddable:embeddable})=>String(this.getEventCount(embeddable)));_defineProperty(this,"getDisplayNameTooltip",({embeddable:embeddable})=>{const count=this.getEventCount(embeddable);return!count?"":count===1?txtOneDrilldown:txtManyDrilldowns(count)});_defineProperty(this,"isCompatible",async({embeddable:embeddable})=>{if(embeddable.getInput().viewMode!==public_["ViewMode"].EDIT)return false;return this.getEventCount(embeddable)>0});_defineProperty(this,"execute",async()=>{})}getEventCount(embeddable){return embeddable.enhancements.dynamicActions.state.get().events.length}}const drilldownGrouping=[{id:"drilldowns",getDisplayName:()=>external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.embeddableEnhanced.Drilldowns",{defaultMessage:"Drilldowns"}),getIconType:()=>"symlink",order:25}];function plugin_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class plugin_EmbeddableEnhancedPlugin{constructor(context){this.context=context;plugin_defineProperty(this,"uiActions",void 0);plugin_defineProperty(this,"isEmbeddableContext",context=>{if(!(context!==null&&context!==void 0&&context.embeddable)){console.warn("For drilldowns to work action context should contain .embeddable field.");return false}return true})}setup(core,plugins){this.setCustomEmbeddableFactoryProvider(plugins);const panelNotificationAction=new panel_notifications_action_PanelNotificationsAction;plugins.uiActionsEnhanced.registerAction(panelNotificationAction);plugins.uiActionsEnhanced.attachAction(public_["PANEL_NOTIFICATION_TRIGGER"],panelNotificationAction.id);return{}}start(core,plugins){this.uiActions=plugins.uiActionsEnhanced;return{}}stop(){}setCustomEmbeddableFactoryProvider(plugins){plugins.embeddable.setCustomEmbeddableFactoryProvider(def=>{const factory=Object(public_["defaultEmbeddableFactoryProvider"])(def);return{...factory,create:async(...args)=>{const embeddable=await factory.create(...args);if(!embeddable)return embeddable;return this.enhanceEmbeddableWithDynamicActions(embeddable)},createFromSavedObject:async(...args)=>{const embeddable=await factory.createFromSavedObject(...args);if(!embeddable)return embeddable;return this.enhanceEmbeddableWithDynamicActions(embeddable)}}})}enhanceEmbeddableWithDynamicActions(embeddable){const enhancedEmbeddable=embeddable;const storage=new embeddable_action_storage_EmbeddableActionStorage(embeddable);const dynamicActions=new uiActionsEnhanced_public_["UiActionsEnhancedDynamicActionManager"]({isCompatible:async context=>{if(!this.isEmbeddableContext(context))return false;if(context.embeddable.getInput().viewMode!==public_["ViewMode"].VIEW)return false;return context.embeddable.runtimeId===embeddable.runtimeId},storage:storage,uiActions:this.uiActions});dynamicActions.start().catch(error=>{console.log("Failed to start embeddable dynamic actions",embeddable);console.error(error)});const stop=()=>{dynamicActions.stop().catch(error=>{console.log("Failed to stop embeddable dynamic actions",embeddable);console.error(error)})};embeddable.getInput$().subscribe({next:()=>{storage.reload$.next()},error:stop,complete:stop});enhancedEmbeddable.enhancements={...enhancedEmbeddable.enhancements,dynamicActions:dynamicActions};return enhancedEmbeddable}}var types=__webpack_require__(3);const isEnhancedEmbeddable=maybeEnhancedEmbeddable=>{var _enhancements;return typeof(maybeEnhancedEmbeddable===null||maybeEnhancedEmbeddable===void 0?void 0:(_enhancements=maybeEnhancedEmbeddable.enhancements)===null||_enhancements===void 0?void 0:_enhancements.dynamicActions)==="object"};function public_plugin(context){return new plugin_EmbeddableEnhancedPlugin(context)}}]);