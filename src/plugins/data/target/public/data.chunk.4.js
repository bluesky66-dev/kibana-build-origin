(window["data_bundle_jsonpfunction"]=window["data_bundle_jsonpfunction"]||[]).push([[4,9],{213:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var external_kbnSharedDeps_Lodash_=__webpack_require__(2);var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(44);var classnames=__webpack_require__(214);var classnames_default=__webpack_require__.n(classnames);var external_kbnSharedDeps_React_=__webpack_require__(3);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var ResizeObserver=__webpack_require__(220);var ResizeObserver_default=__webpack_require__.n(ResizeObserver);var web=__webpack_require__(216);var public_=__webpack_require__(23);var query_bar_top_row=__webpack_require__(219);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(13);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(0);function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}function GenericComboBox(props){const{options:options,selectedOptions:selectedOptions,getLabel:getLabel,onChange:onChange,...otherProps}=props;const labels=options.map(getLabel);const euiOptions=labels.map(label=>({label:label}));const selectedEuiOptions=selectedOptions.filter(option=>options.indexOf(option)!==-1).map(option=>euiOptions[options.indexOf(option)]);const onComboBoxChange=newOptions=>{const newValues=newOptions.map(({label:label})=>options[labels.indexOf(label)]);onChange(newValues)};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],_extends({options:euiOptions,selectedOptions:selectedEuiOptions,onChange:onComboBoxChange,sortMatchesBy:"startsWith"},otherProps))}var elastic_datemath=__webpack_require__(18);var elastic_datemath_default=__webpack_require__.n(elastic_datemath);var filter_operators=__webpack_require__(215);var common=__webpack_require__(1);function getFieldFromFilter(filter,indexPattern){return indexPattern.fields.find(field=>field.name===filter.meta.key)}function getOperatorFromFilter(filter){return filter_operators["a"].find(operator=>filter.meta.type===operator.type&&filter.meta.negate===operator.negate)}function getFilterableFields(indexPattern){return indexPattern.fields.filter(common["isFilterable"])}function getOperatorOptions(field){return filter_operators["a"].filter(operator=>!operator.fieldTypes||operator.fieldTypes.includes(field.type))}function validateParams(params,type){switch(type){case"date":const moment=typeof params==="string"?elastic_datemath_default.a.parse(params):null;return Boolean(typeof params==="string"&&moment&&moment.isValid());case"ip":try{return Boolean(new common["Ipv4Address"](params))}catch(e){return false}default:return true}}function isFilterValid(indexPattern,field,operator,params){if(!indexPattern||!field||!operator){return false}switch(operator.type){case"phrase":return validateParams(params,field.type);case"phrases":if(!Array.isArray(params)||!params.length){return false}return params.every(phrase=>validateParams(phrase,field.type));case"range":if(typeof params!=="object"){return false}return(!params.from||validateParams(params.from,field.type))&&(!params.to||validateParams(params.to,field.type));case"exists":return true;default:throw new Error(`Unknown operator type: ${operator.type}`)}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class phrase_suggestor_PhraseSuggestorUI extends external_kbnSharedDeps_React_default.a.Component{constructor(...args){super(...args);_defineProperty(this,"services",this.props.kibana.services);_defineProperty(this,"abortController",void 0);_defineProperty(this,"state",{suggestions:[],isLoading:false});_defineProperty(this,"onSearchChange",value=>{this.updateSuggestions(`${value}`)});_defineProperty(this,"updateSuggestions",Object(external_kbnSharedDeps_Lodash_["debounce"])(async(query="")=>{if(this.abortController)this.abortController.abort();this.abortController=new AbortController;const{indexPattern:indexPattern,field:field}=this.props;if(!field||!this.isSuggestingValues()){return}this.setState({isLoading:true});const suggestions=await this.services.data.autocomplete.getValueSuggestions({indexPattern:indexPattern,field:field,query:query,signal:this.abortController.signal,useTimeRange:false});this.setState({suggestions:suggestions,isLoading:false})},500))}componentDidMount(){this.updateSuggestions()}componentWillUnmount(){if(this.abortController)this.abortController.abort()}isSuggestingValues(){const shouldSuggestValues=this.services.uiSettings.get(common["UI_SETTINGS"].FILTERS_EDITOR_SUGGEST_VALUES);const{field:field}=this.props;return shouldSuggestValues&&field&&field.aggregatable&&field.type==="string"}}const PhraseSuggestor=Object(public_["withKibana"])(phrase_suggestor_PhraseSuggestorUI);function value_input_type_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class value_input_type_ValueInputTypeUI extends external_kbnSharedDeps_React_["Component"]{constructor(...args){super(...args);value_input_type_defineProperty(this,"onBoolChange",event=>{const boolValue=event.target.value==="true";this.props.onChange(boolValue)});value_input_type_defineProperty(this,"onChange",event=>{const params=event.target.value;this.props.onChange(params)});value_input_type_defineProperty(this,"onBlur",event=>{if(this.props.onBlur){const params=event.target.value;this.props.onBlur(params)}})}render(){const value=this.props.value;let inputElement;switch(this.props.type){case"string":inputElement=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{fullWidth:this.props.fullWidth,placeholder:this.props.placeholder,value:value,onChange:this.onChange,controlOnly:this.props.controlOnly,className:this.props.className});break;case"number":inputElement=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{fullWidth:this.props.fullWidth,placeholder:this.props.placeholder,value:typeof value==="string"?parseFloat(value):value,onChange:this.onChange,controlOnly:this.props.controlOnly,className:this.props.className});break;case"date":inputElement=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{fullWidth:this.props.fullWidth,placeholder:this.props.placeholder,value:value,onChange:this.onChange,onBlur:this.onBlur,isInvalid:!Object(external_kbnSharedDeps_Lodash_["isEmpty"])(value)&&!validateParams(value,this.props.type),controlOnly:this.props.controlOnly,className:this.props.className});break;case"ip":inputElement=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{fullWidth:this.props.fullWidth,placeholder:this.props.placeholder,value:value,onChange:this.onChange,isInvalid:!Object(external_kbnSharedDeps_Lodash_["isEmpty"])(value)&&!validateParams(value,this.props.type),controlOnly:this.props.controlOnly,className:this.props.className});break;case"boolean":inputElement=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{options:[{value:undefined,text:this.props.placeholder},{value:"true",text:this.props.intl.formatMessage({id:"data.filter.filterEditor.trueOptionLabel",defaultMessage:"true"})},{value:"false",text:this.props.intl.formatMessage({id:"data.filter.filterEditor.falseOptionLabel",defaultMessage:"false"})}],value:value,onChange:this.onBoolChange,className:this.props.className,fullWidth:this.props.fullWidth});break;default:break}return inputElement}}const ValueInputType=Object(external_kbnSharedDeps_KbnI18nReact_["injectI18n"])(value_input_type_ValueInputTypeUI);class phrase_value_input_PhraseValueInputUI extends phrase_suggestor_PhraseSuggestorUI{render(){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:this.props.fullWidth,label:this.props.intl.formatMessage({id:"data.filter.filterEditor.valueInputLabel",defaultMessage:"Value"})},this.isSuggestingValues()?this.renderWithSuggestions():external_kbnSharedDeps_React_default.a.createElement(ValueInputType,{fullWidth:this.props.fullWidth,placeholder:this.props.intl.formatMessage({id:"data.filter.filterEditor.valueInputPlaceholder",defaultMessage:"Enter a value"}),value:this.props.value,onChange:this.props.onChange,type:this.props.field?this.props.field.type:"string"}))}renderWithSuggestions(){const{suggestions:suggestions}=this.state;const{value:value,intl:intl,onChange:onChange,fullWidth:fullWidth}=this.props;const valueAsStr=String(value);const options=value?Object(external_kbnSharedDeps_Lodash_["uniq"])([valueAsStr,...suggestions]):suggestions;return external_kbnSharedDeps_React_default.a.createElement(StringComboBox,{fullWidth:fullWidth,placeholder:intl.formatMessage({id:"data.filter.filterEditor.valueSelectPlaceholder",defaultMessage:"Select a value"}),options:options,getLabel:option=>option,selectedOptions:value?[valueAsStr]:[],onChange:([newValue=""])=>onChange(newValue),onSearchChange:this.onSearchChange,singleSelection:{asPlainText:true},onCreateOption:onChange,isClearable:false,"data-test-subj":"filterParamsComboBox phraseParamsComboxBox"})}}function StringComboBox(props){return GenericComboBox(props)}const PhraseValueInput=Object(external_kbnSharedDeps_KbnI18nReact_["injectI18n"])(Object(public_["withKibana"])(phrase_value_input_PhraseValueInputUI));class phrases_values_input_PhrasesValuesInputUI extends phrase_suggestor_PhraseSuggestorUI{render(){const{suggestions:suggestions}=this.state;const{values:values,intl:intl,onChange:onChange,fullWidth:fullWidth}=this.props;const options=values?Object(external_kbnSharedDeps_Lodash_["uniq"])([...values,...suggestions]):suggestions;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:fullWidth,label:intl.formatMessage({id:"data.filter.filterEditor.valuesSelectLabel",defaultMessage:"Values"})},external_kbnSharedDeps_React_default.a.createElement(phrases_values_input_StringComboBox,{fullWidth:fullWidth,placeholder:intl.formatMessage({id:"data.filter.filterEditor.valuesSelectPlaceholder",defaultMessage:"Select values"}),options:options,getLabel:option=>option,selectedOptions:values||[],onSearchChange:this.onSearchChange,onCreateOption:option=>onChange([...values||[],option]),onChange:onChange,isClearable:false,"data-test-subj":"filterParamsComboBox phrasesParamsComboxBox"}))}}function phrases_values_input_StringComboBox(props){return GenericComboBox(props)}const PhrasesValuesInput=Object(external_kbnSharedDeps_KbnI18nReact_["injectI18n"])(Object(public_["withKibana"])(phrases_values_input_PhrasesValuesInputUI));var external_kbnSharedDeps_Moment_=__webpack_require__(5);var external_kbnSharedDeps_Moment_default=__webpack_require__.n(external_kbnSharedDeps_Moment_);function RangeValueInputUI(props){const kibana=Object(public_["useKibana"])();const type=props.field?props.field.type:"string";const tzConfig=kibana.services.uiSettings.get("dateFormat:tz");const formatDateChange=value=>{if(typeof value!=="string"&&typeof value!=="number")return value;const momentParsedValue=external_kbnSharedDeps_Moment_default()(value).tz(tzConfig);if(momentParsedValue.isValid())return momentParsedValue===null||momentParsedValue===void 0?void 0:momentParsedValue.format("YYYY-MM-DDTHH:mm:ss.SSSZ");return value};const onFromChange=value=>{if(typeof value!=="string"&&typeof value!=="number"){throw new Error("Range params must be a string or number")}props.onChange({from:value,to:Object(external_kbnSharedDeps_Lodash_["get"])(props,"value.to")})};const onToChange=value=>{if(typeof value!=="string"&&typeof value!=="number"){throw new Error("Range params must be a string or number")}props.onChange({from:Object(external_kbnSharedDeps_Lodash_["get"])(props,"value.from"),to:value})};return external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormControlLayoutDelimited"],{fullWidth:props.fullWidth,"aria-label":props.intl.formatMessage({id:"data.filter.filterEditor.rangeInputLabel",defaultMessage:"Range"}),startControl:external_kbnSharedDeps_React_default.a.createElement(ValueInputType,{controlOnly:true,type:type,value:props.value?props.value.from:undefined,onChange:onFromChange,onBlur:value=>{onFromChange(formatDateChange(value))},placeholder:props.intl.formatMessage({id:"data.filter.filterEditor.rangeStartInputPlaceholder",defaultMessage:"Start of the range"})}),endControl:external_kbnSharedDeps_React_default.a.createElement(ValueInputType,{controlOnly:true,type:type,value:props.value?props.value.to:undefined,onChange:onToChange,onBlur:value=>{onToChange(formatDateChange(value))},placeholder:props.intl.formatMessage({id:"data.filter.filterEditor.rangeEndInputPlaceholder",defaultMessage:"End of the range"})})}))}const RangeValueInput=Object(external_kbnSharedDeps_KbnI18nReact_["injectI18n"])(RangeValueInputUI);function filter_editor_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class filter_editor_FilterEditorUI extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);filter_editor_defineProperty(this,"toggleCustomEditor",()=>{const isCustomEditorOpen=!this.state.isCustomEditorOpen;this.setState({isCustomEditorOpen:isCustomEditorOpen})});filter_editor_defineProperty(this,"onIndexPatternChange",([selectedIndexPattern])=>{const selectedField=undefined;const selectedOperator=undefined;const params=undefined;this.setState({selectedIndexPattern:selectedIndexPattern,selectedField:selectedField,selectedOperator:selectedOperator,params:params})});filter_editor_defineProperty(this,"onFieldChange",([selectedField])=>{const selectedOperator=undefined;const params=undefined;this.setState({selectedField:selectedField,selectedOperator:selectedOperator,params:params})});filter_editor_defineProperty(this,"onOperatorChange",([selectedOperator])=>{const params=Object(external_kbnSharedDeps_Lodash_["get"])(this.state.selectedOperator,"type")===Object(external_kbnSharedDeps_Lodash_["get"])(selectedOperator,"type")?this.state.params:undefined;this.setState({selectedOperator:selectedOperator,params:params})});filter_editor_defineProperty(this,"onCustomLabelSwitchChange",event=>{const useCustomLabel=event.target.checked;const customLabel=event.target.checked?"":null;this.setState({useCustomLabel:useCustomLabel,customLabel:customLabel})});filter_editor_defineProperty(this,"onCustomLabelChange",event=>{const customLabel=event.target.value;this.setState({customLabel:customLabel})});filter_editor_defineProperty(this,"onParamsChange",params=>{this.setState({params:params})});filter_editor_defineProperty(this,"onQueryDslChange",queryDsl=>{this.setState({queryDsl:queryDsl})});filter_editor_defineProperty(this,"onSubmit",()=>{const{selectedIndexPattern:indexPattern,selectedField:field,selectedOperator:operator,params:params,useCustomLabel:useCustomLabel,customLabel:customLabel,isCustomEditorOpen:isCustomEditorOpen,queryDsl:queryDsl}=this.state;const{$state:$state}=this.props.filter;if(!$state||!$state.store){return}const alias=useCustomLabel?customLabel:null;if(isCustomEditorOpen){const{index:index,disabled:disabled,negate:negate}=this.props.filter.meta;const newIndex=index||this.props.indexPatterns[0].id;const body=JSON.parse(queryDsl);const filter=Object(common["buildCustomFilter"])(newIndex,body,disabled,negate,alias,$state.store);this.props.onSubmit(filter)}else if(indexPattern&&field&&operator){const filter=Object(common["buildFilter"])(indexPattern,field,operator.type,operator.negate,this.props.filter.meta.disabled,params!==null&&params!==void 0?params:"",alias,$state.store);this.props.onSubmit(filter)}});this.state={selectedIndexPattern:this.getIndexPatternFromFilter(),selectedField:this.getFieldFromFilter(),selectedOperator:this.getSelectedOperator(),params:Object(common["getFilterParams"])(props.filter),useCustomLabel:props.filter.meta.alias!==null,customLabel:props.filter.meta.alias,queryDsl:JSON.stringify(Object(common["cleanFilter"])(props.filter),null,2),isCustomEditorOpen:this.isUnknownFilterType()}}render(){return external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopoverTitle"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"baseline",responsive:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"data.filter.filterEditor.editFilterPopupTitle",defaultMessage:"Edit filter"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,className:"filterEditor__hiddenItem"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{size:"xs","data-test-subj":"editQueryDSL",onClick:this.toggleCustomEditor},this.state.isCustomEditorOpen?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"data.filter.filterEditor.editFilterValuesButtonLabel",defaultMessage:"Edit filter values"}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"data.filter.filterEditor.editQueryDslButtonLabel",defaultMessage:"Edit as Query DSL"}))))),external_kbnSharedDeps_React_default.a.createElement("div",{className:"globalFilterItem__editorForm"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiForm"],null,this.renderIndexPatternInput(),this.state.isCustomEditorOpen?this.renderCustomEditor():this.renderRegularEditor(),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{id:"filterEditorCustomLabelSwitch","data-test-subj":"createCustomLabel",label:this.props.intl.formatMessage({id:"data.filter.filterEditor.createCustomLabelSwitchLabel",defaultMessage:"Create custom label?"}),checked:this.state.useCustomLabel,onChange:this.onCustomLabelSwitchChange}),this.state.useCustomLabel&&external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:this.props.intl.formatMessage({id:"data.filter.filterEditor.createCustomLabelInputLabel",defaultMessage:"Custom label"}),fullWidth:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{value:`${this.state.customLabel}`,onChange:this.onCustomLabelChange,fullWidth:true}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"rowReverse",alignItems:"center",responsive:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{fill:true,onClick:this.onSubmit,isDisabled:!this.isFilterValid(),"data-test-subj":"saveFilter"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"data.filter.filterEditor.saveButtonLabel",defaultMessage:"Save"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{flush:"right",onClick:this.props.onCancel,"data-test-subj":"cancelSaveFilter"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"data.filter.filterEditor.cancelButtonLabel",defaultMessage:"Cancel"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null)))))}renderIndexPatternInput(){if(this.props.indexPatterns.length<=1&&this.props.indexPatterns.find(indexPattern=>indexPattern===this.getIndexPatternFromFilter())){return""}const{selectedIndexPattern:selectedIndexPattern}=this.state;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true,label:this.props.intl.formatMessage({id:"data.filter.filterEditor.indexPatternSelectLabel",defaultMessage:"Index Pattern"})},external_kbnSharedDeps_React_default.a.createElement(IndexPatternComboBox,{fullWidth:true,placeholder:this.props.intl.formatMessage({id:"data.filter.filterBar.indexPatternSelectPlaceholder",defaultMessage:"Select an index pattern"}),options:this.props.indexPatterns,selectedOptions:selectedIndexPattern?[selectedIndexPattern]:[],getLabel:indexPattern=>indexPattern.title,onChange:this.onIndexPatternChange,singleSelection:{asPlainText:true},isClearable:false,"data-test-subj":"filterIndexPatternsSelect"}))))}renderRegularEditor(){return external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{responsive:true,gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:2},this.renderFieldInput()),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:{flexBasis:160}},this.renderOperatorInput())),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement("div",{"data-test-subj":"filterParams"},this.renderParamsEditor()))}renderFieldInput(){const{selectedIndexPattern:selectedIndexPattern,selectedField:selectedField}=this.state;const fields=selectedIndexPattern?getFilterableFields(selectedIndexPattern):[];return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true,label:this.props.intl.formatMessage({id:"data.filter.filterEditor.fieldSelectLabel",defaultMessage:"Field"})},external_kbnSharedDeps_React_default.a.createElement(FieldComboBox,{fullWidth:true,id:"fieldInput",isDisabled:!selectedIndexPattern,placeholder:this.props.intl.formatMessage({id:"data.filter.filterEditor.fieldSelectPlaceholder",defaultMessage:"Select a field first"}),options:fields,selectedOptions:selectedField?[selectedField]:[],getLabel:field=>field.name,onChange:this.onFieldChange,singleSelection:{asPlainText:true},isClearable:false,"data-test-subj":"filterFieldSuggestionList"}))}renderOperatorInput(){const{selectedField:selectedField,selectedOperator:selectedOperator}=this.state;const operators=selectedField?getOperatorOptions(selectedField):[];return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true,label:this.props.intl.formatMessage({id:"data.filter.filterEditor.operatorSelectLabel",defaultMessage:"Operator"})},external_kbnSharedDeps_React_default.a.createElement(OperatorComboBox,{fullWidth:true,isDisabled:!selectedField,placeholder:selectedField?this.props.intl.formatMessage({id:"data.filter.filterEditor.operatorSelectPlaceholderSelect",defaultMessage:"Select"}):this.props.intl.formatMessage({id:"data.filter.filterEditor.operatorSelectPlaceholderWaiting",defaultMessage:"Waiting"}),options:operators,selectedOptions:selectedOperator?[selectedOperator]:[],getLabel:({message:message})=>message,onChange:this.onOperatorChange,singleSelection:{asPlainText:true},isClearable:false,"data-test-subj":"filterOperatorList"}))}renderCustomEditor(){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true,label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.filter.filterEditor.queryDslLabel",{defaultMessage:"Elasticsearch Query DSL"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCodeEditor"],{value:this.state.queryDsl,onChange:this.onQueryDslChange,mode:"json",width:"100%",height:"250px"}))}renderParamsEditor(){const indexPattern=this.state.selectedIndexPattern;if(!indexPattern||!this.state.selectedOperator){return""}switch(this.state.selectedOperator.type){case"exists":return"";case"phrase":return external_kbnSharedDeps_React_default.a.createElement(PhraseValueInput,{indexPattern:indexPattern,field:this.state.selectedField,value:this.state.params,onChange:this.onParamsChange,"data-test-subj":"phraseValueInput",fullWidth:true});case"phrases":return external_kbnSharedDeps_React_default.a.createElement(PhrasesValuesInput,{indexPattern:indexPattern,field:this.state.selectedField,values:this.state.params,onChange:this.onParamsChange,fullWidth:true});case"range":return external_kbnSharedDeps_React_default.a.createElement(RangeValueInput,{field:this.state.selectedField,value:this.state.params,onChange:this.onParamsChange,fullWidth:true})}}isUnknownFilterType(){const{type:type}=this.props.filter.meta;return!!type&&!["phrase","phrases","range","exists"].includes(type)}getIndexPatternFromFilter(){return Object(common["getIndexPatternFromFilter"])(this.props.filter,this.props.indexPatterns)}getFieldFromFilter(){const indexPattern=this.getIndexPatternFromFilter();return indexPattern&&getFieldFromFilter(this.props.filter,indexPattern)}getSelectedOperator(){return getOperatorFromFilter(this.props.filter)}isFilterValid(){const{isCustomEditorOpen:isCustomEditorOpen,queryDsl:queryDsl,selectedIndexPattern:indexPattern,selectedField:field,selectedOperator:operator,params:params}=this.state;if(isCustomEditorOpen){try{return Boolean(JSON.parse(queryDsl))}catch(e){return false}}return isFilterValid(indexPattern,field,operator,params)}}function IndexPatternComboBox(props){return GenericComboBox(props)}function FieldComboBox(props){return GenericComboBox(props)}function OperatorComboBox(props){return GenericComboBox(props)}const FilterEditor=Object(external_kbnSharedDeps_KbnI18nReact_["injectI18n"])(filter_editor_FilterEditorUI);var filter_bar=__webpack_require__(101);function filter_view_extends(){filter_view_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return filter_view_extends.apply(this,arguments)}const FilterView=({filter:filter,iconOnClick:iconOnClick,onClick:onClick,valueLabel:valueLabel,errorMessage:errorMessage,filterLabelStatus:filterLabelStatus,...rest})=>{const[ref,innerText]=Object(external_kbnSharedDeps_ElasticEui_["useInnerText"])();let title=errorMessage||external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.filter.filterBar.moreFilterActionsMessage",{defaultMessage:"Filter: {innerText}. Select for more filter actions.",values:{innerText:innerText}});if(Object(common["isFilterPinned"])(filter)){title=`${external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.filter.filterBar.pinnedFilterPrefix",{defaultMessage:"Pinned"})} ${title}`}if(filter.meta.disabled){title=`${external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.filter.filterBar.disabledFilterPrefix",{defaultMessage:"Disabled"})} ${title}`}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBadge"],filter_view_extends({title:title,color:"hollow",iconType:"cross",iconSide:"right",closeButtonProps:{tabIndex:-1},iconOnClick:iconOnClick,iconOnClickAriaLabel:external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.filter.filterBar.filterItemBadgeIconAriaLabel",{defaultMessage:"Delete"}),onClick:onClick,onClickAriaLabel:external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.filter.filterBar.filterItemBadgeAriaLabel",{defaultMessage:"Filter actions"})},rest),external_kbnSharedDeps_React_default.a.createElement("span",{ref:ref},external_kbnSharedDeps_React_default.a.createElement(filter_bar["a"],{filter:filter,valueLabel:valueLabel,filterLabelStatus:filterLabelStatus})))};var services=__webpack_require__(17);const FILTER_ITEM_OK="";const FILTER_ITEM_WARNING="warn";const FILTER_ITEM_ERROR="error";const FILTER_EDITOR_WIDTH=800;function FilterItem(props){const[isPopoverOpen,setIsPopoverOpen]=Object(external_kbnSharedDeps_React_["useState"])(false);const[indexPatternExists,setIndexPatternExists]=Object(external_kbnSharedDeps_React_["useState"])(undefined);const{id:id,filter:filter,indexPatterns:indexPatterns}=props;Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const index=props.filter.meta.index;let isSubscribed=true;if(index){Object(services["a"])().get(index).then(indexPattern=>{if(isSubscribed){setIndexPatternExists(!!indexPattern)}}).catch(()=>{if(isSubscribed){setIndexPatternExists(false)}})}else if(isSubscribed){setIndexPatternExists(true)}return()=>{isSubscribed=false}},[props.filter.meta.index]);function handleBadgeClick(e){if(e.shiftKey){onToggleDisabled()}else{setIsPopoverOpen(!isPopoverOpen)}}function onSubmit(f){setIsPopoverOpen(false);props.onUpdate(f)}function onTogglePinned(){const f=Object(common["toggleFilterPinned"])(filter);props.onUpdate(f)}function onToggleNegated(){const f=Object(common["toggleFilterNegated"])(filter);props.onUpdate(f)}function onToggleDisabled(){const f=Object(common["toggleFilterDisabled"])(filter);props.onUpdate(f)}function isValidLabel(labelConfig){return labelConfig.status===FILTER_ITEM_OK}function isDisabled(labelConfig){const{disabled:disabled}=filter.meta;return disabled||labelConfig.status===FILTER_ITEM_ERROR}function getClasses(negate,labelConfig){return classnames_default()("globalFilterItem",{"globalFilterItem-isDisabled":isDisabled(labelConfig),"globalFilterItem-isError":labelConfig.status===FILTER_ITEM_ERROR,"globalFilterItem-isWarning":labelConfig.status===FILTER_ITEM_WARNING,"globalFilterItem-isPinned":Object(common["isFilterPinned"])(filter),"globalFilterItem-isExcluded":negate},props.className)}function getDataTestSubj(labelConfig){const dataTestSubjKey=filter.meta.key?`filter-key-${filter.meta.key}`:"";const dataTestSubjValue=filter.meta.value?`filter-value-${isValidLabel(labelConfig)?labelConfig.title:labelConfig.status}`:"";const dataTestSubjNegated=filter.meta.negate?"filter-negated":"";const dataTestSubjDisabled=`filter-${isDisabled(labelConfig)?"disabled":"enabled"}`;const dataTestSubjPinned=`filter-${Object(common["isFilterPinned"])(filter)?"pinned":"unpinned"}`;return classnames_default()("filter",dataTestSubjDisabled,dataTestSubjKey,dataTestSubjValue,dataTestSubjPinned,dataTestSubjNegated)}function getPanels(){const{negate:negate,disabled:disabled}=filter.meta;return[{id:0,items:[{name:Object(common["isFilterPinned"])(filter)?props.intl.formatMessage({id:"data.filter.filterBar.unpinFilterButtonLabel",defaultMessage:"Unpin"}):props.intl.formatMessage({id:"data.filter.filterBar.pinFilterButtonLabel",defaultMessage:"Pin across all apps"}),icon:"pin",onClick:()=>{setIsPopoverOpen(false);onTogglePinned()},"data-test-subj":"pinFilter"},{name:props.intl.formatMessage({id:"data.filter.filterBar.editFilterButtonLabel",defaultMessage:"Edit filter"}),icon:"pencil",panel:1,"data-test-subj":"editFilter"},{name:negate?props.intl.formatMessage({id:"data.filter.filterBar.includeFilterButtonLabel",defaultMessage:"Include results"}):props.intl.formatMessage({id:"data.filter.filterBar.excludeFilterButtonLabel",defaultMessage:"Exclude results"}),icon:negate?"plusInCircle":"minusInCircle",onClick:()=>{setIsPopoverOpen(false);onToggleNegated()},"data-test-subj":"negateFilter"},{name:disabled?props.intl.formatMessage({id:"data.filter.filterBar.enableFilterButtonLabel",defaultMessage:"Re-enable"}):props.intl.formatMessage({id:"data.filter.filterBar.disableFilterButtonLabel",defaultMessage:"Temporarily disable"}),icon:`${disabled?"eye":"eyeClosed"}`,onClick:()=>{setIsPopoverOpen(false);onToggleDisabled()},"data-test-subj":"disableFilter"},{name:props.intl.formatMessage({id:"data.filter.filterBar.deleteFilterButtonLabel",defaultMessage:"Delete"}),icon:"trash",onClick:()=>{setIsPopoverOpen(false);props.onRemove()},"data-test-subj":"deleteFilter"}]},{id:1,width:FILTER_EDITOR_WIDTH,content:external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(FilterEditor,{filter:filter,indexPatterns:indexPatterns,onSubmit:onSubmit,onCancel:()=>{setIsPopoverOpen(false)}}))}]}function isFilterApplicable(){var _filter$meta;if(!props.indexPatterns.length)return true;const ip=Object(common["getIndexPatternFromFilter"])(filter,indexPatterns);if(ip)return true;const allFields=indexPatterns.map(indexPattern=>indexPattern.fields.map(field=>field.name));const flatFields=allFields.reduce((acc,it)=>[...acc,...it],[]);return flatFields.includes(((_filter$meta=filter.meta)===null||_filter$meta===void 0?void 0:_filter$meta.key)||"")}function getValueLabel(){const label={title:"",message:"",status:FILTER_ITEM_OK};if(indexPatternExists===false){label.status=FILTER_ITEM_ERROR;label.title=props.intl.formatMessage({id:"data.filter.filterBar.labelErrorText",defaultMessage:`Error`});label.message=props.intl.formatMessage({id:"data.filter.filterBar.labelErrorInfo",defaultMessage:"Index pattern {indexPattern} not found"},{indexPattern:filter.meta.index})}else if(isFilterApplicable()){try{label.title=Object(common["getDisplayValueFromFilter"])(filter,indexPatterns)}catch(e){label.status=FILTER_ITEM_ERROR;label.title=props.intl.formatMessage({id:"data.filter.filterBar.labelErrorText",defaultMessage:`Error`});label.message=e.message}}else{label.status=FILTER_ITEM_WARNING;label.title=props.intl.formatMessage({id:"data.filter.filterBar.labelWarningText",defaultMessage:`Warning`});label.message=props.intl.formatMessage({id:"data.filter.filterBar.labelWarningInfo",defaultMessage:"Field {fieldName} does not exist in current view"},{fieldName:filter.meta.key})}return label}if(indexPatternExists===undefined)return null;const valueLabelConfig=getValueLabel();if(valueLabelConfig.status===FILTER_ITEM_ERROR&&!filter.meta.disabled){filter.meta.disabled=true;props.onUpdate(filter);return null}const badge=external_kbnSharedDeps_React_default.a.createElement(FilterView,{filter:filter,valueLabel:valueLabelConfig.title,filterLabelStatus:valueLabelConfig.status,errorMessage:valueLabelConfig.message,className:getClasses(filter.meta.negate,valueLabelConfig),iconOnClick:()=>props.onRemove(),onClick:handleBadgeClick,"data-test-subj":getDataTestSubj(valueLabelConfig)});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopover"],{id:`popoverFor_filter${id}`,className:`globalFilterItem__popover`,anchorClassName:`globalFilterItem__popoverAnchor`,isOpen:isPopoverOpen,closePopover:()=>{setIsPopoverOpen(false)},button:badge,anchorPosition:"downLeft",panelPaddingSize:"none"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiContextMenu"],{initialPanelId:0,panels:getPanels()}))}function filter_options_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class filter_options_FilterOptionsUI extends external_kbnSharedDeps_React_["Component"]{constructor(...args){super(...args);filter_options_defineProperty(this,"state",{isPopoverOpen:false});filter_options_defineProperty(this,"togglePopover",()=>{this.setState(prevState=>({isPopoverOpen:!prevState.isPopoverOpen}))});filter_options_defineProperty(this,"closePopover",()=>{this.setState({isPopoverOpen:false})})}render(){const panelTree={id:0,items:[{name:this.props.intl.formatMessage({id:"data.filter.options.enableAllFiltersButtonLabel",defaultMessage:"Enable all"}),icon:"eye",onClick:()=>{this.closePopover();this.props.onEnableAll()},"data-test-subj":"enableAllFilters"},{name:this.props.intl.formatMessage({id:"data.filter.options.disableAllFiltersButtonLabel",defaultMessage:"Disable all"}),icon:"eyeClosed",onClick:()=>{this.closePopover();this.props.onDisableAll()},"data-test-subj":"disableAllFilters"},{name:this.props.intl.formatMessage({id:"data.filter.options.pinAllFiltersButtonLabel",defaultMessage:"Pin all"}),icon:"pin",onClick:()=>{this.closePopover();this.props.onPinAll()},"data-test-subj":"pinAllFilters"},{name:this.props.intl.formatMessage({id:"data.filter.options.unpinAllFiltersButtonLabel",defaultMessage:"Unpin all"}),icon:"pin",onClick:()=>{this.closePopover();this.props.onUnpinAll()},"data-test-subj":"unpinAllFilters"},{name:this.props.intl.formatMessage({id:"data.filter.options.invertNegatedFiltersButtonLabel",defaultMessage:"Invert inclusion"}),icon:"invert",onClick:()=>{this.closePopover();this.props.onToggleAllNegated()},"data-test-subj":"invertInclusionAllFilters"},{name:this.props.intl.formatMessage({id:"data.filter.options.invertDisabledFiltersButtonLabel",defaultMessage:"Invert enabled/disabled"}),icon:"eye",onClick:()=>{this.closePopover();this.props.onToggleAllDisabled()},"data-test-subj":"invertEnableDisableAllFilters"},{name:this.props.intl.formatMessage({id:"data.filter.options.deleteAllFiltersButtonLabel",defaultMessage:"Remove all"}),icon:"trash",onClick:()=>{this.closePopover();this.props.onRemoveAll()},"data-test-subj":"removeAllFilters"}]};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopover"],{id:"popoverForAllFilters",className:"globalFilterGroup__allFiltersPopover",isOpen:this.state.isPopoverOpen,closePopover:this.closePopover,button:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{onClick:this.togglePopover,iconType:"filter","aria-label":this.props.intl.formatMessage({id:"data.filter.options.changeAllFiltersButtonLabel",defaultMessage:"Change all filters"}),title:this.props.intl.formatMessage({id:"data.filter.options.changeAllFiltersButtonLabel",defaultMessage:"Change all filters"}),"data-test-subj":"showFilterActions"}),anchorPosition:"rightUp",panelPaddingSize:"none",repositionOnScroll:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopoverTitle"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"data.filter.searchBar.changeAllFiltersTitle",defaultMessage:"Change all filters"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiContextMenu"],{initialPanelId:0,panels:[panelTree]}))}}const FilterOptions=Object(external_kbnSharedDeps_KbnI18nReact_["injectI18n"])(filter_options_FilterOptionsUI);function FilterBarUI(props){const[isAddFilterPopoverOpen,setIsAddFilterPopoverOpen]=Object(external_kbnSharedDeps_React_["useState"])(false);const kibana=Object(public_["useKibana"])();const{appName:appName,usageCollection:usageCollection,uiSettings:uiSettings}=kibana.services;if(!uiSettings)return null;const reportUiCounter=usageCollection===null||usageCollection===void 0?void 0:usageCollection.reportUiCounter.bind(usageCollection,appName);function onFiltersUpdated(filters){if(props.onFiltersUpdated){props.onFiltersUpdated(filters)}}function renderItems(){return props.filters.map((filter,i)=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{key:i,grow:false,className:"globalFilterBar__flexItem"},external_kbnSharedDeps_React_default.a.createElement(FilterItem,{id:`${i}`,intl:props.intl,filter:filter,onUpdate:newFilter=>onUpdate(i,newFilter),onRemove:()=>onRemove(i),indexPatterns:props.indexPatterns,uiSettings:uiSettings})))}function renderAddFilter(){const isPinned=uiSettings.get(common["UI_SETTINGS"].FILTERS_PINNED_BY_DEFAULT);const[indexPattern]=props.indexPatterns;const index=indexPattern&&indexPattern.id;const newFilter=Object(common["buildEmptyFilter"])(isPinned,index);const button=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{size:"xs",onClick:()=>setIsAddFilterPopoverOpen(true),"data-test-subj":"addFilter",className:"globalFilterBar__addButton"},"+"," ",external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"data.filter.filterBar.addFilterButtonLabel",defaultMessage:"Add filter"}));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopover"],{id:"addFilterPopover",button:button,isOpen:isAddFilterPopoverOpen,closePopover:()=>setIsAddFilterPopoverOpen(false),anchorPosition:"downLeft",panelPaddingSize:"none",initialFocus:".filterEditor__hiddenItem",repositionOnScroll:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement("div",{style:{width:FILTER_EDITOR_WIDTH,maxWidth:"100%"}},external_kbnSharedDeps_React_default.a.createElement(FilterEditor,{filter:newFilter,indexPatterns:props.indexPatterns,onSubmit:onAdd,onCancel:()=>setIsAddFilterPopoverOpen(false),key:JSON.stringify(newFilter)})))))}function onAdd(filter){reportUiCounter===null||reportUiCounter===void 0?void 0:reportUiCounter(web["a"].CLICK,`filter:added`);setIsAddFilterPopoverOpen(false);const filters=[...props.filters,filter];onFiltersUpdated(filters)}function onRemove(i){reportUiCounter===null||reportUiCounter===void 0?void 0:reportUiCounter(web["a"].CLICK,`filter:removed`);const filters=[...props.filters];filters.splice(i,1);onFiltersUpdated(filters)}function onUpdate(i,filter){reportUiCounter===null||reportUiCounter===void 0?void 0:reportUiCounter(web["a"].CLICK,`filter:edited`);const filters=[...props.filters];filters[i]=filter;onFiltersUpdated(filters)}function onEnableAll(){reportUiCounter===null||reportUiCounter===void 0?void 0:reportUiCounter(web["a"].CLICK,`filter:enable_all`);const filters=props.filters.map(common["enableFilter"]);onFiltersUpdated(filters)}function onDisableAll(){reportUiCounter===null||reportUiCounter===void 0?void 0:reportUiCounter(web["a"].CLICK,`filter:disable_all`);const filters=props.filters.map(common["disableFilter"]);onFiltersUpdated(filters)}function onPinAll(){reportUiCounter===null||reportUiCounter===void 0?void 0:reportUiCounter(web["a"].CLICK,`filter:pin_all`);const filters=props.filters.map(common["pinFilter"]);onFiltersUpdated(filters)}function onUnpinAll(){reportUiCounter===null||reportUiCounter===void 0?void 0:reportUiCounter(web["a"].CLICK,`filter:unpin_all`);const filters=props.filters.map(common["unpinFilter"]);onFiltersUpdated(filters)}function onToggleAllNegated(){reportUiCounter===null||reportUiCounter===void 0?void 0:reportUiCounter(web["a"].CLICK,`filter:invert_all`);const filters=props.filters.map(common["toggleFilterNegated"]);onFiltersUpdated(filters)}function onToggleAllDisabled(){reportUiCounter===null||reportUiCounter===void 0?void 0:reportUiCounter(web["a"].CLICK,`filter:toggle_all`);const filters=props.filters.map(common["toggleFilterDisabled"]);onFiltersUpdated(filters)}function onRemoveAll(){reportUiCounter===null||reportUiCounter===void 0?void 0:reportUiCounter(web["a"].CLICK,`filter:remove_all`);onFiltersUpdated([])}const classes=classnames_default()("globalFilterBar",props.className);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{className:"globalFilterGroup",gutterSize:"none",alignItems:"flexStart",responsive:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{className:"globalFilterGroup__branch",grow:false},external_kbnSharedDeps_React_default.a.createElement(FilterOptions,{onEnableAll:onEnableAll,onDisableAll:onDisableAll,onPinAll:onPinAll,onUnpinAll:onUnpinAll,onToggleAllNegated:onToggleAllNegated,onToggleAllDisabled:onToggleAllDisabled,onRemoveAll:onRemoveAll})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{className:"globalFilterGroup__filterFlexItem"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{className:classes,wrap:true,responsive:false,gutterSize:"xs",alignItems:"center"},renderItems(),renderAddFilter())))}const FilterBar=Object(external_kbnSharedDeps_KbnI18nReact_["injectI18n"])(FilterBarUI);function SaveQueryForm({savedQuery:savedQuery,savedQueryService:savedQueryService,onSave:onSave,onClose:onClose,showFilterOption:showFilterOption=true,showTimeFilterOption:showTimeFilterOption=true}){const[title,setTitle]=Object(external_kbnSharedDeps_React_["useState"])(savedQuery?savedQuery.title:"");const[enabledSaveButton,setEnabledSaveButton]=Object(external_kbnSharedDeps_React_["useState"])(Boolean(savedQuery));const[description,setDescription]=Object(external_kbnSharedDeps_React_["useState"])(savedQuery?savedQuery.description:"");const[savedQueries,setSavedQueries]=Object(external_kbnSharedDeps_React_["useState"])([]);const[shouldIncludeFilters,setShouldIncludeFilters]=Object(external_kbnSharedDeps_React_["useState"])(savedQuery?!!savedQuery.filters:true);const[shouldIncludeTimefilter,setIncludeTimefilter]=Object(external_kbnSharedDeps_React_["useState"])(savedQuery?!!savedQuery.timefilter:false);const[formErrors,setFormErrors]=Object(external_kbnSharedDeps_React_["useState"])([]);const titleConflictErrorText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryForm.titleConflictText",{defaultMessage:"Name conflicts with an existing saved query"});const savedQueryDescriptionText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryDescriptionText",{defaultMessage:"Save query text and filters that you want to use again."});Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const fetchQueries=async()=>{const allSavedQueries=await savedQueryService.getAllSavedQueries();const sortedAllSavedQueries=Object(external_kbnSharedDeps_Lodash_["sortBy"])(allSavedQueries,"attributes.title");setSavedQueries(sortedAllSavedQueries)};fetchQueries()},[savedQueryService]);const validate=Object(external_kbnSharedDeps_React_["useCallback"])(()=>{const errors=[];if(!!savedQueries.find(existingSavedQuery=>!savedQuery&&existingSavedQuery.attributes.title===title)){errors.push(titleConflictErrorText)}if(!Object(external_kbnSharedDeps_Lodash_["isEqual"])(errors,formErrors)){setFormErrors(errors);return false}return!formErrors.length},[savedQueries,savedQuery,title,titleConflictErrorText,formErrors]);const onClickSave=Object(external_kbnSharedDeps_React_["useCallback"])(()=>{if(validate()){onSave({title:title,description:description,shouldIncludeFilters:shouldIncludeFilters,shouldIncludeTimefilter:shouldIncludeTimefilter})}},[validate,onSave,title,description,shouldIncludeFilters,shouldIncludeTimefilter]);const onInputChange=Object(external_kbnSharedDeps_React_["useCallback"])(event=>{setEnabledSaveButton(Boolean(event.target.value));setFormErrors([]);setTitle(event.target.value)},[]);const autoTrim=Object(external_kbnSharedDeps_React_["useCallback"])(()=>{const trimmedTitle=title.trim();if(title.length>trimmedTitle.length){setTitle(trimmedTitle)}},[title]);const hasErrors=formErrors.length>0;const saveQueryForm=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiForm"],{isInvalid:hasErrors,error:formErrors,"data-test-subj":"saveQueryForm"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{color:"subdued"},savedQueryDescriptionText)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryNameLabelText",{defaultMessage:"Name"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryNameHelpText",{defaultMessage:"Name is required. Name cannot contain leading or trailing whitespace. Name must be unique."}),isInvalid:hasErrors},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{disabled:!!savedQuery,value:title,name:"title",onChange:onInputChange,"data-test-subj":"saveQueryFormTitle",isInvalid:hasErrors,onBlur:autoTrim})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryDescriptionLabelText",{defaultMessage:"Description"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{value:description,name:"description",onChange:event=>{setDescription(event.target.value)},"data-test-subj":"saveQueryFormDescription"})),showFilterOption&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{name:"shouldIncludeFilters",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryIncludeFiltersLabelText",{defaultMessage:"Include filters"}),checked:shouldIncludeFilters,onChange:()=>{setShouldIncludeFilters(!shouldIncludeFilters)},"data-test-subj":"saveQueryFormIncludeFiltersOption"})),showTimeFilterOption&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{name:"shouldIncludeTimefilter",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryIncludeTimeFilterLabelText",{defaultMessage:"Include time filter"}),checked:shouldIncludeTimefilter,onChange:()=>{setIncludeTimefilter(!shouldIncludeTimefilter)},"data-test-subj":"saveQueryFormIncludeTimeFilterOption"})));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModal"],{onClose:onClose,initialFocus:"[name=title]"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalHeaderTitle"],null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryFormTitle",{defaultMessage:"Save query"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalBody"],null,saveQueryForm),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalFooter"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:onClose,"data-test-subj":"savedQueryFormCancelButton"},external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryFormCancelButtonText",{defaultMessage:"Cancel"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:onClickSave,fill:true,"data-test-subj":"savedQueryFormSaveButton",disabled:hasErrors||!enabledSaveButton},external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryFormSaveButtonText",{defaultMessage:"Save"}))))}const SavedQueryListItem=({savedQuery:savedQuery,isSelected:isSelected,onSelect:onSelect,onDelete:onDelete,showWriteOperations:showWriteOperations})=>{const[showDeletionConfirmationModal,setShowDeletionConfirmationModal]=Object(external_kbnSharedDeps_React_["useState"])(false);const selectButtonAriaLabelText=isSelected?external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryPopoverSavedQueryListItemSelectedButtonAriaLabel",{defaultMessage:"Saved query button selected {savedQueryName}. Press to clear any changes.",values:{savedQueryName:savedQuery.attributes.title}}):external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryPopoverSavedQueryListItemButtonAriaLabel",{defaultMessage:"Saved query button {savedQueryName}",values:{savedQueryName:savedQuery.attributes.title}});const selectButtonDataTestSubj=isSelected?`load-saved-query-${savedQuery.attributes.title}-button saved-query-list-item-selected`:`load-saved-query-${savedQuery.attributes.title}-button`;const classes=classnames_default()("kbnSavedQueryListItem",{"kbnSavedQueryListItem-selected":isSelected});const label=external_kbnSharedDeps_React_default.a.createElement("span",{className:"kbnSavedQueryListItem__label"},external_kbnSharedDeps_React_default.a.createElement("span",{className:"kbnSavedQueryListItem__labelText"},savedQuery.attributes.title)," ",savedQuery.attributes.description&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIconTip"],{type:"iInCircle",content:savedQuery.attributes.description,"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryPopoverSavedQueryListItemDescriptionAriaLabel",{defaultMessage:"{savedQueryName} description",values:{savedQueryName:savedQuery.attributes.title}})}));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiListGroupItem"],{className:classes,key:savedQuery.id,"data-test-subj":`saved-query-list-item ${selectButtonDataTestSubj} ${isSelected?"saved-query-list-item-selected":""}`,isActive:isSelected,onClick:()=>{onSelect(savedQuery)},"aria-label":selectButtonAriaLabelText,label:label,iconType:isSelected?"check":undefined,extraAction:showWriteOperations?{color:"danger",onClick:()=>setShowDeletionConfirmationModal(true),iconType:"trash",iconSize:"s","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryPopoverDeleteButtonAriaLabel",{defaultMessage:"Delete saved query {savedQueryName}",values:{savedQueryName:savedQuery.attributes.title}}),title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryPopoverDeleteButtonAriaLabel",{defaultMessage:"Delete saved query {savedQueryName}",values:{savedQueryName:savedQuery.attributes.title}}),"data-test-subj":`delete-saved-query-${savedQuery.attributes.title}-button`}:undefined}),showDeletionConfirmationModal&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiConfirmModal"],{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryPopoverConfirmDeletionTitle",{defaultMessage:'Delete "{savedQueryName}"?',values:{savedQueryName:savedQuery.attributes.title}}),confirmButtonText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryPopoverConfirmDeletionConfirmButtonText",{defaultMessage:"Delete"}),cancelButtonText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryPopoverConfirmDeletionCancelButtonText",{defaultMessage:"Cancel"}),onConfirm:()=>{onDelete(savedQuery);setShowDeletionConfirmationModal(false)},buttonColor:"danger",onCancel:()=>{setShowDeletionConfirmationModal(false)}}))};const perPage=50;function SavedQueryManagementComponent({showSaveQuery:showSaveQuery,loadedSavedQuery:loadedSavedQuery,onSave:onSave,onSaveAsNew:onSaveAsNew,onLoad:onLoad,onClearSavedQuery:onClearSavedQuery,savedQueryService:savedQueryService}){const[isOpen,setIsOpen]=Object(external_kbnSharedDeps_React_["useState"])(false);const[savedQueries,setSavedQueries]=Object(external_kbnSharedDeps_React_["useState"])([]);const[count,setTotalCount]=Object(external_kbnSharedDeps_React_["useState"])(0);const[activePage,setActivePage]=Object(external_kbnSharedDeps_React_["useState"])(0);const cancelPendingListingRequest=Object(external_kbnSharedDeps_React_["useRef"])(()=>{});Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const fetchCountAndSavedQueries=async()=>{cancelPendingListingRequest.current();let requestGotCancelled=false;cancelPendingListingRequest.current=()=>{requestGotCancelled=true};const{total:savedQueryCount,queries:savedQueryItems}=await savedQueryService.findSavedQueries("",perPage,activePage+1);if(requestGotCancelled)return;const sortedSavedQueryItems=Object(external_kbnSharedDeps_Lodash_["sortBy"])(savedQueryItems,"attributes.title");setTotalCount(savedQueryCount);setSavedQueries(sortedSavedQueryItems)};if(isOpen){fetchCountAndSavedQueries()}},[isOpen,activePage,savedQueryService]);const handleTogglePopover=Object(external_kbnSharedDeps_React_["useCallback"])(()=>setIsOpen(currentState=>!currentState),[setIsOpen]);const handleClosePopover=Object(external_kbnSharedDeps_React_["useCallback"])(()=>setIsOpen(false),[]);const handleSave=Object(external_kbnSharedDeps_React_["useCallback"])(()=>{handleClosePopover();onSave()},[handleClosePopover,onSave]);const handleSaveAsNew=Object(external_kbnSharedDeps_React_["useCallback"])(()=>{handleClosePopover();onSaveAsNew()},[handleClosePopover,onSaveAsNew]);const handleSelect=Object(external_kbnSharedDeps_React_["useCallback"])(savedQueryToSelect=>{handleClosePopover();onLoad(savedQueryToSelect)},[handleClosePopover,onLoad]);const handleDelete=Object(external_kbnSharedDeps_React_["useCallback"])(savedQueryToDelete=>{const onDeleteSavedQuery=async savedQuery=>{cancelPendingListingRequest.current();setSavedQueries(savedQueries.filter(currentSavedQuery=>currentSavedQuery.id!==savedQuery.id));if(loadedSavedQuery&&loadedSavedQuery.id===savedQuery.id){onClearSavedQuery()}await savedQueryService.deleteSavedQuery(savedQuery.id);setActivePage(0)};onDeleteSavedQuery(savedQueryToDelete);handleClosePopover()},[handleClosePopover,loadedSavedQuery,onClearSavedQuery,savedQueries,savedQueryService]);const savedQueryDescriptionText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryDescriptionText",{defaultMessage:"Save query text and filters that you want to use again."});const noSavedQueriesDescriptionText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryNoSavedQueriesText",{defaultMessage:"There are no saved queries."})+" "+savedQueryDescriptionText;const savedQueryPopoverTitleText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryPopoverTitleText",{defaultMessage:"Saved Queries"});const goToPage=pageNumber=>{setActivePage(pageNumber)};const savedQueryPopoverButton=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:handleTogglePopover,"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryPopoverButtonText",{defaultMessage:"See saved queries"}),title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryPopoverButtonText",{defaultMessage:"See saved queries"}),"data-test-subj":"saved-query-management-popover-button"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:"save",className:"euiQuickSelectPopover__buttonText"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:"arrowDown"}));const savedQueryRows=()=>{const savedQueriesWithoutCurrent=savedQueries.filter(savedQuery=>{if(!loadedSavedQuery)return true;return savedQuery.id!==loadedSavedQuery.id});const savedQueriesReordered=loadedSavedQuery&&savedQueriesWithoutCurrent.length!==savedQueries.length?[loadedSavedQuery,...savedQueriesWithoutCurrent]:[...savedQueriesWithoutCurrent];return savedQueriesReordered.map(savedQuery=>external_kbnSharedDeps_React_default.a.createElement(SavedQueryListItem,{key:savedQuery.id,savedQuery:savedQuery,isSelected:!!loadedSavedQuery&&loadedSavedQuery.id===savedQuery.id,onSelect:handleSelect,onDelete:handleDelete,showWriteOperations:!!showSaveQuery}))};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopover"],{id:"savedQueryPopover",button:savedQueryPopoverButton,isOpen:isOpen,closePopover:handleClosePopover,anchorPosition:"downLeft",panelPaddingSize:"none",buffer:-8,repositionOnScroll:true},external_kbnSharedDeps_React_default.a.createElement("div",{className:"kbnSavedQueryManagement__popover","data-test-subj":"saved-query-management-popover"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopoverTitle"],{id:"savedQueryManagementPopoverTitle"},savedQueryPopoverTitleText),savedQueries.length>0?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s",color:"subdued",className:"kbnSavedQueryManagement__text"},external_kbnSharedDeps_React_default.a.createElement("p",null,savedQueryDescriptionText)),external_kbnSharedDeps_React_default.a.createElement("div",{className:"kbnSavedQueryManagement__listWrapper"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiListGroup"],{flush:true,className:"kbnSavedQueryManagement__list","aria-labelledby":"savedQueryManagementPopoverTitle"},savedQueryRows())),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPagination"],{className:"kbnSavedQueryManagement__pagination",pageCount:Math.ceil(count/perPage),activePage:activePage,onPageClick:goToPage})):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s",color:"subdued",className:"kbnSavedQueryManagement__text"},external_kbnSharedDeps_React_default.a.createElement("p",null,noSavedQueriesDescriptionText)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopoverFooter"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"rowReverse",gutterSize:"s",alignItems:"center",justifyContent:"flexEnd",responsive:false,wrap:true},showSaveQuery&&loadedSavedQuery&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{size:"s",fill:true,onClick:handleSave,"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryPopoverSaveChangesButtonAriaLabel",{defaultMessage:"Save changes to {title}",values:{title:loadedSavedQuery.attributes.title}}),"data-test-subj":"saved-query-management-save-changes-button"},external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryPopoverSaveChangesButtonText",{defaultMessage:"Save changes"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{size:"s",onClick:handleSaveAsNew,"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryPopoverSaveAsNewButtonAriaLabel",{defaultMessage:"Save as new saved query"}),"data-test-subj":"saved-query-management-save-as-new-button"},external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryPopoverSaveAsNewButtonText",{defaultMessage:"Save as new"})))),showSaveQuery&&!loadedSavedQuery&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{size:"s",fill:true,onClick:handleSave,"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryPopoverSaveButtonAriaLabel",{defaultMessage:"Save a new saved query"}),"data-test-subj":"saved-query-management-save-button"},external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryPopoverSaveButtonText",{defaultMessage:"Save current query"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},loadedSavedQuery&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{size:"s",flush:"left",onClick:onClearSavedQuery,"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryPopoverClearButtonAriaLabel",{defaultMessage:"Clear current saved query"}),"data-test-subj":"saved-query-management-clear-button"},external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.search.searchBar.savedQueryPopoverClearButtonText",{defaultMessage:"Clear"}))))))))}function search_bar_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class search_bar_SearchBarUI extends external_kbnSharedDeps_React_["Component"]{constructor(...args){super(...args);search_bar_defineProperty(this,"services",this.props.kibana.services);search_bar_defineProperty(this,"savedQueryService",this.services.data.query.savedQueries);search_bar_defineProperty(this,"filterBarRef",null);search_bar_defineProperty(this,"filterBarWrapperRef",null);search_bar_defineProperty(this,"state",{isFiltersVisible:true,showSaveQueryModal:false,showSaveNewQueryModal:false,showSavedQueryPopover:false,currentProps:this.props,query:this.props.query?{...this.props.query}:undefined,dateRangeFrom:Object(external_kbnSharedDeps_Lodash_["get"])(this.props,"dateRangeFrom","now-15m"),dateRangeTo:Object(external_kbnSharedDeps_Lodash_["get"])(this.props,"dateRangeTo","now")});search_bar_defineProperty(this,"isDirty",()=>{if(!this.props.showDatePicker&&this.state.query&&this.props.query){return this.state.query.query!==this.props.query.query}return this.state.query&&this.props.query&&this.state.query.query!==this.props.query.query||this.state.dateRangeFrom!==this.props.dateRangeFrom||this.state.dateRangeTo!==this.props.dateRangeTo});search_bar_defineProperty(this,"setFilterBarHeight",()=>{requestAnimationFrame(()=>{const height=this.filterBarRef&&this.state.isFiltersVisible?this.filterBarRef.clientHeight:0;if(this.filterBarWrapperRef){this.filterBarWrapperRef.setAttribute("style",`height: ${height}px`)}})});search_bar_defineProperty(this,"ro",new ResizeObserver_default.a(this.setFilterBarHeight));search_bar_defineProperty(this,"onSave",async(savedQueryMeta,saveAsNew=false)=>{if(!this.state.query)return;const savedQueryAttributes={title:savedQueryMeta.title,description:savedQueryMeta.description,query:this.state.query};if(savedQueryMeta.shouldIncludeFilters){savedQueryAttributes.filters=this.props.filters}if(savedQueryMeta.shouldIncludeTimefilter&&this.state.dateRangeTo!==undefined&&this.state.dateRangeFrom!==undefined&&this.props.refreshInterval!==undefined&&this.props.isRefreshPaused!==undefined){savedQueryAttributes.timefilter={from:this.state.dateRangeFrom,to:this.state.dateRangeTo,refreshInterval:{value:this.props.refreshInterval,pause:this.props.isRefreshPaused}}}try{let response;if(this.props.savedQuery&&!saveAsNew){response=await this.savedQueryService.saveQuery(savedQueryAttributes,{overwrite:true})}else{response=await this.savedQueryService.saveQuery(savedQueryAttributes)}this.services.notifications.toasts.addSuccess(`Your query "${response.attributes.title}" was saved`);this.setState({showSaveQueryModal:false,showSaveNewQueryModal:false});if(this.props.onSaved){this.props.onSaved(response)}}catch(error){this.services.notifications.toasts.addDanger(`An error occured while saving your query: ${error.message}`);throw error}});search_bar_defineProperty(this,"onInitiateSave",()=>{this.setState({showSaveQueryModal:true})});search_bar_defineProperty(this,"onInitiateSaveNew",()=>{this.setState({showSaveNewQueryModal:true})});search_bar_defineProperty(this,"onQueryBarChange",queryAndDateRange=>{this.setState({query:queryAndDateRange.query,dateRangeFrom:queryAndDateRange.dateRange.from,dateRangeTo:queryAndDateRange.dateRange.to});if(this.props.onQueryChange){this.props.onQueryChange(queryAndDateRange)}});search_bar_defineProperty(this,"onQueryBarSubmit",queryAndDateRange=>{this.setState({query:queryAndDateRange.query,dateRangeFrom:queryAndDateRange.dateRange&&queryAndDateRange.dateRange.from||this.state.dateRangeFrom,dateRangeTo:queryAndDateRange.dateRange&&queryAndDateRange.dateRange.to||this.state.dateRangeTo},()=>{var _this$services$usageC;if(this.props.onQuerySubmit){this.props.onQuerySubmit({query:this.state.query,dateRange:{from:this.state.dateRangeFrom,to:this.state.dateRangeTo}})}(_this$services$usageC=this.services.usageCollection)===null||_this$services$usageC===void 0?void 0:_this$services$usageC.reportUiCounter(this.services.appName,web["a"].CLICK,"query_submitted")})});search_bar_defineProperty(this,"onLoadSavedQuery",savedQuery=>{const dateRangeFrom=Object(external_kbnSharedDeps_Lodash_["get"])(savedQuery,"attributes.timefilter.from",this.state.dateRangeFrom);const dateRangeTo=Object(external_kbnSharedDeps_Lodash_["get"])(savedQuery,"attributes.timefilter.to",this.state.dateRangeTo);this.setState({query:savedQuery.attributes.query,dateRangeFrom:dateRangeFrom,dateRangeTo:dateRangeTo});if(this.props.onSavedQueryUpdated){this.props.onSavedQueryUpdated(savedQuery)}})}static getDerivedStateFromProps(nextProps,prevState){if(Object(external_kbnSharedDeps_Lodash_["isEqual"])(prevState.currentProps,nextProps)){return null}let nextQuery=null;if(nextProps.query&&nextProps.query.query!==Object(external_kbnSharedDeps_Lodash_["get"])(prevState,"currentProps.query.query")){nextQuery={query:nextProps.query.query,language:nextProps.query.language}}else if(nextProps.query&&prevState.query&&nextProps.query.language!==prevState.query.language){nextQuery={query:"",language:nextProps.query.language}}let nextDateRange=null;if(nextProps.dateRangeFrom!==Object(external_kbnSharedDeps_Lodash_["get"])(prevState,"currentProps.dateRangeFrom")||nextProps.dateRangeTo!==Object(external_kbnSharedDeps_Lodash_["get"])(prevState,"currentProps.dateRangeTo")){nextDateRange={dateRangeFrom:nextProps.dateRangeFrom,dateRangeTo:nextProps.dateRangeTo}}const nextState={currentProps:nextProps};if(nextQuery){nextState.query=nextQuery}if(nextDateRange){nextState.dateRangeFrom=nextDateRange.dateRangeFrom;nextState.dateRangeTo=nextDateRange.dateRangeTo}return nextState}shouldRenderQueryBar(){const showDatePicker=this.props.showDatePicker||this.props.showAutoRefreshOnly;const showQueryInput=this.props.showQueryInput&&this.props.indexPatterns&&this.state.query;return this.props.showQueryBar&&(showDatePicker||showQueryInput)}shouldRenderFilterBar(){return this.props.showFilterBar&&this.props.filters&&this.props.indexPatterns&&Object(external_kbnSharedDeps_Lodash_["compact"])(this.props.indexPatterns).length>0}shouldRenderTimeFilterInSavedQueryForm(){const{dateRangeFrom:dateRangeFrom,dateRangeTo:dateRangeTo,showDatePicker:showDatePicker}=this.props;return showDatePicker||!showDatePicker&&dateRangeFrom!==undefined&&dateRangeTo!==undefined}componentDidMount(){if(this.filterBarRef){this.setFilterBarHeight();this.ro.observe(this.filterBarRef)}}componentDidUpdate(){if(this.filterBarRef){this.setFilterBarHeight();this.ro.unobserve(this.filterBarRef)}}render(){const savedQueryManagement=this.state.query&&this.props.onClearSavedQuery&&external_kbnSharedDeps_React_default.a.createElement(SavedQueryManagementComponent,{showSaveQuery:this.props.showSaveQuery,loadedSavedQuery:this.props.savedQuery,onSave:this.onInitiateSave,onSaveAsNew:this.onInitiateSaveNew,onLoad:this.onLoadSavedQuery,savedQueryService:this.savedQueryService,onClearSavedQuery:this.props.onClearSavedQuery});let queryBar;if(this.shouldRenderQueryBar()){queryBar=external_kbnSharedDeps_React_default.a.createElement(query_bar_top_row["default"],{timeHistory:this.props.timeHistory,query:this.state.query,screenTitle:this.props.screenTitle,onSubmit:this.onQueryBarSubmit,indexPatterns:this.props.indexPatterns,isLoading:this.props.isLoading,prepend:this.props.showFilterBar?savedQueryManagement:undefined,showDatePicker:this.props.showDatePicker,dateRangeFrom:this.state.dateRangeFrom,dateRangeTo:this.state.dateRangeTo,isRefreshPaused:this.props.isRefreshPaused,refreshInterval:this.props.refreshInterval,showAutoRefreshOnly:this.props.showAutoRefreshOnly,showQueryInput:this.props.showQueryInput,onRefresh:this.props.onRefresh,onRefreshChange:this.props.onRefreshChange,onChange:this.onQueryBarChange,isDirty:this.isDirty(),customSubmitButton:this.props.customSubmitButton?this.props.customSubmitButton:undefined,dataTestSubj:this.props.dataTestSubj,indicateNoData:this.props.indicateNoData})}let filterBar;if(this.shouldRenderFilterBar()){const filterGroupClasses=classnames_default()("globalFilterGroup__wrapper",{"globalFilterGroup__wrapper-isVisible":this.state.isFiltersVisible});filterBar=external_kbnSharedDeps_React_default.a.createElement("div",{id:"GlobalFilterGroup",ref:node=>{this.filterBarWrapperRef=node},className:filterGroupClasses},external_kbnSharedDeps_React_default.a.createElement("div",{ref:node=>{this.filterBarRef=node}},external_kbnSharedDeps_React_default.a.createElement(FilterBar,{className:"globalFilterGroup__filterBar",filters:this.props.filters,onFiltersUpdated:this.props.onFiltersUpdated,indexPatterns:this.props.indexPatterns,appName:this.services.appName})))}return external_kbnSharedDeps_React_default.a.createElement("div",{className:"globalQueryBar","data-test-subj":"globalQueryBar"},queryBar,filterBar,this.state.showSaveQueryModal?external_kbnSharedDeps_React_default.a.createElement(SaveQueryForm,{savedQuery:this.props.savedQuery?this.props.savedQuery.attributes:undefined,savedQueryService:this.savedQueryService,onSave:this.onSave,onClose:()=>this.setState({showSaveQueryModal:false}),showFilterOption:this.props.showFilterBar,showTimeFilterOption:this.shouldRenderTimeFilterInSavedQueryForm()}):null,this.state.showSaveNewQueryModal?external_kbnSharedDeps_React_default.a.createElement(SaveQueryForm,{savedQueryService:this.savedQueryService,onSave:savedQueryMeta=>this.onSave(savedQueryMeta,true),onClose:()=>this.setState({showSaveNewQueryModal:false}),showFilterOption:this.props.showFilterBar,showTimeFilterOption:this.shouldRenderTimeFilterInSavedQueryForm()}):null)}}search_bar_defineProperty(search_bar_SearchBarUI,"defaultProps",{showQueryBar:true,showFilterBar:true,showDatePicker:true,showAutoRefreshOnly:false});var search_bar=__webpack_exports__["default"]=Object(external_kbnSharedDeps_KbnI18nReact_["injectI18n"])(Object(public_["withKibana"])(search_bar_SearchBarUI))},215:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"c",(function(){return isOneOfOperator}));__webpack_require__.d(__webpack_exports__,"b",(function(){return existsOperator}));__webpack_require__.d(__webpack_exports__,"a",(function(){return FILTER_OPERATORS}));var _kbn_i18n__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0);var _kbn_i18n__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__);var _common_es_query_filters__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(9);const isOperator={message:_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("data.filter.filterEditor.isOperatorOptionLabel",{defaultMessage:"is"}),type:_common_es_query_filters__WEBPACK_IMPORTED_MODULE_1__["FILTERS"].PHRASE,negate:false};const isNotOperator={message:_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("data.filter.filterEditor.isNotOperatorOptionLabel",{defaultMessage:"is not"}),type:_common_es_query_filters__WEBPACK_IMPORTED_MODULE_1__["FILTERS"].PHRASE,negate:true};const isOneOfOperator={message:_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("data.filter.filterEditor.isOneOfOperatorOptionLabel",{defaultMessage:"is one of"}),type:_common_es_query_filters__WEBPACK_IMPORTED_MODULE_1__["FILTERS"].PHRASES,negate:false,fieldTypes:["string","number","date","ip","geo_point","geo_shape"]};const isNotOneOfOperator={message:_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("data.filter.filterEditor.isNotOneOfOperatorOptionLabel",{defaultMessage:"is not one of"}),type:_common_es_query_filters__WEBPACK_IMPORTED_MODULE_1__["FILTERS"].PHRASES,negate:true,fieldTypes:["string","number","date","ip","geo_point","geo_shape"]};const isBetweenOperator={message:_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("data.filter.filterEditor.isBetweenOperatorOptionLabel",{defaultMessage:"is between"}),type:_common_es_query_filters__WEBPACK_IMPORTED_MODULE_1__["FILTERS"].RANGE,negate:false,fieldTypes:["number","date","ip"]};const isNotBetweenOperator={message:_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("data.filter.filterEditor.isNotBetweenOperatorOptionLabel",{defaultMessage:"is not between"}),type:_common_es_query_filters__WEBPACK_IMPORTED_MODULE_1__["FILTERS"].RANGE,negate:true,fieldTypes:["number","date","ip"]};const existsOperator={message:_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("data.filter.filterEditor.existsOperatorOptionLabel",{defaultMessage:"exists"}),type:_common_es_query_filters__WEBPACK_IMPORTED_MODULE_1__["FILTERS"].EXISTS,negate:false};const doesNotExistOperator={message:_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("data.filter.filterEditor.doesNotExistOperatorOptionLabel",{defaultMessage:"does not exist"}),type:_common_es_query_filters__WEBPACK_IMPORTED_MODULE_1__["FILTERS"].EXISTS,negate:true};const FILTER_OPERATORS=[isOperator,isNotOperator,isOneOfOperator,isNotOneOfOperator,isBetweenOperator,isNotBetweenOperator,existsOperator,doesNotExistOperator]},219:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"default",(function(){return QueryBarTopRow}));var elastic_datemath=__webpack_require__(18);var elastic_datemath_default=__webpack_require__.n(elastic_datemath);var classnames=__webpack_require__(214);var classnames_default=__webpack_require__.n(classnames);var external_kbnSharedDeps_React_=__webpack_require__(3);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(0);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(13);var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(44);var public_=__webpack_require__(23);var query_string_input=__webpack_require__(218);var common=__webpack_require__(1);var public_query=__webpack_require__(14);const NO_DATA_POPOVER_STORAGE_KEY="data.noDataPopover";function NoDataPopover({showNoDataPopover:showNoDataPopover,storage:storage,children:children}){const[noDataPopoverDismissed,setNoDataPopoverDismissed]=Object(external_kbnSharedDeps_React_["useState"])(()=>Boolean(storage.get(NO_DATA_POPOVER_STORAGE_KEY)));const[noDataPopoverVisible,setNoDataPopoverVisible]=Object(external_kbnSharedDeps_React_["useState"])(false);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(showNoDataPopover&&!noDataPopoverDismissed){setNoDataPopoverVisible(true)}},[noDataPopoverDismissed,showNoDataPopover]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTourStep"],{onFinish:()=>{},closePopover:()=>{setNoDataPopoverVisible(false)},content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("p",{style:{maxWidth:300}},external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.noDataPopover.content",{defaultMessage:"This time range doesn't contain any data. Increase or adjust the time range to see more fields and create charts."}))),minWidth:300,anchorPosition:"downCenter",anchorClassName:"eui-displayBlock",step:1,stepsTotal:1,isStepOpen:noDataPopoverVisible,subtitle:external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.noDataPopover.subtitle",{defaultMessage:"Tip"}),title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.noDataPopover.title",{defaultMessage:"Empty dataset"}),footerAction:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{size:"xs",flush:"right",color:"text","data-test-subj":"noDataPopoverDismissButton",onClick:()=>{storage.set(NO_DATA_POPOVER_STORAGE_KEY,true);setNoDataPopoverDismissed(true);setNoDataPopoverVisible(false)}},external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.noDataPopover.dismissAction",{defaultMessage:"Don't show again"}))},external_kbnSharedDeps_React_default.a.createElement("div",{onFocus:()=>{setNoDataPopoverVisible(false)}},children))}const QueryStringInput=Object(public_["withKibana"])(query_string_input["default"]);function QueryBarTopRow(props){const[isDateRangeInvalid,setIsDateRangeInvalid]=Object(external_kbnSharedDeps_React_["useState"])(false);const[isQueryInputFocused,setIsQueryInputFocused]=Object(external_kbnSharedDeps_React_["useState"])(false);const kibana=Object(public_["useKibana"])();const{uiSettings:uiSettings,notifications:notifications,storage:storage,appName:appName,docLinks:docLinks}=kibana.services;const kueryQuerySyntaxLink=docLinks.links.query.kueryQuerySyntax;const queryLanguage=props.query&&props.query.language;const persistedLog=external_kbnSharedDeps_React_default.a.useMemo(()=>queryLanguage&&uiSettings&&storage&&appName?Object(public_query["v"])(uiSettings,storage,appName,queryLanguage):undefined,[appName,queryLanguage,uiSettings,storage]);function onClickSubmitButton(event){if(persistedLog&&props.query){persistedLog.add(props.query.query)}event.preventDefault();onSubmit({query:props.query,dateRange:getDateRange()})}function getDateRange(){const defaultTimeSetting=uiSettings.get(common["UI_SETTINGS"].TIMEPICKER_TIME_DEFAULTS);return{from:props.dateRangeFrom||defaultTimeSetting.from,to:props.dateRangeTo||defaultTimeSetting.to}}function onQueryChange(query){props.onChange({query:query,dateRange:getDateRange()})}function onChangeQueryInputFocus(isFocused){setIsQueryInputFocused(isFocused)}function onTimeChange({start:start,end:end,isInvalid:isInvalid,isQuickSelection:isQuickSelection}){setIsDateRangeInvalid(isInvalid);const retVal={query:props.query,dateRange:{from:start,to:end}};if(isQuickSelection){props.onSubmit(retVal)}else{props.onChange(retVal)}}function onRefresh({start:start,end:end}){const retVal={dateRange:{from:start,to:end}};if(props.onRefresh){props.onRefresh(retVal)}}function onSubmit({query:query,dateRange:dateRange}){handleLuceneSyntaxWarning();if(props.timeHistory){props.timeHistory.add(dateRange)}props.onSubmit({query:query,dateRange:dateRange})}function onInputSubmit(query){onSubmit({query:query,dateRange:getDateRange()})}function toAbsoluteString(value,roundUp=false){const valueAsMoment=elastic_datemath_default.a.parse(value,{roundUp:roundUp});if(!valueAsMoment){return value}return valueAsMoment.toISOString()}function renderQueryInput(){if(!shouldRenderQueryInput())return;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(QueryStringInput,{disableAutoFocus:props.disableAutoFocus,indexPatterns:props.indexPatterns,prepend:props.prepend,query:props.query,screenTitle:props.screenTitle,onChange:onQueryChange,onChangeQueryInputFocus:onChangeQueryInputFocus,onSubmit:onInputSubmit,persistedLog:persistedLog,dataTestSubj:props.dataTestSubj}))}function renderSharingMetaFields(){const{from:from,to:to}=getDateRange();const dateRangePretty=Object(external_kbnSharedDeps_ElasticEui_["prettyDuration"])(toAbsoluteString(from),toAbsoluteString(to),[],uiSettings.get("dateFormat"));return external_kbnSharedDeps_React_default.a.createElement("div",{"data-shared-timefilter-duration":dateRangePretty,"data-test-subj":"dataSharedTimefilterDuration"})}function shouldRenderDatePicker(){return Boolean(props.showDatePicker||props.showAutoRefreshOnly)}function shouldRenderQueryInput(){return Boolean(props.showQueryInput&&props.indexPatterns&&props.query&&storage)}function renderUpdateButton(){const button=props.customSubmitButton?external_kbnSharedDeps_React_default.a.cloneElement(props.customSubmitButton,{onClick:onClickSubmitButton}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSuperUpdateButton"],{needsUpdate:props.isDirty,isDisabled:isDateRangeInvalid,isLoading:props.isLoading,onClick:onClickSubmitButton,"data-test-subj":"querySubmitButton"});if(!shouldRenderDatePicker()){return button}return external_kbnSharedDeps_React_default.a.createElement(NoDataPopover,{storage:storage,showNoDataPopover:props.indicateNoData},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{responsive:false,gutterSize:"s"},renderDatePicker(),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},button)))}function renderDatePicker(){if(!shouldRenderDatePicker()){return null}let recentlyUsedRanges;if(props.timeHistory){recentlyUsedRanges=props.timeHistory.get().map(({from:from,to:to})=>({start:from,end:to}))}const commonlyUsedRanges=uiSettings.get(common["UI_SETTINGS"].TIMEPICKER_QUICK_RANGES).map(({from:from,to:to,display:display})=>({start:from,end:to,label:display}));const wrapperClasses=classnames_default()("kbnQueryBar__datePickerWrapper",{"kbnQueryBar__datePickerWrapper-isHidden":isQueryInputFocused});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{className:wrapperClasses},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSuperDatePicker"],{start:props.dateRangeFrom,end:props.dateRangeTo,isPaused:props.isRefreshPaused,refreshInterval:props.refreshInterval,onTimeChange:onTimeChange,onRefresh:onRefresh,onRefreshChange:props.onRefreshChange,showUpdateButton:false,recentlyUsedRanges:recentlyUsedRanges,commonlyUsedRanges:commonlyUsedRanges,dateFormat:uiSettings.get("dateFormat"),isAutoRefreshOnly:props.showAutoRefreshOnly,className:"kbnQueryBar__datePicker"}))}function handleLuceneSyntaxWarning(){if(!props.query)return;const{query:query,language:language}=props.query;if(language==="kuery"&&typeof query==="string"&&(!storage||!storage.get("kibana.luceneSyntaxWarningOptOut"))&&Object(common["doesKueryExpressionHaveLuceneSyntaxError"])(query)){const toast=notifications.toasts.addWarning({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("data.query.queryBar.luceneSyntaxWarningTitle",{defaultMessage:"Lucene syntax warning"}),text:Object(public_["toMountPoint"])(external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"data.query.queryBar.luceneSyntaxWarningMessage",defaultMessage:"It looks like you may be trying to use Lucene query syntax, although you have Kibana Query Language (KQL) selected. Please review the KQL docs {link}.",values:{link:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{href:kueryQuerySyntaxLink,target:"_blank"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"data.query.queryBar.syntaxOptionsDescription.docsLinkText",defaultMessage:"here"}))}})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"flexEnd",gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{size:"s",onClick:()=>onLuceneSyntaxWarningOptOut(toast)},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"data.query.queryBar.luceneSyntaxWarningOptOutText",defaultMessage:"Don't show again"}))))))})}}function onLuceneSyntaxWarningOptOut(toast){if(!storage)return;storage.set("kibana.luceneSyntaxWarningOptOut",true);notifications.toasts.remove(toast)}const classes=classnames_default()("kbnQueryBar",{"kbnQueryBar--withDatePicker":props.showDatePicker});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{className:classes,responsive:!!props.showDatePicker,gutterSize:"s",justifyContent:"flexEnd"},renderQueryInput(),renderSharingMetaFields(),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},renderUpdateButton()))}QueryBarTopRow.defaultProps={showQueryInput:true,showDatePicker:true,showAutoRefreshOnly:false}},220:function(module,exports,__webpack_require__){(function(global){(function(global,factory){true?module.exports=factory():undefined})(this,(function(){"use strict";var MapShim=function(){if(typeof Map!=="undefined"){return Map}function getIndex(arr,key){var result=-1;arr.some((function(entry,index){if(entry[0]===key){result=index;return true}return false}));return result}return function(){function class_1(){this.__entries__=[]}Object.defineProperty(class_1.prototype,"size",{get:function(){return this.__entries__.length},enumerable:true,configurable:true});class_1.prototype.get=function(key){var index=getIndex(this.__entries__,key);var entry=this.__entries__[index];return entry&&entry[1]};class_1.prototype.set=function(key,value){var index=getIndex(this.__entries__,key);if(~index){this.__entries__[index][1]=value}else{this.__entries__.push([key,value])}};class_1.prototype.delete=function(key){var entries=this.__entries__;var index=getIndex(entries,key);if(~index){entries.splice(index,1)}};class_1.prototype.has=function(key){return!!~getIndex(this.__entries__,key)};class_1.prototype.clear=function(){this.__entries__.splice(0)};class_1.prototype.forEach=function(callback,ctx){if(ctx===void 0){ctx=null}for(var _i=0,_a=this.__entries__;_i<_a.length;_i++){var entry=_a[_i];callback.call(ctx,entry[1],entry[0])}};return class_1}()}();var isBrowser=typeof window!=="undefined"&&typeof document!=="undefined"&&window.document===document;var global$1=function(){if(typeof global!=="undefined"&&global.Math===Math){return global}if(typeof self!=="undefined"&&self.Math===Math){return self}if(typeof window!=="undefined"&&window.Math===Math){return window}return Function("return this")()}();var requestAnimationFrame$1=function(){if(typeof requestAnimationFrame==="function"){return requestAnimationFrame.bind(global$1)}return function(callback){return setTimeout((function(){return callback(Date.now())}),1e3/60)}}();var trailingTimeout=2;function throttle(callback,delay){var leadingCall=false,trailingCall=false,lastCallTime=0;function resolvePending(){if(leadingCall){leadingCall=false;callback()}if(trailingCall){proxy()}}function timeoutCallback(){requestAnimationFrame$1(resolvePending)}function proxy(){var timeStamp=Date.now();if(leadingCall){if(timeStamp-lastCallTime<trailingTimeout){return}trailingCall=true}else{leadingCall=true;trailingCall=false;setTimeout(timeoutCallback,delay)}lastCallTime=timeStamp}return proxy}var REFRESH_DELAY=20;var transitionKeys=["top","right","bottom","left","width","height","size","weight"];var mutationObserverSupported=typeof MutationObserver!=="undefined";var ResizeObserverController=function(){function ResizeObserverController(){this.connected_=false;this.mutationEventsAdded_=false;this.mutationsObserver_=null;this.observers_=[];this.onTransitionEnd_=this.onTransitionEnd_.bind(this);this.refresh=throttle(this.refresh.bind(this),REFRESH_DELAY)}ResizeObserverController.prototype.addObserver=function(observer){if(!~this.observers_.indexOf(observer)){this.observers_.push(observer)}if(!this.connected_){this.connect_()}};ResizeObserverController.prototype.removeObserver=function(observer){var observers=this.observers_;var index=observers.indexOf(observer);if(~index){observers.splice(index,1)}if(!observers.length&&this.connected_){this.disconnect_()}};ResizeObserverController.prototype.refresh=function(){var changesDetected=this.updateObservers_();if(changesDetected){this.refresh()}};ResizeObserverController.prototype.updateObservers_=function(){var activeObservers=this.observers_.filter((function(observer){return observer.gatherActive(),observer.hasActive()}));activeObservers.forEach((function(observer){return observer.broadcastActive()}));return activeObservers.length>0};ResizeObserverController.prototype.connect_=function(){if(!isBrowser||this.connected_){return}document.addEventListener("transitionend",this.onTransitionEnd_);window.addEventListener("resize",this.refresh);if(mutationObserverSupported){this.mutationsObserver_=new MutationObserver(this.refresh);this.mutationsObserver_.observe(document,{attributes:true,childList:true,characterData:true,subtree:true})}else{document.addEventListener("DOMSubtreeModified",this.refresh);this.mutationEventsAdded_=true}this.connected_=true};ResizeObserverController.prototype.disconnect_=function(){if(!isBrowser||!this.connected_){return}document.removeEventListener("transitionend",this.onTransitionEnd_);window.removeEventListener("resize",this.refresh);if(this.mutationsObserver_){this.mutationsObserver_.disconnect()}if(this.mutationEventsAdded_){document.removeEventListener("DOMSubtreeModified",this.refresh)}this.mutationsObserver_=null;this.mutationEventsAdded_=false;this.connected_=false};ResizeObserverController.prototype.onTransitionEnd_=function(_a){var _b=_a.propertyName,propertyName=_b===void 0?"":_b;var isReflowProperty=transitionKeys.some((function(key){return!!~propertyName.indexOf(key)}));if(isReflowProperty){this.refresh()}};ResizeObserverController.getInstance=function(){if(!this.instance_){this.instance_=new ResizeObserverController}return this.instance_};ResizeObserverController.instance_=null;return ResizeObserverController}();var defineConfigurable=function(target,props){for(var _i=0,_a=Object.keys(props);_i<_a.length;_i++){var key=_a[_i];Object.defineProperty(target,key,{value:props[key],enumerable:false,writable:false,configurable:true})}return target};var getWindowOf=function(target){var ownerGlobal=target&&target.ownerDocument&&target.ownerDocument.defaultView;return ownerGlobal||global$1};var emptyRect=createRectInit(0,0,0,0);function toFloat(value){return parseFloat(value)||0}function getBordersSize(styles){var positions=[];for(var _i=1;_i<arguments.length;_i++){positions[_i-1]=arguments[_i]}return positions.reduce((function(size,position){var value=styles["border-"+position+"-width"];return size+toFloat(value)}),0)}function getPaddings(styles){var positions=["top","right","bottom","left"];var paddings={};for(var _i=0,positions_1=positions;_i<positions_1.length;_i++){var position=positions_1[_i];var value=styles["padding-"+position];paddings[position]=toFloat(value)}return paddings}function getSVGContentRect(target){var bbox=target.getBBox();return createRectInit(0,0,bbox.width,bbox.height)}function getHTMLElementContentRect(target){var clientWidth=target.clientWidth,clientHeight=target.clientHeight;if(!clientWidth&&!clientHeight){return emptyRect}var styles=getWindowOf(target).getComputedStyle(target);var paddings=getPaddings(styles);var horizPad=paddings.left+paddings.right;var vertPad=paddings.top+paddings.bottom;var width=toFloat(styles.width),height=toFloat(styles.height);if(styles.boxSizing==="border-box"){if(Math.round(width+horizPad)!==clientWidth){width-=getBordersSize(styles,"left","right")+horizPad}if(Math.round(height+vertPad)!==clientHeight){height-=getBordersSize(styles,"top","bottom")+vertPad}}if(!isDocumentElement(target)){var vertScrollbar=Math.round(width+horizPad)-clientWidth;var horizScrollbar=Math.round(height+vertPad)-clientHeight;if(Math.abs(vertScrollbar)!==1){width-=vertScrollbar}if(Math.abs(horizScrollbar)!==1){height-=horizScrollbar}}return createRectInit(paddings.left,paddings.top,width,height)}var isSVGGraphicsElement=function(){if(typeof SVGGraphicsElement!=="undefined"){return function(target){return target instanceof getWindowOf(target).SVGGraphicsElement}}return function(target){return target instanceof getWindowOf(target).SVGElement&&typeof target.getBBox==="function"}}();function isDocumentElement(target){return target===getWindowOf(target).document.documentElement}function getContentRect(target){if(!isBrowser){return emptyRect}if(isSVGGraphicsElement(target)){return getSVGContentRect(target)}return getHTMLElementContentRect(target)}function createReadOnlyRect(_a){var x=_a.x,y=_a.y,width=_a.width,height=_a.height;var Constr=typeof DOMRectReadOnly!=="undefined"?DOMRectReadOnly:Object;var rect=Object.create(Constr.prototype);defineConfigurable(rect,{x:x,y:y,width:width,height:height,top:y,right:x+width,bottom:height+y,left:x});return rect}function createRectInit(x,y,width,height){return{x:x,y:y,width:width,height:height}}var ResizeObservation=function(){function ResizeObservation(target){this.broadcastWidth=0;this.broadcastHeight=0;this.contentRect_=createRectInit(0,0,0,0);this.target=target}ResizeObservation.prototype.isActive=function(){var rect=getContentRect(this.target);this.contentRect_=rect;return rect.width!==this.broadcastWidth||rect.height!==this.broadcastHeight};ResizeObservation.prototype.broadcastRect=function(){var rect=this.contentRect_;this.broadcastWidth=rect.width;this.broadcastHeight=rect.height;return rect};return ResizeObservation}();var ResizeObserverEntry=function(){function ResizeObserverEntry(target,rectInit){var contentRect=createReadOnlyRect(rectInit);defineConfigurable(this,{target:target,contentRect:contentRect})}return ResizeObserverEntry}();var ResizeObserverSPI=function(){function ResizeObserverSPI(callback,controller,callbackCtx){this.activeObservations_=[];this.observations_=new MapShim;if(typeof callback!=="function"){throw new TypeError("The callback provided as parameter 1 is not a function.")}this.callback_=callback;this.controller_=controller;this.callbackCtx_=callbackCtx}ResizeObserverSPI.prototype.observe=function(target){if(!arguments.length){throw new TypeError("1 argument required, but only 0 present.")}if(typeof Element==="undefined"||!(Element instanceof Object)){return}if(!(target instanceof getWindowOf(target).Element)){throw new TypeError('parameter 1 is not of type "Element".')}var observations=this.observations_;if(observations.has(target)){return}observations.set(target,new ResizeObservation(target));this.controller_.addObserver(this);this.controller_.refresh()};ResizeObserverSPI.prototype.unobserve=function(target){if(!arguments.length){throw new TypeError("1 argument required, but only 0 present.")}if(typeof Element==="undefined"||!(Element instanceof Object)){return}if(!(target instanceof getWindowOf(target).Element)){throw new TypeError('parameter 1 is not of type "Element".')}var observations=this.observations_;if(!observations.has(target)){return}observations.delete(target);if(!observations.size){this.controller_.removeObserver(this)}};ResizeObserverSPI.prototype.disconnect=function(){this.clearActive();this.observations_.clear();this.controller_.removeObserver(this)};ResizeObserverSPI.prototype.gatherActive=function(){var _this=this;this.clearActive();this.observations_.forEach((function(observation){if(observation.isActive()){_this.activeObservations_.push(observation)}}))};ResizeObserverSPI.prototype.broadcastActive=function(){if(!this.hasActive()){return}var ctx=this.callbackCtx_;var entries=this.activeObservations_.map((function(observation){return new ResizeObserverEntry(observation.target,observation.broadcastRect())}));this.callback_.call(ctx,entries,ctx);this.clearActive()};ResizeObserverSPI.prototype.clearActive=function(){this.activeObservations_.splice(0)};ResizeObserverSPI.prototype.hasActive=function(){return this.activeObservations_.length>0};return ResizeObserverSPI}();var observers=typeof WeakMap!=="undefined"?new WeakMap:new MapShim;var ResizeObserver=function(){function ResizeObserver(callback){if(!(this instanceof ResizeObserver)){throw new TypeError("Cannot call a class as a function.")}if(!arguments.length){throw new TypeError("1 argument required, but only 0 present.")}var controller=ResizeObserverController.getInstance();var observer=new ResizeObserverSPI(callback,controller,this);observers.set(this,observer)}return ResizeObserver}();["observe","unobserve","disconnect"].forEach((function(method){ResizeObserver.prototype[method]=function(){var _a;return(_a=observers.get(this))[method].apply(_a,arguments)}}));var index=function(){if(typeof global$1.ResizeObserver!=="undefined"){return global$1.ResizeObserver}return ResizeObserver}();return index}))}).call(this,__webpack_require__(100))}}]);