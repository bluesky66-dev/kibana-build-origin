/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements. 
 * Licensed under the Elastic License 2.0; you may not use this file except in compliance with the Elastic License 2.0. */
(window["ml_bundle_jsonpfunction"]=window["ml_bundle_jsonpfunction"]||[]).push([[8,20],Array(63).concat([function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"d",(function(){return checkGetManagementMlJobsResolver}));__webpack_require__.d(__webpack_exports__,"c",(function(){return checkGetJobsCapabilitiesResolver}));__webpack_require__.d(__webpack_exports__,"a",(function(){return checkCreateJobsCapabilitiesResolver}));__webpack_require__.d(__webpack_exports__,"b",(function(){return checkFindFileStructurePrivilegeResolver}));__webpack_require__.d(__webpack_exports__,"e",(function(){return checkPermission}));__webpack_require__.d(__webpack_exports__,"f",(function(){return createPermissionFailureMessage}));var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);var license=__webpack_require__(85);var capabilities=__webpack_require__(217);var ml_api_service=__webpack_require__(59);var upgrade_service=__webpack_require__(288);function getCapabilities(){return new Promise((resolve,reject)=>{ml_api_service["ml"].checkMlCapabilities().then(resp=>{if(resp.upgradeInProgress===true){Object(upgrade_service["b"])(true)}resolve(resp)}).catch(()=>{reject()})})}function getManageMlCapabilities(){return new Promise((resolve,reject)=>{ml_api_service["ml"].checkManageMLCapabilities().then(resp=>{if(resp.upgradeInProgress===true){Object(upgrade_service["b"])(true)}resolve(resp)}).catch(()=>{reject()})})}let _capabilities=Object(capabilities["d"])();function checkGetManagementMlJobsResolver(){return new Promise((resolve,reject)=>{getManageMlCapabilities().then(({capabilities:capabilities,isPlatinumOrTrialLicense:isPlatinumOrTrialLicense,mlFeatureEnabledInSpace:mlFeatureEnabledInSpace})=>{_capabilities=capabilities;const isManageML=Object.values(_capabilities).every(p=>p===true);if(isManageML===true&&isPlatinumOrTrialLicense===true){return resolve({mlFeatureEnabledInSpace:mlFeatureEnabledInSpace})}else{return reject()}}).catch(e=>reject())})}function checkGetJobsCapabilitiesResolver(redirectToMlAccessDeniedPage){return new Promise((resolve,reject)=>{getCapabilities().then(async({capabilities:capabilities,isPlatinumOrTrialLicense:isPlatinumOrTrialLicense})=>{_capabilities=capabilities;if(_capabilities.canGetJobs||isPlatinumOrTrialLicense===false){return resolve(_capabilities)}else{await redirectToMlAccessDeniedPage();return reject()}}).catch(async e=>{await redirectToMlAccessDeniedPage();return reject()})})}function checkCreateJobsCapabilitiesResolver(redirectToJobsManagementPage){return new Promise((resolve,reject)=>{getCapabilities().then(async({capabilities:capabilities,isPlatinumOrTrialLicense:isPlatinumOrTrialLicense})=>{_capabilities=capabilities;if(_capabilities.canCreateJob||isPlatinumOrTrialLicense===false){return resolve(_capabilities)}else{await redirectToJobsManagementPage();return reject()}}).catch(async e=>{await redirectToJobsManagementPage();return reject()})})}function checkFindFileStructurePrivilegeResolver(redirectToMlAccessDeniedPage){return new Promise((resolve,reject)=>{getCapabilities().then(async({capabilities:capabilities})=>{_capabilities=capabilities;if(_capabilities.canFindFileStructure){return resolve(_capabilities)}else{await redirectToMlAccessDeniedPage();return reject()}}).catch(async e=>{await redirectToMlAccessDeniedPage();return reject()})})}function checkPermission(capability){const licenseHasExpired=Object(license["c"])();return _capabilities[capability]===true&&licenseHasExpired!==true}function createPermissionFailureMessage(privilegeType){let message="";const licenseHasExpired=Object(license["c"])();if(licenseHasExpired){message=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.privilege.licenseHasExpiredTooltip",{defaultMessage:"Your license has expired."})}else if(privilegeType==="canCreateJob"){message=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.privilege.noPermission.createMLJobsTooltip",{defaultMessage:"You do not have permission to create Machine Learning jobs."})}else if(privilegeType==="canStartStopDatafeed"){message=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.privilege.noPermission.startOrStopDatafeedsTooltip",{defaultMessage:"You do not have permission to start or stop datafeeds."})}else if(privilegeType==="canUpdateJob"){message=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.privilege.noPermission.editJobsTooltip",{defaultMessage:"You do not have permission to edit jobs."})}else if(privilegeType==="canDeleteJob"){message=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.privilege.noPermission.deleteJobsTooltip",{defaultMessage:"You do not have permission to delete jobs."})}else if(privilegeType==="canCreateCalendar"){message=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.privilege.noPermission.createCalendarsTooltip",{defaultMessage:"You do not have permission to create calendars."})}else if(privilegeType==="canDeleteCalendar"){message=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.privilege.noPermission.deleteCalendarsTooltip",{defaultMessage:"You do not have permission to delete calendars."})}else if(privilegeType==="canForecastJob"){message=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.privilege.noPermission.runForecastsTooltip",{defaultMessage:"You do not have permission to run forecasts."})}return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.privilege.pleaseContactAdministratorTooltip",{defaultMessage:"{message} Please contact your administrator.",values:{message:message}})}},,,,,,,,,,function(module,exports,__webpack_require__){var lodash;if(true){try{lodash={cloneDeep:__webpack_require__(607),constant:__webpack_require__(242),defaults:__webpack_require__(608),each:__webpack_require__(323),filter:__webpack_require__(326),find:__webpack_require__(609),flatten:__webpack_require__(353),forEach:__webpack_require__(324),forIn:__webpack_require__(616),has:__webpack_require__(337),isUndefined:__webpack_require__(338),last:__webpack_require__(617),map:__webpack_require__(339),mapValues:__webpack_require__(618),max:__webpack_require__(619),merge:__webpack_require__(621),min:__webpack_require__(627),minBy:__webpack_require__(628),now:__webpack_require__(629),pick:__webpack_require__(630),range:__webpack_require__(635),reduce:__webpack_require__(341),sortBy:__webpack_require__(638),uniqueId:__webpack_require__(643),values:__webpack_require__(346),zipObject:__webpack_require__(644)}}catch(e){}}if(!lodash){lodash=window._}module.exports=lodash},,,,function(module,exports){var isArray=Array.isArray;module.exports=isArray},,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return checkMlNodesAvailable}));__webpack_require__.d(__webpack_exports__,"c",(function(){return getMlNodeCount}));__webpack_require__.d(__webpack_exports__,"e",(function(){return mlNodesAvailable}));__webpack_require__.d(__webpack_exports__,"b",(function(){return currentMlNodesAvailable}));__webpack_require__.d(__webpack_exports__,"d",(function(){return lazyMlNodesAvailable}));__webpack_require__.d(__webpack_exports__,"f",(function(){return permissionToViewMlNodeCount}));var _services_ml_api_service__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(59);let mlNodeCount=0;let lazyMlNodeCount=0;let userHasPermissionToViewMlNodeCount=false;async function checkMlNodesAvailable(redirectToJobsManagementPage){try{const{count:count,lazyNodeCount:lazyNodeCount}=await getMlNodeCount();if(count>0||lazyNodeCount>0){Promise.resolve()}else{throw Error("Cannot load count of ML nodes")}}catch(error){console.error(error);await redirectToJobsManagementPage();Promise.reject()}}async function getMlNodeCount(){try{const nodes=await _services_ml_api_service__WEBPACK_IMPORTED_MODULE_0__["ml"].mlNodeCount();mlNodeCount=nodes.count;lazyMlNodeCount=nodes.lazyNodeCount;userHasPermissionToViewMlNodeCount=true;return nodes}catch(error){mlNodeCount=0;if(error.statusCode===403){userHasPermissionToViewMlNodeCount=false}return{count:0,lazyNodeCount:0}}}function mlNodesAvailable(){return mlNodeCount!==0||lazyMlNodeCount!==0}function currentMlNodesAvailable(){return mlNodeCount!==0}function lazyMlNodesAvailable(){return lazyMlNodeCount!==0}function permissionToViewMlNodeCount(){return userHasPermissionToViewMlNodeCount}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"j",(function(){return getRichDetectors}));__webpack_require__.d(__webpack_exports__,"g",(function(){return createFieldOptions}));__webpack_require__.d(__webpack_exports__,"h",(function(){return createMlcategoryFieldOption}));__webpack_require__.d(__webpack_exports__,"f",(function(){return createDocCountFieldOption}));__webpack_require__.d(__webpack_exports__,"k",(function(){return isSparseDataJob}));__webpack_require__.d(__webpack_exports__,"e",(function(){return convertToMultiMetricJob}));__webpack_require__.d(__webpack_exports__,"d",(function(){return convertToAdvancedJob}));__webpack_require__.d(__webpack_exports__,"l",(function(){return resetJob}));__webpack_require__.d(__webpack_exports__,"a",(function(){return advancedStartDatafeed}));__webpack_require__.d(__webpack_exports__,"b",(function(){return aggFieldPairsCanBeCharted}));__webpack_require__.d(__webpack_exports__,"i",(function(){return getJobCreatorTitle}));__webpack_require__.d(__webpack_exports__,"c",(function(){return collectAggs}));var _kbn_i18n__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2);var _kbn_i18n__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__);var _services_new_job_capabilities_service__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(75);var _common_constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(79);var _common_constants_field_types__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(76);var _src_plugins_data_public__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(35);var _src_plugins_data_public__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(_src_plugins_data_public__WEBPACK_IMPORTED_MODULE_4__);var _common_types_fields__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(105);var _services_job_service__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(65);var _common_constants_new_job__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(68);const getFieldByIdFactory=additionalFields=>id=>{let field=_services_new_job_capabilities_service__WEBPACK_IMPORTED_MODULE_1__["c"].getFieldById(id);if(field===null){if(id===_common_constants_field_types__WEBPACK_IMPORTED_MODULE_3__["b"]){field=_common_types_fields__WEBPACK_IMPORTED_MODULE_5__["c"]}else if(additionalFields.length){field=additionalFields.find(f=>f.id===id)||null}}return field};function getRichDetectors(job,datafeed,additionalFields,advanced=false){const detectors=advanced?getDetectorsAdvanced(job,datafeed):getDetectors(job,datafeed);const getFieldById=getFieldByIdFactory(additionalFields);return detectors.map(d=>{let field=null;let byField=null;let overField=null;let partitionField=null;if(d.field_name!==undefined){field=getFieldById(d.field_name)}if(d.by_field_name!==undefined){byField=getFieldById(d.by_field_name)}if(d.over_field_name!==undefined){overField=getFieldById(d.over_field_name)}if(d.partition_field_name!==undefined){partitionField=getFieldById(d.partition_field_name)}return{agg:_services_new_job_capabilities_service__WEBPACK_IMPORTED_MODULE_1__["c"].getAggById(d.function),field:field,byField:byField,overField:overField,partitionField:partitionField,excludeFrequent:d.exclude_frequent||null,description:d.detector_description||null}})}function createFieldOptions(fields,additionalFields){return[...fields.filter(f=>f.id!==_common_types_fields__WEBPACK_IMPORTED_MODULE_5__["a"]).map(f=>({label:f.name})),...additionalFields.filter(f=>fields.some(f2=>f2.id===f.id)===false).map(f=>({label:f.id}))].sort((a,b)=>a.label.localeCompare(b.label))}function createMlcategoryFieldOption(categorizationFieldName){if(categorizationFieldName===null){return[]}return[{label:_common_constants_field_types__WEBPACK_IMPORTED_MODULE_3__["b"]}]}function createDocCountFieldOption(usingAggregations){return usingAggregations?[{label:_common_constants_field_types__WEBPACK_IMPORTED_MODULE_3__["a"]}]:[{label:_common_constants_field_types__WEBPACK_IMPORTED_MODULE_3__["e"]}]}function getDetectorsAdvanced(job,datafeed){return processFieldlessAggs(job.analysis_config.detectors)}function getDetectors(job,datafeed){let detectors=job.analysis_config.detectors;const sparseData=isSparseDataJob(job,datafeed);if(datafeed.aggregations!==undefined&&job.analysis_config.detectors[0].function===_common_constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].NON_ZERO_COUNT&&sparseData===false){var _datafeed$aggregation,_datafeed$aggregation2,_datafeed$aggregation3,_datafeed$aggregation4,_datafeed$aggregation5;const field=datafeed===null||datafeed===void 0?void 0:(_datafeed$aggregation=datafeed.aggregations)===null||_datafeed$aggregation===void 0?void 0:(_datafeed$aggregation2=_datafeed$aggregation.buckets)===null||_datafeed$aggregation2===void 0?void 0:(_datafeed$aggregation3=_datafeed$aggregation2.aggregations)===null||_datafeed$aggregation3===void 0?void 0:(_datafeed$aggregation4=_datafeed$aggregation3.dc_region)===null||_datafeed$aggregation4===void 0?void 0:(_datafeed$aggregation5=_datafeed$aggregation4.cardinality)===null||_datafeed$aggregation5===void 0?void 0:_datafeed$aggregation5.field;if(field!==undefined){detectors=[{function:_common_constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].DISTINCT_COUNT,field_name:field}]}}else{detectors=processFieldlessAggs(detectors);detectors=detectors.map(d=>{switch(d.function){case _common_constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].NON_ZERO_COUNT:return{...d,field_name:_common_types_fields__WEBPACK_IMPORTED_MODULE_5__["a"],function:_common_constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].COUNT};case _common_constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].HIGH_NON_ZERO_COUNT:return{...d,field_name:_common_types_fields__WEBPACK_IMPORTED_MODULE_5__["a"],function:_common_constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].HIGH_COUNT};case _common_constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].LOW_NON_ZERO_COUNT:return{...d,field_name:_common_types_fields__WEBPACK_IMPORTED_MODULE_5__["a"],function:_common_constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].LOW_COUNT};case _common_constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].NON_NULL_SUM:return{...d,function:_common_constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].SUM};case _common_constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].HIGH_NON_NULL_SUM:return{...d,function:_common_constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].HIGH_SUM};case _common_constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].LOW_NON_NULL_SUM:return{...d,function:_common_constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].LOW_SUM};default:return d}})}return detectors}function processFieldlessAggs(detectors){return detectors.map(d=>{switch(d.function){case _common_constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].COUNT:case _common_constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].HIGH_COUNT:case _common_constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].LOW_COUNT:case _common_constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].NON_ZERO_COUNT:case _common_constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].HIGH_NON_ZERO_COUNT:case _common_constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].LOW_NON_ZERO_COUNT:case _common_constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].RARE:case _common_constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].FREQ_RARE:case _common_constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].TIME_OF_DAY:case _common_constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].TIME_OF_WEEK:return{...d,field_name:_common_types_fields__WEBPACK_IMPORTED_MODULE_5__["a"]};default:return d}})}function isSparseDataJob(job,datafeed){var _datafeed$aggregation6,_datafeed$aggregation7,_datafeed$aggregation8,_datafeed$aggregation9,_datafeed$aggregation10;const detectors=job.analysis_config.detectors;const distinctCountField=datafeed===null||datafeed===void 0?void 0:(_datafeed$aggregation6=datafeed.aggregations)===null||_datafeed$aggregation6===void 0?void 0:(_datafeed$aggregation7=_datafeed$aggregation6.buckets)===null||_datafeed$aggregation7===void 0?void 0:(_datafeed$aggregation8=_datafeed$aggregation7.aggregations)===null||_datafeed$aggregation8===void 0?void 0:(_datafeed$aggregation9=_datafeed$aggregation8.dc_region)===null||_datafeed$aggregation9===void 0?void 0:(_datafeed$aggregation10=_datafeed$aggregation9.cardinality)===null||_datafeed$aggregation10===void 0?void 0:_datafeed$aggregation10.field;if(distinctCountField===undefined){for(const detector of detectors){if(_common_constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["c"].includes(detector.function)){return true}}}return false}function stashJobForCloning(jobCreator,skipTimeRangeStep=false,includeTimeRange=false){var _jobCreator$createdBy;_services_job_service__WEBPACK_IMPORTED_MODULE_6__["a"].tempJobCloningObjects.job=jobCreator.jobConfig;_services_job_service__WEBPACK_IMPORTED_MODULE_6__["a"].tempJobCloningObjects.datafeed=jobCreator.datafeedConfig;_services_job_service__WEBPACK_IMPORTED_MODULE_6__["a"].tempJobCloningObjects.createdBy=(_jobCreator$createdBy=jobCreator.createdBy)!==null&&_jobCreator$createdBy!==void 0?_jobCreator$createdBy:undefined;_services_job_service__WEBPACK_IMPORTED_MODULE_6__["a"].tempJobCloningObjects.skipTimeRangeStep=skipTimeRangeStep;if(includeTimeRange===true){_services_job_service__WEBPACK_IMPORTED_MODULE_6__["a"].tempJobCloningObjects.start=jobCreator.start;_services_job_service__WEBPACK_IMPORTED_MODULE_6__["a"].tempJobCloningObjects.end=jobCreator.end}_services_job_service__WEBPACK_IMPORTED_MODULE_6__["a"].tempJobCloningObjects.calendars=jobCreator.calendars}function convertToMultiMetricJob(jobCreator,navigateToPath){jobCreator.createdBy=_common_constants_new_job__WEBPACK_IMPORTED_MODULE_7__["a"].MULTI_METRIC;jobCreator.modelPlot=false;stashJobForCloning(jobCreator,true,true);navigateToPath(`jobs/new_job/${_common_constants_new_job__WEBPACK_IMPORTED_MODULE_7__["f"].MULTI_METRIC}`,true)}function convertToAdvancedJob(jobCreator,navigateToPath){jobCreator.createdBy=null;stashJobForCloning(jobCreator,true,true);navigateToPath(`jobs/new_job/${_common_constants_new_job__WEBPACK_IMPORTED_MODULE_7__["f"].ADVANCED}`,true)}function resetJob(jobCreator,navigateToPath){jobCreator.jobId="";stashJobForCloning(jobCreator,true,true);navigateToPath("/jobs/new_job")}function advancedStartDatafeed(jobCreator,navigateToPath){if(jobCreator!==null){stashJobForCloning(jobCreator,false,false)}navigateToPath("/jobs")}function aggFieldPairsCanBeCharted(afs){return afs.some(a=>a.agg.dslName===null)===false}function getJobCreatorTitle(jobCreator){switch(jobCreator.type){case _common_constants_new_job__WEBPACK_IMPORTED_MODULE_7__["f"].SINGLE_METRIC:return _kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.newJob.wizard.jobCreatorTitle.singleMetric",{defaultMessage:"Single metric"});case _common_constants_new_job__WEBPACK_IMPORTED_MODULE_7__["f"].MULTI_METRIC:return _kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.newJob.wizard.jobCreatorTitle.multiMetric",{defaultMessage:"Multi-metric"});case _common_constants_new_job__WEBPACK_IMPORTED_MODULE_7__["f"].POPULATION:return _kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.newJob.wizard.jobCreatorTitle.population",{defaultMessage:"Population"});case _common_constants_new_job__WEBPACK_IMPORTED_MODULE_7__["f"].ADVANCED:return _kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.newJob.wizard.jobCreatorTitle.advanced",{defaultMessage:"Advanced"});case _common_constants_new_job__WEBPACK_IMPORTED_MODULE_7__["f"].CATEGORIZATION:return _kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.newJob.wizard.jobCreatorTitle.categorization",{defaultMessage:"Categorization"});default:return""}}function collectAggs(o,aggFields){for(const i in o){if(o[i]!==null&&typeof o[i]==="object"){if(i==="aggregations"||i==="aggs"){Object.keys(o[i]).forEach(k=>{if(k!=="aggregations"&&k!=="aggs"){aggFields.push({id:k,name:k,type:_src_plugins_data_public__WEBPACK_IMPORTED_MODULE_4__["ES_FIELD_TYPES"].KEYWORD,aggregatable:true})}})}collectAggs(o[i],aggFields)}}}},,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"e",(function(){return loadMlServerInfo}));__webpack_require__.d(__webpack_exports__,"b",(function(){return getNewJobDefaults}));__webpack_require__.d(__webpack_exports__,"c",(function(){return getNewJobLimits}));__webpack_require__.d(__webpack_exports__,"d",(function(){return isCloud}));__webpack_require__.d(__webpack_exports__,"a",(function(){return getCloudDeploymentId}));var _ml_api_service__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(59);let defaults={anomaly_detectors:{},datafeeds:{}};let limits={};const cloudInfo={cloudId:null,isCloud:false};async function loadMlServerInfo(){try{const resp=await _ml_api_service__WEBPACK_IMPORTED_MODULE_0__["ml"].mlInfo();defaults=resp.defaults;limits=resp.limits;cloudInfo.cloudId=resp.cloudId||null;cloudInfo.isCloud=resp.cloudId!==undefined;return{defaults:defaults,limits:limits,cloudId:cloudInfo}}catch(error){return{defaults:defaults,limits:limits,cloudId:cloudInfo}}}function getNewJobDefaults(){return defaults}function getNewJobLimits(){return limits}function getCloudId(){return cloudInfo.cloudId}function isCloud(){return cloudInfo.isCloud}function getCloudDeploymentId(){return cloudInfo.cloudId===null?null:extractDeploymentId(cloudInfo.cloudId)}function extractDeploymentId(cloudId){const tempCloudId=cloudId.replace(/^(.+)?:/,"");try{const matches=atob(tempCloudId).match(/^.+\$(.+)(?=\$)/);return matches!==null&&matches.length===2?matches[1]:null}catch(error){return null}}},,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return checkBasicLicense}));__webpack_require__.d(__webpack_exports__,"b",(function(){return checkFullLicense}));__webpack_require__.d(__webpack_exports__,"c",(function(){return hasLicenseExpired}));__webpack_require__.d(__webpack_exports__,"d",(function(){return isFullLicense}));__webpack_require__.d(__webpack_exports__,"e",(function(){return setLicenseCache}));var license=__webpack_require__(9);var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(33);var public_=__webpack_require__(36);var dependency_cache=__webpack_require__(18);let expiredLicenseBannerId;function showExpiredLicenseWarning(){if(expiredLicenseBannerId===undefined){const message=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.checkLicense.licenseHasExpiredMessage",{defaultMessage:"Your Machine Learning license has expired."});const overlays=Object(dependency_cache["f"])();expiredLicenseBannerId=overlays.banners.add(Object(public_["toMountPoint"])(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{iconType:"iInCircle",color:"warning",title:message})))}}class ml_client_license_MlClientLicense extends license["b"]{fullLicenseResolver(){if(this.isMlEnabled()===false||this.isMinimumLicense()===false){return redirectToKibana()}if(this.isFullLicense()===false){return redirectToBasic()}if(this.hasLicenseExpired()){showExpiredLicenseWarning()}return Promise.resolve()}basicLicenseResolver(){if(this.isMlEnabled()===false||this.isMinimumLicense()===false){return redirectToKibana()}if(this.hasLicenseExpired()){showExpiredLicenseWarning()}return Promise.resolve()}}function redirectToKibana(){window.location.href="/";return Promise.reject()}function redirectToBasic(){window.location.href="#/datavisualizer";return Promise.reject()}let mlLicense=null;function setLicenseCache(licensingSetup,postInitFunctions){mlLicense=new ml_client_license_MlClientLicense;mlLicense.setup(licensingSetup.license$,postInitFunctions);return mlLicense}async function checkFullLicense(){if(mlLicense===null){console.error("ML Licensing not initialized");return Promise.reject()}return mlLicense.fullLicenseResolver()}async function checkBasicLicense(){if(mlLicense===null){console.error("ML Licensing not initialized");return Promise.reject()}return mlLicense.basicLicenseResolver()}function hasLicenseExpired(){return mlLicense!==null&&mlLicense.hasLicenseExpired()}function isFullLicense(){return mlLicense!==null&&mlLicense.isFullLicense()}},,,,,,,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"e",(function(){return isSingleMetricJobCreator}));__webpack_require__.d(__webpack_exports__,"c",(function(){return isMultiMetricJobCreator}));__webpack_require__.d(__webpack_exports__,"d",(function(){return isPopulationJobCreator}));__webpack_require__.d(__webpack_exports__,"a",(function(){return isAdvancedJobCreator}));__webpack_require__.d(__webpack_exports__,"b",(function(){return isCategorizationJobCreator}));__webpack_require__.d(__webpack_exports__,"f",(function(){return jobCreatorFactory}));var external_kbnSharedDeps_Rxjs_=__webpack_require__(19);var external_kbnSharedDeps_Lodash_=__webpack_require__(5);var aggregation_types=__webpack_require__(79);var public_=__webpack_require__(35);var fields_utils=__webpack_require__(186);var default_configs=__webpack_require__(133);var job_service=__webpack_require__(65);var ml_api_service=__webpack_require__(59);var states=__webpack_require__(101);function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const REFRESH_INTERVAL_MS=250;const NODE_ASSIGNMENT_CHECK_REFRESH_INTERVAL_MS=2e3;const TARGET_PROGRESS_DELTA=2;const REFRESH_RATE_ADJUSTMENT_DELAY_MS=2e3;class job_runner_JobRunner{constructor(jobCreator){_defineProperty(this,"_jobId",void 0);_defineProperty(this,"_datafeedId",void 0);_defineProperty(this,"_start",0);_defineProperty(this,"_end",0);_defineProperty(this,"_datafeedState",states["a"].STOPPED);_defineProperty(this,"_refreshInterval",REFRESH_INTERVAL_MS);_defineProperty(this,"_progress$",void 0);_defineProperty(this,"_percentageComplete",0);_defineProperty(this,"_stopRefreshPoll",void 0);_defineProperty(this,"_subscribers",void 0);_defineProperty(this,"_datafeedStartTime",0);_defineProperty(this,"_performRefreshRateAdjustment",false);_defineProperty(this,"_jobAssignedToNode",false);_defineProperty(this,"_jobAssignedToNode$",void 0);this._jobId=jobCreator.jobId;this._datafeedId=jobCreator.datafeedId;this._start=jobCreator.start;this._end=jobCreator.end;this._percentageComplete=0;this._stopRefreshPoll=jobCreator.stopAllRefreshPolls;this._progress$=new external_kbnSharedDeps_Rxjs_["BehaviorSubject"](this._percentageComplete);this._jobAssignedToNode$=new external_kbnSharedDeps_Rxjs_["BehaviorSubject"](this._jobAssignedToNode);this._subscribers=jobCreator.subscribers}get datafeedState(){return this._datafeedState}set refreshInterval(v){this._refreshInterval=v}resetInterval(){this._refreshInterval=REFRESH_INTERVAL_MS}async openJob(){try{const{node:node}=await job_service["a"].openJob(this._jobId);this._jobAssignedToNode=node!==undefined&&node.length>0;this._jobAssignedToNode$.next(this._jobAssignedToNode)}catch(error){throw error}}async _startDatafeed(start,end,pollProgress){try{this._datafeedStartTime=Date.now();const subscriptions=pollProgress===true?this._subscribers.map(s=>this._progress$.subscribe(s)):[];await this.openJob();const{started:started}=await job_service["a"].startDatafeed(this._datafeedId,this._jobId,start,end);this._datafeedState=states["a"].STARTED;this._percentageComplete=0;const checkProgress=async()=>{const{isRunning:isRunning,progress:prog,isJobClosed:isJobClosed}=await this.getProgress();const progress=prog===100&&(isRunning===true||isJobClosed===false)?prog-1:prog;this._adjustRefreshInterval(progress);this._percentageComplete=progress;this._progress$.next(this._percentageComplete);if((isRunning===true||isJobClosed===false)&&this._stopRefreshPoll.stop===false){setTimeout(async()=>{if(this._stopRefreshPoll.stop===false){await checkProgress()}},this._refreshInterval)}else{this._progress$.next(100);subscriptions.forEach(s=>s.unsubscribe())}};const checkJobIsAssigned=async()=>{this._jobAssignedToNode=await this._isJobAssigned();this._jobAssignedToNode$.next(this._jobAssignedToNode);if(this._jobAssignedToNode===true){await checkProgress()}else{setTimeout(async()=>{if(this._stopRefreshPoll.stop===false){await checkJobIsAssigned()}},NODE_ASSIGNMENT_CHECK_REFRESH_INTERVAL_MS)}};if(pollProgress===true){if(this._jobAssignedToNode===true){await checkProgress()}else{await checkJobIsAssigned()}}return started}catch(error){throw error}}_adjustRefreshInterval(progress){if(this._performRefreshRateAdjustment===false){const timeDeltaMs=Date.now()-this._datafeedStartTime;if(timeDeltaMs>REFRESH_RATE_ADJUSTMENT_DELAY_MS){this._performRefreshRateAdjustment=true}else{return}}const progressDelta=progress-this._percentageComplete;if(progressDelta!==0){this._refreshInterval=Math.floor(this._refreshInterval*(TARGET_PROGRESS_DELTA/progressDelta));if(this._refreshInterval<REFRESH_INTERVAL_MS){this._refreshInterval=REFRESH_INTERVAL_MS}}}async _isJobAssigned(){const{jobs:jobs}=await ml_api_service["ml"].getJobStats({jobId:this._jobId});return jobs.length>0&&jobs[0].node!==undefined}async startDatafeed(){return await this._startDatafeed(this._start,this._end,true)}async startDatafeedInRealTime(continueJob){const start=continueJob?this._end:this._start;return await this._startDatafeed(start,undefined,false)}async getProgress(){return await ml_api_service["ml"].jobs.getLookBackProgress(this._jobId,this._start,this._end)}subscribeToProgress(func){this._progress$.subscribe(func)}async isRunning(){const{isRunning:isRunning}=await this.getProgress();return isRunning}isJobAssignedToNode(){return this._jobAssignedToNode}subscribeToJobAssignment(func){return this._jobAssignedToNode$.subscribe(func)}}var new_job=__webpack_require__(68);var general=__webpack_require__(81);function filterRuntimeMappings(job,datafeed){if(datafeed.runtime_mappings===undefined){return{runtime_mappings:{},discarded_mappings:{}}}const usedFields=findFieldsInJob(job,datafeed);const{runtimeMappings:runtimeMappings,discardedMappings:discardedMappings}=createMappings(datafeed.runtime_mappings,usedFields);return{runtime_mappings:runtimeMappings,discarded_mappings:discardedMappings}}function findFieldsInJob(job,datafeed){var _datafeed$aggregation;const usedFields=new Set;job.analysis_config.detectors.forEach(d=>{if(d.field_name!==undefined){usedFields.add(d.field_name)}if(d.by_field_name!==undefined){usedFields.add(d.by_field_name)}if(d.over_field_name!==undefined){usedFields.add(d.over_field_name)}if(d.partition_field_name!==undefined){usedFields.add(d.partition_field_name)}});if(job.analysis_config.categorization_field_name!==undefined){usedFields.add(job.analysis_config.categorization_field_name)}if(job.analysis_config.summary_count_field_name!==undefined){usedFields.add(job.analysis_config.summary_count_field_name)}if(job.analysis_config.influencers!==undefined){job.analysis_config.influencers.forEach(i=>usedFields.add(i))}const aggs=(_datafeed$aggregation=datafeed.aggregations)!==null&&_datafeed$aggregation!==void 0?_datafeed$aggregation:datafeed.aggs;if(aggs!==undefined){findFieldsInAgg(aggs).forEach(f=>usedFields.add(f))}return[...usedFields]}function findFieldsInAgg(obj){const fields=[];Object.entries(obj).forEach(([key,val])=>{if(typeof val==="object"&&val!==null){fields.push(...findFieldsInAgg(val))}else if(typeof val==="string"&&key==="field"){fields.push(val)}});return fields}function createMappings(rm,usedFieldNames){return{runtimeMappings:usedFieldNames.reduce((acc,cur)=>{if(rm[cur]!==undefined){acc[cur]=rm[cur]}return acc},{}),discardedMappings:Object.keys(rm).reduce((acc,cur)=>{if(usedFieldNames.includes(cur)===false&&rm[cur]!==undefined){acc[cur]=rm[cur]}return acc},{})}}var parse_interval=__webpack_require__(22);var calendar_service=__webpack_require__(289);var datafeed_utils=__webpack_require__(221);function job_creator_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class job_creator_JobCreator{constructor(indexPattern,savedSearch,query){job_creator_defineProperty(this,"_type",new_job["f"].SINGLE_METRIC);job_creator_defineProperty(this,"_indexPattern",void 0);job_creator_defineProperty(this,"_savedSearch",void 0);job_creator_defineProperty(this,"_indexPatternTitle","");job_creator_defineProperty(this,"_job_config",void 0);job_creator_defineProperty(this,"_calendars",void 0);job_creator_defineProperty(this,"_datafeed_config",void 0);job_creator_defineProperty(this,"_detectors",void 0);job_creator_defineProperty(this,"_influencers",void 0);job_creator_defineProperty(this,"_bucketSpanMs",0);job_creator_defineProperty(this,"_useDedicatedIndex",false);job_creator_defineProperty(this,"_start",0);job_creator_defineProperty(this,"_end",0);job_creator_defineProperty(this,"_subscribers",[]);job_creator_defineProperty(this,"_aggs",[]);job_creator_defineProperty(this,"_fields",[]);job_creator_defineProperty(this,"_scriptFields",[]);job_creator_defineProperty(this,"_runtimeFields",[]);job_creator_defineProperty(this,"_runtimeMappings",null);job_creator_defineProperty(this,"_filterRuntimeMappingsOnSave",true);job_creator_defineProperty(this,"_aggregationFields",[]);job_creator_defineProperty(this,"_sparseData",false);job_creator_defineProperty(this,"_stopAllRefreshPolls",{stop:false});job_creator_defineProperty(this,"_wizardInitialized$",new external_kbnSharedDeps_Rxjs_["BehaviorSubject"](false));job_creator_defineProperty(this,"wizardInitialized$",this._wizardInitialized$.asObservable());this._indexPattern=indexPattern;this._savedSearch=savedSearch;this._indexPatternTitle=indexPattern.title;this._job_config=Object(default_configs["c"])();this._calendars=[];this._datafeed_config=Object(default_configs["b"])(this._indexPatternTitle);this._detectors=this._job_config.analysis_config.detectors;this._influencers=this._job_config.analysis_config.influencers;if(typeof indexPattern.timeFieldName==="string"){this._job_config.data_description.time_field=indexPattern.timeFieldName}this._extractRuntimeMappings();this._datafeed_config.query=query}get type(){return this._type}get indexPatternTitle(){return this._indexPatternTitle}_addDetector(detector,agg,field){this._detectors.push(detector);this._aggs.push(agg);this._fields.push(field);this._updateSparseDataDetectors()}_editDetector(detector,agg,field,index){if(this._detectors[index]!==undefined){this._detectors[index]=detector;this._aggs[index]=agg;this._fields[index]=field;this._updateSparseDataDetectors()}}_removeDetector(index){this._detectors.splice(index,1);this._aggs.splice(index,1);this._fields.splice(index,1)}removeAllDetectors(){this._detectors.length=0;this._aggs.length=0;this._fields.length=0}get detectors(){return this._detectors}get aggregationsInDetectors(){return this._aggs}getAggregation(index){const agg=this._aggs[index];return agg!==undefined?agg:null}get aggregations(){return this._aggs}getField(index){const field=this._fields[index];return field!==undefined?field:null}get fields(){return this._fields}set bucketSpan(bucketSpan){this._job_config.analysis_config.bucket_span=bucketSpan;this._setBucketSpanMs(bucketSpan)}get bucketSpan(){return this._job_config.analysis_config.bucket_span}_setBucketSpanMs(bucketSpan){const bs=Object(parse_interval["a"])(bucketSpan,true);this._bucketSpanMs=bs===null?0:bs.asMilliseconds()}get bucketSpanMs(){return this._bucketSpanMs}addInfluencer(influencer){if(this._influencers.includes(influencer)===false){this._influencers.push(influencer)}}removeInfluencer(influencer){const idx=this._influencers.indexOf(influencer);if(idx!==-1){this._influencers.splice(idx,1)}}removeAllInfluencers(){this._influencers.length=0}get influencers(){return this._influencers}set jobId(jobId){this._job_config.job_id=jobId;this._datafeed_config.job_id=jobId;this._datafeed_config.datafeed_id=`datafeed-${jobId}`;if(this._useDedicatedIndex){this._job_config.results_index_name=jobId}}get jobId(){return this._job_config.job_id}get datafeedId(){return this._datafeed_config.datafeed_id}set description(description){this._job_config.description=description}get description(){return this._job_config.description}get groups(){return this._job_config.groups}set groups(groups){this._job_config.groups=groups}get calendars(){return this._calendars}set calendars(calendars){this._calendars=calendars}_initModelPlotConfig(){if(this._job_config.model_plot_config===undefined){this._job_config.model_plot_config={}}if(this._job_config.model_plot_config.enabled===undefined){this._job_config.model_plot_config.enabled=false}if(this._job_config.model_plot_config.annotations_enabled===undefined){this._job_config.model_plot_config.annotations_enabled=false}}set modelPlot(enable){this._initModelPlotConfig();this._job_config.model_plot_config.enabled=enable}get modelPlot(){return this._job_config.model_plot_config!==undefined&&this._job_config.model_plot_config.enabled===true}set modelChangeAnnotations(enable){this._initModelPlotConfig();this._job_config.model_plot_config.annotations_enabled=enable}get modelChangeAnnotations(){var _this$_job_config$mod;return((_this$_job_config$mod=this._job_config.model_plot_config)===null||_this$_job_config$mod===void 0?void 0:_this$_job_config$mod.annotations_enabled)===true}set useDedicatedIndex(enable){this._useDedicatedIndex=enable;if(enable){this._job_config.results_index_name=this._job_config.job_id}else{delete this._job_config.results_index_name}}get useDedicatedIndex(){return this._useDedicatedIndex}set modelMemoryLimit(mml){if(mml!==null){this._job_config.analysis_limits={model_memory_limit:mml}}else{delete this._job_config.analysis_limits}}get modelMemoryLimit(){if(this._job_config.analysis_limits&&this._job_config.analysis_limits.model_memory_limit!==undefined){return this._job_config.analysis_limits.model_memory_limit}else{return null}}set summaryCountFieldName(fieldName){if(fieldName!==null){this._job_config.analysis_config.summary_count_field_name=fieldName}else{delete this._job_config.analysis_config.summary_count_field_name}}get summaryCountFieldName(){return this._job_config.analysis_config.summary_count_field_name||null}set categorizationFieldName(fieldName){if(fieldName!==null){this._job_config.analysis_config.categorization_field_name=fieldName}else{delete this._job_config.analysis_config.categorization_field_name}}get categorizationFieldName(){return this._job_config.analysis_config.categorization_field_name||null}addCategorizationFilter(filter){if(this._job_config.analysis_config.categorization_filters===undefined){this._job_config.analysis_config.categorization_filters=[]}const filters=this._job_config.analysis_config.categorization_filters;if(filters.includes(filter)===false){filters.push(filter)}}removeCategorizationFilter(filter){const filters=this._job_config.analysis_config.categorization_filters;if(filters!==undefined){const idx=filters.indexOf(filter);if(idx!==-1){filters.splice(idx,1)}if(filters.length===0){this.removeCategorizationFilters()}}}removeCategorizationFilters(){delete this._job_config.analysis_config.categorization_filters}get categorizationFilters(){return this._job_config.analysis_config.categorization_filters||null}get timeFieldName(){return this._job_config.data_description.time_field}set timeFieldName(fieldName){this._job_config.data_description.time_field=fieldName}get sparseData(){return this._sparseData}set sparseData(sparseData){this._sparseData=sparseData;this._updateSparseDataDetectors()}_updateSparseDataDetectors(){this._detectors.forEach((d,i)=>{switch(this._aggs[i].id){case aggregation_types["b"].COUNT:d.function=this._sparseData?aggregation_types["b"].NON_ZERO_COUNT:aggregation_types["b"].COUNT;break;case aggregation_types["b"].HIGH_COUNT:d.function=this._sparseData?aggregation_types["b"].HIGH_NON_ZERO_COUNT:aggregation_types["b"].HIGH_COUNT;break;case aggregation_types["b"].LOW_COUNT:d.function=this._sparseData?aggregation_types["b"].LOW_NON_ZERO_COUNT:aggregation_types["b"].LOW_COUNT;break;case aggregation_types["b"].SUM:d.function=this._sparseData?aggregation_types["b"].NON_NULL_SUM:aggregation_types["b"].SUM;break;case aggregation_types["b"].HIGH_SUM:d.function=this._sparseData?aggregation_types["b"].HIGH_NON_NULL_SUM:aggregation_types["b"].HIGH_SUM;break;case aggregation_types["b"].LOW_SUM:d.function=this._sparseData?aggregation_types["b"].LOW_NON_NULL_SUM:aggregation_types["b"].LOW_SUM;break}})}async _updateCalendars(){if(this._calendars.length===0){return}for(const calendar of this._calendars){await calendar_service["a"].assignNewJobId(calendar,this.jobId)}}setTimeRange(start,end){this._start=start;this._end=end}get start(){return this._start}get end(){return this._end}get query(){return this._datafeed_config.query}set query(query){this._datafeed_config.query=query}get queryDelay(){return this._datafeed_config.query_delay||null}set queryDelay(queryDelay){if(queryDelay!==null){this._datafeed_config.query_delay=queryDelay}else{delete this._datafeed_config.query_delay}}get frequency(){return this._datafeed_config.frequency||null}set frequency(frequency){if(frequency!==null){this._datafeed_config.frequency=frequency}else{delete this._datafeed_config.frequency}}get scrollSize(){return this._datafeed_config.scroll_size||null}set scrollSize(scrollSize){if(scrollSize!==null){this._datafeed_config.scroll_size=scrollSize}else{delete this._datafeed_config.scroll_size}}get indices(){return this._datafeed_config.indices}get scriptFields(){return this._scriptFields}get runtimeMappings(){return this._runtimeMappings}get runtimeFields(){return this._runtimeFields}get aggregationFields(){return this._aggregationFields}get additionalFields(){return[...this._scriptFields,...this._runtimeFields,...this._aggregationFields]}get subscribers(){return this._subscribers}async createAndStartJob(){try{await this.createJob();await this.createDatafeed();const jobRunner=await this.startDatafeed();return jobRunner}catch(error){throw error}}async createJob(){try{const{success:success,resp:resp}=await job_service["a"].saveNewJob(this._job_config);await this._updateCalendars();if(success===true){return resp}else{throw resp}}catch(error){throw error}}async createDatafeed(){try{const tempDatafeed=this._getDatafeedWithFilteredRuntimeMappings();return await job_service["a"].saveNewDatafeed(tempDatafeed,this._job_config.job_id)}catch(error){throw error}}async startDatafeed(){const jobRunner=new job_runner_JobRunner(this);await jobRunner.startDatafeed();return jobRunner}_getDatafeedWithFilteredRuntimeMappings(){if(this._filterRuntimeMappingsOnSave===false){return this._datafeed_config}const{runtime_mappings:filteredRuntimeMappings}=filterRuntimeMappings(this._job_config,this._datafeed_config);return{...this._datafeed_config,runtime_mappings:Object.keys(filteredRuntimeMappings).length>0?filteredRuntimeMappings:undefined}}subscribeToProgress(func){this._subscribers.push(func)}get jobConfig(){return this._job_config}get datafeedConfig(){return this._datafeed_config}get stopAllRefreshPolls(){return this._stopAllRefreshPolls}forceStopRefreshPolls(){this._stopAllRefreshPolls.stop=true}_setCustomSetting(setting,value){if(value===null){if(this._job_config.custom_settings!==undefined&&this._job_config.custom_settings[setting]!==undefined){delete this._job_config.custom_settings[setting];if(Object.keys(this._job_config.custom_settings).length===0){delete this._job_config.custom_settings}}}else{if(this._job_config.custom_settings===undefined){this._job_config.custom_settings={[setting]:value}}else{this._job_config.custom_settings[setting]=value}}}_getCustomSetting(setting){if(this._job_config.custom_settings!==undefined&&this._job_config.custom_settings[setting]!==undefined){return this._job_config.custom_settings[setting]}return null}set createdBy(createdBy){this._setCustomSetting("created_by",createdBy)}get createdBy(){return this._getCustomSetting("created_by")}set customUrls(customUrls){this._setCustomSetting("custom_urls",customUrls)}get customUrls(){return this._getCustomSetting("custom_urls")}get formattedJobJson(){return JSON.stringify(this._job_config,null,2)}get formattedDatafeedJson(){return JSON.stringify(this._datafeed_config,null,2)}set filterRuntimeMappingsOnSave(filter){this._filterRuntimeMappingsOnSave=filter}get filterRuntimeMappingsOnSave(){return this._filterRuntimeMappingsOnSave}_initPerPartitionCategorization(){var _this$_job_config$ana,_this$_job_config$ana2;if(this._job_config.analysis_config.per_partition_categorization===undefined){this._job_config.analysis_config.per_partition_categorization={}}if(((_this$_job_config$ana=this._job_config.analysis_config.per_partition_categorization)===null||_this$_job_config$ana===void 0?void 0:_this$_job_config$ana.enabled)===undefined){this._job_config.analysis_config.per_partition_categorization.enabled=false}if(((_this$_job_config$ana2=this._job_config.analysis_config.per_partition_categorization)===null||_this$_job_config$ana2===void 0?void 0:_this$_job_config$ana2.stop_on_warn)===undefined){this._job_config.analysis_config.per_partition_categorization.stop_on_warn=false}}get perPartitionCategorization(){var _this$_job_config$ana3;return((_this$_job_config$ana3=this._job_config.analysis_config.per_partition_categorization)===null||_this$_job_config$ana3===void 0?void 0:_this$_job_config$ana3.enabled)===true}set perPartitionCategorization(enabled){this._initPerPartitionCategorization();this._job_config.analysis_config.per_partition_categorization.enabled=enabled}get perPartitionStopOnWarn(){var _this$_job_config$ana4;return((_this$_job_config$ana4=this._job_config.analysis_config.per_partition_categorization)===null||_this$_job_config$ana4===void 0?void 0:_this$_job_config$ana4.stop_on_warn)===true}set perPartitionStopOnWarn(enabled){this._initPerPartitionCategorization();this._job_config.analysis_config.per_partition_categorization.stop_on_warn=enabled}_extractRuntimeMappings(){const runtimeFieldMap=this._indexPattern.toSpec().runtimeFieldMap;if(runtimeFieldMap!==undefined){if(this._datafeed_config.runtime_mappings===undefined){this._datafeed_config.runtime_mappings={}}Object.entries(runtimeFieldMap).forEach(([key,val])=>{this._datafeed_config.runtime_mappings[key]=val})}this._populateRuntimeFields()}_populateRuntimeFields(){var _this$_datafeed_confi;this._runtimeFields=[];this._runtimeMappings=(_this$_datafeed_confi=this._datafeed_config.runtime_mappings)!==null&&_this$_datafeed_confi!==void 0?_this$_datafeed_confi:null;if(this._runtimeMappings!==null){const tempRuntimeFields=Object.entries(this._runtimeMappings).map(([id,runtimeField])=>({id:id,name:id,type:runtimeField.type,aggregatable:true,aggs:[],runtimeField:runtimeField}));const aggs=Object(external_kbnSharedDeps_Lodash_["cloneDeep"])([...aggregation_types["d"],...aggregation_types["e"]]);this._runtimeFields=Object(fields_utils["a"])(tempRuntimeFields,aggs,{}).fields}}_populateScriptFields(){this._scriptFields=[];if(this._datafeed_config.script_fields!==undefined){this._scriptFields=Object.keys(this._datafeed_config.script_fields).map(f=>({id:f,name:f,type:public_["ES_FIELD_TYPES"].KEYWORD,aggregatable:true}))}}_overrideConfigs(job,datafeed){this._job_config=job;this._datafeed_config=datafeed;this._detectors=this._job_config.analysis_config.detectors;this._influencers=this._job_config.analysis_config.influencers;if(this._job_config.groups===undefined){this._job_config.groups=[]}if(this._job_config.analysis_config.influencers!==undefined){this._job_config.analysis_config.influencers.forEach(i=>this.addInfluencer(i))}if(this._job_config.results_index_name!==undefined&&this._job_config.results_index_name!==new_job["g"]){this.useDedicatedIndex=true}this._populateScriptFields();this._populateRuntimeFields();this._aggregationFields=[];const aggs=Object(datafeed_utils["c"])(this._datafeed_config);if(aggs!==undefined){const aggBucketsName=Object(datafeed_utils["a"])(aggs);if(aggBucketsName!==undefined&&aggs[aggBucketsName]!==undefined){const buckets=aggs[aggBucketsName];Object(general["c"])(buckets,this._aggregationFields)}}}}function single_metric_job_creator_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class single_metric_job_creator_SingleMetricJobCreator extends job_creator_JobCreator{constructor(indexPattern,savedSearch,query){super(indexPattern,savedSearch,query);single_metric_job_creator_defineProperty(this,"_type",new_job["f"].SINGLE_METRIC);this.createdBy=new_job["a"].SINGLE_METRIC;this._wizardInitialized$.next(true)}setDetector(agg,field){const dtr=Object(default_configs["a"])(agg,field);if(this._detectors.length===0){this._addDetector(dtr,agg,field)}else{this._editDetector(dtr,agg,field,0)}this._createDatafeedAggregations()}set bucketSpan(bucketSpan){this._job_config.analysis_config.bucket_span=bucketSpan;this._setBucketSpanMs(bucketSpan);this._createDatafeedAggregations()}get bucketSpan(){return this._job_config.analysis_config.bucket_span}_createDatafeedAggregations(){if(this._detectors.length&&typeof this._job_config.analysis_config.bucket_span==="string"&&this._aggs.length>0){delete this._job_config.analysis_config.summary_count_field_name;delete this._datafeed_config.aggregations;const functionName=this._aggs[0].dslName;const timeField=this._job_config.data_description.time_field;const duration=Object(parse_interval["a"])(this._job_config.analysis_config.bucket_span,true);if(duration===null){return}const bucketSpanSeconds=duration.asSeconds();const interval=bucketSpanSeconds*1e3;let field=null;switch(functionName){case aggregation_types["a"].COUNT:this._job_config.analysis_config.summary_count_field_name="doc_count";this._datafeed_config.aggregations={buckets:{date_histogram:{field:timeField,fixed_interval:`${interval}ms`},aggregations:{[timeField]:{max:{field:timeField}}}}};break;case aggregation_types["a"].AVG:case aggregation_types["a"].SUM:case aggregation_types["a"].MIN:case aggregation_types["a"].MAX:field=this._fields[0];if(field!==null){const fieldName=field.name;this._job_config.analysis_config.summary_count_field_name="doc_count";this._datafeed_config.aggregations={buckets:{date_histogram:{field:timeField,fixed_interval:`${interval*.1}ms`},aggregations:{[fieldName]:{[functionName]:{field:fieldName}},[timeField]:{max:{field:timeField}}}}}}break;case aggregation_types["a"].CARDINALITY:field=this._fields[0];if(field!==null){const fieldName=field.name;this._job_config.analysis_config.summary_count_field_name=`dc_${fieldName}`;this._datafeed_config.aggregations={buckets:{date_histogram:{field:timeField,fixed_interval:`${interval}ms`},aggregations:{[timeField]:{max:{field:timeField}},[this._job_config.analysis_config.summary_count_field_name]:{[functionName]:{field:fieldName}}}}};const dtr=this._detectors[0];dtr.function=aggregation_types["b"].NON_ZERO_COUNT;dtr.detector_description=`${functionName} (${fieldName})`;delete dtr.field_name}break;default:break}}}get aggFieldPair(){if(this._aggs.length===0){return null}else{return{agg:this._aggs[0],field:this._fields[0]}}}cloneFromExistingJob(job,datafeed){this._overrideConfigs(job,datafeed);this.createdBy=new_job["a"].SINGLE_METRIC;this._sparseData=Object(general["k"])(job,datafeed);const detectors=Object(general["j"])(job,datafeed,this.additionalFields,false);this.removeAllDetectors();const dtr=detectors[0];if(detectors.length&&dtr.agg!==null&&dtr.field!==null){this.setDetector(dtr.agg,dtr.field)}}}function multi_metric_job_creator_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class multi_metric_job_creator_MultiMetricJobCreator extends job_creator_JobCreator{constructor(indexPattern,savedSearch,query){super(indexPattern,savedSearch,query);multi_metric_job_creator_defineProperty(this,"_splitField",null);multi_metric_job_creator_defineProperty(this,"_type",new_job["f"].MULTI_METRIC);this.createdBy=new_job["a"].MULTI_METRIC;this._wizardInitialized$.next(true)}setSplitField(field){this._splitField=field;if(this._splitField===null){this.removeSplitField()}else{for(let i=0;i<this._detectors.length;i++){this._detectors[i].partition_field_name=this._splitField.id}}}removeSplitField(){this._detectors.forEach(d=>{delete d.partition_field_name})}get splitField(){return this._splitField}addDetector(agg,field){const dtr=this._createDetector(agg,field);this._addDetector(dtr,agg,field)}editDetector(agg,field,index){const dtr=this._createDetector(agg,field);this._editDetector(dtr,agg,field,index)}_createDetector(agg,field){const dtr=Object(default_configs["a"])(agg,field);if(this._splitField!==null){dtr.partition_field_name=this._splitField.id}return dtr}removeDetector(index){this._removeDetector(index)}get aggFieldPairs(){return this.detectors.map((d,i)=>({field:this._fields[i],agg:this._aggs[i]}))}cloneFromExistingJob(job,datafeed){this._overrideConfigs(job,datafeed);this.createdBy=new_job["a"].MULTI_METRIC;this._sparseData=Object(general["k"])(job,datafeed);const detectors=Object(general["j"])(job,datafeed,this.additionalFields,false);if(datafeed.aggregations!==undefined){delete datafeed.aggregations;delete job.analysis_config.summary_count_field_name}this.removeAllDetectors();detectors.forEach((d,i)=>{const dtr=detectors[i];if(dtr.agg!==null&&dtr.field!==null){this.addDetector(dtr.agg,dtr.field)}});if(detectors.length){if(detectors[0].partitionField!==null){this.setSplitField(detectors[0].partitionField)}}}}function population_job_creator_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class population_job_creator_PopulationJobCreator extends job_creator_JobCreator{constructor(indexPattern,savedSearch,query){super(indexPattern,savedSearch,query);population_job_creator_defineProperty(this,"_splitField",null);population_job_creator_defineProperty(this,"_byFields",[]);population_job_creator_defineProperty(this,"_type",new_job["f"].POPULATION);this.createdBy=new_job["a"].POPULATION;this._wizardInitialized$.next(true)}setByField(field,index){if(field===null){this.removeByField(index)}else{if(this._detectors[index]!==undefined){this._byFields[index]=field;this._detectors[index].by_field_name=field.id}}}removeByField(index){if(this._detectors[index]!==undefined){this._byFields[index]=null;delete this._detectors[index].by_field_name}}getByField(index){if(this._byFields[index]===undefined){return null}return this._byFields[index]}setSplitField(field){this._splitField=field;if(this._splitField===null){this.removeSplitField()}else{for(let i=0;i<this._detectors.length;i++){this._detectors[i].over_field_name=this._splitField.id}}}removeSplitField(){this._detectors.forEach(d=>{delete d.over_field_name})}get splitField(){return this._splitField}addDetector(agg,field){const dtr=this._createDetector(agg,field);this._addDetector(dtr,agg,field);this._byFields.push(null)}editDetector(agg,field,index){const dtr=this._createDetector(agg,field);const sp=this._byFields[index];if(sp!==undefined&&sp!==null){dtr.by_field_name=sp.id}this._editDetector(dtr,agg,field,index)}_createDetector(agg,field){const dtr=Object(default_configs["a"])(agg,field);if(this._splitField!==null){dtr.over_field_name=this._splitField.id}return dtr}removeDetector(index){this._removeDetector(index);this._byFields.splice(index,1)}get aggFieldPairs(){return this.detectors.map((d,i)=>({field:this._fields[i],agg:this._aggs[i],by:{field:this._byFields[i],value:null}}))}cloneFromExistingJob(job,datafeed){this._overrideConfigs(job,datafeed);this.createdBy=new_job["a"].POPULATION;const detectors=Object(general["j"])(job,datafeed,this.additionalFields,false);this.removeAllDetectors();if(detectors.length){if(detectors[0].overField!==null){this.setSplitField(detectors[0].overField)}}detectors.forEach((d,i)=>{const dtr=detectors[i];if(dtr.agg!==null&&dtr.field!==null){this.addDetector(dtr.agg,dtr.field);if(dtr.byField!==null){this.setByField(dtr.byField,i)}}})}}var validation_utils=__webpack_require__(126);function advanced_job_creator_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class advanced_job_creator_AdvancedJobCreator extends job_creator_JobCreator{constructor(indexPattern,savedSearch,query){super(indexPattern,savedSearch,query);advanced_job_creator_defineProperty(this,"_type",new_job["f"].ADVANCED);advanced_job_creator_defineProperty(this,"_richDetectors",[]);advanced_job_creator_defineProperty(this,"_queryString",void 0);this._queryString=JSON.stringify(this._datafeed_config.query);this._wizardInitialized$.next(true)}addDetector(agg,field,byField,overField,partitionField,excludeFrequent,description){const customRules=null;const{detector:detector,richDetector:richDetector}=this._createDetector(agg,field,byField,overField,partitionField,excludeFrequent,description,customRules);this._addDetector(detector,agg,field);this._richDetectors.push(richDetector)}editDetector(agg,field,byField,overField,partitionField,excludeFrequent,description,index){const customRules=this._detectors[index]!==undefined?this._detectors[index].custom_rules||null:null;const{detector:detector,richDetector:richDetector}=this._createDetector(agg,field,byField,overField,partitionField,excludeFrequent,description,customRules);this._editDetector(detector,agg,field,index);if(this._richDetectors[index]!==undefined){this._richDetectors[index]=richDetector}}_createDetector(agg,field,byField,overField,partitionField,excludeFrequent,description,customRules){const detector=Object(default_configs["a"])(agg,field);if(byField!==null){detector.by_field_name=byField.id}if(overField!==null){detector.over_field_name=overField.id}if(partitionField!==null){detector.partition_field_name=partitionField.id}if(excludeFrequent!==null){detector.exclude_frequent=excludeFrequent}if(description!==null){detector.detector_description=description}if(customRules!==null){detector.custom_rules=customRules}const richDetector={agg:agg,field:field,byField:byField,overField:overField,partitionField:partitionField,excludeFrequent:excludeFrequent,description:description,customRules:customRules};return{detector:detector,richDetector:richDetector}}removeDetector(index){this._removeDetector(index);this._richDetectors.splice(index,1)}get richDetectors(){return this._richDetectors}get queryString(){return this._queryString}set queryString(qs){this._queryString=qs}get isValidQueryString(){return Object(validation_utils["c"])(this._queryString)}async autoSetTimeRange(){try{const{start:start,end:end}=await ml_api_service["ml"].getTimeFieldRange({index:this._indexPatternTitle,timeFieldName:this.timeFieldName,query:this.query});this.setTimeRange(start.epoch,end.epoch)}catch(error){throw Error(error)}}cloneFromExistingJob(job,datafeed){this._overrideConfigs(job,datafeed);const detectors=Object(general["j"])(job,datafeed,this.additionalFields,true);const customRules=this._detectors.map(d=>d.custom_rules);this.removeAllDetectors();this._richDetectors.length=0;detectors.forEach((d,i)=>{const dtr=detectors[i];if(dtr.agg!==null&&dtr.field!==null){this.addDetector(dtr.agg,dtr.field,dtr.byField,dtr.overField,dtr.partitionField,dtr.excludeFrequent,dtr.description)}});customRules.forEach((cr,i)=>{if(cr!==undefined){this._detectors[i].custom_rules=cr}})}}var fields=__webpack_require__(105);var categorization_job=__webpack_require__(155);var results_loader=__webpack_require__(385);var ml_server_info=__webpack_require__(83);function categorization_job_creator_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class categorization_job_creator_CategorizationJobCreator extends job_creator_JobCreator{constructor(indexPattern,savedSearch,query){super(indexPattern,savedSearch,query);categorization_job_creator_defineProperty(this,"_type",new_job["f"].CATEGORIZATION);categorization_job_creator_defineProperty(this,"_createCountDetector",()=>{});categorization_job_creator_defineProperty(this,"_createRareDetector",()=>{});categorization_job_creator_defineProperty(this,"_examplesLoader",void 0);categorization_job_creator_defineProperty(this,"_categoryFieldExamples",[]);categorization_job_creator_defineProperty(this,"_validationChecks",[]);categorization_job_creator_defineProperty(this,"_overallValidStatus",categorization_job["a"].INVALID);categorization_job_creator_defineProperty(this,"_detectorType",aggregation_types["b"].COUNT);categorization_job_creator_defineProperty(this,"_categorizationAnalyzer",{});categorization_job_creator_defineProperty(this,"_defaultCategorizationAnalyzer",void 0);categorization_job_creator_defineProperty(this,"_partitionFieldName",null);this.createdBy=new_job["a"].CATEGORIZATION;this._examplesLoader=new results_loader["a"](this,indexPattern,query);const{anomaly_detectors:anomalyDetectors}=Object(ml_server_info["b"])();this._defaultCategorizationAnalyzer=anomalyDetectors.categorization_analyzer||{}}setDefaultDetectorProperties(count,rare,eventRate){if(count===null||rare===null||eventRate===null){return}this._createCountDetector=()=>{this._createDetector(count,eventRate)};this._createRareDetector=()=>{this._createDetector(rare,eventRate)}}_createDetector(agg,field){const dtr=Object(default_configs["a"])(agg,field);dtr.by_field_name=fields["c"].id;if(this.perPartitionCategorization&&this.categorizationPerPartitionField!==null){dtr.partition_field_name=this.categorizationPerPartitionField}this._addDetector(dtr,agg,fields["c"])}setDetectorType(type){this._detectorType=type;this.removeAllDetectors();if(type===aggregation_types["b"].COUNT){this._createCountDetector();this.bucketSpan=new_job["b"]}else{this._createRareDetector();this.bucketSpan=new_job["e"];this.modelPlot=false}}set categorizationFieldName(fieldName){if(fieldName!==null){this._job_config.analysis_config.categorization_field_name=fieldName;this.setDetectorType(this._detectorType);this.addInfluencer(fields["c"].id)}else{delete this._job_config.analysis_config.categorization_field_name;this._categoryFieldExamples=[];this._validationChecks=[];this._overallValidStatus=categorization_job["a"].INVALID}}get categorizationFieldName(){return this._job_config.analysis_config.categorization_field_name||null}async loadCategorizationFieldExamples(){const{examples:examples,sampleSize:sampleSize,overallValidStatus:overallValidStatus,validationChecks:validationChecks}=await this._examplesLoader.loadExamples();this._categoryFieldExamples=examples;this._validationChecks=validationChecks;this._overallValidStatus=overallValidStatus;this._wizardInitialized$.next(true);return{examples:examples,sampleSize:sampleSize,overallValidStatus:overallValidStatus,validationChecks:validationChecks}}get categoryFieldExamples(){return this._categoryFieldExamples}get validationChecks(){return this._validationChecks}get overallValidStatus(){return this._overallValidStatus}get selectedDetectorType(){return this._detectorType}set categorizationAnalyzer(analyzer){this._categorizationAnalyzer=analyzer;if(Object(external_kbnSharedDeps_Lodash_["isEqual"])(this._categorizationAnalyzer,this._defaultCategorizationAnalyzer)){delete this._job_config.analysis_config.categorization_analyzer}else{this._job_config.analysis_config.categorization_analyzer=analyzer}}get categorizationAnalyzer(){return this._categorizationAnalyzer}get categorizationPerPartitionField(){return this._partitionFieldName}set categorizationPerPartitionField(fieldName){if(fieldName===null){this._detectors.forEach(detector=>{delete detector.partition_field_name});if(this._partitionFieldName!==null)this.removeInfluencer(this._partitionFieldName);this._partitionFieldName=null}else{if(this._partitionFieldName!==fieldName){if(this._partitionFieldName!==null)this.removeInfluencer(this._partitionFieldName);this.addInfluencer(fieldName);this._partitionFieldName=fieldName;this._detectors.forEach(detector=>{detector.partition_field_name=fieldName})}}}get perPartitionCategorization(){var _this$_job_config$ana;return((_this$_job_config$ana=this._job_config.analysis_config.per_partition_categorization)===null||_this$_job_config$ana===void 0?void 0:_this$_job_config$ana.enabled)===true}set perPartitionCategorization(enabled){this._initPerPartitionCategorization();this._job_config.analysis_config.per_partition_categorization.enabled=enabled;if(enabled===false){this.categorizationPerPartitionField=null}}cloneFromExistingJob(job,datafeed){this._overrideConfigs(job,datafeed);this.createdBy=new_job["a"].CATEGORIZATION;const detectors=Object(general["j"])(job,datafeed,this.additionalFields,false);const dtr=detectors[0];if(dtr!==undefined&&dtr.agg!==null&&dtr.field!==null){const detectorType=dtr.agg.id===aggregation_types["b"].COUNT?aggregation_types["b"].COUNT:aggregation_types["b"].RARE;const bs=job.analysis_config.bucket_span;this.setDetectorType(detectorType);if(dtr.partitionField!==null){this.categorizationPerPartitionField=dtr.partitionField.id}this.bucketSpan=bs}}}function isSingleMetricJobCreator(jobCreator){return jobCreator.type===new_job["f"].SINGLE_METRIC}function isMultiMetricJobCreator(jobCreator){return jobCreator.type===new_job["f"].MULTI_METRIC}function isPopulationJobCreator(jobCreator){return jobCreator.type===new_job["f"].POPULATION}function isAdvancedJobCreator(jobCreator){return jobCreator.type===new_job["f"].ADVANCED}function isCategorizationJobCreator(jobCreator){return jobCreator.type===new_job["f"].CATEGORIZATION}const jobCreatorFactory=jobType=>(indexPattern,savedSearch,query)=>{let jc;switch(jobType){case new_job["f"].SINGLE_METRIC:jc=single_metric_job_creator_SingleMetricJobCreator;break;case new_job["f"].MULTI_METRIC:jc=multi_metric_job_creator_MultiMetricJobCreator;break;case new_job["f"].POPULATION:jc=population_job_creator_PopulationJobCreator;break;case new_job["f"].ADVANCED:jc=advanced_job_creator_AdvancedJobCreator;break;case new_job["f"].CATEGORIZATION:jc=categorization_job_creator_CategorizationJobCreator;break;default:jc=single_metric_job_creator_SingleMetricJobCreator;break}return new jc(indexPattern,savedSearch,query)}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return NavigationMenu}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(33);var license=__webpack_require__(85);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);var kibana=__webpack_require__(58);var url_state=__webpack_require__(70);var app=__webpack_require__(4);function getTabs(disableLinks){return[{id:"overview",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.navMenu.overviewTabLinkText",{defaultMessage:"Overview"}),disabled:disableLinks},{id:"anomaly_detection",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.navMenu.anomalyDetectionTabLinkText",{defaultMessage:"Anomaly Detection"}),disabled:disableLinks},{id:"data_frame_analytics",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.navMenu.dataFrameAnalyticsTabLinkText",{defaultMessage:"Data Frame Analytics"}),disabled:disableLinks},{id:"datavisualizer",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.navMenu.dataVisualizerTabLinkText",{defaultMessage:"Data Visualizer"}),disabled:false},{id:"settings",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.navMenu.settingsTabLinkText",{defaultMessage:"Settings"}),disabled:disableLinks}]}const TAB_DATA={overview:{testSubject:"mlMainTab overview",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.overviewTabLabel",{defaultMessage:"Overview"})},anomaly_detection:{testSubject:"mlMainTab anomalyDetection",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomalyDetectionTabLabel",{defaultMessage:"Anomaly Detection"}),pathId:"jobs"},data_frame_analytics:{testSubject:"mlMainTab dataFrameAnalytics",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataFrameAnalyticsTabLabel",{defaultMessage:"Data Frame Analytics"})},datavisualizer:{testSubject:"mlMainTab dataVisualizer",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataVisualizerTabLabel",{defaultMessage:"Data Visualizer"})},settings:{testSubject:"mlMainTab settings",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.settingsTabLabel",{defaultMessage:"Settings"})},"access-denied":{testSubject:"mlMainTab overview",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.accessDeniedTabLabel",{defaultMessage:"Access Denied"})}};const MainTabs=({tabId:tabId,disableLinks:disableLinks})=>{const{services:{chrome:{docTitle:docTitle}}}=Object(kibana["b"])();const[globalState]=Object(url_state["c"])("_g");const[selectedTabId,setSelectedTabId]=Object(external_kbnSharedDeps_React_["useState"])(tabId);function onSelectedTabChanged(id){setSelectedTabId(id)}const tabs=getTabs(disableLinks);const mlUrlGenerator=Object(kibana["d"])();const navigateToPath=Object(kibana["e"])();const redirectToTab=async defaultPathId=>{const pageState=(globalState===null||globalState===void 0?void 0:globalState.refreshInterval)!==undefined?{globalState:{refreshInterval:globalState.refreshInterval}}:undefined;const path=await mlUrlGenerator.createUrl({page:defaultPathId,pageState:pageState});await navigateToPath(path,false)};Object(external_kbnSharedDeps_React_["useEffect"])(()=>{docTitle.change([TAB_DATA[selectedTabId].name,app["a"]])},[selectedTabId]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTabs"],{display:"condensed"},tabs.map(tab=>{const{id:id,disabled:disabled}=tab;const testSubject=TAB_DATA[id].testSubject;const defaultPathId=TAB_DATA[id].pathId||id;return disabled?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTab"],{key:`${id}-key`,className:"mlNavigationMenu__mainTab",disabled:true,"data-test-subj":testSubject},tab.name):external_kbnSharedDeps_React_default.a.createElement("div",{className:"euiTab",key:`div-${id}-key`},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTab"],{"data-test-subj":testSubject+(id===selectedTabId?" selected":""),className:"mlNavigationMenu__mainTab",onClick:()=>{onSelectedTabChanged(id);redirectToTab(defaultPathId)},isSelected:id===selectedTabId,key:`tab-${id}-key`},tab.name))}))};const NavigationMenu=({tabId:tabId})=>{const disableLinks=Object(license["d"])()===false;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween",className:"mlNavigationMenu",gutterSize:"none"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(MainTabs,{tabId:tabId,disableLinks:disableLinks}))))}},,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return ANNOTATIONS_TABLE_DEFAULT_QUERY_SIZE}));__webpack_require__.d(__webpack_exports__,"b",(function(){return ANOMALIES_TABLE_DEFAULT_QUERY_SIZE}));__webpack_require__.d(__webpack_exports__,"c",(function(){return SEARCH_QUERY_LANGUAGE}));const ANNOTATIONS_TABLE_DEFAULT_QUERY_SIZE=500;const ANOMALIES_TABLE_DEFAULT_QUERY_SIZE=500;const SEARCH_QUERY_LANGUAGE={KUERY:"kuery",LUCENE:"lucene"}},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(73);var Graph=__webpack_require__(107).Graph;module.exports={addDummyNode:addDummyNode,simplify:simplify,asNonCompoundGraph:asNonCompoundGraph,successorWeights:successorWeights,predecessorWeights:predecessorWeights,intersectRect:intersectRect,buildLayerMatrix:buildLayerMatrix,normalizeRanks:normalizeRanks,removeEmptyRanks:removeEmptyRanks,addBorderNode:addBorderNode,maxRank:maxRank,partition:partition,time:time,notime:notime};function addDummyNode(g,type,attrs,name){var v;do{v=_.uniqueId(name)}while(g.hasNode(v));attrs.dummy=type;g.setNode(v,attrs);return v}function simplify(g){var simplified=(new Graph).setGraph(g.graph());_.forEach(g.nodes(),(function(v){simplified.setNode(v,g.node(v))}));_.forEach(g.edges(),(function(e){var simpleLabel=simplified.edge(e.v,e.w)||{weight:0,minlen:1};var label=g.edge(e);simplified.setEdge(e.v,e.w,{weight:simpleLabel.weight+label.weight,minlen:Math.max(simpleLabel.minlen,label.minlen)})}));return simplified}function asNonCompoundGraph(g){var simplified=new Graph({multigraph:g.isMultigraph()}).setGraph(g.graph());_.forEach(g.nodes(),(function(v){if(!g.children(v).length){simplified.setNode(v,g.node(v))}}));_.forEach(g.edges(),(function(e){simplified.setEdge(e,g.edge(e))}));return simplified}function successorWeights(g){var weightMap=_.map(g.nodes(),(function(v){var sucs={};_.forEach(g.outEdges(v),(function(e){sucs[e.w]=(sucs[e.w]||0)+g.edge(e).weight}));return sucs}));return _.zipObject(g.nodes(),weightMap)}function predecessorWeights(g){var weightMap=_.map(g.nodes(),(function(v){var preds={};_.forEach(g.inEdges(v),(function(e){preds[e.v]=(preds[e.v]||0)+g.edge(e).weight}));return preds}));return _.zipObject(g.nodes(),weightMap)}function intersectRect(rect,point){var x=rect.x;var y=rect.y;var dx=point.x-x;var dy=point.y-y;var w=rect.width/2;var h=rect.height/2;if(!dx&&!dy){throw new Error("Not possible to find intersection inside of the rectangle")}var sx,sy;if(Math.abs(dy)*w>Math.abs(dx)*h){if(dy<0){h=-h}sx=h*dx/dy;sy=h}else{if(dx<0){w=-w}sx=w;sy=w*dy/dx}return{x:x+sx,y:y+sy}}function buildLayerMatrix(g){var layering=_.map(_.range(maxRank(g)+1),(function(){return[]}));_.forEach(g.nodes(),(function(v){var node=g.node(v);var rank=node.rank;if(!_.isUndefined(rank)){layering[rank][node.order]=v}}));return layering}function normalizeRanks(g){var min=_.min(_.map(g.nodes(),(function(v){return g.node(v).rank})));_.forEach(g.nodes(),(function(v){var node=g.node(v);if(_.has(node,"rank")){node.rank-=min}}))}function removeEmptyRanks(g){var offset=_.min(_.map(g.nodes(),(function(v){return g.node(v).rank})));var layers=[];_.forEach(g.nodes(),(function(v){var rank=g.node(v).rank-offset;if(!layers[rank]){layers[rank]=[]}layers[rank].push(v)}));var delta=0;var nodeRankFactor=g.graph().nodeRankFactor;_.forEach(layers,(function(vs,i){if(_.isUndefined(vs)&&i%nodeRankFactor!==0){--delta}else if(delta){_.forEach(vs,(function(v){g.node(v).rank+=delta}))}}))}function addBorderNode(g,prefix,rank,order){var node={width:0,height:0};if(arguments.length>=4){node.rank=rank;node.order=order}return addDummyNode(g,"border",node,prefix)}function maxRank(g){return _.max(_.map(g.nodes(),(function(v){var rank=g.node(v).rank;if(!_.isUndefined(rank)){return rank}})))}function partition(collection,fn){var result={lhs:[],rhs:[]};_.forEach(collection,(function(value){if(fn(value)){result.lhs.push(value)}else{result.rhs.push(value)}}));return result}function time(name,fn){var start=_.now();try{return fn()}finally{console.log(name+" time: "+(_.now()-start)+"ms")}}function notime(name,fn){return fn()}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return HelpMenu}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);var kibana=__webpack_require__(58);const HelpMenu=external_kbnSharedDeps_React_default.a.memo(({docLink:docLink})=>{const{chrome:chrome}=Object(kibana["b"])().services;Object(external_kbnSharedDeps_React_["useEffect"])(()=>{chrome.setHelpExtension({appName:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.chrome.help.appName",{defaultMessage:"Machine Learning"}),links:[{href:docLink,linkType:"documentation"}]})},[]);return null});HelpMenu.displayName="HelpMenu"},,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return DATAFEED_STATE}));__webpack_require__.d(__webpack_exports__,"b",(function(){return FORECAST_REQUEST_STATE}));__webpack_require__.d(__webpack_exports__,"c",(function(){return JOB_STATE}));let DATAFEED_STATE;(function(DATAFEED_STATE){DATAFEED_STATE["STARTED"]="started";DATAFEED_STATE["STARTING"]="starting";DATAFEED_STATE["STOPPED"]="stopped";DATAFEED_STATE["STOPPING"]="stopping";DATAFEED_STATE["DELETED"]="deleted"})(DATAFEED_STATE||(DATAFEED_STATE={}));let FORECAST_REQUEST_STATE;(function(FORECAST_REQUEST_STATE){FORECAST_REQUEST_STATE["FAILED"]="failed";FORECAST_REQUEST_STATE["FINISHED"]="finished";FORECAST_REQUEST_STATE["SCHEDULED"]="scheduled";FORECAST_REQUEST_STATE["STARTED"]="started"})(FORECAST_REQUEST_STATE||(FORECAST_REQUEST_STATE={}));let JOB_STATE;(function(JOB_STATE){JOB_STATE["CLOSED"]="closed";JOB_STATE["CLOSING"]="closing";JOB_STATE["FAILED"]="failed";JOB_STATE["OPENED"]="opened";JOB_STATE["OPENING"]="opening";JOB_STATE["DELETED"]="deleted"})(JOB_STATE||(JOB_STATE={}))},function(module,exports,__webpack_require__){(function(Buffer){var format_value=__webpack_require__(161).format_value;var schema=exports.schema={};var properties=exports.properties={CALSCALE:{type:"TEXT"},METHOD:{type:"TEXT"},PRODID:{type:"TEXT"},VERSION:{type:"TEXT"},ATTACH:{type:"URI"},CATEGORIES:{type:"TEXT",list:true},CLASS:{type:"TEXT"},COMMENT:{type:"TEXT"},DESCRIPTION:{type:"TEXT"},GEO:{type:"FLOAT",list:true},LOCATION:{type:"TEXT"},"PERCENT-COMPLETE":{type:"INTEGER"},PRIORITY:{type:"INTEGER"},RESOURCES:{type:"TEXT"},STATUS:{type:"TEXT"},SUMMARY:{type:"TEXT"},COMPLETED:{type:"DATE-TIME"},DTEND:{type:"DATE-TIME"},DUE:{type:"DATE-TIME"},DTSTART:{type:"DATE-TIME"},DURATION:{type:"DURATION"},FREEBUSY:{type:"PERIOD"},TRANSP:{type:"TEXT"},TZID:{type:"TEXT"},TZNAME:{type:"TEXT"},TZOFFSETFROM:{type:"UTC-OFFSET"},TZOFFSETTO:{type:"UTC-OFFSET"},TZURL:{type:"URI"},ATTENDEE:{type:"CAL-ADDRESS"},CONTACT:{type:"TEXT"},ORGANIZER:{type:"CAL-ADDRESS"},"RECURRENCE-ID":{type:"DATE-TIME"},"RELATED-TO":{type:"TEXT"},URL:{type:"URI"},UID:{type:"TEXT"},EXDATE:{type:"DATE-TIME",list:true},RDATE:{type:"DATE-TIME",list:true},RRULE:{type:"RECUR"},ACTION:{type:"TEXT"},REPEAT:{type:"INTEGER"},TRIGGER:{type:"DURATION"},CREATED:{type:"DATE-TIME"},DTSTAMP:{type:"DATE-TIME"},"LAST-MODIFIED":{type:"DATE-TIME"},SEQUENCE:{type:"INTEGER"},"REQUEST-STATUS":{type:"TEXT"}};var MAX_LINE=75;var CalendarObject=exports.CalendarObject=function(calendar,element){this.calendar=calendar;this.element=element;this.components={};this.properties={}};CalendarObject.create=function(element,calendar){var factory=(schema[element]||{}).factory;return factory!==undefined?new factory(calendar):new CalendarObject(calendar,element)};CalendarObject.prototype.clone=function(){var obj=CalendarObject.create(this.element,this.calendar);for(var prop in this.properties)obj.addProperties(this.properties[prop]);var comp=this.getComponents();for(var i=0;i<comp.length;++i)obj.addComponent(comp[i]);return obj};CalendarObject.prototype.addProperties=function(props){props.forEach(this.addProperty.bind(this))};CalendarObject.prototype.addProperty=function(prop,value,parameters){if(!(prop instanceof CalendarProperty)){if(value===undefined)return;prop=new CalendarProperty(prop,value,parameters)}else prop=prop.clone();this.properties[prop.name]=this.properties[prop.name]||[];this.properties[prop.name].push(prop);return prop};CalendarObject.prototype.setProperty=function(prop,value,parameters){this.removeProperty(prop instanceof CalendarProperty?prop.name:prop);this.addProperty(prop,value,parameters)};CalendarObject.prototype.addComponent=function(comp){if(!(comp instanceof CalendarObject)){var factory=(schema[comp]||{}).factory;comp=factory!==undefined?new factory(this.calendar):new CalendarObject(this.calendar,comp)}if(comp.calendar&&comp.calendar!==this.calendar)comp=comp.clone();this.components[comp.element]=this.components[comp.element]||[];this.components[comp.element].push(comp);comp.calendar=this.calendar;return comp};CalendarObject.prototype.addComponents=function(comps){comps.forEach(this.addComponent.bind(this))};CalendarObject.prototype.getComponents=function(type){if(type===undefined){var all=[];for(var c in this.components)all=all.concat(this.components[c]);return all}return this.components[type]||[]};CalendarObject.prototype.getProperty=function(prop,i){return(this.properties[prop]||[])[i||0]};CalendarObject.prototype.getProperties=function(prop){return this.properties[prop]||[]};CalendarObject.prototype.getPropertyValue=function(prop,i){return(this.getProperty(prop,i)||{}).value};CalendarObject.prototype.removeProperty=function(prop){delete this.properties[prop]};CalendarObject.prototype.validate=function(){var self=this;var _schema=schema[self.element];if(_schema&&_schema.required_properties){_schema.required_properties.forEach((function(req){if(!self.getPropertyValue(req))throw new Error(req+" is a required property of "+self.element)}))}for(var type in self.components){self.components[type].forEach((function(comp){comp.validate()}))}};CalendarObject.prototype.toString=function(){var output;if(this.element=="VCALENDAR")output=this.format();else{var ical=new(__webpack_require__(190).iCalendar);ical.addComponent(this);output=ical.format()}output.push("");return output.join("\r\n")};CalendarObject.prototype.format=function(){var lines=["BEGIN:"+this.element];for(var i in this.properties){this.properties[i].forEach((function(prop){lines.push.apply(lines,prop.format())}))}for(var comp in this.components){var comp=this.components[comp];for(var i=0;i<comp.length;++i)lines.push.apply(lines,comp[i].format())}lines.push("END:"+this.element);return lines};var CalendarProperty=exports.CalendarProperty=function(name,value,parameters){var propdef=properties[name];this.type=propdef&&propdef.type?propdef.type:"TEXT";this.name=name;this.value=value;this.parameters=parameters||{}};CalendarProperty.prototype.clone=function(){var obj=new CalendarProperty(this.name,this.value);obj.type=this.type;for(var param in this.parameters)obj.parameters[param]=this.parameters[param];return obj};CalendarProperty.prototype.getParameter=function(param){return this.parameters[param]};CalendarProperty.prototype.setParameter=function(param,value){this.parameters[param]=value};CalendarProperty.prototype.format=function(){var params=[];for(var k in this.parameters)params.push(k+"="+this.parameters[k]);if(params.length)params=";"+params.join(";");var data=new Buffer(this.name+params+":"+format_value(this.type,this.value,this.parameters));var pos=0,len;var output=[];while(true){len=MAX_LINE;if(pos+len>=data.length)len=data.length-pos;while((data[pos+len]&192)==128)len--;output.push(data.toString("utf8",pos,pos+len));if(pos+len>=data.length)break;pos+=len-1;data[pos]=32}return output}}).call(this,__webpack_require__(188).Buffer)},function(module,exports,__webpack_require__){var lodash;if(true){try{lodash={clone:__webpack_require__(495),constant:__webpack_require__(242),each:__webpack_require__(323),filter:__webpack_require__(326),has:__webpack_require__(337),isArray:__webpack_require__(77),isEmpty:__webpack_require__(571),isFunction:__webpack_require__(163),isUndefined:__webpack_require__(338),keys:__webpack_require__(123),map:__webpack_require__(339),reduce:__webpack_require__(341),size:__webpack_require__(574),transform:__webpack_require__(580),union:__webpack_require__(581),values:__webpack_require__(346)}}catch(e){}}if(!lodash){lodash=window._}module.exports=lodash},function(module,exports){function isObject(value){var type=typeof value;return value!=null&&(type=="object"||type=="function")}module.exports=isObject},,,function(module,exports,__webpack_require__){var graphlib;if(true){try{graphlib=__webpack_require__(493)}catch(e){}}if(!graphlib){graphlib=window.graphlib}module.exports=graphlib},function(module,exports,__webpack_require__){var freeGlobal=__webpack_require__(306);var freeSelf=typeof self=="object"&&self&&self.Object===Object&&self;var root=freeGlobal||freeSelf||Function("return this")();module.exports=root},,,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"d",(function(){return useChartColors}));__webpack_require__.d(__webpack_exports__,"a",(function(){return defaultChartSettings}));__webpack_require__.d(__webpack_exports__,"c",(function(){return seriesStyle}));__webpack_require__.d(__webpack_exports__,"b",(function(){return getChartSettings}));var _elastic_eui_dist_eui_theme_dark_json__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(48);var _elastic_eui_dist_eui_theme_dark_json__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_elastic_eui_dist_eui_theme_dark_json__WEBPACK_IMPORTED_MODULE_0__);var _elastic_eui_dist_eui_theme_light_json__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(45);var _elastic_eui_dist_eui_theme_light_json__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_elastic_eui_dist_eui_theme_light_json__WEBPACK_IMPORTED_MODULE_1__);var _common_job_creator__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(93);var _util_time_buckets__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(95);var _contexts_kibana_use_ui_settings_context__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(178);function useChartColors(){const IS_DARK_THEME=Object(_contexts_kibana_use_ui_settings_context__WEBPACK_IMPORTED_MODULE_4__["a"])().get("theme:darkMode");const themeName=IS_DARK_THEME?_elastic_eui_dist_eui_theme_dark_json__WEBPACK_IMPORTED_MODULE_0___default.a:_elastic_eui_dist_eui_theme_light_json__WEBPACK_IMPORTED_MODULE_1___default.a;return{LINE_COLOR:themeName.euiColorPrimary,MODEL_COLOR:themeName.euiColorPrimary,EVENT_RATE_COLOR:themeName.euiColorPrimary,EVENT_RATE_COLOR_WITH_ANOMALIES:themeName.euiColorLightShade}}const defaultChartSettings={width:"100%",height:"300px",cols:1,intervalMs:0};const seriesStyle={line:{strokeWidth:2,visible:true,opacity:1},border:{visible:false,strokeWidth:0},point:{visible:false,radius:2,strokeWidth:4,opacity:.5},area:{opacity:.25,visible:false}};function getChartSettings(jobCreator,chartInterval){const cs={...defaultChartSettings,intervalMs:chartInterval.getInterval().asMilliseconds()};if(Object(_common_job_creator__WEBPACK_IMPORTED_MODULE_2__["d"])(jobCreator)){const interval=Object(_util_time_buckets__WEBPACK_IMPORTED_MODULE_3__["c"])();interval.setInterval("auto");interval.setBounds(chartInterval.getBounds());cs.intervalMs=interval.getInterval().asMilliseconds()}if(cs.intervalMs<jobCreator.bucketSpanMs){cs.intervalMs=jobCreator.bucketSpanMs}if(Object(_common_job_creator__WEBPACK_IMPORTED_MODULE_2__["c"])(jobCreator)||Object(_common_job_creator__WEBPACK_IMPORTED_MODULE_2__["d"])(jobCreator)){if(jobCreator.aggFieldPairs.length>2&&Object(_common_job_creator__WEBPACK_IMPORTED_MODULE_2__["c"])(jobCreator)){cs.cols=3;cs.height="150px";cs.intervalMs=cs.intervalMs*3}else if(jobCreator.aggFieldPairs.length>1){cs.cols=2;cs.height="200px";cs.intervalMs=cs.intervalMs*2}}return cs}},function(module,exports){function isObjectLike(value){return value!=null&&typeof value=="object"}module.exports=isObjectLike},,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return MLJobEditor}));__webpack_require__.d(__webpack_exports__,"b",(function(){return ML_EDITOR_MODE}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(33);var shared_imports=__webpack_require__(159);const ML_EDITOR_MODE={TEXT:"text",JSON:"json",XJSON:new shared_imports["a"]};const MLJobEditor=({value:value,height:height="500px",width:width="100%",mode:mode=ML_EDITOR_MODE.JSON,readOnly:readOnly=false,syntaxChecking:syntaxChecking=true,theme:theme="textmate",onChange:onChange=(()=>{})})=>{if(mode===ML_EDITOR_MODE.XJSON){value=Object(shared_imports["c"])(value)}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCodeEditor"],{value:value,width:width,height:height,mode:mode,readOnly:readOnly,wrapEnabled:true,showPrintMargin:false,theme:theme,editorProps:{$blockScrolling:true},setOptions:{useWorker:syntaxChecking,tabSize:2,useSoftTabs:true},onChange:onChange})}},,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return DEFAULT_MODEL_MEMORY_LIMIT}));__webpack_require__.d(__webpack_exports__,"b",(function(){return DEFAULT_NUM_TOP_FEATURE_IMPORTANCE_VALUES}));__webpack_require__.d(__webpack_exports__,"c",(function(){return UNSET_CONFIG_ITEM}));__webpack_require__.d(__webpack_exports__,"e",(function(){return getInitialState}));__webpack_require__.d(__webpack_exports__,"f",(function(){return getJobConfigFromFormState}));__webpack_require__.d(__webpack_exports__,"d",(function(){return getFormStateFromJobConfig}));var _capabilities_check_capabilities__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(63);var _ml_nodes_check__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(121);var _common_analytics__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(62);var _common_util_analytics_utils__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(92);var _common_constants_data_frame_analytics__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(74);let DEFAULT_MODEL_MEMORY_LIMIT;(function(DEFAULT_MODEL_MEMORY_LIMIT){DEFAULT_MODEL_MEMORY_LIMIT["regression"]="100mb";DEFAULT_MODEL_MEMORY_LIMIT["outlier_detection"]="50mb";DEFAULT_MODEL_MEMORY_LIMIT["classification"]="100mb"})(DEFAULT_MODEL_MEMORY_LIMIT||(DEFAULT_MODEL_MEMORY_LIMIT={}));const DEFAULT_NUM_TOP_FEATURE_IMPORTANCE_VALUES=0;const DEFAULT_MAX_NUM_THREADS=1;const UNSET_CONFIG_ITEM="--";const getInitialState=()=>({advancedEditorMessages:[],advancedEditorRawString:"",disableSwitchToForm:false,form:{alpha:undefined,computeFeatureInfluence:"true",createIndexPattern:true,classAssignmentObjective:undefined,dependentVariable:"",description:"",destinationIndex:"",destinationIndexNameExists:false,destinationIndexNameEmpty:true,destinationIndexNameValid:false,destinationIndexPatternTitleExists:false,earlyStoppingEnabled:undefined,downsampleFactor:undefined,eta:undefined,etaGrowthRatePerTree:undefined,featureBagFraction:undefined,featureInfluenceThreshold:undefined,gamma:undefined,includes:[],jobId:"",jobIdExists:false,jobIdEmpty:true,jobIdInvalidMaxLength:false,jobIdValid:false,jobType:undefined,jobConfigQuery:_common_analytics__WEBPACK_IMPORTED_MODULE_2__["q"],jobConfigQueryString:undefined,lambda:undefined,loadingFieldOptions:false,maxNumThreads:DEFAULT_MAX_NUM_THREADS,maxOptimizationRoundsPerHyperparameter:undefined,maxTrees:undefined,method:undefined,modelMemoryLimit:undefined,modelMemoryLimitUnitValid:true,modelMemoryLimitValidationResult:null,nNeighbors:undefined,numTopFeatureImportanceValues:DEFAULT_NUM_TOP_FEATURE_IMPORTANCE_VALUES,numTopFeatureImportanceValuesValid:true,numTopClasses:-1,outlierFraction:undefined,predictionFieldName:undefined,previousJobType:null,requiredFieldsError:undefined,randomizeSeed:undefined,resultsField:undefined,softTreeDepthLimit:undefined,softTreeDepthTolerance:undefined,sourceIndex:"",sourceIndexNameEmpty:true,sourceIndexNameValid:false,sourceIndexContainsNumericalFields:true,sourceIndexFieldsCheckFailed:false,standardizationEnabled:"true",trainingPercent:80,useEstimatedMml:true},jobConfig:{},disabled:!Object(_ml_nodes_check__WEBPACK_IMPORTED_MODULE_1__["d"])()||!Object(_capabilities_check_capabilities__WEBPACK_IMPORTED_MODULE_0__["e"])("canCreateDataFrameAnalytics")||!Object(_capabilities_check_capabilities__WEBPACK_IMPORTED_MODULE_0__["e"])("canStartStopDataFrameAnalytics"),indexPatternsMap:{},isAdvancedEditorEnabled:false,isAdvancedEditorValidJson:true,hasSwitchedToEditor:false,isJobCreated:false,isJobStarted:false,isValid:false,jobIds:[],requestMessages:[],estimatedModelMemoryLimit:""});const getJobConfigFromFormState=formState=>{const jobConfig={description:formState.description,source:{index:formState.sourceIndex.includes(",")?formState.sourceIndex.split(",").map(d=>d.trim()):formState.sourceIndex,query:formState.jobConfigQuery},dest:{index:formState.destinationIndex},analyzed_fields:{includes:formState.includes},analysis:{outlier_detection:{}},model_memory_limit:formState.modelMemoryLimit};if(formState.maxNumThreads!==undefined){jobConfig.max_num_threads=formState.maxNumThreads}const resultsFieldEmpty=typeof(formState===null||formState===void 0?void 0:formState.resultsField)==="string"&&(formState===null||formState===void 0?void 0:formState.resultsField.trim())==="";if(jobConfig.dest&&!resultsFieldEmpty){jobConfig.dest.results_field=formState.resultsField}if(formState.jobType===_common_constants_data_frame_analytics__WEBPACK_IMPORTED_MODULE_4__["a"].REGRESSION||formState.jobType===_common_constants_data_frame_analytics__WEBPACK_IMPORTED_MODULE_4__["a"].CLASSIFICATION){let analysis={dependent_variable:formState.dependentVariable,num_top_feature_importance_values:formState.numTopFeatureImportanceValues,training_percent:formState.trainingPercent};analysis=Object.assign(analysis,formState.alpha&&{alpha:formState.alpha},formState.eta&&{eta:formState.eta},formState.etaGrowthRatePerTree&&{eta_growth_rate_per_tree:formState.etaGrowthRatePerTree},formState.downsampleFactor&&{downsample_factor:formState.downsampleFactor},formState.featureBagFraction&&{feature_bag_fraction:formState.featureBagFraction},formState.gamma&&{gamma:formState.gamma},formState.lambda&&{lambda:formState.lambda},formState.maxOptimizationRoundsPerHyperparameter&&{max_optimization_rounds_per_hyperparameter:formState.maxOptimizationRoundsPerHyperparameter},formState.maxTrees&&{max_trees:formState.maxTrees},formState.randomizeSeed&&{randomize_seed:formState.randomizeSeed},formState.earlyStoppingEnabled!==undefined&&{early_stopping_enabled:formState.earlyStoppingEnabled},formState.predictionFieldName&&{prediction_field_name:formState.predictionFieldName},formState.randomizeSeed&&{randomize_seed:formState.randomizeSeed},formState.softTreeDepthLimit&&{soft_tree_depth_limit:formState.softTreeDepthLimit},formState.softTreeDepthTolerance&&{soft_tree_depth_tolerance:formState.softTreeDepthTolerance});jobConfig.analysis={[formState.jobType]:analysis}}if((jobConfig===null||jobConfig===void 0?void 0:jobConfig.analysis)!==undefined&&Object(_common_util_analytics_utils__WEBPACK_IMPORTED_MODULE_3__["f"])(jobConfig===null||jobConfig===void 0?void 0:jobConfig.analysis)){if(formState.numTopClasses!==undefined){jobConfig.analysis.classification.num_top_classes=formState.numTopClasses}if(formState.classAssignmentObjective!==undefined){jobConfig.analysis.classification.class_assignment_objective=formState.classAssignmentObjective}}if(formState.jobType===_common_constants_data_frame_analytics__WEBPACK_IMPORTED_MODULE_4__["a"].OUTLIER_DETECTION){const analysis=Object.assign({},formState.computeFeatureInfluence!==undefined&&{compute_feature_influence:formState.computeFeatureInfluence},formState.method&&{method:formState.method},formState.nNeighbors&&{n_neighbors:formState.nNeighbors},formState.outlierFraction&&{outlier_fraction:formState.outlierFraction},formState.featureInfluenceThreshold&&{feature_influence_threshold:formState.featureInfluenceThreshold},formState.standardizationEnabled!==undefined&&{standardization_enabled:formState.standardizationEnabled});jobConfig.analysis.outlier_detection=analysis}return jobConfig};function toCamelCase(property){const camelCased=property.replace(/_([a-z])/g,(function(g){return g[1].toUpperCase()}));return camelCased}function getFormStateFromJobConfig(analyticsJobConfig,isClone=true){var _analyticsJobConfig$d,_analyticsJobConfig$a,_analyticsJobConfig$a2;const jobType=Object(_common_analytics__WEBPACK_IMPORTED_MODULE_2__["r"])(analyticsJobConfig.analysis);const resultState={jobType:jobType,description:(_analyticsJobConfig$d=analyticsJobConfig.description)!==null&&_analyticsJobConfig$d!==void 0?_analyticsJobConfig$d:"",resultsField:analyticsJobConfig.dest.results_field,sourceIndex:Array.isArray(analyticsJobConfig.source.index)?analyticsJobConfig.source.index.join(","):analyticsJobConfig.source.index,modelMemoryLimit:analyticsJobConfig.model_memory_limit,maxNumThreads:analyticsJobConfig.max_num_threads,includes:(_analyticsJobConfig$a=(_analyticsJobConfig$a2=analyticsJobConfig.analyzed_fields)===null||_analyticsJobConfig$a2===void 0?void 0:_analyticsJobConfig$a2.includes)!==null&&_analyticsJobConfig$a!==void 0?_analyticsJobConfig$a:[],jobConfigQuery:analyticsJobConfig.source.query||_common_analytics__WEBPACK_IMPORTED_MODULE_2__["q"]};if(isClone===false){var _analyticsJobConfig$d2;resultState.destinationIndex=(_analyticsJobConfig$d2=analyticsJobConfig===null||analyticsJobConfig===void 0?void 0:analyticsJobConfig.dest.index)!==null&&_analyticsJobConfig$d2!==void 0?_analyticsJobConfig$d2:""}const analysisConfig=analyticsJobConfig.analysis[jobType];for(const key in analysisConfig){if(analysisConfig.hasOwnProperty(key)){const camelCased=toCamelCase(key);resultState[camelCased]=analysisConfig[key]}}return resultState}},function(module,exports,__webpack_require__){var isFunction=__webpack_require__(163),isLength=__webpack_require__(236);function isArrayLike(value){return value!=null&&isLength(value.length)&&!isFunction(value)}module.exports=isArrayLike},function(module,exports,__webpack_require__){var baseMatches=__webpack_require__(551),baseMatchesProperty=__webpack_require__(561),identity=__webpack_require__(138),isArray=__webpack_require__(77),property=__webpack_require__(568);function baseIteratee(value){if(typeof value=="function"){return value}if(value==null){return identity}if(typeof value=="object"){return isArray(value)?baseMatchesProperty(value[0],value[1]):baseMatches(value)}return property(value)}module.exports=baseIteratee},function(module,__webpack_exports__,__webpack_require__){"use strict";var _check_ml_nodes__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(80);__webpack_require__.d(__webpack_exports__,"a",(function(){return _check_ml_nodes__WEBPACK_IMPORTED_MODULE_0__["a"]}));__webpack_require__.d(__webpack_exports__,"b",(function(){return _check_ml_nodes__WEBPACK_IMPORTED_MODULE_0__["c"]}));__webpack_require__.d(__webpack_exports__,"d",(function(){return _check_ml_nodes__WEBPACK_IMPORTED_MODULE_0__["e"]}));__webpack_require__.d(__webpack_exports__,"c",(function(){return _check_ml_nodes__WEBPACK_IMPORTED_MODULE_0__["d"]}));__webpack_require__.d(__webpack_exports__,"e",(function(){return _check_ml_nodes__WEBPACK_IMPORTED_MODULE_0__["f"]}))},,function(module,exports,__webpack_require__){var arrayLikeKeys=__webpack_require__(309),baseKeys=__webpack_require__(238),isArrayLike=__webpack_require__(119);function keys(object){return isArrayLike(object)?arrayLikeKeys(object):baseKeys(object)}module.exports=keys},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return SEVERITY_OPTIONS}));__webpack_require__.d(__webpack_exports__,"c",(function(){return useTableSeverity}));__webpack_require__.d(__webpack_exports__,"b",(function(){return SelectSeverity}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(10);var react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);var _kbn_i18n__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2);var _kbn_i18n__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_kbn_i18n__WEBPACK_IMPORTED_MODULE_1__);var _kbn_i18n_react__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(34);var _kbn_i18n_react__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_kbn_i18n_react__WEBPACK_IMPORTED_MODULE_2__);var _elastic_eui__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(33);var _elastic_eui__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_elastic_eui__WEBPACK_IMPORTED_MODULE_3__);var _common_util_anomaly_utils__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(6);var _util_url_state__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(70);var _common__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(13);const warningLabel=_kbn_i18n__WEBPACK_IMPORTED_MODULE_1__["i18n"].translate("xpack.ml.controls.selectSeverity.warningLabel",{defaultMessage:"warning"});const minorLabel=_kbn_i18n__WEBPACK_IMPORTED_MODULE_1__["i18n"].translate("xpack.ml.controls.selectSeverity.minorLabel",{defaultMessage:"minor"});const majorLabel=_kbn_i18n__WEBPACK_IMPORTED_MODULE_1__["i18n"].translate("xpack.ml.controls.selectSeverity.majorLabel",{defaultMessage:"major"});const criticalLabel=_kbn_i18n__WEBPACK_IMPORTED_MODULE_1__["i18n"].translate("xpack.ml.controls.selectSeverity.criticalLabel",{defaultMessage:"critical"});const optionsMap={[warningLabel]:_common__WEBPACK_IMPORTED_MODULE_6__["ANOMALY_THRESHOLD"].LOW,[minorLabel]:_common__WEBPACK_IMPORTED_MODULE_6__["ANOMALY_THRESHOLD"].MINOR,[majorLabel]:_common__WEBPACK_IMPORTED_MODULE_6__["ANOMALY_THRESHOLD"].MAJOR,[criticalLabel]:_common__WEBPACK_IMPORTED_MODULE_6__["ANOMALY_THRESHOLD"].CRITICAL};const SEVERITY_OPTIONS=[{val:_common__WEBPACK_IMPORTED_MODULE_6__["ANOMALY_THRESHOLD"].LOW,display:warningLabel,color:Object(_common_util_anomaly_utils__WEBPACK_IMPORTED_MODULE_4__["i"])(_common__WEBPACK_IMPORTED_MODULE_6__["ANOMALY_THRESHOLD"].LOW)},{val:_common__WEBPACK_IMPORTED_MODULE_6__["ANOMALY_THRESHOLD"].MINOR,display:minorLabel,color:Object(_common_util_anomaly_utils__WEBPACK_IMPORTED_MODULE_4__["i"])(_common__WEBPACK_IMPORTED_MODULE_6__["ANOMALY_THRESHOLD"].MINOR)},{val:_common__WEBPACK_IMPORTED_MODULE_6__["ANOMALY_THRESHOLD"].MAJOR,display:majorLabel,color:Object(_common_util_anomaly_utils__WEBPACK_IMPORTED_MODULE_4__["i"])(_common__WEBPACK_IMPORTED_MODULE_6__["ANOMALY_THRESHOLD"].MAJOR)},{val:_common__WEBPACK_IMPORTED_MODULE_6__["ANOMALY_THRESHOLD"].CRITICAL,display:criticalLabel,color:Object(_common_util_anomaly_utils__WEBPACK_IMPORTED_MODULE_4__["i"])(_common__WEBPACK_IMPORTED_MODULE_6__["ANOMALY_THRESHOLD"].CRITICAL)}];function optionValueToThreshold(value){let threshold=SEVERITY_OPTIONS.find(opt=>opt.val===value);if(threshold===undefined){threshold=SEVERITY_OPTIONS[0]}return threshold}const TABLE_SEVERITY_DEFAULT=SEVERITY_OPTIONS[0];const useTableSeverity=()=>Object(_util_url_state__WEBPACK_IMPORTED_MODULE_5__["b"])("mlSelectSeverity",TABLE_SEVERITY_DEFAULT);const getSeverityOptions=()=>SEVERITY_OPTIONS.map(({color:color,display:display,val:val})=>({value:display,inputDisplay:react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_0__["Fragment"],null,react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_3__["EuiHealth"],{color:color,style:{lineHeight:"inherit"}},display)),dropdownDisplay:react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_0__["Fragment"],null,react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_3__["EuiHealth"],{color:color,style:{lineHeight:"inherit"}},display),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_3__["EuiSpacer"],{size:"xs"}),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_3__["EuiText"],{size:"xs",color:"subdued"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("p",{className:"euiTextColor--subdued"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_kbn_i18n_react__WEBPACK_IMPORTED_MODULE_2__["FormattedMessage"],{id:"xpack.ml.controls.selectSeverity.scoreDetailsDescription",defaultMessage:"score {value} and above",values:{value:val}}))))}));const SelectSeverity=({classNames:classNames}={classNames:""})=>{const[severity,setSeverity]=useTableSeverity();const onChange=valueDisplay=>{setSeverity(optionValueToThreshold(optionsMap[valueDisplay]))};return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_3__["EuiSuperSelect"],{className:classNames,hasDividers:true,options:getSeverityOptions(),valueOfSelected:severity.display,onChange:onChange})}},,,,,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return annotationsRefresh$}));__webpack_require__.d(__webpack_exports__,"c",(function(){return annotationsRefreshed}));__webpack_require__.d(__webpack_exports__,"a",(function(){return AnnotationUpdatesService}));var rxjs__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(19);var rxjs__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(rxjs__WEBPACK_IMPORTED_MODULE_0__);var rxjs_operators__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(21);var rxjs_operators__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(rxjs_operators__WEBPACK_IMPORTED_MODULE_1__);function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const annotation$=new rxjs__WEBPACK_IMPORTED_MODULE_0__["BehaviorSubject"](null);const annotationsRefresh$=new rxjs__WEBPACK_IMPORTED_MODULE_0__["BehaviorSubject"](Date.now());const annotationsRefreshed=()=>annotationsRefresh$.next(Date.now());class AnnotationUpdatesService{constructor(){_defineProperty(this,"_annotation$",new rxjs__WEBPACK_IMPORTED_MODULE_0__["BehaviorSubject"](null))}update$(){return this._annotation$.asObservable()}isAnnotationInitialized$(){return this._annotation$.asObservable().pipe(Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_1__["distinctUntilChanged"])((prev,curr)=>prev!==null&&curr!==null))}setValue(annotation){this._annotation$.next(annotation)}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"d",(function(){return ANNOTATION_TYPE}));__webpack_require__.d(__webpack_exports__,"c",(function(){return ANNOTATION_MAX_LENGTH_CHARS}));__webpack_require__.d(__webpack_exports__,"b",(function(){return ANNOTATION_EVENT_USER}));__webpack_require__.d(__webpack_exports__,"a",(function(){return ANNOTATION_EVENT_DELAYED_DATA}));let ANNOTATION_TYPE;(function(ANNOTATION_TYPE){ANNOTATION_TYPE["ANNOTATION"]="annotation";ANNOTATION_TYPE["COMMENT"]="comment"})(ANNOTATION_TYPE||(ANNOTATION_TYPE={}));const ANNOTATION_USER_UNKNOWN="<user unknown>";const ANNOTATION_MAX_LENGTH_CHARS=1e3;const ANNOTATION_EVENT_USER="user";const ANNOTATION_EVENT_DELAYED_DATA="delayed_data"},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return MlAnnotationUpdatesContext}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(10);var react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);var _services_annotations_service__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(130);const MlAnnotationUpdatesContext=Object(react__WEBPACK_IMPORTED_MODULE_0__["createContext"])(new _services_annotations_service__WEBPACK_IMPORTED_MODULE_1__["a"])},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"c",(function(){return createEmptyJob}));__webpack_require__.d(__webpack_exports__,"b",(function(){return createEmptyDatafeed}));__webpack_require__.d(__webpack_exports__,"a",(function(){return createBasicDetector}));var _common_types_fields__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(105);var _common_util_job_utils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(64);function createEmptyJob(){return{job_id:"",description:"",groups:[],analysis_config:{bucket_span:"",detectors:[],influencers:[]},data_description:{time_field:""}}}function createEmptyDatafeed(indexPatternTitle){return{datafeed_id:"",job_id:"",indices:Object(_common_util_job_utils__WEBPACK_IMPORTED_MODULE_1__["t"])(indexPatternTitle),query:{}}}function createBasicDetector(agg,field){const dtr={function:agg.id};if(field.id!==_common_types_fields__WEBPACK_IMPORTED_MODULE_0__["a"]){dtr.field_name=field.id}return dtr}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"d",(function(){return isAdvancedConfig}));__webpack_require__.d(__webpack_exports__,"c",(function(){return extractCloningConfig}));__webpack_require__.d(__webpack_exports__,"b",(function(){return cloneActionNameText}));__webpack_require__.d(__webpack_exports__,"e",(function(){return useNavigateToWizardWithClonedJob}));__webpack_require__.d(__webpack_exports__,"a",(function(){return CloneActionName}));var _elastic_eui__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(33);var _elastic_eui__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_elastic_eui__WEBPACK_IMPORTED_MODULE_0__);var react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(10);var react__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_1__);var lodash__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(5);var lodash__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_2__);var _kbn_i18n__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(2);var _kbn_i18n__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(_kbn_i18n__WEBPACK_IMPORTED_MODULE_3__);var _common__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(66);var _common_analytics__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(62);var _common_constants_data_frame_analytics__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(74);var _contexts_kibana__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(58);var _hooks_use_create_analytics_form__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(389);var _common_util_errors__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(20);function isPropDefinition(a){return a.hasOwnProperty("optional")}const getAnalyticsJobMeta=config=>({allow_lazy_start:{optional:true,defaultValue:false},description:{optional:true,formKey:"description"},analysis:{...Object(_common_analytics__WEBPACK_IMPORTED_MODULE_5__["A"])(config.analysis)?{classification:{dependent_variable:{optional:false,formKey:"dependentVariable"},training_percent:{optional:true,formKey:"trainingPercent"},eta:{optional:true,formKey:"eta"},feature_bag_fraction:{optional:true,formKey:"featureBagFraction"},max_trees:{optional:true,formKey:"maxTrees"},gamma:{optional:true,formKey:"gamma"},lambda:{optional:true,formKey:"lambda"},num_top_classes:{optional:true,defaultValue:2,formKey:"numTopClasses"},prediction_field_name:{optional:true,defaultValue:`${config.analysis.classification.dependent_variable}_prediction`,formKey:"predictionFieldName"},randomize_seed:{optional:true,ignore:true,formKey:"randomizeSeed"},num_top_feature_importance_values:{optional:true,defaultValue:_hooks_use_create_analytics_form__WEBPACK_IMPORTED_MODULE_8__["a"],formKey:"numTopFeatureImportanceValues"},class_assignment_objective:{optional:true,defaultValue:"maximize_minimum_recall"},early_stopping_enabled:{optional:true,ignore:true},alpha:{optional:true,formKey:"alpha"},downsample_factor:{optional:true,formKey:"downsampleFactor"},eta_growth_rate_per_tree:{optional:true,formKey:"etaGrowthRatePerTree"},max_optimization_rounds_per_hyperparameter:{optional:true,formKey:"maxOptimizationRoundsPerHyperparameter"},soft_tree_depth_limit:{optional:true,formKey:"softTreeDepthLimit"},soft_tree_depth_tolerance:{optional:true,formKey:"softTreeDepthTolerance"}}}:{},...Object(_common__WEBPACK_IMPORTED_MODULE_4__["D"])(config.analysis)?{outlier_detection:{standardization_enabled:{defaultValue:true,optional:true,formKey:"standardizationEnabled"},compute_feature_influence:{defaultValue:true,optional:true,formKey:"computeFeatureInfluence"},outlier_fraction:{defaultValue:.05,optional:true,formKey:"outlierFraction"},feature_influence_threshold:{optional:true,formKey:"featureInfluenceThreshold"},method:{optional:true,formKey:"method"},n_neighbors:{optional:true,formKey:"nNeighbors"}}}:{},...Object(_common_analytics__WEBPACK_IMPORTED_MODULE_5__["D"])(config.analysis)?{regression:{dependent_variable:{optional:false,formKey:"dependentVariable"},training_percent:{optional:true,formKey:"trainingPercent"},eta:{optional:true,formKey:"eta"},feature_bag_fraction:{optional:true,formKey:"featureBagFraction"},max_trees:{optional:true,formKey:"maxTrees"},gamma:{optional:true,formKey:"gamma"},lambda:{optional:true,formKey:"lambda"},prediction_field_name:{optional:true,defaultValue:`${config.analysis.regression.dependent_variable}_prediction`,formKey:"predictionFieldName"},num_top_feature_importance_values:{optional:true,defaultValue:_hooks_use_create_analytics_form__WEBPACK_IMPORTED_MODULE_8__["a"],formKey:"numTopFeatureImportanceValues"},randomize_seed:{optional:true,ignore:true,formKey:"randomizeSeed"},loss_function:{optional:true,defaultValue:"mse"},loss_function_parameter:{optional:true},early_stopping_enabled:{optional:true,ignore:true},alpha:{optional:true,formKey:"alpha"},downsample_factor:{optional:true,formKey:"downsampleFactor"},eta_growth_rate_per_tree:{optional:true,formKey:"etaGrowthRatePerTree"},max_optimization_rounds_per_hyperparameter:{optional:true,formKey:"maxOptimizationRoundsPerHyperparameter"},soft_tree_depth_limit:{optional:true,formKey:"softTreeDepthLimit"},soft_tree_depth_tolerance:{optional:true,formKey:"softTreeDepthTolerance"}}}:{}},analyzed_fields:{excludes:{optional:true,defaultValue:[]},includes:{optional:true,formKey:"includes",defaultValue:[]}},source:{index:{formKey:"sourceIndex",optional:false},query:{optional:true,defaultValue:{match_all:{}}},_source:{optional:true}},dest:{index:{optional:false,formKey:"destinationIndex"},results_field:{optional:true,formKey:"resultsField",defaultValue:_common_constants_data_frame_analytics__WEBPACK_IMPORTED_MODULE_6__["d"]}},model_memory_limit:{optional:true,formKey:"modelMemoryLimit"},max_num_threads:{optional:true,formKey:"maxNumThreads"}});function isAdvancedConfig(config,meta=getAnalyticsJobMeta(config)){for(const configKey in config){if(config.hasOwnProperty(configKey)){const fieldConfig=config[configKey];const fieldMeta=meta[configKey];if(!fieldMeta){console.info(`Property "${configKey}" is unknown.`);return true}if(isPropDefinition(fieldMeta)){const isAdvancedSetting=fieldMeta.formKey===undefined&&fieldMeta.ignore!==true&&!Object(lodash__WEBPACK_IMPORTED_MODULE_2__["isEqual"])(fieldMeta.defaultValue,fieldConfig);if(isAdvancedSetting){console.info(`Property "${configKey}" is not supported by the form or has a different value to the default.`);return true}}else if(isAdvancedConfig(fieldConfig,fieldMeta)){return true}}}return false}function extractCloningConfig({id:id,...configToClone}){return Object(lodash__WEBPACK_IMPORTED_MODULE_2__["cloneDeep"])({...configToClone,dest:{...configToClone.dest,index:""}})}const cloneActionNameText=_kbn_i18n__WEBPACK_IMPORTED_MODULE_3__["i18n"].translate("xpack.ml.dataframe.analyticsList.cloneActionNameText",{defaultMessage:"Clone"});const useNavigateToWizardWithClonedJob=()=>{const{services:{notifications:{toasts:toasts},savedObjects:savedObjects}}=Object(_contexts_kibana__WEBPACK_IMPORTED_MODULE_7__["b"])();const navigateToPath=Object(_contexts_kibana__WEBPACK_IMPORTED_MODULE_7__["e"])();const savedObjectsClient=savedObjects.client;return async item=>{const sourceIndex=Array.isArray(item.config.source.index)?item.config.source.index.join(","):item.config.source.index;let sourceIndexId;try{const response=await savedObjectsClient.find({type:"index-pattern",perPage:10,search:`"${sourceIndex}"`,searchFields:["title"],fields:["title"]});const ip=response.savedObjects.find(obj=>obj.attributes.title.toLowerCase()===sourceIndex.toLowerCase());if(ip!==undefined){sourceIndexId=ip.id}else{toasts.addDanger(_kbn_i18n__WEBPACK_IMPORTED_MODULE_3__["i18n"].translate("xpack.ml.dataframe.analyticsList.noSourceIndexPatternForClone",{defaultMessage:"Unable to clone the analytics job. No index pattern exists for index {indexPattern}.",values:{indexPattern:sourceIndex}}))}}catch(e){const error=Object(_common_util_errors__WEBPACK_IMPORTED_MODULE_9__["i"])(e);toasts.addDanger(_kbn_i18n__WEBPACK_IMPORTED_MODULE_3__["i18n"].translate("xpack.ml.dataframe.analyticsList.fetchSourceIndexPatternForCloneErrorMessage",{defaultMessage:"An error occurred checking if index pattern {indexPattern} exists: {error}",values:{indexPattern:sourceIndex,error:error}}))}if(sourceIndexId){await navigateToPath(`/data_frame_analytics/new_job?index=${encodeURIComponent(sourceIndexId)}&jobId=${item.config.id}`)}}};const CloneActionName=({isDisabled:isDisabled})=>{if(isDisabled){return react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(_elastic_eui__WEBPACK_IMPORTED_MODULE_0__["EuiToolTip"],{position:"top",content:_kbn_i18n__WEBPACK_IMPORTED_MODULE_3__["i18n"].translate("xpack.ml.dataframe.analyticsList.cloneActionPermissionTooltip",{defaultMessage:"You do not have permission to clone analytics jobs."})},react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_1___default.a.Fragment,null,cloneActionNameText))}return react__WEBPACK_IMPORTED_MODULE_1___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_1___default.a.Fragment,null,cloneActionNameText)}},function(module,exports,__webpack_require__){var baseIsNative=__webpack_require__(506),getValue=__webpack_require__(511);function getNative(object,key){var value=getValue(object,key);return baseIsNative(value)?value:undefined}module.exports=getNative},function(module,exports,__webpack_require__){var Symbol=__webpack_require__(146),getRawTag=__webpack_require__(507),objectToString=__webpack_require__(508);var nullTag="[object Null]",undefinedTag="[object Undefined]";var symToStringTag=Symbol?Symbol.toStringTag:undefined;function baseGetTag(value){if(value==null){return value===undefined?undefinedTag:nullTag}return symToStringTag&&symToStringTag in Object(value)?getRawTag(value):objectToString(value)}module.exports=baseGetTag},function(module,exports,__webpack_require__){var arrayLikeKeys=__webpack_require__(309),baseKeysIn=__webpack_require__(531),isArrayLike=__webpack_require__(119);function keysIn(object){return isArrayLike(object)?arrayLikeKeys(object,true):baseKeysIn(object)}module.exports=keysIn},function(module,exports){function identity(value){return value}module.exports=identity},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"c",(function(){return ColorRangeLegend}));__webpack_require__.d(__webpack_exports__,"d",(function(){return useColorRange}));__webpack_require__.d(__webpack_exports__,"a",(function(){return COLOR_RANGE}));__webpack_require__.d(__webpack_exports__,"b",(function(){return COLOR_RANGE_SCALE}));__webpack_require__.d(__webpack_exports__,"e",(function(){return useCurrentEuiTheme}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var d3=__webpack_require__(100);var d3_default=__webpack_require__.n(d3);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(33);const COLOR_RANGE_RESOLUTION=10;const ColorRangeLegend=({colorRange:colorRange,justifyTicks:justifyTicks=false,showTicks:showTicks=true,title:title,width:width=250})=>{const d3Container=Object(external_kbnSharedDeps_React_["useRef"])(null);const scale=d3_default.a.range(COLOR_RANGE_RESOLUTION+1).map(d=>({offset:d/COLOR_RANGE_RESOLUTION*100,stopColor:colorRange(d/COLOR_RANGE_RESOLUTION)}));Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(d3Container.current===null){return}const wrapperHeight=32;const wrapperWidth=width;const margin={top:2,bottom:20,left:justifyTicks||!showTicks?1:4,right:1};const legendWidth=wrapperWidth-margin.left-margin.right;const legendHeight=wrapperHeight-margin.top-margin.bottom;d3_default.a.select(d3Container.current).selectAll("*").remove();const wrapper=d3_default.a.select(d3Container.current).classed("mlColorRangeLegend",true).attr("width",wrapperWidth).attr("height",wrapperHeight).append("g").attr("transform","translate("+margin.left+","+margin.top+")");const gradient=wrapper.append("defs").append("linearGradient").attr("id","mlColorRangeGradient").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%").attr("spreadMethod","pad");scale.forEach((function(d){gradient.append("stop").attr("offset",`${d.offset}%`).attr("stop-color",d.stopColor).attr("stop-opacity",1)}));wrapper.append("rect").attr("x1",0).attr("y1",0).attr("width",legendWidth).attr("height",legendHeight).style("fill","url(#mlColorRangeGradient)");const axisScale=d3_default.a.scale.linear().domain([0,1]).range([0,legendWidth]);const tickFormat=d3_default.a.format("");const legendAxis=d3_default.a.svg.axis().scale(axisScale).orient("bottom").tickFormat(tickFormat).tickSize(legendHeight+4).ticks(legendWidth/40);wrapper.append("g").attr("class","legend axis").attr("transform","translate(0, 0)").call(legendAxis);if(justifyTicks||!showTicks){const text=wrapper.selectAll("text")[0];if(text.length>1){d3_default.a.select(text[0]).style("text-anchor","start");d3_default.a.select(text[text.length-1]).style("text-anchor","end")}}if(!showTicks){wrapper.selectAll(".axis line").style("display","none")}},[JSON.stringify(scale),d3Container.current]);if(title===undefined){return external_kbnSharedDeps_React_default.a.createElement("svg",{ref:d3Container})}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",color:"subdued"},external_kbnSharedDeps_React_default.a.createElement("p",null,title)),external_kbnSharedDeps_React_default.a.createElement("svg",{ref:d3Container}))};var external_kbnSharedDeps_Theme_euiLightVars_=__webpack_require__(45);var external_kbnSharedDeps_Theme_euiLightVars_default=__webpack_require__.n(external_kbnSharedDeps_Theme_euiLightVars_);var external_kbnSharedDeps_Theme_euiDarkVars_=__webpack_require__(48);var external_kbnSharedDeps_Theme_euiDarkVars_default=__webpack_require__.n(external_kbnSharedDeps_Theme_euiDarkVars_);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);var use_ui_settings_context=__webpack_require__(178);const influencerColorScaleFactory=n=>t=>{if(n<=1){return t}if(t<1/n){return 0}if(t<3/n){return n/4*(t-1/n)}return.5+(t-3/n)};let COLOR_RANGE_SCALE;(function(COLOR_RANGE_SCALE){COLOR_RANGE_SCALE["LINEAR"]="linear";COLOR_RANGE_SCALE["INFLUENCER"]="influencer";COLOR_RANGE_SCALE["SQRT"]="sqrt"})(COLOR_RANGE_SCALE||(COLOR_RANGE_SCALE={}));const colorRangeScaleOptions=[{value:COLOR_RANGE_SCALE.LINEAR,text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.components.colorRangeLegend.linearScaleLabel",{defaultMessage:"Linear"})},{value:COLOR_RANGE_SCALE.INFLUENCER,text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.components.colorRangeLegend.influencerScaleLabel",{defaultMessage:"Influencer custom scale"})},{value:COLOR_RANGE_SCALE.SQRT,text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.components.colorRangeLegend.sqrtScaleLabel",{defaultMessage:"Sqrt"})}];let COLOR_RANGE;(function(COLOR_RANGE){COLOR_RANGE["BLUE"]="blue";COLOR_RANGE["RED"]="red";COLOR_RANGE["RED_GREEN"]="red-green";COLOR_RANGE["GREEN_RED"]="green-red";COLOR_RANGE["YELLOW_GREEN_BLUE"]="yellow-green-blue"})(COLOR_RANGE||(COLOR_RANGE={}));const colorRangeOptions=[{value:COLOR_RANGE.BLUE,text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.components.colorRangeLegend.blueColorRangeLabel",{defaultMessage:"Blue"})},{value:COLOR_RANGE.RED,text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.components.colorRangeLegend.redColorRangeLabel",{defaultMessage:"Red"})},{value:COLOR_RANGE.RED_GREEN,text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.components.colorRangeLegend.redGreenColorRangeLabel",{defaultMessage:"Red - Green"})},{value:COLOR_RANGE.GREEN_RED,text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.components.colorRangeLegend.greenRedColorRangeLabel",{defaultMessage:"Green - Red"})},{value:COLOR_RANGE.YELLOW_GREEN_BLUE,text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.components.colorRangeLegend.yellowGreenBlueColorRangeLabel",{defaultMessage:"Yellow - Green - Blue"})}];const coloursYGB=["#FFFFDD","#AAF191","#80D385","#61B385","#3E9583","#217681","#285285","#1F2D86","#000086"];const colourRangeYGB=d3_default.a.range(0,1,1/(coloursYGB.length-1));colourRangeYGB.push(1);const colorDomains={[COLOR_RANGE.BLUE]:[0,1],[COLOR_RANGE.RED]:[0,1],[COLOR_RANGE.RED_GREEN]:[0,1],[COLOR_RANGE.GREEN_RED]:[0,1],[COLOR_RANGE.YELLOW_GREEN_BLUE]:colourRangeYGB};const useColorRange=(colorRange=COLOR_RANGE.BLUE,colorRangeScale=COLOR_RANGE_SCALE.LINEAR,featureCount=1)=>{const{euiTheme:euiTheme}=useCurrentEuiTheme();const colorRanges={[COLOR_RANGE.BLUE]:[d3_default.a.rgb(euiTheme.euiColorEmptyShade).toString(),d3_default.a.rgb(euiTheme.euiColorVis1).toString()],[COLOR_RANGE.RED]:[d3_default.a.rgb(euiTheme.euiColorEmptyShade).toString(),d3_default.a.rgb(euiTheme.euiColorDanger).toString()],[COLOR_RANGE.RED_GREEN]:["red","green"],[COLOR_RANGE.GREEN_RED]:["green","red"],[COLOR_RANGE.YELLOW_GREEN_BLUE]:coloursYGB};const linearScale=d3_default.a.scale.linear().domain(colorDomains[colorRange]).range(colorRanges[colorRange]);const influencerColorScale=influencerColorScaleFactory(featureCount);const influencerScaleLinearWrapper=n=>linearScale(influencerColorScale(n));const scaleTypes={[COLOR_RANGE_SCALE.LINEAR]:linearScale,[COLOR_RANGE_SCALE.INFLUENCER]:influencerScaleLinearWrapper,[COLOR_RANGE_SCALE.SQRT]:d3_default.a.scale.sqrt().domain(colorDomains[colorRange]).range(colorRanges[colorRange])};return scaleTypes[colorRangeScale]};function useCurrentEuiTheme(){const uiSettings=Object(use_ui_settings_context["a"])();return Object(external_kbnSharedDeps_React_["useMemo"])(()=>({euiTheme:uiSettings.get("theme:darkMode")?external_kbnSharedDeps_Theme_euiDarkVars_default.a:external_kbnSharedDeps_Theme_euiLightVars_default.a}),[uiSettings])}},,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return tabColor}));var _elastic_eui_dist_eui_theme_dark_json__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(48);var _elastic_eui_dist_eui_theme_dark_json__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_elastic_eui_dist_eui_theme_dark_json__WEBPACK_IMPORTED_MODULE_0__);var _string_utils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(8);const COLORS=[_elastic_eui_dist_eui_theme_dark_json__WEBPACK_IMPORTED_MODULE_0___default.a.euiColorVis0,_elastic_eui_dist_eui_theme_dark_json__WEBPACK_IMPORTED_MODULE_0___default.a.euiColorVis1,_elastic_eui_dist_eui_theme_dark_json__WEBPACK_IMPORTED_MODULE_0___default.a.euiColorVis2,_elastic_eui_dist_eui_theme_dark_json__WEBPACK_IMPORTED_MODULE_0___default.a.euiColorVis3,_elastic_eui_dist_eui_theme_dark_json__WEBPACK_IMPORTED_MODULE_0___default.a.euiColorVis4,_elastic_eui_dist_eui_theme_dark_json__WEBPACK_IMPORTED_MODULE_0___default.a.euiColorVis5,_elastic_eui_dist_eui_theme_dark_json__WEBPACK_IMPORTED_MODULE_0___default.a.euiColorVis6,_elastic_eui_dist_eui_theme_dark_json__WEBPACK_IMPORTED_MODULE_0___default.a.euiColorVis7,_elastic_eui_dist_eui_theme_dark_json__WEBPACK_IMPORTED_MODULE_0___default.a.euiColorVis8,_elastic_eui_dist_eui_theme_dark_json__WEBPACK_IMPORTED_MODULE_0___default.a.euiColorVis9,_elastic_eui_dist_eui_theme_dark_json__WEBPACK_IMPORTED_MODULE_0___default.a.euiColorDarkShade,_elastic_eui_dist_eui_theme_dark_json__WEBPACK_IMPORTED_MODULE_0___default.a.euiColorPrimary];const colorMap={};function tabColor(name){if(colorMap[name]===undefined){const n=Object(_string_utils__WEBPACK_IMPORTED_MODULE_1__["c"])(name);const color=COLORS[n%COLORS.length];colorMap[name]=color;return color}else{return colorMap[name]}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return roundToDecimalPlace}));function roundToDecimalPlace(num,dp=2){if(num===undefined)return"";if(num%1===0){return num}if(Math.abs(num)<Math.pow(10,-dp)){return Number.parseFloat(String(num)).toExponential(2)}const m=Math.pow(10,dp);return Math.round(num*m)/m}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"e",(function(){return replaceTokensInUrlValue}));__webpack_require__.d(__webpack_exports__,"a",(function(){return getUrlForRecord}));__webpack_require__.d(__webpack_exports__,"d",(function(){return openCustomUrlWindow}));__webpack_require__.d(__webpack_exports__,"b",(function(){return isValidLabel}));__webpack_require__.d(__webpack_exports__,"c",(function(){return isValidTimeRange}));var lodash__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5);var lodash__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);var moment__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(12);var moment__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(moment__WEBPACK_IMPORTED_MODULE_1__);var rison_node__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(179);var rison_node__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(rison_node__WEBPACK_IMPORTED_MODULE_2__);var _common_util_parse_interval__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(22);var _string_utils__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(84);const TIME_RANGE_AUTO="auto";function replaceTokensInUrlValue(customUrlConfig,jobBucketSpanSecs,doc,timeFieldName){const urlValue=customUrlConfig.url_value;const timestamp=doc[timeFieldName];const timeRangeInterval="time_range"in customUrlConfig&&customUrlConfig.time_range?Object(_common_util_parse_interval__WEBPACK_IMPORTED_MODULE_3__["a"])(customUrlConfig.time_range):null;const record={...doc};if(urlValue.includes("$earliest$")){const earliestMoment=moment__WEBPACK_IMPORTED_MODULE_1___default()(timestamp);if(timeRangeInterval!==null){earliestMoment.subtract(timeRangeInterval)}else{earliestMoment.subtract(jobBucketSpanSecs,"s")}record.earliest=earliestMoment.toISOString()}if(urlValue.includes("$latest$")){const latestMoment=moment__WEBPACK_IMPORTED_MODULE_1___default()(timestamp).add(jobBucketSpanSecs,"s");if(timeRangeInterval!==null){latestMoment.add(timeRangeInterval)}else{latestMoment.add(jobBucketSpanSecs,"s")}record.latest=latestMoment.toISOString()}return getUrlForRecord(customUrlConfig,record)}function getUrlForRecord(urlConfig,record){if(isKibanaUrl(urlConfig)===true){return buildKibanaUrl(urlConfig,record)}else{const urlPath=Object(_string_utils__WEBPACK_IMPORTED_MODULE_4__["e"])(urlConfig.url_value,record,false);return urlPath}}function openCustomUrlWindow(url,urlConfig,basePath){if(/^(?:[a-z]+:)?\/\//i.test(urlConfig.url_value)===false){if(url.charAt(0)!=="/"){url=`${basePath}${isKibanaUrl(urlConfig)?"/app/":"/"}${url}`}window.open(url,"_blank")}else{const newWindow=window.open(url,"_blank","noopener,noreferrer");if(newWindow!==undefined&&newWindow!==null){newWindow.opener=null}}}function isKibanaUrl(urlConfig){const urlValue=urlConfig.url_value;return urlValue.startsWith("discover#/")||urlValue.startsWith("dashboards#/")||urlValue.startsWith("apm#/")||urlValue.startsWith("metrics/")||urlValue.startsWith("security/")||urlValue.startsWith("siem#/")}function escapeForKQL(value){return String(value).replace(/\"/g,'\\"')}const isRisonObject=value=>value!==null&&typeof value==="object";const getQueryStringResultProvider=(record,getResultTokenValue)=>(resultPrefix,queryString,resultPostfix)=>{const URL_LENGTH_LIMIT=2e3;let availableCharactersLeft=URL_LENGTH_LIMIT-resultPrefix.length-resultPostfix.length;const queryFields=queryString.split(/\sand\s/i).map(v=>String(v.split(/:(.+)?\$/)[0]).trim());const queryParts=[];const joinOperator=" AND ";fieldsLoop:for(let i=0;i<queryFields.length;i++){const field=queryFields[i];let tokenValues=Object(lodash__WEBPACK_IMPORTED_MODULE_0__["get"])(record,field)||null;if(tokenValues===null){continue}tokenValues=Array.isArray(tokenValues)?tokenValues:[tokenValues];let result="";for(let j=0;j<tokenValues.length;j++){const part=`${j>0?" OR ":""}${field}:"${getResultTokenValue(tokenValues[j])}"`;if(availableCharactersLeft<part.length){if(result.length>0){queryParts.push(j>0?`(${result})`:result)}break fieldsLoop}result+=part;availableCharactersLeft-=result.length}if(result.length>0){queryParts.push(tokenValues.length>1?`(${result})`:result)}}return queryParts.join(joinOperator)};function buildKibanaUrl(urlConfig,record){const urlValue=urlConfig.url_value;const isLuceneQueryLanguage=urlValue.includes("language:lucene");const queryLanguageEscapeCallback=isLuceneQueryLanguage?_string_utils__WEBPACK_IMPORTED_MODULE_4__["c"]:escapeForKQL;const commonEscapeCallback=Object(lodash__WEBPACK_IMPORTED_MODULE_0__["flow"])(encodeURIComponent);const replaceSingleTokenValues=str=>{const getResultTokenValue=Object(lodash__WEBPACK_IMPORTED_MODULE_0__["flow"])(isLuceneQueryLanguage?v=>v:queryLanguageEscapeCallback,commonEscapeCallback);return str.replace(/\$([^?&$\'"]+)\$(\/)?/g,(match,name,slash="")=>{let tokenValue=Object(lodash__WEBPACK_IMPORTED_MODULE_0__["get"])(record,name);tokenValue=Array.isArray(tokenValue)?tokenValue[0]:tokenValue;return tokenValue===undefined?"":getResultTokenValue(tokenValue)+slash})};return Object(lodash__WEBPACK_IMPORTED_MODULE_0__["flow"])(str=>str.replace("$earliest$",record.earliest).replace("$latest$",record.latest),decodeURIComponent,str=>{const getResultTokenValue=Object(lodash__WEBPACK_IMPORTED_MODULE_0__["flow"])(queryLanguageEscapeCallback,commonEscapeCallback);const getQueryStringResult=getQueryStringResultProvider(record,getResultTokenValue);const match=str.match(/(.+)(\(.*\blanguage:(?:lucene|kuery)\b.*?\))(.+)/);if(match!==null&&match[2]!==undefined){const[,prefix,queryDef,postfix]=match;const q=rison_node__WEBPACK_IMPORTED_MODULE_2___default.a.decode(queryDef);if(isRisonObject(q)&&q.hasOwnProperty("query")){const[resultPrefix,resultPostfix]=[prefix,postfix].map(replaceSingleTokenValues);const resultQuery=getQueryStringResult(resultPrefix,q.query,resultPostfix);return`${resultPrefix}${rison_node__WEBPACK_IMPORTED_MODULE_2___default.a.encode({...q,query:resultQuery})}${resultPostfix}`}}return str.replace(/(.+&kuery=)(.*?)[^!](&.+)/,(fullMatch,prefix,queryString,postfix)=>{const[resultPrefix,resultPostfix]=[prefix,postfix].map(replaceSingleTokenValues);const resultQuery=getQueryStringResult(resultPrefix,queryString,resultPostfix);return`${resultPrefix}${resultQuery}${resultPostfix}`})},replaceSingleTokenValues)(urlValue)}function isValidLabel(label,savedCustomUrls){let isValid=label!==undefined&&label.trim().length>0;if(isValid===true&&savedCustomUrls!==undefined){const existingLabels=savedCustomUrls.map(customUrl=>customUrl.url_name);isValid=!existingLabels.includes(label)}return isValid}function isValidTimeRange(timeRange){if(timeRange===undefined||timeRange.length===0||timeRange===TIME_RANGE_AUTO){return true}const interval=Object(_common_util_parse_interval__WEBPACK_IMPORTED_MODULE_3__["a"])(timeRange);return interval!==null}},function(module,exports){function eq(value,other){return value===other||value!==value&&other!==other}module.exports=eq},function(module,exports,__webpack_require__){var root=__webpack_require__(108);var Symbol=root.Symbol;module.exports=Symbol},function(module,exports,__webpack_require__){(function(module){var root=__webpack_require__(108),stubFalse=__webpack_require__(527);var freeExports=true&&exports&&!exports.nodeType&&exports;var freeModule=freeExports&&typeof module=="object"&&module&&!module.nodeType&&module;var moduleExports=freeModule&&freeModule.exports===freeExports;var Buffer=moduleExports?root.Buffer:undefined;var nativeIsBuffer=Buffer?Buffer.isBuffer:undefined;var isBuffer=nativeIsBuffer||stubFalse;module.exports=isBuffer}).call(this,__webpack_require__(158)(module))},function(module,exports,__webpack_require__){var DataView=__webpack_require__(536),Map=__webpack_require__(233),Promise=__webpack_require__(537),Set=__webpack_require__(318),WeakMap=__webpack_require__(538),baseGetTag=__webpack_require__(136),toSource=__webpack_require__(307);var mapTag="[object Map]",objectTag="[object Object]",promiseTag="[object Promise]",setTag="[object Set]",weakMapTag="[object WeakMap]";var dataViewTag="[object DataView]";var dataViewCtorString=toSource(DataView),mapCtorString=toSource(Map),promiseCtorString=toSource(Promise),setCtorString=toSource(Set),weakMapCtorString=toSource(WeakMap);var getTag=baseGetTag;if(DataView&&getTag(new DataView(new ArrayBuffer(1)))!=dataViewTag||Map&&getTag(new Map)!=mapTag||Promise&&getTag(Promise.resolve())!=promiseTag||Set&&getTag(new Set)!=setTag||WeakMap&&getTag(new WeakMap)!=weakMapTag){getTag=function(value){var result=baseGetTag(value),Ctor=result==objectTag?value.constructor:undefined,ctorString=Ctor?toSource(Ctor):"";if(ctorString){switch(ctorString){case dataViewCtorString:return dataViewTag;case mapCtorString:return mapTag;case promiseCtorString:return promiseTag;case setCtorString:return setTag;case weakMapCtorString:return weakMapTag}}return result}}module.exports=getTag},function(module,exports,__webpack_require__){var baseGetTag=__webpack_require__(136),isObjectLike=__webpack_require__(113);var symbolTag="[object Symbol]";function isSymbol(value){return typeof value=="symbol"||isObjectLike(value)&&baseGetTag(value)==symbolTag}module.exports=isSymbol},,,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return JobsAwaitingNodeWarning}));__webpack_require__.d(__webpack_exports__,"b",(function(){return NewJobAwaitingNodeWarning}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(33);var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(34);var ml_nodes_check=__webpack_require__(121);const JobsAwaitingNodeWarning=({jobCount:jobCount})=>{if(Object(ml_nodes_check["c"])()===false||jobCount===0){return null}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsAwaitingNodeWarning.title",defaultMessage:"Awaiting machine learning node"}),color:"primary",iconType:"iInCircle"},external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsAwaitingNodeWarning.noMLNodesAvailableDescription",defaultMessage:"There {jobCount, plural, one {is} other {are}} {jobCount, plural, one {# job} other {# jobs}} waiting for machine learning nodes to start.",values:{jobCount:jobCount}}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}))};const NewJobAwaitingNodeWarning=()=>{if(Object(ml_nodes_check["c"])()===false){return null}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsAwaitingNodeWarning.title",defaultMessage:"Awaiting machine learning node"}),color:"primary",iconType:"iInCircle"},external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJobAwaitingNodeWarning.noMLNodesAvailableDescription",defaultMessage:"There are currently no nodes that can run the job, therefore it will remain in OPENING state until an appropriate node becomes available."}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}))}},,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return NUMBER_OF_CATEGORY_EXAMPLES}));__webpack_require__.d(__webpack_exports__,"a",(function(){return CATEGORY_EXAMPLES_VALIDATION_STATUS}));__webpack_require__.d(__webpack_exports__,"c",(function(){return VALIDATION_CHECK_DESCRIPTION}));var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);let VALIDATION_RESULT;(function(VALIDATION_RESULT){VALIDATION_RESULT[VALIDATION_RESULT["NO_EXAMPLES"]=0]="NO_EXAMPLES";VALIDATION_RESULT[VALIDATION_RESULT["FAILED_TO_TOKENIZE"]=1]="FAILED_TO_TOKENIZE";VALIDATION_RESULT[VALIDATION_RESULT["TOO_MANY_TOKENS"]=2]="TOO_MANY_TOKENS";VALIDATION_RESULT[VALIDATION_RESULT["TOKEN_COUNT"]=3]="TOKEN_COUNT";VALIDATION_RESULT[VALIDATION_RESULT["MEDIAN_LINE_LENGTH"]=4]="MEDIAN_LINE_LENGTH";VALIDATION_RESULT[VALIDATION_RESULT["NULL_VALUES"]=5]="NULL_VALUES";VALIDATION_RESULT[VALIDATION_RESULT["INSUFFICIENT_PRIVILEGES"]=6]="INSUFFICIENT_PRIVILEGES"})(VALIDATION_RESULT||(VALIDATION_RESULT={}));const NUMBER_OF_CATEGORY_EXAMPLES=5;const CATEGORY_EXAMPLES_SAMPLE_SIZE=1e3;const CATEGORY_EXAMPLES_WARNING_LIMIT=.75;const CATEGORY_EXAMPLES_ERROR_LIMIT=.02;const VALID_TOKEN_COUNT=3;const MEDIAN_LINE_LENGTH_LIMIT=400;const NULL_COUNT_PERCENT_LIMIT=.75;let CATEGORY_EXAMPLES_VALIDATION_STATUS;(function(CATEGORY_EXAMPLES_VALIDATION_STATUS){CATEGORY_EXAMPLES_VALIDATION_STATUS["VALID"]="valid";CATEGORY_EXAMPLES_VALIDATION_STATUS["PARTIALLY_VALID"]="partially_valid";CATEGORY_EXAMPLES_VALIDATION_STATUS["INVALID"]="invalid"})(CATEGORY_EXAMPLES_VALIDATION_STATUS||(CATEGORY_EXAMPLES_VALIDATION_STATUS={}));const VALIDATION_CHECK_DESCRIPTION={[VALIDATION_RESULT.NO_EXAMPLES]:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.models.jobService.categorization.messages.validNoDataFound",{defaultMessage:"Examples  were successfully loaded."}),[VALIDATION_RESULT.FAILED_TO_TOKENIZE]:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.models.jobService.categorization.messages.validFailureToGetTokens",{defaultMessage:"The examples loaded were tokenized successfully."}),[VALIDATION_RESULT.TOKEN_COUNT]:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.models.jobService.categorization.messages.validTokenLength",{defaultMessage:"More than {tokenCount} tokens per example were found in over {percentage}% of the examples loaded.",values:{percentage:Math.floor(CATEGORY_EXAMPLES_WARNING_LIMIT*100),tokenCount:VALID_TOKEN_COUNT}}),[VALIDATION_RESULT.MEDIAN_LINE_LENGTH]:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.models.jobService.categorization.messages.validMedianLineLength",{defaultMessage:"The median line length of the examples loaded was less than {medianCharCount} characters.",values:{medianCharCount:MEDIAN_LINE_LENGTH_LIMIT}}),[VALIDATION_RESULT.NULL_VALUES]:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.models.jobService.categorization.messages.validNullValues",{defaultMessage:"Less than {percentage}% of the examples loaded were null.",values:{percentage:Math.floor(100-NULL_COUNT_PERCENT_LIMIT*100)}}),[VALIDATION_RESULT.TOO_MANY_TOKENS]:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.models.jobService.categorization.messages.validTooManyTokens",{defaultMessage:"Less than 10000 tokens were found in total in the examples loaded."}),[VALIDATION_RESULT.INSUFFICIENT_PRIVILEGES]:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.models.jobService.categorization.messages.validUserPrivileges",{defaultMessage:"The user has sufficient privileges to perform the checks."})}},,,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return collapseLiteralStrings}));__webpack_require__.d(__webpack_exports__,"c",(function(){return expandLiteralStrings}));var _src_plugins_es_ui_shared_public__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(56);var _src_plugins_es_ui_shared_public__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_src_plugins_es_ui_shared_public__WEBPACK_IMPORTED_MODULE_0__);var _kbn_ace__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(290);var _kbn_ace__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_kbn_ace__WEBPACK_IMPORTED_MODULE_1__);__webpack_require__.d(__webpack_exports__,"a",(function(){return _kbn_ace__WEBPACK_IMPORTED_MODULE_1__["XJsonMode"]}));const{collapseLiteralStrings:collapseLiteralStrings,expandLiteralStrings:expandLiteralStrings}=_src_plugins_es_ui_shared_public__WEBPACK_IMPORTED_MODULE_0__["XJson"]},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return mlForecastService}));var lodash__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5);var lodash__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);var rxjs_operators__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(21);var rxjs_operators__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(rxjs_operators__WEBPACK_IMPORTED_MODULE_1__);var _ml_api_service__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(59);function getForecastsSummary(job,query,earliestMs,maxResults){return new Promise((resolve,reject)=>{const obj={success:true,forecasts:[]};const filterCriteria=[{term:{result_type:"model_forecast_request_stats"}},{term:{job_id:job.job_id}},{range:{timestamp:{gte:earliestMs,format:"epoch_millis"}}}];if(query){filterCriteria.push(query)}_ml_api_service__WEBPACK_IMPORTED_MODULE_2__["ml"].results.anomalySearch({size:maxResults,body:{query:{bool:{filter:filterCriteria}},sort:[{forecast_create_timestamp:{order:"desc"}}]}},[job.job_id]).then(resp=>{if(resp.hits.total.value>0){obj.forecasts=resp.hits.hits.map(hit=>hit._source)}resolve(obj)}).catch(resp=>{reject(resp)})})}function getForecastDateRange(job,forecastId){return new Promise((resolve,reject)=>{const obj={success:true,earliest:null,latest:null};const filterCriteria=[{query_string:{query:"result_type:model_forecast",analyze_wildcard:true}},{term:{job_id:job.job_id}},{term:{forecast_id:forecastId}}];_ml_api_service__WEBPACK_IMPORTED_MODULE_2__["ml"].results.anomalySearch({size:0,body:{query:{bool:{filter:filterCriteria}},aggs:{earliest:{min:{field:"timestamp"}},latest:{max:{field:"timestamp"}}}}},[job.job_id]).then(resp=>{obj.earliest=Object(lodash__WEBPACK_IMPORTED_MODULE_0__["get"])(resp,"aggregations.earliest.value",null);obj.latest=Object(lodash__WEBPACK_IMPORTED_MODULE_0__["get"])(resp,"aggregations.latest.value",null);if(obj.earliest===null||obj.latest===null){reject(resp)}else{resolve(obj)}}).catch(resp=>{reject(resp)})})}function getForecastData(job,detectorIndex,forecastId,entityFields,earliestMs,latestMs,intervalMs,aggType){const criteriaFields=[];const detector=job.analysis_config.detectors[detectorIndex];if(detector.partition_field_name!==undefined){const partitionEntity=Object(lodash__WEBPACK_IMPORTED_MODULE_0__["find"])(entityFields,{fieldName:detector.partition_field_name});if(partitionEntity!==undefined){criteriaFields.push({fieldName:"partition_field_name",fieldValue:partitionEntity.fieldName},{fieldName:"partition_field_value",fieldValue:partitionEntity.fieldValue})}}if(detector.over_field_name!==undefined){const overEntity=Object(lodash__WEBPACK_IMPORTED_MODULE_0__["find"])(entityFields,{fieldName:detector.over_field_name});if(overEntity!==undefined){criteriaFields.push({fieldName:"over_field_name",fieldValue:overEntity.fieldName},{fieldName:"over_field_value",fieldValue:overEntity.fieldValue})}}if(detector.by_field_name!==undefined){const byEntity=Object(lodash__WEBPACK_IMPORTED_MODULE_0__["find"])(entityFields,{fieldName:detector.by_field_name});if(byEntity!==undefined){criteriaFields.push({fieldName:"by_field_name",fieldValue:byEntity.fieldName},{fieldName:"by_field_value",fieldValue:byEntity.fieldValue})}}const obj={success:true,results:{}};const filterCriteria=[{query_string:{query:"result_type:model_forecast",analyze_wildcard:true}},{term:{job_id:job.job_id}},{term:{forecast_id:forecastId}},{term:{detector_index:detectorIndex}},{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}}];Object(lodash__WEBPACK_IMPORTED_MODULE_0__["each"])(criteriaFields,criteria=>{filterCriteria.push({term:{[criteria.fieldName]:criteria.fieldValue}})});const forecastAggs=aggType===undefined?{avg:"avg",max:"max",min:"min"}:{avg:aggType.avg,max:aggType.max,min:aggType.min};return _ml_api_service__WEBPACK_IMPORTED_MODULE_2__["ml"].results.anomalySearch$({size:0,body:{query:{bool:{filter:filterCriteria}},aggs:{times:{date_histogram:{field:"timestamp",fixed_interval:`${intervalMs}ms`,min_doc_count:1},aggs:{prediction:{[forecastAggs.avg]:{field:"forecast_prediction"}},forecastUpper:{[forecastAggs.max]:{field:"forecast_upper"}},forecastLower:{[forecastAggs.min]:{field:"forecast_lower"}}}}}}},[job.job_id]).pipe(Object(rxjs_operators__WEBPACK_IMPORTED_MODULE_1__["map"])(resp=>{const aggregationsByTime=Object(lodash__WEBPACK_IMPORTED_MODULE_0__["get"])(resp,["aggregations","times","buckets"],[]);Object(lodash__WEBPACK_IMPORTED_MODULE_0__["each"])(aggregationsByTime,dataForTime=>{const time=dataForTime.key;obj.results[time]={prediction:Object(lodash__WEBPACK_IMPORTED_MODULE_0__["get"])(dataForTime,["prediction","value"]),forecastUpper:Object(lodash__WEBPACK_IMPORTED_MODULE_0__["get"])(dataForTime,["forecastUpper","value"]),forecastLower:Object(lodash__WEBPACK_IMPORTED_MODULE_0__["get"])(dataForTime,["forecastLower","value"])}});return obj}))}function runForecast(jobId,duration){console.log("ML forecast service run forecast with duration:",duration);return new Promise((resolve,reject)=>{_ml_api_service__WEBPACK_IMPORTED_MODULE_2__["ml"].forecast({jobId:jobId,duration:duration}).then(resp=>{resolve(resp)}).catch(err=>{reject(err)})})}function getForecastRequestStats(job,forecastId){return new Promise((resolve,reject)=>{const obj={success:true,stats:{}};const filterCriteria=[{query_string:{query:"result_type:model_forecast_request_stats",analyze_wildcard:true}},{term:{job_id:job.job_id}},{term:{forecast_id:forecastId}}];_ml_api_service__WEBPACK_IMPORTED_MODULE_2__["ml"].results.anomalySearch({size:1,body:{query:{bool:{filter:filterCriteria}}}},[job.job_id]).then(resp=>{if(resp.hits.total.value>0){obj.stats=resp.hits.hits[0]._source}resolve(obj)}).catch(resp=>{reject(resp)})})}const mlForecastService={getForecastsSummary:getForecastsSummary,getForecastDateRange:getForecastDateRange,getForecastData:getForecastData,runForecast:runForecast,getForecastRequestStats:getForecastRequestStats}},function(module,exports,__webpack_require__){(function(Buffer){var RRule=__webpack_require__(189).RRule;function pad(n,d){d=d||2;var neg=n<0;if(neg)n*=-1;n=n.toString();var zeroes="000000000000000000";return(neg?"-":"")+zeroes.substr(0,d-n.length)+n}var _types={BINARY:{format:function(value){return value.toString("base64")},parse:function(value){return new Buffer(value,"base64")}},BOOLEAN:{format:function(value){return value?"TRUE":"FALSE"},parse:function(value){return value.toUpperCase()=="TRUE"}},"CAL-ADDRESS":{format:function(value){var v=value.toString();if(v.lastIndexOf("mailto:")!=0)v="mailto:"+v;return v}},DATE:{format:function(value){if(!(value instanceof Date))value=new Date(value);return value.getFullYear()+pad(value.getMonth()+1)+pad(value.getDate())},parse:function(value){var dt=new Date(parseInt(value.substr(0,4),10),parseInt(value.substr(4,2),10)-1,parseInt(value.substr(6,2),10),0,0,0);dt.date_only=true;return dt}},"DATE-TIME":{format:function(value,parameters){if(!(value instanceof Date))value=new Date(value);if(value.date_only||parameters["VALUE"]==="DATE")return format_value("DATE",value);return value.getUTCFullYear()+pad(value.getUTCMonth()+1)+pad(value.getUTCDate())+"T"+format_value("TIME",value)},parse:function(value,parameters,calendar){if(parameters["VALUE"]==="DATE"||value.length<=8)return _types["DATE"].parse(value);var tz=parameters["TZID"];var d=[parseInt(value.substr(0,4),10),parseInt(value.substr(4,2),10),parseInt(value.substr(6,2),10),parseInt(value.substr(9,2),10),parseInt(value.substr(11,2),10),parseInt(value.substr(13,2),10)];var utc=value.length>15?value[15]==="Z":false;if(tz!==undefined){var tzobj=calendar.timezone(tz);if(!tzobj)throw new Error("Unable to load TZ data for "+tz);return tzobj.fromLocalTime(d)}d[1]-=1;if(utc)return new Date(Date.UTC.apply(null,d));else return new Date(d[0],d[1],d[2],d[3],d[4],d[5])}},DURATION:{format:function(value){var neg=value<0;if(neg)value*=-1;var w=Math.floor(value/(60*60*24*7));value-=w*60*60*24*7;var d=Math.floor(value/(60*60*24));value-=d*60*60*24;var h=Math.floor(value/(60*60));value-=h*60*60;var m=Math.floor(value/60);value-=m*60;var s=value;var dur=["P"];if(neg)dur.unshift("-");if(w)dur.push(w+"W");if(d)dur.push(d+"D");if(h||m||s)dur.push("T");if(h)dur.push(h+"H");if(m)dur.push(m+"M");if(s)dur.push(s+"S");return dur.join("")},parse:function(value){var match=/(-)?P(\d+W)?(\d+D)?(?:T(\d+H)?(\d+M)?(\d+S)?)?/.exec(value).slice(1);var mul=[-1,60*60*24*7,60*60*24,60*60,60,1];var dur=0;for(var i=1;i<match.length;++i){if(match[i]!==undefined)dur+=parseInt(match[i],10)*mul[i]}if(match[0]!==undefined)dur*=mul[0];return dur}},FLOAT:{format:function(value){return value.toString()}},INTEGER:{format:function(value){return value.toString()}},PERIOD:{format:function(value){var start=format_value("DATE-TIME",value[0]);var end=format_value(value[1]instanceof Date?"DATE-TIME":"DURATION",value[1]);return start+"/"+end}},RECUR:{format:function(value){return(value instanceof RRule?value:new RRule(value)).toString()},parse:function(value){return RRule.parse(value)}},TEXT:{format:function(value){return(value||"").toString().replace(/([\\,;])/g,"\\$1").replace(/\n/g,"\\n")},parse:function(value){return value.replace(/\\([\\,;])/g,"$1").replace(/\\[nN]/g,"\n")}},TIME:{format:function(value){if(!(value instanceof Date))value=new Date(value);return pad(value.getUTCHours())+pad(value.getUTCMinutes())+pad(value.getUTCSeconds())+"Z"},parse:function(value){var utc=value.length>6?value[6]==="Z":false;if(utc)return new Date(Date.UTC(0,0,0,parseInt(value.substr(0,2),10),parseInt(value.substr(2,2),10),parseInt(value.substr(4,2),10)));else return new Date(0,0,0,parseInt(value.substr(0,2),10),parseInt(value.substr(2,2),10),parseInt(value.substr(4,2),10))}},URI:{format:function(value){return value.toString()}},"UTC-OFFSET":{format:function(value){var west=value<0;if(west)value*=-1;return(west?"-":"+")+pad(value,4)}}};var format_value=exports.format_value=function(type,value,parameters){if(value===undefined)return"";var fmt=_types[type||"TEXT"];if(fmt===undefined)throw Error("Invalid iCalendar datatype: "+type);if(Array.isArray(value)&&type!=="PERIOD"||type==="PERIOD"&&value[0]&&Array.isArray(value[0]))return value.map((function(v){return fmt.format(v,parameters||{})})).join(",");else return fmt.format(value,parameters||{})};var parse_value=exports.parse_value=function(type,value,parameters,calendar,expect_list){if(expect_list)return value.split(",").map((function(x){return parse_value(type,x,parameters,calendar)}));var fmt=_types[type||"TEXT"];if(fmt===undefined)throw Error("Invalid iCalendar datatype: "+type);parameters=parameters||{};var otherFmt=parameters.VALUE&&_types[parameters.VALUE];if(otherFmt)fmt=otherFmt;return fmt.parse?fmt.parse(value,parameters,calendar):value}}).call(this,__webpack_require__(188).Buffer)},function(module,exports,__webpack_require__){(function(process){var getOwnPropertyDescriptors=Object.getOwnPropertyDescriptors||function getOwnPropertyDescriptors(obj){var keys=Object.keys(obj);var descriptors={};for(var i=0;i<keys.length;i++){descriptors[keys[i]]=Object.getOwnPropertyDescriptor(obj,keys[i])}return descriptors};var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,(function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}}));for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(typeof process!=="undefined"&&process.noDeprecation===true){return fn}if(typeof process==="undefined"){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=Object({IS_KIBANA_DISTRIBUTABLE:"true"}).NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach((function(val,idx){hash[val]=true}));return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map((function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)}))}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach((function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}}));return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map((function(line){return"  "+line})).join("\n").substr(2)}else{str="\n"+str.split("\n").map((function(line){return"   "+line})).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce((function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1}),0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=__webpack_require__(463);function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=__webpack_require__(464);exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}var kCustomPromisifiedSymbol=typeof Symbol!=="undefined"?Symbol("util.promisify.custom"):undefined;exports.promisify=function promisify(original){if(typeof original!=="function")throw new TypeError('The "original" argument must be of type Function');if(kCustomPromisifiedSymbol&&original[kCustomPromisifiedSymbol]){var fn=original[kCustomPromisifiedSymbol];if(typeof fn!=="function"){throw new TypeError('The "util.promisify.custom" argument must be of type Function')}Object.defineProperty(fn,kCustomPromisifiedSymbol,{value:fn,enumerable:false,writable:false,configurable:true});return fn}function fn(){var promiseResolve,promiseReject;var promise=new Promise((function(resolve,reject){promiseResolve=resolve;promiseReject=reject}));var args=[];for(var i=0;i<arguments.length;i++){args.push(arguments[i])}args.push((function(err,value){if(err){promiseReject(err)}else{promiseResolve(value)}}));try{original.apply(this,args)}catch(err){promiseReject(err)}return promise}Object.setPrototypeOf(fn,Object.getPrototypeOf(original));if(kCustomPromisifiedSymbol)Object.defineProperty(fn,kCustomPromisifiedSymbol,{value:fn,enumerable:false,writable:false,configurable:true});return Object.defineProperties(fn,getOwnPropertyDescriptors(original))};exports.promisify.custom=kCustomPromisifiedSymbol;function callbackifyOnRejected(reason,cb){if(!reason){var newReason=new Error("Promise was rejected with a falsy value");newReason.reason=reason;reason=newReason}return cb(reason)}function callbackify(original){if(typeof original!=="function"){throw new TypeError('The "original" argument must be of type Function')}function callbackified(){var args=[];for(var i=0;i<arguments.length;i++){args.push(arguments[i])}var maybeCb=args.pop();if(typeof maybeCb!=="function"){throw new TypeError("The last argument must be of type Function")}var self=this;var cb=function(){return maybeCb.apply(self,arguments)};original.apply(this,args).then((function(ret){process.nextTick(cb,null,ret)}),(function(rej){process.nextTick(callbackifyOnRejected,rej,cb)}))}Object.setPrototypeOf(callbackified,Object.getPrototypeOf(original));Object.defineProperties(callbackified,getOwnPropertyDescriptors(original));return callbackified}exports.callbackify=callbackify}).call(this,__webpack_require__(220))},function(module,exports,__webpack_require__){var baseGetTag=__webpack_require__(136),isObject=__webpack_require__(104);var asyncTag="[object AsyncFunction]",funcTag="[object Function]",genTag="[object GeneratorFunction]",proxyTag="[object Proxy]";function isFunction(value){if(!isObject(value)){return false}var tag=baseGetTag(value);return tag==funcTag||tag==genTag||tag==asyncTag||tag==proxyTag}module.exports=isFunction},function(module,exports,__webpack_require__){var assignValue=__webpack_require__(197),baseAssignValue=__webpack_require__(198);function copyObject(source,props,object,customizer){var isNew=!object;object||(object={});var index=-1,length=props.length;while(++index<length){var key=props[index];var newValue=customizer?customizer(object[key],source[key],key,object,source):undefined;if(newValue===undefined){newValue=source[key]}if(isNew){baseAssignValue(object,key,newValue)}else{assignValue(object,key,newValue)}}return object}module.exports=copyObject},function(module,exports,__webpack_require__){var baseIsArguments=__webpack_require__(526),isObjectLike=__webpack_require__(113);var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var propertyIsEnumerable=objectProto.propertyIsEnumerable;var isArguments=baseIsArguments(function(){return arguments}())?baseIsArguments:function(value){return isObjectLike(value)&&hasOwnProperty.call(value,"callee")&&!propertyIsEnumerable.call(value,"callee")};module.exports=isArguments},function(module,exports,__webpack_require__){var baseIsTypedArray=__webpack_require__(528),baseUnary=__webpack_require__(200),nodeUtil=__webpack_require__(237);var nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray;var isTypedArray=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray;module.exports=isTypedArray},function(module,exports,__webpack_require__){var isSymbol=__webpack_require__(149);var INFINITY=1/0;function toKey(value){if(typeof value=="string"||isSymbol(value)){return value}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}module.exports=toKey},,,,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"d",(function(){return get_analytics["a"]}));__webpack_require__.d(__webpack_exports__,"b",(function(){return deleteAnalytics}));__webpack_require__.d(__webpack_exports__,"c",(function(){return deleteAnalyticsAndDestIndex}));__webpack_require__.d(__webpack_exports__,"a",(function(){return canDeleteIndex}));__webpack_require__.d(__webpack_exports__,"e",(function(){return startAnalytics}));__webpack_require__.d(__webpack_exports__,"f",(function(){return stopAnalytics}));var get_analytics=__webpack_require__(156);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);var errors=__webpack_require__(20);var ml_api_service=__webpack_require__(59);var common=__webpack_require__(66);var analytics_list_common=__webpack_require__(88);const deleteAnalytics=async(analyticsConfig,analyticsStats,toastNotificationService)=>{try{if(Object(analytics_list_common["f"])(analyticsStats.state)){await ml_api_service["ml"].dataFrameAnalytics.stopDataFrameAnalytics(analyticsConfig.id,true)}await ml_api_service["ml"].dataFrameAnalytics.deleteDataFrameAnalytics(analyticsConfig.id);toastNotificationService.displaySuccessToast(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.deleteAnalyticsSuccessMessage",{defaultMessage:"Request to delete data frame analytics job {analyticsId} acknowledged.",values:{analyticsId:analyticsConfig.id}}))}catch(e){toastNotificationService.displayErrorToast(e,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.deleteAnalyticsErrorMessage",{defaultMessage:"An error occurred deleting the data frame analytics job {analyticsId}",values:{analyticsId:analyticsConfig.id}}))}common["G"].next(common["n"].REFRESH)};const deleteAnalyticsAndDestIndex=async(analyticsConfig,analyticsStats,deleteDestIndex,deleteDestIndexPattern,toastNotificationService)=>{const destinationIndex=Array.isArray(analyticsConfig.dest.index)?analyticsConfig.dest.index[0]:analyticsConfig.dest.index;try{var _status$analyticsJobD,_status$analyticsJobD2,_status$destIndexDele,_status$destIndexDele2,_status$destIndexPatt,_status$destIndexPatt2;if(Object(analytics_list_common["f"])(analyticsStats.state)){await ml_api_service["ml"].dataFrameAnalytics.stopDataFrameAnalytics(analyticsConfig.id,true)}const status=await ml_api_service["ml"].dataFrameAnalytics.deleteDataFrameAnalyticsAndDestIndex(analyticsConfig.id,deleteDestIndex,deleteDestIndexPattern);if((_status$analyticsJobD=status.analyticsJobDeleted)!==null&&_status$analyticsJobD!==void 0&&_status$analyticsJobD.success){toastNotificationService.displaySuccessToast(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.deleteAnalyticsSuccessMessage",{defaultMessage:"Request to delete data frame analytics job {analyticsId} acknowledged.",values:{analyticsId:analyticsConfig.id}}))}if((_status$analyticsJobD2=status.analyticsJobDeleted)!==null&&_status$analyticsJobD2!==void 0&&_status$analyticsJobD2.error){toastNotificationService.displayErrorToast(status.analyticsJobDeleted.error,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.deleteAnalyticsErrorMessage",{defaultMessage:"An error occurred deleting the data frame analytics job {analyticsId}",values:{analyticsId:analyticsConfig.id}}))}if((_status$destIndexDele=status.destIndexDeleted)!==null&&_status$destIndexDele!==void 0&&_status$destIndexDele.success){toastNotificationService.displaySuccessToast(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.deleteAnalyticsWithIndexSuccessMessage",{defaultMessage:"Request to delete destination index {destinationIndex} acknowledged.",values:{destinationIndex:destinationIndex}}))}if((_status$destIndexDele2=status.destIndexDeleted)!==null&&_status$destIndexDele2!==void 0&&_status$destIndexDele2.error){toastNotificationService.displayErrorToast(status.destIndexDeleted.error,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.deleteAnalyticsWithIndexErrorMessage",{defaultMessage:"An error occurred deleting destination index {destinationIndex}",values:{destinationIndex:destinationIndex}}))}if((_status$destIndexPatt=status.destIndexPatternDeleted)!==null&&_status$destIndexPatt!==void 0&&_status$destIndexPatt.success){toastNotificationService.displaySuccessToast(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.deleteAnalyticsWithIndexPatternSuccessMessage",{defaultMessage:"Request to delete index pattern {destinationIndex} acknowledged.",values:{destinationIndex:destinationIndex}}))}if((_status$destIndexPatt2=status.destIndexPatternDeleted)!==null&&_status$destIndexPatt2!==void 0&&_status$destIndexPatt2.error){const error=Object(errors["i"])(status.destIndexPatternDeleted.error);toastNotificationService.displayDangerToast(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.deleteAnalyticsWithIndexPatternErrorMessage",{defaultMessage:"An error occurred deleting index pattern {destinationIndex}: {error}",values:{destinationIndex:destinationIndex,error:error}}))}}catch(e){toastNotificationService.displayErrorToast(e,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.deleteAnalyticsErrorMessage",{defaultMessage:"An error occurred deleting the data frame analytics job {analyticsId}",values:{analyticsId:analyticsConfig.id}}))}common["G"].next(common["n"].REFRESH)};const canDeleteIndex=async(indexName,toastNotificationService)=>{try{const privilege=await ml_api_service["ml"].hasPrivileges({index:[{names:[indexName],privileges:["delete_index"]}]});if(!privilege){return false}return privilege.securityDisabled===true||privilege.has_all_requested===true}catch(e){const error=Object(errors["i"])(e);toastNotificationService.displayDangerToast(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.deleteAnalyticsPrivilegeErrorMessage",{defaultMessage:"User does not have permission to delete index {indexName}: {error}",values:{indexName:indexName,error:error}}))}};const startAnalytics=async(d,toastNotificationService)=>{try{await ml_api_service["ml"].dataFrameAnalytics.startDataFrameAnalytics(d.config.id);toastNotificationService.displaySuccessToast(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.startAnalyticsSuccessMessage",{defaultMessage:"Request to start data frame analytics {analyticsId} acknowledged.",values:{analyticsId:d.config.id}}))}catch(e){toastNotificationService.displayErrorToast(e,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.startAnalyticsErrorTitle",{defaultMessage:"Error starting job"}))}common["G"].next(common["n"].REFRESH)};var dependency_cache=__webpack_require__(18);const stopAnalytics=async d=>{const toastNotifications=Object(dependency_cache["j"])();try{await ml_api_service["ml"].dataFrameAnalytics.stopDataFrameAnalytics(d.config.id,Object(analytics_list_common["f"])(d.stats.state));toastNotifications.addSuccess(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.stopAnalyticsSuccessMessage",{defaultMessage:"Request to stop data frame analytics {analyticsId} acknowledged.",values:{analyticsId:d.config.id}}))}catch(e){toastNotifications.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.stopAnalyticsErrorMessage",{defaultMessage:"An error occurred stopping the data frame analytics {analyticsId}: {error}",values:{analyticsId:d.config.id,error:JSON.stringify(e)}}))}common["G"].next(common["n"].REFRESH)}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return StatsBar}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);const Stat=({stat:stat})=>external_kbnSharedDeps_React_default.a.createElement("span",{className:"stat"},external_kbnSharedDeps_React_default.a.createElement("span",null,stat.label),": ",external_kbnSharedDeps_React_default.a.createElement("strong",null,stat.value));const StatsBar=({stats:stats,dataTestSub:dataTestSub})=>{const statsList=Object.keys(stats).map(k=>stats[k]);return external_kbnSharedDeps_React_default.a.createElement("div",{className:"mlStatsBar","data-test-subj":dataTestSub},statsList.filter(s=>s.show).map(s=>external_kbnSharedDeps_React_default.a.createElement(Stat,{key:s.label,stat:s})))}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return DatePickerWrapper}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_Rxjs_=__webpack_require__(19);var external_kbnSharedDeps_Lodash_=__webpack_require__(5);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(33);var timefilter_refresh_service=__webpack_require__(182);var url_state=__webpack_require__(70);var kibana=__webpack_require__(58);function getRecentlyUsedRangesFactory(timeHistory){return function(){var _timeHistory$get$map,_timeHistory$get;return(_timeHistory$get$map=(_timeHistory$get=timeHistory.get())===null||_timeHistory$get===void 0?void 0:_timeHistory$get.map(({from:from,to:to})=>({start:from,end:to})))!==null&&_timeHistory$get$map!==void 0?_timeHistory$get$map:[]}}function updateLastRefresh(timeRange){timefilter_refresh_service["a"].next({lastRefresh:Date.now(),timeRange:timeRange})}const DatePickerWrapper=()=>{var _globalState$refreshI;const{services:services}=Object(kibana["b"])();const config=services.uiSettings;const{timefilter:timefilter,history:history}=services.data.query.timefilter;const[globalState,setGlobalState]=Object(url_state["c"])("_g");const getRecentlyUsedRanges=getRecentlyUsedRangesFactory(history);const refreshInterval=(_globalState$refreshI=globalState===null||globalState===void 0?void 0:globalState.refreshInterval)!==null&&_globalState$refreshI!==void 0?_globalState$refreshI:timefilter.getRefreshInterval();const setRefreshInterval=Object(external_kbnSharedDeps_React_["useCallback"])(Object(external_kbnSharedDeps_Lodash_["debounce"])(refreshIntervalUpdate=>{setGlobalState("refreshInterval",refreshIntervalUpdate,true)},200),[setGlobalState]);const[time,setTime]=Object(external_kbnSharedDeps_React_["useState"])(timefilter.getTime());const[recentlyUsedRanges,setRecentlyUsedRanges]=Object(external_kbnSharedDeps_React_["useState"])(getRecentlyUsedRanges());const[isAutoRefreshSelectorEnabled,setIsAutoRefreshSelectorEnabled]=Object(external_kbnSharedDeps_React_["useState"])(timefilter.isAutoRefreshSelectorEnabled());const[isTimeRangeSelectorEnabled,setIsTimeRangeSelectorEnabled]=Object(external_kbnSharedDeps_React_["useState"])(timefilter.isTimeRangeSelectorEnabled());const dateFormat=config.get("dateFormat");Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const subscriptions=new external_kbnSharedDeps_Rxjs_["Subscription"];const refreshIntervalUpdate$=timefilter.getRefreshIntervalUpdate$();if(refreshIntervalUpdate$!==undefined){subscriptions.add(refreshIntervalUpdate$.subscribe(r=>{setRefreshInterval(timefilter.getRefreshInterval())}))}const timeUpdate$=timefilter.getTimeUpdate$();if(timeUpdate$!==undefined){subscriptions.add(timeUpdate$.subscribe(v=>{setTime(timefilter.getTime())}))}const enabledUpdated$=timefilter.getEnabledUpdated$();if(enabledUpdated$!==undefined){subscriptions.add(enabledUpdated$.subscribe(w=>{setIsAutoRefreshSelectorEnabled(timefilter.isAutoRefreshSelectorEnabled());setIsTimeRangeSelectorEnabled(timefilter.isTimeRangeSelectorEnabled())}))}return function cleanup(){subscriptions.unsubscribe()}},[]);function updateFilter({start:start,end:end}){const newTime={from:start,to:end};timefilter.setTime(newTime);setTime(newTime);setRecentlyUsedRanges(getRecentlyUsedRanges())}function updateInterval({isPaused:pause,refreshInterval:value}){setRefreshInterval({pause:pause,value:value})}const isPaused=refreshInterval.pause||!refreshInterval.pause&&!refreshInterval.value;return isAutoRefreshSelectorEnabled||isTimeRangeSelectorEnabled?external_kbnSharedDeps_React_default.a.createElement("div",{className:"mlNavigationMenu__datePickerWrapper"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSuperDatePicker"],{start:time.from,end:time.to,isPaused:isPaused,isAutoRefreshOnly:!isTimeRangeSelectorEnabled,refreshInterval:refreshInterval.value,onTimeChange:updateFilter,onRefresh:updateLastRefresh,onRefreshChange:updateInterval,recentlyUsedRanges:recentlyUsedRanges,dateFormat:dateFormat})):null}},,,,,,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return DEFAULT_REFRESH_INTERVAL_MS}));__webpack_require__.d(__webpack_exports__,"c",(function(){return MINIMUM_REFRESH_INTERVAL_MS}));__webpack_require__.d(__webpack_exports__,"b",(function(){return DELETING_JOBS_REFRESH_INTERVAL_MS}));const DEFAULT_REFRESH_INTERVAL_MS=3e4;const MINIMUM_REFRESH_INTERVAL_MS=1e3;const DELETING_JOBS_REFRESH_INTERVAL_MS=2e3;const PROGRESS_JOBS_REFRESH_INTERVAL_MS=2e3},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return mlTimefilterRefresh$}));var rxjs__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(19);var rxjs__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(rxjs__WEBPACK_IMPORTED_MODULE_0__);const mlTimefilterRefresh$=new rxjs__WEBPACK_IMPORTED_MODULE_0__["Subject"]},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"c",(function(){return FILE_DATA_VISUALIZER_MAX_FILE_SIZE}));__webpack_require__.d(__webpack_exports__,"b",(function(){return ANOMALY_DETECTION_ENABLE_TIME_RANGE}));__webpack_require__.d(__webpack_exports__,"a",(function(){return ANOMALY_DETECTION_DEFAULT_TIME_RANGE}));const FILE_DATA_VISUALIZER_MAX_FILE_SIZE="ml:fileDataVisualizerMaxFileSize";const ANOMALY_DETECTION_ENABLE_TIME_RANGE="ml:anomalyDetection:results:enableTimeDefaults";const ANOMALY_DETECTION_DEFAULT_TIME_RANGE="ml:anomalyDetection:results:timeDefaults";const DEFAULT_AD_RESULTS_TIME_FILTER={from:"now-15m",to:"now"};const DEFAULT_ENABLE_AD_RESULTS_TIME_FILTER=false},function(module,exports,__webpack_require__){(function(){var ACE_NAMESPACE="ace";var global=function(){return this}();if(!global&&typeof window!="undefined")global=window;if(!ACE_NAMESPACE&&typeof acequirejs!=="undefined")return;var define=function(module,deps,payload){if(typeof module!=="string"){if(define.original)define.original.apply(this,arguments);else{console.error("dropping module because define wasn't a string.");console.trace()}return}if(arguments.length==2)payload=deps;if(!define.modules[module]){define.payloads[module]=payload;define.modules[module]=null}};define.modules={};define.payloads={};var _acequire=function(parentId,module,callback){if(typeof module==="string"){var payload=lookup(parentId,module);if(payload!=undefined){callback&&callback();return payload}}else if(Object.prototype.toString.call(module)==="[object Array]"){var params=[];for(var i=0,l=module.length;i<l;++i){var dep=lookup(parentId,module[i]);if(dep==undefined&&acequire.original)return;params.push(dep)}return callback&&callback.apply(null,params)||true}};var acequire=function(module,callback){var packagedModule=_acequire("",module,callback);if(packagedModule==undefined&&acequire.original)return acequire.original.apply(this,arguments);return packagedModule};var normalizeModule=function(parentId,moduleName){if(moduleName.indexOf("!")!==-1){var chunks=moduleName.split("!");return normalizeModule(parentId,chunks[0])+"!"+normalizeModule(parentId,chunks[1])}if(moduleName.charAt(0)=="."){var base=parentId.split("/").slice(0,-1).join("/");moduleName=base+"/"+moduleName;while(moduleName.indexOf(".")!==-1&&previous!=moduleName){var previous=moduleName;moduleName=moduleName.replace(/\/\.\//,"/").replace(/[^\/]+\/\.\.\//,"")}}return moduleName};var lookup=function(parentId,moduleName){moduleName=normalizeModule(parentId,moduleName);var module=define.modules[moduleName];if(!module){module=define.payloads[moduleName];if(typeof module==="function"){var exports={};var mod={id:moduleName,uri:"",exports:exports,packaged:true};var req=function(module,callback){return _acequire(moduleName,module,callback)};var returnValue=module(req,exports,mod);exports=returnValue||mod.exports;define.modules[moduleName]=exports;delete define.payloads[moduleName]}module=define.modules[moduleName]=exports||module}return module};function exportAce(ns){var root=global;if(ns){if(!global[ns])global[ns]={};root=global[ns]}if(!root.define||!root.define.packaged){define.original=root.define;root.define=define;root.define.packaged=true}if(!root.acequire||!root.acequire.packaged){acequire.original=root.acequire;root.acequire=acequire;root.acequire.packaged=true}}exportAce(ACE_NAMESPACE)})();ace.define("ace/lib/regexp",["require","exports","module"],(function(acequire,exports,module){"use strict";var real={exec:RegExp.prototype.exec,test:RegExp.prototype.test,match:String.prototype.match,replace:String.prototype.replace,split:String.prototype.split},compliantExecNpcg=real.exec.call(/()??/,"")[1]===undefined,compliantLastIndexIncrement=function(){var x=/^/g;real.test.call(x,"");return!x.lastIndex}();if(compliantLastIndexIncrement&&compliantExecNpcg)return;RegExp.prototype.exec=function(str){var match=real.exec.apply(this,arguments),name,r2;if(typeof str=="string"&&match){if(!compliantExecNpcg&&match.length>1&&indexOf(match,"")>-1){r2=RegExp(this.source,real.replace.call(getNativeFlags(this),"g",""));real.replace.call(str.slice(match.index),r2,(function(){for(var i=1;i<arguments.length-2;i++){if(arguments[i]===undefined)match[i]=undefined}}))}if(this._xregexp&&this._xregexp.captureNames){for(var i=1;i<match.length;i++){name=this._xregexp.captureNames[i-1];if(name)match[name]=match[i]}}if(!compliantLastIndexIncrement&&this.global&&!match[0].length&&this.lastIndex>match.index)this.lastIndex--}return match};if(!compliantLastIndexIncrement){RegExp.prototype.test=function(str){var match=real.exec.call(this,str);if(match&&this.global&&!match[0].length&&this.lastIndex>match.index)this.lastIndex--;return!!match}}function getNativeFlags(regex){return(regex.global?"g":"")+(regex.ignoreCase?"i":"")+(regex.multiline?"m":"")+(regex.extended?"x":"")+(regex.sticky?"y":"")}function indexOf(array,item,from){if(Array.prototype.indexOf)return array.indexOf(item,from);for(var i=from||0;i<array.length;i++){if(array[i]===item)return i}return-1}}));ace.define("ace/lib/es5-shim",["require","exports","module"],(function(acequire,exports,module){function Empty(){}if(!Function.prototype.bind){Function.prototype.bind=function bind(that){var target=this;if(typeof target!="function"){throw new TypeError("Function.prototype.bind called on incompatible "+target)}var args=slice.call(arguments,1);var bound=function(){if(this instanceof bound){var result=target.apply(this,args.concat(slice.call(arguments)));if(Object(result)===result){return result}return this}else{return target.apply(that,args.concat(slice.call(arguments)))}};if(target.prototype){Empty.prototype=target.prototype;bound.prototype=new Empty;Empty.prototype=null}return bound}}var call=Function.prototype.call;var prototypeOfArray=Array.prototype;var prototypeOfObject=Object.prototype;var slice=prototypeOfArray.slice;var _toString=call.bind(prototypeOfObject.toString);var owns=call.bind(prototypeOfObject.hasOwnProperty);var defineGetter;var defineSetter;var lookupGetter;var lookupSetter;var supportsAccessors;if(supportsAccessors=owns(prototypeOfObject,"__defineGetter__")){defineGetter=call.bind(prototypeOfObject.__defineGetter__);defineSetter=call.bind(prototypeOfObject.__defineSetter__);lookupGetter=call.bind(prototypeOfObject.__lookupGetter__);lookupSetter=call.bind(prototypeOfObject.__lookupSetter__)}if([1,2].splice(0).length!=2){if(function(){function makeArray(l){var a=new Array(l+2);a[0]=a[1]=0;return a}var array=[],lengthBefore;array.splice.apply(array,makeArray(20));array.splice.apply(array,makeArray(26));lengthBefore=array.length;array.splice(5,0,"XXX");lengthBefore+1==array.length;if(lengthBefore+1==array.length){return true}}()){var array_splice=Array.prototype.splice;Array.prototype.splice=function(start,deleteCount){if(!arguments.length){return[]}else{return array_splice.apply(this,[start===void 0?0:start,deleteCount===void 0?this.length-start:deleteCount].concat(slice.call(arguments,2)))}}}else{Array.prototype.splice=function(pos,removeCount){var length=this.length;if(pos>0){if(pos>length)pos=length}else if(pos==void 0){pos=0}else if(pos<0){pos=Math.max(length+pos,0)}if(!(pos+removeCount<length))removeCount=length-pos;var removed=this.slice(pos,pos+removeCount);var insert=slice.call(arguments,2);var add=insert.length;if(pos===length){if(add){this.push.apply(this,insert)}}else{var remove=Math.min(removeCount,length-pos);var tailOldPos=pos+remove;var tailNewPos=tailOldPos+add-remove;var tailCount=length-tailOldPos;var lengthAfterRemove=length-remove;if(tailNewPos<tailOldPos){for(var i=0;i<tailCount;++i){this[tailNewPos+i]=this[tailOldPos+i]}}else if(tailNewPos>tailOldPos){for(i=tailCount;i--;){this[tailNewPos+i]=this[tailOldPos+i]}}if(add&&pos===lengthAfterRemove){this.length=lengthAfterRemove;this.push.apply(this,insert)}else{this.length=lengthAfterRemove+add;for(i=0;i<add;++i){this[pos+i]=insert[i]}}}return removed}}}if(!Array.isArray){Array.isArray=function isArray(obj){return _toString(obj)=="[object Array]"}}var boxedString=Object("a"),splitString=boxedString[0]!="a"||!(0 in boxedString);if(!Array.prototype.forEach){Array.prototype.forEach=function forEach(fun){var object=toObject(this),self=splitString&&_toString(this)=="[object String]"?this.split(""):object,thisp=arguments[1],i=-1,length=self.length>>>0;if(_toString(fun)!="[object Function]"){throw new TypeError}while(++i<length){if(i in self){fun.call(thisp,self[i],i,object)}}}}if(!Array.prototype.map){Array.prototype.map=function map(fun){var object=toObject(this),self=splitString&&_toString(this)=="[object String]"?this.split(""):object,length=self.length>>>0,result=Array(length),thisp=arguments[1];if(_toString(fun)!="[object Function]"){throw new TypeError(fun+" is not a function")}for(var i=0;i<length;i++){if(i in self)result[i]=fun.call(thisp,self[i],i,object)}return result}}if(!Array.prototype.filter){Array.prototype.filter=function filter(fun){var object=toObject(this),self=splitString&&_toString(this)=="[object String]"?this.split(""):object,length=self.length>>>0,result=[],value,thisp=arguments[1];if(_toString(fun)!="[object Function]"){throw new TypeError(fun+" is not a function")}for(var i=0;i<length;i++){if(i in self){value=self[i];if(fun.call(thisp,value,i,object)){result.push(value)}}}return result}}if(!Array.prototype.every){Array.prototype.every=function every(fun){var object=toObject(this),self=splitString&&_toString(this)=="[object String]"?this.split(""):object,length=self.length>>>0,thisp=arguments[1];if(_toString(fun)!="[object Function]"){throw new TypeError(fun+" is not a function")}for(var i=0;i<length;i++){if(i in self&&!fun.call(thisp,self[i],i,object)){return false}}return true}}if(!Array.prototype.some){Array.prototype.some=function some(fun){var object=toObject(this),self=splitString&&_toString(this)=="[object String]"?this.split(""):object,length=self.length>>>0,thisp=arguments[1];if(_toString(fun)!="[object Function]"){throw new TypeError(fun+" is not a function")}for(var i=0;i<length;i++){if(i in self&&fun.call(thisp,self[i],i,object)){return true}}return false}}if(!Array.prototype.reduce){Array.prototype.reduce=function reduce(fun){var object=toObject(this),self=splitString&&_toString(this)=="[object String]"?this.split(""):object,length=self.length>>>0;if(_toString(fun)!="[object Function]"){throw new TypeError(fun+" is not a function")}if(!length&&arguments.length==1){throw new TypeError("reduce of empty array with no initial value")}var i=0;var result;if(arguments.length>=2){result=arguments[1]}else{do{if(i in self){result=self[i++];break}if(++i>=length){throw new TypeError("reduce of empty array with no initial value")}}while(true)}for(;i<length;i++){if(i in self){result=fun.call(void 0,result,self[i],i,object)}}return result}}if(!Array.prototype.reduceRight){Array.prototype.reduceRight=function reduceRight(fun){var object=toObject(this),self=splitString&&_toString(this)=="[object String]"?this.split(""):object,length=self.length>>>0;if(_toString(fun)!="[object Function]"){throw new TypeError(fun+" is not a function")}if(!length&&arguments.length==1){throw new TypeError("reduceRight of empty array with no initial value")}var result,i=length-1;if(arguments.length>=2){result=arguments[1]}else{do{if(i in self){result=self[i--];break}if(--i<0){throw new TypeError("reduceRight of empty array with no initial value")}}while(true)}do{if(i in this){result=fun.call(void 0,result,self[i],i,object)}}while(i--);return result}}if(!Array.prototype.indexOf||[0,1].indexOf(1,2)!=-1){Array.prototype.indexOf=function indexOf(sought){var self=splitString&&_toString(this)=="[object String]"?this.split(""):toObject(this),length=self.length>>>0;if(!length){return-1}var i=0;if(arguments.length>1){i=toInteger(arguments[1])}i=i>=0?i:Math.max(0,length+i);for(;i<length;i++){if(i in self&&self[i]===sought){return i}}return-1}}if(!Array.prototype.lastIndexOf||[0,1].lastIndexOf(0,-3)!=-1){Array.prototype.lastIndexOf=function lastIndexOf(sought){var self=splitString&&_toString(this)=="[object String]"?this.split(""):toObject(this),length=self.length>>>0;if(!length){return-1}var i=length-1;if(arguments.length>1){i=Math.min(i,toInteger(arguments[1]))}i=i>=0?i:length-Math.abs(i);for(;i>=0;i--){if(i in self&&sought===self[i]){return i}}return-1}}if(!Object.getPrototypeOf){Object.getPrototypeOf=function getPrototypeOf(object){return object.__proto__||(object.constructor?object.constructor.prototype:prototypeOfObject)}}if(!Object.getOwnPropertyDescriptor){var ERR_NON_OBJECT="Object.getOwnPropertyDescriptor called on a "+"non-object: ";Object.getOwnPropertyDescriptor=function getOwnPropertyDescriptor(object,property){if(typeof object!="object"&&typeof object!="function"||object===null)throw new TypeError(ERR_NON_OBJECT+object);if(!owns(object,property))return;var descriptor,getter,setter;descriptor={enumerable:true,configurable:true};if(supportsAccessors){var prototype=object.__proto__;object.__proto__=prototypeOfObject;var getter=lookupGetter(object,property);var setter=lookupSetter(object,property);object.__proto__=prototype;if(getter||setter){if(getter)descriptor.get=getter;if(setter)descriptor.set=setter;return descriptor}}descriptor.value=object[property];return descriptor}}if(!Object.getOwnPropertyNames){Object.getOwnPropertyNames=function getOwnPropertyNames(object){return Object.keys(object)}}if(!Object.create){var createEmpty;if(Object.prototype.__proto__===null){createEmpty=function(){return{__proto__:null}}}else{createEmpty=function(){var empty={};for(var i in empty)empty[i]=null;empty.constructor=empty.hasOwnProperty=empty.propertyIsEnumerable=empty.isPrototypeOf=empty.toLocaleString=empty.toString=empty.valueOf=empty.__proto__=null;return empty}}Object.create=function create(prototype,properties){var object;if(prototype===null){object=createEmpty()}else{if(typeof prototype!="object")throw new TypeError("typeof prototype["+typeof prototype+"] != 'object'");var Type=function(){};Type.prototype=prototype;object=new Type;object.__proto__=prototype}if(properties!==void 0)Object.defineProperties(object,properties);return object}}function doesDefinePropertyWork(object){try{Object.defineProperty(object,"sentinel",{});return"sentinel"in object}catch(exception){}}if(Object.defineProperty){var definePropertyWorksOnObject=doesDefinePropertyWork({});var definePropertyWorksOnDom=typeof document=="undefined"||doesDefinePropertyWork(document.createElement("div"));if(!definePropertyWorksOnObject||!definePropertyWorksOnDom){var definePropertyFallback=Object.defineProperty}}if(!Object.defineProperty||definePropertyFallback){var ERR_NON_OBJECT_DESCRIPTOR="Property description must be an object: ";var ERR_NON_OBJECT_TARGET="Object.defineProperty called on non-object: ";var ERR_ACCESSORS_NOT_SUPPORTED="getters & setters can not be defined "+"on this javascript engine";Object.defineProperty=function defineProperty(object,property,descriptor){if(typeof object!="object"&&typeof object!="function"||object===null)throw new TypeError(ERR_NON_OBJECT_TARGET+object);if(typeof descriptor!="object"&&typeof descriptor!="function"||descriptor===null)throw new TypeError(ERR_NON_OBJECT_DESCRIPTOR+descriptor);if(definePropertyFallback){try{return definePropertyFallback.call(Object,object,property,descriptor)}catch(exception){}}if(owns(descriptor,"value")){if(supportsAccessors&&(lookupGetter(object,property)||lookupSetter(object,property))){var prototype=object.__proto__;object.__proto__=prototypeOfObject;delete object[property];object[property]=descriptor.value;object.__proto__=prototype}else{object[property]=descriptor.value}}else{if(!supportsAccessors)throw new TypeError(ERR_ACCESSORS_NOT_SUPPORTED);if(owns(descriptor,"get"))defineGetter(object,property,descriptor.get);if(owns(descriptor,"set"))defineSetter(object,property,descriptor.set)}return object}}if(!Object.defineProperties){Object.defineProperties=function defineProperties(object,properties){for(var property in properties){if(owns(properties,property))Object.defineProperty(object,property,properties[property])}return object}}if(!Object.seal){Object.seal=function seal(object){return object}}if(!Object.freeze){Object.freeze=function freeze(object){return object}}try{Object.freeze((function(){}))}catch(exception){Object.freeze=function freeze(freezeObject){return function freeze(object){if(typeof object=="function"){return object}else{return freezeObject(object)}}}(Object.freeze)}if(!Object.preventExtensions){Object.preventExtensions=function preventExtensions(object){return object}}if(!Object.isSealed){Object.isSealed=function isSealed(object){return false}}if(!Object.isFrozen){Object.isFrozen=function isFrozen(object){return false}}if(!Object.isExtensible){Object.isExtensible=function isExtensible(object){if(Object(object)===object){throw new TypeError}var name="";while(owns(object,name)){name+="?"}object[name]=true;var returnValue=owns(object,name);delete object[name];return returnValue}}if(!Object.keys){var hasDontEnumBug=true,dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],dontEnumsLength=dontEnums.length;for(var key in{toString:null}){hasDontEnumBug=false}Object.keys=function keys(object){if(typeof object!="object"&&typeof object!="function"||object===null){throw new TypeError("Object.keys called on a non-object")}var keys=[];for(var name in object){if(owns(object,name)){keys.push(name)}}if(hasDontEnumBug){for(var i=0,ii=dontEnumsLength;i<ii;i++){var dontEnum=dontEnums[i];if(owns(object,dontEnum)){keys.push(dontEnum)}}}return keys}}if(!Date.now){Date.now=function now(){return(new Date).getTime()}}var ws="\t\n\v\f\r   ᠎    "+"         　\u2028"+"\u2029\ufeff";if(!String.prototype.trim||ws.trim()){ws="["+ws+"]";var trimBeginRegexp=new RegExp("^"+ws+ws+"*"),trimEndRegexp=new RegExp(ws+ws+"*$");String.prototype.trim=function trim(){return String(this).replace(trimBeginRegexp,"").replace(trimEndRegexp,"")}}function toInteger(n){n=+n;if(n!==n){n=0}else if(n!==0&&n!==1/0&&n!==-(1/0)){n=(n>0||-1)*Math.floor(Math.abs(n))}return n}function isPrimitive(input){var type=typeof input;return input===null||type==="undefined"||type==="boolean"||type==="number"||type==="string"}function toPrimitive(input){var val,valueOf,toString;if(isPrimitive(input)){return input}valueOf=input.valueOf;if(typeof valueOf==="function"){val=valueOf.call(input);if(isPrimitive(val)){return val}}toString=input.toString;if(typeof toString==="function"){val=toString.call(input);if(isPrimitive(val)){return val}}throw new TypeError}var toObject=function(o){if(o==null){throw new TypeError("can't convert "+o+" to object")}return Object(o)}}));ace.define("ace/lib/fixoldbrowsers",["require","exports","module","ace/lib/regexp","ace/lib/es5-shim"],(function(acequire,exports,module){"use strict";acequire("./regexp");acequire("./es5-shim")}));ace.define("ace/lib/dom",["require","exports","module"],(function(acequire,exports,module){"use strict";var XHTML_NS="http://www.w3.org/1999/xhtml";exports.getDocumentHead=function(doc){if(!doc)doc=document;return doc.head||doc.getElementsByTagName("head")[0]||doc.documentElement};exports.createElement=function(tag,ns){return document.createElementNS?document.createElementNS(ns||XHTML_NS,tag):document.createElement(tag)};exports.hasCssClass=function(el,name){var classes=(el.className+"").split(/\s+/g);return classes.indexOf(name)!==-1};exports.addCssClass=function(el,name){if(!exports.hasCssClass(el,name)){el.className+=" "+name}};exports.removeCssClass=function(el,name){var classes=el.className.split(/\s+/g);while(true){var index=classes.indexOf(name);if(index==-1){break}classes.splice(index,1)}el.className=classes.join(" ")};exports.toggleCssClass=function(el,name){var classes=el.className.split(/\s+/g),add=true;while(true){var index=classes.indexOf(name);if(index==-1){break}add=false;classes.splice(index,1)}if(add)classes.push(name);el.className=classes.join(" ");return add};exports.setCssClass=function(node,className,include){if(include){exports.addCssClass(node,className)}else{exports.removeCssClass(node,className)}};exports.hasCssString=function(id,doc){var index=0,sheets;doc=doc||document;if(doc.createStyleSheet&&(sheets=doc.styleSheets)){while(index<sheets.length)if(sheets[index++].owningElement.id===id)return true}else if(sheets=doc.getElementsByTagName("style")){while(index<sheets.length)if(sheets[index++].id===id)return true}return false};exports.importCssString=function importCssString(cssText,id,doc){doc=doc||document;if(id&&exports.hasCssString(id,doc))return null;var style;if(id)cssText+="\n/*# sourceURL=ace/css/"+id+" */";if(doc.createStyleSheet){style=doc.createStyleSheet();style.cssText=cssText;if(id)style.owningElement.id=id}else{style=exports.createElement("style");style.appendChild(doc.createTextNode(cssText));if(id)style.id=id;exports.getDocumentHead(doc).appendChild(style)}};exports.importCssStylsheet=function(uri,doc){if(doc.createStyleSheet){doc.createStyleSheet(uri)}else{var link=exports.createElement("link");link.rel="stylesheet";link.href=uri;exports.getDocumentHead(doc).appendChild(link)}};exports.getInnerWidth=function(element){return parseInt(exports.computedStyle(element,"paddingLeft"),10)+parseInt(exports.computedStyle(element,"paddingRight"),10)+element.clientWidth};exports.getInnerHeight=function(element){return parseInt(exports.computedStyle(element,"paddingTop"),10)+parseInt(exports.computedStyle(element,"paddingBottom"),10)+element.clientHeight};exports.scrollbarWidth=function(document){var inner=exports.createElement("ace_inner");inner.style.width="100%";inner.style.minWidth="0px";inner.style.height="200px";inner.style.display="block";var outer=exports.createElement("ace_outer");var style=outer.style;style.position="absolute";style.left="-10000px";style.overflow="hidden";style.width="200px";style.minWidth="0px";style.height="150px";style.display="block";outer.appendChild(inner);var body=document.documentElement;body.appendChild(outer);var noScrollbar=inner.offsetWidth;style.overflow="scroll";var withScrollbar=inner.offsetWidth;if(noScrollbar==withScrollbar){withScrollbar=outer.clientWidth}body.removeChild(outer);return noScrollbar-withScrollbar};if(typeof document=="undefined"){exports.importCssString=function(){};return}if(window.pageYOffset!==undefined){exports.getPageScrollTop=function(){return window.pageYOffset};exports.getPageScrollLeft=function(){return window.pageXOffset}}else{exports.getPageScrollTop=function(){return document.body.scrollTop};exports.getPageScrollLeft=function(){return document.body.scrollLeft}}if(window.getComputedStyle)exports.computedStyle=function(element,style){if(style)return(window.getComputedStyle(element,"")||{})[style]||"";return window.getComputedStyle(element,"")||{}};else exports.computedStyle=function(element,style){if(style)return element.currentStyle[style];return element.currentStyle};exports.setInnerHtml=function(el,innerHtml){var element=el.cloneNode(false);element.innerHTML=innerHtml;el.parentNode.replaceChild(element,el);return element};if("textContent"in document.documentElement){exports.setInnerText=function(el,innerText){el.textContent=innerText};exports.getInnerText=function(el){return el.textContent}}else{exports.setInnerText=function(el,innerText){el.innerText=innerText};exports.getInnerText=function(el){return el.innerText}}exports.getParentWindow=function(document){return document.defaultView||document.parentWindow}}));ace.define("ace/lib/oop",["require","exports","module"],(function(acequire,exports,module){"use strict";exports.inherits=function(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})};exports.mixin=function(obj,mixin){for(var key in mixin){obj[key]=mixin[key]}return obj};exports.implement=function(proto,mixin){exports.mixin(proto,mixin)}}));ace.define("ace/lib/keys",["require","exports","module","ace/lib/fixoldbrowsers","ace/lib/oop"],(function(acequire,exports,module){"use strict";acequire("./fixoldbrowsers");var oop=acequire("./oop");var Keys=function(){var ret={MODIFIER_KEYS:{16:"Shift",17:"Ctrl",18:"Alt",224:"Meta"},KEY_MODS:{ctrl:1,alt:2,option:2,shift:4,super:8,meta:8,command:8,cmd:8},FUNCTION_KEYS:{8:"Backspace",9:"Tab",13:"Return",19:"Pause",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"Print",45:"Insert",46:"Delete",96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9","-13":"NumpadEnter",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"Numlock",145:"Scrolllock"},PRINTABLE_KEYS:{32:" ",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",111:"/",106:"*"}};var name,i;for(i in ret.FUNCTION_KEYS){name=ret.FUNCTION_KEYS[i].toLowerCase();ret[name]=parseInt(i,10)}for(i in ret.PRINTABLE_KEYS){name=ret.PRINTABLE_KEYS[i].toLowerCase();ret[name]=parseInt(i,10)}oop.mixin(ret,ret.MODIFIER_KEYS);oop.mixin(ret,ret.PRINTABLE_KEYS);oop.mixin(ret,ret.FUNCTION_KEYS);ret.enter=ret["return"];ret.escape=ret.esc;ret.del=ret["delete"];ret[173]="-";(function(){var mods=["cmd","ctrl","alt","shift"];for(var i=Math.pow(2,mods.length);i--;){ret.KEY_MODS[i]=mods.filter((function(x){return i&ret.KEY_MODS[x]})).join("-")+"-"}})();ret.KEY_MODS[0]="";ret.KEY_MODS[-1]="input-";return ret}();oop.mixin(exports,Keys);exports.keyCodeToString=function(keyCode){var keyString=Keys[keyCode];if(typeof keyString!="string")keyString=String.fromCharCode(keyCode);return keyString.toLowerCase()}}));ace.define("ace/lib/useragent",["require","exports","module"],(function(acequire,exports,module){"use strict";exports.OS={LINUX:"LINUX",MAC:"MAC",WINDOWS:"WINDOWS"};exports.getOS=function(){if(exports.isMac){return exports.OS.MAC}else if(exports.isLinux){return exports.OS.LINUX}else{return exports.OS.WINDOWS}};if(typeof navigator!="object")return;var os=(navigator.platform.match(/mac|win|linux/i)||["other"])[0].toLowerCase();var ua=navigator.userAgent;exports.isWin=os=="win";exports.isMac=os=="mac";exports.isLinux=os=="linux";exports.isIE=navigator.appName=="Microsoft Internet Explorer"||navigator.appName.indexOf("MSAppHost")>=0?parseFloat((ua.match(/(?:MSIE |Trident\/[0-9]+[\.0-9]+;.*rv:)([0-9]+[\.0-9]+)/)||[])[1]):parseFloat((ua.match(/(?:Trident\/[0-9]+[\.0-9]+;.*rv:)([0-9]+[\.0-9]+)/)||[])[1]);exports.isOldIE=exports.isIE&&exports.isIE<9;exports.isGecko=exports.isMozilla=(window.Controllers||window.controllers)&&window.navigator.product==="Gecko";exports.isOldGecko=exports.isGecko&&parseInt((ua.match(/rv:(\d+)/)||[])[1],10)<4;exports.isOpera=window.opera&&Object.prototype.toString.call(window.opera)=="[object Opera]";exports.isWebKit=parseFloat(ua.split("WebKit/")[1])||undefined;exports.isChrome=parseFloat(ua.split(" Chrome/")[1])||undefined;exports.isAIR=ua.indexOf("AdobeAIR")>=0;exports.isIPad=ua.indexOf("iPad")>=0;exports.isChromeOS=ua.indexOf(" CrOS ")>=0;exports.isIOS=/iPad|iPhone|iPod/.test(ua)&&!window.MSStream;if(exports.isIOS)exports.isMac=true}));ace.define("ace/lib/event",["require","exports","module","ace/lib/keys","ace/lib/useragent"],(function(acequire,exports,module){"use strict";var keys=acequire("./keys");var useragent=acequire("./useragent");var pressedKeys=null;var ts=0;exports.addListener=function(elem,type,callback){if(elem.addEventListener){return elem.addEventListener(type,callback,false)}if(elem.attachEvent){var wrapper=function(){callback.call(elem,window.event)};callback._wrapper=wrapper;elem.attachEvent("on"+type,wrapper)}};exports.removeListener=function(elem,type,callback){if(elem.removeEventListener){return elem.removeEventListener(type,callback,false)}if(elem.detachEvent){elem.detachEvent("on"+type,callback._wrapper||callback)}};exports.stopEvent=function(e){exports.stopPropagation(e);exports.preventDefault(e);return false};exports.stopPropagation=function(e){if(e.stopPropagation)e.stopPropagation();else e.cancelBubble=true};exports.preventDefault=function(e){if(e.preventDefault)e.preventDefault();else e.returnValue=false};exports.getButton=function(e){if(e.type=="dblclick")return 0;if(e.type=="contextmenu"||useragent.isMac&&(e.ctrlKey&&!e.altKey&&!e.shiftKey))return 2;if(e.preventDefault){return e.button}else{return{1:0,2:2,4:1}[e.button]}};exports.capture=function(el,eventHandler,releaseCaptureHandler){function onMouseUp(e){eventHandler&&eventHandler(e);releaseCaptureHandler&&releaseCaptureHandler(e);exports.removeListener(document,"mousemove",eventHandler,true);exports.removeListener(document,"mouseup",onMouseUp,true);exports.removeListener(document,"dragstart",onMouseUp,true)}exports.addListener(document,"mousemove",eventHandler,true);exports.addListener(document,"mouseup",onMouseUp,true);exports.addListener(document,"dragstart",onMouseUp,true);return onMouseUp};exports.addTouchMoveListener=function(el,callback){var startx,starty;exports.addListener(el,"touchstart",(function(e){var touches=e.touches;var touchObj=touches[0];startx=touchObj.clientX;starty=touchObj.clientY}));exports.addListener(el,"touchmove",(function(e){var touches=e.touches;if(touches.length>1)return;var touchObj=touches[0];e.wheelX=startx-touchObj.clientX;e.wheelY=starty-touchObj.clientY;startx=touchObj.clientX;starty=touchObj.clientY;callback(e)}))};exports.addMouseWheelListener=function(el,callback){if("onmousewheel"in el){exports.addListener(el,"mousewheel",(function(e){var factor=8;if(e.wheelDeltaX!==undefined){e.wheelX=-e.wheelDeltaX/factor;e.wheelY=-e.wheelDeltaY/factor}else{e.wheelX=0;e.wheelY=-e.wheelDelta/factor}callback(e)}))}else if("onwheel"in el){exports.addListener(el,"wheel",(function(e){var factor=.35;switch(e.deltaMode){case e.DOM_DELTA_PIXEL:e.wheelX=e.deltaX*factor||0;e.wheelY=e.deltaY*factor||0;break;case e.DOM_DELTA_LINE:case e.DOM_DELTA_PAGE:e.wheelX=(e.deltaX||0)*5;e.wheelY=(e.deltaY||0)*5;break}callback(e)}))}else{exports.addListener(el,"DOMMouseScroll",(function(e){if(e.axis&&e.axis==e.HORIZONTAL_AXIS){e.wheelX=(e.detail||0)*5;e.wheelY=0}else{e.wheelX=0;e.wheelY=(e.detail||0)*5}callback(e)}))}};exports.addMultiMouseDownListener=function(elements,timeouts,eventHandler,callbackName){var clicks=0;var startX,startY,timer;var eventNames={2:"dblclick",3:"tripleclick",4:"quadclick"};function onMousedown(e){if(exports.getButton(e)!==0){clicks=0}else if(e.detail>1){clicks++;if(clicks>4)clicks=1}else{clicks=1}if(useragent.isIE){var isNewClick=Math.abs(e.clientX-startX)>5||Math.abs(e.clientY-startY)>5;if(!timer||isNewClick)clicks=1;if(timer)clearTimeout(timer);timer=setTimeout((function(){timer=null}),timeouts[clicks-1]||600);if(clicks==1){startX=e.clientX;startY=e.clientY}}e._clicks=clicks;eventHandler[callbackName]("mousedown",e);if(clicks>4)clicks=0;else if(clicks>1)return eventHandler[callbackName](eventNames[clicks],e)}function onDblclick(e){clicks=2;if(timer)clearTimeout(timer);timer=setTimeout((function(){timer=null}),timeouts[clicks-1]||600);eventHandler[callbackName]("mousedown",e);eventHandler[callbackName](eventNames[clicks],e)}if(!Array.isArray(elements))elements=[elements];elements.forEach((function(el){exports.addListener(el,"mousedown",onMousedown);if(useragent.isOldIE)exports.addListener(el,"dblclick",onDblclick)}))};var getModifierHash=useragent.isMac&&useragent.isOpera&&!("KeyboardEvent"in window)?function(e){return 0|(e.metaKey?1:0)|(e.altKey?2:0)|(e.shiftKey?4:0)|(e.ctrlKey?8:0)}:function(e){return 0|(e.ctrlKey?1:0)|(e.altKey?2:0)|(e.shiftKey?4:0)|(e.metaKey?8:0)};exports.getModifierString=function(e){return keys.KEY_MODS[getModifierHash(e)]};function normalizeCommandKeys(callback,e,keyCode){var hashId=getModifierHash(e);if(!useragent.isMac&&pressedKeys){if(e.getModifierState&&(e.getModifierState("OS")||e.getModifierState("Win")))hashId|=8;if(pressedKeys.altGr){if((3&hashId)!=3)pressedKeys.altGr=0;else return}if(keyCode===18||keyCode===17){var location="location"in e?e.location:e.keyLocation;if(keyCode===17&&location===1){if(pressedKeys[keyCode]==1)ts=e.timeStamp}else if(keyCode===18&&hashId===3&&location===2){var dt=e.timeStamp-ts;if(dt<50)pressedKeys.altGr=true}}}if(keyCode in keys.MODIFIER_KEYS){keyCode=-1}if(hashId&8&&(keyCode>=91&&keyCode<=93)){keyCode=-1}if(!hashId&&keyCode===13){var location="location"in e?e.location:e.keyLocation;if(location===3){callback(e,hashId,-keyCode);if(e.defaultPrevented)return}}if(useragent.isChromeOS&&hashId&8){callback(e,hashId,keyCode);if(e.defaultPrevented)return;else hashId&=~8}if(!hashId&&!(keyCode in keys.FUNCTION_KEYS)&&!(keyCode in keys.PRINTABLE_KEYS)){return false}return callback(e,hashId,keyCode)}exports.addCommandKeyListener=function(el,callback){var addListener=exports.addListener;if(useragent.isOldGecko||useragent.isOpera&&!("KeyboardEvent"in window)){var lastKeyDownKeyCode=null;addListener(el,"keydown",(function(e){lastKeyDownKeyCode=e.keyCode}));addListener(el,"keypress",(function(e){return normalizeCommandKeys(callback,e,lastKeyDownKeyCode)}))}else{var lastDefaultPrevented=null;addListener(el,"keydown",(function(e){pressedKeys[e.keyCode]=(pressedKeys[e.keyCode]||0)+1;var result=normalizeCommandKeys(callback,e,e.keyCode);lastDefaultPrevented=e.defaultPrevented;return result}));addListener(el,"keypress",(function(e){if(lastDefaultPrevented&&(e.ctrlKey||e.altKey||e.shiftKey||e.metaKey)){exports.stopEvent(e);lastDefaultPrevented=null}}));addListener(el,"keyup",(function(e){pressedKeys[e.keyCode]=null}));if(!pressedKeys){resetPressedKeys();addListener(window,"focus",resetPressedKeys)}}};function resetPressedKeys(){pressedKeys=Object.create(null)}if(typeof window=="object"&&window.postMessage&&!useragent.isOldIE){var postMessageId=1;exports.nextTick=function(callback,win){win=win||window;var messageName="zero-timeout-message-"+postMessageId;exports.addListener(win,"message",(function listener(e){if(e.data==messageName){exports.stopPropagation(e);exports.removeListener(win,"message",listener);callback()}}));win.postMessage(messageName,"*")}}exports.nextFrame=typeof window=="object"&&(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame);if(exports.nextFrame)exports.nextFrame=exports.nextFrame.bind(window);else exports.nextFrame=function(callback){setTimeout(callback,17)}}));ace.define("ace/lib/lang",["require","exports","module"],(function(acequire,exports,module){"use strict";exports.last=function(a){return a[a.length-1]};exports.stringReverse=function(string){return string.split("").reverse().join("")};exports.stringRepeat=function(string,count){var result="";while(count>0){if(count&1)result+=string;if(count>>=1)string+=string}return result};var trimBeginRegexp=/^\s\s*/;var trimEndRegexp=/\s\s*$/;exports.stringTrimLeft=function(string){return string.replace(trimBeginRegexp,"")};exports.stringTrimRight=function(string){return string.replace(trimEndRegexp,"")};exports.copyObject=function(obj){var copy={};for(var key in obj){copy[key]=obj[key]}return copy};exports.copyArray=function(array){var copy=[];for(var i=0,l=array.length;i<l;i++){if(array[i]&&typeof array[i]=="object")copy[i]=this.copyObject(array[i]);else copy[i]=array[i]}return copy};exports.deepCopy=function deepCopy(obj){if(typeof obj!=="object"||!obj)return obj;var copy;if(Array.isArray(obj)){copy=[];for(var key=0;key<obj.length;key++){copy[key]=deepCopy(obj[key])}return copy}if(Object.prototype.toString.call(obj)!=="[object Object]")return obj;copy={};for(var key in obj)copy[key]=deepCopy(obj[key]);return copy};exports.arrayToMap=function(arr){var map={};for(var i=0;i<arr.length;i++){map[arr[i]]=1}return map};exports.createMap=function(props){var map=Object.create(null);for(var i in props){map[i]=props[i]}return map};exports.arrayRemove=function(array,value){for(var i=0;i<=array.length;i++){if(value===array[i]){array.splice(i,1)}}};exports.escapeRegExp=function(str){return str.replace(/([.*+?^${}()|[\]\/\\])/g,"\\$1")};exports.escapeHTML=function(str){return str.replace(/&/g,"&#38;").replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/</g,"&#60;")};exports.getMatchOffsets=function(string,regExp){var matches=[];string.replace(regExp,(function(str){matches.push({offset:arguments[arguments.length-2],length:str.length})}));return matches};exports.deferredCall=function(fcn){var timer=null;var callback=function(){timer=null;fcn()};var deferred=function(timeout){deferred.cancel();timer=setTimeout(callback,timeout||0);return deferred};deferred.schedule=deferred;deferred.call=function(){this.cancel();fcn();return deferred};deferred.cancel=function(){clearTimeout(timer);timer=null;return deferred};deferred.isPending=function(){return timer};return deferred};exports.delayedCall=function(fcn,defaultTimeout){var timer=null;var callback=function(){timer=null;fcn()};var _self=function(timeout){if(timer==null)timer=setTimeout(callback,timeout||defaultTimeout)};_self.delay=function(timeout){timer&&clearTimeout(timer);timer=setTimeout(callback,timeout||defaultTimeout)};_self.schedule=_self;_self.call=function(){this.cancel();fcn()};_self.cancel=function(){timer&&clearTimeout(timer);timer=null};_self.isPending=function(){return timer};return _self}}));ace.define("ace/keyboard/textinput_ios",["require","exports","module","ace/lib/event","ace/lib/useragent","ace/lib/dom","ace/lib/lang","ace/lib/keys"],(function(acequire,exports,module){"use strict";var event=acequire("../lib/event");var useragent=acequire("../lib/useragent");var dom=acequire("../lib/dom");var lang=acequire("../lib/lang");var KEYS=acequire("../lib/keys");var MODS=KEYS.KEY_MODS;var BROKEN_SETDATA=useragent.isChrome<18;var USE_IE_MIME_TYPE=useragent.isIE;var TextInput=function(parentNode,host){var self=this;var text=dom.createElement("textarea");text.className=useragent.isIOS?"ace_text-input ace_text-input-ios":"ace_text-input";if(useragent.isTouchPad)text.setAttribute("x-palm-disable-auto-cap",true);text.setAttribute("wrap","off");text.setAttribute("autocorrect","off");text.setAttribute("autocapitalize","off");text.setAttribute("spellcheck",false);text.style.opacity="0";parentNode.insertBefore(text,parentNode.firstChild);var PLACEHOLDER="\n aaaa a\n";var copied=false;var cut=false;var pasted=false;var inComposition=false;var tempStyle="";var isSelectionEmpty=true;try{var isFocused=document.activeElement===text}catch(e){}event.addListener(text,"blur",(function(e){host.onBlur(e);isFocused=false}));event.addListener(text,"focus",(function(e){isFocused=true;host.onFocus(e);resetSelection()}));this.focus=function(){if(tempStyle)return text.focus();text.style.position="fixed";text.focus()};this.blur=function(){text.blur()};this.isFocused=function(){return isFocused};var syncSelection=lang.delayedCall((function(){isFocused&&resetSelection(isSelectionEmpty)}));var syncValue=lang.delayedCall((function(){if(!inComposition){text.value=PLACEHOLDER;isFocused&&resetSelection()}}));function resetSelection(isEmpty){if(inComposition)return;inComposition=true;if(inputHandler){selectionStart=0;selectionEnd=isEmpty?0:text.value.length-1}else{var selectionStart=4;var selectionEnd=5}try{text.setSelectionRange(selectionStart,selectionEnd)}catch(e){}inComposition=false}function resetValue(){if(inComposition)return;text.value=PLACEHOLDER;if(useragent.isWebKit)syncValue.schedule()}useragent.isWebKit||host.addEventListener("changeSelection",(function(){if(host.selection.isEmpty()!=isSelectionEmpty){isSelectionEmpty=!isSelectionEmpty;syncSelection.schedule()}}));resetValue();if(isFocused)host.onFocus();var isAllSelected=function(text){return text.selectionStart===0&&text.selectionEnd===text.value.length};var onSelect=function(e){if(isAllSelected(text)){host.selectAll();resetSelection()}else if(inputHandler){resetSelection(host.selection.isEmpty())}};var inputHandler=null;this.setInputHandler=function(cb){inputHandler=cb};this.getInputHandler=function(){return inputHandler};var afterContextMenu=false;var sendText=function(data){if(text.selectionStart===4&&text.selectionEnd===5){return}if(inputHandler){data=inputHandler(data);inputHandler=null}if(pasted){resetSelection();if(data)host.onPaste(data);pasted=false}else if(data==PLACEHOLDER.substr(0)&&text.selectionStart===4){if(afterContextMenu)host.execCommand("del",{source:"ace"});else host.execCommand("backspace",{source:"ace"})}else if(!copied){if(data.substring(0,9)==PLACEHOLDER&&data.length>PLACEHOLDER.length)data=data.substr(9);else if(data.substr(0,4)==PLACEHOLDER.substr(0,4))data=data.substr(4,data.length-PLACEHOLDER.length+1);else if(data.charAt(data.length-1)==PLACEHOLDER.charAt(0))data=data.slice(0,-1);if(data==PLACEHOLDER.charAt(0)){}else if(data.charAt(data.length-1)==PLACEHOLDER.charAt(0))data=data.slice(0,-1);if(data)host.onTextInput(data)}if(copied){copied=false}if(afterContextMenu)afterContextMenu=false};var onInput=function(e){if(inComposition)return;var data=text.value;sendText(data);resetValue()};var handleClipboardData=function(e,data,forceIEMime){var clipboardData=e.clipboardData||window.clipboardData;if(!clipboardData||BROKEN_SETDATA)return;var mime=USE_IE_MIME_TYPE||forceIEMime?"Text":"text/plain";try{if(data){return clipboardData.setData(mime,data)!==false}else{return clipboardData.getData(mime)}}catch(e){if(!forceIEMime)return handleClipboardData(e,data,true)}};var doCopy=function(e,isCut){var data=host.getCopyText();if(!data)return event.preventDefault(e);if(handleClipboardData(e,data)){if(useragent.isIOS){cut=isCut;text.value="\n aa"+data+"a a\n";text.setSelectionRange(4,4+data.length);copied={value:data}}isCut?host.onCut():host.onCopy();if(!useragent.isIOS)event.preventDefault(e)}else{copied=true;text.value=data;text.select();setTimeout((function(){copied=false;resetValue();resetSelection();isCut?host.onCut():host.onCopy()}))}};var onCut=function(e){doCopy(e,true)};var onCopy=function(e){doCopy(e,false)};var onPaste=function(e){var data=handleClipboardData(e);if(typeof data=="string"){if(data)host.onPaste(data,e);if(useragent.isIE)setTimeout(resetSelection);event.preventDefault(e)}else{text.value="";pasted=true}};event.addCommandKeyListener(text,host.onCommandKey.bind(host));event.addListener(text,"select",onSelect);event.addListener(text,"input",onInput);event.addListener(text,"cut",onCut);event.addListener(text,"copy",onCopy);event.addListener(text,"paste",onPaste);var onCompositionStart=function(e){if(inComposition||!host.onCompositionStart||host.$readOnly)return;inComposition={};inComposition.canUndo=host.session.$undoManager;host.onCompositionStart();setTimeout(onCompositionUpdate,0);host.on("mousedown",onCompositionEnd);if(inComposition.canUndo&&!host.selection.isEmpty()){host.insert("");host.session.markUndoGroup();host.selection.clearSelection()}host.session.markUndoGroup()};var onCompositionUpdate=function(){if(!inComposition||!host.onCompositionUpdate||host.$readOnly)return;var val=text.value.replace(/\x01/g,"");if(inComposition.lastValue===val)return;host.onCompositionUpdate(val);if(inComposition.lastValue)host.undo();if(inComposition.canUndo)inComposition.lastValue=val;if(inComposition.lastValue){var r=host.selection.getRange();host.insert(inComposition.lastValue);host.session.markUndoGroup();inComposition.range=host.selection.getRange();host.selection.setRange(r);host.selection.clearSelection()}};var onCompositionEnd=function(e){if(!host.onCompositionEnd||host.$readOnly)return;var c=inComposition;inComposition=false;var timer=setTimeout((function(){timer=null;var str=text.value.replace(/\x01/g,"");if(inComposition)return;else if(str==c.lastValue)resetValue();else if(!c.lastValue&&str){resetValue();sendText(str)}}));inputHandler=function compositionInputHandler(str){if(timer)clearTimeout(timer);str=str.replace(/\x01/g,"");if(str==c.lastValue)return"";if(c.lastValue&&timer)host.undo();return str};host.onCompositionEnd();host.removeListener("mousedown",onCompositionEnd);if(e.type=="compositionend"&&c.range){host.selection.setRange(c.range)}var needsOnInput=!!useragent.isChrome&&useragent.isChrome>=53||!!useragent.isWebKit&&useragent.isWebKit>=603;if(needsOnInput){onInput()}};var syncComposition=lang.delayedCall(onCompositionUpdate,50);event.addListener(text,"compositionstart",onCompositionStart);if(useragent.isGecko){event.addListener(text,"text",(function(){syncComposition.schedule()}))}else{event.addListener(text,"keyup",(function(){syncComposition.schedule()}));event.addListener(text,"keydown",(function(){syncComposition.schedule()}))}event.addListener(text,"compositionend",onCompositionEnd);this.getElement=function(){return text};this.setReadOnly=function(readOnly){text.readOnly=readOnly};this.onContextMenu=function(e){afterContextMenu=true;resetSelection(host.selection.isEmpty());host._emit("nativecontextmenu",{target:host,domEvent:e});this.moveToMouse(e,true)};this.moveToMouse=function(e,bringToFront){if(!tempStyle)tempStyle=text.style.cssText;text.style.cssText=(bringToFront?"z-index:100000;":"")+"height:"+text.style.height+";"+(useragent.isIE?"opacity:0.1;":"");var rect=host.container.getBoundingClientRect();var style=dom.computedStyle(host.container);var top=rect.top+(parseInt(style.borderTopWidth)||0);var left=rect.left+(parseInt(rect.borderLeftWidth)||0);var maxTop=rect.bottom-top-text.clientHeight-2;var move=function(e){text.style.left=e.clientX-left-2+"px";text.style.top=Math.min(e.clientY-top-2,maxTop)+"px"};move(e);if(e.type!="mousedown")return;if(host.renderer.$keepTextAreaAtCursor)host.renderer.$keepTextAreaAtCursor=null;clearTimeout(closeTimeout);if(useragent.isWin)event.capture(host.container,move,onContextMenuClose)};this.onContextMenuClose=onContextMenuClose;var closeTimeout;function onContextMenuClose(){clearTimeout(closeTimeout);closeTimeout=setTimeout((function(){if(tempStyle){text.style.cssText=tempStyle;tempStyle=""}if(host.renderer.$keepTextAreaAtCursor==null){host.renderer.$keepTextAreaAtCursor=true;host.renderer.$moveTextAreaToCursor()}}),0)}var onContextMenu=function(e){host.textInput.onContextMenu(e);onContextMenuClose()};event.addListener(text,"mouseup",onContextMenu);event.addListener(text,"mousedown",(function(e){e.preventDefault();onContextMenuClose()}));event.addListener(host.renderer.scroller,"contextmenu",onContextMenu);event.addListener(text,"contextmenu",onContextMenu);if(useragent.isIOS){var typingResetTimeout=null;var typing=false;parentNode.addEventListener("keydown",(function(e){if(typingResetTimeout)clearTimeout(typingResetTimeout);typing=true}));parentNode.addEventListener("keyup",(function(e){typingResetTimeout=setTimeout((function(){typing=false}),100)}));var detectArrowKeys=function(e){if(document.activeElement!==text)return;if(typing)return;if(cut){return setTimeout((function(){cut=false}),100)}var selectionStart=text.selectionStart;var selectionEnd=text.selectionEnd;text.setSelectionRange(4,5);if(selectionStart==selectionEnd){switch(selectionStart){case 0:host.onCommandKey(null,0,KEYS.up);break;case 1:host.onCommandKey(null,0,KEYS.home);break;case 2:host.onCommandKey(null,MODS.option,KEYS.left);break;case 4:host.onCommandKey(null,0,KEYS.left);break;case 5:host.onCommandKey(null,0,KEYS.right);break;case 7:host.onCommandKey(null,MODS.option,KEYS.right);break;case 8:host.onCommandKey(null,0,KEYS.end);break;case 9:host.onCommandKey(null,0,KEYS.down);break}}else{switch(selectionEnd){case 6:host.onCommandKey(null,MODS.shift,KEYS.right);break;case 7:host.onCommandKey(null,MODS.shift|MODS.option,KEYS.right);break;case 8:host.onCommandKey(null,MODS.shift,KEYS.end);break;case 9:host.onCommandKey(null,MODS.shift,KEYS.down);break}switch(selectionStart){case 0:host.onCommandKey(null,MODS.shift,KEYS.up);break;case 1:host.onCommandKey(null,MODS.shift,KEYS.home);break;case 2:host.onCommandKey(null,MODS.shift|MODS.option,KEYS.left);break;case 3:host.onCommandKey(null,MODS.shift,KEYS.left);break}}};document.addEventListener("selectionchange",detectArrowKeys);host.on("destroy",(function(){document.removeEventListener("selectionchange",detectArrowKeys)}))}};exports.TextInput=TextInput}));ace.define("ace/keyboard/textinput",["require","exports","module","ace/lib/event","ace/lib/useragent","ace/lib/dom","ace/lib/lang","ace/keyboard/textinput_ios"],(function(acequire,exports,module){"use strict";var event=acequire("../lib/event");var useragent=acequire("../lib/useragent");var dom=acequire("../lib/dom");var lang=acequire("../lib/lang");var BROKEN_SETDATA=useragent.isChrome<18;var USE_IE_MIME_TYPE=useragent.isIE;var TextInputIOS=acequire("./textinput_ios").TextInput;var TextInput=function(parentNode,host){if(useragent.isIOS)return TextInputIOS.call(this,parentNode,host);var text=dom.createElement("textarea");text.className="ace_text-input";text.setAttribute("wrap","off");text.setAttribute("autocorrect","off");text.setAttribute("autocapitalize","off");text.setAttribute("spellcheck",false);text.style.opacity="0";parentNode.insertBefore(text,parentNode.firstChild);var PLACEHOLDER="\u2028\u2028";var copied=false;var pasted=false;var inComposition=false;var tempStyle="";var isSelectionEmpty=true;try{var isFocused=document.activeElement===text}catch(e){}event.addListener(text,"blur",(function(e){host.onBlur(e);isFocused=false}));event.addListener(text,"focus",(function(e){isFocused=true;host.onFocus(e);resetSelection()}));this.focus=function(){if(tempStyle)return text.focus();var top=text.style.top;text.style.position="fixed";text.style.top="0px";text.focus();setTimeout((function(){text.style.position="";if(text.style.top=="0px")text.style.top=top}),0)};this.blur=function(){text.blur()};this.isFocused=function(){return isFocused};var syncSelection=lang.delayedCall((function(){isFocused&&resetSelection(isSelectionEmpty)}));var syncValue=lang.delayedCall((function(){if(!inComposition){text.value=PLACEHOLDER;isFocused&&resetSelection()}}));function resetSelection(isEmpty){if(inComposition)return;inComposition=true;if(inputHandler){var selectionStart=0;var selectionEnd=isEmpty?0:text.value.length-1}else{var selectionStart=isEmpty?2:1;var selectionEnd=2}try{text.setSelectionRange(selectionStart,selectionEnd)}catch(e){}inComposition=false}function resetValue(){if(inComposition)return;text.value=PLACEHOLDER;if(useragent.isWebKit)syncValue.schedule()}useragent.isWebKit||host.addEventListener("changeSelection",(function(){if(host.selection.isEmpty()!=isSelectionEmpty){isSelectionEmpty=!isSelectionEmpty;syncSelection.schedule()}}));resetValue();if(isFocused)host.onFocus();var isAllSelected=function(text){return text.selectionStart===0&&text.selectionEnd===text.value.length};var onSelect=function(e){if(copied){copied=false}else if(isAllSelected(text)){host.selectAll();resetSelection()}else if(inputHandler){resetSelection(host.selection.isEmpty())}};var inputHandler=null;this.setInputHandler=function(cb){inputHandler=cb};this.getInputHandler=function(){return inputHandler};var afterContextMenu=false;var sendText=function(data){if(inputHandler){data=inputHandler(data);inputHandler=null}if(pasted){resetSelection();if(data)host.onPaste(data);pasted=false}else if(data==PLACEHOLDER.charAt(0)){if(afterContextMenu)host.execCommand("del",{source:"ace"});else host.execCommand("backspace",{source:"ace"})}else{if(data.substring(0,2)==PLACEHOLDER)data=data.substr(2);else if(data.charAt(0)==PLACEHOLDER.charAt(0))data=data.substr(1);else if(data.charAt(data.length-1)==PLACEHOLDER.charAt(0))data=data.slice(0,-1);if(data.charAt(data.length-1)==PLACEHOLDER.charAt(0))data=data.slice(0,-1);if(data)host.onTextInput(data)}if(afterContextMenu)afterContextMenu=false};var onInput=function(e){if(inComposition)return;var data=text.value;sendText(data);resetValue()};var handleClipboardData=function(e,data,forceIEMime){var clipboardData=e.clipboardData||window.clipboardData;if(!clipboardData||BROKEN_SETDATA)return;var mime=USE_IE_MIME_TYPE||forceIEMime?"Text":"text/plain";try{if(data){return clipboardData.setData(mime,data)!==false}else{return clipboardData.getData(mime)}}catch(e){if(!forceIEMime)return handleClipboardData(e,data,true)}};var doCopy=function(e,isCut){var data=host.getCopyText();if(!data)return event.preventDefault(e);if(handleClipboardData(e,data)){isCut?host.onCut():host.onCopy();event.preventDefault(e)}else{copied=true;text.value=data;text.select();setTimeout((function(){copied=false;resetValue();resetSelection();isCut?host.onCut():host.onCopy()}))}};var onCut=function(e){doCopy(e,true)};var onCopy=function(e){doCopy(e,false)};var onPaste=function(e){var data=handleClipboardData(e);if(typeof data=="string"){if(data)host.onPaste(data,e);if(useragent.isIE)setTimeout(resetSelection);event.preventDefault(e)}else{text.value="";pasted=true}};event.addCommandKeyListener(text,host.onCommandKey.bind(host));event.addListener(text,"select",onSelect);event.addListener(text,"input",onInput);event.addListener(text,"cut",onCut);event.addListener(text,"copy",onCopy);event.addListener(text,"paste",onPaste);if(!("oncut"in text)||!("oncopy"in text)||!("onpaste"in text)){event.addListener(parentNode,"keydown",(function(e){if(useragent.isMac&&!e.metaKey||!e.ctrlKey)return;switch(e.keyCode){case 67:onCopy(e);break;case 86:onPaste(e);break;case 88:onCut(e);break}}))}var onCompositionStart=function(e){if(inComposition||!host.onCompositionStart||host.$readOnly)return;inComposition={};inComposition.canUndo=host.session.$undoManager;host.onCompositionStart();setTimeout(onCompositionUpdate,0);host.on("mousedown",onCompositionEnd);if(inComposition.canUndo&&!host.selection.isEmpty()){host.insert("");host.session.markUndoGroup();host.selection.clearSelection()}host.session.markUndoGroup()};var onCompositionUpdate=function(){if(!inComposition||!host.onCompositionUpdate||host.$readOnly)return;var val=text.value.replace(/\u2028/g,"");if(inComposition.lastValue===val)return;host.onCompositionUpdate(val);if(inComposition.lastValue)host.undo();if(inComposition.canUndo)inComposition.lastValue=val;if(inComposition.lastValue){var r=host.selection.getRange();host.insert(inComposition.lastValue);host.session.markUndoGroup();inComposition.range=host.selection.getRange();host.selection.setRange(r);host.selection.clearSelection()}};var onCompositionEnd=function(e){if(!host.onCompositionEnd||host.$readOnly)return;var c=inComposition;inComposition=false;var timer=setTimeout((function(){timer=null;var str=text.value.replace(/\u2028/g,"");if(inComposition)return;else if(str==c.lastValue)resetValue();else if(!c.lastValue&&str){resetValue();sendText(str)}}));inputHandler=function compositionInputHandler(str){if(timer)clearTimeout(timer);str=str.replace(/\u2028/g,"");if(str==c.lastValue)return"";if(c.lastValue&&timer)host.undo();return str};host.onCompositionEnd();host.removeListener("mousedown",onCompositionEnd);if(e.type=="compositionend"&&c.range){host.selection.setRange(c.range)}var needsOnInput=!!useragent.isChrome&&useragent.isChrome>=53||!!useragent.isWebKit&&useragent.isWebKit>=603;if(needsOnInput){onInput()}};var syncComposition=lang.delayedCall(onCompositionUpdate,50);event.addListener(text,"compositionstart",onCompositionStart);if(useragent.isGecko){event.addListener(text,"text",(function(){syncComposition.schedule()}))}else{event.addListener(text,"keyup",(function(){syncComposition.schedule()}));event.addListener(text,"keydown",(function(){syncComposition.schedule()}))}event.addListener(text,"compositionend",onCompositionEnd);this.getElement=function(){return text};this.setReadOnly=function(readOnly){text.readOnly=readOnly};this.onContextMenu=function(e){afterContextMenu=true;resetSelection(host.selection.isEmpty());host._emit("nativecontextmenu",{target:host,domEvent:e});this.moveToMouse(e,true)};this.moveToMouse=function(e,bringToFront){if(!tempStyle)tempStyle=text.style.cssText;text.style.cssText=(bringToFront?"z-index:100000;":"")+"height:"+text.style.height+";"+(useragent.isIE?"opacity:0.1;":"");var rect=host.container.getBoundingClientRect();var style=dom.computedStyle(host.container);var top=rect.top+(parseInt(style.borderTopWidth)||0);var left=rect.left+(parseInt(rect.borderLeftWidth)||0);var maxTop=rect.bottom-top-text.clientHeight-2;var move=function(e){text.style.left=e.clientX-left-2+"px";text.style.top=Math.min(e.clientY-top-2,maxTop)+"px"};move(e);if(e.type!="mousedown")return;if(host.renderer.$keepTextAreaAtCursor)host.renderer.$keepTextAreaAtCursor=null;clearTimeout(closeTimeout);if(useragent.isWin)event.capture(host.container,move,onContextMenuClose)};this.onContextMenuClose=onContextMenuClose;var closeTimeout;function onContextMenuClose(){clearTimeout(closeTimeout);closeTimeout=setTimeout((function(){if(tempStyle){text.style.cssText=tempStyle;tempStyle=""}if(host.renderer.$keepTextAreaAtCursor==null){host.renderer.$keepTextAreaAtCursor=true;host.renderer.$moveTextAreaToCursor()}}),0)}var onContextMenu=function(e){host.textInput.onContextMenu(e);onContextMenuClose()};event.addListener(text,"mouseup",onContextMenu);event.addListener(text,"mousedown",(function(e){e.preventDefault();onContextMenuClose()}));event.addListener(host.renderer.scroller,"contextmenu",onContextMenu);event.addListener(text,"contextmenu",onContextMenu)};exports.TextInput=TextInput}));ace.define("ace/mouse/default_handlers",["require","exports","module","ace/lib/dom","ace/lib/event","ace/lib/useragent"],(function(acequire,exports,module){"use strict";var dom=acequire("../lib/dom");var event=acequire("../lib/event");var useragent=acequire("../lib/useragent");var DRAG_OFFSET=0;var SCROLL_COOLDOWN_T=250;function DefaultHandlers(mouseHandler){mouseHandler.$clickSelection=null;var editor=mouseHandler.editor;editor.setDefaultHandler("mousedown",this.onMouseDown.bind(mouseHandler));editor.setDefaultHandler("dblclick",this.onDoubleClick.bind(mouseHandler));editor.setDefaultHandler("tripleclick",this.onTripleClick.bind(mouseHandler));editor.setDefaultHandler("quadclick",this.onQuadClick.bind(mouseHandler));editor.setDefaultHandler("mousewheel",this.onMouseWheel.bind(mouseHandler));editor.setDefaultHandler("touchmove",this.onTouchMove.bind(mouseHandler));var exports=["select","startSelect","selectEnd","selectAllEnd","selectByWordsEnd","selectByLinesEnd","dragWait","dragWaitEnd","focusWait"];exports.forEach((function(x){mouseHandler[x]=this[x]}),this);mouseHandler.selectByLines=this.extendSelectionBy.bind(mouseHandler,"getLineRange");mouseHandler.selectByWords=this.extendSelectionBy.bind(mouseHandler,"getWordRange")}(function(){this.onMouseDown=function(ev){var inSelection=ev.inSelection();var pos=ev.getDocumentPosition();this.mousedownEvent=ev;var editor=this.editor;var button=ev.getButton();if(button!==0){var selectionRange=editor.getSelectionRange();var selectionEmpty=selectionRange.isEmpty();editor.$blockScrolling++;if(selectionEmpty||button==1)editor.selection.moveToPosition(pos);editor.$blockScrolling--;if(button==2){editor.textInput.onContextMenu(ev.domEvent);if(!useragent.isMozilla)ev.preventDefault()}return}this.mousedownEvent.time=Date.now();if(inSelection&&!editor.isFocused()){editor.focus();if(this.$focusTimout&&!this.$clickSelection&&!editor.inMultiSelectMode){this.setState("focusWait");this.captureMouse(ev);return}}this.captureMouse(ev);this.startSelect(pos,ev.domEvent._clicks>1);return ev.preventDefault()};this.startSelect=function(pos,waitForClickSelection){pos=pos||this.editor.renderer.screenToTextCoordinates(this.x,this.y);var editor=this.editor;editor.$blockScrolling++;if(this.mousedownEvent.getShiftKey())editor.selection.selectToPosition(pos);else if(!waitForClickSelection)editor.selection.moveToPosition(pos);if(!waitForClickSelection)this.select();if(editor.renderer.scroller.setCapture){editor.renderer.scroller.setCapture()}editor.setStyle("ace_selecting");this.setState("select");editor.$blockScrolling--};this.select=function(){var anchor,editor=this.editor;var cursor=editor.renderer.screenToTextCoordinates(this.x,this.y);editor.$blockScrolling++;if(this.$clickSelection){var cmp=this.$clickSelection.comparePoint(cursor);if(cmp==-1){anchor=this.$clickSelection.end}else if(cmp==1){anchor=this.$clickSelection.start}else{var orientedRange=calcRangeOrientation(this.$clickSelection,cursor);cursor=orientedRange.cursor;anchor=orientedRange.anchor}editor.selection.setSelectionAnchor(anchor.row,anchor.column)}editor.selection.selectToPosition(cursor);editor.$blockScrolling--;editor.renderer.scrollCursorIntoView()};this.extendSelectionBy=function(unitName){var anchor,editor=this.editor;var cursor=editor.renderer.screenToTextCoordinates(this.x,this.y);var range=editor.selection[unitName](cursor.row,cursor.column);editor.$blockScrolling++;if(this.$clickSelection){var cmpStart=this.$clickSelection.comparePoint(range.start);var cmpEnd=this.$clickSelection.comparePoint(range.end);if(cmpStart==-1&&cmpEnd<=0){anchor=this.$clickSelection.end;if(range.end.row!=cursor.row||range.end.column!=cursor.column)cursor=range.start}else if(cmpEnd==1&&cmpStart>=0){anchor=this.$clickSelection.start;if(range.start.row!=cursor.row||range.start.column!=cursor.column)cursor=range.end}else if(cmpStart==-1&&cmpEnd==1){cursor=range.end;anchor=range.start}else{var orientedRange=calcRangeOrientation(this.$clickSelection,cursor);cursor=orientedRange.cursor;anchor=orientedRange.anchor}editor.selection.setSelectionAnchor(anchor.row,anchor.column)}editor.selection.selectToPosition(cursor);editor.$blockScrolling--;editor.renderer.scrollCursorIntoView()};this.selectEnd=this.selectAllEnd=this.selectByWordsEnd=this.selectByLinesEnd=function(){this.$clickSelection=null;this.editor.unsetStyle("ace_selecting");if(this.editor.renderer.scroller.releaseCapture){this.editor.renderer.scroller.releaseCapture()}};this.focusWait=function(){var distance=calcDistance(this.mousedownEvent.x,this.mousedownEvent.y,this.x,this.y);var time=Date.now();if(distance>DRAG_OFFSET||time-this.mousedownEvent.time>this.$focusTimout)this.startSelect(this.mousedownEvent.getDocumentPosition())};this.onDoubleClick=function(ev){var pos=ev.getDocumentPosition();var editor=this.editor;var session=editor.session;var range=session.getBracketRange(pos);if(range){if(range.isEmpty()){range.start.column--;range.end.column++}this.setState("select")}else{range=editor.selection.getWordRange(pos.row,pos.column);this.setState("selectByWords")}this.$clickSelection=range;this.select()};this.onTripleClick=function(ev){var pos=ev.getDocumentPosition();var editor=this.editor;this.setState("selectByLines");var range=editor.getSelectionRange();if(range.isMultiLine()&&range.contains(pos.row,pos.column)){this.$clickSelection=editor.selection.getLineRange(range.start.row);this.$clickSelection.end=editor.selection.getLineRange(range.end.row).end}else{this.$clickSelection=editor.selection.getLineRange(pos.row)}this.select()};this.onQuadClick=function(ev){var editor=this.editor;editor.selectAll();this.$clickSelection=editor.getSelectionRange();this.setState("selectAll")};this.onMouseWheel=function(ev){if(ev.getAccelKey())return;if(ev.getShiftKey()&&ev.wheelY&&!ev.wheelX){ev.wheelX=ev.wheelY;ev.wheelY=0}var editor=this.editor;if(!this.$lastScroll)this.$lastScroll={t:0,vx:0,vy:0,allowed:0};var prevScroll=this.$lastScroll;var t=ev.domEvent.timeStamp;var dt=t-prevScroll.t;var vx=ev.wheelX/dt;var vy=ev.wheelY/dt;if(dt<SCROLL_COOLDOWN_T){vx=(vx+prevScroll.vx)/2;vy=(vy+prevScroll.vy)/2}var direction=Math.abs(vx/vy);var canScroll=false;if(direction>=1&&editor.renderer.isScrollableBy(ev.wheelX*ev.speed,0))canScroll=true;if(direction<=1&&editor.renderer.isScrollableBy(0,ev.wheelY*ev.speed))canScroll=true;if(canScroll){prevScroll.allowed=t}else if(t-prevScroll.allowed<SCROLL_COOLDOWN_T){var isSlower=Math.abs(vx)<=1.1*Math.abs(prevScroll.vx)&&Math.abs(vy)<=1.1*Math.abs(prevScroll.vy);if(isSlower){canScroll=true;prevScroll.allowed=t}else{prevScroll.allowed=0}}prevScroll.t=t;prevScroll.vx=vx;prevScroll.vy=vy;if(canScroll){editor.renderer.scrollBy(ev.wheelX*ev.speed,ev.wheelY*ev.speed);return ev.stop()}};this.onTouchMove=function(ev){this.editor._emit("mousewheel",ev)}}).call(DefaultHandlers.prototype);exports.DefaultHandlers=DefaultHandlers;function calcDistance(ax,ay,bx,by){return Math.sqrt(Math.pow(bx-ax,2)+Math.pow(by-ay,2))}function calcRangeOrientation(range,cursor){if(range.start.row==range.end.row)var cmp=2*cursor.column-range.start.column-range.end.column;else if(range.start.row==range.end.row-1&&!range.start.column&&!range.end.column)var cmp=cursor.column-4;else var cmp=2*cursor.row-range.start.row-range.end.row;if(cmp<0)return{cursor:range.start,anchor:range.end};else return{cursor:range.end,anchor:range.start}}}));ace.define("ace/tooltip",["require","exports","module","ace/lib/oop","ace/lib/dom"],(function(acequire,exports,module){"use strict";var oop=acequire("./lib/oop");var dom=acequire("./lib/dom");function Tooltip(parentNode){this.isOpen=false;this.$element=null;this.$parentNode=parentNode}(function(){this.$init=function(){this.$element=dom.createElement("div");this.$element.className="ace_tooltip";this.$element.style.display="none";this.$parentNode.appendChild(this.$element);return this.$element};this.getElement=function(){return this.$element||this.$init()};this.setText=function(text){dom.setInnerText(this.getElement(),text)};this.setHtml=function(html){this.getElement().innerHTML=html};this.setPosition=function(x,y){this.getElement().style.left=x+"px";this.getElement().style.top=y+"px"};this.setClassName=function(className){dom.addCssClass(this.getElement(),className)};this.show=function(text,x,y){if(text!=null)this.setText(text);if(x!=null&&y!=null)this.setPosition(x,y);if(!this.isOpen){this.getElement().style.display="block";this.isOpen=true}};this.hide=function(){if(this.isOpen){this.getElement().style.display="none";this.isOpen=false}};this.getHeight=function(){return this.getElement().offsetHeight};this.getWidth=function(){return this.getElement().offsetWidth};this.destroy=function(){this.isOpen=false;if(this.$element&&this.$element.parentNode){this.$element.parentNode.removeChild(this.$element)}}}).call(Tooltip.prototype);exports.Tooltip=Tooltip}));ace.define("ace/mouse/default_gutter_handler",["require","exports","module","ace/lib/dom","ace/lib/oop","ace/lib/event","ace/tooltip"],(function(acequire,exports,module){"use strict";var dom=acequire("../lib/dom");var oop=acequire("../lib/oop");var event=acequire("../lib/event");var Tooltip=acequire("../tooltip").Tooltip;function GutterHandler(mouseHandler){var editor=mouseHandler.editor;var gutter=editor.renderer.$gutterLayer;var tooltip=new GutterTooltip(editor.container);mouseHandler.editor.setDefaultHandler("guttermousedown",(function(e){if(!editor.isFocused()||e.getButton()!=0)return;var gutterRegion=gutter.getRegion(e);if(gutterRegion=="foldWidgets")return;var row=e.getDocumentPosition().row;var selection=editor.session.selection;if(e.getShiftKey())selection.selectTo(row,0);else{if(e.domEvent.detail==2){editor.selectAll();return e.preventDefault()}mouseHandler.$clickSelection=editor.selection.getLineRange(row)}mouseHandler.setState("selectByLines");mouseHandler.captureMouse(e);return e.preventDefault()}));var tooltipTimeout,mouseEvent,tooltipAnnotation;function showTooltip(){var row=mouseEvent.getDocumentPosition().row;var annotation=gutter.$annotations[row];if(!annotation)return hideTooltip();var maxRow=editor.session.getLength();if(row==maxRow){var screenRow=editor.renderer.pixelToScreenCoordinates(0,mouseEvent.y).row;var pos=mouseEvent.$pos;if(screenRow>editor.session.documentToScreenRow(pos.row,pos.column))return hideTooltip()}if(tooltipAnnotation==annotation)return;tooltipAnnotation=annotation.text.join("<br/>");tooltip.setHtml(tooltipAnnotation);tooltip.show();editor._signal("showGutterTooltip",tooltip);editor.on("mousewheel",hideTooltip);if(mouseHandler.$tooltipFollowsMouse){moveTooltip(mouseEvent)}else{var gutterElement=mouseEvent.domEvent.target;var rect=gutterElement.getBoundingClientRect();var style=tooltip.getElement().style;style.left=rect.right+"px";style.top=rect.bottom+"px"}}function hideTooltip(){if(tooltipTimeout)tooltipTimeout=clearTimeout(tooltipTimeout);if(tooltipAnnotation){tooltip.hide();tooltipAnnotation=null;editor._signal("hideGutterTooltip",tooltip);editor.removeEventListener("mousewheel",hideTooltip)}}function moveTooltip(e){tooltip.setPosition(e.x,e.y)}mouseHandler.editor.setDefaultHandler("guttermousemove",(function(e){var target=e.domEvent.target||e.domEvent.srcElement;if(dom.hasCssClass(target,"ace_fold-widget"))return hideTooltip();if(tooltipAnnotation&&mouseHandler.$tooltipFollowsMouse)moveTooltip(e);mouseEvent=e;if(tooltipTimeout)return;tooltipTimeout=setTimeout((function(){tooltipTimeout=null;if(mouseEvent&&!mouseHandler.isMousePressed)showTooltip();else hideTooltip()}),50)}));event.addListener(editor.renderer.$gutter,"mouseout",(function(e){mouseEvent=null;if(!tooltipAnnotation||tooltipTimeout)return;tooltipTimeout=setTimeout((function(){tooltipTimeout=null;hideTooltip()}),50)}));editor.on("changeSession",hideTooltip)}function GutterTooltip(parentNode){Tooltip.call(this,parentNode)}oop.inherits(GutterTooltip,Tooltip);(function(){this.setPosition=function(x,y){var windowWidth=window.innerWidth||document.documentElement.clientWidth;var windowHeight=window.innerHeight||document.documentElement.clientHeight;var width=this.getWidth();var height=this.getHeight();x+=15;y+=15;if(x+width>windowWidth){x-=x+width-windowWidth}if(y+height>windowHeight){y-=20+height}Tooltip.prototype.setPosition.call(this,x,y)}}).call(GutterTooltip.prototype);exports.GutterHandler=GutterHandler}));ace.define("ace/mouse/mouse_event",["require","exports","module","ace/lib/event","ace/lib/useragent"],(function(acequire,exports,module){"use strict";var event=acequire("../lib/event");var useragent=acequire("../lib/useragent");var MouseEvent=exports.MouseEvent=function(domEvent,editor){this.domEvent=domEvent;this.editor=editor;this.x=this.clientX=domEvent.clientX;this.y=this.clientY=domEvent.clientY;this.$pos=null;this.$inSelection=null;this.propagationStopped=false;this.defaultPrevented=false};(function(){this.stopPropagation=function(){event.stopPropagation(this.domEvent);this.propagationStopped=true};this.preventDefault=function(){event.preventDefault(this.domEvent);this.defaultPrevented=true};this.stop=function(){this.stopPropagation();this.preventDefault()};this.getDocumentPosition=function(){if(this.$pos)return this.$pos;this.$pos=this.editor.renderer.screenToTextCoordinates(this.clientX,this.clientY);return this.$pos};this.inSelection=function(){if(this.$inSelection!==null)return this.$inSelection;var editor=this.editor;var selectionRange=editor.getSelectionRange();if(selectionRange.isEmpty())this.$inSelection=false;else{var pos=this.getDocumentPosition();this.$inSelection=selectionRange.contains(pos.row,pos.column)}return this.$inSelection};this.getButton=function(){return event.getButton(this.domEvent)};this.getShiftKey=function(){return this.domEvent.shiftKey};this.getAccelKey=useragent.isMac?function(){return this.domEvent.metaKey}:function(){return this.domEvent.ctrlKey}}).call(MouseEvent.prototype)}));ace.define("ace/mouse/dragdrop_handler",["require","exports","module","ace/lib/dom","ace/lib/event","ace/lib/useragent"],(function(acequire,exports,module){"use strict";var dom=acequire("../lib/dom");var event=acequire("../lib/event");var useragent=acequire("../lib/useragent");var AUTOSCROLL_DELAY=200;var SCROLL_CURSOR_DELAY=200;var SCROLL_CURSOR_HYSTERESIS=5;function DragdropHandler(mouseHandler){var editor=mouseHandler.editor;var blankImage=dom.createElement("img");blankImage.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";if(useragent.isOpera)blankImage.style.cssText="width:1px;height:1px;position:fixed;top:0;left:0;z-index:2147483647;opacity:0;";var exports=["dragWait","dragWaitEnd","startDrag","dragReadyEnd","onMouseDrag"];exports.forEach((function(x){mouseHandler[x]=this[x]}),this);editor.addEventListener("mousedown",this.onMouseDown.bind(mouseHandler));var mouseTarget=editor.container;var dragSelectionMarker,x,y;var timerId,range;var dragCursor,counter=0;var dragOperation;var isInternal;var autoScrollStartTime;var cursorMovedTime;var cursorPointOnCaretMoved;this.onDragStart=function(e){if(this.cancelDrag||!mouseTarget.draggable){var self=this;setTimeout((function(){self.startSelect();self.captureMouse(e)}),0);return e.preventDefault()}range=editor.getSelectionRange();var dataTransfer=e.dataTransfer;dataTransfer.effectAllowed=editor.getReadOnly()?"copy":"copyMove";if(useragent.isOpera){editor.container.appendChild(blankImage);blankImage.scrollTop=0}dataTransfer.setDragImage&&dataTransfer.setDragImage(blankImage,0,0);if(useragent.isOpera){editor.container.removeChild(blankImage)}dataTransfer.clearData();dataTransfer.setData("Text",editor.session.getTextRange());isInternal=true;this.setState("drag")};this.onDragEnd=function(e){mouseTarget.draggable=false;isInternal=false;this.setState(null);if(!editor.getReadOnly()){var dropEffect=e.dataTransfer.dropEffect;if(!dragOperation&&dropEffect=="move")editor.session.remove(editor.getSelectionRange());editor.renderer.$cursorLayer.setBlinking(true)}this.editor.unsetStyle("ace_dragging");this.editor.renderer.setCursorStyle("")};this.onDragEnter=function(e){if(editor.getReadOnly()||!canAccept(e.dataTransfer))return;x=e.clientX;y=e.clientY;if(!dragSelectionMarker)addDragMarker();counter++;e.dataTransfer.dropEffect=dragOperation=getDropEffect(e);return event.preventDefault(e)};this.onDragOver=function(e){if(editor.getReadOnly()||!canAccept(e.dataTransfer))return;x=e.clientX;y=e.clientY;if(!dragSelectionMarker){addDragMarker();counter++}if(onMouseMoveTimer!==null)onMouseMoveTimer=null;e.dataTransfer.dropEffect=dragOperation=getDropEffect(e);return event.preventDefault(e)};this.onDragLeave=function(e){counter--;if(counter<=0&&dragSelectionMarker){clearDragMarker();dragOperation=null;return event.preventDefault(e)}};this.onDrop=function(e){if(!dragCursor)return;var dataTransfer=e.dataTransfer;if(isInternal){switch(dragOperation){case"move":if(range.contains(dragCursor.row,dragCursor.column)){range={start:dragCursor,end:dragCursor}}else{range=editor.moveText(range,dragCursor)}break;case"copy":range=editor.moveText(range,dragCursor,true);break}}else{var dropData=dataTransfer.getData("Text");range={start:dragCursor,end:editor.session.insert(dragCursor,dropData)};editor.focus();dragOperation=null}clearDragMarker();return event.preventDefault(e)};event.addListener(mouseTarget,"dragstart",this.onDragStart.bind(mouseHandler));event.addListener(mouseTarget,"dragend",this.onDragEnd.bind(mouseHandler));event.addListener(mouseTarget,"dragenter",this.onDragEnter.bind(mouseHandler));event.addListener(mouseTarget,"dragover",this.onDragOver.bind(mouseHandler));event.addListener(mouseTarget,"dragleave",this.onDragLeave.bind(mouseHandler));event.addListener(mouseTarget,"drop",this.onDrop.bind(mouseHandler));function scrollCursorIntoView(cursor,prevCursor){var now=Date.now();var vMovement=!prevCursor||cursor.row!=prevCursor.row;var hMovement=!prevCursor||cursor.column!=prevCursor.column;if(!cursorMovedTime||vMovement||hMovement){editor.$blockScrolling+=1;editor.moveCursorToPosition(cursor);editor.$blockScrolling-=1;cursorMovedTime=now;cursorPointOnCaretMoved={x:x,y:y}}else{var distance=calcDistance(cursorPointOnCaretMoved.x,cursorPointOnCaretMoved.y,x,y);if(distance>SCROLL_CURSOR_HYSTERESIS){cursorMovedTime=null}else if(now-cursorMovedTime>=SCROLL_CURSOR_DELAY){editor.renderer.scrollCursorIntoView();cursorMovedTime=null}}}function autoScroll(cursor,prevCursor){var now=Date.now();var lineHeight=editor.renderer.layerConfig.lineHeight;var characterWidth=editor.renderer.layerConfig.characterWidth;var editorRect=editor.renderer.scroller.getBoundingClientRect();var offsets={x:{left:x-editorRect.left,right:editorRect.right-x},y:{top:y-editorRect.top,bottom:editorRect.bottom-y}};var nearestXOffset=Math.min(offsets.x.left,offsets.x.right);var nearestYOffset=Math.min(offsets.y.top,offsets.y.bottom);var scrollCursor={row:cursor.row,column:cursor.column};if(nearestXOffset/characterWidth<=2){scrollCursor.column+=offsets.x.left<offsets.x.right?-3:+2}if(nearestYOffset/lineHeight<=1){scrollCursor.row+=offsets.y.top<offsets.y.bottom?-1:+1}var vScroll=cursor.row!=scrollCursor.row;var hScroll=cursor.column!=scrollCursor.column;var vMovement=!prevCursor||cursor.row!=prevCursor.row;if(vScroll||hScroll&&!vMovement){if(!autoScrollStartTime)autoScrollStartTime=now;else if(now-autoScrollStartTime>=AUTOSCROLL_DELAY)editor.renderer.scrollCursorIntoView(scrollCursor)}else{autoScrollStartTime=null}}function onDragInterval(){var prevCursor=dragCursor;dragCursor=editor.renderer.screenToTextCoordinates(x,y);scrollCursorIntoView(dragCursor,prevCursor);autoScroll(dragCursor,prevCursor)}function addDragMarker(){range=editor.selection.toOrientedRange();dragSelectionMarker=editor.session.addMarker(range,"ace_selection",editor.getSelectionStyle());editor.clearSelection();if(editor.isFocused())editor.renderer.$cursorLayer.setBlinking(false);clearInterval(timerId);onDragInterval();timerId=setInterval(onDragInterval,20);counter=0;event.addListener(document,"mousemove",onMouseMove)}function clearDragMarker(){clearInterval(timerId);editor.session.removeMarker(dragSelectionMarker);dragSelectionMarker=null;editor.$blockScrolling+=1;editor.selection.fromOrientedRange(range);editor.$blockScrolling-=1;if(editor.isFocused()&&!isInternal)editor.renderer.$cursorLayer.setBlinking(!editor.getReadOnly());range=null;dragCursor=null;counter=0;autoScrollStartTime=null;cursorMovedTime=null;event.removeListener(document,"mousemove",onMouseMove)}var onMouseMoveTimer=null;function onMouseMove(){if(onMouseMoveTimer==null){onMouseMoveTimer=setTimeout((function(){if(onMouseMoveTimer!=null&&dragSelectionMarker)clearDragMarker()}),20)}}function canAccept(dataTransfer){var types=dataTransfer.types;return!types||Array.prototype.some.call(types,(function(type){return type=="text/plain"||type=="Text"}))}function getDropEffect(e){var copyAllowed=["copy","copymove","all","uninitialized"];var moveAllowed=["move","copymove","linkmove","all","uninitialized"];var copyModifierState=useragent.isMac?e.altKey:e.ctrlKey;var effectAllowed="uninitialized";try{effectAllowed=e.dataTransfer.effectAllowed.toLowerCase()}catch(e){}var dropEffect="none";if(copyModifierState&&copyAllowed.indexOf(effectAllowed)>=0)dropEffect="copy";else if(moveAllowed.indexOf(effectAllowed)>=0)dropEffect="move";else if(copyAllowed.indexOf(effectAllowed)>=0)dropEffect="copy";return dropEffect}}(function(){this.dragWait=function(){var interval=Date.now()-this.mousedownEvent.time;if(interval>this.editor.getDragDelay())this.startDrag()};this.dragWaitEnd=function(){var target=this.editor.container;target.draggable=false;this.startSelect(this.mousedownEvent.getDocumentPosition());this.selectEnd()};this.dragReadyEnd=function(e){this.editor.renderer.$cursorLayer.setBlinking(!this.editor.getReadOnly());this.editor.unsetStyle("ace_dragging");this.editor.renderer.setCursorStyle("");this.dragWaitEnd()};this.startDrag=function(){this.cancelDrag=false;var editor=this.editor;var target=editor.container;target.draggable=true;editor.renderer.$cursorLayer.setBlinking(false);editor.setStyle("ace_dragging");var cursorStyle=useragent.isWin?"default":"move";editor.renderer.setCursorStyle(cursorStyle);this.setState("dragReady")};this.onMouseDrag=function(e){var target=this.editor.container;if(useragent.isIE&&this.state=="dragReady"){var distance=calcDistance(this.mousedownEvent.x,this.mousedownEvent.y,this.x,this.y);if(distance>3)target.dragDrop()}if(this.state==="dragWait"){var distance=calcDistance(this.mousedownEvent.x,this.mousedownEvent.y,this.x,this.y);if(distance>0){target.draggable=false;this.startSelect(this.mousedownEvent.getDocumentPosition())}}};this.onMouseDown=function(e){if(!this.$dragEnabled)return;this.mousedownEvent=e;var editor=this.editor;var inSelection=e.inSelection();var button=e.getButton();var clickCount=e.domEvent.detail||1;if(clickCount===1&&button===0&&inSelection){if(e.editor.inMultiSelectMode&&(e.getAccelKey()||e.getShiftKey()))return;this.mousedownEvent.time=Date.now();var eventTarget=e.domEvent.target||e.domEvent.srcElement;if("unselectable"in eventTarget)eventTarget.unselectable="on";if(editor.getDragDelay()){if(useragent.isWebKit){this.cancelDrag=true;var mouseTarget=editor.container;mouseTarget.draggable=true}this.setState("dragWait")}else{this.startDrag()}this.captureMouse(e,this.onMouseDrag.bind(this));e.defaultPrevented=true}}}).call(DragdropHandler.prototype);function calcDistance(ax,ay,bx,by){return Math.sqrt(Math.pow(bx-ax,2)+Math.pow(by-ay,2))}exports.DragdropHandler=DragdropHandler}));ace.define("ace/lib/net",["require","exports","module","ace/lib/dom"],(function(acequire,exports,module){"use strict";var dom=acequire("./dom");exports.get=function(url,callback){var xhr=new XMLHttpRequest;xhr.open("GET",url,true);xhr.onreadystatechange=function(){if(xhr.readyState===4){callback(xhr.responseText)}};xhr.send(null)};exports.loadScript=function(path,callback){var head=dom.getDocumentHead();var s=document.createElement("script");s.src=path;head.appendChild(s);s.onload=s.onreadystatechange=function(_,isAbort){if(isAbort||!s.readyState||s.readyState=="loaded"||s.readyState=="complete"){s=s.onload=s.onreadystatechange=null;if(!isAbort)callback()}}};exports.qualifyURL=function(url){var a=document.createElement("a");a.href=url;return a.href}}));ace.define("ace/lib/event_emitter",["require","exports","module"],(function(acequire,exports,module){"use strict";var EventEmitter={};var stopPropagation=function(){this.propagationStopped=true};var preventDefault=function(){this.defaultPrevented=true};EventEmitter._emit=EventEmitter._dispatchEvent=function(eventName,e){this._eventRegistry||(this._eventRegistry={});this._defaultHandlers||(this._defaultHandlers={});var listeners=this._eventRegistry[eventName]||[];var defaultHandler=this._defaultHandlers[eventName];if(!listeners.length&&!defaultHandler)return;if(typeof e!="object"||!e)e={};if(!e.type)e.type=eventName;if(!e.stopPropagation)e.stopPropagation=stopPropagation;if(!e.preventDefault)e.preventDefault=preventDefault;listeners=listeners.slice();for(var i=0;i<listeners.length;i++){listeners[i](e,this);if(e.propagationStopped)break}if(defaultHandler&&!e.defaultPrevented)return defaultHandler(e,this)};EventEmitter._signal=function(eventName,e){var listeners=(this._eventRegistry||{})[eventName];if(!listeners)return;listeners=listeners.slice();for(var i=0;i<listeners.length;i++)listeners[i](e,this)};EventEmitter.once=function(eventName,callback){var _self=this;callback&&this.addEventListener(eventName,(function newCallback(){_self.removeEventListener(eventName,newCallback);callback.apply(null,arguments)}))};EventEmitter.setDefaultHandler=function(eventName,callback){var handlers=this._defaultHandlers;if(!handlers)handlers=this._defaultHandlers={_disabled_:{}};if(handlers[eventName]){var old=handlers[eventName];var disabled=handlers._disabled_[eventName];if(!disabled)handlers._disabled_[eventName]=disabled=[];disabled.push(old);var i=disabled.indexOf(callback);if(i!=-1)disabled.splice(i,1)}handlers[eventName]=callback};EventEmitter.removeDefaultHandler=function(eventName,callback){var handlers=this._defaultHandlers;if(!handlers)return;var disabled=handlers._disabled_[eventName];if(handlers[eventName]==callback){var old=handlers[eventName];if(disabled)this.setDefaultHandler(eventName,disabled.pop())}else if(disabled){var i=disabled.indexOf(callback);if(i!=-1)disabled.splice(i,1)}};EventEmitter.on=EventEmitter.addEventListener=function(eventName,callback,capturing){this._eventRegistry=this._eventRegistry||{};var listeners=this._eventRegistry[eventName];if(!listeners)listeners=this._eventRegistry[eventName]=[];if(listeners.indexOf(callback)==-1)listeners[capturing?"unshift":"push"](callback);return callback};EventEmitter.off=EventEmitter.removeListener=EventEmitter.removeEventListener=function(eventName,callback){this._eventRegistry=this._eventRegistry||{};var listeners=this._eventRegistry[eventName];if(!listeners)return;var index=listeners.indexOf(callback);if(index!==-1)listeners.splice(index,1)};EventEmitter.removeAllListeners=function(eventName){if(this._eventRegistry)this._eventRegistry[eventName]=[]};exports.EventEmitter=EventEmitter}));ace.define("ace/lib/app_config",["require","exports","module","ace/lib/oop","ace/lib/event_emitter"],(function(acequire,exports,module){"no use strict";var oop=acequire("./oop");var EventEmitter=acequire("./event_emitter").EventEmitter;var optionsProvider={setOptions:function(optList){Object.keys(optList).forEach((function(key){this.setOption(key,optList[key])}),this)},getOptions:function(optionNames){var result={};if(!optionNames){optionNames=Object.keys(this.$options)}else if(!Array.isArray(optionNames)){result=optionNames;optionNames=Object.keys(result)}optionNames.forEach((function(key){result[key]=this.getOption(key)}),this);return result},setOption:function(name,value){if(this["$"+name]===value)return;var opt=this.$options[name];if(!opt){return warn('misspelled option "'+name+'"')}if(opt.forwardTo)return this[opt.forwardTo]&&this[opt.forwardTo].setOption(name,value);if(!opt.handlesSet)this["$"+name]=value;if(opt&&opt.set)opt.set.call(this,value)},getOption:function(name){var opt=this.$options[name];if(!opt){return warn('misspelled option "'+name+'"')}if(opt.forwardTo)return this[opt.forwardTo]&&this[opt.forwardTo].getOption(name);return opt&&opt.get?opt.get.call(this):this["$"+name]}};function warn(message){if(typeof console!="undefined"&&console.warn)console.warn.apply(console,arguments)}function reportError(msg,data){var e=new Error(msg);e.data=data;if(typeof console=="object"&&console.error)console.error(e);setTimeout((function(){throw e}))}var AppConfig=function(){this.$defaultOptions={}};(function(){oop.implement(this,EventEmitter);this.defineOptions=function(obj,path,options){if(!obj.$options)this.$defaultOptions[path]=obj.$options={};Object.keys(options).forEach((function(key){var opt=options[key];if(typeof opt=="string")opt={forwardTo:opt};opt.name||(opt.name=key);obj.$options[opt.name]=opt;if("initialValue"in opt)obj["$"+opt.name]=opt.initialValue}));oop.implement(obj,optionsProvider);return this};this.resetOptions=function(obj){Object.keys(obj.$options).forEach((function(key){var opt=obj.$options[key];if("value"in opt)obj.setOption(key,opt.value)}))};this.setDefaultValue=function(path,name,value){var opts=this.$defaultOptions[path]||(this.$defaultOptions[path]={});if(opts[name]){if(opts.forwardTo)this.setDefaultValue(opts.forwardTo,name,value);else opts[name].value=value}};this.setDefaultValues=function(path,optionHash){Object.keys(optionHash).forEach((function(key){this.setDefaultValue(path,key,optionHash[key])}),this)};this.warn=warn;this.reportError=reportError}).call(AppConfig.prototype);exports.AppConfig=AppConfig}));ace.define("ace/config",["require","exports","module","ace/lib/lang","ace/lib/oop","ace/lib/net","ace/lib/app_config"],(function(acequire,exports,module){"no use strict";var lang=acequire("./lib/lang");var oop=acequire("./lib/oop");var net=acequire("./lib/net");var AppConfig=acequire("./lib/app_config").AppConfig;module.exports=exports=new AppConfig;var global=function(){return this||typeof window!="undefined"&&window}();var options={packaged:false,workerPath:null,modePath:null,themePath:null,basePath:"",suffix:".js",$moduleUrls:{}};exports.get=function(key){if(!options.hasOwnProperty(key))throw new Error("Unknown config key: "+key);return options[key]};exports.set=function(key,value){if(!options.hasOwnProperty(key))throw new Error("Unknown config key: "+key);options[key]=value};exports.all=function(){return lang.copyObject(options)};exports.moduleUrl=function(name,component){if(options.$moduleUrls[name])return options.$moduleUrls[name];var parts=name.split("/");component=component||parts[parts.length-2]||"";var sep=component=="snippets"?"/":"-";var base=parts[parts.length-1];if(component=="worker"&&sep=="-"){var re=new RegExp("^"+component+"[\\-_]|[\\-_]"+component+"$","g");base=base.replace(re,"")}if((!base||base==component)&&parts.length>1)base=parts[parts.length-2];var path=options[component+"Path"];if(path==null){path=options.basePath}else if(sep=="/"){component=sep=""}if(path&&path.slice(-1)!="/")path+="/";return path+component+sep+base+this.get("suffix")};exports.setModuleUrl=function(name,subst){return options.$moduleUrls[name]=subst};exports.$loading={};exports.loadModule=function(moduleName,onLoad){var module,moduleType;if(Array.isArray(moduleName)){moduleType=moduleName[0];moduleName=moduleName[1]}try{module=acequire(moduleName)}catch(e){}if(module&&!exports.$loading[moduleName])return onLoad&&onLoad(module);if(!exports.$loading[moduleName])exports.$loading[moduleName]=[];exports.$loading[moduleName].push(onLoad);if(exports.$loading[moduleName].length>1)return;var afterLoad=function(){acequire([moduleName],(function(module){exports._emit("load.module",{name:moduleName,module:module});var listeners=exports.$loading[moduleName];exports.$loading[moduleName]=null;listeners.forEach((function(onLoad){onLoad&&onLoad(module)}))}))};if(!exports.get("packaged"))return afterLoad();net.loadScript(exports.moduleUrl(moduleName,moduleType),afterLoad)};init(true);function init(packaged){if(!global||!global.document)return;options.packaged=packaged||acequire.packaged||module.packaged||global.define&&__webpack_require__(293).packaged;var scriptOptions={};var scriptUrl="";var currentScript=document.currentScript||document._currentScript;var currentDocument=currentScript&&currentScript.ownerDocument||document;var scripts=currentDocument.getElementsByTagName("script");for(var i=0;i<scripts.length;i++){var script=scripts[i];var src=script.src||script.getAttribute("src");if(!src)continue;var attributes=script.attributes;for(var j=0,l=attributes.length;j<l;j++){var attr=attributes[j];if(attr.name.indexOf("data-ace-")===0){scriptOptions[deHyphenate(attr.name.replace(/^data-ace-/,""))]=attr.value}}var m=src.match(/^(.*)\/ace(\-\w+)?\.js(\?|$)/);if(m)scriptUrl=m[1]}if(scriptUrl){scriptOptions.base=scriptOptions.base||scriptUrl;scriptOptions.packaged=true}scriptOptions.basePath=scriptOptions.base;scriptOptions.workerPath=scriptOptions.workerPath||scriptOptions.base;scriptOptions.modePath=scriptOptions.modePath||scriptOptions.base;scriptOptions.themePath=scriptOptions.themePath||scriptOptions.base;delete scriptOptions.base;for(var key in scriptOptions)if(typeof scriptOptions[key]!=="undefined")exports.set(key,scriptOptions[key])}exports.init=init;function deHyphenate(str){return str.replace(/-(.)/g,(function(m,m1){return m1.toUpperCase()}))}}));ace.define("ace/mouse/mouse_handler",["require","exports","module","ace/lib/event","ace/lib/useragent","ace/mouse/default_handlers","ace/mouse/default_gutter_handler","ace/mouse/mouse_event","ace/mouse/dragdrop_handler","ace/config"],(function(acequire,exports,module){"use strict";var event=acequire("../lib/event");var useragent=acequire("../lib/useragent");var DefaultHandlers=acequire("./default_handlers").DefaultHandlers;var DefaultGutterHandler=acequire("./default_gutter_handler").GutterHandler;var MouseEvent=acequire("./mouse_event").MouseEvent;var DragdropHandler=acequire("./dragdrop_handler").DragdropHandler;var config=acequire("../config");var MouseHandler=function(editor){var _self=this;this.editor=editor;new DefaultHandlers(this);new DefaultGutterHandler(this);new DragdropHandler(this);var focusEditor=function(e){var windowBlurred=!document.hasFocus||!document.hasFocus()||!editor.isFocused()&&document.activeElement==(editor.textInput&&editor.textInput.getElement());if(windowBlurred)window.focus();editor.focus()};var mouseTarget=editor.renderer.getMouseEventTarget();event.addListener(mouseTarget,"click",this.onMouseEvent.bind(this,"click"));event.addListener(mouseTarget,"mousemove",this.onMouseMove.bind(this,"mousemove"));event.addMultiMouseDownListener([mouseTarget,editor.renderer.scrollBarV&&editor.renderer.scrollBarV.inner,editor.renderer.scrollBarH&&editor.renderer.scrollBarH.inner,editor.textInput&&editor.textInput.getElement()].filter(Boolean),[400,300,250],this,"onMouseEvent");event.addMouseWheelListener(editor.container,this.onMouseWheel.bind(this,"mousewheel"));event.addTouchMoveListener(editor.container,this.onTouchMove.bind(this,"touchmove"));var gutterEl=editor.renderer.$gutter;event.addListener(gutterEl,"mousedown",this.onMouseEvent.bind(this,"guttermousedown"));event.addListener(gutterEl,"click",this.onMouseEvent.bind(this,"gutterclick"));event.addListener(gutterEl,"dblclick",this.onMouseEvent.bind(this,"gutterdblclick"));event.addListener(gutterEl,"mousemove",this.onMouseEvent.bind(this,"guttermousemove"));event.addListener(mouseTarget,"mousedown",focusEditor);event.addListener(gutterEl,"mousedown",focusEditor);if(useragent.isIE&&editor.renderer.scrollBarV){event.addListener(editor.renderer.scrollBarV.element,"mousedown",focusEditor);event.addListener(editor.renderer.scrollBarH.element,"mousedown",focusEditor)}editor.on("mousemove",(function(e){if(_self.state||_self.$dragDelay||!_self.$dragEnabled)return;var character=editor.renderer.screenToTextCoordinates(e.x,e.y);var range=editor.session.selection.getRange();var renderer=editor.renderer;if(!range.isEmpty()&&range.insideStart(character.row,character.column)){renderer.setCursorStyle("default")}else{renderer.setCursorStyle("")}}))};(function(){this.onMouseEvent=function(name,e){this.editor._emit(name,new MouseEvent(e,this.editor))};this.onMouseMove=function(name,e){var listeners=this.editor._eventRegistry&&this.editor._eventRegistry.mousemove;if(!listeners||!listeners.length)return;this.editor._emit(name,new MouseEvent(e,this.editor))};this.onMouseWheel=function(name,e){var mouseEvent=new MouseEvent(e,this.editor);mouseEvent.speed=this.$scrollSpeed*2;mouseEvent.wheelX=e.wheelX;mouseEvent.wheelY=e.wheelY;this.editor._emit(name,mouseEvent)};this.onTouchMove=function(name,e){var mouseEvent=new MouseEvent(e,this.editor);mouseEvent.speed=1;mouseEvent.wheelX=e.wheelX;mouseEvent.wheelY=e.wheelY;this.editor._emit(name,mouseEvent)};this.setState=function(state){this.state=state};this.captureMouse=function(ev,mouseMoveHandler){this.x=ev.x;this.y=ev.y;this.isMousePressed=true;var renderer=this.editor.renderer;if(renderer.$keepTextAreaAtCursor)renderer.$keepTextAreaAtCursor=null;var self=this;var onMouseMove=function(e){if(!e)return;if(useragent.isWebKit&&!e.which&&self.releaseMouse)return self.releaseMouse();self.x=e.clientX;self.y=e.clientY;mouseMoveHandler&&mouseMoveHandler(e);self.mouseEvent=new MouseEvent(e,self.editor);self.$mouseMoved=true};var onCaptureEnd=function(e){clearInterval(timerId);onCaptureInterval();self[self.state+"End"]&&self[self.state+"End"](e);self.state="";if(renderer.$keepTextAreaAtCursor==null){renderer.$keepTextAreaAtCursor=true;renderer.$moveTextAreaToCursor()}self.isMousePressed=false;self.$onCaptureMouseMove=self.releaseMouse=null;e&&self.onMouseEvent("mouseup",e)};var onCaptureInterval=function(){self[self.state]&&self[self.state]();self.$mouseMoved=false};if(useragent.isOldIE&&ev.domEvent.type=="dblclick"){return setTimeout((function(){onCaptureEnd(ev)}))}self.$onCaptureMouseMove=onMouseMove;self.releaseMouse=event.capture(this.editor.container,onMouseMove,onCaptureEnd);var timerId=setInterval(onCaptureInterval,20)};this.releaseMouse=null;this.cancelContextMenu=function(){var stop=function(e){if(e&&e.domEvent&&e.domEvent.type!="contextmenu")return;this.editor.off("nativecontextmenu",stop);if(e&&e.domEvent)event.stopEvent(e.domEvent)}.bind(this);setTimeout(stop,10);this.editor.on("nativecontextmenu",stop)}}).call(MouseHandler.prototype);config.defineOptions(MouseHandler.prototype,"mouseHandler",{scrollSpeed:{initialValue:2},dragDelay:{initialValue:useragent.isMac?150:0},dragEnabled:{initialValue:true},focusTimout:{initialValue:0},tooltipFollowsMouse:{initialValue:true}});exports.MouseHandler=MouseHandler}));ace.define("ace/mouse/fold_handler",["require","exports","module"],(function(acequire,exports,module){"use strict";function FoldHandler(editor){editor.on("click",(function(e){var position=e.getDocumentPosition();var session=editor.session;var fold=session.getFoldAt(position.row,position.column,1);if(fold){if(e.getAccelKey())session.removeFold(fold);else session.expandFold(fold);e.stop()}}));editor.on("gutterclick",(function(e){var gutterRegion=editor.renderer.$gutterLayer.getRegion(e);if(gutterRegion=="foldWidgets"){var row=e.getDocumentPosition().row;var session=editor.session;if(session.foldWidgets&&session.foldWidgets[row])editor.session.onFoldWidgetClick(row,e);if(!editor.isFocused())editor.focus();e.stop()}}));editor.on("gutterdblclick",(function(e){var gutterRegion=editor.renderer.$gutterLayer.getRegion(e);if(gutterRegion=="foldWidgets"){var row=e.getDocumentPosition().row;var session=editor.session;var data=session.getParentFoldRangeData(row,true);var range=data.range||data.firstRange;if(range){row=range.start.row;var fold=session.getFoldAt(row,session.getLine(row).length,1);if(fold){session.removeFold(fold)}else{session.addFold("...",range);editor.renderer.scrollCursorIntoView({row:range.start.row,column:0})}}e.stop()}}))}exports.FoldHandler=FoldHandler}));ace.define("ace/keyboard/keybinding",["require","exports","module","ace/lib/keys","ace/lib/event"],(function(acequire,exports,module){"use strict";var keyUtil=acequire("../lib/keys");var event=acequire("../lib/event");var KeyBinding=function(editor){this.$editor=editor;this.$data={editor:editor};this.$handlers=[];this.setDefaultHandler(editor.commands)};(function(){this.setDefaultHandler=function(kb){this.removeKeyboardHandler(this.$defaultHandler);this.$defaultHandler=kb;this.addKeyboardHandler(kb,0)};this.setKeyboardHandler=function(kb){var h=this.$handlers;if(h[h.length-1]==kb)return;while(h[h.length-1]&&h[h.length-1]!=this.$defaultHandler)this.removeKeyboardHandler(h[h.length-1]);this.addKeyboardHandler(kb,1)};this.addKeyboardHandler=function(kb,pos){if(!kb)return;if(typeof kb=="function"&&!kb.handleKeyboard)kb.handleKeyboard=kb;var i=this.$handlers.indexOf(kb);if(i!=-1)this.$handlers.splice(i,1);if(pos==undefined)this.$handlers.push(kb);else this.$handlers.splice(pos,0,kb);if(i==-1&&kb.attach)kb.attach(this.$editor)};this.removeKeyboardHandler=function(kb){var i=this.$handlers.indexOf(kb);if(i==-1)return false;this.$handlers.splice(i,1);kb.detach&&kb.detach(this.$editor);return true};this.getKeyboardHandler=function(){return this.$handlers[this.$handlers.length-1]};this.getStatusText=function(){var data=this.$data;var editor=data.editor;return this.$handlers.map((function(h){return h.getStatusText&&h.getStatusText(editor,data)||""})).filter(Boolean).join(" ")};this.$callKeyboardHandlers=function(hashId,keyString,keyCode,e){var toExecute;var success=false;var commands=this.$editor.commands;for(var i=this.$handlers.length;i--;){toExecute=this.$handlers[i].handleKeyboard(this.$data,hashId,keyString,keyCode,e);if(!toExecute||!toExecute.command)continue;if(toExecute.command=="null"){success=true}else{success=commands.exec(toExecute.command,this.$editor,toExecute.args,e)}if(success&&e&&hashId!=-1&&toExecute.passEvent!=true&&toExecute.command.passEvent!=true){event.stopEvent(e)}if(success)break}if(!success&&hashId==-1){toExecute={command:"insertstring"};success=commands.exec("insertstring",this.$editor,keyString)}if(success&&this.$editor._signal)this.$editor._signal("keyboardActivity",toExecute);return success};this.onCommandKey=function(e,hashId,keyCode){var keyString=keyUtil.keyCodeToString(keyCode);this.$callKeyboardHandlers(hashId,keyString,keyCode,e)};this.onTextInput=function(text){this.$callKeyboardHandlers(-1,text)}}).call(KeyBinding.prototype);exports.KeyBinding=KeyBinding}));ace.define("ace/lib/bidiutil",["require","exports","module"],(function(acequire,exports,module){"use strict";var ArabicAlefBetIntervalsBegine=["ء","ف"];var ArabicAlefBetIntervalsEnd=["غ","ي"];var dir=0,hiLevel=0;var lastArabic=false,hasUBAT_AL=false,hasUBAT_B=false,hasUBAT_S=false,hasBlockSep=false,hasSegSep=false;var impTab_LTR=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]];var impTab_RTL=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]];var LTR=0,RTL=1;var L=0;var R=1;var EN=2;var AN=3;var ON=4;var B=5;var S=6;var AL=7;var WS=8;var CS=9;var ES=10;var ET=11;var NSM=12;var LRE=13;var RLE=14;var PDF=15;var LRO=16;var RLO=17;var BN=18;var UnicodeTBL00=[BN,BN,BN,BN,BN,BN,BN,BN,BN,S,B,S,WS,B,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,B,B,B,S,WS,ON,ON,ET,ET,ET,ON,ON,ON,ON,ON,ES,CS,ES,CS,CS,EN,EN,EN,EN,EN,EN,EN,EN,EN,EN,CS,ON,ON,ON,ON,ON,ON,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,ON,ON,ON,ON,ON,ON,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,L,ON,ON,ON,ON,BN,BN,BN,BN,BN,BN,B,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,BN,CS,ON,ET,ET,ET,ET,ON,ON,ON,ON,L,ON,ON,BN,ON,ON,ET,ET,EN,EN,ON,L,ON,ON,ON,EN,L,ON,ON,ON,ON,ON];var UnicodeTBL20=[WS,WS,WS,WS,WS,WS,WS,WS,WS,WS,WS,BN,BN,BN,L,R,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,WS,B,LRE,RLE,PDF,LRO,RLO,CS,ET,ET,ET,ET,ET,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,CS,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,ON,WS];function _computeLevels(chars,levels,len,charTypes){var impTab=dir?impTab_RTL:impTab_LTR,prevState=null,newClass=null,newLevel=null,newState=0,action=null,cond=null,condPos=-1,i=null,ix=null,classes=[];if(!charTypes){for(i=0,charTypes=[];i<len;i++){charTypes[i]=_getCharacterType(chars[i])}}hiLevel=dir;lastArabic=false;hasUBAT_AL=false;hasUBAT_B=false;hasUBAT_S=false;for(ix=0;ix<len;ix++){prevState=newState;classes[ix]=newClass=_getCharClass(chars,charTypes,classes,ix);newState=impTab[prevState][newClass];action=newState&240;newState&=15;levels[ix]=newLevel=impTab[newState][5];if(action>0){if(action==16){for(i=condPos;i<ix;i++){levels[i]=1}condPos=-1}else{condPos=-1}}cond=impTab[newState][6];if(cond){if(condPos==-1){condPos=ix}}else{if(condPos>-1){for(i=condPos;i<ix;i++){levels[i]=newLevel}condPos=-1}}if(charTypes[ix]==B){levels[ix]=0}hiLevel|=newLevel}if(hasUBAT_S){for(i=0;i<len;i++){if(charTypes[i]==S){levels[i]=dir;for(var j=i-1;j>=0;j--){if(charTypes[j]==WS){levels[j]=dir}else{break}}}}}}function _invertLevel(lev,levels,_array){if(hiLevel<lev){return}if(lev==1&&dir==RTL&&!hasUBAT_B){_array.reverse();return}var len=_array.length,start=0,end,lo,hi,tmp;while(start<len){if(levels[start]>=lev){end=start+1;while(end<len&&levels[end]>=lev){end++}for(lo=start,hi=end-1;lo<hi;lo++,hi--){tmp=_array[lo];_array[lo]=_array[hi];_array[hi]=tmp}start=end}start++}}function _getCharClass(chars,types,classes,ix){var cType=types[ix],wType,nType,len,i;switch(cType){case L:case R:lastArabic=false;case ON:case AN:return cType;case EN:return lastArabic?AN:EN;case AL:lastArabic=true;hasUBAT_AL=true;return R;case WS:return ON;case CS:if(ix<1||ix+1>=types.length||(wType=classes[ix-1])!=EN&&wType!=AN||(nType=types[ix+1])!=EN&&nType!=AN){return ON}if(lastArabic){nType=AN}return nType==wType?nType:ON;case ES:wType=ix>0?classes[ix-1]:B;if(wType==EN&&ix+1<types.length&&types[ix+1]==EN){return EN}return ON;case ET:if(ix>0&&classes[ix-1]==EN){return EN}if(lastArabic){return ON}i=ix+1;len=types.length;while(i<len&&types[i]==ET){i++}if(i<len&&types[i]==EN){return EN}return ON;case NSM:len=types.length;i=ix+1;while(i<len&&types[i]==NSM){i++}if(i<len){var c=chars[ix],rtlCandidate=c>=1425&&c<=2303||c==64286;wType=types[i];if(rtlCandidate&&(wType==R||wType==AL)){return R}}if(ix<1||(wType=types[ix-1])==B){return ON}return classes[ix-1];case B:lastArabic=false;hasUBAT_B=true;return dir;case S:hasUBAT_S=true;return ON;case LRE:case RLE:case LRO:case RLO:case PDF:lastArabic=false;case BN:return ON}}function _getCharacterType(ch){var uc=ch.charCodeAt(0),hi=uc>>8;if(hi==0){return uc>191?L:UnicodeTBL00[uc]}else if(hi==5){return/[\u0591-\u05f4]/.test(ch)?R:L}else if(hi==6){if(/[\u0610-\u061a\u064b-\u065f\u06d6-\u06e4\u06e7-\u06ed]/.test(ch))return NSM;else if(/[\u0660-\u0669\u066b-\u066c]/.test(ch))return AN;else if(uc==1642)return ET;else if(/[\u06f0-\u06f9]/.test(ch))return EN;else return AL}else if(hi==32&&uc<=8287){return UnicodeTBL20[uc&255]}else if(hi==254){return uc>=65136?AL:ON}return ON}function _isArabicDiacritics(ch){return ch>="ً"&&ch<="ٕ"}exports.L=L;exports.R=R;exports.EN=EN;exports.ON_R=3;exports.AN=4;exports.R_H=5;exports.B=6;exports.DOT="·";exports.doBidiReorder=function(text,textCharTypes,isRtl){if(text.length<2)return{};var chars=text.split(""),logicalFromVisual=new Array(chars.length),bidiLevels=new Array(chars.length),levels=[];dir=isRtl?RTL:LTR;_computeLevels(chars,levels,chars.length,textCharTypes);for(var i=0;i<logicalFromVisual.length;logicalFromVisual[i]=i,i++);_invertLevel(2,levels,logicalFromVisual);_invertLevel(1,levels,logicalFromVisual);for(var i=0;i<logicalFromVisual.length-1;i++){if(textCharTypes[i]===AN){levels[i]=exports.AN}else if(levels[i]===R&&(textCharTypes[i]>AL&&textCharTypes[i]<LRE||textCharTypes[i]===ON||textCharTypes[i]===BN)){levels[i]=exports.ON_R}else if(i>0&&chars[i-1]==="ل"&&/\u0622|\u0623|\u0625|\u0627/.test(chars[i])){levels[i-1]=levels[i]=exports.R_H;i++}}if(chars[chars.length-1]===exports.DOT)levels[chars.length-1]=exports.B;for(var i=0;i<logicalFromVisual.length;i++){bidiLevels[i]=levels[logicalFromVisual[i]]}return{logicalFromVisual:logicalFromVisual,bidiLevels:bidiLevels}};exports.hasBidiCharacters=function(text,textCharTypes){var ret=false;for(var i=0;i<text.length;i++){textCharTypes[i]=_getCharacterType(text.charAt(i));if(!ret&&(textCharTypes[i]==R||textCharTypes[i]==AL))ret=true}return ret};exports.getVisualFromLogicalIdx=function(logIdx,rowMap){for(var i=0;i<rowMap.logicalFromVisual.length;i++){if(rowMap.logicalFromVisual[i]==logIdx)return i}return 0}}));ace.define("ace/bidihandler",["require","exports","module","ace/lib/bidiutil","ace/lib/lang","ace/lib/useragent"],(function(acequire,exports,module){"use strict";var bidiUtil=acequire("./lib/bidiutil");var lang=acequire("./lib/lang");var useragent=acequire("./lib/useragent");var bidiRE=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;var BidiHandler=function(session){this.session=session;this.bidiMap={};this.currentRow=null;this.bidiUtil=bidiUtil;this.charWidths=[];this.EOL="¬";this.showInvisibles=true;this.isRtlDir=false;this.line="";this.wrapIndent=0;this.isLastRow=false;this.EOF="¶";this.seenBidi=false};(function(){this.isBidiRow=function(screenRow,docRow,splitIndex){if(!this.seenBidi)return false;if(screenRow!==this.currentRow){this.currentRow=screenRow;this.updateRowLine(docRow,splitIndex);this.updateBidiMap()}return this.bidiMap.bidiLevels};this.onChange=function(delta){if(!this.seenBidi){if(delta.action=="insert"&&bidiRE.test(delta.lines.join("\n"))){this.seenBidi=true;this.currentRow=null}}else{this.currentRow=null}};this.getDocumentRow=function(){var docRow=0;var rowCache=this.session.$screenRowCache;if(rowCache.length){var index=this.session.$getRowCacheIndex(rowCache,this.currentRow);if(index>=0)docRow=this.session.$docRowCache[index]}return docRow};this.getSplitIndex=function(){var splitIndex=0;var rowCache=this.session.$screenRowCache;if(rowCache.length){var currentIndex,prevIndex=this.session.$getRowCacheIndex(rowCache,this.currentRow);while(this.currentRow-splitIndex>0){currentIndex=this.session.$getRowCacheIndex(rowCache,this.currentRow-splitIndex-1);if(currentIndex!==prevIndex)break;prevIndex=currentIndex;splitIndex++}}return splitIndex};this.updateRowLine=function(docRow,splitIndex){if(docRow===undefined)docRow=this.getDocumentRow();this.wrapIndent=0;this.isLastRow=docRow===this.session.getLength()-1;this.line=this.session.getLine(docRow);if(this.session.$useWrapMode){var splits=this.session.$wrapData[docRow];if(splits){if(splitIndex===undefined)splitIndex=this.getSplitIndex();if(splitIndex>0&&splits.length){this.wrapIndent=splits.indent;this.line=splitIndex<splits.length?this.line.substring(splits[splitIndex-1],splits[splits.length-1]):this.line.substring(splits[splits.length-1])}else{this.line=this.line.substring(0,splits[splitIndex])}}}var session=this.session,shift=0,size;this.line=this.line.replace(/\t|[\u1100-\u2029, \u202F-\uFFE6]/g,(function(ch,i){if(ch==="\t"||session.isFullWidth(ch.charCodeAt(0))){size=ch==="\t"?session.getScreenTabSize(i+shift):2;shift+=size-1;return lang.stringRepeat(bidiUtil.DOT,size)}return ch}))};this.updateBidiMap=function(){var textCharTypes=[],endOfLine=this.isLastRow?this.EOF:this.EOL;var line=this.line+(this.showInvisibles?endOfLine:bidiUtil.DOT);if(bidiUtil.hasBidiCharacters(line,textCharTypes)){this.bidiMap=bidiUtil.doBidiReorder(line,textCharTypes,this.isRtlDir)}else{this.bidiMap={}}};this.markAsDirty=function(){this.currentRow=null};this.updateCharacterWidths=function(fontMetrics){if(!this.seenBidi)return;if(this.characterWidth===fontMetrics.$characterSize.width)return;var characterWidth=this.characterWidth=fontMetrics.$characterSize.width;var bidiCharWidth=fontMetrics.$measureCharWidth("ה");this.charWidths[bidiUtil.L]=this.charWidths[bidiUtil.EN]=this.charWidths[bidiUtil.ON_R]=characterWidth;this.charWidths[bidiUtil.R]=this.charWidths[bidiUtil.AN]=bidiCharWidth;this.charWidths[bidiUtil.R_H]=useragent.isChrome?bidiCharWidth:bidiCharWidth*.45;this.charWidths[bidiUtil.B]=0;this.currentRow=null};this.getShowInvisibles=function(){return this.showInvisibles};this.setShowInvisibles=function(showInvisibles){this.showInvisibles=showInvisibles;this.currentRow=null};this.setEolChar=function(eolChar){this.EOL=eolChar};this.setTextDir=function(isRtlDir){this.isRtlDir=isRtlDir};this.getPosLeft=function(col){col-=this.wrapIndent;var visualIdx=bidiUtil.getVisualFromLogicalIdx(col>0?col-1:0,this.bidiMap),levels=this.bidiMap.bidiLevels,left=0;if(col===0&&levels[visualIdx]%2!==0)visualIdx++;for(var i=0;i<visualIdx;i++){left+=this.charWidths[levels[i]]}if(col!==0&&levels[visualIdx]%2===0)left+=this.charWidths[levels[visualIdx]];if(this.wrapIndent)left+=this.wrapIndent*this.charWidths[bidiUtil.L];return left};this.getSelections=function(startCol,endCol){var map=this.bidiMap,levels=map.bidiLevels,level,offset=this.wrapIndent*this.charWidths[bidiUtil.L],selections=[],selColMin=Math.min(startCol,endCol)-this.wrapIndent,selColMax=Math.max(startCol,endCol)-this.wrapIndent,isSelected=false,isSelectedPrev=false,selectionStart=0;for(var logIdx,visIdx=0;visIdx<levels.length;visIdx++){logIdx=map.logicalFromVisual[visIdx];level=levels[visIdx];isSelected=logIdx>=selColMin&&logIdx<selColMax;if(isSelected&&!isSelectedPrev){selectionStart=offset}else if(!isSelected&&isSelectedPrev){selections.push({left:selectionStart,width:offset-selectionStart})}offset+=this.charWidths[level];isSelectedPrev=isSelected}if(isSelected&&visIdx===levels.length){selections.push({left:selectionStart,width:offset-selectionStart})}return selections};this.offsetToCol=function(posX){var logicalIdx=0,posX=Math.max(posX,0),offset=0,visualIdx=0,levels=this.bidiMap.bidiLevels,charWidth=this.charWidths[levels[visualIdx]];if(this.wrapIndent){posX-=this.wrapIndent*this.charWidths[bidiUtil.L]}while(posX>offset+charWidth/2){offset+=charWidth;if(visualIdx===levels.length-1){charWidth=0;break}charWidth=this.charWidths[levels[++visualIdx]]}if(visualIdx>0&&levels[visualIdx-1]%2!==0&&levels[visualIdx]%2===0){if(posX<offset)visualIdx--;logicalIdx=this.bidiMap.logicalFromVisual[visualIdx]}else if(visualIdx>0&&levels[visualIdx-1]%2===0&&levels[visualIdx]%2!==0){logicalIdx=1+(posX>offset?this.bidiMap.logicalFromVisual[visualIdx]:this.bidiMap.logicalFromVisual[visualIdx-1])}else if(this.isRtlDir&&visualIdx===levels.length-1&&charWidth===0&&levels[visualIdx-1]%2===0||!this.isRtlDir&&visualIdx===0&&levels[visualIdx]%2!==0){logicalIdx=1+this.bidiMap.logicalFromVisual[visualIdx]}else{if(visualIdx>0&&levels[visualIdx-1]%2!==0&&charWidth!==0)visualIdx--;logicalIdx=this.bidiMap.logicalFromVisual[visualIdx]}return logicalIdx+this.wrapIndent}}).call(BidiHandler.prototype);exports.BidiHandler=BidiHandler}));ace.define("ace/range",["require","exports","module"],(function(acequire,exports,module){"use strict";var comparePoints=function(p1,p2){return p1.row-p2.row||p1.column-p2.column};var Range=function(startRow,startColumn,endRow,endColumn){this.start={row:startRow,column:startColumn};this.end={row:endRow,column:endColumn}};(function(){this.isEqual=function(range){return this.start.row===range.start.row&&this.end.row===range.end.row&&this.start.column===range.start.column&&this.end.column===range.end.column};this.toString=function(){return"Range: ["+this.start.row+"/"+this.start.column+"] -> ["+this.end.row+"/"+this.end.column+"]"};this.contains=function(row,column){return this.compare(row,column)==0};this.compareRange=function(range){var cmp,end=range.end,start=range.start;cmp=this.compare(end.row,end.column);if(cmp==1){cmp=this.compare(start.row,start.column);if(cmp==1){return 2}else if(cmp==0){return 1}else{return 0}}else if(cmp==-1){return-2}else{cmp=this.compare(start.row,start.column);if(cmp==-1){return-1}else if(cmp==1){return 42}else{return 0}}};this.comparePoint=function(p){return this.compare(p.row,p.column)};this.containsRange=function(range){return this.comparePoint(range.start)==0&&this.comparePoint(range.end)==0};this.intersects=function(range){var cmp=this.compareRange(range);return cmp==-1||cmp==0||cmp==1};this.isEnd=function(row,column){return this.end.row==row&&this.end.column==column};this.isStart=function(row,column){return this.start.row==row&&this.start.column==column};this.setStart=function(row,column){if(typeof row=="object"){this.start.column=row.column;this.start.row=row.row}else{this.start.row=row;this.start.column=column}};this.setEnd=function(row,column){if(typeof row=="object"){this.end.column=row.column;this.end.row=row.row}else{this.end.row=row;this.end.column=column}};this.inside=function(row,column){if(this.compare(row,column)==0){if(this.isEnd(row,column)||this.isStart(row,column)){return false}else{return true}}return false};this.insideStart=function(row,column){if(this.compare(row,column)==0){if(this.isEnd(row,column)){return false}else{return true}}return false};this.insideEnd=function(row,column){if(this.compare(row,column)==0){if(this.isStart(row,column)){return false}else{return true}}return false};this.compare=function(row,column){if(!this.isMultiLine()){if(row===this.start.row){return column<this.start.column?-1:column>this.end.column?1:0}}if(row<this.start.row)return-1;if(row>this.end.row)return 1;if(this.start.row===row)return column>=this.start.column?0:-1;if(this.end.row===row)return column<=this.end.column?0:1;return 0};this.compareStart=function(row,column){if(this.start.row==row&&this.start.column==column){return-1}else{return this.compare(row,column)}};this.compareEnd=function(row,column){if(this.end.row==row&&this.end.column==column){return 1}else{return this.compare(row,column)}};this.compareInside=function(row,column){if(this.end.row==row&&this.end.column==column){return 1}else if(this.start.row==row&&this.start.column==column){return-1}else{return this.compare(row,column)}};this.clipRows=function(firstRow,lastRow){if(this.end.row>lastRow)var end={row:lastRow+1,column:0};else if(this.end.row<firstRow)var end={row:firstRow,column:0};if(this.start.row>lastRow)var start={row:lastRow+1,column:0};else if(this.start.row<firstRow)var start={row:firstRow,column:0};return Range.fromPoints(start||this.start,end||this.end)};this.extend=function(row,column){var cmp=this.compare(row,column);if(cmp==0)return this;else if(cmp==-1)var start={row:row,column:column};else var end={row:row,column:column};return Range.fromPoints(start||this.start,end||this.end)};this.isEmpty=function(){return this.start.row===this.end.row&&this.start.column===this.end.column};this.isMultiLine=function(){return this.start.row!==this.end.row};this.clone=function(){return Range.fromPoints(this.start,this.end)};this.collapseRows=function(){if(this.end.column==0)return new Range(this.start.row,0,Math.max(this.start.row,this.end.row-1),0);else return new Range(this.start.row,0,this.end.row,0)};this.toScreenRange=function(session){var screenPosStart=session.documentToScreenPosition(this.start);var screenPosEnd=session.documentToScreenPosition(this.end);return new Range(screenPosStart.row,screenPosStart.column,screenPosEnd.row,screenPosEnd.column)};this.moveBy=function(row,column){this.start.row+=row;this.start.column+=column;this.end.row+=row;this.end.column+=column}}).call(Range.prototype);Range.fromPoints=function(start,end){return new Range(start.row,start.column,end.row,end.column)};Range.comparePoints=comparePoints;Range.comparePoints=function(p1,p2){return p1.row-p2.row||p1.column-p2.column};exports.Range=Range}));ace.define("ace/selection",["require","exports","module","ace/lib/oop","ace/lib/lang","ace/lib/event_emitter","ace/range"],(function(acequire,exports,module){"use strict";var oop=acequire("./lib/oop");var lang=acequire("./lib/lang");var EventEmitter=acequire("./lib/event_emitter").EventEmitter;var Range=acequire("./range").Range;var Selection=function(session){this.session=session;this.doc=session.getDocument();this.clearSelection();this.lead=this.selectionLead=this.doc.createAnchor(0,0);this.anchor=this.selectionAnchor=this.doc.createAnchor(0,0);var self=this;this.lead.on("change",(function(e){self._emit("changeCursor");if(!self.$isEmpty)self._emit("changeSelection");if(!self.$keepDesiredColumnOnChange&&e.old.column!=e.value.column)self.$desiredColumn=null}));this.selectionAnchor.on("change",(function(){if(!self.$isEmpty)self._emit("changeSelection")}))};(function(){oop.implement(this,EventEmitter);this.isEmpty=function(){return this.$isEmpty||this.anchor.row==this.lead.row&&this.anchor.column==this.lead.column};this.isMultiLine=function(){if(this.isEmpty()){return false}return this.getRange().isMultiLine()};this.getCursor=function(){return this.lead.getPosition()};this.setSelectionAnchor=function(row,column){this.anchor.setPosition(row,column);if(this.$isEmpty){this.$isEmpty=false;this._emit("changeSelection")}};this.getSelectionAnchor=function(){if(this.$isEmpty)return this.getSelectionLead();else return this.anchor.getPosition()};this.getSelectionLead=function(){return this.lead.getPosition()};this.shiftSelection=function(columns){if(this.$isEmpty){this.moveCursorTo(this.lead.row,this.lead.column+columns);return}var anchor=this.getSelectionAnchor();var lead=this.getSelectionLead();var isBackwards=this.isBackwards();if(!isBackwards||anchor.column!==0)this.setSelectionAnchor(anchor.row,anchor.column+columns);if(isBackwards||lead.column!==0){this.$moveSelection((function(){this.moveCursorTo(lead.row,lead.column+columns)}))}};this.isBackwards=function(){var anchor=this.anchor;var lead=this.lead;return anchor.row>lead.row||anchor.row==lead.row&&anchor.column>lead.column};this.getRange=function(){var anchor=this.anchor;var lead=this.lead;if(this.isEmpty())return Range.fromPoints(lead,lead);if(this.isBackwards()){return Range.fromPoints(lead,anchor)}else{return Range.fromPoints(anchor,lead)}};this.clearSelection=function(){if(!this.$isEmpty){this.$isEmpty=true;this._emit("changeSelection")}};this.selectAll=function(){var lastRow=this.doc.getLength()-1;this.setSelectionAnchor(0,0);this.moveCursorTo(lastRow,this.doc.getLine(lastRow).length)};this.setRange=this.setSelectionRange=function(range,reverse){if(reverse){this.setSelectionAnchor(range.end.row,range.end.column);this.selectTo(range.start.row,range.start.column)}else{this.setSelectionAnchor(range.start.row,range.start.column);this.selectTo(range.end.row,range.end.column)}if(this.getRange().isEmpty())this.$isEmpty=true;this.$desiredColumn=null};this.$moveSelection=function(mover){var lead=this.lead;if(this.$isEmpty)this.setSelectionAnchor(lead.row,lead.column);mover.call(this)};this.selectTo=function(row,column){this.$moveSelection((function(){this.moveCursorTo(row,column)}))};this.selectToPosition=function(pos){this.$moveSelection((function(){this.moveCursorToPosition(pos)}))};this.moveTo=function(row,column){this.clearSelection();this.moveCursorTo(row,column)};this.moveToPosition=function(pos){this.clearSelection();this.moveCursorToPosition(pos)};this.selectUp=function(){this.$moveSelection(this.moveCursorUp)};this.selectDown=function(){this.$moveSelection(this.moveCursorDown)};this.selectRight=function(){this.$moveSelection(this.moveCursorRight)};this.selectLeft=function(){this.$moveSelection(this.moveCursorLeft)};this.selectLineStart=function(){this.$moveSelection(this.moveCursorLineStart)};this.selectLineEnd=function(){this.$moveSelection(this.moveCursorLineEnd)};this.selectFileEnd=function(){this.$moveSelection(this.moveCursorFileEnd)};this.selectFileStart=function(){this.$moveSelection(this.moveCursorFileStart)};this.selectWordRight=function(){this.$moveSelection(this.moveCursorWordRight)};this.selectWordLeft=function(){this.$moveSelection(this.moveCursorWordLeft)};this.getWordRange=function(row,column){if(typeof column=="undefined"){var cursor=row||this.lead;row=cursor.row;column=cursor.column}return this.session.getWordRange(row,column)};this.selectWord=function(){this.setSelectionRange(this.getWordRange())};this.selectAWord=function(){var cursor=this.getCursor();var range=this.session.getAWordRange(cursor.row,cursor.column);this.setSelectionRange(range)};this.getLineRange=function(row,excludeLastChar){var rowStart=typeof row=="number"?row:this.lead.row;var rowEnd;var foldLine=this.session.getFoldLine(rowStart);if(foldLine){rowStart=foldLine.start.row;rowEnd=foldLine.end.row}else{rowEnd=rowStart}if(excludeLastChar===true)return new Range(rowStart,0,rowEnd,this.session.getLine(rowEnd).length);else return new Range(rowStart,0,rowEnd+1,0)};this.selectLine=function(){this.setSelectionRange(this.getLineRange())};this.moveCursorUp=function(){this.moveCursorBy(-1,0)};this.moveCursorDown=function(){this.moveCursorBy(1,0)};this.wouldMoveIntoSoftTab=function(cursor,tabSize,direction){var start=cursor.column;var end=cursor.column+tabSize;if(direction<0){start=cursor.column-tabSize;end=cursor.column}return this.session.isTabStop(cursor)&&this.doc.getLine(cursor.row).slice(start,end).split(" ").length-1==tabSize};this.moveCursorLeft=function(){var cursor=this.lead.getPosition(),fold;if(fold=this.session.getFoldAt(cursor.row,cursor.column,-1)){this.moveCursorTo(fold.start.row,fold.start.column)}else if(cursor.column===0){if(cursor.row>0){this.moveCursorTo(cursor.row-1,this.doc.getLine(cursor.row-1).length)}}else{var tabSize=this.session.getTabSize();if(this.wouldMoveIntoSoftTab(cursor,tabSize,-1)&&!this.session.getNavigateWithinSoftTabs()){this.moveCursorBy(0,-tabSize)}else{this.moveCursorBy(0,-1)}}};this.moveCursorRight=function(){var cursor=this.lead.getPosition(),fold;if(fold=this.session.getFoldAt(cursor.row,cursor.column,1)){this.moveCursorTo(fold.end.row,fold.end.column)}else if(this.lead.column==this.doc.getLine(this.lead.row).length){if(this.lead.row<this.doc.getLength()-1){this.moveCursorTo(this.lead.row+1,0)}}else{var tabSize=this.session.getTabSize();var cursor=this.lead;if(this.wouldMoveIntoSoftTab(cursor,tabSize,1)&&!this.session.getNavigateWithinSoftTabs()){this.moveCursorBy(0,tabSize)}else{this.moveCursorBy(0,1)}}};this.moveCursorLineStart=function(){var row=this.lead.row;var column=this.lead.column;var screenRow=this.session.documentToScreenRow(row,column);var firstColumnPosition=this.session.screenToDocumentPosition(screenRow,0);var beforeCursor=this.session.getDisplayLine(row,null,firstColumnPosition.row,firstColumnPosition.column);var leadingSpace=beforeCursor.match(/^\s*/);if(leadingSpace[0].length!=column&&!this.session.$useEmacsStyleLineStart)firstColumnPosition.column+=leadingSpace[0].length;this.moveCursorToPosition(firstColumnPosition)};this.moveCursorLineEnd=function(){var lead=this.lead;var lineEnd=this.session.getDocumentLastRowColumnPosition(lead.row,lead.column);if(this.lead.column==lineEnd.column){var line=this.session.getLine(lineEnd.row);if(lineEnd.column==line.length){var textEnd=line.search(/\s+$/);if(textEnd>0)lineEnd.column=textEnd}}this.moveCursorTo(lineEnd.row,lineEnd.column)};this.moveCursorFileEnd=function(){var row=this.doc.getLength()-1;var column=this.doc.getLine(row).length;this.moveCursorTo(row,column)};this.moveCursorFileStart=function(){this.moveCursorTo(0,0)};this.moveCursorLongWordRight=function(){var row=this.lead.row;var column=this.lead.column;var line=this.doc.getLine(row);var rightOfCursor=line.substring(column);var match;this.session.nonTokenRe.lastIndex=0;this.session.tokenRe.lastIndex=0;var fold=this.session.getFoldAt(row,column,1);if(fold){this.moveCursorTo(fold.end.row,fold.end.column);return}if(match=this.session.nonTokenRe.exec(rightOfCursor)){column+=this.session.nonTokenRe.lastIndex;this.session.nonTokenRe.lastIndex=0;rightOfCursor=line.substring(column)}if(column>=line.length){this.moveCursorTo(row,line.length);this.moveCursorRight();if(row<this.doc.getLength()-1)this.moveCursorWordRight();return}if(match=this.session.tokenRe.exec(rightOfCursor)){column+=this.session.tokenRe.lastIndex;this.session.tokenRe.lastIndex=0}this.moveCursorTo(row,column)};this.moveCursorLongWordLeft=function(){var row=this.lead.row;var column=this.lead.column;var fold;if(fold=this.session.getFoldAt(row,column,-1)){this.moveCursorTo(fold.start.row,fold.start.column);return}var str=this.session.getFoldStringAt(row,column,-1);if(str==null){str=this.doc.getLine(row).substring(0,column)}var leftOfCursor=lang.stringReverse(str);var match;this.session.nonTokenRe.lastIndex=0;this.session.tokenRe.lastIndex=0;if(match=this.session.nonTokenRe.exec(leftOfCursor)){column-=this.session.nonTokenRe.lastIndex;leftOfCursor=leftOfCursor.slice(this.session.nonTokenRe.lastIndex);this.session.nonTokenRe.lastIndex=0}if(column<=0){this.moveCursorTo(row,0);this.moveCursorLeft();if(row>0)this.moveCursorWordLeft();return}if(match=this.session.tokenRe.exec(leftOfCursor)){column-=this.session.tokenRe.lastIndex;this.session.tokenRe.lastIndex=0}this.moveCursorTo(row,column)};this.$shortWordEndIndex=function(rightOfCursor){var match,index=0,ch;var whitespaceRe=/\s/;var tokenRe=this.session.tokenRe;tokenRe.lastIndex=0;if(match=this.session.tokenRe.exec(rightOfCursor)){index=this.session.tokenRe.lastIndex}else{while((ch=rightOfCursor[index])&&whitespaceRe.test(ch))index++;if(index<1){tokenRe.lastIndex=0;while((ch=rightOfCursor[index])&&!tokenRe.test(ch)){tokenRe.lastIndex=0;index++;if(whitespaceRe.test(ch)){if(index>2){index--;break}else{while((ch=rightOfCursor[index])&&whitespaceRe.test(ch))index++;if(index>2)break}}}}}tokenRe.lastIndex=0;return index};this.moveCursorShortWordRight=function(){var row=this.lead.row;var column=this.lead.column;var line=this.doc.getLine(row);var rightOfCursor=line.substring(column);var fold=this.session.getFoldAt(row,column,1);if(fold)return this.moveCursorTo(fold.end.row,fold.end.column);if(column==line.length){var l=this.doc.getLength();do{row++;rightOfCursor=this.doc.getLine(row)}while(row<l&&/^\s*$/.test(rightOfCursor));if(!/^\s+/.test(rightOfCursor))rightOfCursor="";column=0}var index=this.$shortWordEndIndex(rightOfCursor);this.moveCursorTo(row,column+index)};this.moveCursorShortWordLeft=function(){var row=this.lead.row;var column=this.lead.column;var fold;if(fold=this.session.getFoldAt(row,column,-1))return this.moveCursorTo(fold.start.row,fold.start.column);var line=this.session.getLine(row).substring(0,column);if(column===0){do{row--;line=this.doc.getLine(row)}while(row>0&&/^\s*$/.test(line));column=line.length;if(!/\s+$/.test(line))line=""}var leftOfCursor=lang.stringReverse(line);var index=this.$shortWordEndIndex(leftOfCursor);return this.moveCursorTo(row,column-index)};this.moveCursorWordRight=function(){if(this.session.$selectLongWords)this.moveCursorLongWordRight();else this.moveCursorShortWordRight()};this.moveCursorWordLeft=function(){if(this.session.$selectLongWords)this.moveCursorLongWordLeft();else this.moveCursorShortWordLeft()};this.moveCursorBy=function(rows,chars){var screenPos=this.session.documentToScreenPosition(this.lead.row,this.lead.column);var offsetX;if(chars===0){if(rows!==0){if(this.session.$bidiHandler.isBidiRow(screenPos.row,this.lead.row)){offsetX=this.session.$bidiHandler.getPosLeft(screenPos.column);screenPos.column=Math.round(offsetX/this.session.$bidiHandler.charWidths[0])}else{offsetX=screenPos.column*this.session.$bidiHandler.charWidths[0]}}if(this.$desiredColumn)screenPos.column=this.$desiredColumn;else this.$desiredColumn=screenPos.column}var docPos=this.session.screenToDocumentPosition(screenPos.row+rows,screenPos.column,offsetX);if(rows!==0&&chars===0&&docPos.row===this.lead.row&&docPos.column===this.lead.column){if(this.session.lineWidgets&&this.session.lineWidgets[docPos.row]){if(docPos.row>0||rows>0)docPos.row++}}this.moveCursorTo(docPos.row,docPos.column+chars,chars===0)};this.moveCursorToPosition=function(position){this.moveCursorTo(position.row,position.column)};this.moveCursorTo=function(row,column,keepDesiredColumn){var fold=this.session.getFoldAt(row,column,1);if(fold){row=fold.start.row;column=fold.start.column}this.$keepDesiredColumnOnChange=true;var line=this.session.getLine(row);if(/[\uDC00-\uDFFF]/.test(line.charAt(column))&&line.charAt(column-1)){if(this.lead.row==row&&this.lead.column==column+1)column=column-1;else column=column+1}this.lead.setPosition(row,column);this.$keepDesiredColumnOnChange=false;if(!keepDesiredColumn)this.$desiredColumn=null};this.moveCursorToScreen=function(row,column,keepDesiredColumn){var pos=this.session.screenToDocumentPosition(row,column);this.moveCursorTo(pos.row,pos.column,keepDesiredColumn)};this.detach=function(){this.lead.detach();this.anchor.detach();this.session=this.doc=null};this.fromOrientedRange=function(range){this.setSelectionRange(range,range.cursor==range.start);this.$desiredColumn=range.desiredColumn||this.$desiredColumn};this.toOrientedRange=function(range){var r=this.getRange();if(range){range.start.column=r.start.column;range.start.row=r.start.row;range.end.column=r.end.column;range.end.row=r.end.row}else{range=r}range.cursor=this.isBackwards()?range.start:range.end;range.desiredColumn=this.$desiredColumn;return range};this.getRangeOfMovements=function(func){var start=this.getCursor();try{func(this);var end=this.getCursor();return Range.fromPoints(start,end)}catch(e){return Range.fromPoints(start,start)}finally{this.moveCursorToPosition(start)}};this.toJSON=function(){if(this.rangeCount){var data=this.ranges.map((function(r){var r1=r.clone();r1.isBackwards=r.cursor==r.start;return r1}))}else{var data=this.getRange();data.isBackwards=this.isBackwards()}return data};this.fromJSON=function(data){if(data.start==undefined){if(this.rangeList){this.toSingleRange(data[0]);for(var i=data.length;i--;){var r=Range.fromPoints(data[i].start,data[i].end);if(data[i].isBackwards)r.cursor=r.start;this.addRange(r,true)}return}else data=data[0]}if(this.rangeList)this.toSingleRange(data);this.setSelectionRange(data,data.isBackwards)};this.isEqual=function(data){if((data.length||this.rangeCount)&&data.length!=this.rangeCount)return false;if(!data.length||!this.ranges)return this.getRange().isEqual(data);for(var i=this.ranges.length;i--;){if(!this.ranges[i].isEqual(data[i]))return false}return true}}).call(Selection.prototype);exports.Selection=Selection}));ace.define("ace/tokenizer",["require","exports","module","ace/config"],(function(acequire,exports,module){"use strict";var config=acequire("./config");var MAX_TOKEN_COUNT=2e3;var Tokenizer=function(rules){this.states=rules;this.regExps={};this.matchMappings={};for(var key in this.states){var state=this.states[key];var ruleRegExps=[];var matchTotal=0;var mapping=this.matchMappings[key]={defaultToken:"text"};var flag="g";var splitterRurles=[];for(var i=0;i<state.length;i++){var rule=state[i];if(rule.defaultToken)mapping.defaultToken=rule.defaultToken;if(rule.caseInsensitive)flag="gi";if(rule.regex==null)continue;if(rule.regex instanceof RegExp)rule.regex=rule.regex.toString().slice(1,-1);var adjustedregex=rule.regex;var matchcount=new RegExp("(?:("+adjustedregex+")|(.))").exec("a").length-2;if(Array.isArray(rule.token)){if(rule.token.length==1||matchcount==1){rule.token=rule.token[0]}else if(matchcount-1!=rule.token.length){this.reportError("number of classes and regexp groups doesn't match",{rule:rule,groupCount:matchcount-1});rule.token=rule.token[0]}else{rule.tokenArray=rule.token;rule.token=null;rule.onMatch=this.$arrayTokens}}else if(typeof rule.token=="function"&&!rule.onMatch){if(matchcount>1)rule.onMatch=this.$applyToken;else rule.onMatch=rule.token}if(matchcount>1){if(/\\\d/.test(rule.regex)){adjustedregex=rule.regex.replace(/\\([0-9]+)/g,(function(match,digit){return"\\"+(parseInt(digit,10)+matchTotal+1)}))}else{matchcount=1;adjustedregex=this.removeCapturingGroups(rule.regex)}if(!rule.splitRegex&&typeof rule.token!="string")splitterRurles.push(rule)}mapping[matchTotal]=i;matchTotal+=matchcount;ruleRegExps.push(adjustedregex);if(!rule.onMatch)rule.onMatch=null}if(!ruleRegExps.length){mapping[0]=0;ruleRegExps.push("$")}splitterRurles.forEach((function(rule){rule.splitRegex=this.createSplitterRegexp(rule.regex,flag)}),this);this.regExps[key]=new RegExp("("+ruleRegExps.join(")|(")+")|($)",flag)}};(function(){this.$setMaxTokenCount=function(m){MAX_TOKEN_COUNT=m|0};this.$applyToken=function(str){var values=this.splitRegex.exec(str).slice(1);var types=this.token.apply(this,values);if(typeof types==="string")return[{type:types,value:str}];var tokens=[];for(var i=0,l=types.length;i<l;i++){if(values[i])tokens[tokens.length]={type:types[i],value:values[i]}}return tokens};this.$arrayTokens=function(str){if(!str)return[];var values=this.splitRegex.exec(str);if(!values)return"text";var tokens=[];var types=this.tokenArray;for(var i=0,l=types.length;i<l;i++){if(values[i+1])tokens[tokens.length]={type:types[i],value:values[i+1]}}return tokens};this.removeCapturingGroups=function(src){var r=src.replace(/\[(?:\\.|[^\]])*?\]|\\.|\(\?[:=!]|(\()/g,(function(x,y){return y?"(?:":x}));return r};this.createSplitterRegexp=function(src,flag){if(src.indexOf("(?=")!=-1){var stack=0;var inChClass=false;var lastCapture={};src.replace(/(\\.)|(\((?:\?[=!])?)|(\))|([\[\]])/g,(function(m,esc,parenOpen,parenClose,square,index){if(inChClass){inChClass=square!="]"}else if(square){inChClass=true}else if(parenClose){if(stack==lastCapture.stack){lastCapture.end=index+1;lastCapture.stack=-1}stack--}else if(parenOpen){stack++;if(parenOpen.length!=1){lastCapture.stack=stack;lastCapture.start=index}}return m}));if(lastCapture.end!=null&&/^\)*$/.test(src.substr(lastCapture.end)))src=src.substring(0,lastCapture.start)+src.substr(lastCapture.end)}if(src.charAt(0)!="^")src="^"+src;if(src.charAt(src.length-1)!="$")src+="$";return new RegExp(src,(flag||"").replace("g",""))};this.getLineTokens=function(line,startState){if(startState&&typeof startState!="string"){var stack=startState.slice(0);startState=stack[0];if(startState==="#tmp"){stack.shift();startState=stack.shift()}}else var stack=[];var currentState=startState||"start";var state=this.states[currentState];if(!state){currentState="start";state=this.states[currentState]}var mapping=this.matchMappings[currentState];var re=this.regExps[currentState];re.lastIndex=0;var match,tokens=[];var lastIndex=0;var matchAttempts=0;var token={type:null,value:""};while(match=re.exec(line)){var type=mapping.defaultToken;var rule=null;var value=match[0];var index=re.lastIndex;if(index-value.length>lastIndex){var skipped=line.substring(lastIndex,index-value.length);if(token.type==type){token.value+=skipped}else{if(token.type)tokens.push(token);token={type:type,value:skipped}}}for(var i=0;i<match.length-2;i++){if(match[i+1]===undefined)continue;rule=state[mapping[i]];if(rule.onMatch)type=rule.onMatch(value,currentState,stack,line);else type=rule.token;if(rule.next){if(typeof rule.next=="string"){currentState=rule.next}else{currentState=rule.next(currentState,stack)}state=this.states[currentState];if(!state){this.reportError("state doesn't exist",currentState);currentState="start";state=this.states[currentState]}mapping=this.matchMappings[currentState];lastIndex=index;re=this.regExps[currentState];re.lastIndex=index}if(rule.consumeLineEnd)lastIndex=index;break}if(value){if(typeof type==="string"){if((!rule||rule.merge!==false)&&token.type===type){token.value+=value}else{if(token.type)tokens.push(token);token={type:type,value:value}}}else if(type){if(token.type)tokens.push(token);token={type:null,value:""};for(var i=0;i<type.length;i++)tokens.push(type[i])}}if(lastIndex==line.length)break;lastIndex=index;if(matchAttempts++>MAX_TOKEN_COUNT){if(matchAttempts>2*line.length){this.reportError("infinite loop with in ace tokenizer",{startState:startState,line:line})}while(lastIndex<line.length){if(token.type)tokens.push(token);token={value:line.substring(lastIndex,lastIndex+=2e3),type:"overflow"}}currentState="start";stack=[];break}}if(token.type)tokens.push(token);if(stack.length>1){if(stack[0]!==currentState)stack.unshift("#tmp",currentState)}return{tokens:tokens,state:stack.length?stack:currentState}};this.reportError=config.reportError}).call(Tokenizer.prototype);exports.Tokenizer=Tokenizer}));ace.define("ace/mode/text_highlight_rules",["require","exports","module","ace/lib/lang"],(function(acequire,exports,module){"use strict";var lang=acequire("../lib/lang");var TextHighlightRules=function(){this.$rules={start:[{token:"empty_line",regex:"^$"},{defaultToken:"text"}]}};(function(){this.addRules=function(rules,prefix){if(!prefix){for(var key in rules)this.$rules[key]=rules[key];return}for(var key in rules){var state=rules[key];for(var i=0;i<state.length;i++){var rule=state[i];if(rule.next||rule.onMatch){if(typeof rule.next=="string"){if(rule.next.indexOf(prefix)!==0)rule.next=prefix+rule.next}if(rule.nextState&&rule.nextState.indexOf(prefix)!==0)rule.nextState=prefix+rule.nextState}}this.$rules[prefix+key]=state}};this.getRules=function(){return this.$rules};this.embedRules=function(HighlightRules,prefix,escapeRules,states,append){var embedRules=typeof HighlightRules=="function"?(new HighlightRules).getRules():HighlightRules;if(states){for(var i=0;i<states.length;i++)states[i]=prefix+states[i]}else{states=[];for(var key in embedRules)states.push(prefix+key)}this.addRules(embedRules,prefix);if(escapeRules){var addRules=Array.prototype[append?"push":"unshift"];for(var i=0;i<states.length;i++)addRules.apply(this.$rules[states[i]],lang.deepCopy(escapeRules))}if(!this.$embeds)this.$embeds=[];this.$embeds.push(prefix)};this.getEmbeds=function(){return this.$embeds};var pushState=function(currentState,stack){if(currentState!="start"||stack.length)stack.unshift(this.nextState,currentState);return this.nextState};var popState=function(currentState,stack){stack.shift();return stack.shift()||"start"};this.normalizeRules=function(){var id=0;var rules=this.$rules;function processState(key){var state=rules[key];state.processed=true;for(var i=0;i<state.length;i++){var rule=state[i];var toInsert=null;if(Array.isArray(rule)){toInsert=rule;rule={}}if(!rule.regex&&rule.start){rule.regex=rule.start;if(!rule.next)rule.next=[];rule.next.push({defaultToken:rule.token},{token:rule.token+".end",regex:rule.end||rule.start,next:"pop"});rule.token=rule.token+".start";rule.push=true}var next=rule.next||rule.push;if(next&&Array.isArray(next)){var stateName=rule.stateName;if(!stateName){stateName=rule.token;if(typeof stateName!="string")stateName=stateName[0]||"";if(rules[stateName])stateName+=id++}rules[stateName]=next;rule.next=stateName;processState(stateName)}else if(next=="pop"){rule.next=popState}if(rule.push){rule.nextState=rule.next||rule.push;rule.next=pushState;delete rule.push}if(rule.rules){for(var r in rule.rules){if(rules[r]){if(rules[r].push)rules[r].push.apply(rules[r],rule.rules[r])}else{rules[r]=rule.rules[r]}}}var includeName=typeof rule=="string"?rule:rule.include;if(includeName){if(Array.isArray(includeName))toInsert=includeName.map((function(x){return rules[x]}));else toInsert=rules[includeName]}if(toInsert){var args=[i,1].concat(toInsert);if(rule.noEscape)args=args.filter((function(x){return!x.next}));state.splice.apply(state,args);i--}if(rule.keywordMap){rule.token=this.createKeywordMapper(rule.keywordMap,rule.defaultToken||"text",rule.caseInsensitive);delete rule.defaultToken}}}Object.keys(rules).forEach(processState,this)};this.createKeywordMapper=function(map,defaultToken,ignoreCase,splitChar){var keywords=Object.create(null);Object.keys(map).forEach((function(className){var a=map[className];if(ignoreCase)a=a.toLowerCase();var list=a.split(splitChar||"|");for(var i=list.length;i--;)keywords[list[i]]=className}));if(Object.getPrototypeOf(keywords)){keywords.__proto__=null}this.$keywordList=Object.keys(keywords);map=null;return ignoreCase?function(value){return keywords[value.toLowerCase()]||defaultToken}:function(value){return keywords[value]||defaultToken}};this.getKeywords=function(){return this.$keywords}}).call(TextHighlightRules.prototype);exports.TextHighlightRules=TextHighlightRules}));ace.define("ace/mode/behaviour",["require","exports","module"],(function(acequire,exports,module){"use strict";var Behaviour=function(){this.$behaviours={}};(function(){this.add=function(name,action,callback){switch(undefined){case this.$behaviours:this.$behaviours={};case this.$behaviours[name]:this.$behaviours[name]={}}this.$behaviours[name][action]=callback};this.addBehaviours=function(behaviours){for(var key in behaviours){for(var action in behaviours[key]){this.add(key,action,behaviours[key][action])}}};this.remove=function(name){if(this.$behaviours&&this.$behaviours[name]){delete this.$behaviours[name]}};this.inherit=function(mode,filter){if(typeof mode==="function"){var behaviours=(new mode).getBehaviours(filter)}else{var behaviours=mode.getBehaviours(filter)}this.addBehaviours(behaviours)};this.getBehaviours=function(filter){if(!filter){return this.$behaviours}else{var ret={};for(var i=0;i<filter.length;i++){if(this.$behaviours[filter[i]]){ret[filter[i]]=this.$behaviours[filter[i]]}}return ret}}}).call(Behaviour.prototype);exports.Behaviour=Behaviour}));ace.define("ace/token_iterator",["require","exports","module","ace/range"],(function(acequire,exports,module){"use strict";var Range=acequire("./range").Range;var TokenIterator=function(session,initialRow,initialColumn){this.$session=session;this.$row=initialRow;this.$rowTokens=session.getTokens(initialRow);var token=session.getTokenAt(initialRow,initialColumn);this.$tokenIndex=token?token.index:-1};(function(){this.stepBackward=function(){this.$tokenIndex-=1;while(this.$tokenIndex<0){this.$row-=1;if(this.$row<0){this.$row=0;return null}this.$rowTokens=this.$session.getTokens(this.$row);this.$tokenIndex=this.$rowTokens.length-1}return this.$rowTokens[this.$tokenIndex]};this.stepForward=function(){this.$tokenIndex+=1;var rowCount;while(this.$tokenIndex>=this.$rowTokens.length){this.$row+=1;if(!rowCount)rowCount=this.$session.getLength();if(this.$row>=rowCount){this.$row=rowCount-1;return null}this.$rowTokens=this.$session.getTokens(this.$row);this.$tokenIndex=0}return this.$rowTokens[this.$tokenIndex]};this.getCurrentToken=function(){return this.$rowTokens[this.$tokenIndex]};this.getCurrentTokenRow=function(){return this.$row};this.getCurrentTokenColumn=function(){var rowTokens=this.$rowTokens;var tokenIndex=this.$tokenIndex;var column=rowTokens[tokenIndex].start;if(column!==undefined)return column;column=0;while(tokenIndex>0){tokenIndex-=1;column+=rowTokens[tokenIndex].value.length}return column};this.getCurrentTokenPosition=function(){return{row:this.$row,column:this.getCurrentTokenColumn()}};this.getCurrentTokenRange=function(){var token=this.$rowTokens[this.$tokenIndex];var column=this.getCurrentTokenColumn();return new Range(this.$row,column,this.$row,column+token.value.length)}}).call(TokenIterator.prototype);exports.TokenIterator=TokenIterator}));ace.define("ace/mode/behaviour/cstyle",["require","exports","module","ace/lib/oop","ace/mode/behaviour","ace/token_iterator","ace/lib/lang"],(function(acequire,exports,module){"use strict";var oop=acequire("../../lib/oop");var Behaviour=acequire("../behaviour").Behaviour;var TokenIterator=acequire("../../token_iterator").TokenIterator;var lang=acequire("../../lib/lang");var SAFE_INSERT_IN_TOKENS=["text","paren.rparen","punctuation.operator"];var SAFE_INSERT_BEFORE_TOKENS=["text","paren.rparen","punctuation.operator","comment"];var context;var contextCache={};var defaultQuotes={'"':'"',"'":"'"};var initContext=function(editor){var id=-1;if(editor.multiSelect){id=editor.selection.index;if(contextCache.rangeCount!=editor.multiSelect.rangeCount)contextCache={rangeCount:editor.multiSelect.rangeCount}}if(contextCache[id])return context=contextCache[id];context=contextCache[id]={autoInsertedBrackets:0,autoInsertedRow:-1,autoInsertedLineEnd:"",maybeInsertedBrackets:0,maybeInsertedRow:-1,maybeInsertedLineStart:"",maybeInsertedLineEnd:""}};var getWrapped=function(selection,selected,opening,closing){var rowDiff=selection.end.row-selection.start.row;return{text:opening+selected+closing,selection:[0,selection.start.column+1,rowDiff,selection.end.column+(rowDiff?0:1)]}};var CstyleBehaviour=function(options){this.add("braces","insertion",(function(state,action,editor,session,text){var cursor=editor.getCursorPosition();var line=session.doc.getLine(cursor.row);if(text=="{"){initContext(editor);var selection=editor.getSelectionRange();var selected=session.doc.getTextRange(selection);if(selected!==""&&selected!=="{"&&editor.getWrapBehavioursEnabled()){return getWrapped(selection,selected,"{","}")}else if(CstyleBehaviour.isSaneInsertion(editor,session)){if(/[\]\}\)]/.test(line[cursor.column])||editor.inMultiSelectMode||options&&options.braces){CstyleBehaviour.recordAutoInsert(editor,session,"}");return{text:"{}",selection:[1,1]}}else{CstyleBehaviour.recordMaybeInsert(editor,session,"{");return{text:"{",selection:[1,1]}}}}else if(text=="}"){initContext(editor);var rightChar=line.substring(cursor.column,cursor.column+1);if(rightChar=="}"){var matching=session.$findOpeningBracket("}",{column:cursor.column+1,row:cursor.row});if(matching!==null&&CstyleBehaviour.isAutoInsertedClosing(cursor,line,text)){CstyleBehaviour.popAutoInsertedClosing();return{text:"",selection:[1,1]}}}}else if(text=="\n"||text=="\r\n"){initContext(editor);var closing="";if(CstyleBehaviour.isMaybeInsertedClosing(cursor,line)){closing=lang.stringRepeat("}",context.maybeInsertedBrackets);CstyleBehaviour.clearMaybeInsertedClosing()}var rightChar=line.substring(cursor.column,cursor.column+1);if(rightChar==="}"){var openBracePos=session.findMatchingBracket({row:cursor.row,column:cursor.column+1},"}");if(!openBracePos)return null;var next_indent=this.$getIndent(session.getLine(openBracePos.row))}else if(closing){var next_indent=this.$getIndent(line)}else{CstyleBehaviour.clearMaybeInsertedClosing();return}var indent=next_indent+session.getTabString();return{text:"\n"+indent+"\n"+next_indent+closing,selection:[1,indent.length,1,indent.length]}}else{CstyleBehaviour.clearMaybeInsertedClosing()}}));this.add("braces","deletion",(function(state,action,editor,session,range){var selected=session.doc.getTextRange(range);if(!range.isMultiLine()&&selected=="{"){initContext(editor);var line=session.doc.getLine(range.start.row);var rightChar=line.substring(range.end.column,range.end.column+1);if(rightChar=="}"){range.end.column++;return range}else{context.maybeInsertedBrackets--}}}));this.add("parens","insertion",(function(state,action,editor,session,text){if(text=="("){initContext(editor);var selection=editor.getSelectionRange();var selected=session.doc.getTextRange(selection);if(selected!==""&&editor.getWrapBehavioursEnabled()){return getWrapped(selection,selected,"(",")")}else if(CstyleBehaviour.isSaneInsertion(editor,session)){CstyleBehaviour.recordAutoInsert(editor,session,")");return{text:"()",selection:[1,1]}}}else if(text==")"){initContext(editor);var cursor=editor.getCursorPosition();var line=session.doc.getLine(cursor.row);var rightChar=line.substring(cursor.column,cursor.column+1);if(rightChar==")"){var matching=session.$findOpeningBracket(")",{column:cursor.column+1,row:cursor.row});if(matching!==null&&CstyleBehaviour.isAutoInsertedClosing(cursor,line,text)){CstyleBehaviour.popAutoInsertedClosing();return{text:"",selection:[1,1]}}}}}));this.add("parens","deletion",(function(state,action,editor,session,range){var selected=session.doc.getTextRange(range);if(!range.isMultiLine()&&selected=="("){initContext(editor);var line=session.doc.getLine(range.start.row);var rightChar=line.substring(range.start.column+1,range.start.column+2);if(rightChar==")"){range.end.column++;return range}}}));this.add("brackets","insertion",(function(state,action,editor,session,text){if(text=="["){initContext(editor);var selection=editor.getSelectionRange();var selected=session.doc.getTextRange(selection);if(selected!==""&&editor.getWrapBehavioursEnabled()){return getWrapped(selection,selected,"[","]")}else if(CstyleBehaviour.isSaneInsertion(editor,session)){CstyleBehaviour.recordAutoInsert(editor,session,"]");return{text:"[]",selection:[1,1]}}}else if(text=="]"){initContext(editor);var cursor=editor.getCursorPosition();var line=session.doc.getLine(cursor.row);var rightChar=line.substring(cursor.column,cursor.column+1);if(rightChar=="]"){var matching=session.$findOpeningBracket("]",{column:cursor.column+1,row:cursor.row});if(matching!==null&&CstyleBehaviour.isAutoInsertedClosing(cursor,line,text)){CstyleBehaviour.popAutoInsertedClosing();return{text:"",selection:[1,1]}}}}}));this.add("brackets","deletion",(function(state,action,editor,session,range){var selected=session.doc.getTextRange(range);if(!range.isMultiLine()&&selected=="["){initContext(editor);var line=session.doc.getLine(range.start.row);var rightChar=line.substring(range.start.column+1,range.start.column+2);if(rightChar=="]"){range.end.column++;return range}}}));this.add("string_dquotes","insertion",(function(state,action,editor,session,text){var quotes=session.$mode.$quotes||defaultQuotes;if(text.length==1&&quotes[text]){if(this.lineCommentStart&&this.lineCommentStart.indexOf(text)!=-1)return;initContext(editor);var quote=text;var selection=editor.getSelectionRange();var selected=session.doc.getTextRange(selection);if(selected!==""&&(selected.length!=1||!quotes[selected])&&editor.getWrapBehavioursEnabled()){return getWrapped(selection,selected,quote,quote)}else if(!selected){var cursor=editor.getCursorPosition();var line=session.doc.getLine(cursor.row);var leftChar=line.substring(cursor.column-1,cursor.column);var rightChar=line.substring(cursor.column,cursor.column+1);var token=session.getTokenAt(cursor.row,cursor.column);var rightToken=session.getTokenAt(cursor.row,cursor.column+1);if(leftChar=="\\"&&token&&/escape/.test(token.type))return null;var stringBefore=token&&/string|escape/.test(token.type);var stringAfter=!rightToken||/string|escape/.test(rightToken.type);var pair;if(rightChar==quote){pair=stringBefore!==stringAfter;if(pair&&/string\.end/.test(rightToken.type))pair=false}else{if(stringBefore&&!stringAfter)return null;if(stringBefore&&stringAfter)return null;var wordRe=session.$mode.tokenRe;wordRe.lastIndex=0;var isWordBefore=wordRe.test(leftChar);wordRe.lastIndex=0;var isWordAfter=wordRe.test(leftChar);if(isWordBefore||isWordAfter)return null;if(rightChar&&!/[\s;,.})\]\\]/.test(rightChar))return null;pair=true}return{text:pair?quote+quote:"",selection:[1,1]}}}}));this.add("string_dquotes","deletion",(function(state,action,editor,session,range){var selected=session.doc.getTextRange(range);if(!range.isMultiLine()&&(selected=='"'||selected=="'")){initContext(editor);var line=session.doc.getLine(range.start.row);var rightChar=line.substring(range.start.column+1,range.start.column+2);if(rightChar==selected){range.end.column++;return range}}}))};CstyleBehaviour.isSaneInsertion=function(editor,session){var cursor=editor.getCursorPosition();var iterator=new TokenIterator(session,cursor.row,cursor.column);if(!this.$matchTokenType(iterator.getCurrentToken()||"text",SAFE_INSERT_IN_TOKENS)){var iterator2=new TokenIterator(session,cursor.row,cursor.column+1);if(!this.$matchTokenType(iterator2.getCurrentToken()||"text",SAFE_INSERT_IN_TOKENS))return false}iterator.stepForward();return iterator.getCurrentTokenRow()!==cursor.row||this.$matchTokenType(iterator.getCurrentToken()||"text",SAFE_INSERT_BEFORE_TOKENS)};CstyleBehaviour.$matchTokenType=function(token,types){return types.indexOf(token.type||token)>-1};CstyleBehaviour.recordAutoInsert=function(editor,session,bracket){var cursor=editor.getCursorPosition();var line=session.doc.getLine(cursor.row);if(!this.isAutoInsertedClosing(cursor,line,context.autoInsertedLineEnd[0]))context.autoInsertedBrackets=0;context.autoInsertedRow=cursor.row;context.autoInsertedLineEnd=bracket+line.substr(cursor.column);context.autoInsertedBrackets++};CstyleBehaviour.recordMaybeInsert=function(editor,session,bracket){var cursor=editor.getCursorPosition();var line=session.doc.getLine(cursor.row);if(!this.isMaybeInsertedClosing(cursor,line))context.maybeInsertedBrackets=0;context.maybeInsertedRow=cursor.row;context.maybeInsertedLineStart=line.substr(0,cursor.column)+bracket;context.maybeInsertedLineEnd=line.substr(cursor.column);context.maybeInsertedBrackets++};CstyleBehaviour.isAutoInsertedClosing=function(cursor,line,bracket){return context.autoInsertedBrackets>0&&cursor.row===context.autoInsertedRow&&bracket===context.autoInsertedLineEnd[0]&&line.substr(cursor.column)===context.autoInsertedLineEnd};CstyleBehaviour.isMaybeInsertedClosing=function(cursor,line){return context.maybeInsertedBrackets>0&&cursor.row===context.maybeInsertedRow&&line.substr(cursor.column)===context.maybeInsertedLineEnd&&line.substr(0,cursor.column)==context.maybeInsertedLineStart};CstyleBehaviour.popAutoInsertedClosing=function(){context.autoInsertedLineEnd=context.autoInsertedLineEnd.substr(1);context.autoInsertedBrackets--};CstyleBehaviour.clearMaybeInsertedClosing=function(){if(context){context.maybeInsertedBrackets=0;context.maybeInsertedRow=-1}};oop.inherits(CstyleBehaviour,Behaviour);exports.CstyleBehaviour=CstyleBehaviour}));ace.define("ace/unicode",["require","exports","module"],(function(acequire,exports,module){"use strict";exports.packages={};addUnicodePackage({L:"0041-005A0061-007A00AA00B500BA00C0-00D600D8-00F600F8-02C102C6-02D102E0-02E402EC02EE0370-037403760377037A-037D03860388-038A038C038E-03A103A3-03F503F7-0481048A-05250531-055605590561-058705D0-05EA05F0-05F20621-064A066E066F0671-06D306D506E506E606EE06EF06FA-06FC06FF07100712-072F074D-07A507B107CA-07EA07F407F507FA0800-0815081A082408280904-0939093D09500958-0961097109720979-097F0985-098C098F09900993-09A809AA-09B009B209B6-09B909BD09CE09DC09DD09DF-09E109F009F10A05-0A0A0A0F0A100A13-0A280A2A-0A300A320A330A350A360A380A390A59-0A5C0A5E0A72-0A740A85-0A8D0A8F-0A910A93-0AA80AAA-0AB00AB20AB30AB5-0AB90ABD0AD00AE00AE10B05-0B0C0B0F0B100B13-0B280B2A-0B300B320B330B35-0B390B3D0B5C0B5D0B5F-0B610B710B830B85-0B8A0B8E-0B900B92-0B950B990B9A0B9C0B9E0B9F0BA30BA40BA8-0BAA0BAE-0BB90BD00C05-0C0C0C0E-0C100C12-0C280C2A-0C330C35-0C390C3D0C580C590C600C610C85-0C8C0C8E-0C900C92-0CA80CAA-0CB30CB5-0CB90CBD0CDE0CE00CE10D05-0D0C0D0E-0D100D12-0D280D2A-0D390D3D0D600D610D7A-0D7F0D85-0D960D9A-0DB10DB3-0DBB0DBD0DC0-0DC60E01-0E300E320E330E40-0E460E810E820E840E870E880E8A0E8D0E94-0E970E99-0E9F0EA1-0EA30EA50EA70EAA0EAB0EAD-0EB00EB20EB30EBD0EC0-0EC40EC60EDC0EDD0F000F40-0F470F49-0F6C0F88-0F8B1000-102A103F1050-1055105A-105D106110651066106E-10701075-1081108E10A0-10C510D0-10FA10FC1100-1248124A-124D1250-12561258125A-125D1260-1288128A-128D1290-12B012B2-12B512B8-12BE12C012C2-12C512C8-12D612D8-13101312-13151318-135A1380-138F13A0-13F41401-166C166F-167F1681-169A16A0-16EA1700-170C170E-17111720-17311740-17511760-176C176E-17701780-17B317D717DC1820-18771880-18A818AA18B0-18F51900-191C1950-196D1970-19741980-19AB19C1-19C71A00-1A161A20-1A541AA71B05-1B331B45-1B4B1B83-1BA01BAE1BAF1C00-1C231C4D-1C4F1C5A-1C7D1CE9-1CEC1CEE-1CF11D00-1DBF1E00-1F151F18-1F1D1F20-1F451F48-1F4D1F50-1F571F591F5B1F5D1F5F-1F7D1F80-1FB41FB6-1FBC1FBE1FC2-1FC41FC6-1FCC1FD0-1FD31FD6-1FDB1FE0-1FEC1FF2-1FF41FF6-1FFC2071207F2090-209421022107210A-211321152119-211D212421262128212A-212D212F-2139213C-213F2145-2149214E218321842C00-2C2E2C30-2C5E2C60-2CE42CEB-2CEE2D00-2D252D30-2D652D6F2D80-2D962DA0-2DA62DA8-2DAE2DB0-2DB62DB8-2DBE2DC0-2DC62DC8-2DCE2DD0-2DD62DD8-2DDE2E2F300530063031-3035303B303C3041-3096309D-309F30A1-30FA30FC-30FF3105-312D3131-318E31A0-31B731F0-31FF3400-4DB54E00-9FCBA000-A48CA4D0-A4FDA500-A60CA610-A61FA62AA62BA640-A65FA662-A66EA67F-A697A6A0-A6E5A717-A71FA722-A788A78BA78CA7FB-A801A803-A805A807-A80AA80C-A822A840-A873A882-A8B3A8F2-A8F7A8FBA90A-A925A930-A946A960-A97CA984-A9B2A9CFAA00-AA28AA40-AA42AA44-AA4BAA60-AA76AA7AAA80-AAAFAAB1AAB5AAB6AAB9-AABDAAC0AAC2AADB-AADDABC0-ABE2AC00-D7A3D7B0-D7C6D7CB-D7FBF900-FA2DFA30-FA6DFA70-FAD9FB00-FB06FB13-FB17FB1DFB1F-FB28FB2A-FB36FB38-FB3CFB3EFB40FB41FB43FB44FB46-FBB1FBD3-FD3DFD50-FD8FFD92-FDC7FDF0-FDFBFE70-FE74FE76-FEFCFF21-FF3AFF41-FF5AFF66-FFBEFFC2-FFC7FFCA-FFCFFFD2-FFD7FFDA-FFDC",Ll:"0061-007A00AA00B500BA00DF-00F600F8-00FF01010103010501070109010B010D010F01110113011501170119011B011D011F01210123012501270129012B012D012F01310133013501370138013A013C013E014001420144014601480149014B014D014F01510153015501570159015B015D015F01610163016501670169016B016D016F0171017301750177017A017C017E-0180018301850188018C018D019201950199-019B019E01A101A301A501A801AA01AB01AD01B001B401B601B901BA01BD-01BF01C601C901CC01CE01D001D201D401D601D801DA01DC01DD01DF01E101E301E501E701E901EB01ED01EF01F001F301F501F901FB01FD01FF02010203020502070209020B020D020F02110213021502170219021B021D021F02210223022502270229022B022D022F02310233-0239023C023F0240024202470249024B024D024F-02930295-02AF037103730377037B-037D039003AC-03CE03D003D103D5-03D703D903DB03DD03DF03E103E303E503E703E903EB03ED03EF-03F303F503F803FB03FC0430-045F04610463046504670469046B046D046F04710473047504770479047B047D047F0481048B048D048F04910493049504970499049B049D049F04A104A304A504A704A904AB04AD04AF04B104B304B504B704B904BB04BD04BF04C204C404C604C804CA04CC04CE04CF04D104D304D504D704D904DB04DD04DF04E104E304E504E704E904EB04ED04EF04F104F304F504F704F904FB04FD04FF05010503050505070509050B050D050F05110513051505170519051B051D051F0521052305250561-05871D00-1D2B1D62-1D771D79-1D9A1E011E031E051E071E091E0B1E0D1E0F1E111E131E151E171E191E1B1E1D1E1F1E211E231E251E271E291E2B1E2D1E2F1E311E331E351E371E391E3B1E3D1E3F1E411E431E451E471E491E4B1E4D1E4F1E511E531E551E571E591E5B1E5D1E5F1E611E631E651E671E691E6B1E6D1E6F1E711E731E751E771E791E7B1E7D1E7F1E811E831E851E871E891E8B1E8D1E8F1E911E931E95-1E9D1E9F1EA11EA31EA51EA71EA91EAB1EAD1EAF1EB11EB31EB51EB71EB91EBB1EBD1EBF1EC11EC31EC51EC71EC91ECB1ECD1ECF1ED11ED31ED51ED71ED91EDB1EDD1EDF1EE11EE31EE51EE71EE91EEB1EED1EEF1EF11EF31EF51EF71EF91EFB1EFD1EFF-1F071F10-1F151F20-1F271F30-1F371F40-1F451F50-1F571F60-1F671F70-1F7D1F80-1F871F90-1F971FA0-1FA71FB0-1FB41FB61FB71FBE1FC2-1FC41FC61FC71FD0-1FD31FD61FD71FE0-1FE71FF2-1FF41FF61FF7210A210E210F2113212F21342139213C213D2146-2149214E21842C30-2C5E2C612C652C662C682C6A2C6C2C712C732C742C76-2C7C2C812C832C852C872C892C8B2C8D2C8F2C912C932C952C972C992C9B2C9D2C9F2CA12CA32CA52CA72CA92CAB2CAD2CAF2CB12CB32CB52CB72CB92CBB2CBD2CBF2CC12CC32CC52CC72CC92CCB2CCD2CCF2CD12CD32CD52CD72CD92CDB2CDD2CDF2CE12CE32CE42CEC2CEE2D00-2D25A641A643A645A647A649A64BA64DA64FA651A653A655A657A659A65BA65DA65FA663A665A667A669A66BA66DA681A683A685A687A689A68BA68DA68FA691A693A695A697A723A725A727A729A72BA72DA72F-A731A733A735A737A739A73BA73DA73FA741A743A745A747A749A74BA74DA74FA751A753A755A757A759A75BA75DA75FA761A763A765A767A769A76BA76DA76FA771-A778A77AA77CA77FA781A783A785A787A78CFB00-FB06FB13-FB17FF41-FF5A",Lu:"0041-005A00C0-00D600D8-00DE01000102010401060108010A010C010E01100112011401160118011A011C011E01200122012401260128012A012C012E01300132013401360139013B013D013F0141014301450147014A014C014E01500152015401560158015A015C015E01600162016401660168016A016C016E017001720174017601780179017B017D018101820184018601870189-018B018E-0191019301940196-0198019C019D019F01A001A201A401A601A701A901AC01AE01AF01B1-01B301B501B701B801BC01C401C701CA01CD01CF01D101D301D501D701D901DB01DE01E001E201E401E601E801EA01EC01EE01F101F401F6-01F801FA01FC01FE02000202020402060208020A020C020E02100212021402160218021A021C021E02200222022402260228022A022C022E02300232023A023B023D023E02410243-02460248024A024C024E03700372037603860388-038A038C038E038F0391-03A103A3-03AB03CF03D2-03D403D803DA03DC03DE03E003E203E403E603E803EA03EC03EE03F403F703F903FA03FD-042F04600462046404660468046A046C046E04700472047404760478047A047C047E0480048A048C048E04900492049404960498049A049C049E04A004A204A404A604A804AA04AC04AE04B004B204B404B604B804BA04BC04BE04C004C104C304C504C704C904CB04CD04D004D204D404D604D804DA04DC04DE04E004E204E404E604E804EA04EC04EE04F004F204F404F604F804FA04FC04FE05000502050405060508050A050C050E05100512051405160518051A051C051E0520052205240531-055610A0-10C51E001E021E041E061E081E0A1E0C1E0E1E101E121E141E161E181E1A1E1C1E1E1E201E221E241E261E281E2A1E2C1E2E1E301E321E341E361E381E3A1E3C1E3E1E401E421E441E461E481E4A1E4C1E4E1E501E521E541E561E581E5A1E5C1E5E1E601E621E641E661E681E6A1E6C1E6E1E701E721E741E761E781E7A1E7C1E7E1E801E821E841E861E881E8A1E8C1E8E1E901E921E941E9E1EA01EA21EA41EA61EA81EAA1EAC1EAE1EB01EB21EB41EB61EB81EBA1EBC1EBE1EC01EC21EC41EC61EC81ECA1ECC1ECE1ED01ED21ED41ED61ED81EDA1EDC1EDE1EE01EE21EE41EE61EE81EEA1EEC1EEE1EF01EF21EF41EF61EF81EFA1EFC1EFE1F08-1F0F1F18-1F1D1F28-1F2F1F38-1F3F1F48-1F4D1F591F5B1F5D1F5F1F68-1F6F1FB8-1FBB1FC8-1FCB1FD8-1FDB1FE8-1FEC1FF8-1FFB21022107210B-210D2110-211221152119-211D212421262128212A-212D2130-2133213E213F214521832C00-2C2E2C602C62-2C642C672C692C6B2C6D-2C702C722C752C7E-2C802C822C842C862C882C8A2C8C2C8E2C902C922C942C962C982C9A2C9C2C9E2CA02CA22CA42CA62CA82CAA2CAC2CAE2CB02CB22CB42CB62CB82CBA2CBC2CBE2CC02CC22CC42CC62CC82CCA2CCC2CCE2CD02CD22CD42CD62CD82CDA2CDC2CDE2CE02CE22CEB2CEDA640A642A644A646A648A64AA64CA64EA650A652A654A656A658A65AA65CA65EA662A664A666A668A66AA66CA680A682A684A686A688A68AA68CA68EA690A692A694A696A722A724A726A728A72AA72CA72EA732A734A736A738A73AA73CA73EA740A742A744A746A748A74AA74CA74EA750A752A754A756A758A75AA75CA75EA760A762A764A766A768A76AA76CA76EA779A77BA77DA77EA780A782A784A786A78BFF21-FF3A",Lt:"01C501C801CB01F21F88-1F8F1F98-1F9F1FA8-1FAF1FBC1FCC1FFC",Lm:"02B0-02C102C6-02D102E0-02E402EC02EE0374037A0559064006E506E607F407F507FA081A0824082809710E460EC610FC17D718431AA71C78-1C7D1D2C-1D611D781D9B-1DBF2071207F2090-20942C7D2D6F2E2F30053031-3035303B309D309E30FC-30FEA015A4F8-A4FDA60CA67FA717-A71FA770A788A9CFAA70AADDFF70FF9EFF9F",Lo:"01BB01C0-01C3029405D0-05EA05F0-05F20621-063F0641-064A066E066F0671-06D306D506EE06EF06FA-06FC06FF07100712-072F074D-07A507B107CA-07EA0800-08150904-0939093D09500958-096109720979-097F0985-098C098F09900993-09A809AA-09B009B209B6-09B909BD09CE09DC09DD09DF-09E109F009F10A05-0A0A0A0F0A100A13-0A280A2A-0A300A320A330A350A360A380A390A59-0A5C0A5E0A72-0A740A85-0A8D0A8F-0A910A93-0AA80AAA-0AB00AB20AB30AB5-0AB90ABD0AD00AE00AE10B05-0B0C0B0F0B100B13-0B280B2A-0B300B320B330B35-0B390B3D0B5C0B5D0B5F-0B610B710B830B85-0B8A0B8E-0B900B92-0B950B990B9A0B9C0B9E0B9F0BA30BA40BA8-0BAA0BAE-0BB90BD00C05-0C0C0C0E-0C100C12-0C280C2A-0C330C35-0C390C3D0C580C590C600C610C85-0C8C0C8E-0C900C92-0CA80CAA-0CB30CB5-0CB90CBD0CDE0CE00CE10D05-0D0C0D0E-0D100D12-0D280D2A-0D390D3D0D600D610D7A-0D7F0D85-0D960D9A-0DB10DB3-0DBB0DBD0DC0-0DC60E01-0E300E320E330E40-0E450E810E820E840E870E880E8A0E8D0E94-0E970E99-0E9F0EA1-0EA30EA50EA70EAA0EAB0EAD-0EB00EB20EB30EBD0EC0-0EC40EDC0EDD0F000F40-0F470F49-0F6C0F88-0F8B1000-102A103F1050-1055105A-105D106110651066106E-10701075-1081108E10D0-10FA1100-1248124A-124D1250-12561258125A-125D1260-1288128A-128D1290-12B012B2-12B512B8-12BE12C012C2-12C512C8-12D612D8-13101312-13151318-135A1380-138F13A0-13F41401-166C166F-167F1681-169A16A0-16EA1700-170C170E-17111720-17311740-17511760-176C176E-17701780-17B317DC1820-18421844-18771880-18A818AA18B0-18F51900-191C1950-196D1970-19741980-19AB19C1-19C71A00-1A161A20-1A541B05-1B331B45-1B4B1B83-1BA01BAE1BAF1C00-1C231C4D-1C4F1C5A-1C771CE9-1CEC1CEE-1CF12135-21382D30-2D652D80-2D962DA0-2DA62DA8-2DAE2DB0-2DB62DB8-2DBE2DC0-2DC62DC8-2DCE2DD0-2DD62DD8-2DDE3006303C3041-3096309F30A1-30FA30FF3105-312D3131-318E31A0-31B731F0-31FF3400-4DB54E00-9FCBA000-A014A016-A48CA4D0-A4F7A500-A60BA610-A61FA62AA62BA66EA6A0-A6E5A7FB-A801A803-A805A807-A80AA80C-A822A840-A873A882-A8B3A8F2-A8F7A8FBA90A-A925A930-A946A960-A97CA984-A9B2AA00-AA28AA40-AA42AA44-AA4BAA60-AA6FAA71-AA76AA7AAA80-AAAFAAB1AAB5AAB6AAB9-AABDAAC0AAC2AADBAADCABC0-ABE2AC00-D7A3D7B0-D7C6D7CB-D7FBF900-FA2DFA30-FA6DFA70-FAD9FB1DFB1F-FB28FB2A-FB36FB38-FB3CFB3EFB40FB41FB43FB44FB46-FBB1FBD3-FD3DFD50-FD8FFD92-FDC7FDF0-FDFBFE70-FE74FE76-FEFCFF66-FF6FFF71-FF9DFFA0-FFBEFFC2-FFC7FFCA-FFCFFFD2-FFD7FFDA-FFDC",M:"0300-036F0483-04890591-05BD05BF05C105C205C405C505C70610-061A064B-065E067006D6-06DC06DE-06E406E706E806EA-06ED07110730-074A07A6-07B007EB-07F30816-0819081B-08230825-08270829-082D0900-0903093C093E-094E0951-0955096209630981-098309BC09BE-09C409C709C809CB-09CD09D709E209E30A01-0A030A3C0A3E-0A420A470A480A4B-0A4D0A510A700A710A750A81-0A830ABC0ABE-0AC50AC7-0AC90ACB-0ACD0AE20AE30B01-0B030B3C0B3E-0B440B470B480B4B-0B4D0B560B570B620B630B820BBE-0BC20BC6-0BC80BCA-0BCD0BD70C01-0C030C3E-0C440C46-0C480C4A-0C4D0C550C560C620C630C820C830CBC0CBE-0CC40CC6-0CC80CCA-0CCD0CD50CD60CE20CE30D020D030D3E-0D440D46-0D480D4A-0D4D0D570D620D630D820D830DCA0DCF-0DD40DD60DD8-0DDF0DF20DF30E310E34-0E3A0E47-0E4E0EB10EB4-0EB90EBB0EBC0EC8-0ECD0F180F190F350F370F390F3E0F3F0F71-0F840F860F870F90-0F970F99-0FBC0FC6102B-103E1056-1059105E-10601062-10641067-106D1071-10741082-108D108F109A-109D135F1712-17141732-1734175217531772177317B6-17D317DD180B-180D18A91920-192B1930-193B19B0-19C019C819C91A17-1A1B1A55-1A5E1A60-1A7C1A7F1B00-1B041B34-1B441B6B-1B731B80-1B821BA1-1BAA1C24-1C371CD0-1CD21CD4-1CE81CED1CF21DC0-1DE61DFD-1DFF20D0-20F02CEF-2CF12DE0-2DFF302A-302F3099309AA66F-A672A67CA67DA6F0A6F1A802A806A80BA823-A827A880A881A8B4-A8C4A8E0-A8F1A926-A92DA947-A953A980-A983A9B3-A9C0AA29-AA36AA43AA4CAA4DAA7BAAB0AAB2-AAB4AAB7AAB8AABEAABFAAC1ABE3-ABEAABECABEDFB1EFE00-FE0FFE20-FE26",Mn:"0300-036F0483-04870591-05BD05BF05C105C205C405C505C70610-061A064B-065E067006D6-06DC06DF-06E406E706E806EA-06ED07110730-074A07A6-07B007EB-07F30816-0819081B-08230825-08270829-082D0900-0902093C0941-0948094D0951-095509620963098109BC09C1-09C409CD09E209E30A010A020A3C0A410A420A470A480A4B-0A4D0A510A700A710A750A810A820ABC0AC1-0AC50AC70AC80ACD0AE20AE30B010B3C0B3F0B41-0B440B4D0B560B620B630B820BC00BCD0C3E-0C400C46-0C480C4A-0C4D0C550C560C620C630CBC0CBF0CC60CCC0CCD0CE20CE30D41-0D440D4D0D620D630DCA0DD2-0DD40DD60E310E34-0E3A0E47-0E4E0EB10EB4-0EB90EBB0EBC0EC8-0ECD0F180F190F350F370F390F71-0F7E0F80-0F840F860F870F90-0F970F99-0FBC0FC6102D-10301032-10371039103A103D103E10581059105E-10601071-1074108210851086108D109D135F1712-17141732-1734175217531772177317B7-17BD17C617C9-17D317DD180B-180D18A91920-19221927192819321939-193B1A171A181A561A58-1A5E1A601A621A65-1A6C1A73-1A7C1A7F1B00-1B031B341B36-1B3A1B3C1B421B6B-1B731B801B811BA2-1BA51BA81BA91C2C-1C331C361C371CD0-1CD21CD4-1CE01CE2-1CE81CED1DC0-1DE61DFD-1DFF20D0-20DC20E120E5-20F02CEF-2CF12DE0-2DFF302A-302F3099309AA66FA67CA67DA6F0A6F1A802A806A80BA825A826A8C4A8E0-A8F1A926-A92DA947-A951A980-A982A9B3A9B6-A9B9A9BCAA29-AA2EAA31AA32AA35AA36AA43AA4CAAB0AAB2-AAB4AAB7AAB8AABEAABFAAC1ABE5ABE8ABEDFB1EFE00-FE0FFE20-FE26",Mc:"0903093E-09400949-094C094E0982098309BE-09C009C709C809CB09CC09D70A030A3E-0A400A830ABE-0AC00AC90ACB0ACC0B020B030B3E0B400B470B480B4B0B4C0B570BBE0BBF0BC10BC20BC6-0BC80BCA-0BCC0BD70C01-0C030C41-0C440C820C830CBE0CC0-0CC40CC70CC80CCA0CCB0CD50CD60D020D030D3E-0D400D46-0D480D4A-0D4C0D570D820D830DCF-0DD10DD8-0DDF0DF20DF30F3E0F3F0F7F102B102C10311038103B103C105610571062-10641067-106D108310841087-108C108F109A-109C17B617BE-17C517C717C81923-19261929-192B193019311933-193819B0-19C019C819C91A19-1A1B1A551A571A611A631A641A6D-1A721B041B351B3B1B3D-1B411B431B441B821BA11BA61BA71BAA1C24-1C2B1C341C351CE11CF2A823A824A827A880A881A8B4-A8C3A952A953A983A9B4A9B5A9BAA9BBA9BD-A9C0AA2FAA30AA33AA34AA4DAA7BABE3ABE4ABE6ABE7ABE9ABEAABEC",Me:"0488048906DE20DD-20E020E2-20E4A670-A672",N:"0030-003900B200B300B900BC-00BE0660-066906F0-06F907C0-07C90966-096F09E6-09EF09F4-09F90A66-0A6F0AE6-0AEF0B66-0B6F0BE6-0BF20C66-0C6F0C78-0C7E0CE6-0CEF0D66-0D750E50-0E590ED0-0ED90F20-0F331040-10491090-10991369-137C16EE-16F017E0-17E917F0-17F91810-18191946-194F19D0-19DA1A80-1A891A90-1A991B50-1B591BB0-1BB91C40-1C491C50-1C5920702074-20792080-20892150-21822185-21892460-249B24EA-24FF2776-27932CFD30073021-30293038-303A3192-31953220-32293251-325F3280-328932B1-32BFA620-A629A6E6-A6EFA830-A835A8D0-A8D9A900-A909A9D0-A9D9AA50-AA59ABF0-ABF9FF10-FF19",Nd:"0030-00390660-066906F0-06F907C0-07C90966-096F09E6-09EF0A66-0A6F0AE6-0AEF0B66-0B6F0BE6-0BEF0C66-0C6F0CE6-0CEF0D66-0D6F0E50-0E590ED0-0ED90F20-0F291040-10491090-109917E0-17E91810-18191946-194F19D0-19DA1A80-1A891A90-1A991B50-1B591BB0-1BB91C40-1C491C50-1C59A620-A629A8D0-A8D9A900-A909A9D0-A9D9AA50-AA59ABF0-ABF9FF10-FF19",Nl:"16EE-16F02160-21822185-218830073021-30293038-303AA6E6-A6EF",No:"00B200B300B900BC-00BE09F4-09F90BF0-0BF20C78-0C7E0D70-0D750F2A-0F331369-137C17F0-17F920702074-20792080-20892150-215F21892460-249B24EA-24FF2776-27932CFD3192-31953220-32293251-325F3280-328932B1-32BFA830-A835",P:"0021-00230025-002A002C-002F003A003B003F0040005B-005D005F007B007D00A100AB00B700BB00BF037E0387055A-055F0589058A05BE05C005C305C605F305F40609060A060C060D061B061E061F066A-066D06D40700-070D07F7-07F90830-083E0964096509700DF40E4F0E5A0E5B0F04-0F120F3A-0F3D0F850FD0-0FD4104A-104F10FB1361-13681400166D166E169B169C16EB-16ED1735173617D4-17D617D8-17DA1800-180A1944194519DE19DF1A1E1A1F1AA0-1AA61AA8-1AAD1B5A-1B601C3B-1C3F1C7E1C7F1CD32010-20272030-20432045-20512053-205E207D207E208D208E2329232A2768-277527C527C627E6-27EF2983-299829D8-29DB29FC29FD2CF9-2CFC2CFE2CFF2E00-2E2E2E302E313001-30033008-30113014-301F3030303D30A030FBA4FEA4FFA60D-A60FA673A67EA6F2-A6F7A874-A877A8CEA8CFA8F8-A8FAA92EA92FA95FA9C1-A9CDA9DEA9DFAA5C-AA5FAADEAADFABEBFD3EFD3FFE10-FE19FE30-FE52FE54-FE61FE63FE68FE6AFE6BFF01-FF03FF05-FF0AFF0C-FF0FFF1AFF1BFF1FFF20FF3B-FF3DFF3FFF5BFF5DFF5F-FF65",Pd:"002D058A05BE140018062010-20152E172E1A301C303030A0FE31FE32FE58FE63FF0D",Ps:"0028005B007B0F3A0F3C169B201A201E2045207D208D23292768276A276C276E27702772277427C527E627E827EA27EC27EE2983298529872989298B298D298F299129932995299729D829DA29FC2E222E242E262E283008300A300C300E3010301430163018301A301DFD3EFE17FE35FE37FE39FE3BFE3DFE3FFE41FE43FE47FE59FE5BFE5DFF08FF3BFF5BFF5FFF62",Pe:"0029005D007D0F3B0F3D169C2046207E208E232A2769276B276D276F27712773277527C627E727E927EB27ED27EF298429862988298A298C298E2990299229942996299829D929DB29FD2E232E252E272E293009300B300D300F3011301530173019301B301E301FFD3FFE18FE36FE38FE3AFE3CFE3EFE40FE42FE44FE48FE5AFE5CFE5EFF09FF3DFF5DFF60FF63",Pi:"00AB2018201B201C201F20392E022E042E092E0C2E1C2E20",Pf:"00BB2019201D203A2E032E052E0A2E0D2E1D2E21",Pc:"005F203F20402054FE33FE34FE4D-FE4FFF3F",Po:"0021-00230025-0027002A002C002E002F003A003B003F0040005C00A100B700BF037E0387055A-055F058905C005C305C605F305F40609060A060C060D061B061E061F066A-066D06D40700-070D07F7-07F90830-083E0964096509700DF40E4F0E5A0E5B0F04-0F120F850FD0-0FD4104A-104F10FB1361-1368166D166E16EB-16ED1735173617D4-17D617D8-17DA1800-18051807-180A1944194519DE19DF1A1E1A1F1AA0-1AA61AA8-1AAD1B5A-1B601C3B-1C3F1C7E1C7F1CD3201620172020-20272030-2038203B-203E2041-20432047-205120532055-205E2CF9-2CFC2CFE2CFF2E002E012E06-2E082E0B2E0E-2E162E182E192E1B2E1E2E1F2E2A-2E2E2E302E313001-3003303D30FBA4FEA4FFA60D-A60FA673A67EA6F2-A6F7A874-A877A8CEA8CFA8F8-A8FAA92EA92FA95FA9C1-A9CDA9DEA9DFAA5C-AA5FAADEAADFABEBFE10-FE16FE19FE30FE45FE46FE49-FE4CFE50-FE52FE54-FE57FE5F-FE61FE68FE6AFE6BFF01-FF03FF05-FF07FF0AFF0CFF0EFF0FFF1AFF1BFF1FFF20FF3CFF61FF64FF65",S:"0024002B003C-003E005E0060007C007E00A2-00A900AC00AE-00B100B400B600B800D700F702C2-02C502D2-02DF02E5-02EB02ED02EF-02FF03750384038503F604820606-0608060B060E060F06E906FD06FE07F609F209F309FA09FB0AF10B700BF3-0BFA0C7F0CF10CF20D790E3F0F01-0F030F13-0F170F1A-0F1F0F340F360F380FBE-0FC50FC7-0FCC0FCE0FCF0FD5-0FD8109E109F13601390-139917DB194019E0-19FF1B61-1B6A1B74-1B7C1FBD1FBF-1FC11FCD-1FCF1FDD-1FDF1FED-1FEF1FFD1FFE20442052207A-207C208A-208C20A0-20B8210021012103-21062108210921142116-2118211E-2123212521272129212E213A213B2140-2144214A-214D214F2190-2328232B-23E82400-24262440-244A249C-24E92500-26CD26CF-26E126E326E8-26FF2701-27042706-2709270C-27272729-274B274D274F-27522756-275E2761-276727942798-27AF27B1-27BE27C0-27C427C7-27CA27CC27D0-27E527F0-29822999-29D729DC-29FB29FE-2B4C2B50-2B592CE5-2CEA2E80-2E992E9B-2EF32F00-2FD52FF0-2FFB300430123013302030363037303E303F309B309C319031913196-319F31C0-31E33200-321E322A-32503260-327F328A-32B032C0-32FE3300-33FF4DC0-4DFFA490-A4C6A700-A716A720A721A789A78AA828-A82BA836-A839AA77-AA79FB29FDFCFDFDFE62FE64-FE66FE69FF04FF0BFF1C-FF1EFF3EFF40FF5CFF5EFFE0-FFE6FFE8-FFEEFFFCFFFD",Sm:"002B003C-003E007C007E00AC00B100D700F703F60606-060820442052207A-207C208A-208C2140-2144214B2190-2194219A219B21A021A321A621AE21CE21CF21D221D421F4-22FF2308-230B23202321237C239B-23B323DC-23E125B725C125F8-25FF266F27C0-27C427C7-27CA27CC27D0-27E527F0-27FF2900-29822999-29D729DC-29FB29FE-2AFF2B30-2B442B47-2B4CFB29FE62FE64-FE66FF0BFF1C-FF1EFF5CFF5EFFE2FFE9-FFEC",Sc:"002400A2-00A5060B09F209F309FB0AF10BF90E3F17DB20A0-20B8A838FDFCFE69FF04FFE0FFE1FFE5FFE6",Sk:"005E006000A800AF00B400B802C2-02C502D2-02DF02E5-02EB02ED02EF-02FF0375038403851FBD1FBF-1FC11FCD-1FCF1FDD-1FDF1FED-1FEF1FFD1FFE309B309CA700-A716A720A721A789A78AFF3EFF40FFE3",So:"00A600A700A900AE00B000B60482060E060F06E906FD06FE07F609FA0B700BF3-0BF80BFA0C7F0CF10CF20D790F01-0F030F13-0F170F1A-0F1F0F340F360F380FBE-0FC50FC7-0FCC0FCE0FCF0FD5-0FD8109E109F13601390-1399194019E0-19FF1B61-1B6A1B74-1B7C210021012103-21062108210921142116-2118211E-2123212521272129212E213A213B214A214C214D214F2195-2199219C-219F21A121A221A421A521A7-21AD21AF-21CD21D021D121D321D5-21F32300-2307230C-231F2322-2328232B-237B237D-239A23B4-23DB23E2-23E82400-24262440-244A249C-24E92500-25B625B8-25C025C2-25F72600-266E2670-26CD26CF-26E126E326E8-26FF2701-27042706-2709270C-27272729-274B274D274F-27522756-275E2761-276727942798-27AF27B1-27BE2800-28FF2B00-2B2F2B452B462B50-2B592CE5-2CEA2E80-2E992E9B-2EF32F00-2FD52FF0-2FFB300430123013302030363037303E303F319031913196-319F31C0-31E33200-321E322A-32503260-327F328A-32B032C0-32FE3300-33FF4DC0-4DFFA490-A4C6A828-A82BA836A837A839AA77-AA79FDFDFFE4FFE8FFEDFFEEFFFCFFFD",Z:"002000A01680180E2000-200A20282029202F205F3000",Zs:"002000A01680180E2000-200A202F205F3000",Zl:"2028",Zp:"2029",C:"0000-001F007F-009F00AD03780379037F-0383038B038D03A20526-05300557055805600588058B-059005C8-05CF05EB-05EF05F5-0605061C061D0620065F06DD070E070F074B074C07B2-07BF07FB-07FF082E082F083F-08FF093A093B094F095609570973-097809800984098D098E0991099209A909B109B3-09B509BA09BB09C509C609C909CA09CF-09D609D8-09DB09DE09E409E509FC-0A000A040A0B-0A0E0A110A120A290A310A340A370A3A0A3B0A3D0A43-0A460A490A4A0A4E-0A500A52-0A580A5D0A5F-0A650A76-0A800A840A8E0A920AA90AB10AB40ABA0ABB0AC60ACA0ACE0ACF0AD1-0ADF0AE40AE50AF00AF2-0B000B040B0D0B0E0B110B120B290B310B340B3A0B3B0B450B460B490B4A0B4E-0B550B58-0B5B0B5E0B640B650B72-0B810B840B8B-0B8D0B910B96-0B980B9B0B9D0BA0-0BA20BA5-0BA70BAB-0BAD0BBA-0BBD0BC3-0BC50BC90BCE0BCF0BD1-0BD60BD8-0BE50BFB-0C000C040C0D0C110C290C340C3A-0C3C0C450C490C4E-0C540C570C5A-0C5F0C640C650C70-0C770C800C810C840C8D0C910CA90CB40CBA0CBB0CC50CC90CCE-0CD40CD7-0CDD0CDF0CE40CE50CF00CF3-0D010D040D0D0D110D290D3A-0D3C0D450D490D4E-0D560D58-0D5F0D640D650D76-0D780D800D810D840D97-0D990DB20DBC0DBE0DBF0DC7-0DC90DCB-0DCE0DD50DD70DE0-0DF10DF5-0E000E3B-0E3E0E5C-0E800E830E850E860E890E8B0E8C0E8E-0E930E980EA00EA40EA60EA80EA90EAC0EBA0EBE0EBF0EC50EC70ECE0ECF0EDA0EDB0EDE-0EFF0F480F6D-0F700F8C-0F8F0F980FBD0FCD0FD9-0FFF10C6-10CF10FD-10FF1249124E124F12571259125E125F1289128E128F12B112B612B712BF12C112C612C712D7131113161317135B-135E137D-137F139A-139F13F5-13FF169D-169F16F1-16FF170D1715-171F1737-173F1754-175F176D17711774-177F17B417B517DE17DF17EA-17EF17FA-17FF180F181A-181F1878-187F18AB-18AF18F6-18FF191D-191F192C-192F193C-193F1941-1943196E196F1975-197F19AC-19AF19CA-19CF19DB-19DD1A1C1A1D1A5F1A7D1A7E1A8A-1A8F1A9A-1A9F1AAE-1AFF1B4C-1B4F1B7D-1B7F1BAB-1BAD1BBA-1BFF1C38-1C3A1C4A-1C4C1C80-1CCF1CF3-1CFF1DE7-1DFC1F161F171F1E1F1F1F461F471F4E1F4F1F581F5A1F5C1F5E1F7E1F7F1FB51FC51FD41FD51FDC1FF01FF11FF51FFF200B-200F202A-202E2060-206F20722073208F2095-209F20B9-20CF20F1-20FF218A-218F23E9-23FF2427-243F244B-245F26CE26E226E4-26E727002705270A270B2728274C274E2753-2755275F27602795-279727B027BF27CB27CD-27CF2B4D-2B4F2B5A-2BFF2C2F2C5F2CF2-2CF82D26-2D2F2D66-2D6E2D70-2D7F2D97-2D9F2DA72DAF2DB72DBF2DC72DCF2DD72DDF2E32-2E7F2E9A2EF4-2EFF2FD6-2FEF2FFC-2FFF3040309730983100-3104312E-3130318F31B8-31BF31E4-31EF321F32FF4DB6-4DBF9FCC-9FFFA48D-A48FA4C7-A4CFA62C-A63FA660A661A674-A67BA698-A69FA6F8-A6FFA78D-A7FAA82C-A82FA83A-A83FA878-A87FA8C5-A8CDA8DA-A8DFA8FC-A8FFA954-A95EA97D-A97FA9CEA9DA-A9DDA9E0-A9FFAA37-AA3FAA4EAA4FAA5AAA5BAA7C-AA7FAAC3-AADAAAE0-ABBFABEEABEFABFA-ABFFD7A4-D7AFD7C7-D7CAD7FC-F8FFFA2EFA2FFA6EFA6FFADA-FAFFFB07-FB12FB18-FB1CFB37FB3DFB3FFB42FB45FBB2-FBD2FD40-FD4FFD90FD91FDC8-FDEFFDFEFDFFFE1A-FE1FFE27-FE2FFE53FE67FE6C-FE6FFE75FEFD-FF00FFBF-FFC1FFC8FFC9FFD0FFD1FFD8FFD9FFDD-FFDFFFE7FFEF-FFFBFFFEFFFF",Cc:"0000-001F007F-009F",Cf:"00AD0600-060306DD070F17B417B5200B-200F202A-202E2060-2064206A-206FFEFFFFF9-FFFB",Co:"E000-F8FF",Cs:"D800-DFFF",Cn:"03780379037F-0383038B038D03A20526-05300557055805600588058B-059005C8-05CF05EB-05EF05F5-05FF06040605061C061D0620065F070E074B074C07B2-07BF07FB-07FF082E082F083F-08FF093A093B094F095609570973-097809800984098D098E0991099209A909B109B3-09B509BA09BB09C509C609C909CA09CF-09D609D8-09DB09DE09E409E509FC-0A000A040A0B-0A0E0A110A120A290A310A340A370A3A0A3B0A3D0A43-0A460A490A4A0A4E-0A500A52-0A580A5D0A5F-0A650A76-0A800A840A8E0A920AA90AB10AB40ABA0ABB0AC60ACA0ACE0ACF0AD1-0ADF0AE40AE50AF00AF2-0B000B040B0D0B0E0B110B120B290B310B340B3A0B3B0B450B460B490B4A0B4E-0B550B58-0B5B0B5E0B640B650B72-0B810B840B8B-0B8D0B910B96-0B980B9B0B9D0BA0-0BA20BA5-0BA70BAB-0BAD0BBA-0BBD0BC3-0BC50BC90BCE0BCF0BD1-0BD60BD8-0BE50BFB-0C000C040C0D0C110C290C340C3A-0C3C0C450C490C4E-0C540C570C5A-0C5F0C640C650C70-0C770C800C810C840C8D0C910CA90CB40CBA0CBB0CC50CC90CCE-0CD40CD7-0CDD0CDF0CE40CE50CF00CF3-0D010D040D0D0D110D290D3A-0D3C0D450D490D4E-0D560D58-0D5F0D640D650D76-0D780D800D810D840D97-0D990DB20DBC0DBE0DBF0DC7-0DC90DCB-0DCE0DD50DD70DE0-0DF10DF5-0E000E3B-0E3E0E5C-0E800E830E850E860E890E8B0E8C0E8E-0E930E980EA00EA40EA60EA80EA90EAC0EBA0EBE0EBF0EC50EC70ECE0ECF0EDA0EDB0EDE-0EFF0F480F6D-0F700F8C-0F8F0F980FBD0FCD0FD9-0FFF10C6-10CF10FD-10FF1249124E124F12571259125E125F1289128E128F12B112B612B712BF12C112C612C712D7131113161317135B-135E137D-137F139A-139F13F5-13FF169D-169F16F1-16FF170D1715-171F1737-173F1754-175F176D17711774-177F17DE17DF17EA-17EF17FA-17FF180F181A-181F1878-187F18AB-18AF18F6-18FF191D-191F192C-192F193C-193F1941-1943196E196F1975-197F19AC-19AF19CA-19CF19DB-19DD1A1C1A1D1A5F1A7D1A7E1A8A-1A8F1A9A-1A9F1AAE-1AFF1B4C-1B4F1B7D-1B7F1BAB-1BAD1BBA-1BFF1C38-1C3A1C4A-1C4C1C80-1CCF1CF3-1CFF1DE7-1DFC1F161F171F1E1F1F1F461F471F4E1F4F1F581F5A1F5C1F5E1F7E1F7F1FB51FC51FD41FD51FDC1FF01FF11FF51FFF2065-206920722073208F2095-209F20B9-20CF20F1-20FF218A-218F23E9-23FF2427-243F244B-245F26CE26E226E4-26E727002705270A270B2728274C274E2753-2755275F27602795-279727B027BF27CB27CD-27CF2B4D-2B4F2B5A-2BFF2C2F2C5F2CF2-2CF82D26-2D2F2D66-2D6E2D70-2D7F2D97-2D9F2DA72DAF2DB72DBF2DC72DCF2DD72DDF2E32-2E7F2E9A2EF4-2EFF2FD6-2FEF2FFC-2FFF3040309730983100-3104312E-3130318F31B8-31BF31E4-31EF321F32FF4DB6-4DBF9FCC-9FFFA48D-A48FA4C7-A4CFA62C-A63FA660A661A674-A67BA698-A69FA6F8-A6FFA78D-A7FAA82C-A82FA83A-A83FA878-A87FA8C5-A8CDA8DA-A8DFA8FC-A8FFA954-A95EA97D-A97FA9CEA9DA-A9DDA9E0-A9FFAA37-AA3FAA4EAA4FAA5AAA5BAA7C-AA7FAAC3-AADAAAE0-ABBFABEEABEFABFA-ABFFD7A4-D7AFD7C7-D7CAD7FC-D7FFFA2EFA2FFA6EFA6FFADA-FAFFFB07-FB12FB18-FB1CFB37FB3DFB3FFB42FB45FBB2-FBD2FD40-FD4FFD90FD91FDC8-FDEFFDFEFDFFFE1A-FE1FFE27-FE2FFE53FE67FE6C-FE6FFE75FEFDFEFEFF00FFBF-FFC1FFC8FFC9FFD0FFD1FFD8FFD9FFDD-FFDFFFE7FFEF-FFF8FFFEFFFF"});function addUnicodePackage(pack){var codePoint=/\w{4}/g;for(var name in pack)exports.packages[name]=pack[name].replace(codePoint,"\\u$&")}}));ace.define("ace/mode/text",["require","exports","module","ace/tokenizer","ace/mode/text_highlight_rules","ace/mode/behaviour/cstyle","ace/unicode","ace/lib/lang","ace/token_iterator","ace/range"],(function(acequire,exports,module){"use strict";var Tokenizer=acequire("../tokenizer").Tokenizer;var TextHighlightRules=acequire("./text_highlight_rules").TextHighlightRules;var CstyleBehaviour=acequire("./behaviour/cstyle").CstyleBehaviour;var unicode=acequire("../unicode");var lang=acequire("../lib/lang");var TokenIterator=acequire("../token_iterator").TokenIterator;var Range=acequire("../range").Range;var Mode=function(){this.HighlightRules=TextHighlightRules};(function(){this.$defaultBehaviour=new CstyleBehaviour;this.tokenRe=new RegExp("^["+unicode.packages.L+unicode.packages.Mn+unicode.packages.Mc+unicode.packages.Nd+unicode.packages.Pc+"\\$_]+","g");this.nonTokenRe=new RegExp("^(?:[^"+unicode.packages.L+unicode.packages.Mn+unicode.packages.Mc+unicode.packages.Nd+unicode.packages.Pc+"\\$_]|\\s])+","g");this.getTokenizer=function(){if(!this.$tokenizer){this.$highlightRules=this.$highlightRules||new this.HighlightRules(this.$highlightRuleConfig);this.$tokenizer=new Tokenizer(this.$highlightRules.getRules())}return this.$tokenizer};this.lineCommentStart="";this.blockComment="";this.toggleCommentLines=function(state,session,startRow,endRow){var doc=session.doc;var ignoreBlankLines=true;var shouldRemove=true;var minIndent=Infinity;var tabSize=session.getTabSize();var insertAtTabStop=false;if(!this.lineCommentStart){if(!this.blockComment)return false;var lineCommentStart=this.blockComment.start;var lineCommentEnd=this.blockComment.end;var regexpStart=new RegExp("^(\\s*)(?:"+lang.escapeRegExp(lineCommentStart)+")");var regexpEnd=new RegExp("(?:"+lang.escapeRegExp(lineCommentEnd)+")\\s*$");var comment=function(line,i){if(testRemove(line,i))return;if(!ignoreBlankLines||/\S/.test(line)){doc.insertInLine({row:i,column:line.length},lineCommentEnd);doc.insertInLine({row:i,column:minIndent},lineCommentStart)}};var uncomment=function(line,i){var m;if(m=line.match(regexpEnd))doc.removeInLine(i,line.length-m[0].length,line.length);if(m=line.match(regexpStart))doc.removeInLine(i,m[1].length,m[0].length)};var testRemove=function(line,row){if(regexpStart.test(line))return true;var tokens=session.getTokens(row);for(var i=0;i<tokens.length;i++){if(tokens[i].type==="comment")return true}}}else{if(Array.isArray(this.lineCommentStart)){var regexpStart=this.lineCommentStart.map(lang.escapeRegExp).join("|");var lineCommentStart=this.lineCommentStart[0]}else{var regexpStart=lang.escapeRegExp(this.lineCommentStart);var lineCommentStart=this.lineCommentStart}regexpStart=new RegExp("^(\\s*)(?:"+regexpStart+") ?");insertAtTabStop=session.getUseSoftTabs();var uncomment=function(line,i){var m=line.match(regexpStart);if(!m)return;var start=m[1].length,end=m[0].length;if(!shouldInsertSpace(line,start,end)&&m[0][end-1]==" ")end--;doc.removeInLine(i,start,end)};var commentWithSpace=lineCommentStart+" ";var comment=function(line,i){if(!ignoreBlankLines||/\S/.test(line)){if(shouldInsertSpace(line,minIndent,minIndent))doc.insertInLine({row:i,column:minIndent},commentWithSpace);else doc.insertInLine({row:i,column:minIndent},lineCommentStart)}};var testRemove=function(line,i){return regexpStart.test(line)};var shouldInsertSpace=function(line,before,after){var spaces=0;while(before--&&line.charAt(before)==" ")spaces++;if(spaces%tabSize!=0)return false;var spaces=0;while(line.charAt(after++)==" ")spaces++;if(tabSize>2)return spaces%tabSize!=tabSize-1;else return spaces%tabSize==0;return true}}function iter(fun){for(var i=startRow;i<=endRow;i++)fun(doc.getLine(i),i)}var minEmptyLength=Infinity;iter((function(line,i){var indent=line.search(/\S/);if(indent!==-1){if(indent<minIndent)minIndent=indent;if(shouldRemove&&!testRemove(line,i))shouldRemove=false}else if(minEmptyLength>line.length){minEmptyLength=line.length}}));if(minIndent==Infinity){minIndent=minEmptyLength;ignoreBlankLines=false;shouldRemove=false}if(insertAtTabStop&&minIndent%tabSize!=0)minIndent=Math.floor(minIndent/tabSize)*tabSize;iter(shouldRemove?uncomment:comment)};this.toggleBlockComment=function(state,session,range,cursor){var comment=this.blockComment;if(!comment)return;if(!comment.start&&comment[0])comment=comment[0];var iterator=new TokenIterator(session,cursor.row,cursor.column);var token=iterator.getCurrentToken();var sel=session.selection;var initialRange=session.selection.toOrientedRange();var startRow,colDiff;if(token&&/comment/.test(token.type)){var startRange,endRange;while(token&&/comment/.test(token.type)){var i=token.value.indexOf(comment.start);if(i!=-1){var row=iterator.getCurrentTokenRow();var column=iterator.getCurrentTokenColumn()+i;startRange=new Range(row,column,row,column+comment.start.length);break}token=iterator.stepBackward()}var iterator=new TokenIterator(session,cursor.row,cursor.column);var token=iterator.getCurrentToken();while(token&&/comment/.test(token.type)){var i=token.value.indexOf(comment.end);if(i!=-1){var row=iterator.getCurrentTokenRow();var column=iterator.getCurrentTokenColumn()+i;endRange=new Range(row,column,row,column+comment.end.length);break}token=iterator.stepForward()}if(endRange)session.remove(endRange);if(startRange){session.remove(startRange);startRow=startRange.start.row;colDiff=-comment.start.length}}else{colDiff=comment.start.length;startRow=range.start.row;session.insert(range.end,comment.end);session.insert(range.start,comment.start)}if(initialRange.start.row==startRow)initialRange.start.column+=colDiff;if(initialRange.end.row==startRow)initialRange.end.column+=colDiff;session.selection.fromOrientedRange(initialRange)};this.getNextLineIndent=function(state,line,tab){return this.$getIndent(line)};this.checkOutdent=function(state,line,input){return false};this.autoOutdent=function(state,doc,row){};this.$getIndent=function(line){return line.match(/^\s*/)[0]};this.createWorker=function(session){return null};this.createModeDelegates=function(mapping){this.$embeds=[];this.$modes={};for(var i in mapping){if(mapping[i]){this.$embeds.push(i);this.$modes[i]=new mapping[i]}}var delegations=["toggleBlockComment","toggleCommentLines","getNextLineIndent","checkOutdent","autoOutdent","transformAction","getCompletions"];for(var i=0;i<delegations.length;i++){(function(scope){var functionName=delegations[i];var defaultHandler=scope[functionName];scope[delegations[i]]=function(){return this.$delegator(functionName,arguments,defaultHandler)}})(this)}};this.$delegator=function(method,args,defaultHandler){var state=args[0];if(typeof state!="string")state=state[0];for(var i=0;i<this.$embeds.length;i++){if(!this.$modes[this.$embeds[i]])continue;var split=state.split(this.$embeds[i]);if(!split[0]&&split[1]){args[0]=split[1];var mode=this.$modes[this.$embeds[i]];return mode[method].apply(mode,args)}}var ret=defaultHandler.apply(this,args);return defaultHandler?ret:undefined};this.transformAction=function(state,action,editor,session,param){if(this.$behaviour){var behaviours=this.$behaviour.getBehaviours();for(var key in behaviours){if(behaviours[key][action]){var ret=behaviours[key][action].apply(this,arguments);if(ret){return ret}}}}};this.getKeywords=function(append){if(!this.completionKeywords){var rules=this.$tokenizer.rules;var completionKeywords=[];for(var rule in rules){var ruleItr=rules[rule];for(var r=0,l=ruleItr.length;r<l;r++){if(typeof ruleItr[r].token==="string"){if(/keyword|support|storage/.test(ruleItr[r].token))completionKeywords.push(ruleItr[r].regex)}else if(typeof ruleItr[r].token==="object"){for(var a=0,aLength=ruleItr[r].token.length;a<aLength;a++){if(/keyword|support|storage/.test(ruleItr[r].token[a])){var rule=ruleItr[r].regex.match(/\(.+?\)/g)[a];completionKeywords.push(rule.substr(1,rule.length-2))}}}}}this.completionKeywords=completionKeywords}if(!append)return this.$keywordList;return completionKeywords.concat(this.$keywordList||[])};this.$createKeywordList=function(){if(!this.$highlightRules)this.getTokenizer();return this.$keywordList=this.$highlightRules.$keywordList||[]};this.getCompletions=function(state,session,pos,prefix){var keywords=this.$keywordList||this.$createKeywordList();return keywords.map((function(word){return{name:word,value:word,score:0,meta:"keyword"}}))};this.$id="ace/mode/text"}).call(Mode.prototype);exports.Mode=Mode}));ace.define("ace/apply_delta",["require","exports","module"],(function(acequire,exports,module){"use strict";function throwDeltaError(delta,errorText){console.log("Invalid Delta:",delta);throw"Invalid Delta: "+errorText}function positionInDocument(docLines,position){return position.row>=0&&position.row<docLines.length&&position.column>=0&&position.column<=docLines[position.row].length}function validateDelta(docLines,delta){if(delta.action!="insert"&&delta.action!="remove")throwDeltaError(delta,"delta.action must be 'insert' or 'remove'");if(!(delta.lines instanceof Array))throwDeltaError(delta,"delta.lines must be an Array");if(!delta.start||!delta.end)throwDeltaError(delta,"delta.start/end must be an present");var start=delta.start;if(!positionInDocument(docLines,delta.start))throwDeltaError(delta,"delta.start must be contained in document");var end=delta.end;if(delta.action=="remove"&&!positionInDocument(docLines,end))throwDeltaError(delta,"delta.end must contained in document for 'remove' actions");var numRangeRows=end.row-start.row;var numRangeLastLineChars=end.column-(numRangeRows==0?start.column:0);if(numRangeRows!=delta.lines.length-1||delta.lines[numRangeRows].length!=numRangeLastLineChars)throwDeltaError(delta,"delta.range must match delta lines")}exports.applyDelta=function(docLines,delta,doNotValidate){var row=delta.start.row;var startColumn=delta.start.column;var line=docLines[row]||"";switch(delta.action){case"insert":var lines=delta.lines;if(lines.length===1){docLines[row]=line.substring(0,startColumn)+delta.lines[0]+line.substring(startColumn)}else{var args=[row,1].concat(delta.lines);docLines.splice.apply(docLines,args);docLines[row]=line.substring(0,startColumn)+docLines[row];docLines[row+delta.lines.length-1]+=line.substring(startColumn)}break;case"remove":var endColumn=delta.end.column;var endRow=delta.end.row;if(row===endRow){docLines[row]=line.substring(0,startColumn)+line.substring(endColumn)}else{docLines.splice(row,endRow-row+1,line.substring(0,startColumn)+docLines[endRow].substring(endColumn))}break}}}));ace.define("ace/anchor",["require","exports","module","ace/lib/oop","ace/lib/event_emitter"],(function(acequire,exports,module){"use strict";var oop=acequire("./lib/oop");var EventEmitter=acequire("./lib/event_emitter").EventEmitter;var Anchor=exports.Anchor=function(doc,row,column){this.$onChange=this.onChange.bind(this);this.attach(doc);if(typeof column=="undefined")this.setPosition(row.row,row.column);else this.setPosition(row,column)};(function(){oop.implement(this,EventEmitter);this.getPosition=function(){return this.$clipPositionToDocument(this.row,this.column)};this.getDocument=function(){return this.document};this.$insertRight=false;this.onChange=function(delta){if(delta.start.row==delta.end.row&&delta.start.row!=this.row)return;if(delta.start.row>this.row)return;var point=$getTransformedPoint(delta,{row:this.row,column:this.column},this.$insertRight);this.setPosition(point.row,point.column,true)};function $pointsInOrder(point1,point2,equalPointsInOrder){var bColIsAfter=equalPointsInOrder?point1.column<=point2.column:point1.column<point2.column;return point1.row<point2.row||point1.row==point2.row&&bColIsAfter}function $getTransformedPoint(delta,point,moveIfEqual){var deltaIsInsert=delta.action=="insert";var deltaRowShift=(deltaIsInsert?1:-1)*(delta.end.row-delta.start.row);var deltaColShift=(deltaIsInsert?1:-1)*(delta.end.column-delta.start.column);var deltaStart=delta.start;var deltaEnd=deltaIsInsert?deltaStart:delta.end;if($pointsInOrder(point,deltaStart,moveIfEqual)){return{row:point.row,column:point.column}}if($pointsInOrder(deltaEnd,point,!moveIfEqual)){return{row:point.row+deltaRowShift,column:point.column+(point.row==deltaEnd.row?deltaColShift:0)}}return{row:deltaStart.row,column:deltaStart.column}}this.setPosition=function(row,column,noClip){var pos;if(noClip){pos={row:row,column:column}}else{pos=this.$clipPositionToDocument(row,column)}if(this.row==pos.row&&this.column==pos.column)return;var old={row:this.row,column:this.column};this.row=pos.row;this.column=pos.column;this._signal("change",{old:old,value:pos})};this.detach=function(){this.document.removeEventListener("change",this.$onChange)};this.attach=function(doc){this.document=doc||this.document;this.document.on("change",this.$onChange)};this.$clipPositionToDocument=function(row,column){var pos={};if(row>=this.document.getLength()){pos.row=Math.max(0,this.document.getLength()-1);pos.column=this.document.getLine(pos.row).length}else if(row<0){pos.row=0;pos.column=0}else{pos.row=row;pos.column=Math.min(this.document.getLine(pos.row).length,Math.max(0,column))}if(column<0)pos.column=0;return pos}}).call(Anchor.prototype)}));ace.define("ace/document",["require","exports","module","ace/lib/oop","ace/apply_delta","ace/lib/event_emitter","ace/range","ace/anchor"],(function(acequire,exports,module){"use strict";var oop=acequire("./lib/oop");var applyDelta=acequire("./apply_delta").applyDelta;var EventEmitter=acequire("./lib/event_emitter").EventEmitter;var Range=acequire("./range").Range;var Anchor=acequire("./anchor").Anchor;var Document=function(textOrLines){this.$lines=[""];if(textOrLines.length===0){this.$lines=[""]}else if(Array.isArray(textOrLines)){this.insertMergedLines({row:0,column:0},textOrLines)}else{this.insert({row:0,column:0},textOrLines)}};(function(){oop.implement(this,EventEmitter);this.setValue=function(text){var len=this.getLength()-1;this.remove(new Range(0,0,len,this.getLine(len).length));this.insert({row:0,column:0},text)};this.getValue=function(){return this.getAllLines().join(this.getNewLineCharacter())};this.createAnchor=function(row,column){return new Anchor(this,row,column)};if("aaa".split(/a/).length===0){this.$split=function(text){return text.replace(/\r\n|\r/g,"\n").split("\n")}}else{this.$split=function(text){return text.split(/\r\n|\r|\n/)}}this.$detectNewLine=function(text){var match=text.match(/^.*?(\r\n|\r|\n)/m);this.$autoNewLine=match?match[1]:"\n";this._signal("changeNewLineMode")};this.getNewLineCharacter=function(){switch(this.$newLineMode){case"windows":return"\r\n";case"unix":return"\n";default:return this.$autoNewLine||"\n"}};this.$autoNewLine="";this.$newLineMode="auto";this.setNewLineMode=function(newLineMode){if(this.$newLineMode===newLineMode)return;this.$newLineMode=newLineMode;this._signal("changeNewLineMode")};this.getNewLineMode=function(){return this.$newLineMode};this.isNewLine=function(text){return text=="\r\n"||text=="\r"||text=="\n"};this.getLine=function(row){return this.$lines[row]||""};this.getLines=function(firstRow,lastRow){return this.$lines.slice(firstRow,lastRow+1)};this.getAllLines=function(){return this.getLines(0,this.getLength())};this.getLength=function(){return this.$lines.length};this.getTextRange=function(range){return this.getLinesForRange(range).join(this.getNewLineCharacter())};this.getLinesForRange=function(range){var lines;if(range.start.row===range.end.row){lines=[this.getLine(range.start.row).substring(range.start.column,range.end.column)]}else{lines=this.getLines(range.start.row,range.end.row);lines[0]=(lines[0]||"").substring(range.start.column);var l=lines.length-1;if(range.end.row-range.start.row==l)lines[l]=lines[l].substring(0,range.end.column)}return lines};this.insertLines=function(row,lines){console.warn("Use of document.insertLines is deprecated. Use the insertFullLines method instead.");return this.insertFullLines(row,lines)};this.removeLines=function(firstRow,lastRow){console.warn("Use of document.removeLines is deprecated. Use the removeFullLines method instead.");return this.removeFullLines(firstRow,lastRow)};this.insertNewLine=function(position){console.warn("Use of document.insertNewLine is deprecated. Use insertMergedLines(position, ['', '']) instead.");return this.insertMergedLines(position,["",""])};this.insert=function(position,text){if(this.getLength()<=1)this.$detectNewLine(text);return this.insertMergedLines(position,this.$split(text))};this.insertInLine=function(position,text){var start=this.clippedPos(position.row,position.column);var end=this.pos(position.row,position.column+text.length);this.applyDelta({start:start,end:end,action:"insert",lines:[text]},true);return this.clonePos(end)};this.clippedPos=function(row,column){var length=this.getLength();if(row===undefined){row=length}else if(row<0){row=0}else if(row>=length){row=length-1;column=undefined}var line=this.getLine(row);if(column==undefined)column=line.length;column=Math.min(Math.max(column,0),line.length);return{row:row,column:column}};this.clonePos=function(pos){return{row:pos.row,column:pos.column}};this.pos=function(row,column){return{row:row,column:column}};this.$clipPosition=function(position){var length=this.getLength();if(position.row>=length){position.row=Math.max(0,length-1);position.column=this.getLine(length-1).length}else{position.row=Math.max(0,position.row);position.column=Math.min(Math.max(position.column,0),this.getLine(position.row).length)}return position};this.insertFullLines=function(row,lines){row=Math.min(Math.max(row,0),this.getLength());var column=0;if(row<this.getLength()){lines=lines.concat([""]);column=0}else{lines=[""].concat(lines);row--;column=this.$lines[row].length}this.insertMergedLines({row:row,column:column},lines)};this.insertMergedLines=function(position,lines){var start=this.clippedPos(position.row,position.column);var end={row:start.row+lines.length-1,column:(lines.length==1?start.column:0)+lines[lines.length-1].length};this.applyDelta({start:start,end:end,action:"insert",lines:lines});return this.clonePos(end)};this.remove=function(range){var start=this.clippedPos(range.start.row,range.start.column);var end=this.clippedPos(range.end.row,range.end.column);this.applyDelta({start:start,end:end,action:"remove",lines:this.getLinesForRange({start:start,end:end})});return this.clonePos(start)};this.removeInLine=function(row,startColumn,endColumn){var start=this.clippedPos(row,startColumn);var end=this.clippedPos(row,endColumn);this.applyDelta({start:start,end:end,action:"remove",lines:this.getLinesForRange({start:start,end:end})},true);return this.clonePos(start)};this.removeFullLines=function(firstRow,lastRow){firstRow=Math.min(Math.max(0,firstRow),this.getLength()-1);lastRow=Math.min(Math.max(0,lastRow),this.getLength()-1);var deleteFirstNewLine=lastRow==this.getLength()-1&&firstRow>0;var deleteLastNewLine=lastRow<this.getLength()-1;var startRow=deleteFirstNewLine?firstRow-1:firstRow;var startCol=deleteFirstNewLine?this.getLine(startRow).length:0;var endRow=deleteLastNewLine?lastRow+1:lastRow;var endCol=deleteLastNewLine?0:this.getLine(endRow).length;var range=new Range(startRow,startCol,endRow,endCol);var deletedLines=this.$lines.slice(firstRow,lastRow+1);this.applyDelta({start:range.start,end:range.end,action:"remove",lines:this.getLinesForRange(range)});return deletedLines};this.removeNewLine=function(row){if(row<this.getLength()-1&&row>=0){this.applyDelta({start:this.pos(row,this.getLine(row).length),end:this.pos(row+1,0),action:"remove",lines:["",""]})}};this.replace=function(range,text){if(!(range instanceof Range))range=Range.fromPoints(range.start,range.end);if(text.length===0&&range.isEmpty())return range.start;if(text==this.getTextRange(range))return range.end;this.remove(range);var end;if(text){end=this.insert(range.start,text)}else{end=range.start}return end};this.applyDeltas=function(deltas){for(var i=0;i<deltas.length;i++){this.applyDelta(deltas[i])}};this.revertDeltas=function(deltas){for(var i=deltas.length-1;i>=0;i--){this.revertDelta(deltas[i])}};this.applyDelta=function(delta,doNotValidate){var isInsert=delta.action=="insert";if(isInsert?delta.lines.length<=1&&!delta.lines[0]:!Range.comparePoints(delta.start,delta.end)){return}if(isInsert&&delta.lines.length>2e4)this.$splitAndapplyLargeDelta(delta,2e4);applyDelta(this.$lines,delta,doNotValidate);this._signal("change",delta)};this.$splitAndapplyLargeDelta=function(delta,MAX){var lines=delta.lines;var l=lines.length;var row=delta.start.row;var column=delta.start.column;var from=0,to=0;do{from=to;to+=MAX-1;var chunk=lines.slice(from,to);if(to>l){delta.lines=chunk;delta.start.row=row+from;delta.start.column=column;break}chunk.push("");this.applyDelta({start:this.pos(row+from,column),end:this.pos(row+to,column=0),action:delta.action,lines:chunk},true)}while(true)};this.revertDelta=function(delta){this.applyDelta({start:this.clonePos(delta.start),end:this.clonePos(delta.end),action:delta.action=="insert"?"remove":"insert",lines:delta.lines.slice()})};this.indexToPosition=function(index,startRow){var lines=this.$lines||this.getAllLines();var newlineLength=this.getNewLineCharacter().length;for(var i=startRow||0,l=lines.length;i<l;i++){index-=lines[i].length+newlineLength;if(index<0)return{row:i,column:index+lines[i].length+newlineLength}}return{row:l-1,column:lines[l-1].length}};this.positionToIndex=function(pos,startRow){var lines=this.$lines||this.getAllLines();var newlineLength=this.getNewLineCharacter().length;var index=0;var row=Math.min(pos.row,lines.length);for(var i=startRow||0;i<row;++i)index+=lines[i].length+newlineLength;return index+pos.column}}).call(Document.prototype);exports.Document=Document}));ace.define("ace/background_tokenizer",["require","exports","module","ace/lib/oop","ace/lib/event_emitter"],(function(acequire,exports,module){"use strict";var oop=acequire("./lib/oop");var EventEmitter=acequire("./lib/event_emitter").EventEmitter;var BackgroundTokenizer=function(tokenizer,editor){this.running=false;this.lines=[];this.states=[];this.currentLine=0;this.tokenizer=tokenizer;var self=this;this.$worker=function(){if(!self.running){return}var workerStart=new Date;var currentLine=self.currentLine;var endLine=-1;var doc=self.doc;var startLine=currentLine;while(self.lines[currentLine])currentLine++;var len=doc.getLength();var processedLines=0;self.running=false;while(currentLine<len){self.$tokenizeRow(currentLine);endLine=currentLine;do{currentLine++}while(self.lines[currentLine]);processedLines++;if(processedLines%5===0&&new Date-workerStart>20){self.running=setTimeout(self.$worker,20);break}}self.currentLine=currentLine;if(endLine==-1)endLine=currentLine;if(startLine<=endLine)self.fireUpdateEvent(startLine,endLine)}};(function(){oop.implement(this,EventEmitter);this.setTokenizer=function(tokenizer){this.tokenizer=tokenizer;this.lines=[];this.states=[];this.start(0)};this.setDocument=function(doc){this.doc=doc;this.lines=[];this.states=[];this.stop()};this.fireUpdateEvent=function(firstRow,lastRow){var data={first:firstRow,last:lastRow};this._signal("update",{data:data})};this.start=function(startRow){this.currentLine=Math.min(startRow||0,this.currentLine,this.doc.getLength());this.lines.splice(this.currentLine,this.lines.length);this.states.splice(this.currentLine,this.states.length);this.stop();this.running=setTimeout(this.$worker,700)};this.scheduleStart=function(){if(!this.running)this.running=setTimeout(this.$worker,700)};this.$updateOnChange=function(delta){var startRow=delta.start.row;var len=delta.end.row-startRow;if(len===0){this.lines[startRow]=null}else if(delta.action=="remove"){this.lines.splice(startRow,len+1,null);this.states.splice(startRow,len+1,null)}else{var args=Array(len+1);args.unshift(startRow,1);this.lines.splice.apply(this.lines,args);this.states.splice.apply(this.states,args)}this.currentLine=Math.min(startRow,this.currentLine,this.doc.getLength());this.stop()};this.stop=function(){if(this.running)clearTimeout(this.running);this.running=false};this.getTokens=function(row){return this.lines[row]||this.$tokenizeRow(row)};this.getState=function(row){if(this.currentLine==row)this.$tokenizeRow(row);return this.states[row]||"start"};this.$tokenizeRow=function(row){var line=this.doc.getLine(row);var state=this.states[row-1];var data=this.tokenizer.getLineTokens(line,state,row);if(this.states[row]+""!==data.state+""){this.states[row]=data.state;this.lines[row+1]=null;if(this.currentLine>row+1)this.currentLine=row+1}else if(this.currentLine==row){this.currentLine=row+1}return this.lines[row]=data.tokens}}).call(BackgroundTokenizer.prototype);exports.BackgroundTokenizer=BackgroundTokenizer}));ace.define("ace/search_highlight",["require","exports","module","ace/lib/lang","ace/lib/oop","ace/range"],(function(acequire,exports,module){"use strict";var lang=acequire("./lib/lang");var oop=acequire("./lib/oop");var Range=acequire("./range").Range;var SearchHighlight=function(regExp,clazz,type){this.setRegexp(regExp);this.clazz=clazz;this.type=type||"text"};(function(){this.MAX_RANGES=500;this.setRegexp=function(regExp){if(this.regExp+""==regExp+"")return;this.regExp=regExp;this.cache=[]};this.update=function(html,markerLayer,session,config){if(!this.regExp)return;var start=config.firstRow,end=config.lastRow;for(var i=start;i<=end;i++){var ranges=this.cache[i];if(ranges==null){ranges=lang.getMatchOffsets(session.getLine(i),this.regExp);if(ranges.length>this.MAX_RANGES)ranges=ranges.slice(0,this.MAX_RANGES);ranges=ranges.map((function(match){return new Range(i,match.offset,i,match.offset+match.length)}));this.cache[i]=ranges.length?ranges:""}for(var j=ranges.length;j--;){markerLayer.drawSingleLineMarker(html,ranges[j].toScreenRange(session),this.clazz,config)}}}}).call(SearchHighlight.prototype);exports.SearchHighlight=SearchHighlight}));ace.define("ace/edit_session/fold_line",["require","exports","module","ace/range"],(function(acequire,exports,module){"use strict";var Range=acequire("../range").Range;function FoldLine(foldData,folds){this.foldData=foldData;if(Array.isArray(folds)){this.folds=folds}else{folds=this.folds=[folds]}var last=folds[folds.length-1];this.range=new Range(folds[0].start.row,folds[0].start.column,last.end.row,last.end.column);this.start=this.range.start;this.end=this.range.end;this.folds.forEach((function(fold){fold.setFoldLine(this)}),this)}(function(){this.shiftRow=function(shift){this.start.row+=shift;this.end.row+=shift;this.folds.forEach((function(fold){fold.start.row+=shift;fold.end.row+=shift}))};this.addFold=function(fold){if(fold.sameRow){if(fold.start.row<this.startRow||fold.endRow>this.endRow){throw new Error("Can't add a fold to this FoldLine as it has no connection")}this.folds.push(fold);this.folds.sort((function(a,b){return-a.range.compareEnd(b.start.row,b.start.column)}));if(this.range.compareEnd(fold.start.row,fold.start.column)>0){this.end.row=fold.end.row;this.end.column=fold.end.column}else if(this.range.compareStart(fold.end.row,fold.end.column)<0){this.start.row=fold.start.row;this.start.column=fold.start.column}}else if(fold.start.row==this.end.row){this.folds.push(fold);this.end.row=fold.end.row;this.end.column=fold.end.column}else if(fold.end.row==this.start.row){this.folds.unshift(fold);this.start.row=fold.start.row;this.start.column=fold.start.column}else{throw new Error("Trying to add fold to FoldRow that doesn't have a matching row")}fold.foldLine=this};this.containsRow=function(row){return row>=this.start.row&&row<=this.end.row};this.walk=function(callback,endRow,endColumn){var lastEnd=0,folds=this.folds,fold,cmp,stop,isNewRow=true;if(endRow==null){endRow=this.end.row;endColumn=this.end.column}for(var i=0;i<folds.length;i++){fold=folds[i];cmp=fold.range.compareStart(endRow,endColumn);if(cmp==-1){callback(null,endRow,endColumn,lastEnd,isNewRow);return}stop=callback(null,fold.start.row,fold.start.column,lastEnd,isNewRow);stop=!stop&&callback(fold.placeholder,fold.start.row,fold.start.column,lastEnd);if(stop||cmp===0){return}isNewRow=!fold.sameRow;lastEnd=fold.end.column}callback(null,endRow,endColumn,lastEnd,isNewRow)};this.getNextFoldTo=function(row,column){var fold,cmp;for(var i=0;i<this.folds.length;i++){fold=this.folds[i];cmp=fold.range.compareEnd(row,column);if(cmp==-1){return{fold:fold,kind:"after"}}else if(cmp===0){return{fold:fold,kind:"inside"}}}return null};this.addRemoveChars=function(row,column,len){var ret=this.getNextFoldTo(row,column),fold,folds;if(ret){fold=ret.fold;if(ret.kind=="inside"&&fold.start.column!=column&&fold.start.row!=row){window.console&&window.console.log(row,column,fold)}else if(fold.start.row==row){folds=this.folds;var i=folds.indexOf(fold);if(i===0){this.start.column+=len}for(i;i<folds.length;i++){fold=folds[i];fold.start.column+=len;if(!fold.sameRow){return}fold.end.column+=len}this.end.column+=len}}};this.split=function(row,column){var pos=this.getNextFoldTo(row,column);if(!pos||pos.kind=="inside")return null;var fold=pos.fold;var folds=this.folds;var foldData=this.foldData;var i=folds.indexOf(fold);var foldBefore=folds[i-1];this.end.row=foldBefore.end.row;this.end.column=foldBefore.end.column;folds=folds.splice(i,folds.length-i);var newFoldLine=new FoldLine(foldData,folds);foldData.splice(foldData.indexOf(this)+1,0,newFoldLine);return newFoldLine};this.merge=function(foldLineNext){var folds=foldLineNext.folds;for(var i=0;i<folds.length;i++){this.addFold(folds[i])}var foldData=this.foldData;foldData.splice(foldData.indexOf(foldLineNext),1)};this.toString=function(){var ret=[this.range.toString()+": ["];this.folds.forEach((function(fold){ret.push("  "+fold.toString())}));ret.push("]");return ret.join("\n")};this.idxToPosition=function(idx){var lastFoldEndColumn=0;for(var i=0;i<this.folds.length;i++){var fold=this.folds[i];idx-=fold.start.column-lastFoldEndColumn;if(idx<0){return{row:fold.start.row,column:fold.start.column+idx}}idx-=fold.placeholder.length;if(idx<0){return fold.start}lastFoldEndColumn=fold.end.column}return{row:this.end.row,column:this.end.column+idx}}}).call(FoldLine.prototype);exports.FoldLine=FoldLine}));ace.define("ace/range_list",["require","exports","module","ace/range"],(function(acequire,exports,module){"use strict";var Range=acequire("./range").Range;var comparePoints=Range.comparePoints;var RangeList=function(){this.ranges=[]};(function(){this.comparePoints=comparePoints;this.pointIndex=function(pos,excludeEdges,startIndex){var list=this.ranges;for(var i=startIndex||0;i<list.length;i++){var range=list[i];var cmpEnd=comparePoints(pos,range.end);if(cmpEnd>0)continue;var cmpStart=comparePoints(pos,range.start);if(cmpEnd===0)return excludeEdges&&cmpStart!==0?-i-2:i;if(cmpStart>0||cmpStart===0&&!excludeEdges)return i;return-i-1}return-i-1};this.add=function(range){var excludeEdges=!range.isEmpty();var startIndex=this.pointIndex(range.start,excludeEdges);if(startIndex<0)startIndex=-startIndex-1;var endIndex=this.pointIndex(range.end,excludeEdges,startIndex);if(endIndex<0)endIndex=-endIndex-1;else endIndex++;return this.ranges.splice(startIndex,endIndex-startIndex,range)};this.addList=function(list){var removed=[];for(var i=list.length;i--;){removed.push.apply(removed,this.add(list[i]))}return removed};this.substractPoint=function(pos){var i=this.pointIndex(pos);if(i>=0)return this.ranges.splice(i,1)};this.merge=function(){var removed=[];var list=this.ranges;list=list.sort((function(a,b){return comparePoints(a.start,b.start)}));var next=list[0],range;for(var i=1;i<list.length;i++){range=next;next=list[i];var cmp=comparePoints(range.end,next.start);if(cmp<0)continue;if(cmp==0&&!range.isEmpty()&&!next.isEmpty())continue;if(comparePoints(range.end,next.end)<0){range.end.row=next.end.row;range.end.column=next.end.column}list.splice(i,1);removed.push(next);next=range;i--}this.ranges=list;return removed};this.contains=function(row,column){return this.pointIndex({row:row,column:column})>=0};this.containsPoint=function(pos){return this.pointIndex(pos)>=0};this.rangeAtPoint=function(pos){var i=this.pointIndex(pos);if(i>=0)return this.ranges[i]};this.clipRows=function(startRow,endRow){var list=this.ranges;if(list[0].start.row>endRow||list[list.length-1].start.row<startRow)return[];var startIndex=this.pointIndex({row:startRow,column:0});if(startIndex<0)startIndex=-startIndex-1;var endIndex=this.pointIndex({row:endRow,column:0},startIndex);if(endIndex<0)endIndex=-endIndex-1;var clipped=[];for(var i=startIndex;i<endIndex;i++){clipped.push(list[i])}return clipped};this.removeAll=function(){return this.ranges.splice(0,this.ranges.length)};this.attach=function(session){if(this.session)this.detach();this.session=session;this.onChange=this.$onChange.bind(this);this.session.on("change",this.onChange)};this.detach=function(){if(!this.session)return;this.session.removeListener("change",this.onChange);this.session=null};this.$onChange=function(delta){if(delta.action=="insert"){var start=delta.start;var end=delta.end}else{var end=delta.start;var start=delta.end}var startRow=start.row;var endRow=end.row;var lineDif=endRow-startRow;var colDiff=-start.column+end.column;var ranges=this.ranges;for(var i=0,n=ranges.length;i<n;i++){var r=ranges[i];if(r.end.row<startRow)continue;if(r.start.row>startRow)break;if(r.start.row==startRow&&r.start.column>=start.column){if(r.start.column==start.column&&this.$insertRight){}else{r.start.column+=colDiff;r.start.row+=lineDif}}if(r.end.row==startRow&&r.end.column>=start.column){if(r.end.column==start.column&&this.$insertRight){continue}if(r.end.column==start.column&&colDiff>0&&i<n-1){if(r.end.column>r.start.column&&r.end.column==ranges[i+1].start.column)r.end.column-=colDiff}r.end.column+=colDiff;r.end.row+=lineDif}}if(lineDif!=0&&i<n){for(;i<n;i++){var r=ranges[i];r.start.row+=lineDif;r.end.row+=lineDif}}}}).call(RangeList.prototype);exports.RangeList=RangeList}));ace.define("ace/edit_session/fold",["require","exports","module","ace/range","ace/range_list","ace/lib/oop"],(function(acequire,exports,module){"use strict";var Range=acequire("../range").Range;var RangeList=acequire("../range_list").RangeList;var oop=acequire("../lib/oop");var Fold=exports.Fold=function(range,placeholder){this.foldLine=null;this.placeholder=placeholder;this.range=range;this.start=range.start;this.end=range.end;this.sameRow=range.start.row==range.end.row;this.subFolds=this.ranges=[]};oop.inherits(Fold,RangeList);(function(){this.toString=function(){return'"'+this.placeholder+'" '+this.range.toString()};this.setFoldLine=function(foldLine){this.foldLine=foldLine;this.subFolds.forEach((function(fold){fold.setFoldLine(foldLine)}))};this.clone=function(){var range=this.range.clone();var fold=new Fold(range,this.placeholder);this.subFolds.forEach((function(subFold){fold.subFolds.push(subFold.clone())}));fold.collapseChildren=this.collapseChildren;return fold};this.addSubFold=function(fold){if(this.range.isEqual(fold))return;if(!this.range.containsRange(fold))throw new Error("A fold can't intersect already existing fold"+fold.range+this.range);consumeRange(fold,this.start);var row=fold.start.row,column=fold.start.column;for(var i=0,cmp=-1;i<this.subFolds.length;i++){cmp=this.subFolds[i].range.compare(row,column);if(cmp!=1)break}var afterStart=this.subFolds[i];if(cmp==0)return afterStart.addSubFold(fold);var row=fold.range.end.row,column=fold.range.end.column;for(var j=i,cmp=-1;j<this.subFolds.length;j++){cmp=this.subFolds[j].range.compare(row,column);if(cmp!=1)break}var afterEnd=this.subFolds[j];if(cmp==0)throw new Error("A fold can't intersect already existing fold"+fold.range+this.range);var consumedFolds=this.subFolds.splice(i,j-i,fold);fold.setFoldLine(this.foldLine);return fold};this.restoreRange=function(range){return restoreRange(range,this.start)}}).call(Fold.prototype);function consumePoint(point,anchor){point.row-=anchor.row;if(point.row==0)point.column-=anchor.column}function consumeRange(range,anchor){consumePoint(range.start,anchor);consumePoint(range.end,anchor)}function restorePoint(point,anchor){if(point.row==0)point.column+=anchor.column;point.row+=anchor.row}function restoreRange(range,anchor){restorePoint(range.start,anchor);restorePoint(range.end,anchor)}}));ace.define("ace/edit_session/folding",["require","exports","module","ace/range","ace/edit_session/fold_line","ace/edit_session/fold","ace/token_iterator"],(function(acequire,exports,module){"use strict";var Range=acequire("../range").Range;var FoldLine=acequire("./fold_line").FoldLine;var Fold=acequire("./fold").Fold;var TokenIterator=acequire("../token_iterator").TokenIterator;function Folding(){this.getFoldAt=function(row,column,side){var foldLine=this.getFoldLine(row);if(!foldLine)return null;var folds=foldLine.folds;for(var i=0;i<folds.length;i++){var fold=folds[i];if(fold.range.contains(row,column)){if(side==1&&fold.range.isEnd(row,column)){continue}else if(side==-1&&fold.range.isStart(row,column)){continue}return fold}}};this.getFoldsInRange=function(range){var start=range.start;var end=range.end;var foldLines=this.$foldData;var foundFolds=[];start.column+=1;end.column-=1;for(var i=0;i<foldLines.length;i++){var cmp=foldLines[i].range.compareRange(range);if(cmp==2){continue}else if(cmp==-2){break}var folds=foldLines[i].folds;for(var j=0;j<folds.length;j++){var fold=folds[j];cmp=fold.range.compareRange(range);if(cmp==-2){break}else if(cmp==2){continue}else if(cmp==42){break}foundFolds.push(fold)}}start.column-=1;end.column+=1;return foundFolds};this.getFoldsInRangeList=function(ranges){if(Array.isArray(ranges)){var folds=[];ranges.forEach((function(range){folds=folds.concat(this.getFoldsInRange(range))}),this)}else{var folds=this.getFoldsInRange(ranges)}return folds};this.getAllFolds=function(){var folds=[];var foldLines=this.$foldData;for(var i=0;i<foldLines.length;i++)for(var j=0;j<foldLines[i].folds.length;j++)folds.push(foldLines[i].folds[j]);return folds};this.getFoldStringAt=function(row,column,trim,foldLine){foldLine=foldLine||this.getFoldLine(row);if(!foldLine)return null;var lastFold={end:{column:0}};var str,fold;for(var i=0;i<foldLine.folds.length;i++){fold=foldLine.folds[i];var cmp=fold.range.compareEnd(row,column);if(cmp==-1){str=this.getLine(fold.start.row).substring(lastFold.end.column,fold.start.column);break}else if(cmp===0){return null}lastFold=fold}if(!str)str=this.getLine(fold.start.row).substring(lastFold.end.column);if(trim==-1)return str.substring(0,column-lastFold.end.column);else if(trim==1)return str.substring(column-lastFold.end.column);else return str};this.getFoldLine=function(docRow,startFoldLine){var foldData=this.$foldData;var i=0;if(startFoldLine)i=foldData.indexOf(startFoldLine);if(i==-1)i=0;for(i;i<foldData.length;i++){var foldLine=foldData[i];if(foldLine.start.row<=docRow&&foldLine.end.row>=docRow){return foldLine}else if(foldLine.end.row>docRow){return null}}return null};this.getNextFoldLine=function(docRow,startFoldLine){var foldData=this.$foldData;var i=0;if(startFoldLine)i=foldData.indexOf(startFoldLine);if(i==-1)i=0;for(i;i<foldData.length;i++){var foldLine=foldData[i];if(foldLine.end.row>=docRow){return foldLine}}return null};this.getFoldedRowCount=function(first,last){var foldData=this.$foldData,rowCount=last-first+1;for(var i=0;i<foldData.length;i++){var foldLine=foldData[i],end=foldLine.end.row,start=foldLine.start.row;if(end>=last){if(start<last){if(start>=first)rowCount-=last-start;else rowCount=0}break}else if(end>=first){if(start>=first)rowCount-=end-start;else rowCount-=end-first+1}}return rowCount};this.$addFoldLine=function(foldLine){this.$foldData.push(foldLine);this.$foldData.sort((function(a,b){return a.start.row-b.start.row}));return foldLine};this.addFold=function(placeholder,range){var foldData=this.$foldData;var added=false;var fold;if(placeholder instanceof Fold)fold=placeholder;else{fold=new Fold(range,placeholder);fold.collapseChildren=range.collapseChildren}this.$clipRangeToDocument(fold.range);var startRow=fold.start.row;var startColumn=fold.start.column;var endRow=fold.end.row;var endColumn=fold.end.column;if(!(startRow<endRow||startRow==endRow&&startColumn<=endColumn-2))throw new Error("The range has to be at least 2 characters width");var startFold=this.getFoldAt(startRow,startColumn,1);var endFold=this.getFoldAt(endRow,endColumn,-1);if(startFold&&endFold==startFold)return startFold.addSubFold(fold);if(startFold&&!startFold.range.isStart(startRow,startColumn))this.removeFold(startFold);if(endFold&&!endFold.range.isEnd(endRow,endColumn))this.removeFold(endFold);var folds=this.getFoldsInRange(fold.range);if(folds.length>0){this.removeFolds(folds);folds.forEach((function(subFold){fold.addSubFold(subFold)}))}for(var i=0;i<foldData.length;i++){var foldLine=foldData[i];if(endRow==foldLine.start.row){foldLine.addFold(fold);added=true;break}else if(startRow==foldLine.end.row){foldLine.addFold(fold);added=true;if(!fold.sameRow){var foldLineNext=foldData[i+1];if(foldLineNext&&foldLineNext.start.row==endRow){foldLine.merge(foldLineNext);break}}break}else if(endRow<=foldLine.start.row){break}}if(!added)foldLine=this.$addFoldLine(new FoldLine(this.$foldData,fold));if(this.$useWrapMode)this.$updateWrapData(foldLine.start.row,foldLine.start.row);else this.$updateRowLengthCache(foldLine.start.row,foldLine.start.row);this.$modified=true;this._signal("changeFold",{data:fold,action:"add"});return fold};this.addFolds=function(folds){folds.forEach((function(fold){this.addFold(fold)}),this)};this.removeFold=function(fold){var foldLine=fold.foldLine;var startRow=foldLine.start.row;var endRow=foldLine.end.row;var foldLines=this.$foldData;var folds=foldLine.folds;if(folds.length==1){foldLines.splice(foldLines.indexOf(foldLine),1)}else if(foldLine.range.isEnd(fold.end.row,fold.end.column)){folds.pop();foldLine.end.row=folds[folds.length-1].end.row;foldLine.end.column=folds[folds.length-1].end.column}else if(foldLine.range.isStart(fold.start.row,fold.start.column)){folds.shift();foldLine.start.row=folds[0].start.row;foldLine.start.column=folds[0].start.column}else if(fold.sameRow){folds.splice(folds.indexOf(fold),1)}else{var newFoldLine=foldLine.split(fold.start.row,fold.start.column);folds=newFoldLine.folds;folds.shift();newFoldLine.start.row=folds[0].start.row;newFoldLine.start.column=folds[0].start.column}if(!this.$updating){if(this.$useWrapMode)this.$updateWrapData(startRow,endRow);else this.$updateRowLengthCache(startRow,endRow)}this.$modified=true;this._signal("changeFold",{data:fold,action:"remove"})};this.removeFolds=function(folds){var cloneFolds=[];for(var i=0;i<folds.length;i++){cloneFolds.push(folds[i])}cloneFolds.forEach((function(fold){this.removeFold(fold)}),this);this.$modified=true};this.expandFold=function(fold){this.removeFold(fold);fold.subFolds.forEach((function(subFold){fold.restoreRange(subFold);this.addFold(subFold)}),this);if(fold.collapseChildren>0){this.foldAll(fold.start.row+1,fold.end.row,fold.collapseChildren-1)}fold.subFolds=[]};this.expandFolds=function(folds){folds.forEach((function(fold){this.expandFold(fold)}),this)};this.unfold=function(location,expandInner){var range,folds;if(location==null){range=new Range(0,0,this.getLength(),0);expandInner=true}else if(typeof location=="number")range=new Range(location,0,location,this.getLine(location).length);else if("row"in location)range=Range.fromPoints(location,location);else range=location;folds=this.getFoldsInRangeList(range);if(expandInner){this.removeFolds(folds)}else{var subFolds=folds;while(subFolds.length){this.expandFolds(subFolds);subFolds=this.getFoldsInRangeList(range)}}if(folds.length)return folds};this.isRowFolded=function(docRow,startFoldRow){return!!this.getFoldLine(docRow,startFoldRow)};this.getRowFoldEnd=function(docRow,startFoldRow){var foldLine=this.getFoldLine(docRow,startFoldRow);return foldLine?foldLine.end.row:docRow};this.getRowFoldStart=function(docRow,startFoldRow){var foldLine=this.getFoldLine(docRow,startFoldRow);return foldLine?foldLine.start.row:docRow};this.getFoldDisplayLine=function(foldLine,endRow,endColumn,startRow,startColumn){if(startRow==null)startRow=foldLine.start.row;if(startColumn==null)startColumn=0;if(endRow==null)endRow=foldLine.end.row;if(endColumn==null)endColumn=this.getLine(endRow).length;var doc=this.doc;var textLine="";foldLine.walk((function(placeholder,row,column,lastColumn){if(row<startRow)return;if(row==startRow){if(column<startColumn)return;lastColumn=Math.max(startColumn,lastColumn)}if(placeholder!=null){textLine+=placeholder}else{textLine+=doc.getLine(row).substring(lastColumn,column)}}),endRow,endColumn);return textLine};this.getDisplayLine=function(row,endColumn,startRow,startColumn){var foldLine=this.getFoldLine(row);if(!foldLine){var line;line=this.doc.getLine(row);return line.substring(startColumn||0,endColumn||line.length)}else{return this.getFoldDisplayLine(foldLine,row,endColumn,startRow,startColumn)}};this.$cloneFoldData=function(){var fd=[];fd=this.$foldData.map((function(foldLine){var folds=foldLine.folds.map((function(fold){return fold.clone()}));return new FoldLine(fd,folds)}));return fd};this.toggleFold=function(tryToUnfold){var selection=this.selection;var range=selection.getRange();var fold;var bracketPos;if(range.isEmpty()){var cursor=range.start;fold=this.getFoldAt(cursor.row,cursor.column);if(fold){this.expandFold(fold);return}else if(bracketPos=this.findMatchingBracket(cursor)){if(range.comparePoint(bracketPos)==1){range.end=bracketPos}else{range.start=bracketPos;range.start.column++;range.end.column--}}else if(bracketPos=this.findMatchingBracket({row:cursor.row,column:cursor.column+1})){if(range.comparePoint(bracketPos)==1)range.end=bracketPos;else range.start=bracketPos;range.start.column++}else{range=this.getCommentFoldRange(cursor.row,cursor.column)||range}}else{var folds=this.getFoldsInRange(range);if(tryToUnfold&&folds.length){this.expandFolds(folds);return}else if(folds.length==1){fold=folds[0]}}if(!fold)fold=this.getFoldAt(range.start.row,range.start.column);if(fold&&fold.range.toString()==range.toString()){this.expandFold(fold);return}var placeholder="...";if(!range.isMultiLine()){placeholder=this.getTextRange(range);if(placeholder.length<4)return;placeholder=placeholder.trim().substring(0,2)+".."}this.addFold(placeholder,range)};this.getCommentFoldRange=function(row,column,dir){var iterator=new TokenIterator(this,row,column);var token=iterator.getCurrentToken();var type=token.type;if(token&&/^comment|string/.test(type)){type=type.match(/comment|string/)[0];if(type=="comment")type+="|doc-start";var re=new RegExp(type);var range=new Range;if(dir!=1){do{token=iterator.stepBackward()}while(token&&re.test(token.type));iterator.stepForward()}range.start.row=iterator.getCurrentTokenRow();range.start.column=iterator.getCurrentTokenColumn()+2;iterator=new TokenIterator(this,row,column);if(dir!=-1){var lastRow=-1;do{token=iterator.stepForward();if(lastRow==-1){var state=this.getState(iterator.$row);if(!re.test(state))lastRow=iterator.$row}else if(iterator.$row>lastRow){break}}while(token&&re.test(token.type));token=iterator.stepBackward()}else token=iterator.getCurrentToken();range.end.row=iterator.getCurrentTokenRow();range.end.column=iterator.getCurrentTokenColumn()+token.value.length-2;return range}};this.foldAll=function(startRow,endRow,depth){if(depth==undefined)depth=1e5;var foldWidgets=this.foldWidgets;if(!foldWidgets)return;endRow=endRow||this.getLength();startRow=startRow||0;for(var row=startRow;row<endRow;row++){if(foldWidgets[row]==null)foldWidgets[row]=this.getFoldWidget(row);if(foldWidgets[row]!="start")continue;var range=this.getFoldWidgetRange(row);if(range&&range.isMultiLine()&&range.end.row<=endRow&&range.start.row>=startRow){row=range.end.row;try{var fold=this.addFold("...",range);if(fold)fold.collapseChildren=depth}catch(e){}}}};this.$foldStyles={manual:1,markbegin:1,markbeginend:1};this.$foldStyle="markbegin";this.setFoldStyle=function(style){if(!this.$foldStyles[style])throw new Error("invalid fold style: "+style+"["+Object.keys(this.$foldStyles).join(", ")+"]");if(this.$foldStyle==style)return;this.$foldStyle=style;if(style=="manual")this.unfold();var mode=this.$foldMode;this.$setFolding(null);this.$setFolding(mode)};this.$setFolding=function(foldMode){if(this.$foldMode==foldMode)return;this.$foldMode=foldMode;this.off("change",this.$updateFoldWidgets);this.off("tokenizerUpdate",this.$tokenizerUpdateFoldWidgets);this._signal("changeAnnotation");if(!foldMode||this.$foldStyle=="manual"){this.foldWidgets=null;return}this.foldWidgets=[];this.getFoldWidget=foldMode.getFoldWidget.bind(foldMode,this,this.$foldStyle);this.getFoldWidgetRange=foldMode.getFoldWidgetRange.bind(foldMode,this,this.$foldStyle);this.$updateFoldWidgets=this.updateFoldWidgets.bind(this);this.$tokenizerUpdateFoldWidgets=this.tokenizerUpdateFoldWidgets.bind(this);this.on("change",this.$updateFoldWidgets);this.on("tokenizerUpdate",this.$tokenizerUpdateFoldWidgets)};this.getParentFoldRangeData=function(row,ignoreCurrent){var fw=this.foldWidgets;if(!fw||ignoreCurrent&&fw[row])return{};var i=row-1,firstRange;while(i>=0){var c=fw[i];if(c==null)c=fw[i]=this.getFoldWidget(i);if(c=="start"){var range=this.getFoldWidgetRange(i);if(!firstRange)firstRange=range;if(range&&range.end.row>=row)break}i--}return{range:i!==-1&&range,firstRange:firstRange}};this.onFoldWidgetClick=function(row,e){e=e.domEvent;var options={children:e.shiftKey,all:e.ctrlKey||e.metaKey,siblings:e.altKey};var range=this.$toggleFoldWidget(row,options);if(!range){var el=e.target||e.srcElement;if(el&&/ace_fold-widget/.test(el.className))el.className+=" ace_invalid"}};this.$toggleFoldWidget=function(row,options){if(!this.getFoldWidget)return;var type=this.getFoldWidget(row);var line=this.getLine(row);var dir=type==="end"?-1:1;var fold=this.getFoldAt(row,dir===-1?0:line.length,dir);if(fold){if(options.children||options.all)this.removeFold(fold);else this.expandFold(fold);return fold}var range=this.getFoldWidgetRange(row,true);if(range&&!range.isMultiLine()){fold=this.getFoldAt(range.start.row,range.start.column,1);if(fold&&range.isEqual(fold.range)){this.removeFold(fold);return fold}}if(options.siblings){var data=this.getParentFoldRangeData(row);if(data.range){var startRow=data.range.start.row+1;var endRow=data.range.end.row}this.foldAll(startRow,endRow,options.all?1e4:0)}else if(options.children){endRow=range?range.end.row:this.getLength();this.foldAll(row+1,endRow,options.all?1e4:0)}else if(range){if(options.all)range.collapseChildren=1e4;this.addFold("...",range)}return range};this.toggleFoldWidget=function(toggleParent){var row=this.selection.getCursor().row;row=this.getRowFoldStart(row);var range=this.$toggleFoldWidget(row,{});if(range)return;var data=this.getParentFoldRangeData(row,true);range=data.range||data.firstRange;if(range){row=range.start.row;var fold=this.getFoldAt(row,this.getLine(row).length,1);if(fold){this.removeFold(fold)}else{this.addFold("...",range)}}};this.updateFoldWidgets=function(delta){var firstRow=delta.start.row;var len=delta.end.row-firstRow;if(len===0){this.foldWidgets[firstRow]=null}else if(delta.action=="remove"){this.foldWidgets.splice(firstRow,len+1,null)}else{var args=Array(len+1);args.unshift(firstRow,1);this.foldWidgets.splice.apply(this.foldWidgets,args)}};this.tokenizerUpdateFoldWidgets=function(e){var rows=e.data;if(rows.first!=rows.last){if(this.foldWidgets.length>rows.first)this.foldWidgets.splice(rows.first,this.foldWidgets.length)}}}exports.Folding=Folding}));ace.define("ace/edit_session/bracket_match",["require","exports","module","ace/token_iterator","ace/range"],(function(acequire,exports,module){"use strict";var TokenIterator=acequire("../token_iterator").TokenIterator;var Range=acequire("../range").Range;function BracketMatch(){this.findMatchingBracket=function(position,chr){if(position.column==0)return null;var charBeforeCursor=chr||this.getLine(position.row).charAt(position.column-1);if(charBeforeCursor=="")return null;var match=charBeforeCursor.match(/([\(\[\{])|([\)\]\}])/);if(!match)return null;if(match[1])return this.$findClosingBracket(match[1],position);else return this.$findOpeningBracket(match[2],position)};this.getBracketRange=function(pos){var line=this.getLine(pos.row);var before=true,range;var chr=line.charAt(pos.column-1);var match=chr&&chr.match(/([\(\[\{])|([\)\]\}])/);if(!match){chr=line.charAt(pos.column);pos={row:pos.row,column:pos.column+1};match=chr&&chr.match(/([\(\[\{])|([\)\]\}])/);before=false}if(!match)return null;if(match[1]){var bracketPos=this.$findClosingBracket(match[1],pos);if(!bracketPos)return null;range=Range.fromPoints(pos,bracketPos);if(!before){range.end.column++;range.start.column--}range.cursor=range.end}else{var bracketPos=this.$findOpeningBracket(match[2],pos);if(!bracketPos)return null;range=Range.fromPoints(bracketPos,pos);if(!before){range.start.column++;range.end.column--}range.cursor=range.start}return range};this.$brackets={")":"(","(":")","]":"[","[":"]","{":"}","}":"{"};this.$findOpeningBracket=function(bracket,position,typeRe){var openBracket=this.$brackets[bracket];var depth=1;var iterator=new TokenIterator(this,position.row,position.column);var token=iterator.getCurrentToken();if(!token)token=iterator.stepForward();if(!token)return;if(!typeRe){typeRe=new RegExp("(\\.?"+token.type.replace(".","\\.").replace("rparen",".paren").replace(/\b(?:end)\b/,"(?:start|begin|end)")+")+")}var valueIndex=position.column-iterator.getCurrentTokenColumn()-2;var value=token.value;while(true){while(valueIndex>=0){var chr=value.charAt(valueIndex);if(chr==openBracket){depth-=1;if(depth==0){return{row:iterator.getCurrentTokenRow(),column:valueIndex+iterator.getCurrentTokenColumn()}}}else if(chr==bracket){depth+=1}valueIndex-=1}do{token=iterator.stepBackward()}while(token&&!typeRe.test(token.type));if(token==null)break;value=token.value;valueIndex=value.length-1}return null};this.$findClosingBracket=function(bracket,position,typeRe){var closingBracket=this.$brackets[bracket];var depth=1;var iterator=new TokenIterator(this,position.row,position.column);var token=iterator.getCurrentToken();if(!token)token=iterator.stepForward();if(!token)return;if(!typeRe){typeRe=new RegExp("(\\.?"+token.type.replace(".","\\.").replace("lparen",".paren").replace(/\b(?:start|begin)\b/,"(?:start|begin|end)")+")+")}var valueIndex=position.column-iterator.getCurrentTokenColumn();while(true){var value=token.value;var valueLength=value.length;while(valueIndex<valueLength){var chr=value.charAt(valueIndex);if(chr==closingBracket){depth-=1;if(depth==0){return{row:iterator.getCurrentTokenRow(),column:valueIndex+iterator.getCurrentTokenColumn()}}}else if(chr==bracket){depth+=1}valueIndex+=1}do{token=iterator.stepForward()}while(token&&!typeRe.test(token.type));if(token==null)break;valueIndex=0}return null}}exports.BracketMatch=BracketMatch}));ace.define("ace/edit_session",["require","exports","module","ace/lib/oop","ace/lib/lang","ace/bidihandler","ace/config","ace/lib/event_emitter","ace/selection","ace/mode/text","ace/range","ace/document","ace/background_tokenizer","ace/search_highlight","ace/edit_session/folding","ace/edit_session/bracket_match"],(function(acequire,exports,module){"use strict";var oop=acequire("./lib/oop");var lang=acequire("./lib/lang");var BidiHandler=acequire("./bidihandler").BidiHandler;var config=acequire("./config");var EventEmitter=acequire("./lib/event_emitter").EventEmitter;var Selection=acequire("./selection").Selection;var TextMode=acequire("./mode/text").Mode;var Range=acequire("./range").Range;var Document=acequire("./document").Document;var BackgroundTokenizer=acequire("./background_tokenizer").BackgroundTokenizer;var SearchHighlight=acequire("./search_highlight").SearchHighlight;var EditSession=function(text,mode){this.$breakpoints=[];this.$decorations=[];this.$frontMarkers={};this.$backMarkers={};this.$markerId=1;this.$undoSelect=true;this.$foldData=[];this.id="session"+ ++EditSession.$uid;this.$foldData.toString=function(){return this.join("\n")};this.on("changeFold",this.onChangeFold.bind(this));this.$onChange=this.onChange.bind(this);if(typeof text!="object"||!text.getLine)text=new Document(text);this.$bidiHandler=new BidiHandler(this);this.setDocument(text);this.selection=new Selection(this);config.resetOptions(this);this.setMode(mode);config._signal("session",this)};EditSession.$uid=0;(function(){oop.implement(this,EventEmitter);this.setDocument=function(doc){if(this.doc)this.doc.removeListener("change",this.$onChange);this.doc=doc;doc.on("change",this.$onChange);if(this.bgTokenizer)this.bgTokenizer.setDocument(this.getDocument());this.resetCaches()};this.getDocument=function(){return this.doc};this.$resetRowCache=function(docRow){if(!docRow){this.$docRowCache=[];this.$screenRowCache=[];return}var l=this.$docRowCache.length;var i=this.$getRowCacheIndex(this.$docRowCache,docRow)+1;if(l>i){this.$docRowCache.splice(i,l);this.$screenRowCache.splice(i,l)}};this.$getRowCacheIndex=function(cacheArray,val){var low=0;var hi=cacheArray.length-1;while(low<=hi){var mid=low+hi>>1;var c=cacheArray[mid];if(val>c)low=mid+1;else if(val<c)hi=mid-1;else return mid}return low-1};this.resetCaches=function(){this.$modified=true;this.$wrapData=[];this.$rowLengthCache=[];this.$resetRowCache(0);if(this.bgTokenizer)this.bgTokenizer.start(0)};this.onChangeFold=function(e){var fold=e.data;this.$resetRowCache(fold.start.row)};this.onChange=function(delta){this.$modified=true;this.$bidiHandler.onChange(delta);this.$resetRowCache(delta.start.row);var removedFolds=this.$updateInternalDataOnChange(delta);if(!this.$fromUndo&&this.$undoManager&&!delta.ignore){this.$deltasDoc.push(delta);if(removedFolds&&removedFolds.length!=0){this.$deltasFold.push({action:"removeFolds",folds:removedFolds})}this.$informUndoManager.schedule()}this.bgTokenizer&&this.bgTokenizer.$updateOnChange(delta);this._signal("change",delta)};this.setValue=function(text){this.doc.setValue(text);this.selection.moveTo(0,0);this.$resetRowCache(0);this.$deltas=[];this.$deltasDoc=[];this.$deltasFold=[];this.setUndoManager(this.$undoManager);this.getUndoManager().reset()};this.getValue=this.toString=function(){return this.doc.getValue()};this.getSelection=function(){return this.selection};this.getState=function(row){return this.bgTokenizer.getState(row)};this.getTokens=function(row){return this.bgTokenizer.getTokens(row)};this.getTokenAt=function(row,column){var tokens=this.bgTokenizer.getTokens(row);var token,c=0;if(column==null){var i=tokens.length-1;c=this.getLine(row).length}else{for(var i=0;i<tokens.length;i++){c+=tokens[i].value.length;if(c>=column)break}}token=tokens[i];if(!token)return null;token.index=i;token.start=c-token.value.length;return token};this.setUndoManager=function(undoManager){this.$undoManager=undoManager;this.$deltas=[];this.$deltasDoc=[];this.$deltasFold=[];if(this.$informUndoManager)this.$informUndoManager.cancel();if(undoManager){var self=this;this.$syncInformUndoManager=function(){self.$informUndoManager.cancel();if(self.$deltasFold.length){self.$deltas.push({group:"fold",deltas:self.$deltasFold});self.$deltasFold=[]}if(self.$deltasDoc.length){self.$deltas.push({group:"doc",deltas:self.$deltasDoc});self.$deltasDoc=[]}if(self.$deltas.length>0){undoManager.execute({action:"aceupdate",args:[self.$deltas,self],merge:self.mergeUndoDeltas})}self.mergeUndoDeltas=false;self.$deltas=[]};this.$informUndoManager=lang.delayedCall(this.$syncInformUndoManager)}};this.markUndoGroup=function(){if(this.$syncInformUndoManager)this.$syncInformUndoManager()};this.$defaultUndoManager={undo:function(){},redo:function(){},reset:function(){}};this.getUndoManager=function(){return this.$undoManager||this.$defaultUndoManager};this.getTabString=function(){if(this.getUseSoftTabs()){return lang.stringRepeat(" ",this.getTabSize())}else{return"\t"}};this.setUseSoftTabs=function(val){this.setOption("useSoftTabs",val)};this.getUseSoftTabs=function(){return this.$useSoftTabs&&!this.$mode.$indentWithTabs};this.setTabSize=function(tabSize){this.setOption("tabSize",tabSize)};this.getTabSize=function(){return this.$tabSize};this.isTabStop=function(position){return this.$useSoftTabs&&position.column%this.$tabSize===0};this.setNavigateWithinSoftTabs=function(navigateWithinSoftTabs){this.setOption("navigateWithinSoftTabs",navigateWithinSoftTabs)};this.getNavigateWithinSoftTabs=function(){return this.$navigateWithinSoftTabs};this.$overwrite=false;this.setOverwrite=function(overwrite){this.setOption("overwrite",overwrite)};this.getOverwrite=function(){return this.$overwrite};this.toggleOverwrite=function(){this.setOverwrite(!this.$overwrite)};this.addGutterDecoration=function(row,className){if(!this.$decorations[row])this.$decorations[row]="";this.$decorations[row]+=" "+className;this._signal("changeBreakpoint",{})};this.removeGutterDecoration=function(row,className){this.$decorations[row]=(this.$decorations[row]||"").replace(" "+className,"");this._signal("changeBreakpoint",{})};this.getBreakpoints=function(){return this.$breakpoints};this.setBreakpoints=function(rows){this.$breakpoints=[];for(var i=0;i<rows.length;i++){this.$breakpoints[rows[i]]="ace_breakpoint"}this._signal("changeBreakpoint",{})};this.clearBreakpoints=function(){this.$breakpoints=[];this._signal("changeBreakpoint",{})};this.setBreakpoint=function(row,className){if(className===undefined)className="ace_breakpoint";if(className)this.$breakpoints[row]=className;else delete this.$breakpoints[row];this._signal("changeBreakpoint",{})};this.clearBreakpoint=function(row){delete this.$breakpoints[row];this._signal("changeBreakpoint",{})};this.addMarker=function(range,clazz,type,inFront){var id=this.$markerId++;var marker={range:range,type:type||"line",renderer:typeof type=="function"?type:null,clazz:clazz,inFront:!!inFront,id:id};if(inFront){this.$frontMarkers[id]=marker;this._signal("changeFrontMarker")}else{this.$backMarkers[id]=marker;this._signal("changeBackMarker")}return id};this.addDynamicMarker=function(marker,inFront){if(!marker.update)return;var id=this.$markerId++;marker.id=id;marker.inFront=!!inFront;if(inFront){this.$frontMarkers[id]=marker;this._signal("changeFrontMarker")}else{this.$backMarkers[id]=marker;this._signal("changeBackMarker")}return marker};this.removeMarker=function(markerId){var marker=this.$frontMarkers[markerId]||this.$backMarkers[markerId];if(!marker)return;var markers=marker.inFront?this.$frontMarkers:this.$backMarkers;if(marker){delete markers[markerId];this._signal(marker.inFront?"changeFrontMarker":"changeBackMarker")}};this.getMarkers=function(inFront){return inFront?this.$frontMarkers:this.$backMarkers};this.highlight=function(re){if(!this.$searchHighlight){var highlight=new SearchHighlight(null,"ace_selected-word","text");this.$searchHighlight=this.addDynamicMarker(highlight)}this.$searchHighlight.setRegexp(re)};this.highlightLines=function(startRow,endRow,clazz,inFront){if(typeof endRow!="number"){clazz=endRow;endRow=startRow}if(!clazz)clazz="ace_step";var range=new Range(startRow,0,endRow,Infinity);range.id=this.addMarker(range,clazz,"fullLine",inFront);return range};this.setAnnotations=function(annotations){this.$annotations=annotations;this._signal("changeAnnotation",{})};this.getAnnotations=function(){return this.$annotations||[]};this.clearAnnotations=function(){this.setAnnotations([])};this.$detectNewLine=function(text){var match=text.match(/^.*?(\r?\n)/m);if(match){this.$autoNewLine=match[1]}else{this.$autoNewLine="\n"}};this.getWordRange=function(row,column){var line=this.getLine(row);var inToken=false;if(column>0)inToken=!!line.charAt(column-1).match(this.tokenRe);if(!inToken)inToken=!!line.charAt(column).match(this.tokenRe);if(inToken)var re=this.tokenRe;else if(/^\s+$/.test(line.slice(column-1,column+1)))var re=/\s/;else var re=this.nonTokenRe;var start=column;if(start>0){do{start--}while(start>=0&&line.charAt(start).match(re));start++}var end=column;while(end<line.length&&line.charAt(end).match(re)){end++}return new Range(row,start,row,end)};this.getAWordRange=function(row,column){var wordRange=this.getWordRange(row,column);var line=this.getLine(wordRange.end.row);while(line.charAt(wordRange.end.column).match(/[ \t]/)){wordRange.end.column+=1}return wordRange};this.setNewLineMode=function(newLineMode){this.doc.setNewLineMode(newLineMode)};this.getNewLineMode=function(){return this.doc.getNewLineMode()};this.setUseWorker=function(useWorker){this.setOption("useWorker",useWorker)};this.getUseWorker=function(){return this.$useWorker};this.onReloadTokenizer=function(e){var rows=e.data;this.bgTokenizer.start(rows.first);this._signal("tokenizerUpdate",e)};this.$modes={};this.$mode=null;this.$modeId=null;this.setMode=function(mode,cb){if(mode&&typeof mode==="object"){if(mode.getTokenizer)return this.$onChangeMode(mode);var options=mode;var path=options.path}else{path=mode||"ace/mode/text"}if(!this.$modes["ace/mode/text"])this.$modes["ace/mode/text"]=new TextMode;if(this.$modes[path]&&!options){this.$onChangeMode(this.$modes[path]);cb&&cb();return}this.$modeId=path;config.loadModule(["mode",path],function(m){if(this.$modeId!==path)return cb&&cb();if(this.$modes[path]&&!options){this.$onChangeMode(this.$modes[path])}else if(m&&m.Mode){m=new m.Mode(options);if(!options){this.$modes[path]=m;m.$id=path}this.$onChangeMode(m)}cb&&cb()}.bind(this));if(!this.$mode)this.$onChangeMode(this.$modes["ace/mode/text"],true)};this.$onChangeMode=function(mode,$isPlaceholder){if(!$isPlaceholder)this.$modeId=mode.$id;if(this.$mode===mode)return;this.$mode=mode;this.$stopWorker();if(this.$useWorker)this.$startWorker();var tokenizer=mode.getTokenizer();if(tokenizer.addEventListener!==undefined){var onReloadTokenizer=this.onReloadTokenizer.bind(this);tokenizer.addEventListener("update",onReloadTokenizer)}if(!this.bgTokenizer){this.bgTokenizer=new BackgroundTokenizer(tokenizer);var _self=this;this.bgTokenizer.addEventListener("update",(function(e){_self._signal("tokenizerUpdate",e)}))}else{this.bgTokenizer.setTokenizer(tokenizer)}this.bgTokenizer.setDocument(this.getDocument());this.tokenRe=mode.tokenRe;this.nonTokenRe=mode.nonTokenRe;if(!$isPlaceholder){if(mode.attachToSession)mode.attachToSession(this);this.$options.wrapMethod.set.call(this,this.$wrapMethod);this.$setFolding(mode.foldingRules);this.bgTokenizer.start(0);this._emit("changeMode")}};this.$stopWorker=function(){if(this.$worker){this.$worker.terminate();this.$worker=null}};this.$startWorker=function(){try{this.$worker=this.$mode.createWorker(this)}catch(e){config.warn("Could not load worker",e);this.$worker=null}};this.getMode=function(){return this.$mode};this.$scrollTop=0;this.setScrollTop=function(scrollTop){if(this.$scrollTop===scrollTop||isNaN(scrollTop))return;this.$scrollTop=scrollTop;this._signal("changeScrollTop",scrollTop)};this.getScrollTop=function(){return this.$scrollTop};this.$scrollLeft=0;this.setScrollLeft=function(scrollLeft){if(this.$scrollLeft===scrollLeft||isNaN(scrollLeft))return;this.$scrollLeft=scrollLeft;this._signal("changeScrollLeft",scrollLeft)};this.getScrollLeft=function(){return this.$scrollLeft};this.getScreenWidth=function(){this.$computeWidth();if(this.lineWidgets)return Math.max(this.getLineWidgetMaxWidth(),this.screenWidth);return this.screenWidth};this.getLineWidgetMaxWidth=function(){if(this.lineWidgetsWidth!=null)return this.lineWidgetsWidth;var width=0;this.lineWidgets.forEach((function(w){if(w&&w.screenWidth>width)width=w.screenWidth}));return this.lineWidgetWidth=width};this.$computeWidth=function(force){if(this.$modified||force){this.$modified=false;if(this.$useWrapMode)return this.screenWidth=this.$wrapLimit;var lines=this.doc.getAllLines();var cache=this.$rowLengthCache;var longestScreenLine=0;var foldIndex=0;var foldLine=this.$foldData[foldIndex];var foldStart=foldLine?foldLine.start.row:Infinity;var len=lines.length;for(var i=0;i<len;i++){if(i>foldStart){i=foldLine.end.row+1;if(i>=len)break;foldLine=this.$foldData[foldIndex++];foldStart=foldLine?foldLine.start.row:Infinity}if(cache[i]==null)cache[i]=this.$getStringScreenWidth(lines[i])[0];if(cache[i]>longestScreenLine)longestScreenLine=cache[i]}this.screenWidth=longestScreenLine}};this.getLine=function(row){return this.doc.getLine(row)};this.getLines=function(firstRow,lastRow){return this.doc.getLines(firstRow,lastRow)};this.getLength=function(){return this.doc.getLength()};this.getTextRange=function(range){return this.doc.getTextRange(range||this.selection.getRange())};this.insert=function(position,text){return this.doc.insert(position,text)};this.remove=function(range){return this.doc.remove(range)};this.removeFullLines=function(firstRow,lastRow){return this.doc.removeFullLines(firstRow,lastRow)};this.undoChanges=function(deltas,dontSelect){if(!deltas.length)return;this.$fromUndo=true;var lastUndoRange=null;for(var i=deltas.length-1;i!=-1;i--){var delta=deltas[i];if(delta.group=="doc"){this.doc.revertDeltas(delta.deltas);lastUndoRange=this.$getUndoSelection(delta.deltas,true,lastUndoRange)}else{delta.deltas.forEach((function(foldDelta){this.addFolds(foldDelta.folds)}),this)}}this.$fromUndo=false;lastUndoRange&&this.$undoSelect&&!dontSelect&&this.selection.setSelectionRange(lastUndoRange);return lastUndoRange};this.redoChanges=function(deltas,dontSelect){if(!deltas.length)return;this.$fromUndo=true;var lastUndoRange=null;for(var i=0;i<deltas.length;i++){var delta=deltas[i];if(delta.group=="doc"){this.doc.applyDeltas(delta.deltas);lastUndoRange=this.$getUndoSelection(delta.deltas,false,lastUndoRange)}}this.$fromUndo=false;lastUndoRange&&this.$undoSelect&&!dontSelect&&this.selection.setSelectionRange(lastUndoRange);return lastUndoRange};this.setUndoSelect=function(enable){this.$undoSelect=enable};this.$getUndoSelection=function(deltas,isUndo,lastUndoRange){function isInsert(delta){return isUndo?delta.action!=="insert":delta.action==="insert"}var delta=deltas[0];var range,point;var lastDeltaIsInsert=false;if(isInsert(delta)){range=Range.fromPoints(delta.start,delta.end);lastDeltaIsInsert=true}else{range=Range.fromPoints(delta.start,delta.start);lastDeltaIsInsert=false}for(var i=1;i<deltas.length;i++){delta=deltas[i];if(isInsert(delta)){point=delta.start;if(range.compare(point.row,point.column)==-1){range.setStart(point)}point=delta.end;if(range.compare(point.row,point.column)==1){range.setEnd(point)}lastDeltaIsInsert=true}else{point=delta.start;if(range.compare(point.row,point.column)==-1){range=Range.fromPoints(delta.start,delta.start)}lastDeltaIsInsert=false}}if(lastUndoRange!=null){if(Range.comparePoints(lastUndoRange.start,range.start)===0){lastUndoRange.start.column+=range.end.column-range.start.column;lastUndoRange.end.column+=range.end.column-range.start.column}var cmp=lastUndoRange.compareRange(range);if(cmp==1){range.setStart(lastUndoRange.start)}else if(cmp==-1){range.setEnd(lastUndoRange.end)}}return range};this.replace=function(range,text){return this.doc.replace(range,text)};this.moveText=function(fromRange,toPosition,copy){var text=this.getTextRange(fromRange);var folds=this.getFoldsInRange(fromRange);var toRange=Range.fromPoints(toPosition,toPosition);if(!copy){this.remove(fromRange);var rowDiff=fromRange.start.row-fromRange.end.row;var collDiff=rowDiff?-fromRange.end.column:fromRange.start.column-fromRange.end.column;if(collDiff){if(toRange.start.row==fromRange.end.row&&toRange.start.column>fromRange.end.column)toRange.start.column+=collDiff;if(toRange.end.row==fromRange.end.row&&toRange.end.column>fromRange.end.column)toRange.end.column+=collDiff}if(rowDiff&&toRange.start.row>=fromRange.end.row){toRange.start.row+=rowDiff;toRange.end.row+=rowDiff}}toRange.end=this.insert(toRange.start,text);if(folds.length){var oldStart=fromRange.start;var newStart=toRange.start;var rowDiff=newStart.row-oldStart.row;var collDiff=newStart.column-oldStart.column;this.addFolds(folds.map((function(x){x=x.clone();if(x.start.row==oldStart.row)x.start.column+=collDiff;if(x.end.row==oldStart.row)x.end.column+=collDiff;x.start.row+=rowDiff;x.end.row+=rowDiff;return x})))}return toRange};this.indentRows=function(startRow,endRow,indentString){indentString=indentString.replace(/\t/g,this.getTabString());for(var row=startRow;row<=endRow;row++)this.doc.insertInLine({row:row,column:0},indentString)};this.outdentRows=function(range){var rowRange=range.collapseRows();var deleteRange=new Range(0,0,0,0);var size=this.getTabSize();for(var i=rowRange.start.row;i<=rowRange.end.row;++i){var line=this.getLine(i);deleteRange.start.row=i;deleteRange.end.row=i;for(var j=0;j<size;++j)if(line.charAt(j)!=" ")break;if(j<size&&line.charAt(j)=="\t"){deleteRange.start.column=j;deleteRange.end.column=j+1}else{deleteRange.start.column=0;deleteRange.end.column=j}this.remove(deleteRange)}};this.$moveLines=function(firstRow,lastRow,dir){firstRow=this.getRowFoldStart(firstRow);lastRow=this.getRowFoldEnd(lastRow);if(dir<0){var row=this.getRowFoldStart(firstRow+dir);if(row<0)return 0;var diff=row-firstRow}else if(dir>0){var row=this.getRowFoldEnd(lastRow+dir);if(row>this.doc.getLength()-1)return 0;var diff=row-lastRow}else{firstRow=this.$clipRowToDocument(firstRow);lastRow=this.$clipRowToDocument(lastRow);var diff=lastRow-firstRow+1}var range=new Range(firstRow,0,lastRow,Number.MAX_VALUE);var folds=this.getFoldsInRange(range).map((function(x){x=x.clone();x.start.row+=diff;x.end.row+=diff;return x}));var lines=dir==0?this.doc.getLines(firstRow,lastRow):this.doc.removeFullLines(firstRow,lastRow);this.doc.insertFullLines(firstRow+diff,lines);folds.length&&this.addFolds(folds);return diff};this.moveLinesUp=function(firstRow,lastRow){return this.$moveLines(firstRow,lastRow,-1)};this.moveLinesDown=function(firstRow,lastRow){return this.$moveLines(firstRow,lastRow,1)};this.duplicateLines=function(firstRow,lastRow){return this.$moveLines(firstRow,lastRow,0)};this.$clipRowToDocument=function(row){return Math.max(0,Math.min(row,this.doc.getLength()-1))};this.$clipColumnToRow=function(row,column){if(column<0)return 0;return Math.min(this.doc.getLine(row).length,column)};this.$clipPositionToDocument=function(row,column){column=Math.max(0,column);if(row<0){row=0;column=0}else{var len=this.doc.getLength();if(row>=len){row=len-1;column=this.doc.getLine(len-1).length}else{column=Math.min(this.doc.getLine(row).length,column)}}return{row:row,column:column}};this.$clipRangeToDocument=function(range){if(range.start.row<0){range.start.row=0;range.start.column=0}else{range.start.column=this.$clipColumnToRow(range.start.row,range.start.column)}var len=this.doc.getLength()-1;if(range.end.row>len){range.end.row=len;range.end.column=this.doc.getLine(len).length}else{range.end.column=this.$clipColumnToRow(range.end.row,range.end.column)}return range};this.$wrapLimit=80;this.$useWrapMode=false;this.$wrapLimitRange={min:null,max:null};this.setUseWrapMode=function(useWrapMode){if(useWrapMode!=this.$useWrapMode){this.$useWrapMode=useWrapMode;this.$modified=true;this.$resetRowCache(0);if(useWrapMode){var len=this.getLength();this.$wrapData=Array(len);this.$updateWrapData(0,len-1)}this._signal("changeWrapMode")}};this.getUseWrapMode=function(){return this.$useWrapMode};this.setWrapLimitRange=function(min,max){if(this.$wrapLimitRange.min!==min||this.$wrapLimitRange.max!==max){this.$wrapLimitRange={min:min,max:max};this.$modified=true;this.$bidiHandler.markAsDirty();if(this.$useWrapMode)this._signal("changeWrapMode")}};this.adjustWrapLimit=function(desiredLimit,$printMargin){var limits=this.$wrapLimitRange;if(limits.max<0)limits={min:$printMargin,max:$printMargin};var wrapLimit=this.$constrainWrapLimit(desiredLimit,limits.min,limits.max);if(wrapLimit!=this.$wrapLimit&&wrapLimit>1){this.$wrapLimit=wrapLimit;this.$modified=true;if(this.$useWrapMode){this.$updateWrapData(0,this.getLength()-1);this.$resetRowCache(0);this._signal("changeWrapLimit")}return true}return false};this.$constrainWrapLimit=function(wrapLimit,min,max){if(min)wrapLimit=Math.max(min,wrapLimit);if(max)wrapLimit=Math.min(max,wrapLimit);return wrapLimit};this.getWrapLimit=function(){return this.$wrapLimit};this.setWrapLimit=function(limit){this.setWrapLimitRange(limit,limit)};this.getWrapLimitRange=function(){return{min:this.$wrapLimitRange.min,max:this.$wrapLimitRange.max}};this.$updateInternalDataOnChange=function(delta){var useWrapMode=this.$useWrapMode;var action=delta.action;var start=delta.start;var end=delta.end;var firstRow=start.row;var lastRow=end.row;var len=lastRow-firstRow;var removedFolds=null;this.$updating=true;if(len!=0){if(action==="remove"){this[useWrapMode?"$wrapData":"$rowLengthCache"].splice(firstRow,len);var foldLines=this.$foldData;removedFolds=this.getFoldsInRange(delta);this.removeFolds(removedFolds);var foldLine=this.getFoldLine(end.row);var idx=0;if(foldLine){foldLine.addRemoveChars(end.row,end.column,start.column-end.column);foldLine.shiftRow(-len);var foldLineBefore=this.getFoldLine(firstRow);if(foldLineBefore&&foldLineBefore!==foldLine){foldLineBefore.merge(foldLine);foldLine=foldLineBefore}idx=foldLines.indexOf(foldLine)+1}for(idx;idx<foldLines.length;idx++){var foldLine=foldLines[idx];if(foldLine.start.row>=end.row){foldLine.shiftRow(-len)}}lastRow=firstRow}else{var args=Array(len);args.unshift(firstRow,0);var arr=useWrapMode?this.$wrapData:this.$rowLengthCache;arr.splice.apply(arr,args);var foldLines=this.$foldData;var foldLine=this.getFoldLine(firstRow);var idx=0;if(foldLine){var cmp=foldLine.range.compareInside(start.row,start.column);if(cmp==0){foldLine=foldLine.split(start.row,start.column);if(foldLine){foldLine.shiftRow(len);foldLine.addRemoveChars(lastRow,0,end.column-start.column)}}else if(cmp==-1){foldLine.addRemoveChars(firstRow,0,end.column-start.column);foldLine.shiftRow(len)}idx=foldLines.indexOf(foldLine)+1}for(idx;idx<foldLines.length;idx++){var foldLine=foldLines[idx];if(foldLine.start.row>=firstRow){foldLine.shiftRow(len)}}}}else{len=Math.abs(delta.start.column-delta.end.column);if(action==="remove"){removedFolds=this.getFoldsInRange(delta);this.removeFolds(removedFolds);len=-len}var foldLine=this.getFoldLine(firstRow);if(foldLine){foldLine.addRemoveChars(firstRow,start.column,len)}}if(useWrapMode&&this.$wrapData.length!=this.doc.getLength()){console.error("doc.getLength() and $wrapData.length have to be the same!")}this.$updating=false;if(useWrapMode)this.$updateWrapData(firstRow,lastRow);else this.$updateRowLengthCache(firstRow,lastRow);return removedFolds};this.$updateRowLengthCache=function(firstRow,lastRow,b){this.$rowLengthCache[firstRow]=null;this.$rowLengthCache[lastRow]=null};this.$updateWrapData=function(firstRow,lastRow){var lines=this.doc.getAllLines();var tabSize=this.getTabSize();var wrapData=this.$wrapData;var wrapLimit=this.$wrapLimit;var tokens;var foldLine;var row=firstRow;lastRow=Math.min(lastRow,lines.length-1);while(row<=lastRow){foldLine=this.getFoldLine(row,foldLine);if(!foldLine){tokens=this.$getDisplayTokens(lines[row]);wrapData[row]=this.$computeWrapSplits(tokens,wrapLimit,tabSize);row++}else{tokens=[];foldLine.walk(function(placeholder,row,column,lastColumn){var walkTokens;if(placeholder!=null){walkTokens=this.$getDisplayTokens(placeholder,tokens.length);walkTokens[0]=PLACEHOLDER_START;for(var i=1;i<walkTokens.length;i++){walkTokens[i]=PLACEHOLDER_BODY}}else{walkTokens=this.$getDisplayTokens(lines[row].substring(lastColumn,column),tokens.length)}tokens=tokens.concat(walkTokens)}.bind(this),foldLine.end.row,lines[foldLine.end.row].length+1);wrapData[foldLine.start.row]=this.$computeWrapSplits(tokens,wrapLimit,tabSize);row=foldLine.end.row+1}}};var CHAR=1,CHAR_EXT=2,PLACEHOLDER_START=3,PLACEHOLDER_BODY=4,PUNCTUATION=9,SPACE=10,TAB=11,TAB_SPACE=12;this.$computeWrapSplits=function(tokens,wrapLimit,tabSize){if(tokens.length==0){return[]}var splits=[];var displayLength=tokens.length;var lastSplit=0,lastDocSplit=0;var isCode=this.$wrapAsCode;var indentedSoftWrap=this.$indentedSoftWrap;var maxIndent=wrapLimit<=Math.max(2*tabSize,8)||indentedSoftWrap===false?0:Math.floor(wrapLimit/2);function getWrapIndent(){var indentation=0;if(maxIndent===0)return indentation;if(indentedSoftWrap){for(var i=0;i<tokens.length;i++){var token=tokens[i];if(token==SPACE)indentation+=1;else if(token==TAB)indentation+=tabSize;else if(token==TAB_SPACE)continue;else break}}if(isCode&&indentedSoftWrap!==false)indentation+=tabSize;return Math.min(indentation,maxIndent)}function addSplit(screenPos){var displayed=tokens.slice(lastSplit,screenPos);var len=displayed.length;displayed.join("").replace(/12/g,(function(){len-=1})).replace(/2/g,(function(){len-=1}));if(!splits.length){indent=getWrapIndent();splits.indent=indent}lastDocSplit+=len;splits.push(lastDocSplit);lastSplit=screenPos}var indent=0;while(displayLength-lastSplit>wrapLimit-indent){var split=lastSplit+wrapLimit-indent;if(tokens[split-1]>=SPACE&&tokens[split]>=SPACE){addSplit(split);continue}if(tokens[split]==PLACEHOLDER_START||tokens[split]==PLACEHOLDER_BODY){for(split;split!=lastSplit-1;split--){if(tokens[split]==PLACEHOLDER_START){break}}if(split>lastSplit){addSplit(split);continue}split=lastSplit+wrapLimit;for(split;split<tokens.length;split++){if(tokens[split]!=PLACEHOLDER_BODY){break}}if(split==tokens.length){break}addSplit(split);continue}var minSplit=Math.max(split-(wrapLimit-(wrapLimit>>2)),lastSplit-1);while(split>minSplit&&tokens[split]<PLACEHOLDER_START){split--}if(isCode){while(split>minSplit&&tokens[split]<PLACEHOLDER_START){split--}while(split>minSplit&&tokens[split]==PUNCTUATION){split--}}else{while(split>minSplit&&tokens[split]<SPACE){split--}}if(split>minSplit){addSplit(++split);continue}split=lastSplit+wrapLimit;if(tokens[split]==CHAR_EXT)split--;addSplit(split-indent)}return splits};this.$getDisplayTokens=function(str,offset){var arr=[];var tabSize;offset=offset||0;for(var i=0;i<str.length;i++){var c=str.charCodeAt(i);if(c==9){tabSize=this.getScreenTabSize(arr.length+offset);arr.push(TAB);for(var n=1;n<tabSize;n++){arr.push(TAB_SPACE)}}else if(c==32){arr.push(SPACE)}else if(c>39&&c<48||c>57&&c<64){arr.push(PUNCTUATION)}else if(c>=4352&&isFullWidth(c)){arr.push(CHAR,CHAR_EXT)}else{arr.push(CHAR)}}return arr};this.$getStringScreenWidth=function(str,maxScreenColumn,screenColumn){if(maxScreenColumn==0)return[0,0];if(maxScreenColumn==null)maxScreenColumn=Infinity;screenColumn=screenColumn||0;var c,column;for(column=0;column<str.length;column++){c=str.charCodeAt(column);if(c==9){screenColumn+=this.getScreenTabSize(screenColumn)}else if(c>=4352&&isFullWidth(c)){screenColumn+=2}else{screenColumn+=1}if(screenColumn>maxScreenColumn){break}}return[screenColumn,column]};this.lineWidgets=null;this.getRowLength=function(row){if(this.lineWidgets)var h=this.lineWidgets[row]&&this.lineWidgets[row].rowCount||0;else h=0;if(!this.$useWrapMode||!this.$wrapData[row]){return 1+h}else{return this.$wrapData[row].length+1+h}};this.getRowLineCount=function(row){if(!this.$useWrapMode||!this.$wrapData[row]){return 1}else{return this.$wrapData[row].length+1}};this.getRowWrapIndent=function(screenRow){if(this.$useWrapMode){var pos=this.screenToDocumentPosition(screenRow,Number.MAX_VALUE);var splits=this.$wrapData[pos.row];return splits.length&&splits[0]<pos.column?splits.indent:0}else{return 0}};this.getScreenLastRowColumn=function(screenRow){var pos=this.screenToDocumentPosition(screenRow,Number.MAX_VALUE);return this.documentToScreenColumn(pos.row,pos.column)};this.getDocumentLastRowColumn=function(docRow,docColumn){var screenRow=this.documentToScreenRow(docRow,docColumn);return this.getScreenLastRowColumn(screenRow)};this.getDocumentLastRowColumnPosition=function(docRow,docColumn){var screenRow=this.documentToScreenRow(docRow,docColumn);return this.screenToDocumentPosition(screenRow,Number.MAX_VALUE/10)};this.getRowSplitData=function(row){if(!this.$useWrapMode){return undefined}else{return this.$wrapData[row]}};this.getScreenTabSize=function(screenColumn){return this.$tabSize-screenColumn%this.$tabSize};this.screenToDocumentRow=function(screenRow,screenColumn){return this.screenToDocumentPosition(screenRow,screenColumn).row};this.screenToDocumentColumn=function(screenRow,screenColumn){return this.screenToDocumentPosition(screenRow,screenColumn).column};this.screenToDocumentPosition=function(screenRow,screenColumn,offsetX){if(screenRow<0)return{row:0,column:0};var line;var docRow=0;var docColumn=0;var column;var row=0;var rowLength=0;var rowCache=this.$screenRowCache;var i=this.$getRowCacheIndex(rowCache,screenRow);var l=rowCache.length;if(l&&i>=0){var row=rowCache[i];var docRow=this.$docRowCache[i];var doCache=screenRow>rowCache[l-1]}else{var doCache=!l}var maxRow=this.getLength()-1;var foldLine=this.getNextFoldLine(docRow);var foldStart=foldLine?foldLine.start.row:Infinity;while(row<=screenRow){rowLength=this.getRowLength(docRow);if(row+rowLength>screenRow||docRow>=maxRow){break}else{row+=rowLength;docRow++;if(docRow>foldStart){docRow=foldLine.end.row+1;foldLine=this.getNextFoldLine(docRow,foldLine);foldStart=foldLine?foldLine.start.row:Infinity}}if(doCache){this.$docRowCache.push(docRow);this.$screenRowCache.push(row)}}if(foldLine&&foldLine.start.row<=docRow){line=this.getFoldDisplayLine(foldLine);docRow=foldLine.start.row}else if(row+rowLength<=screenRow||docRow>maxRow){return{row:maxRow,column:this.getLine(maxRow).length}}else{line=this.getLine(docRow);foldLine=null}var wrapIndent=0,splitIndex=Math.floor(screenRow-row);if(this.$useWrapMode){var splits=this.$wrapData[docRow];if(splits){column=splits[splitIndex];if(splitIndex>0&&splits.length){wrapIndent=splits.indent;docColumn=splits[splitIndex-1]||splits[splits.length-1];line=line.substring(docColumn)}}}if(offsetX!==undefined&&this.$bidiHandler.isBidiRow(row+splitIndex,docRow,splitIndex))screenColumn=this.$bidiHandler.offsetToCol(offsetX);docColumn+=this.$getStringScreenWidth(line,screenColumn-wrapIndent)[1];if(this.$useWrapMode&&docColumn>=column)docColumn=column-1;if(foldLine)return foldLine.idxToPosition(docColumn);return{row:docRow,column:docColumn}};this.documentToScreenPosition=function(docRow,docColumn){if(typeof docColumn==="undefined")var pos=this.$clipPositionToDocument(docRow.row,docRow.column);else pos=this.$clipPositionToDocument(docRow,docColumn);docRow=pos.row;docColumn=pos.column;var screenRow=0;var foldStartRow=null;var fold=null;fold=this.getFoldAt(docRow,docColumn,1);if(fold){docRow=fold.start.row;docColumn=fold.start.column}var rowEnd,row=0;var rowCache=this.$docRowCache;var i=this.$getRowCacheIndex(rowCache,docRow);var l=rowCache.length;if(l&&i>=0){var row=rowCache[i];var screenRow=this.$screenRowCache[i];var doCache=docRow>rowCache[l-1]}else{var doCache=!l}var foldLine=this.getNextFoldLine(row);var foldStart=foldLine?foldLine.start.row:Infinity;while(row<docRow){if(row>=foldStart){rowEnd=foldLine.end.row+1;if(rowEnd>docRow)break;foldLine=this.getNextFoldLine(rowEnd,foldLine);foldStart=foldLine?foldLine.start.row:Infinity}else{rowEnd=row+1}screenRow+=this.getRowLength(row);row=rowEnd;if(doCache){this.$docRowCache.push(row);this.$screenRowCache.push(screenRow)}}var textLine="";if(foldLine&&row>=foldStart){textLine=this.getFoldDisplayLine(foldLine,docRow,docColumn);foldStartRow=foldLine.start.row}else{textLine=this.getLine(docRow).substring(0,docColumn);foldStartRow=docRow}var wrapIndent=0;if(this.$useWrapMode){var wrapRow=this.$wrapData[foldStartRow];if(wrapRow){var screenRowOffset=0;while(textLine.length>=wrapRow[screenRowOffset]){screenRow++;screenRowOffset++}textLine=textLine.substring(wrapRow[screenRowOffset-1]||0,textLine.length);wrapIndent=screenRowOffset>0?wrapRow.indent:0}}return{row:screenRow,column:wrapIndent+this.$getStringScreenWidth(textLine)[0]}};this.documentToScreenColumn=function(row,docColumn){return this.documentToScreenPosition(row,docColumn).column};this.documentToScreenRow=function(docRow,docColumn){return this.documentToScreenPosition(docRow,docColumn).row};this.getScreenLength=function(){var screenRows=0;var fold=null;if(!this.$useWrapMode){screenRows=this.getLength();var foldData=this.$foldData;for(var i=0;i<foldData.length;i++){fold=foldData[i];screenRows-=fold.end.row-fold.start.row}}else{var lastRow=this.$wrapData.length;var row=0,i=0;var fold=this.$foldData[i++];var foldStart=fold?fold.start.row:Infinity;while(row<lastRow){var splits=this.$wrapData[row];screenRows+=splits?splits.length+1:1;row++;if(row>foldStart){row=fold.end.row+1;fold=this.$foldData[i++];foldStart=fold?fold.start.row:Infinity}}}if(this.lineWidgets)screenRows+=this.$getWidgetScreenLength();return screenRows};this.$setFontMetrics=function(fm){if(!this.$enableVarChar)return;this.$getStringScreenWidth=function(str,maxScreenColumn,screenColumn){if(maxScreenColumn===0)return[0,0];if(!maxScreenColumn)maxScreenColumn=Infinity;screenColumn=screenColumn||0;var c,column;for(column=0;column<str.length;column++){c=str.charAt(column);if(c==="\t"){screenColumn+=this.getScreenTabSize(screenColumn)}else{screenColumn+=fm.getCharacterWidth(c)}if(screenColumn>maxScreenColumn){break}}return[screenColumn,column]}};this.destroy=function(){if(this.bgTokenizer){this.bgTokenizer.setDocument(null);this.bgTokenizer=null}this.$stopWorker()};this.isFullWidth=isFullWidth;function isFullWidth(c){if(c<4352)return false;return c>=4352&&c<=4447||c>=4515&&c<=4519||c>=4602&&c<=4607||c>=9001&&c<=9002||c>=11904&&c<=11929||c>=11931&&c<=12019||c>=12032&&c<=12245||c>=12272&&c<=12283||c>=12288&&c<=12350||c>=12353&&c<=12438||c>=12441&&c<=12543||c>=12549&&c<=12589||c>=12593&&c<=12686||c>=12688&&c<=12730||c>=12736&&c<=12771||c>=12784&&c<=12830||c>=12832&&c<=12871||c>=12880&&c<=13054||c>=13056&&c<=19903||c>=19968&&c<=42124||c>=42128&&c<=42182||c>=43360&&c<=43388||c>=44032&&c<=55203||c>=55216&&c<=55238||c>=55243&&c<=55291||c>=63744&&c<=64255||c>=65040&&c<=65049||c>=65072&&c<=65106||c>=65108&&c<=65126||c>=65128&&c<=65131||c>=65281&&c<=65376||c>=65504&&c<=65510}}).call(EditSession.prototype);acequire("./edit_session/folding").Folding.call(EditSession.prototype);acequire("./edit_session/bracket_match").BracketMatch.call(EditSession.prototype);config.defineOptions(EditSession.prototype,"session",{wrap:{set:function(value){if(!value||value=="off")value=false;else if(value=="free")value=true;else if(value=="printMargin")value=-1;else if(typeof value=="string")value=parseInt(value,10)||false;if(this.$wrap==value)return;this.$wrap=value;if(!value){this.setUseWrapMode(false)}else{var col=typeof value=="number"?value:null;this.setWrapLimitRange(col,col);this.setUseWrapMode(true)}},get:function(){if(this.getUseWrapMode()){if(this.$wrap==-1)return"printMargin";if(!this.getWrapLimitRange().min)return"free";return this.$wrap}return"off"},handlesSet:true},wrapMethod:{set:function(val){val=val=="auto"?this.$mode.type!="text":val!="text";if(val!=this.$wrapAsCode){this.$wrapAsCode=val;if(this.$useWrapMode){this.$modified=true;this.$resetRowCache(0);this.$updateWrapData(0,this.getLength()-1)}}},initialValue:"auto"},indentedSoftWrap:{initialValue:true},firstLineNumber:{set:function(){this._signal("changeBreakpoint")},initialValue:1},useWorker:{set:function(useWorker){this.$useWorker=useWorker;this.$stopWorker();if(useWorker)this.$startWorker()},initialValue:true},useSoftTabs:{initialValue:true},tabSize:{set:function(tabSize){if(isNaN(tabSize)||this.$tabSize===tabSize)return;this.$modified=true;this.$rowLengthCache=[];this.$tabSize=tabSize;this._signal("changeTabSize")},initialValue:4,handlesSet:true},navigateWithinSoftTabs:{initialValue:false},overwrite:{set:function(val){this._signal("changeOverwrite")},initialValue:false},newLineMode:{set:function(val){this.doc.setNewLineMode(val)},get:function(){return this.doc.getNewLineMode()},handlesSet:true},mode:{set:function(val){this.setMode(val)},get:function(){return this.$modeId}}});exports.EditSession=EditSession}));ace.define("ace/search",["require","exports","module","ace/lib/lang","ace/lib/oop","ace/range"],(function(acequire,exports,module){"use strict";var lang=acequire("./lib/lang");var oop=acequire("./lib/oop");var Range=acequire("./range").Range;var Search=function(){this.$options={}};(function(){this.set=function(options){oop.mixin(this.$options,options);return this};this.getOptions=function(){return lang.copyObject(this.$options)};this.setOptions=function(options){this.$options=options};this.find=function(session){var options=this.$options;var iterator=this.$matchIterator(session,options);if(!iterator)return false;var firstRange=null;iterator.forEach((function(sr,sc,er,ec){firstRange=new Range(sr,sc,er,ec);if(sc==ec&&options.start&&options.start.start&&options.skipCurrent!=false&&firstRange.isEqual(options.start)){firstRange=null;return false}return true}));return firstRange};this.findAll=function(session){var options=this.$options;if(!options.needle)return[];this.$assembleRegExp(options);var range=options.range;var lines=range?session.getLines(range.start.row,range.end.row):session.doc.getAllLines();var ranges=[];var re=options.re;if(options.$isMultiLine){var len=re.length;var maxRow=lines.length-len;var prevRange;outer:for(var row=re.offset||0;row<=maxRow;row++){for(var j=0;j<len;j++)if(lines[row+j].search(re[j])==-1)continue outer;var startLine=lines[row];var line=lines[row+len-1];var startIndex=startLine.length-startLine.match(re[0])[0].length;var endIndex=line.match(re[len-1])[0].length;if(prevRange&&prevRange.end.row===row&&prevRange.end.column>startIndex){continue}ranges.push(prevRange=new Range(row,startIndex,row+len-1,endIndex));if(len>2)row=row+len-2}}else{for(var i=0;i<lines.length;i++){var matches=lang.getMatchOffsets(lines[i],re);for(var j=0;j<matches.length;j++){var match=matches[j];ranges.push(new Range(i,match.offset,i,match.offset+match.length))}}}if(range){var startColumn=range.start.column;var endColumn=range.start.column;var i=0,j=ranges.length-1;while(i<j&&ranges[i].start.column<startColumn&&ranges[i].start.row==range.start.row)i++;while(i<j&&ranges[j].end.column>endColumn&&ranges[j].end.row==range.end.row)j--;ranges=ranges.slice(i,j+1);for(i=0,j=ranges.length;i<j;i++){ranges[i].start.row+=range.start.row;ranges[i].end.row+=range.start.row}}return ranges};this.replace=function(input,replacement){var options=this.$options;var re=this.$assembleRegExp(options);if(options.$isMultiLine)return replacement;if(!re)return;var match=re.exec(input);if(!match||match[0].length!=input.length)return null;replacement=input.replace(re,replacement);if(options.preserveCase){replacement=replacement.split("");for(var i=Math.min(input.length,input.length);i--;){var ch=input[i];if(ch&&ch.toLowerCase()!=ch)replacement[i]=replacement[i].toUpperCase();else replacement[i]=replacement[i].toLowerCase()}replacement=replacement.join("")}return replacement};this.$assembleRegExp=function(options,$disableFakeMultiline){if(options.needle instanceof RegExp)return options.re=options.needle;var needle=options.needle;if(!options.needle)return options.re=false;if(!options.regExp)needle=lang.escapeRegExp(needle);if(options.wholeWord)needle=addWordBoundary(needle,options);var modifier=options.caseSensitive?"gm":"gmi";options.$isMultiLine=!$disableFakeMultiline&&/[\n\r]/.test(needle);if(options.$isMultiLine)return options.re=this.$assembleMultilineRegExp(needle,modifier);try{var re=new RegExp(needle,modifier)}catch(e){re=false}return options.re=re};this.$assembleMultilineRegExp=function(needle,modifier){var parts=needle.replace(/\r\n|\r|\n/g,"$\n^").split("\n");var re=[];for(var i=0;i<parts.length;i++)try{re.push(new RegExp(parts[i],modifier))}catch(e){return false}return re};this.$matchIterator=function(session,options){var re=this.$assembleRegExp(options);if(!re)return false;var backwards=options.backwards==true;var skipCurrent=options.skipCurrent!=false;var range=options.range;var start=options.start;if(!start)start=range?range[backwards?"end":"start"]:session.selection.getRange();if(start.start)start=start[skipCurrent!=backwards?"end":"start"];var firstRow=range?range.start.row:0;var lastRow=range?range.end.row:session.getLength()-1;if(backwards){var forEach=function(callback){var row=start.row;if(forEachInLine(row,start.column,callback))return;for(row--;row>=firstRow;row--)if(forEachInLine(row,Number.MAX_VALUE,callback))return;if(options.wrap==false)return;for(row=lastRow,firstRow=start.row;row>=firstRow;row--)if(forEachInLine(row,Number.MAX_VALUE,callback))return}}else{var forEach=function(callback){var row=start.row;if(forEachInLine(row,start.column,callback))return;for(row=row+1;row<=lastRow;row++)if(forEachInLine(row,0,callback))return;if(options.wrap==false)return;for(row=firstRow,lastRow=start.row;row<=lastRow;row++)if(forEachInLine(row,0,callback))return}}if(options.$isMultiLine){var len=re.length;var forEachInLine=function(row,offset,callback){var startRow=backwards?row-len+1:row;if(startRow<0)return;var line=session.getLine(startRow);var startIndex=line.search(re[0]);if(!backwards&&startIndex<offset||startIndex===-1)return;for(var i=1;i<len;i++){line=session.getLine(startRow+i);if(line.search(re[i])==-1)return}var endIndex=line.match(re[len-1])[0].length;if(backwards&&endIndex>offset)return;if(callback(startRow,startIndex,startRow+len-1,endIndex))return true}}else if(backwards){var forEachInLine=function(row,endIndex,callback){var line=session.getLine(row);var matches=[];var m,last=0;re.lastIndex=0;while(m=re.exec(line)){var length=m[0].length;last=m.index;if(!length){if(last>=line.length)break;re.lastIndex=last+=1}if(m.index+length>endIndex)break;matches.push(m.index,length)}for(var i=matches.length-1;i>=0;i-=2){var column=matches[i-1];var length=matches[i];if(callback(row,column,row,column+length))return true}}}else{var forEachInLine=function(row,startIndex,callback){var line=session.getLine(row);var m;var last=startIndex;re.lastIndex=startIndex;while(m=re.exec(line)){var length=m[0].length;last=m.index;if(callback(row,last,row,last+length))return true;if(!length){re.lastIndex=last+=1;if(last>=line.length)return false}}}}return{forEach:forEach}}}).call(Search.prototype);function addWordBoundary(needle,options){function wordBoundary(c){if(/\w/.test(c)||options.regExp)return"\\b";return""}return wordBoundary(needle[0])+needle+wordBoundary(needle[needle.length-1])}exports.Search=Search}));ace.define("ace/keyboard/hash_handler",["require","exports","module","ace/lib/keys","ace/lib/useragent"],(function(acequire,exports,module){"use strict";var keyUtil=acequire("../lib/keys");var useragent=acequire("../lib/useragent");var KEY_MODS=keyUtil.KEY_MODS;function HashHandler(config,platform){this.platform=platform||(useragent.isMac?"mac":"win");this.commands={};this.commandKeyBinding={};this.addCommands(config);this.$singleCommand=true}function MultiHashHandler(config,platform){HashHandler.call(this,config,platform);this.$singleCommand=false}MultiHashHandler.prototype=HashHandler.prototype;(function(){this.addCommand=function(command){if(this.commands[command.name])this.removeCommand(command);this.commands[command.name]=command;if(command.bindKey)this._buildKeyHash(command)};this.removeCommand=function(command,keepCommand){var name=command&&(typeof command==="string"?command:command.name);command=this.commands[name];if(!keepCommand)delete this.commands[name];var ckb=this.commandKeyBinding;for(var keyId in ckb){var cmdGroup=ckb[keyId];if(cmdGroup==command){delete ckb[keyId]}else if(Array.isArray(cmdGroup)){var i=cmdGroup.indexOf(command);if(i!=-1){cmdGroup.splice(i,1);if(cmdGroup.length==1)ckb[keyId]=cmdGroup[0]}}}};this.bindKey=function(key,command,position){if(typeof key=="object"&&key){if(position==undefined)position=key.position;key=key[this.platform]}if(!key)return;if(typeof command=="function")return this.addCommand({exec:command,bindKey:key,name:command.name||key});key.split("|").forEach((function(keyPart){var chain="";if(keyPart.indexOf(" ")!=-1){var parts=keyPart.split(/\s+/);keyPart=parts.pop();parts.forEach((function(keyPart){var binding=this.parseKeys(keyPart);var id=KEY_MODS[binding.hashId]+binding.key;chain+=(chain?" ":"")+id;this._addCommandToBinding(chain,"chainKeys")}),this);chain+=" "}var binding=this.parseKeys(keyPart);var id=KEY_MODS[binding.hashId]+binding.key;this._addCommandToBinding(chain+id,command,position)}),this)};function getPosition(command){return typeof command=="object"&&command.bindKey&&command.bindKey.position||(command.isDefault?-100:0)}this._addCommandToBinding=function(keyId,command,position){var ckb=this.commandKeyBinding,i;if(!command){delete ckb[keyId]}else if(!ckb[keyId]||this.$singleCommand){ckb[keyId]=command}else{if(!Array.isArray(ckb[keyId])){ckb[keyId]=[ckb[keyId]]}else if((i=ckb[keyId].indexOf(command))!=-1){ckb[keyId].splice(i,1)}if(typeof position!="number"){position=getPosition(command)}var commands=ckb[keyId];for(i=0;i<commands.length;i++){var other=commands[i];var otherPos=getPosition(other);if(otherPos>position)break}commands.splice(i,0,command)}};this.addCommands=function(commands){commands&&Object.keys(commands).forEach((function(name){var command=commands[name];if(!command)return;if(typeof command==="string")return this.bindKey(command,name);if(typeof command==="function")command={exec:command};if(typeof command!=="object")return;if(!command.name)command.name=name;this.addCommand(command)}),this)};this.removeCommands=function(commands){Object.keys(commands).forEach((function(name){this.removeCommand(commands[name])}),this)};this.bindKeys=function(keyList){Object.keys(keyList).forEach((function(key){this.bindKey(key,keyList[key])}),this)};this._buildKeyHash=function(command){this.bindKey(command.bindKey,command)};this.parseKeys=function(keys){var parts=keys.toLowerCase().split(/[\-\+]([\-\+])?/).filter((function(x){return x}));var key=parts.pop();var keyCode=keyUtil[key];if(keyUtil.FUNCTION_KEYS[keyCode])key=keyUtil.FUNCTION_KEYS[keyCode].toLowerCase();else if(!parts.length)return{key:key,hashId:-1};else if(parts.length==1&&parts[0]=="shift")return{key:key.toUpperCase(),hashId:-1};var hashId=0;for(var i=parts.length;i--;){var modifier=keyUtil.KEY_MODS[parts[i]];if(modifier==null){if(typeof console!="undefined")console.error("invalid modifier "+parts[i]+" in "+keys);return false}hashId|=modifier}return{key:key,hashId:hashId}};this.findKeyCommand=function findKeyCommand(hashId,keyString){var key=KEY_MODS[hashId]+keyString;return this.commandKeyBinding[key]};this.handleKeyboard=function(data,hashId,keyString,keyCode){if(keyCode<0)return;var key=KEY_MODS[hashId]+keyString;var command=this.commandKeyBinding[key];if(data.$keyChain){data.$keyChain+=" "+key;command=this.commandKeyBinding[data.$keyChain]||command}if(command){if(command=="chainKeys"||command[command.length-1]=="chainKeys"){data.$keyChain=data.$keyChain||key;return{command:"null"}}}if(data.$keyChain){if((!hashId||hashId==4)&&keyString.length==1)data.$keyChain=data.$keyChain.slice(0,-key.length-1);else if(hashId==-1||keyCode>0)data.$keyChain=""}return{command:command}};this.getStatusText=function(editor,data){return data.$keyChain||""}}).call(HashHandler.prototype);exports.HashHandler=HashHandler;exports.MultiHashHandler=MultiHashHandler}));ace.define("ace/commands/command_manager",["require","exports","module","ace/lib/oop","ace/keyboard/hash_handler","ace/lib/event_emitter"],(function(acequire,exports,module){"use strict";var oop=acequire("../lib/oop");var MultiHashHandler=acequire("../keyboard/hash_handler").MultiHashHandler;var EventEmitter=acequire("../lib/event_emitter").EventEmitter;var CommandManager=function(platform,commands){MultiHashHandler.call(this,commands,platform);this.byName=this.commands;this.setDefaultHandler("exec",(function(e){return e.command.exec(e.editor,e.args||{})}))};oop.inherits(CommandManager,MultiHashHandler);(function(){oop.implement(this,EventEmitter);this.exec=function(command,editor,args){if(Array.isArray(command)){for(var i=command.length;i--;){if(this.exec(command[i],editor,args))return true}return false}if(typeof command==="string")command=this.commands[command];if(!command)return false;if(editor&&editor.$readOnly&&!command.readOnly)return false;if(command.isAvailable&&!command.isAvailable(editor))return false;var e={editor:editor,command:command,args:args};e.returnValue=this._emit("exec",e);this._signal("afterExec",e);return e.returnValue===false?false:true};this.toggleRecording=function(editor){if(this.$inReplay)return;editor&&editor._emit("changeStatus");if(this.recording){this.macro.pop();this.removeEventListener("exec",this.$addCommandToMacro);if(!this.macro.length)this.macro=this.oldMacro;return this.recording=false}if(!this.$addCommandToMacro){this.$addCommandToMacro=function(e){this.macro.push([e.command,e.args])}.bind(this)}this.oldMacro=this.macro;this.macro=[];this.on("exec",this.$addCommandToMacro);return this.recording=true};this.replay=function(editor){if(this.$inReplay||!this.macro)return;if(this.recording)return this.toggleRecording(editor);try{this.$inReplay=true;this.macro.forEach((function(x){if(typeof x=="string")this.exec(x,editor);else this.exec(x[0],editor,x[1])}),this)}finally{this.$inReplay=false}};this.trimMacro=function(m){return m.map((function(x){if(typeof x[0]!="string")x[0]=x[0].name;if(!x[1])x=x[0];return x}))}}).call(CommandManager.prototype);exports.CommandManager=CommandManager}));ace.define("ace/commands/default_commands",["require","exports","module","ace/lib/lang","ace/config","ace/range"],(function(acequire,exports,module){"use strict";var lang=acequire("../lib/lang");var config=acequire("../config");var Range=acequire("../range").Range;function bindKey(win,mac){return{win:win,mac:mac}}exports.commands=[{name:"showSettingsMenu",bindKey:bindKey("Ctrl-,","Command-,"),exec:function(editor){config.loadModule("ace/ext/settings_menu",(function(module){module.init(editor);editor.showSettingsMenu()}))},readOnly:true},{name:"goToNextError",bindKey:bindKey("Alt-E","F4"),exec:function(editor){config.loadModule("ace/ext/error_marker",(function(module){module.showErrorMarker(editor,1)}))},scrollIntoView:"animate",readOnly:true},{name:"goToPreviousError",bindKey:bindKey("Alt-Shift-E","Shift-F4"),exec:function(editor){config.loadModule("ace/ext/error_marker",(function(module){module.showErrorMarker(editor,-1)}))},scrollIntoView:"animate",readOnly:true},{name:"selectall",bindKey:bindKey("Ctrl-A","Command-A"),exec:function(editor){editor.selectAll()},readOnly:true},{name:"centerselection",bindKey:bindKey(null,"Ctrl-L"),exec:function(editor){editor.centerSelection()},readOnly:true},{name:"gotoline",bindKey:bindKey("Ctrl-L","Command-L"),exec:function(editor){var line=parseInt(prompt("Enter line number:"),10);if(!isNaN(line)){editor.gotoLine(line)}},readOnly:true},{name:"fold",bindKey:bindKey("Alt-L|Ctrl-F1","Command-Alt-L|Command-F1"),exec:function(editor){editor.session.toggleFold(false)},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:true},{name:"unfold",bindKey:bindKey("Alt-Shift-L|Ctrl-Shift-F1","Command-Alt-Shift-L|Command-Shift-F1"),exec:function(editor){editor.session.toggleFold(true)},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:true},{name:"toggleFoldWidget",bindKey:bindKey("F2","F2"),exec:function(editor){editor.session.toggleFoldWidget()},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:true},{name:"toggleParentFoldWidget",bindKey:bindKey("Alt-F2","Alt-F2"),exec:function(editor){editor.session.toggleFoldWidget(true)},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:true},{name:"foldall",bindKey:bindKey(null,"Ctrl-Command-Option-0"),exec:function(editor){editor.session.foldAll()},scrollIntoView:"center",readOnly:true},{name:"foldOther",bindKey:bindKey("Alt-0","Command-Option-0"),exec:function(editor){editor.session.foldAll();editor.session.unfold(editor.selection.getAllRanges())},scrollIntoView:"center",readOnly:true},{name:"unfoldall",bindKey:bindKey("Alt-Shift-0","Command-Option-Shift-0"),exec:function(editor){editor.session.unfold()},scrollIntoView:"center",readOnly:true},{name:"findnext",bindKey:bindKey("Ctrl-K","Command-G"),exec:function(editor){editor.findNext()},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:true},{name:"findprevious",bindKey:bindKey("Ctrl-Shift-K","Command-Shift-G"),exec:function(editor){editor.findPrevious()},multiSelectAction:"forEach",scrollIntoView:"center",readOnly:true},{name:"selectOrFindNext",bindKey:bindKey("Alt-K","Ctrl-G"),exec:function(editor){if(editor.selection.isEmpty())editor.selection.selectWord();else editor.findNext()},readOnly:true},{name:"selectOrFindPrevious",bindKey:bindKey("Alt-Shift-K","Ctrl-Shift-G"),exec:function(editor){if(editor.selection.isEmpty())editor.selection.selectWord();else editor.findPrevious()},readOnly:true},{name:"find",bindKey:bindKey("Ctrl-F","Command-F"),exec:function(editor){config.loadModule("ace/ext/searchbox",(function(e){e.Search(editor)}))},readOnly:true},{name:"overwrite",bindKey:"Insert",exec:function(editor){editor.toggleOverwrite()},readOnly:true},{name:"selecttostart",bindKey:bindKey("Ctrl-Shift-Home","Command-Shift-Home|Command-Shift-Up"),exec:function(editor){editor.getSelection().selectFileStart()},multiSelectAction:"forEach",readOnly:true,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"gotostart",bindKey:bindKey("Ctrl-Home","Command-Home|Command-Up"),exec:function(editor){editor.navigateFileStart()},multiSelectAction:"forEach",readOnly:true,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"selectup",bindKey:bindKey("Shift-Up","Shift-Up|Ctrl-Shift-P"),exec:function(editor){editor.getSelection().selectUp()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:true},{name:"golineup",bindKey:bindKey("Up","Up|Ctrl-P"),exec:function(editor,args){editor.navigateUp(args.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:true},{name:"selecttoend",bindKey:bindKey("Ctrl-Shift-End","Command-Shift-End|Command-Shift-Down"),exec:function(editor){editor.getSelection().selectFileEnd()},multiSelectAction:"forEach",readOnly:true,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"gotoend",bindKey:bindKey("Ctrl-End","Command-End|Command-Down"),exec:function(editor){editor.navigateFileEnd()},multiSelectAction:"forEach",readOnly:true,scrollIntoView:"animate",aceCommandGroup:"fileJump"},{name:"selectdown",bindKey:bindKey("Shift-Down","Shift-Down|Ctrl-Shift-N"),exec:function(editor){editor.getSelection().selectDown()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:true},{name:"golinedown",bindKey:bindKey("Down","Down|Ctrl-N"),exec:function(editor,args){editor.navigateDown(args.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:true},{name:"selectwordleft",bindKey:bindKey("Ctrl-Shift-Left","Option-Shift-Left"),exec:function(editor){editor.getSelection().selectWordLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:true},{name:"gotowordleft",bindKey:bindKey("Ctrl-Left","Option-Left"),exec:function(editor){editor.navigateWordLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:true},{name:"selecttolinestart",bindKey:bindKey("Alt-Shift-Left","Command-Shift-Left|Ctrl-Shift-A"),exec:function(editor){editor.getSelection().selectLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:true},{name:"gotolinestart",bindKey:bindKey("Alt-Left|Home","Command-Left|Home|Ctrl-A"),exec:function(editor){editor.navigateLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:true},{name:"selectleft",bindKey:bindKey("Shift-Left","Shift-Left|Ctrl-Shift-B"),exec:function(editor){editor.getSelection().selectLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:true},{name:"gotoleft",bindKey:bindKey("Left","Left|Ctrl-B"),exec:function(editor,args){editor.navigateLeft(args.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:true},{name:"selectwordright",bindKey:bindKey("Ctrl-Shift-Right","Option-Shift-Right"),exec:function(editor){editor.getSelection().selectWordRight()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:true},{name:"gotowordright",bindKey:bindKey("Ctrl-Right","Option-Right"),exec:function(editor){editor.navigateWordRight()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:true},{name:"selecttolineend",bindKey:bindKey("Alt-Shift-Right","Command-Shift-Right|Shift-End|Ctrl-Shift-E"),exec:function(editor){editor.getSelection().selectLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:true},{name:"gotolineend",bindKey:bindKey("Alt-Right|End","Command-Right|End|Ctrl-E"),exec:function(editor){editor.navigateLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:true},{name:"selectright",bindKey:bindKey("Shift-Right","Shift-Right"),exec:function(editor){editor.getSelection().selectRight()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:true},{name:"gotoright",bindKey:bindKey("Right","Right|Ctrl-F"),exec:function(editor,args){editor.navigateRight(args.times)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:true},{name:"selectpagedown",bindKey:"Shift-PageDown",exec:function(editor){editor.selectPageDown()},readOnly:true},{name:"pagedown",bindKey:bindKey(null,"Option-PageDown"),exec:function(editor){editor.scrollPageDown()},readOnly:true},{name:"gotopagedown",bindKey:bindKey("PageDown","PageDown|Ctrl-V"),exec:function(editor){editor.gotoPageDown()},readOnly:true},{name:"selectpageup",bindKey:"Shift-PageUp",exec:function(editor){editor.selectPageUp()},readOnly:true},{name:"pageup",bindKey:bindKey(null,"Option-PageUp"),exec:function(editor){editor.scrollPageUp()},readOnly:true},{name:"gotopageup",bindKey:"PageUp",exec:function(editor){editor.gotoPageUp()},readOnly:true},{name:"scrollup",bindKey:bindKey("Ctrl-Up",null),exec:function(e){e.renderer.scrollBy(0,-2*e.renderer.layerConfig.lineHeight)},readOnly:true},{name:"scrolldown",bindKey:bindKey("Ctrl-Down",null),exec:function(e){e.renderer.scrollBy(0,2*e.renderer.layerConfig.lineHeight)},readOnly:true},{name:"selectlinestart",bindKey:"Shift-Home",exec:function(editor){editor.getSelection().selectLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:true},{name:"selectlineend",bindKey:"Shift-End",exec:function(editor){editor.getSelection().selectLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:true},{name:"togglerecording",bindKey:bindKey("Ctrl-Alt-E","Command-Option-E"),exec:function(editor){editor.commands.toggleRecording(editor)},readOnly:true},{name:"replaymacro",bindKey:bindKey("Ctrl-Shift-E","Command-Shift-E"),exec:function(editor){editor.commands.replay(editor)},readOnly:true},{name:"jumptomatching",bindKey:bindKey("Ctrl-P","Ctrl-P"),exec:function(editor){editor.jumpToMatching()},multiSelectAction:"forEach",scrollIntoView:"animate",readOnly:true},{name:"selecttomatching",bindKey:bindKey("Ctrl-Shift-P","Ctrl-Shift-P"),exec:function(editor){editor.jumpToMatching(true)},multiSelectAction:"forEach",scrollIntoView:"animate",readOnly:true},{name:"expandToMatching",bindKey:bindKey("Ctrl-Shift-M","Ctrl-Shift-M"),exec:function(editor){editor.jumpToMatching(true,true)},multiSelectAction:"forEach",scrollIntoView:"animate",readOnly:true},{name:"passKeysToBrowser",bindKey:bindKey(null,null),exec:function(){},passEvent:true,readOnly:true},{name:"copy",exec:function(editor){},readOnly:true},{name:"cut",exec:function(editor){var range=editor.getSelectionRange();editor._emit("cut",range);if(!editor.selection.isEmpty()){editor.session.remove(range);editor.clearSelection()}},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"paste",exec:function(editor,args){editor.$handlePaste(args)},scrollIntoView:"cursor"},{name:"removeline",bindKey:bindKey("Ctrl-D","Command-D"),exec:function(editor){editor.removeLines()},scrollIntoView:"cursor",multiSelectAction:"forEachLine"},{name:"duplicateSelection",bindKey:bindKey("Ctrl-Shift-D","Command-Shift-D"),exec:function(editor){editor.duplicateSelection()},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"sortlines",bindKey:bindKey("Ctrl-Alt-S","Command-Alt-S"),exec:function(editor){editor.sortLines()},scrollIntoView:"selection",multiSelectAction:"forEachLine"},{name:"togglecomment",bindKey:bindKey("Ctrl-/","Command-/"),exec:function(editor){editor.toggleCommentLines()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"},{name:"toggleBlockComment",bindKey:bindKey("Ctrl-Shift-/","Command-Shift-/"),exec:function(editor){editor.toggleBlockComment()},multiSelectAction:"forEach",scrollIntoView:"selectionPart"},{name:"modifyNumberUp",bindKey:bindKey("Ctrl-Shift-Up","Alt-Shift-Up"),exec:function(editor){editor.modifyNumber(1)},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"modifyNumberDown",bindKey:bindKey("Ctrl-Shift-Down","Alt-Shift-Down"),exec:function(editor){editor.modifyNumber(-1)},scrollIntoView:"cursor",multiSelectAction:"forEach"},{name:"replace",bindKey:bindKey("Ctrl-H","Command-Option-F"),exec:function(editor){config.loadModule("ace/ext/searchbox",(function(e){e.Search(editor,true)}))}},{name:"undo",bindKey:bindKey("Ctrl-Z","Command-Z"),exec:function(editor){editor.undo()}},{name:"redo",bindKey:bindKey("Ctrl-Shift-Z|Ctrl-Y","Command-Shift-Z|Command-Y"),exec:function(editor){editor.redo()}},{name:"copylinesup",bindKey:bindKey("Alt-Shift-Up","Command-Option-Up"),exec:function(editor){editor.copyLinesUp()},scrollIntoView:"cursor"},{name:"movelinesup",bindKey:bindKey("Alt-Up","Option-Up"),exec:function(editor){editor.moveLinesUp()},scrollIntoView:"cursor"},{name:"copylinesdown",bindKey:bindKey("Alt-Shift-Down","Command-Option-Down"),exec:function(editor){editor.copyLinesDown()},scrollIntoView:"cursor"},{name:"movelinesdown",bindKey:bindKey("Alt-Down","Option-Down"),exec:function(editor){editor.moveLinesDown()},scrollIntoView:"cursor"},{name:"del",bindKey:bindKey("Delete","Delete|Ctrl-D|Shift-Delete"),exec:function(editor){editor.remove("right")},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"backspace",bindKey:bindKey("Shift-Backspace|Backspace","Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"),exec:function(editor){editor.remove("left")},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"cut_or_delete",bindKey:bindKey("Shift-Delete",null),exec:function(editor){if(editor.selection.isEmpty()){editor.remove("left")}else{return false}},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolinestart",bindKey:bindKey("Alt-Backspace","Command-Backspace"),exec:function(editor){editor.removeToLineStart()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolineend",bindKey:bindKey("Alt-Delete","Ctrl-K|Command-Delete"),exec:function(editor){editor.removeToLineEnd()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolinestarthard",bindKey:bindKey("Ctrl-Shift-Backspace",null),exec:function(editor){var range=editor.selection.getRange();range.start.column=0;editor.session.remove(range)},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removetolineendhard",bindKey:bindKey("Ctrl-Shift-Delete",null),exec:function(editor){var range=editor.selection.getRange();range.end.column=Number.MAX_VALUE;editor.session.remove(range)},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removewordleft",bindKey:bindKey("Ctrl-Backspace","Alt-Backspace|Ctrl-Alt-Backspace"),exec:function(editor){editor.removeWordLeft()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"removewordright",bindKey:bindKey("Ctrl-Delete","Alt-Delete"),exec:function(editor){editor.removeWordRight()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"outdent",bindKey:bindKey("Shift-Tab","Shift-Tab"),exec:function(editor){editor.blockOutdent()},multiSelectAction:"forEach",scrollIntoView:"selectionPart"},{name:"indent",bindKey:bindKey("Tab","Tab"),exec:function(editor){editor.indent()},multiSelectAction:"forEach",scrollIntoView:"selectionPart"},{name:"blockoutdent",bindKey:bindKey("Ctrl-[","Ctrl-["),exec:function(editor){editor.blockOutdent()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"},{name:"blockindent",bindKey:bindKey("Ctrl-]","Ctrl-]"),exec:function(editor){editor.blockIndent()},multiSelectAction:"forEachLine",scrollIntoView:"selectionPart"},{name:"insertstring",exec:function(editor,str){editor.insert(str)},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"inserttext",exec:function(editor,args){editor.insert(lang.stringRepeat(args.text||"",args.times||1))},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"splitline",bindKey:bindKey(null,"Ctrl-O"),exec:function(editor){editor.splitLine()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"transposeletters",bindKey:bindKey("Alt-Shift-X","Ctrl-T"),exec:function(editor){editor.transposeLetters()},multiSelectAction:function(editor){editor.transposeSelections(1)},scrollIntoView:"cursor"},{name:"touppercase",bindKey:bindKey("Ctrl-U","Ctrl-U"),exec:function(editor){editor.toUpperCase()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"tolowercase",bindKey:bindKey("Ctrl-Shift-U","Ctrl-Shift-U"),exec:function(editor){editor.toLowerCase()},multiSelectAction:"forEach",scrollIntoView:"cursor"},{name:"expandtoline",bindKey:bindKey("Ctrl-Shift-L","Command-Shift-L"),exec:function(editor){var range=editor.selection.getRange();range.start.column=range.end.column=0;range.end.row++;editor.selection.setRange(range,false)},multiSelectAction:"forEach",scrollIntoView:"cursor",readOnly:true},{name:"joinlines",bindKey:bindKey(null,null),exec:function(editor){var isBackwards=editor.selection.isBackwards();var selectionStart=isBackwards?editor.selection.getSelectionLead():editor.selection.getSelectionAnchor();var selectionEnd=isBackwards?editor.selection.getSelectionAnchor():editor.selection.getSelectionLead();var firstLineEndCol=editor.session.doc.getLine(selectionStart.row).length;var selectedText=editor.session.doc.getTextRange(editor.selection.getRange());var selectedCount=selectedText.replace(/\n\s*/," ").length;var insertLine=editor.session.doc.getLine(selectionStart.row);for(var i=selectionStart.row+1;i<=selectionEnd.row+1;i++){var curLine=lang.stringTrimLeft(lang.stringTrimRight(editor.session.doc.getLine(i)));if(curLine.length!==0){curLine=" "+curLine}insertLine+=curLine}if(selectionEnd.row+1<editor.session.doc.getLength()-1){insertLine+=editor.session.doc.getNewLineCharacter()}editor.clearSelection();editor.session.doc.replace(new Range(selectionStart.row,0,selectionEnd.row+2,0),insertLine);if(selectedCount>0){editor.selection.moveCursorTo(selectionStart.row,selectionStart.column);editor.selection.selectTo(selectionStart.row,selectionStart.column+selectedCount)}else{firstLineEndCol=editor.session.doc.getLine(selectionStart.row).length>firstLineEndCol?firstLineEndCol+1:firstLineEndCol;editor.selection.moveCursorTo(selectionStart.row,firstLineEndCol)}},multiSelectAction:"forEach",readOnly:true},{name:"invertSelection",bindKey:bindKey(null,null),exec:function(editor){var endRow=editor.session.doc.getLength()-1;var endCol=editor.session.doc.getLine(endRow).length;var ranges=editor.selection.rangeList.ranges;var newRanges=[];if(ranges.length<1){ranges=[editor.selection.getRange()]}for(var i=0;i<ranges.length;i++){if(i==ranges.length-1){if(!(ranges[i].end.row===endRow&&ranges[i].end.column===endCol)){newRanges.push(new Range(ranges[i].end.row,ranges[i].end.column,endRow,endCol))}}if(i===0){if(!(ranges[i].start.row===0&&ranges[i].start.column===0)){newRanges.push(new Range(0,0,ranges[i].start.row,ranges[i].start.column))}}else{newRanges.push(new Range(ranges[i-1].end.row,ranges[i-1].end.column,ranges[i].start.row,ranges[i].start.column))}}editor.exitMultiSelectMode();editor.clearSelection();for(var i=0;i<newRanges.length;i++){editor.selection.addRange(newRanges[i],false)}},readOnly:true,scrollIntoView:"none"}]}));ace.define("ace/editor",["require","exports","module","ace/lib/fixoldbrowsers","ace/lib/oop","ace/lib/dom","ace/lib/lang","ace/lib/useragent","ace/keyboard/textinput","ace/mouse/mouse_handler","ace/mouse/fold_handler","ace/keyboard/keybinding","ace/edit_session","ace/search","ace/range","ace/lib/event_emitter","ace/commands/command_manager","ace/commands/default_commands","ace/config","ace/token_iterator"],(function(acequire,exports,module){"use strict";acequire("./lib/fixoldbrowsers");var oop=acequire("./lib/oop");var dom=acequire("./lib/dom");var lang=acequire("./lib/lang");var useragent=acequire("./lib/useragent");var TextInput=acequire("./keyboard/textinput").TextInput;var MouseHandler=acequire("./mouse/mouse_handler").MouseHandler;var FoldHandler=acequire("./mouse/fold_handler").FoldHandler;var KeyBinding=acequire("./keyboard/keybinding").KeyBinding;var EditSession=acequire("./edit_session").EditSession;var Search=acequire("./search").Search;var Range=acequire("./range").Range;var EventEmitter=acequire("./lib/event_emitter").EventEmitter;var CommandManager=acequire("./commands/command_manager").CommandManager;var defaultCommands=acequire("./commands/default_commands").commands;var config=acequire("./config");var TokenIterator=acequire("./token_iterator").TokenIterator;var Editor=function(renderer,session){var container=renderer.getContainerElement();this.container=container;this.renderer=renderer;this.id="editor"+ ++Editor.$uid;this.commands=new CommandManager(useragent.isMac?"mac":"win",defaultCommands);if(typeof document=="object"){this.textInput=new TextInput(renderer.getTextAreaContainer(),this);this.renderer.textarea=this.textInput.getElement();this.$mouseHandler=new MouseHandler(this);new FoldHandler(this)}this.keyBinding=new KeyBinding(this);this.$blockScrolling=0;this.$search=(new Search).set({wrap:true});this.$historyTracker=this.$historyTracker.bind(this);this.commands.on("exec",this.$historyTracker);this.$initOperationListeners();this._$emitInputEvent=lang.delayedCall(function(){this._signal("input",{});if(this.session&&this.session.bgTokenizer)this.session.bgTokenizer.scheduleStart()}.bind(this));this.on("change",(function(_,_self){_self._$emitInputEvent.schedule(31)}));this.setSession(session||new EditSession(""));config.resetOptions(this);config._signal("editor",this)};Editor.$uid=0;(function(){oop.implement(this,EventEmitter);this.$initOperationListeners=function(){function last(a){return a[a.length-1]}this.selections=[];this.commands.on("exec",this.startOperation.bind(this),true);this.commands.on("afterExec",this.endOperation.bind(this),true);this.$opResetTimer=lang.delayedCall(this.endOperation.bind(this));this.on("change",function(){this.curOp||this.startOperation();this.curOp.docChanged=true}.bind(this),true);this.on("changeSelection",function(){this.curOp||this.startOperation();this.curOp.selectionChanged=true}.bind(this),true)};this.curOp=null;this.prevOp={};this.startOperation=function(commadEvent){if(this.curOp){if(!commadEvent||this.curOp.command)return;this.prevOp=this.curOp}if(!commadEvent){this.previousCommand=null;commadEvent={}}this.$opResetTimer.schedule();this.curOp={command:commadEvent.command||{},args:commadEvent.args,scrollTop:this.renderer.scrollTop};if(this.curOp.command.name&&this.curOp.command.scrollIntoView!==undefined)this.$blockScrolling++};this.endOperation=function(e){if(this.curOp){if(e&&e.returnValue===false)return this.curOp=null;this._signal("beforeEndOperation");var command=this.curOp.command;if(command.name&&this.$blockScrolling>0)this.$blockScrolling--;var scrollIntoView=command&&command.scrollIntoView;if(scrollIntoView){switch(scrollIntoView){case"center-animate":scrollIntoView="animate";case"center":this.renderer.scrollCursorIntoView(null,.5);break;case"animate":case"cursor":this.renderer.scrollCursorIntoView();break;case"selectionPart":var range=this.selection.getRange();var config=this.renderer.layerConfig;if(range.start.row>=config.lastRow||range.end.row<=config.firstRow){this.renderer.scrollSelectionIntoView(this.selection.anchor,this.selection.lead)}break;default:break}if(scrollIntoView=="animate")this.renderer.animateScrolling(this.curOp.scrollTop)}this.prevOp=this.curOp;this.curOp=null}};this.$mergeableCommands=["backspace","del","insertstring"];this.$historyTracker=function(e){if(!this.$mergeUndoDeltas)return;var prev=this.prevOp;var mergeableCommands=this.$mergeableCommands;var shouldMerge=prev.command&&e.command.name==prev.command.name;if(e.command.name=="insertstring"){var text=e.args;if(this.mergeNextCommand===undefined)this.mergeNextCommand=true;shouldMerge=shouldMerge&&this.mergeNextCommand&&(!/\s/.test(text)||/\s/.test(prev.args));this.mergeNextCommand=true}else{shouldMerge=shouldMerge&&mergeableCommands.indexOf(e.command.name)!==-1}if(this.$mergeUndoDeltas!="always"&&Date.now()-this.sequenceStartTime>2e3){shouldMerge=false}if(shouldMerge)this.session.mergeUndoDeltas=true;else if(mergeableCommands.indexOf(e.command.name)!==-1)this.sequenceStartTime=Date.now()};this.setKeyboardHandler=function(keyboardHandler,cb){if(keyboardHandler&&typeof keyboardHandler==="string"){this.$keybindingId=keyboardHandler;var _self=this;config.loadModule(["keybinding",keyboardHandler],(function(module){if(_self.$keybindingId==keyboardHandler)_self.keyBinding.setKeyboardHandler(module&&module.handler);cb&&cb()}))}else{this.$keybindingId=null;this.keyBinding.setKeyboardHandler(keyboardHandler);cb&&cb()}};this.getKeyboardHandler=function(){return this.keyBinding.getKeyboardHandler()};this.setSession=function(session){if(this.session==session)return;if(this.curOp)this.endOperation();this.curOp={};var oldSession=this.session;if(oldSession){this.session.off("change",this.$onDocumentChange);this.session.off("changeMode",this.$onChangeMode);this.session.off("tokenizerUpdate",this.$onTokenizerUpdate);this.session.off("changeTabSize",this.$onChangeTabSize);this.session.off("changeWrapLimit",this.$onChangeWrapLimit);this.session.off("changeWrapMode",this.$onChangeWrapMode);this.session.off("changeFold",this.$onChangeFold);this.session.off("changeFrontMarker",this.$onChangeFrontMarker);this.session.off("changeBackMarker",this.$onChangeBackMarker);this.session.off("changeBreakpoint",this.$onChangeBreakpoint);this.session.off("changeAnnotation",this.$onChangeAnnotation);this.session.off("changeOverwrite",this.$onCursorChange);this.session.off("changeScrollTop",this.$onScrollTopChange);this.session.off("changeScrollLeft",this.$onScrollLeftChange);var selection=this.session.getSelection();selection.off("changeCursor",this.$onCursorChange);selection.off("changeSelection",this.$onSelectionChange)}this.session=session;if(session){this.$onDocumentChange=this.onDocumentChange.bind(this);session.on("change",this.$onDocumentChange);this.renderer.setSession(session);this.$onChangeMode=this.onChangeMode.bind(this);session.on("changeMode",this.$onChangeMode);this.$onTokenizerUpdate=this.onTokenizerUpdate.bind(this);session.on("tokenizerUpdate",this.$onTokenizerUpdate);this.$onChangeTabSize=this.renderer.onChangeTabSize.bind(this.renderer);session.on("changeTabSize",this.$onChangeTabSize);this.$onChangeWrapLimit=this.onChangeWrapLimit.bind(this);session.on("changeWrapLimit",this.$onChangeWrapLimit);this.$onChangeWrapMode=this.onChangeWrapMode.bind(this);session.on("changeWrapMode",this.$onChangeWrapMode);this.$onChangeFold=this.onChangeFold.bind(this);session.on("changeFold",this.$onChangeFold);this.$onChangeFrontMarker=this.onChangeFrontMarker.bind(this);this.session.on("changeFrontMarker",this.$onChangeFrontMarker);this.$onChangeBackMarker=this.onChangeBackMarker.bind(this);this.session.on("changeBackMarker",this.$onChangeBackMarker);this.$onChangeBreakpoint=this.onChangeBreakpoint.bind(this);this.session.on("changeBreakpoint",this.$onChangeBreakpoint);this.$onChangeAnnotation=this.onChangeAnnotation.bind(this);this.session.on("changeAnnotation",this.$onChangeAnnotation);this.$onCursorChange=this.onCursorChange.bind(this);this.session.on("changeOverwrite",this.$onCursorChange);this.$onScrollTopChange=this.onScrollTopChange.bind(this);this.session.on("changeScrollTop",this.$onScrollTopChange);this.$onScrollLeftChange=this.onScrollLeftChange.bind(this);this.session.on("changeScrollLeft",this.$onScrollLeftChange);this.selection=session.getSelection();this.selection.on("changeCursor",this.$onCursorChange);this.$onSelectionChange=this.onSelectionChange.bind(this);this.selection.on("changeSelection",this.$onSelectionChange);this.onChangeMode();this.$blockScrolling+=1;this.onCursorChange();this.$blockScrolling-=1;this.onScrollTopChange();this.onScrollLeftChange();this.onSelectionChange();this.onChangeFrontMarker();this.onChangeBackMarker();this.onChangeBreakpoint();this.onChangeAnnotation();this.session.getUseWrapMode()&&this.renderer.adjustWrapLimit();this.renderer.updateFull()}else{this.selection=null;this.renderer.setSession(session)}this._signal("changeSession",{session:session,oldSession:oldSession});this.curOp=null;oldSession&&oldSession._signal("changeEditor",{oldEditor:this});session&&session._signal("changeEditor",{editor:this});if(session&&session.bgTokenizer)session.bgTokenizer.scheduleStart()};this.getSession=function(){return this.session};this.setValue=function(val,cursorPos){this.session.doc.setValue(val);if(!cursorPos)this.selectAll();else if(cursorPos==1)this.navigateFileEnd();else if(cursorPos==-1)this.navigateFileStart();return val};this.getValue=function(){return this.session.getValue()};this.getSelection=function(){return this.selection};this.resize=function(force){this.renderer.onResize(force)};this.setTheme=function(theme,cb){this.renderer.setTheme(theme,cb)};this.getTheme=function(){return this.renderer.getTheme()};this.setStyle=function(style){this.renderer.setStyle(style)};this.unsetStyle=function(style){this.renderer.unsetStyle(style)};this.getFontSize=function(){return this.getOption("fontSize")||dom.computedStyle(this.container,"fontSize")};this.setFontSize=function(size){this.setOption("fontSize",size)};this.$highlightBrackets=function(){if(this.session.$bracketHighlight){this.session.removeMarker(this.session.$bracketHighlight);this.session.$bracketHighlight=null}if(this.$highlightPending){return}var self=this;this.$highlightPending=true;setTimeout((function(){self.$highlightPending=false;var session=self.session;if(!session||!session.bgTokenizer)return;var pos=session.findMatchingBracket(self.getCursorPosition());if(pos){var range=new Range(pos.row,pos.column,pos.row,pos.column+1)}else if(session.$mode.getMatching){var range=session.$mode.getMatching(self.session)}if(range)session.$bracketHighlight=session.addMarker(range,"ace_bracket","text")}),50)};this.$highlightTags=function(){if(this.$highlightTagPending)return;var self=this;this.$highlightTagPending=true;setTimeout((function(){self.$highlightTagPending=false;var session=self.session;if(!session||!session.bgTokenizer)return;var pos=self.getCursorPosition();var iterator=new TokenIterator(self.session,pos.row,pos.column);var token=iterator.getCurrentToken();if(!token||!/\b(?:tag-open|tag-name)/.test(token.type)){session.removeMarker(session.$tagHighlight);session.$tagHighlight=null;return}if(token.type.indexOf("tag-open")!=-1){token=iterator.stepForward();if(!token)return}var tag=token.value;var depth=0;var prevToken=iterator.stepBackward();if(prevToken.value=="<"){do{prevToken=token;token=iterator.stepForward();if(token&&token.value===tag&&token.type.indexOf("tag-name")!==-1){if(prevToken.value==="<"){depth++}else if(prevToken.value==="</"){depth--}}}while(token&&depth>=0)}else{do{token=prevToken;prevToken=iterator.stepBackward();if(token&&token.value===tag&&token.type.indexOf("tag-name")!==-1){if(prevToken.value==="<"){depth++}else if(prevToken.value==="</"){depth--}}}while(prevToken&&depth<=0);iterator.stepForward()}if(!token){session.removeMarker(session.$tagHighlight);session.$tagHighlight=null;return}var row=iterator.getCurrentTokenRow();var column=iterator.getCurrentTokenColumn();var range=new Range(row,column,row,column+token.value.length);var sbm=session.$backMarkers[session.$tagHighlight];if(session.$tagHighlight&&sbm!=undefined&&range.compareRange(sbm.range)!==0){session.removeMarker(session.$tagHighlight);session.$tagHighlight=null}if(range&&!session.$tagHighlight)session.$tagHighlight=session.addMarker(range,"ace_bracket","text")}),50)};this.focus=function(){var _self=this;setTimeout((function(){_self.textInput.focus()}));this.textInput.focus()};this.isFocused=function(){return this.textInput.isFocused()};this.blur=function(){this.textInput.blur()};this.onFocus=function(e){if(this.$isFocused)return;this.$isFocused=true;this.renderer.showCursor();this.renderer.visualizeFocus();this._emit("focus",e)};this.onBlur=function(e){if(!this.$isFocused)return;this.$isFocused=false;this.renderer.hideCursor();this.renderer.visualizeBlur();this._emit("blur",e)};this.$cursorChange=function(){this.renderer.updateCursor()};this.onDocumentChange=function(delta){var wrap=this.session.$useWrapMode;var lastRow=delta.start.row==delta.end.row?delta.end.row:Infinity;this.renderer.updateLines(delta.start.row,lastRow,wrap);this._signal("change",delta);this.$cursorChange();this.$updateHighlightActiveLine()};this.onTokenizerUpdate=function(e){var rows=e.data;this.renderer.updateLines(rows.first,rows.last)};this.onScrollTopChange=function(){this.renderer.scrollToY(this.session.getScrollTop())};this.onScrollLeftChange=function(){this.renderer.scrollToX(this.session.getScrollLeft())};this.onCursorChange=function(){this.$cursorChange();if(!this.$blockScrolling){config.warn("Automatically scrolling cursor into view after selection change","this will be disabled in the next version","set editor.$blockScrolling = Infinity to disable this message");this.renderer.scrollCursorIntoView()}this.$highlightBrackets();this.$highlightTags();this.$updateHighlightActiveLine();this._signal("changeSelection")};this.$updateHighlightActiveLine=function(){var session=this.getSession();var highlight;if(this.$highlightActiveLine){if(this.$selectionStyle!="line"||!this.selection.isMultiLine())highlight=this.getCursorPosition();if(this.renderer.$maxLines&&this.session.getLength()===1&&!(this.renderer.$minLines>1))highlight=false}if(session.$highlightLineMarker&&!highlight){session.removeMarker(session.$highlightLineMarker.id);session.$highlightLineMarker=null}else if(!session.$highlightLineMarker&&highlight){var range=new Range(highlight.row,highlight.column,highlight.row,Infinity);range.id=session.addMarker(range,"ace_active-line","screenLine");session.$highlightLineMarker=range}else if(highlight){session.$highlightLineMarker.start.row=highlight.row;session.$highlightLineMarker.end.row=highlight.row;session.$highlightLineMarker.start.column=highlight.column;session._signal("changeBackMarker")}};this.onSelectionChange=function(e){var session=this.session;if(session.$selectionMarker){session.removeMarker(session.$selectionMarker)}session.$selectionMarker=null;if(!this.selection.isEmpty()){var range=this.selection.getRange();var style=this.getSelectionStyle();session.$selectionMarker=session.addMarker(range,"ace_selection",style)}else{this.$updateHighlightActiveLine()}var re=this.$highlightSelectedWord&&this.$getSelectionHighLightRegexp();this.session.highlight(re);this._signal("changeSelection")};this.$getSelectionHighLightRegexp=function(){var session=this.session;var selection=this.getSelectionRange();if(selection.isEmpty()||selection.isMultiLine())return;var startOuter=selection.start.column-1;var endOuter=selection.end.column+1;var line=session.getLine(selection.start.row);var lineCols=line.length;var needle=line.substring(Math.max(startOuter,0),Math.min(endOuter,lineCols));if(startOuter>=0&&/^[\w\d]/.test(needle)||endOuter<=lineCols&&/[\w\d]$/.test(needle))return;needle=line.substring(selection.start.column,selection.end.column);if(!/^[\w\d]+$/.test(needle))return;var re=this.$search.$assembleRegExp({wholeWord:true,caseSensitive:true,needle:needle});return re};this.onChangeFrontMarker=function(){this.renderer.updateFrontMarkers()};this.onChangeBackMarker=function(){this.renderer.updateBackMarkers()};this.onChangeBreakpoint=function(){this.renderer.updateBreakpoints()};this.onChangeAnnotation=function(){this.renderer.setAnnotations(this.session.getAnnotations())};this.onChangeMode=function(e){this.renderer.updateText();this._emit("changeMode",e)};this.onChangeWrapLimit=function(){this.renderer.updateFull()};this.onChangeWrapMode=function(){this.renderer.onResize(true)};this.onChangeFold=function(){this.$updateHighlightActiveLine();this.renderer.updateFull()};this.getSelectedText=function(){return this.session.getTextRange(this.getSelectionRange())};this.getCopyText=function(){var text=this.getSelectedText();this._signal("copy",text);return text};this.onCopy=function(){this.commands.exec("copy",this)};this.onCut=function(){this.commands.exec("cut",this)};this.onPaste=function(text,event){var e={text:text,event:event};this.commands.exec("paste",this,e)};this.$handlePaste=function(e){if(typeof e=="string")e={text:e};this._signal("paste",e);var text=e.text;if(!this.inMultiSelectMode||this.inVirtualSelectionMode){this.insert(text)}else{var lines=text.split(/\r\n|\r|\n/);var ranges=this.selection.rangeList.ranges;if(lines.length>ranges.length||lines.length<2||!lines[1])return this.commands.exec("insertstring",this,text);for(var i=ranges.length;i--;){var range=ranges[i];if(!range.isEmpty())this.session.remove(range);this.session.insert(range.start,lines[i])}}};this.execCommand=function(command,args){return this.commands.exec(command,this,args)};this.insert=function(text,pasted){var session=this.session;var mode=session.getMode();var cursor=this.getCursorPosition();if(this.getBehavioursEnabled()&&!pasted){var transform=mode.transformAction(session.getState(cursor.row),"insertion",this,session,text);if(transform){if(text!==transform.text){this.session.mergeUndoDeltas=false;this.$mergeNextCommand=false}text=transform.text}}if(text=="\t")text=this.session.getTabString();if(!this.selection.isEmpty()){var range=this.getSelectionRange();cursor=this.session.remove(range);this.clearSelection()}else if(this.session.getOverwrite()&&text.indexOf("\n")==-1){var range=new Range.fromPoints(cursor,cursor);range.end.column+=text.length;this.session.remove(range)}if(text=="\n"||text=="\r\n"){var line=session.getLine(cursor.row);if(cursor.column>line.search(/\S|$/)){var d=line.substr(cursor.column).search(/\S|$/);session.doc.removeInLine(cursor.row,cursor.column,cursor.column+d)}}this.clearSelection();var start=cursor.column;var lineState=session.getState(cursor.row);var line=session.getLine(cursor.row);var shouldOutdent=mode.checkOutdent(lineState,line,text);var end=session.insert(cursor,text);if(transform&&transform.selection){if(transform.selection.length==2){this.selection.setSelectionRange(new Range(cursor.row,start+transform.selection[0],cursor.row,start+transform.selection[1]))}else{this.selection.setSelectionRange(new Range(cursor.row+transform.selection[0],transform.selection[1],cursor.row+transform.selection[2],transform.selection[3]))}}if(session.getDocument().isNewLine(text)){var lineIndent=mode.getNextLineIndent(lineState,line.slice(0,cursor.column),session.getTabString());session.insert({row:cursor.row+1,column:0},lineIndent)}if(shouldOutdent)mode.autoOutdent(lineState,session,cursor.row)};this.onTextInput=function(text){this.keyBinding.onTextInput(text)};this.onCommandKey=function(e,hashId,keyCode){this.keyBinding.onCommandKey(e,hashId,keyCode)};this.setOverwrite=function(overwrite){this.session.setOverwrite(overwrite)};this.getOverwrite=function(){return this.session.getOverwrite()};this.toggleOverwrite=function(){this.session.toggleOverwrite()};this.setScrollSpeed=function(speed){this.setOption("scrollSpeed",speed)};this.getScrollSpeed=function(){return this.getOption("scrollSpeed")};this.setDragDelay=function(dragDelay){this.setOption("dragDelay",dragDelay)};this.getDragDelay=function(){return this.getOption("dragDelay")};this.setSelectionStyle=function(val){this.setOption("selectionStyle",val)};this.getSelectionStyle=function(){return this.getOption("selectionStyle")};this.setHighlightActiveLine=function(shouldHighlight){this.setOption("highlightActiveLine",shouldHighlight)};this.getHighlightActiveLine=function(){return this.getOption("highlightActiveLine")};this.setHighlightGutterLine=function(shouldHighlight){this.setOption("highlightGutterLine",shouldHighlight)};this.getHighlightGutterLine=function(){return this.getOption("highlightGutterLine")};this.setHighlightSelectedWord=function(shouldHighlight){this.setOption("highlightSelectedWord",shouldHighlight)};this.getHighlightSelectedWord=function(){return this.$highlightSelectedWord};this.setAnimatedScroll=function(shouldAnimate){this.renderer.setAnimatedScroll(shouldAnimate)};this.getAnimatedScroll=function(){return this.renderer.getAnimatedScroll()};this.setShowInvisibles=function(showInvisibles){this.renderer.setShowInvisibles(showInvisibles)};this.getShowInvisibles=function(){return this.renderer.getShowInvisibles()};this.setDisplayIndentGuides=function(display){this.renderer.setDisplayIndentGuides(display)};this.getDisplayIndentGuides=function(){return this.renderer.getDisplayIndentGuides()};this.setShowPrintMargin=function(showPrintMargin){this.renderer.setShowPrintMargin(showPrintMargin)};this.getShowPrintMargin=function(){return this.renderer.getShowPrintMargin()};this.setPrintMarginColumn=function(showPrintMargin){this.renderer.setPrintMarginColumn(showPrintMargin)};this.getPrintMarginColumn=function(){return this.renderer.getPrintMarginColumn()};this.setReadOnly=function(readOnly){this.setOption("readOnly",readOnly)};this.getReadOnly=function(){return this.getOption("readOnly")};this.setBehavioursEnabled=function(enabled){this.setOption("behavioursEnabled",enabled)};this.getBehavioursEnabled=function(){return this.getOption("behavioursEnabled")};this.setWrapBehavioursEnabled=function(enabled){this.setOption("wrapBehavioursEnabled",enabled)};this.getWrapBehavioursEnabled=function(){return this.getOption("wrapBehavioursEnabled")};this.setShowFoldWidgets=function(show){this.setOption("showFoldWidgets",show)};this.getShowFoldWidgets=function(){return this.getOption("showFoldWidgets")};this.setFadeFoldWidgets=function(fade){this.setOption("fadeFoldWidgets",fade)};this.getFadeFoldWidgets=function(){return this.getOption("fadeFoldWidgets")};this.remove=function(dir){if(this.selection.isEmpty()){if(dir=="left")this.selection.selectLeft();else this.selection.selectRight()}var range=this.getSelectionRange();if(this.getBehavioursEnabled()){var session=this.session;var state=session.getState(range.start.row);var new_range=session.getMode().transformAction(state,"deletion",this,session,range);if(range.end.column===0){var text=session.getTextRange(range);if(text[text.length-1]=="\n"){var line=session.getLine(range.end.row);if(/^\s+$/.test(line)){range.end.column=line.length}}}if(new_range)range=new_range}this.session.remove(range);this.clearSelection()};this.removeWordRight=function(){if(this.selection.isEmpty())this.selection.selectWordRight();this.session.remove(this.getSelectionRange());this.clearSelection()};this.removeWordLeft=function(){if(this.selection.isEmpty())this.selection.selectWordLeft();this.session.remove(this.getSelectionRange());this.clearSelection()};this.removeToLineStart=function(){if(this.selection.isEmpty())this.selection.selectLineStart();this.session.remove(this.getSelectionRange());this.clearSelection()};this.removeToLineEnd=function(){if(this.selection.isEmpty())this.selection.selectLineEnd();var range=this.getSelectionRange();if(range.start.column==range.end.column&&range.start.row==range.end.row){range.end.column=0;range.end.row++}this.session.remove(range);this.clearSelection()};this.splitLine=function(){if(!this.selection.isEmpty()){this.session.remove(this.getSelectionRange());this.clearSelection()}var cursor=this.getCursorPosition();this.insert("\n");this.moveCursorToPosition(cursor)};this.transposeLetters=function(){if(!this.selection.isEmpty()){return}var cursor=this.getCursorPosition();var column=cursor.column;if(column===0)return;var line=this.session.getLine(cursor.row);var swap,range;if(column<line.length){swap=line.charAt(column)+line.charAt(column-1);range=new Range(cursor.row,column-1,cursor.row,column+1)}else{swap=line.charAt(column-1)+line.charAt(column-2);range=new Range(cursor.row,column-2,cursor.row,column)}this.session.replace(range,swap);this.session.selection.moveToPosition(range.end)};this.toLowerCase=function(){var originalRange=this.getSelectionRange();if(this.selection.isEmpty()){this.selection.selectWord()}var range=this.getSelectionRange();var text=this.session.getTextRange(range);this.session.replace(range,text.toLowerCase());this.selection.setSelectionRange(originalRange)};this.toUpperCase=function(){var originalRange=this.getSelectionRange();if(this.selection.isEmpty()){this.selection.selectWord()}var range=this.getSelectionRange();var text=this.session.getTextRange(range);this.session.replace(range,text.toUpperCase());this.selection.setSelectionRange(originalRange)};this.indent=function(){var session=this.session;var range=this.getSelectionRange();if(range.start.row<range.end.row){var rows=this.$getSelectedRows();session.indentRows(rows.first,rows.last,"\t");return}else if(range.start.column<range.end.column){var text=session.getTextRange(range);if(!/^\s+$/.test(text)){var rows=this.$getSelectedRows();session.indentRows(rows.first,rows.last,"\t");return}}var line=session.getLine(range.start.row);var position=range.start;var size=session.getTabSize();var column=session.documentToScreenColumn(position.row,position.column);if(this.session.getUseSoftTabs()){var count=size-column%size;var indentString=lang.stringRepeat(" ",count)}else{var count=column%size;while(line[range.start.column-1]==" "&&count){range.start.column--;count--}this.selection.setSelectionRange(range);indentString="\t"}return this.insert(indentString)};this.blockIndent=function(){var rows=this.$getSelectedRows();this.session.indentRows(rows.first,rows.last,"\t")};this.blockOutdent=function(){var selection=this.session.getSelection();this.session.outdentRows(selection.getRange())};this.sortLines=function(){var rows=this.$getSelectedRows();var session=this.session;var lines=[];for(var i=rows.first;i<=rows.last;i++)lines.push(session.getLine(i));lines.sort((function(a,b){if(a.toLowerCase()<b.toLowerCase())return-1;if(a.toLowerCase()>b.toLowerCase())return 1;return 0}));var deleteRange=new Range(0,0,0,0);for(var i=rows.first;i<=rows.last;i++){var line=session.getLine(i);deleteRange.start.row=i;deleteRange.end.row=i;deleteRange.end.column=line.length;session.replace(deleteRange,lines[i-rows.first])}};this.toggleCommentLines=function(){var state=this.session.getState(this.getCursorPosition().row);var rows=this.$getSelectedRows();this.session.getMode().toggleCommentLines(state,this.session,rows.first,rows.last)};this.toggleBlockComment=function(){var cursor=this.getCursorPosition();var state=this.session.getState(cursor.row);var range=this.getSelectionRange();this.session.getMode().toggleBlockComment(state,this.session,range,cursor)};this.getNumberAt=function(row,column){var _numberRx=/[\-]?[0-9]+(?:\.[0-9]+)?/g;_numberRx.lastIndex=0;var s=this.session.getLine(row);while(_numberRx.lastIndex<column){var m=_numberRx.exec(s);if(m.index<=column&&m.index+m[0].length>=column){var number={value:m[0],start:m.index,end:m.index+m[0].length};return number}}return null};this.modifyNumber=function(amount){var row=this.selection.getCursor().row;var column=this.selection.getCursor().column;var charRange=new Range(row,column-1,row,column);var c=this.session.getTextRange(charRange);if(!isNaN(parseFloat(c))&&isFinite(c)){var nr=this.getNumberAt(row,column);if(nr){var fp=nr.value.indexOf(".")>=0?nr.start+nr.value.indexOf(".")+1:nr.end;var decimals=nr.start+nr.value.length-fp;var t=parseFloat(nr.value);t*=Math.pow(10,decimals);if(fp!==nr.end&&column<fp){amount*=Math.pow(10,nr.end-column-1)}else{amount*=Math.pow(10,nr.end-column)}t+=amount;t/=Math.pow(10,decimals);var nnr=t.toFixed(decimals);var replaceRange=new Range(row,nr.start,row,nr.end);this.session.replace(replaceRange,nnr);this.moveCursorTo(row,Math.max(nr.start+1,column+nnr.length-nr.value.length))}}};this.removeLines=function(){var rows=this.$getSelectedRows();this.session.removeFullLines(rows.first,rows.last);this.clearSelection()};this.duplicateSelection=function(){var sel=this.selection;var doc=this.session;var range=sel.getRange();var reverse=sel.isBackwards();if(range.isEmpty()){var row=range.start.row;doc.duplicateLines(row,row)}else{var point=reverse?range.start:range.end;var endPoint=doc.insert(point,doc.getTextRange(range),false);range.start=point;range.end=endPoint;sel.setSelectionRange(range,reverse)}};this.moveLinesDown=function(){this.$moveLines(1,false)};this.moveLinesUp=function(){this.$moveLines(-1,false)};this.moveText=function(range,toPosition,copy){return this.session.moveText(range,toPosition,copy)};this.copyLinesUp=function(){this.$moveLines(-1,true)};this.copyLinesDown=function(){this.$moveLines(1,true)};this.$moveLines=function(dir,copy){var rows,moved;var selection=this.selection;if(!selection.inMultiSelectMode||this.inVirtualSelectionMode){var range=selection.toOrientedRange();rows=this.$getSelectedRows(range);moved=this.session.$moveLines(rows.first,rows.last,copy?0:dir);if(copy&&dir==-1)moved=0;range.moveBy(moved,0);selection.fromOrientedRange(range)}else{var ranges=selection.rangeList.ranges;selection.rangeList.detach(this.session);this.inVirtualSelectionMode=true;var diff=0;var totalDiff=0;var l=ranges.length;for(var i=0;i<l;i++){var rangeIndex=i;ranges[i].moveBy(diff,0);rows=this.$getSelectedRows(ranges[i]);var first=rows.first;var last=rows.last;while(++i<l){if(totalDiff)ranges[i].moveBy(totalDiff,0);var subRows=this.$getSelectedRows(ranges[i]);if(copy&&subRows.first!=last)break;else if(!copy&&subRows.first>last+1)break;last=subRows.last}i--;diff=this.session.$moveLines(first,last,copy?0:dir);if(copy&&dir==-1)rangeIndex=i+1;while(rangeIndex<=i){ranges[rangeIndex].moveBy(diff,0);rangeIndex++}if(!copy)diff=0;totalDiff+=diff}selection.fromOrientedRange(selection.ranges[0]);selection.rangeList.attach(this.session);this.inVirtualSelectionMode=false}};this.$getSelectedRows=function(range){range=(range||this.getSelectionRange()).collapseRows();return{first:this.session.getRowFoldStart(range.start.row),last:this.session.getRowFoldEnd(range.end.row)}};this.onCompositionStart=function(text){this.renderer.showComposition(this.getCursorPosition())};this.onCompositionUpdate=function(text){this.renderer.setCompositionText(text)};this.onCompositionEnd=function(){this.renderer.hideComposition()};this.getFirstVisibleRow=function(){return this.renderer.getFirstVisibleRow()};this.getLastVisibleRow=function(){return this.renderer.getLastVisibleRow()};this.isRowVisible=function(row){return row>=this.getFirstVisibleRow()&&row<=this.getLastVisibleRow()};this.isRowFullyVisible=function(row){return row>=this.renderer.getFirstFullyVisibleRow()&&row<=this.renderer.getLastFullyVisibleRow()};this.$getVisibleRowCount=function(){return this.renderer.getScrollBottomRow()-this.renderer.getScrollTopRow()+1};this.$moveByPage=function(dir,select){var renderer=this.renderer;var config=this.renderer.layerConfig;var rows=dir*Math.floor(config.height/config.lineHeight);this.$blockScrolling++;if(select===true){this.selection.$moveSelection((function(){this.moveCursorBy(rows,0)}))}else if(select===false){this.selection.moveCursorBy(rows,0);this.selection.clearSelection()}this.$blockScrolling--;var scrollTop=renderer.scrollTop;renderer.scrollBy(0,rows*config.lineHeight);if(select!=null)renderer.scrollCursorIntoView(null,.5);renderer.animateScrolling(scrollTop)};this.selectPageDown=function(){this.$moveByPage(1,true)};this.selectPageUp=function(){this.$moveByPage(-1,true)};this.gotoPageDown=function(){this.$moveByPage(1,false)};this.gotoPageUp=function(){this.$moveByPage(-1,false)};this.scrollPageDown=function(){this.$moveByPage(1)};this.scrollPageUp=function(){this.$moveByPage(-1)};this.scrollToRow=function(row){this.renderer.scrollToRow(row)};this.scrollToLine=function(line,center,animate,callback){this.renderer.scrollToLine(line,center,animate,callback)};this.centerSelection=function(){var range=this.getSelectionRange();var pos={row:Math.floor(range.start.row+(range.end.row-range.start.row)/2),column:Math.floor(range.start.column+(range.end.column-range.start.column)/2)};this.renderer.alignCursor(pos,.5)};this.getCursorPosition=function(){return this.selection.getCursor()};this.getCursorPositionScreen=function(){return this.session.documentToScreenPosition(this.getCursorPosition())};this.getSelectionRange=function(){return this.selection.getRange()};this.selectAll=function(){this.$blockScrolling+=1;this.selection.selectAll();this.$blockScrolling-=1};this.clearSelection=function(){this.selection.clearSelection()};this.moveCursorTo=function(row,column){this.selection.moveCursorTo(row,column)};this.moveCursorToPosition=function(pos){this.selection.moveCursorToPosition(pos)};this.jumpToMatching=function(select,expand){var cursor=this.getCursorPosition();var iterator=new TokenIterator(this.session,cursor.row,cursor.column);var prevToken=iterator.getCurrentToken();var token=prevToken||iterator.stepForward();if(!token)return;var matchType;var found=false;var depth={};var i=cursor.column-token.start;var bracketType;var brackets={")":"(","(":"(","]":"[","[":"[","{":"{","}":"{"};do{if(token.value.match(/[{}()\[\]]/g)){for(;i<token.value.length&&!found;i++){if(!brackets[token.value[i]]){continue}bracketType=brackets[token.value[i]]+"."+token.type.replace("rparen","lparen");if(isNaN(depth[bracketType])){depth[bracketType]=0}switch(token.value[i]){case"(":case"[":case"{":depth[bracketType]++;break;case")":case"]":case"}":depth[bracketType]--;if(depth[bracketType]===-1){matchType="bracket";found=true}break}}}else if(token&&token.type.indexOf("tag-name")!==-1){if(isNaN(depth[token.value])){depth[token.value]=0}if(prevToken.value==="<"){depth[token.value]++}else if(prevToken.value==="</"){depth[token.value]--}if(depth[token.value]===-1){matchType="tag";found=true}}if(!found){prevToken=token;token=iterator.stepForward();i=0}}while(token&&!found);if(!matchType)return;var range,pos;if(matchType==="bracket"){range=this.session.getBracketRange(cursor);if(!range){range=new Range(iterator.getCurrentTokenRow(),iterator.getCurrentTokenColumn()+i-1,iterator.getCurrentTokenRow(),iterator.getCurrentTokenColumn()+i-1);pos=range.start;if(expand||pos.row===cursor.row&&Math.abs(pos.column-cursor.column)<2)range=this.session.getBracketRange(pos)}}else if(matchType==="tag"){if(token&&token.type.indexOf("tag-name")!==-1)var tag=token.value;else return;range=new Range(iterator.getCurrentTokenRow(),iterator.getCurrentTokenColumn()-2,iterator.getCurrentTokenRow(),iterator.getCurrentTokenColumn()-2);if(range.compare(cursor.row,cursor.column)===0){found=false;do{token=prevToken;prevToken=iterator.stepBackward();if(prevToken){if(prevToken.type.indexOf("tag-close")!==-1){range.setEnd(iterator.getCurrentTokenRow(),iterator.getCurrentTokenColumn()+1)}if(token.value===tag&&token.type.indexOf("tag-name")!==-1){if(prevToken.value==="<"){depth[tag]++}else if(prevToken.value==="</"){depth[tag]--}if(depth[tag]===0)found=true}}}while(prevToken&&!found)}if(token&&token.type.indexOf("tag-name")){pos=range.start;if(pos.row==cursor.row&&Math.abs(pos.column-cursor.column)<2)pos=range.end}}pos=range&&range.cursor||pos;if(pos){if(select){if(range&&expand){this.selection.setRange(range)}else if(range&&range.isEqual(this.getSelectionRange())){this.clearSelection()}else{this.selection.selectTo(pos.row,pos.column)}}else{this.selection.moveTo(pos.row,pos.column)}}};this.gotoLine=function(lineNumber,column,animate){this.selection.clearSelection();this.session.unfold({row:lineNumber-1,column:column||0});this.$blockScrolling+=1;this.exitMultiSelectMode&&this.exitMultiSelectMode();this.moveCursorTo(lineNumber-1,column||0);this.$blockScrolling-=1;if(!this.isRowFullyVisible(lineNumber-1))this.scrollToLine(lineNumber-1,true,animate)};this.navigateTo=function(row,column){this.selection.moveTo(row,column)};this.navigateUp=function(times){if(this.selection.isMultiLine()&&!this.selection.isBackwards()){var selectionStart=this.selection.anchor.getPosition();return this.moveCursorToPosition(selectionStart)}this.selection.clearSelection();this.selection.moveCursorBy(-times||-1,0)};this.navigateDown=function(times){if(this.selection.isMultiLine()&&this.selection.isBackwards()){var selectionEnd=this.selection.anchor.getPosition();return this.moveCursorToPosition(selectionEnd)}this.selection.clearSelection();this.selection.moveCursorBy(times||1,0)};this.navigateLeft=function(times){if(!this.selection.isEmpty()){var selectionStart=this.getSelectionRange().start;this.moveCursorToPosition(selectionStart)}else{times=times||1;while(times--){this.selection.moveCursorLeft()}}this.clearSelection()};this.navigateRight=function(times){if(!this.selection.isEmpty()){var selectionEnd=this.getSelectionRange().end;this.moveCursorToPosition(selectionEnd)}else{times=times||1;while(times--){this.selection.moveCursorRight()}}this.clearSelection()};this.navigateLineStart=function(){this.selection.moveCursorLineStart();this.clearSelection()};this.navigateLineEnd=function(){this.selection.moveCursorLineEnd();this.clearSelection()};this.navigateFileEnd=function(){this.selection.moveCursorFileEnd();this.clearSelection()};this.navigateFileStart=function(){this.selection.moveCursorFileStart();this.clearSelection()};this.navigateWordRight=function(){this.selection.moveCursorWordRight();this.clearSelection()};this.navigateWordLeft=function(){this.selection.moveCursorWordLeft();this.clearSelection()};this.replace=function(replacement,options){if(options)this.$search.set(options);var range=this.$search.find(this.session);var replaced=0;if(!range)return replaced;if(this.$tryReplace(range,replacement)){replaced=1}if(range!==null){this.selection.setSelectionRange(range);this.renderer.scrollSelectionIntoView(range.start,range.end)}return replaced};this.replaceAll=function(replacement,options){if(options){this.$search.set(options)}var ranges=this.$search.findAll(this.session);var replaced=0;if(!ranges.length)return replaced;this.$blockScrolling+=1;var selection=this.getSelectionRange();this.selection.moveTo(0,0);for(var i=ranges.length-1;i>=0;--i){if(this.$tryReplace(ranges[i],replacement)){replaced++}}this.selection.setSelectionRange(selection);this.$blockScrolling-=1;return replaced};this.$tryReplace=function(range,replacement){var input=this.session.getTextRange(range);replacement=this.$search.replace(input,replacement);if(replacement!==null){range.end=this.session.replace(range,replacement);return range}else{return null}};this.getLastSearchOptions=function(){return this.$search.getOptions()};this.find=function(needle,options,animate){if(!options)options={};if(typeof needle=="string"||needle instanceof RegExp)options.needle=needle;else if(typeof needle=="object")oop.mixin(options,needle);var range=this.selection.getRange();if(options.needle==null){needle=this.session.getTextRange(range)||this.$search.$options.needle;if(!needle){range=this.session.getWordRange(range.start.row,range.start.column);needle=this.session.getTextRange(range)}this.$search.set({needle:needle})}this.$search.set(options);if(!options.start)this.$search.set({start:range});var newRange=this.$search.find(this.session);if(options.preventScroll)return newRange;if(newRange){this.revealRange(newRange,animate);return newRange}if(options.backwards)range.start=range.end;else range.end=range.start;this.selection.setRange(range)};this.findNext=function(options,animate){this.find({skipCurrent:true,backwards:false},options,animate)};this.findPrevious=function(options,animate){this.find(options,{skipCurrent:true,backwards:true},animate)};this.revealRange=function(range,animate){this.$blockScrolling+=1;this.session.unfold(range);this.selection.setSelectionRange(range);this.$blockScrolling-=1;var scrollTop=this.renderer.scrollTop;this.renderer.scrollSelectionIntoView(range.start,range.end,.5);if(animate!==false)this.renderer.animateScrolling(scrollTop)};this.undo=function(){this.$blockScrolling++;this.session.getUndoManager().undo();this.$blockScrolling--;this.renderer.scrollCursorIntoView(null,.5)};this.redo=function(){this.$blockScrolling++;this.session.getUndoManager().redo();this.$blockScrolling--;this.renderer.scrollCursorIntoView(null,.5)};this.destroy=function(){this.renderer.destroy();this._signal("destroy",this);if(this.session){this.session.destroy()}};this.setAutoScrollEditorIntoView=function(enable){if(!enable)return;var rect;var self=this;var shouldScroll=false;if(!this.$scrollAnchor)this.$scrollAnchor=document.createElement("div");var scrollAnchor=this.$scrollAnchor;scrollAnchor.style.cssText="position:absolute";this.container.insertBefore(scrollAnchor,this.container.firstChild);var onChangeSelection=this.on("changeSelection",(function(){shouldScroll=true}));var onBeforeRender=this.renderer.on("beforeRender",(function(){if(shouldScroll)rect=self.renderer.container.getBoundingClientRect()}));var onAfterRender=this.renderer.on("afterRender",(function(){if(shouldScroll&&rect&&(self.isFocused()||self.searchBox&&self.searchBox.isFocused())){var renderer=self.renderer;var pos=renderer.$cursorLayer.$pixelPos;var config=renderer.layerConfig;var top=pos.top-config.offset;if(pos.top>=0&&top+rect.top<0){shouldScroll=true}else if(pos.top<config.height&&pos.top+rect.top+config.lineHeight>window.innerHeight){shouldScroll=false}else{shouldScroll=null}if(shouldScroll!=null){scrollAnchor.style.top=top+"px";scrollAnchor.style.left=pos.left+"px";scrollAnchor.style.height=config.lineHeight+"px";scrollAnchor.scrollIntoView(shouldScroll)}shouldScroll=rect=null}}));this.setAutoScrollEditorIntoView=function(enable){if(enable)return;delete this.setAutoScrollEditorIntoView;this.off("changeSelection",onChangeSelection);this.renderer.off("afterRender",onAfterRender);this.renderer.off("beforeRender",onBeforeRender)}};this.$resetCursorStyle=function(){var style=this.$cursorStyle||"ace";var cursorLayer=this.renderer.$cursorLayer;if(!cursorLayer)return;cursorLayer.setSmoothBlinking(/smooth/.test(style));cursorLayer.isBlinking=!this.$readOnly&&style!="wide";dom.setCssClass(cursorLayer.element,"ace_slim-cursors",/slim/.test(style))}}).call(Editor.prototype);config.defineOptions(Editor.prototype,"editor",{selectionStyle:{set:function(style){this.onSelectionChange();this._signal("changeSelectionStyle",{data:style})},initialValue:"line"},highlightActiveLine:{set:function(){this.$updateHighlightActiveLine()},initialValue:true},highlightSelectedWord:{set:function(shouldHighlight){this.$onSelectionChange()},initialValue:true},readOnly:{set:function(readOnly){this.$resetCursorStyle()},initialValue:false},cursorStyle:{set:function(val){this.$resetCursorStyle()},values:["ace","slim","smooth","wide"],initialValue:"ace"},mergeUndoDeltas:{values:[false,true,"always"],initialValue:true},behavioursEnabled:{initialValue:true},wrapBehavioursEnabled:{initialValue:true},autoScrollEditorIntoView:{set:function(val){this.setAutoScrollEditorIntoView(val)}},keyboardHandler:{set:function(val){this.setKeyboardHandler(val)},get:function(){return this.keybindingId},handlesSet:true},hScrollBarAlwaysVisible:"renderer",vScrollBarAlwaysVisible:"renderer",highlightGutterLine:"renderer",animatedScroll:"renderer",showInvisibles:"renderer",showPrintMargin:"renderer",printMarginColumn:"renderer",printMargin:"renderer",fadeFoldWidgets:"renderer",showFoldWidgets:"renderer",showLineNumbers:"renderer",showGutter:"renderer",displayIndentGuides:"renderer",fontSize:"renderer",fontFamily:"renderer",maxLines:"renderer",minLines:"renderer",scrollPastEnd:"renderer",fixedWidthGutter:"renderer",theme:"renderer",scrollSpeed:"$mouseHandler",dragDelay:"$mouseHandler",dragEnabled:"$mouseHandler",focusTimout:"$mouseHandler",tooltipFollowsMouse:"$mouseHandler",firstLineNumber:"session",overwrite:"session",newLineMode:"session",useWorker:"session",useSoftTabs:"session",tabSize:"session",wrap:"session",indentedSoftWrap:"session",foldStyle:"session",mode:"session"});exports.Editor=Editor}));ace.define("ace/undomanager",["require","exports","module"],(function(acequire,exports,module){"use strict";var UndoManager=function(){this.reset()};(function(){this.execute=function(options){var deltaSets=options.args[0];this.$doc=options.args[1];if(options.merge&&this.hasUndo()){this.dirtyCounter--;deltaSets=this.$undoStack.pop().concat(deltaSets)}this.$undoStack.push(deltaSets);this.$redoStack=[];if(this.dirtyCounter<0){this.dirtyCounter=NaN}this.dirtyCounter++};this.undo=function(dontSelect){var deltaSets=this.$undoStack.pop();var undoSelectionRange=null;if(deltaSets){undoSelectionRange=this.$doc.undoChanges(deltaSets,dontSelect);this.$redoStack.push(deltaSets);this.dirtyCounter--}return undoSelectionRange};this.redo=function(dontSelect){var deltaSets=this.$redoStack.pop();var redoSelectionRange=null;if(deltaSets){redoSelectionRange=this.$doc.redoChanges(this.$deserializeDeltas(deltaSets),dontSelect);this.$undoStack.push(deltaSets);this.dirtyCounter++}return redoSelectionRange};this.reset=function(){this.$undoStack=[];this.$redoStack=[];this.dirtyCounter=0};this.hasUndo=function(){return this.$undoStack.length>0};this.hasRedo=function(){return this.$redoStack.length>0};this.markClean=function(){this.dirtyCounter=0};this.isClean=function(){return this.dirtyCounter===0};this.$serializeDeltas=function(deltaSets){return cloneDeltaSetsObj(deltaSets,$serializeDelta)};this.$deserializeDeltas=function(deltaSets){return cloneDeltaSetsObj(deltaSets,$deserializeDelta)};function $serializeDelta(delta){return{action:delta.action,start:delta.start,end:delta.end,lines:delta.lines.length==1?null:delta.lines,text:delta.lines.length==1?delta.lines[0]:null}}function $deserializeDelta(delta){return{action:delta.action,start:delta.start,end:delta.end,lines:delta.lines||[delta.text]}}function cloneDeltaSetsObj(deltaSets_old,fnGetModifiedDelta){var deltaSets_new=new Array(deltaSets_old.length);for(var i=0;i<deltaSets_old.length;i++){var deltaSet_old=deltaSets_old[i];var deltaSet_new={group:deltaSet_old.group,deltas:new Array(deltaSet_old.length)};for(var j=0;j<deltaSet_old.deltas.length;j++){var delta_old=deltaSet_old.deltas[j];deltaSet_new.deltas[j]=fnGetModifiedDelta(delta_old)}deltaSets_new[i]=deltaSet_new}return deltaSets_new}}).call(UndoManager.prototype);exports.UndoManager=UndoManager}));ace.define("ace/layer/gutter",["require","exports","module","ace/lib/dom","ace/lib/oop","ace/lib/lang","ace/lib/event_emitter"],(function(acequire,exports,module){"use strict";var dom=acequire("../lib/dom");var oop=acequire("../lib/oop");var lang=acequire("../lib/lang");var EventEmitter=acequire("../lib/event_emitter").EventEmitter;var Gutter=function(parentEl){this.element=dom.createElement("div");this.element.className="ace_layer ace_gutter-layer";parentEl.appendChild(this.element);this.setShowFoldWidgets(this.$showFoldWidgets);this.gutterWidth=0;this.$annotations=[];this.$updateAnnotations=this.$updateAnnotations.bind(this);this.$cells=[]};(function(){oop.implement(this,EventEmitter);this.setSession=function(session){if(this.session)this.session.removeEventListener("change",this.$updateAnnotations);this.session=session;if(session)session.on("change",this.$updateAnnotations)};this.addGutterDecoration=function(row,className){if(window.console)console.warn&&console.warn("deprecated use session.addGutterDecoration");this.session.addGutterDecoration(row,className)};this.removeGutterDecoration=function(row,className){if(window.console)console.warn&&console.warn("deprecated use session.removeGutterDecoration");this.session.removeGutterDecoration(row,className)};this.setAnnotations=function(annotations){this.$annotations=[];for(var i=0;i<annotations.length;i++){var annotation=annotations[i];var row=annotation.row;var rowInfo=this.$annotations[row];if(!rowInfo)rowInfo=this.$annotations[row]={text:[]};var annoText=annotation.text;annoText=annoText?lang.escapeHTML(annoText):annotation.html||"";if(rowInfo.text.indexOf(annoText)===-1)rowInfo.text.push(annoText);var type=annotation.type;if(type=="error")rowInfo.className=" ace_error";else if(type=="warning"&&rowInfo.className!=" ace_error")rowInfo.className=" ace_warning";else if(type=="info"&&!rowInfo.className)rowInfo.className=" ace_info"}};this.$updateAnnotations=function(delta){if(!this.$annotations.length)return;var firstRow=delta.start.row;var len=delta.end.row-firstRow;if(len===0){}else if(delta.action=="remove"){this.$annotations.splice(firstRow,len+1,null)}else{var args=new Array(len+1);args.unshift(firstRow,1);this.$annotations.splice.apply(this.$annotations,args)}};this.update=function(config){var session=this.session;var firstRow=config.firstRow;var lastRow=Math.min(config.lastRow+config.gutterOffset,session.getLength()-1);var fold=session.getNextFoldLine(firstRow);var foldStart=fold?fold.start.row:Infinity;var foldWidgets=this.$showFoldWidgets&&session.foldWidgets;var breakpoints=session.$breakpoints;var decorations=session.$decorations;var firstLineNumber=session.$firstLineNumber;var lastLineNumber=0;var gutterRenderer=session.gutterRenderer||this.$renderer;var cell=null;var index=-1;var row=firstRow;while(true){if(row>foldStart){row=fold.end.row+1;fold=session.getNextFoldLine(row,fold);foldStart=fold?fold.start.row:Infinity}if(row>lastRow){while(this.$cells.length>index+1){cell=this.$cells.pop();this.element.removeChild(cell.element)}break}cell=this.$cells[++index];if(!cell){cell={element:null,textNode:null,foldWidget:null};cell.element=dom.createElement("div");cell.textNode=document.createTextNode("");cell.element.appendChild(cell.textNode);this.element.appendChild(cell.element);this.$cells[index]=cell}var className="ace_gutter-cell ";if(breakpoints[row])className+=breakpoints[row];if(decorations[row])className+=decorations[row];if(this.$annotations[row])className+=this.$annotations[row].className;if(cell.element.className!=className)cell.element.className=className;var height=session.getRowLength(row)*config.lineHeight+"px";if(height!=cell.element.style.height)cell.element.style.height=height;if(foldWidgets){var c=foldWidgets[row];if(c==null)c=foldWidgets[row]=session.getFoldWidget(row)}if(c){if(!cell.foldWidget){cell.foldWidget=dom.createElement("span");cell.element.appendChild(cell.foldWidget)}var className="ace_fold-widget ace_"+c;if(c=="start"&&row==foldStart&&row<fold.end.row)className+=" ace_closed";else className+=" ace_open";if(cell.foldWidget.className!=className)cell.foldWidget.className=className;var height=config.lineHeight+"px";if(cell.foldWidget.style.height!=height)cell.foldWidget.style.height=height}else{if(cell.foldWidget){cell.element.removeChild(cell.foldWidget);cell.foldWidget=null}}var text=lastLineNumber=gutterRenderer?gutterRenderer.getText(session,row):row+firstLineNumber;if(text!==cell.textNode.data)cell.textNode.data=text;row++}this.element.style.height=config.minHeight+"px";if(this.$fixedWidth||session.$useWrapMode)lastLineNumber=session.getLength()+firstLineNumber;var gutterWidth=gutterRenderer?gutterRenderer.getWidth(session,lastLineNumber,config):lastLineNumber.toString().length*config.characterWidth;var padding=this.$padding||this.$computePadding();gutterWidth+=padding.left+padding.right;if(gutterWidth!==this.gutterWidth&&!isNaN(gutterWidth)){this.gutterWidth=gutterWidth;this.element.style.width=Math.ceil(this.gutterWidth)+"px";this._emit("changeGutterWidth",gutterWidth)}};this.$fixedWidth=false;this.$showLineNumbers=true;this.$renderer="";this.setShowLineNumbers=function(show){this.$renderer=!show&&{getWidth:function(){return""},getText:function(){return""}}};this.getShowLineNumbers=function(){return this.$showLineNumbers};this.$showFoldWidgets=true;this.setShowFoldWidgets=function(show){if(show)dom.addCssClass(this.element,"ace_folding-enabled");else dom.removeCssClass(this.element,"ace_folding-enabled");this.$showFoldWidgets=show;this.$padding=null};this.getShowFoldWidgets=function(){return this.$showFoldWidgets};this.$computePadding=function(){if(!this.element.firstChild)return{left:0,right:0};var style=dom.computedStyle(this.element.firstChild);this.$padding={};this.$padding.left=parseInt(style.paddingLeft)+1||0;this.$padding.right=parseInt(style.paddingRight)||0;return this.$padding};this.getRegion=function(point){var padding=this.$padding||this.$computePadding();var rect=this.element.getBoundingClientRect();if(point.x<padding.left+rect.left)return"markers";if(this.$showFoldWidgets&&point.x>rect.right-padding.right)return"foldWidgets"}}).call(Gutter.prototype);exports.Gutter=Gutter}));ace.define("ace/layer/marker",["require","exports","module","ace/range","ace/lib/dom"],(function(acequire,exports,module){"use strict";var Range=acequire("../range").Range;var dom=acequire("../lib/dom");var Marker=function(parentEl){this.element=dom.createElement("div");this.element.className="ace_layer ace_marker-layer";parentEl.appendChild(this.element)};(function(){this.$padding=0;this.setPadding=function(padding){this.$padding=padding};this.setSession=function(session){this.session=session};this.setMarkers=function(markers){this.markers=markers};this.update=function(config){if(!config)return;this.config=config;var html=[];for(var key in this.markers){var marker=this.markers[key];if(!marker.range){marker.update(html,this,this.session,config);continue}var range=marker.range.clipRows(config.firstRow,config.lastRow);if(range.isEmpty())continue;range=range.toScreenRange(this.session);if(marker.renderer){var top=this.$getTop(range.start.row,config);var left=this.$padding+(this.session.$bidiHandler.isBidiRow(range.start.row)?this.session.$bidiHandler.getPosLeft(range.start.column):range.start.column*config.characterWidth);marker.renderer(html,range,left,top,config)}else if(marker.type=="fullLine"){this.drawFullLineMarker(html,range,marker.clazz,config)}else if(marker.type=="screenLine"){this.drawScreenLineMarker(html,range,marker.clazz,config)}else if(range.isMultiLine()){if(marker.type=="text")this.drawTextMarker(html,range,marker.clazz,config);else this.drawMultiLineMarker(html,range,marker.clazz,config)}else{if(this.session.$bidiHandler.isBidiRow(range.start.row)){this.drawBidiSingleLineMarker(html,range,marker.clazz+" ace_start"+" ace_br15",config)}else{this.drawSingleLineMarker(html,range,marker.clazz+" ace_start"+" ace_br15",config)}}}this.element.innerHTML=html.join("")};this.$getTop=function(row,layerConfig){return(row-layerConfig.firstRowScreen)*layerConfig.lineHeight};function getBorderClass(tl,tr,br,bl){return(tl?1:0)|(tr?2:0)|(br?4:0)|(bl?8:0)}this.drawTextMarker=function(stringBuilder,range,clazz,layerConfig,extraStyle){var session=this.session;var start=range.start.row;var end=range.end.row;var row=start;var prev=0;var curr=0;var next=session.getScreenLastRowColumn(row);var clazzModified=null;var lineRange=new Range(row,range.start.column,row,curr);for(;row<=end;row++){lineRange.start.row=lineRange.end.row=row;lineRange.start.column=row==start?range.start.column:session.getRowWrapIndent(row);lineRange.end.column=next;prev=curr;curr=next;next=row+1<end?session.getScreenLastRowColumn(row+1):row==end?0:range.end.column;clazzModified=clazz+(row==start?" ace_start":"")+" ace_br"+getBorderClass(row==start||row==start+1&&range.start.column,prev<curr,curr>next,row==end);if(this.session.$bidiHandler.isBidiRow(row)){this.drawBidiSingleLineMarker(stringBuilder,lineRange,clazzModified,layerConfig,row==end?0:1,extraStyle)}else{this.drawSingleLineMarker(stringBuilder,lineRange,clazzModified,layerConfig,row==end?0:1,extraStyle)}}};this.drawMultiLineMarker=function(stringBuilder,range,clazz,config,extraStyle){var padding=this.$padding;var height,top,left;extraStyle=extraStyle||"";if(this.session.$bidiHandler.isBidiRow(range.start.row)){var range1=range.clone();range1.end.row=range1.start.row;range1.end.column=this.session.getLine(range1.start.row).length;this.drawBidiSingleLineMarker(stringBuilder,range1,clazz+" ace_br1 ace_start",config,null,extraStyle)}else{height=config.lineHeight;top=this.$getTop(range.start.row,config);left=padding+range.start.column*config.characterWidth;stringBuilder.push("<div class='",clazz," ace_br1 ace_start' style='","height:",height,"px;","right:0;","top:",top,"px;","left:",left,"px;",extraStyle,"'></div>")}if(this.session.$bidiHandler.isBidiRow(range.end.row)){var range1=range.clone();range1.start.row=range1.end.row;range1.start.column=0;this.drawBidiSingleLineMarker(stringBuilder,range1,clazz+" ace_br12",config,null,extraStyle)}else{var width=range.end.column*config.characterWidth;height=config.lineHeight;top=this.$getTop(range.end.row,config);stringBuilder.push("<div class='",clazz," ace_br12' style='","height:",height,"px;","width:",width,"px;","top:",top,"px;","left:",padding,"px;",extraStyle,"'></div>")}height=(range.end.row-range.start.row-1)*config.lineHeight;if(height<=0)return;top=this.$getTop(range.start.row+1,config);var radiusClass=(range.start.column?1:0)|(range.end.column?0:8);stringBuilder.push("<div class='",clazz,radiusClass?" ace_br"+radiusClass:"","' style='","height:",height,"px;","right:0;","top:",top,"px;","left:",padding,"px;",extraStyle,"'></div>")};this.drawSingleLineMarker=function(stringBuilder,range,clazz,config,extraLength,extraStyle){var height=config.lineHeight;var width=(range.end.column+(extraLength||0)-range.start.column)*config.characterWidth;var top=this.$getTop(range.start.row,config);var left=this.$padding+range.start.column*config.characterWidth;stringBuilder.push("<div class='",clazz,"' style='","height:",height,"px;","width:",width,"px;","top:",top,"px;","left:",left,"px;",extraStyle||"","'></div>")};this.drawBidiSingleLineMarker=function(stringBuilder,range,clazz,config,extraLength,extraStyle){var height=config.lineHeight,top=this.$getTop(range.start.row,config),padding=this.$padding;var selections=this.session.$bidiHandler.getSelections(range.start.column,range.end.column);selections.forEach((function(selection){stringBuilder.push("<div class='",clazz,"' style='","height:",height,"px;","width:",selection.width+(extraLength||0),"px;","top:",top,"px;","left:",padding+selection.left,"px;",extraStyle||"","'></div>")}))};this.drawFullLineMarker=function(stringBuilder,range,clazz,config,extraStyle){var top=this.$getTop(range.start.row,config);var height=config.lineHeight;if(range.start.row!=range.end.row)height+=this.$getTop(range.end.row,config)-top;stringBuilder.push("<div class='",clazz,"' style='","height:",height,"px;","top:",top,"px;","left:0;right:0;",extraStyle||"","'></div>")};this.drawScreenLineMarker=function(stringBuilder,range,clazz,config,extraStyle){var top=this.$getTop(range.start.row,config);var height=config.lineHeight;stringBuilder.push("<div class='",clazz,"' style='","height:",height,"px;","top:",top,"px;","left:0;right:0;",extraStyle||"","'></div>")}}).call(Marker.prototype);exports.Marker=Marker}));ace.define("ace/layer/text",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/lang","ace/lib/useragent","ace/lib/event_emitter"],(function(acequire,exports,module){"use strict";var oop=acequire("../lib/oop");var dom=acequire("../lib/dom");var lang=acequire("../lib/lang");var useragent=acequire("../lib/useragent");var EventEmitter=acequire("../lib/event_emitter").EventEmitter;var Text=function(parentEl){this.element=dom.createElement("div");this.element.className="ace_layer ace_text-layer";parentEl.appendChild(this.element);this.$updateEolChar=this.$updateEolChar.bind(this)};(function(){oop.implement(this,EventEmitter);this.EOF_CHAR="¶";this.EOL_CHAR_LF="¬";this.EOL_CHAR_CRLF="¤";this.EOL_CHAR=this.EOL_CHAR_LF;this.TAB_CHAR="—";this.SPACE_CHAR="·";this.$padding=0;this.$updateEolChar=function(){var EOL_CHAR=this.session.doc.getNewLineCharacter()=="\n"?this.EOL_CHAR_LF:this.EOL_CHAR_CRLF;if(this.EOL_CHAR!=EOL_CHAR){this.EOL_CHAR=EOL_CHAR;return true}};this.setPadding=function(padding){this.$padding=padding;this.element.style.padding="0 "+padding+"px"};this.getLineHeight=function(){return this.$fontMetrics.$characterSize.height||0};this.getCharacterWidth=function(){return this.$fontMetrics.$characterSize.width||0};this.$setFontMetrics=function(measure){this.$fontMetrics=measure;this.$fontMetrics.on("changeCharacterSize",function(e){this._signal("changeCharacterSize",e)}.bind(this));this.$pollSizeChanges()};this.checkForSizeChanges=function(){this.$fontMetrics.checkForSizeChanges()};this.$pollSizeChanges=function(){return this.$pollSizeChangesTimer=this.$fontMetrics.$pollSizeChanges()};this.setSession=function(session){this.session=session;if(session)this.$computeTabString()};this.showInvisibles=false;this.setShowInvisibles=function(showInvisibles){if(this.showInvisibles==showInvisibles)return false;this.showInvisibles=showInvisibles;this.$computeTabString();return true};this.displayIndentGuides=true;this.setDisplayIndentGuides=function(display){if(this.displayIndentGuides==display)return false;this.displayIndentGuides=display;this.$computeTabString();return true};this.$tabStrings=[];this.onChangeTabSize=this.$computeTabString=function(){var tabSize=this.session.getTabSize();this.tabSize=tabSize;var tabStr=this.$tabStrings=[0];for(var i=1;i<tabSize+1;i++){if(this.showInvisibles){tabStr.push("<span class='ace_invisible ace_invisible_tab'>"+lang.stringRepeat(this.TAB_CHAR,i)+"</span>")}else{tabStr.push(lang.stringRepeat(" ",i))}}if(this.displayIndentGuides){this.$indentGuideRe=/\s\S| \t|\t |\s$/;var className="ace_indent-guide";var spaceClass="";var tabClass="";if(this.showInvisibles){className+=" ace_invisible";spaceClass=" ace_invisible_space";tabClass=" ace_invisible_tab";var spaceContent=lang.stringRepeat(this.SPACE_CHAR,this.tabSize);var tabContent=lang.stringRepeat(this.TAB_CHAR,this.tabSize)}else{var spaceContent=lang.stringRepeat(" ",this.tabSize);var tabContent=spaceContent}this.$tabStrings[" "]="<span class='"+className+spaceClass+"'>"+spaceContent+"</span>";this.$tabStrings["\t"]="<span class='"+className+tabClass+"'>"+tabContent+"</span>"}};this.updateLines=function(config,firstRow,lastRow){if(this.config.lastRow!=config.lastRow||this.config.firstRow!=config.firstRow){this.scrollLines(config)}this.config=config;var first=Math.max(firstRow,config.firstRow);var last=Math.min(lastRow,config.lastRow);var lineElements=this.element.childNodes;var lineElementsIdx=0;for(var row=config.firstRow;row<first;row++){var foldLine=this.session.getFoldLine(row);if(foldLine){if(foldLine.containsRow(first)){first=foldLine.start.row;break}else{row=foldLine.end.row}}lineElementsIdx++}var row=first;var foldLine=this.session.getNextFoldLine(row);var foldStart=foldLine?foldLine.start.row:Infinity;while(true){if(row>foldStart){row=foldLine.end.row+1;foldLine=this.session.getNextFoldLine(row,foldLine);foldStart=foldLine?foldLine.start.row:Infinity}if(row>last)break;var lineElement=lineElements[lineElementsIdx++];if(lineElement){var html=[];this.$renderLine(html,row,!this.$useLineGroups(),row==foldStart?foldLine:false);lineElement.style.height=config.lineHeight*this.session.getRowLength(row)+"px";lineElement.innerHTML=html.join("")}row++}};this.scrollLines=function(config){var oldConfig=this.config;this.config=config;if(!oldConfig||oldConfig.lastRow<config.firstRow)return this.update(config);if(config.lastRow<oldConfig.firstRow)return this.update(config);var el=this.element;if(oldConfig.firstRow<config.firstRow)for(var row=this.session.getFoldedRowCount(oldConfig.firstRow,config.firstRow-1);row>0;row--)el.removeChild(el.firstChild);if(oldConfig.lastRow>config.lastRow)for(var row=this.session.getFoldedRowCount(config.lastRow+1,oldConfig.lastRow);row>0;row--)el.removeChild(el.lastChild);if(config.firstRow<oldConfig.firstRow){var fragment=this.$renderLinesFragment(config,config.firstRow,oldConfig.firstRow-1);if(el.firstChild)el.insertBefore(fragment,el.firstChild);else el.appendChild(fragment)}if(config.lastRow>oldConfig.lastRow){var fragment=this.$renderLinesFragment(config,oldConfig.lastRow+1,config.lastRow);el.appendChild(fragment)}};this.$renderLinesFragment=function(config,firstRow,lastRow){var fragment=this.element.ownerDocument.createDocumentFragment();var row=firstRow;var foldLine=this.session.getNextFoldLine(row);var foldStart=foldLine?foldLine.start.row:Infinity;while(true){if(row>foldStart){row=foldLine.end.row+1;foldLine=this.session.getNextFoldLine(row,foldLine);foldStart=foldLine?foldLine.start.row:Infinity}if(row>lastRow)break;var container=dom.createElement("div");var html=[];this.$renderLine(html,row,false,row==foldStart?foldLine:false);container.innerHTML=html.join("");if(this.$useLineGroups()){container.className="ace_line_group";fragment.appendChild(container);container.style.height=config.lineHeight*this.session.getRowLength(row)+"px"}else{while(container.firstChild)fragment.appendChild(container.firstChild)}row++}return fragment};this.update=function(config){this.config=config;var html=[];var firstRow=config.firstRow,lastRow=config.lastRow;var row=firstRow;var foldLine=this.session.getNextFoldLine(row);var foldStart=foldLine?foldLine.start.row:Infinity;while(true){if(row>foldStart){row=foldLine.end.row+1;foldLine=this.session.getNextFoldLine(row,foldLine);foldStart=foldLine?foldLine.start.row:Infinity}if(row>lastRow)break;if(this.$useLineGroups())html.push("<div class='ace_line_group' style='height:",config.lineHeight*this.session.getRowLength(row),"px'>");this.$renderLine(html,row,false,row==foldStart?foldLine:false);if(this.$useLineGroups())html.push("</div>");row++}this.element.innerHTML=html.join("")};this.$textToken={text:true,rparen:true,lparen:true};this.$renderToken=function(stringBuilder,screenColumn,token,value){var self=this;var replaceReg=/\t|&|<|>|( +)|([\x00-\x1f\x80-\xa0\xad\u1680\u180E\u2000-\u200f\u2028\u2029\u202F\u205F\u3000\uFEFF\uFFF9-\uFFFC])|[\u1100-\u115F\u11A3-\u11A7\u11FA-\u11FF\u2329-\u232A\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u2FFB\u3000-\u303E\u3041-\u3096\u3099-\u30FF\u3105-\u312D\u3131-\u318E\u3190-\u31BA\u31C0-\u31E3\u31F0-\u321E\u3220-\u3247\u3250-\u32FE\u3300-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFAFF\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE66\uFE68-\uFE6B\uFF01-\uFF60\uFFE0-\uFFE6]|[\uD800-\uDBFF][\uDC00-\uDFFF]/g;var replaceFunc=function(c,a,b,tabIdx,idx4){if(a){return self.showInvisibles?"<span class='ace_invisible ace_invisible_space'>"+lang.stringRepeat(self.SPACE_CHAR,c.length)+"</span>":c}else if(c=="&"){return"&#38;"}else if(c=="<"){return"&#60;"}else if(c==">"){return"&#62;"}else if(c=="\t"){var tabSize=self.session.getScreenTabSize(screenColumn+tabIdx);screenColumn+=tabSize-1;return self.$tabStrings[tabSize]}else if(c=="　"){var classToUse=self.showInvisibles?"ace_cjk ace_invisible ace_invisible_space":"ace_cjk";var space=self.showInvisibles?self.SPACE_CHAR:"";screenColumn+=1;return"<span class='"+classToUse+"' style='width:"+self.config.characterWidth*2+"px'>"+space+"</span>"}else if(b){return"<span class='ace_invisible ace_invisible_space ace_invalid'>"+self.SPACE_CHAR+"</span>"}else{screenColumn+=1;return"<span class='ace_cjk' style='width:"+self.config.characterWidth*2+"px'>"+c+"</span>"}};var output=value.replace(replaceReg,replaceFunc);if(!this.$textToken[token.type]){var classes="ace_"+token.type.replace(/\./g," ace_");var style="";if(token.type=="fold")style=" style='width:"+token.value.length*this.config.characterWidth+"px;' ";stringBuilder.push("<span class='",classes,"'",style,">",output,"</span>")}else{stringBuilder.push(output)}return screenColumn+value.length};this.renderIndentGuide=function(stringBuilder,value,max){var cols=value.search(this.$indentGuideRe);if(cols<=0||cols>=max)return value;if(value[0]==" "){cols-=cols%this.tabSize;stringBuilder.push(lang.stringRepeat(this.$tabStrings[" "],cols/this.tabSize));return value.substr(cols)}else if(value[0]=="\t"){stringBuilder.push(lang.stringRepeat(this.$tabStrings["\t"],cols));return value.substr(cols)}return value};this.$renderWrappedLine=function(stringBuilder,tokens,splits,onlyContents){var chars=0;var split=0;var splitChars=splits[0];var screenColumn=0;for(var i=0;i<tokens.length;i++){var token=tokens[i];var value=token.value;if(i==0&&this.displayIndentGuides){chars=value.length;value=this.renderIndentGuide(stringBuilder,value,splitChars);if(!value)continue;chars-=value.length}if(chars+value.length<splitChars){screenColumn=this.$renderToken(stringBuilder,screenColumn,token,value);chars+=value.length}else{while(chars+value.length>=splitChars){screenColumn=this.$renderToken(stringBuilder,screenColumn,token,value.substring(0,splitChars-chars));value=value.substring(splitChars-chars);chars=splitChars;if(!onlyContents){stringBuilder.push("</div>","<div class='ace_line' style='height:",this.config.lineHeight,"px'>")}stringBuilder.push(lang.stringRepeat(" ",splits.indent));split++;screenColumn=0;splitChars=splits[split]||Number.MAX_VALUE}if(value.length!=0){chars+=value.length;screenColumn=this.$renderToken(stringBuilder,screenColumn,token,value)}}}};this.$renderSimpleLine=function(stringBuilder,tokens){var screenColumn=0;var token=tokens[0];var value=token.value;if(this.displayIndentGuides)value=this.renderIndentGuide(stringBuilder,value);if(value)screenColumn=this.$renderToken(stringBuilder,screenColumn,token,value);for(var i=1;i<tokens.length;i++){token=tokens[i];value=token.value;screenColumn=this.$renderToken(stringBuilder,screenColumn,token,value)}};this.$renderLine=function(stringBuilder,row,onlyContents,foldLine){if(!foldLine&&foldLine!=false)foldLine=this.session.getFoldLine(row);if(foldLine)var tokens=this.$getFoldLineTokens(row,foldLine);else var tokens=this.session.getTokens(row);if(!onlyContents){stringBuilder.push("<div class='ace_line' style='height:",this.config.lineHeight*(this.$useLineGroups()?1:this.session.getRowLength(row)),"px'>")}if(tokens.length){var splits=this.session.getRowSplitData(row);if(splits&&splits.length)this.$renderWrappedLine(stringBuilder,tokens,splits,onlyContents);else this.$renderSimpleLine(stringBuilder,tokens)}if(this.showInvisibles){if(foldLine)row=foldLine.end.row;stringBuilder.push("<span class='ace_invisible ace_invisible_eol'>",row==this.session.getLength()-1?this.EOF_CHAR:this.EOL_CHAR,"</span>")}if(!onlyContents)stringBuilder.push("</div>")};this.$getFoldLineTokens=function(row,foldLine){var session=this.session;var renderTokens=[];function addTokens(tokens,from,to){var idx=0,col=0;while(col+tokens[idx].value.length<from){col+=tokens[idx].value.length;idx++;if(idx==tokens.length)return}if(col!=from){var value=tokens[idx].value.substring(from-col);if(value.length>to-from)value=value.substring(0,to-from);renderTokens.push({type:tokens[idx].type,value:value});col=from+value.length;idx+=1}while(col<to&&idx<tokens.length){var value=tokens[idx].value;if(value.length+col>to){renderTokens.push({type:tokens[idx].type,value:value.substring(0,to-col)})}else renderTokens.push(tokens[idx]);col+=value.length;idx+=1}}var tokens=session.getTokens(row);foldLine.walk((function(placeholder,row,column,lastColumn,isNewRow){if(placeholder!=null){renderTokens.push({type:"fold",value:placeholder})}else{if(isNewRow)tokens=session.getTokens(row);if(tokens.length)addTokens(tokens,lastColumn,column)}}),foldLine.end.row,this.session.getLine(foldLine.end.row).length);return renderTokens};this.$useLineGroups=function(){return this.session.getUseWrapMode()};this.destroy=function(){clearInterval(this.$pollSizeChangesTimer);if(this.$measureNode)this.$measureNode.parentNode.removeChild(this.$measureNode);delete this.$measureNode}}).call(Text.prototype);exports.Text=Text}));ace.define("ace/layer/cursor",["require","exports","module","ace/lib/dom"],(function(acequire,exports,module){"use strict";var dom=acequire("../lib/dom");var isIE8;var Cursor=function(parentEl){this.element=dom.createElement("div");this.element.className="ace_layer ace_cursor-layer";parentEl.appendChild(this.element);if(isIE8===undefined)isIE8=!("opacity"in this.element.style);this.isVisible=false;this.isBlinking=true;this.blinkInterval=1e3;this.smoothBlinking=false;this.cursors=[];this.cursor=this.addCursor();dom.addCssClass(this.element,"ace_hidden-cursors");this.$updateCursors=(isIE8?this.$updateVisibility:this.$updateOpacity).bind(this)};(function(){this.$updateVisibility=function(val){var cursors=this.cursors;for(var i=cursors.length;i--;)cursors[i].style.visibility=val?"":"hidden"};this.$updateOpacity=function(val){var cursors=this.cursors;for(var i=cursors.length;i--;)cursors[i].style.opacity=val?"":"0"};this.$padding=0;this.setPadding=function(padding){this.$padding=padding};this.setSession=function(session){this.session=session};this.setBlinking=function(blinking){if(blinking!=this.isBlinking){this.isBlinking=blinking;this.restartTimer()}};this.setBlinkInterval=function(blinkInterval){if(blinkInterval!=this.blinkInterval){this.blinkInterval=blinkInterval;this.restartTimer()}};this.setSmoothBlinking=function(smoothBlinking){if(smoothBlinking!=this.smoothBlinking&&!isIE8){this.smoothBlinking=smoothBlinking;dom.setCssClass(this.element,"ace_smooth-blinking",smoothBlinking);this.$updateCursors(true);this.$updateCursors=this.$updateOpacity.bind(this);this.restartTimer()}};this.addCursor=function(){var el=dom.createElement("div");el.className="ace_cursor";this.element.appendChild(el);this.cursors.push(el);return el};this.removeCursor=function(){if(this.cursors.length>1){var el=this.cursors.pop();el.parentNode.removeChild(el);return el}};this.hideCursor=function(){this.isVisible=false;dom.addCssClass(this.element,"ace_hidden-cursors");this.restartTimer()};this.showCursor=function(){this.isVisible=true;dom.removeCssClass(this.element,"ace_hidden-cursors");this.restartTimer()};this.restartTimer=function(){var update=this.$updateCursors;clearInterval(this.intervalId);clearTimeout(this.timeoutId);if(this.smoothBlinking){dom.removeCssClass(this.element,"ace_smooth-blinking")}update(true);if(!this.isBlinking||!this.blinkInterval||!this.isVisible)return;if(this.smoothBlinking){setTimeout(function(){dom.addCssClass(this.element,"ace_smooth-blinking")}.bind(this))}var blink=function(){this.timeoutId=setTimeout((function(){update(false)}),.6*this.blinkInterval)}.bind(this);this.intervalId=setInterval((function(){update(true);blink()}),this.blinkInterval);blink()};this.getPixelPosition=function(position,onScreen){if(!this.config||!this.session)return{left:0,top:0};if(!position)position=this.session.selection.getCursor();var pos=this.session.documentToScreenPosition(position);var cursorLeft=this.$padding+(this.session.$bidiHandler.isBidiRow(pos.row,position.row)?this.session.$bidiHandler.getPosLeft(pos.column):pos.column*this.config.characterWidth);var cursorTop=(pos.row-(onScreen?this.config.firstRowScreen:0))*this.config.lineHeight;return{left:cursorLeft,top:cursorTop}};this.update=function(config){this.config=config;var selections=this.session.$selectionMarkers;var i=0,cursorIndex=0;if(selections===undefined||selections.length===0){selections=[{cursor:null}]}for(var i=0,n=selections.length;i<n;i++){var pixelPos=this.getPixelPosition(selections[i].cursor,true);if((pixelPos.top>config.height+config.offset||pixelPos.top<0)&&i>1){continue}var style=(this.cursors[cursorIndex++]||this.addCursor()).style;if(!this.drawCursor){style.left=pixelPos.left+"px";style.top=pixelPos.top+"px";style.width=config.characterWidth+"px";style.height=config.lineHeight+"px"}else{this.drawCursor(style,pixelPos,config,selections[i],this.session)}}while(this.cursors.length>cursorIndex)this.removeCursor();var overwrite=this.session.getOverwrite();this.$setOverwrite(overwrite);this.$pixelPos=pixelPos;this.restartTimer()};this.drawCursor=null;this.$setOverwrite=function(overwrite){if(overwrite!=this.overwrite){this.overwrite=overwrite;if(overwrite)dom.addCssClass(this.element,"ace_overwrite-cursors");else dom.removeCssClass(this.element,"ace_overwrite-cursors")}};this.destroy=function(){clearInterval(this.intervalId);clearTimeout(this.timeoutId)}}).call(Cursor.prototype);exports.Cursor=Cursor}));ace.define("ace/scrollbar",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/event","ace/lib/event_emitter"],(function(acequire,exports,module){"use strict";var oop=acequire("./lib/oop");var dom=acequire("./lib/dom");var event=acequire("./lib/event");var EventEmitter=acequire("./lib/event_emitter").EventEmitter;var MAX_SCROLL_H=32768;var ScrollBar=function(parent){this.element=dom.createElement("div");this.element.className="ace_scrollbar ace_scrollbar"+this.classSuffix;this.inner=dom.createElement("div");this.inner.className="ace_scrollbar-inner";this.element.appendChild(this.inner);parent.appendChild(this.element);this.setVisible(false);this.skipEvent=false;event.addListener(this.element,"scroll",this.onScroll.bind(this));event.addListener(this.element,"mousedown",event.preventDefault)};(function(){oop.implement(this,EventEmitter);this.setVisible=function(isVisible){this.element.style.display=isVisible?"":"none";this.isVisible=isVisible;this.coeff=1}}).call(ScrollBar.prototype);var VScrollBar=function(parent,renderer){ScrollBar.call(this,parent);this.scrollTop=0;this.scrollHeight=0;renderer.$scrollbarWidth=this.width=dom.scrollbarWidth(parent.ownerDocument);this.inner.style.width=this.element.style.width=(this.width||15)+5+"px";this.$minWidth=0};oop.inherits(VScrollBar,ScrollBar);(function(){this.classSuffix="-v";this.onScroll=function(){if(!this.skipEvent){this.scrollTop=this.element.scrollTop;if(this.coeff!=1){var h=this.element.clientHeight/this.scrollHeight;this.scrollTop=this.scrollTop*(1-h)/(this.coeff-h)}this._emit("scroll",{data:this.scrollTop})}this.skipEvent=false};this.getWidth=function(){return Math.max(this.isVisible?this.width:0,this.$minWidth||0)};this.setHeight=function(height){this.element.style.height=height+"px"};this.setInnerHeight=this.setScrollHeight=function(height){this.scrollHeight=height;if(height>MAX_SCROLL_H){this.coeff=MAX_SCROLL_H/height;height=MAX_SCROLL_H}else if(this.coeff!=1){this.coeff=1}this.inner.style.height=height+"px"};this.setScrollTop=function(scrollTop){if(this.scrollTop!=scrollTop){this.skipEvent=true;this.scrollTop=scrollTop;this.element.scrollTop=scrollTop*this.coeff}}}).call(VScrollBar.prototype);var HScrollBar=function(parent,renderer){ScrollBar.call(this,parent);this.scrollLeft=0;this.height=renderer.$scrollbarWidth;this.inner.style.height=this.element.style.height=(this.height||15)+5+"px"};oop.inherits(HScrollBar,ScrollBar);(function(){this.classSuffix="-h";this.onScroll=function(){if(!this.skipEvent){this.scrollLeft=this.element.scrollLeft;this._emit("scroll",{data:this.scrollLeft})}this.skipEvent=false};this.getHeight=function(){return this.isVisible?this.height:0};this.setWidth=function(width){this.element.style.width=width+"px"};this.setInnerWidth=function(width){this.inner.style.width=width+"px"};this.setScrollWidth=function(width){this.inner.style.width=width+"px"};this.setScrollLeft=function(scrollLeft){if(this.scrollLeft!=scrollLeft){this.skipEvent=true;this.scrollLeft=this.element.scrollLeft=scrollLeft}}}).call(HScrollBar.prototype);exports.ScrollBar=VScrollBar;exports.ScrollBarV=VScrollBar;exports.ScrollBarH=HScrollBar;exports.VScrollBar=VScrollBar;exports.HScrollBar=HScrollBar}));ace.define("ace/renderloop",["require","exports","module","ace/lib/event"],(function(acequire,exports,module){"use strict";var event=acequire("./lib/event");var RenderLoop=function(onRender,win){this.onRender=onRender;this.pending=false;this.changes=0;this.window=win||window};(function(){this.schedule=function(change){this.changes=this.changes|change;if(!this.pending&&this.changes){this.pending=true;var _self=this;event.nextFrame((function(){_self.pending=false;var changes;while(changes=_self.changes){_self.changes=0;_self.onRender(changes)}}),this.window)}}}).call(RenderLoop.prototype);exports.RenderLoop=RenderLoop}));ace.define("ace/layer/font_metrics",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/lib/lang","ace/lib/useragent","ace/lib/event_emitter"],(function(acequire,exports,module){var oop=acequire("../lib/oop");var dom=acequire("../lib/dom");var lang=acequire("../lib/lang");var useragent=acequire("../lib/useragent");var EventEmitter=acequire("../lib/event_emitter").EventEmitter;var CHAR_COUNT=0;var FontMetrics=exports.FontMetrics=function(parentEl){this.el=dom.createElement("div");this.$setMeasureNodeStyles(this.el.style,true);this.$main=dom.createElement("div");this.$setMeasureNodeStyles(this.$main.style);this.$measureNode=dom.createElement("div");this.$setMeasureNodeStyles(this.$measureNode.style);this.el.appendChild(this.$main);this.el.appendChild(this.$measureNode);parentEl.appendChild(this.el);if(!CHAR_COUNT)this.$testFractionalRect();this.$measureNode.innerHTML=lang.stringRepeat("X",CHAR_COUNT);this.$characterSize={width:0,height:0};this.checkForSizeChanges()};(function(){oop.implement(this,EventEmitter);this.$characterSize={width:0,height:0};this.$testFractionalRect=function(){var el=dom.createElement("div");this.$setMeasureNodeStyles(el.style);el.style.width="0.2px";document.documentElement.appendChild(el);var w=el.getBoundingClientRect().width;if(w>0&&w<1)CHAR_COUNT=50;else CHAR_COUNT=100;el.parentNode.removeChild(el)};this.$setMeasureNodeStyles=function(style,isRoot){style.width=style.height="auto";style.left=style.top="0px";style.visibility="hidden";style.position="absolute";style.whiteSpace="pre";if(useragent.isIE<8){style["font-family"]="inherit"}else{style.font="inherit"}style.overflow=isRoot?"hidden":"visible"};this.checkForSizeChanges=function(){var size=this.$measureSizes();if(size&&(this.$characterSize.width!==size.width||this.$characterSize.height!==size.height)){this.$measureNode.style.fontWeight="bold";var boldSize=this.$measureSizes();this.$measureNode.style.fontWeight="";this.$characterSize=size;this.charSizes=Object.create(null);this.allowBoldFonts=boldSize&&boldSize.width===size.width&&boldSize.height===size.height;this._emit("changeCharacterSize",{data:size})}};this.$pollSizeChanges=function(){if(this.$pollSizeChangesTimer)return this.$pollSizeChangesTimer;var self=this;return this.$pollSizeChangesTimer=setInterval((function(){self.checkForSizeChanges()}),500)};this.setPolling=function(val){if(val){this.$pollSizeChanges()}else if(this.$pollSizeChangesTimer){clearInterval(this.$pollSizeChangesTimer);this.$pollSizeChangesTimer=0}};this.$measureSizes=function(){if(CHAR_COUNT===50){var rect=null;try{rect=this.$measureNode.getBoundingClientRect()}catch(e){rect={width:0,height:0}}var size={height:rect.height,width:rect.width/CHAR_COUNT}}else{var size={height:this.$measureNode.clientHeight,width:this.$measureNode.clientWidth/CHAR_COUNT}}if(size.width===0||size.height===0)return null;return size};this.$measureCharWidth=function(ch){this.$main.innerHTML=lang.stringRepeat(ch,CHAR_COUNT);var rect=this.$main.getBoundingClientRect();return rect.width/CHAR_COUNT};this.getCharacterWidth=function(ch){var w=this.charSizes[ch];if(w===undefined){w=this.charSizes[ch]=this.$measureCharWidth(ch)/this.$characterSize.width}return w};this.destroy=function(){clearInterval(this.$pollSizeChangesTimer);if(this.el&&this.el.parentNode)this.el.parentNode.removeChild(this.el)}}).call(FontMetrics.prototype)}));ace.define("ace/virtual_renderer",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/config","ace/lib/useragent","ace/layer/gutter","ace/layer/marker","ace/layer/text","ace/layer/cursor","ace/scrollbar","ace/scrollbar","ace/renderloop","ace/layer/font_metrics","ace/lib/event_emitter"],(function(acequire,exports,module){"use strict";var oop=acequire("./lib/oop");var dom=acequire("./lib/dom");var config=acequire("./config");var useragent=acequire("./lib/useragent");var GutterLayer=acequire("./layer/gutter").Gutter;var MarkerLayer=acequire("./layer/marker").Marker;var TextLayer=acequire("./layer/text").Text;var CursorLayer=acequire("./layer/cursor").Cursor;var HScrollBar=acequire("./scrollbar").HScrollBar;var VScrollBar=acequire("./scrollbar").VScrollBar;var RenderLoop=acequire("./renderloop").RenderLoop;var FontMetrics=acequire("./layer/font_metrics").FontMetrics;var EventEmitter=acequire("./lib/event_emitter").EventEmitter;var editorCss='.ace_editor {position: relative;overflow: hidden;font: 12px/normal \'Monaco\', \'Menlo\', \'Ubuntu Mono\', \'Consolas\', \'source-code-pro\', monospace;direction: ltr;text-align: left;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);}.ace_scroller {position: absolute;overflow: hidden;top: 0;bottom: 0;background-color: inherit;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;cursor: text;}.ace_content {position: absolute;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;min-width: 100%;}.ace_dragging .ace_scroller:before{position: absolute;top: 0;left: 0;right: 0;bottom: 0;content: \'\';background: rgba(250, 250, 250, 0.01);z-index: 1000;}.ace_dragging.ace_dark .ace_scroller:before{background: rgba(0, 0, 0, 0.01);}.ace_selecting, .ace_selecting * {cursor: text !important;}.ace_gutter {position: absolute;overflow : hidden;width: auto;top: 0;bottom: 0;left: 0;cursor: default;z-index: 4;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;}.ace_gutter-active-line {position: absolute;left: 0;right: 0;}.ace_scroller.ace_scroll-left {box-shadow: 17px 0 16px -16px rgba(0, 0, 0, 0.4) inset;}.ace_gutter-cell {padding-left: 19px;padding-right: 6px;background-repeat: no-repeat;}.ace_gutter-cell.ace_error {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABOFBMVEX/////////QRswFAb/Ui4wFAYwFAYwFAaWGAfDRymzOSH/PxswFAb/SiUwFAYwFAbUPRvjQiDllog5HhHdRybsTi3/Tyv9Tir+Syj/UC3////XurebMBIwFAb/RSHbPx/gUzfdwL3kzMivKBAwFAbbvbnhPx66NhowFAYwFAaZJg8wFAaxKBDZurf/RB6mMxb/SCMwFAYwFAbxQB3+RB4wFAb/Qhy4Oh+4QifbNRcwFAYwFAYwFAb/QRzdNhgwFAYwFAbav7v/Uy7oaE68MBK5LxLewr/r2NXewLswFAaxJw4wFAbkPRy2PyYwFAaxKhLm1tMwFAazPiQwFAaUGAb/QBrfOx3bvrv/VC/maE4wFAbRPBq6MRO8Qynew8Dp2tjfwb0wFAbx6eju5+by6uns4uH9/f36+vr/GkHjAAAAYnRSTlMAGt+64rnWu/bo8eAA4InH3+DwoN7j4eLi4xP99Nfg4+b+/u9B/eDs1MD1mO7+4PHg2MXa347g7vDizMLN4eG+Pv7i5evs/v79yu7S3/DV7/498Yv24eH+4ufQ3Ozu/v7+y13sRqwAAADLSURBVHjaZc/XDsFgGIBhtDrshlitmk2IrbHFqL2pvXf/+78DPokj7+Fz9qpU/9UXJIlhmPaTaQ6QPaz0mm+5gwkgovcV6GZzd5JtCQwgsxoHOvJO15kleRLAnMgHFIESUEPmawB9ngmelTtipwwfASilxOLyiV5UVUyVAfbG0cCPHig+GBkzAENHS0AstVF6bacZIOzgLmxsHbt2OecNgJC83JERmePUYq8ARGkJx6XtFsdddBQgZE2nPR6CICZhawjA4Fb/chv+399kfR+MMMDGOQAAAABJRU5ErkJggg==");background-repeat: no-repeat;background-position: 2px center;}.ace_gutter-cell.ace_warning {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAmVBMVEX///8AAAD///8AAAAAAABPSzb/5sAAAAB/blH/73z/ulkAAAAAAAD85pkAAAAAAAACAgP/vGz/rkDerGbGrV7/pkQICAf////e0IsAAAD/oED/qTvhrnUAAAD/yHD/njcAAADuv2r/nz//oTj/p064oGf/zHAAAAA9Nir/tFIAAAD/tlTiuWf/tkIAAACynXEAAAAAAAAtIRW7zBpBAAAAM3RSTlMAABR1m7RXO8Ln31Z36zT+neXe5OzooRDfn+TZ4p3h2hTf4t3k3ucyrN1K5+Xaks52Sfs9CXgrAAAAjklEQVR42o3PbQ+CIBQFYEwboPhSYgoYunIqqLn6/z8uYdH8Vmdnu9vz4WwXgN/xTPRD2+sgOcZjsge/whXZgUaYYvT8QnuJaUrjrHUQreGczuEafQCO/SJTufTbroWsPgsllVhq3wJEk2jUSzX3CUEDJC84707djRc5MTAQxoLgupWRwW6UB5fS++NV8AbOZgnsC7BpEAAAAABJRU5ErkJggg==");background-position: 2px center;}.ace_gutter-cell.ace_info {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAAAAAA6mKC9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAJ0Uk5TAAB2k804AAAAPklEQVQY02NgIB68QuO3tiLznjAwpKTgNyDbMegwisCHZUETUZV0ZqOquBpXj2rtnpSJT1AEnnRmL2OgGgAAIKkRQap2htgAAAAASUVORK5CYII=");background-position: 2px center;}.ace_dark .ace_gutter-cell.ace_info {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAJFBMVEUAAAChoaGAgIAqKiq+vr6tra1ZWVmUlJSbm5s8PDxubm56enrdgzg3AAAAAXRSTlMAQObYZgAAAClJREFUeNpjYMAPdsMYHegyJZFQBlsUlMFVCWUYKkAZMxZAGdxlDMQBAG+TBP4B6RyJAAAAAElFTkSuQmCC");}.ace_scrollbar {position: absolute;right: 0;bottom: 0;z-index: 6;}.ace_scrollbar-inner {position: absolute;cursor: text;left: 0;top: 0;}.ace_scrollbar-v{overflow-x: hidden;overflow-y: scroll;top: 0;}.ace_scrollbar-h {overflow-x: scroll;overflow-y: hidden;left: 0;}.ace_print-margin {position: absolute;height: 100%;}.ace_text-input {position: absolute;z-index: 0;width: 0.5em;height: 1em;opacity: 0;background: transparent;-moz-appearance: none;appearance: none;border: none;resize: none;outline: none;overflow: hidden;font: inherit;padding: 0 1px;margin: 0 -1px;text-indent: -1em;-ms-user-select: text;-moz-user-select: text;-webkit-user-select: text;user-select: text;white-space: pre!important;}.ace_text-input.ace_composition {background: inherit;color: inherit;z-index: 1000;opacity: 1;text-indent: 0;}.ace_layer {z-index: 1;position: absolute;overflow: hidden;word-wrap: normal;white-space: pre;height: 100%;width: 100%;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;pointer-events: none;}.ace_gutter-layer {position: relative;width: auto;text-align: right;pointer-events: auto;}.ace_text-layer {font: inherit !important;}.ace_cjk {display: inline-block;text-align: center;}.ace_cursor-layer {z-index: 4;}.ace_cursor {z-index: 4;position: absolute;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;border-left: 2px solid;transform: translatez(0);}.ace_multiselect .ace_cursor {border-left-width: 1px;}.ace_slim-cursors .ace_cursor {border-left-width: 1px;}.ace_overwrite-cursors .ace_cursor {border-left-width: 0;border-bottom: 1px solid;}.ace_hidden-cursors .ace_cursor {opacity: 0.2;}.ace_smooth-blinking .ace_cursor {-webkit-transition: opacity 0.18s;transition: opacity 0.18s;}.ace_marker-layer .ace_step, .ace_marker-layer .ace_stack {position: absolute;z-index: 3;}.ace_marker-layer .ace_selection {position: absolute;z-index: 5;}.ace_marker-layer .ace_bracket {position: absolute;z-index: 6;}.ace_marker-layer .ace_active-line {position: absolute;z-index: 2;}.ace_marker-layer .ace_selected-word {position: absolute;z-index: 4;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;}.ace_line .ace_fold {-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;display: inline-block;height: 11px;margin-top: -2px;vertical-align: middle;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACJJREFUeNpi+P//fxgTAwPDBxDxD078RSX+YeEyDFMCIMAAI3INmXiwf2YAAAAASUVORK5CYII=");background-repeat: no-repeat, repeat-x;background-position: center center, top left;color: transparent;border: 1px solid black;border-radius: 2px;cursor: pointer;pointer-events: auto;}.ace_dark .ace_fold {}.ace_fold:hover{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACBJREFUeNpi+P//fz4TAwPDZxDxD5X4i5fLMEwJgAADAEPVDbjNw87ZAAAAAElFTkSuQmCC");}.ace_tooltip {background-color: #FFF;background-image: -webkit-linear-gradient(top, transparent, rgba(0, 0, 0, 0.1));background-image: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.1));border: 1px solid gray;border-radius: 1px;box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);color: black;max-width: 100%;padding: 3px 4px;position: fixed;z-index: 999999;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;cursor: default;white-space: pre;word-wrap: break-word;line-height: normal;font-style: normal;font-weight: normal;letter-spacing: normal;pointer-events: none;}.ace_folding-enabled > .ace_gutter-cell {padding-right: 13px;}.ace_fold-widget {-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;margin: 0 -12px 0 1px;display: none;width: 11px;vertical-align: top;background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42mWKsQ0AMAzC8ixLlrzQjzmBiEjp0A6WwBCSPgKAXoLkqSot7nN3yMwR7pZ32NzpKkVoDBUxKAAAAABJRU5ErkJggg==");background-repeat: no-repeat;background-position: center;border-radius: 3px;border: 1px solid transparent;cursor: pointer;}.ace_folding-enabled .ace_fold-widget {display: inline-block;   }.ace_fold-widget.ace_end {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42m3HwQkAMAhD0YzsRchFKI7sAikeWkrxwScEB0nh5e7KTPWimZki4tYfVbX+MNl4pyZXejUO1QAAAABJRU5ErkJggg==");}.ace_fold-widget.ace_closed {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAGCAYAAAAG5SQMAAAAOUlEQVR42jXKwQkAMAgDwKwqKD4EwQ26sSOkVWjgIIHAzPiCgaqiqnJHZnKICBERHN194O5b9vbLuAVRL+l0YWnZAAAAAElFTkSuQmCCXA==");}.ace_fold-widget:hover {border: 1px solid rgba(0, 0, 0, 0.3);background-color: rgba(255, 255, 255, 0.2);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.7);}.ace_fold-widget:active {border: 1px solid rgba(0, 0, 0, 0.4);background-color: rgba(0, 0, 0, 0.05);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);}.ace_dark .ace_fold-widget {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHklEQVQIW2P4//8/AzoGEQ7oGCaLLAhWiSwB146BAQCSTPYocqT0AAAAAElFTkSuQmCC");}.ace_dark .ace_fold-widget.ace_end {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAH0lEQVQIW2P4//8/AxQ7wNjIAjDMgC4AxjCVKBirIAAF0kz2rlhxpAAAAABJRU5ErkJggg==");}.ace_dark .ace_fold-widget.ace_closed {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAFCAYAAACAcVaiAAAAHElEQVQIW2P4//+/AxAzgDADlOOAznHAKgPWAwARji8UIDTfQQAAAABJRU5ErkJggg==");}.ace_dark .ace_fold-widget:hover {box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);background-color: rgba(255, 255, 255, 0.1);}.ace_dark .ace_fold-widget:active {box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);}.ace_fold-widget.ace_invalid {background-color: #FFB4B4;border-color: #DE5555;}.ace_fade-fold-widgets .ace_fold-widget {-webkit-transition: opacity 0.4s ease 0.05s;transition: opacity 0.4s ease 0.05s;opacity: 0;}.ace_fade-fold-widgets:hover .ace_fold-widget {-webkit-transition: opacity 0.05s ease 0.05s;transition: opacity 0.05s ease 0.05s;opacity:1;}.ace_underline {text-decoration: underline;}.ace_bold {font-weight: bold;}.ace_nobold .ace_bold {font-weight: normal;}.ace_italic {font-style: italic;}.ace_error-marker {background-color: rgba(255, 0, 0,0.2);position: absolute;z-index: 9;}.ace_highlight-marker {background-color: rgba(255, 255, 0,0.2);position: absolute;z-index: 8;}.ace_br1 {border-top-left-radius    : 3px;}.ace_br2 {border-top-right-radius   : 3px;}.ace_br3 {border-top-left-radius    : 3px; border-top-right-radius:    3px;}.ace_br4 {border-bottom-right-radius: 3px;}.ace_br5 {border-top-left-radius    : 3px; border-bottom-right-radius: 3px;}.ace_br6 {border-top-right-radius   : 3px; border-bottom-right-radius: 3px;}.ace_br7 {border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px;}.ace_br8 {border-bottom-left-radius : 3px;}.ace_br9 {border-top-left-radius    : 3px; border-bottom-left-radius:  3px;}.ace_br10{border-top-right-radius   : 3px; border-bottom-left-radius:  3px;}.ace_br11{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-left-radius:  3px;}.ace_br12{border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br13{border-top-left-radius    : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br14{border-top-right-radius   : 3px; border-bottom-right-radius: 3px; border-bottom-left-radius:  3px;}.ace_br15{border-top-left-radius    : 3px; border-top-right-radius:    3px; border-bottom-right-radius: 3px; border-bottom-left-radius: 3px;}.ace_text-input-ios {position: absolute !important;top: -100000px !important;left: -100000px !important;}';dom.importCssString(editorCss,"ace_editor.css");var VirtualRenderer=function(container,theme){var _self=this;this.container=container||dom.createElement("div");this.$keepTextAreaAtCursor=!useragent.isOldIE;dom.addCssClass(this.container,"ace_editor");this.setTheme(theme);this.$gutter=dom.createElement("div");this.$gutter.className="ace_gutter";this.container.appendChild(this.$gutter);this.$gutter.setAttribute("aria-hidden",true);this.scroller=dom.createElement("div");this.scroller.className="ace_scroller";this.container.appendChild(this.scroller);this.content=dom.createElement("div");this.content.className="ace_content";this.scroller.appendChild(this.content);this.$gutterLayer=new GutterLayer(this.$gutter);this.$gutterLayer.on("changeGutterWidth",this.onGutterResize.bind(this));this.$markerBack=new MarkerLayer(this.content);var textLayer=this.$textLayer=new TextLayer(this.content);this.canvas=textLayer.element;this.$markerFront=new MarkerLayer(this.content);this.$cursorLayer=new CursorLayer(this.content);this.$horizScroll=false;this.$vScroll=false;this.scrollBar=this.scrollBarV=new VScrollBar(this.container,this);this.scrollBarH=new HScrollBar(this.container,this);this.scrollBarV.addEventListener("scroll",(function(e){if(!_self.$scrollAnimation)_self.session.setScrollTop(e.data-_self.scrollMargin.top)}));this.scrollBarH.addEventListener("scroll",(function(e){if(!_self.$scrollAnimation)_self.session.setScrollLeft(e.data-_self.scrollMargin.left)}));this.scrollTop=0;this.scrollLeft=0;this.cursorPos={row:0,column:0};this.$fontMetrics=new FontMetrics(this.container);this.$textLayer.$setFontMetrics(this.$fontMetrics);this.$textLayer.addEventListener("changeCharacterSize",(function(e){_self.updateCharacterSize();_self.onResize(true,_self.gutterWidth,_self.$size.width,_self.$size.height);_self._signal("changeCharacterSize",e)}));this.$size={width:0,height:0,scrollerHeight:0,scrollerWidth:0,$dirty:true};this.layerConfig={width:1,padding:0,firstRow:0,firstRowScreen:0,lastRow:0,lineHeight:0,characterWidth:0,minHeight:1,maxHeight:1,offset:0,height:1,gutterOffset:1};this.scrollMargin={left:0,right:0,top:0,bottom:0,v:0,h:0};this.$loop=new RenderLoop(this.$renderChanges.bind(this),this.container.ownerDocument.defaultView);this.$loop.schedule(this.CHANGE_FULL);this.updateCharacterSize();this.setPadding(4);config.resetOptions(this);config._emit("renderer",this)};(function(){this.CHANGE_CURSOR=1;this.CHANGE_MARKER=2;this.CHANGE_GUTTER=4;this.CHANGE_SCROLL=8;this.CHANGE_LINES=16;this.CHANGE_TEXT=32;this.CHANGE_SIZE=64;this.CHANGE_MARKER_BACK=128;this.CHANGE_MARKER_FRONT=256;this.CHANGE_FULL=512;this.CHANGE_H_SCROLL=1024;oop.implement(this,EventEmitter);this.updateCharacterSize=function(){if(this.$textLayer.allowBoldFonts!=this.$allowBoldFonts){this.$allowBoldFonts=this.$textLayer.allowBoldFonts;this.setStyle("ace_nobold",!this.$allowBoldFonts)}this.layerConfig.characterWidth=this.characterWidth=this.$textLayer.getCharacterWidth();this.layerConfig.lineHeight=this.lineHeight=this.$textLayer.getLineHeight();this.$updatePrintMargin()};this.setSession=function(session){if(this.session)this.session.doc.off("changeNewLineMode",this.onChangeNewLineMode);this.session=session;if(session&&this.scrollMargin.top&&session.getScrollTop()<=0)session.setScrollTop(-this.scrollMargin.top);this.$cursorLayer.setSession(session);this.$markerBack.setSession(session);this.$markerFront.setSession(session);this.$gutterLayer.setSession(session);this.$textLayer.setSession(session);if(!session)return;this.$loop.schedule(this.CHANGE_FULL);this.session.$setFontMetrics(this.$fontMetrics);this.scrollBarH.scrollLeft=this.scrollBarV.scrollTop=null;this.onChangeNewLineMode=this.onChangeNewLineMode.bind(this);this.onChangeNewLineMode();this.session.doc.on("changeNewLineMode",this.onChangeNewLineMode)};this.updateLines=function(firstRow,lastRow,force){if(lastRow===undefined)lastRow=Infinity;if(!this.$changedLines){this.$changedLines={firstRow:firstRow,lastRow:lastRow}}else{if(this.$changedLines.firstRow>firstRow)this.$changedLines.firstRow=firstRow;if(this.$changedLines.lastRow<lastRow)this.$changedLines.lastRow=lastRow}if(this.$changedLines.lastRow<this.layerConfig.firstRow){if(force)this.$changedLines.lastRow=this.layerConfig.lastRow;else return}if(this.$changedLines.firstRow>this.layerConfig.lastRow)return;this.$loop.schedule(this.CHANGE_LINES)};this.onChangeNewLineMode=function(){this.$loop.schedule(this.CHANGE_TEXT);this.$textLayer.$updateEolChar();this.session.$bidiHandler.setEolChar(this.$textLayer.EOL_CHAR)};this.onChangeTabSize=function(){this.$loop.schedule(this.CHANGE_TEXT|this.CHANGE_MARKER);this.$textLayer.onChangeTabSize()};this.updateText=function(){this.$loop.schedule(this.CHANGE_TEXT)};this.updateFull=function(force){if(force)this.$renderChanges(this.CHANGE_FULL,true);else this.$loop.schedule(this.CHANGE_FULL)};this.updateFontSize=function(){this.$textLayer.checkForSizeChanges()};this.$changes=0;this.$updateSizeAsync=function(){if(this.$loop.pending)this.$size.$dirty=true;else this.onResize()};this.onResize=function(force,gutterWidth,width,height){if(this.resizing>2)return;else if(this.resizing>0)this.resizing++;else this.resizing=force?1:0;var el=this.container;if(!height)height=el.clientHeight||el.scrollHeight;if(!width)width=el.clientWidth||el.scrollWidth;var changes=this.$updateCachedSize(force,gutterWidth,width,height);if(!this.$size.scrollerHeight||!width&&!height)return this.resizing=0;if(force)this.$gutterLayer.$padding=null;if(force)this.$renderChanges(changes|this.$changes,true);else this.$loop.schedule(changes|this.$changes);if(this.resizing)this.resizing=0;this.scrollBarV.scrollLeft=this.scrollBarV.scrollTop=null};this.$updateCachedSize=function(force,gutterWidth,width,height){height-=this.$extraHeight||0;var changes=0;var size=this.$size;var oldSize={width:size.width,height:size.height,scrollerHeight:size.scrollerHeight,scrollerWidth:size.scrollerWidth};if(height&&(force||size.height!=height)){size.height=height;changes|=this.CHANGE_SIZE;size.scrollerHeight=size.height;if(this.$horizScroll)size.scrollerHeight-=this.scrollBarH.getHeight();this.scrollBarV.element.style.bottom=this.scrollBarH.getHeight()+"px";changes=changes|this.CHANGE_SCROLL}if(width&&(force||size.width!=width)){changes|=this.CHANGE_SIZE;size.width=width;if(gutterWidth==null)gutterWidth=this.$showGutter?this.$gutter.offsetWidth:0;this.gutterWidth=gutterWidth;this.scrollBarH.element.style.left=this.scroller.style.left=gutterWidth+"px";size.scrollerWidth=Math.max(0,width-gutterWidth-this.scrollBarV.getWidth());this.scrollBarH.element.style.right=this.scroller.style.right=this.scrollBarV.getWidth()+"px";this.scroller.style.bottom=this.scrollBarH.getHeight()+"px";if(this.session&&this.session.getUseWrapMode()&&this.adjustWrapLimit()||force)changes|=this.CHANGE_FULL}size.$dirty=!width||!height;if(changes)this._signal("resize",oldSize);return changes};this.onGutterResize=function(){var gutterWidth=this.$showGutter?this.$gutter.offsetWidth:0;if(gutterWidth!=this.gutterWidth)this.$changes|=this.$updateCachedSize(true,gutterWidth,this.$size.width,this.$size.height);if(this.session.getUseWrapMode()&&this.adjustWrapLimit()){this.$loop.schedule(this.CHANGE_FULL)}else if(this.$size.$dirty){this.$loop.schedule(this.CHANGE_FULL)}else{this.$computeLayerConfig();this.$loop.schedule(this.CHANGE_MARKER)}};this.adjustWrapLimit=function(){var availableWidth=this.$size.scrollerWidth-this.$padding*2;var limit=Math.floor(availableWidth/this.characterWidth);return this.session.adjustWrapLimit(limit,this.$showPrintMargin&&this.$printMarginColumn)};this.setAnimatedScroll=function(shouldAnimate){this.setOption("animatedScroll",shouldAnimate)};this.getAnimatedScroll=function(){return this.$animatedScroll};this.setShowInvisibles=function(showInvisibles){this.setOption("showInvisibles",showInvisibles);this.session.$bidiHandler.setShowInvisibles(showInvisibles)};this.getShowInvisibles=function(){return this.getOption("showInvisibles")};this.getDisplayIndentGuides=function(){return this.getOption("displayIndentGuides")};this.setDisplayIndentGuides=function(display){this.setOption("displayIndentGuides",display)};this.setShowPrintMargin=function(showPrintMargin){this.setOption("showPrintMargin",showPrintMargin)};this.getShowPrintMargin=function(){return this.getOption("showPrintMargin")};this.setPrintMarginColumn=function(showPrintMargin){this.setOption("printMarginColumn",showPrintMargin)};this.getPrintMarginColumn=function(){return this.getOption("printMarginColumn")};this.getShowGutter=function(){return this.getOption("showGutter")};this.setShowGutter=function(show){return this.setOption("showGutter",show)};this.getFadeFoldWidgets=function(){return this.getOption("fadeFoldWidgets")};this.setFadeFoldWidgets=function(show){this.setOption("fadeFoldWidgets",show)};this.setHighlightGutterLine=function(shouldHighlight){this.setOption("highlightGutterLine",shouldHighlight)};this.getHighlightGutterLine=function(){return this.getOption("highlightGutterLine")};this.$updateGutterLineHighlight=function(){var pos=this.$cursorLayer.$pixelPos;var height=this.layerConfig.lineHeight;if(this.session.getUseWrapMode()){var cursor=this.session.selection.getCursor();cursor.column=0;pos=this.$cursorLayer.getPixelPosition(cursor,true);height*=this.session.getRowLength(cursor.row)}this.$gutterLineHighlight.style.top=pos.top-this.layerConfig.offset+"px";this.$gutterLineHighlight.style.height=height+"px"};this.$updatePrintMargin=function(){if(!this.$showPrintMargin&&!this.$printMarginEl)return;if(!this.$printMarginEl){var containerEl=dom.createElement("div");containerEl.className="ace_layer ace_print-margin-layer";this.$printMarginEl=dom.createElement("div");this.$printMarginEl.className="ace_print-margin";containerEl.appendChild(this.$printMarginEl);this.content.insertBefore(containerEl,this.content.firstChild)}var style=this.$printMarginEl.style;style.left=this.characterWidth*this.$printMarginColumn+this.$padding+"px";style.visibility=this.$showPrintMargin?"visible":"hidden";if(this.session&&this.session.$wrap==-1)this.adjustWrapLimit()};this.getContainerElement=function(){return this.container};this.getMouseEventTarget=function(){return this.scroller};this.getTextAreaContainer=function(){return this.container};this.$moveTextAreaToCursor=function(){if(!this.$keepTextAreaAtCursor)return;var config=this.layerConfig;var posTop=this.$cursorLayer.$pixelPos.top;var posLeft=this.$cursorLayer.$pixelPos.left;posTop-=config.offset;var style=this.textarea.style;var h=this.lineHeight;if(posTop<0||posTop>config.height-h){style.top=style.left="0";return}var w=this.characterWidth;if(this.$composition){var val=this.textarea.value.replace(/^\x01+/,"");w*=this.session.$getStringScreenWidth(val)[0]+2;h+=2}posLeft-=this.scrollLeft;if(posLeft>this.$size.scrollerWidth-w)posLeft=this.$size.scrollerWidth-w;posLeft+=this.gutterWidth;style.height=h+"px";style.width=w+"px";style.left=Math.min(posLeft,this.$size.scrollerWidth-w)+"px";style.top=Math.min(posTop,this.$size.height-h)+"px"};this.getFirstVisibleRow=function(){return this.layerConfig.firstRow};this.getFirstFullyVisibleRow=function(){return this.layerConfig.firstRow+(this.layerConfig.offset===0?0:1)};this.getLastFullyVisibleRow=function(){var config=this.layerConfig;var lastRow=config.lastRow;var top=this.session.documentToScreenRow(lastRow,0)*config.lineHeight;if(top-this.session.getScrollTop()>config.height-config.lineHeight)return lastRow-1;return lastRow};this.getLastVisibleRow=function(){return this.layerConfig.lastRow};this.$padding=null;this.setPadding=function(padding){this.$padding=padding;this.$textLayer.setPadding(padding);this.$cursorLayer.setPadding(padding);this.$markerFront.setPadding(padding);this.$markerBack.setPadding(padding);this.$loop.schedule(this.CHANGE_FULL);this.$updatePrintMargin()};this.setScrollMargin=function(top,bottom,left,right){var sm=this.scrollMargin;sm.top=top|0;sm.bottom=bottom|0;sm.right=right|0;sm.left=left|0;sm.v=sm.top+sm.bottom;sm.h=sm.left+sm.right;if(sm.top&&this.scrollTop<=0&&this.session)this.session.setScrollTop(-sm.top);this.updateFull()};this.getHScrollBarAlwaysVisible=function(){return this.$hScrollBarAlwaysVisible};this.setHScrollBarAlwaysVisible=function(alwaysVisible){this.setOption("hScrollBarAlwaysVisible",alwaysVisible)};this.getVScrollBarAlwaysVisible=function(){return this.$vScrollBarAlwaysVisible};this.setVScrollBarAlwaysVisible=function(alwaysVisible){this.setOption("vScrollBarAlwaysVisible",alwaysVisible)};this.$updateScrollBarV=function(){var scrollHeight=this.layerConfig.maxHeight;var scrollerHeight=this.$size.scrollerHeight;if(!this.$maxLines&&this.$scrollPastEnd){scrollHeight-=(scrollerHeight-this.lineHeight)*this.$scrollPastEnd;if(this.scrollTop>scrollHeight-scrollerHeight){scrollHeight=this.scrollTop+scrollerHeight;this.scrollBarV.scrollTop=null}}this.scrollBarV.setScrollHeight(scrollHeight+this.scrollMargin.v);this.scrollBarV.setScrollTop(this.scrollTop+this.scrollMargin.top)};this.$updateScrollBarH=function(){this.scrollBarH.setScrollWidth(this.layerConfig.width+2*this.$padding+this.scrollMargin.h);this.scrollBarH.setScrollLeft(this.scrollLeft+this.scrollMargin.left)};this.$frozen=false;this.freeze=function(){this.$frozen=true};this.unfreeze=function(){this.$frozen=false};this.$renderChanges=function(changes,force){if(this.$changes){changes|=this.$changes;this.$changes=0}if(!this.session||!this.container.offsetWidth||this.$frozen||!changes&&!force){this.$changes|=changes;return}if(this.$size.$dirty){this.$changes|=changes;return this.onResize(true)}if(!this.lineHeight){this.$textLayer.checkForSizeChanges()}this._signal("beforeRender");if(this.session&&this.session.$bidiHandler)this.session.$bidiHandler.updateCharacterWidths(this.$fontMetrics);var config=this.layerConfig;if(changes&this.CHANGE_FULL||changes&this.CHANGE_SIZE||changes&this.CHANGE_TEXT||changes&this.CHANGE_LINES||changes&this.CHANGE_SCROLL||changes&this.CHANGE_H_SCROLL){changes|=this.$computeLayerConfig();if(config.firstRow!=this.layerConfig.firstRow&&config.firstRowScreen==this.layerConfig.firstRowScreen){var st=this.scrollTop+(config.firstRow-this.layerConfig.firstRow)*this.lineHeight;if(st>0){this.scrollTop=st;changes=changes|this.CHANGE_SCROLL;changes|=this.$computeLayerConfig()}}config=this.layerConfig;this.$updateScrollBarV();if(changes&this.CHANGE_H_SCROLL)this.$updateScrollBarH();this.$gutterLayer.element.style.marginTop=-config.offset+"px";this.content.style.marginTop=-config.offset+"px";this.content.style.width=config.width+2*this.$padding+"px";this.content.style.height=config.minHeight+"px"}if(changes&this.CHANGE_H_SCROLL){this.content.style.marginLeft=-this.scrollLeft+"px";this.scroller.className=this.scrollLeft<=0?"ace_scroller":"ace_scroller ace_scroll-left"}if(changes&this.CHANGE_FULL){this.$textLayer.update(config);if(this.$showGutter)this.$gutterLayer.update(config);this.$markerBack.update(config);this.$markerFront.update(config);this.$cursorLayer.update(config);this.$moveTextAreaToCursor();this.$highlightGutterLine&&this.$updateGutterLineHighlight();this._signal("afterRender");return}if(changes&this.CHANGE_SCROLL){if(changes&this.CHANGE_TEXT||changes&this.CHANGE_LINES)this.$textLayer.update(config);else this.$textLayer.scrollLines(config);if(this.$showGutter)this.$gutterLayer.update(config);this.$markerBack.update(config);this.$markerFront.update(config);this.$cursorLayer.update(config);this.$highlightGutterLine&&this.$updateGutterLineHighlight();this.$moveTextAreaToCursor();this._signal("afterRender");return}if(changes&this.CHANGE_TEXT){this.$textLayer.update(config);if(this.$showGutter)this.$gutterLayer.update(config)}else if(changes&this.CHANGE_LINES){if(this.$updateLines()||changes&this.CHANGE_GUTTER&&this.$showGutter)this.$gutterLayer.update(config)}else if(changes&this.CHANGE_TEXT||changes&this.CHANGE_GUTTER){if(this.$showGutter)this.$gutterLayer.update(config)}if(changes&this.CHANGE_CURSOR){this.$cursorLayer.update(config);this.$moveTextAreaToCursor();this.$highlightGutterLine&&this.$updateGutterLineHighlight()}if(changes&(this.CHANGE_MARKER|this.CHANGE_MARKER_FRONT)){this.$markerFront.update(config)}if(changes&(this.CHANGE_MARKER|this.CHANGE_MARKER_BACK)){this.$markerBack.update(config)}this._signal("afterRender")};this.$autosize=function(){var height=this.session.getScreenLength()*this.lineHeight;var maxHeight=this.$maxLines*this.lineHeight;var desiredHeight=Math.min(maxHeight,Math.max((this.$minLines||1)*this.lineHeight,height))+this.scrollMargin.v+(this.$extraHeight||0);if(this.$horizScroll)desiredHeight+=this.scrollBarH.getHeight();if(this.$maxPixelHeight&&desiredHeight>this.$maxPixelHeight)desiredHeight=this.$maxPixelHeight;var vScroll=height>maxHeight;if(desiredHeight!=this.desiredHeight||this.$size.height!=this.desiredHeight||vScroll!=this.$vScroll){if(vScroll!=this.$vScroll){this.$vScroll=vScroll;this.scrollBarV.setVisible(vScroll)}var w=this.container.clientWidth;this.container.style.height=desiredHeight+"px";this.$updateCachedSize(true,this.$gutterWidth,w,desiredHeight);this.desiredHeight=desiredHeight;this._signal("autosize")}};this.$computeLayerConfig=function(){var session=this.session;var size=this.$size;var hideScrollbars=size.height<=2*this.lineHeight;var screenLines=this.session.getScreenLength();var maxHeight=screenLines*this.lineHeight;var longestLine=this.$getLongestLine();var horizScroll=!hideScrollbars&&(this.$hScrollBarAlwaysVisible||size.scrollerWidth-longestLine-2*this.$padding<0);var hScrollChanged=this.$horizScroll!==horizScroll;if(hScrollChanged){this.$horizScroll=horizScroll;this.scrollBarH.setVisible(horizScroll)}var vScrollBefore=this.$vScroll;if(this.$maxLines&&this.lineHeight>1)this.$autosize();var offset=this.scrollTop%this.lineHeight;var minHeight=size.scrollerHeight+this.lineHeight;var scrollPastEnd=!this.$maxLines&&this.$scrollPastEnd?(size.scrollerHeight-this.lineHeight)*this.$scrollPastEnd:0;maxHeight+=scrollPastEnd;var sm=this.scrollMargin;this.session.setScrollTop(Math.max(-sm.top,Math.min(this.scrollTop,maxHeight-size.scrollerHeight+sm.bottom)));this.session.setScrollLeft(Math.max(-sm.left,Math.min(this.scrollLeft,longestLine+2*this.$padding-size.scrollerWidth+sm.right)));var vScroll=!hideScrollbars&&(this.$vScrollBarAlwaysVisible||size.scrollerHeight-maxHeight+scrollPastEnd<0||this.scrollTop>sm.top);var vScrollChanged=vScrollBefore!==vScroll;if(vScrollChanged){this.$vScroll=vScroll;this.scrollBarV.setVisible(vScroll)}var lineCount=Math.ceil(minHeight/this.lineHeight)-1;var firstRow=Math.max(0,Math.round((this.scrollTop-offset)/this.lineHeight));var lastRow=firstRow+lineCount;var firstRowScreen,firstRowHeight;var lineHeight=this.lineHeight;firstRow=session.screenToDocumentRow(firstRow,0);var foldLine=session.getFoldLine(firstRow);if(foldLine){firstRow=foldLine.start.row}firstRowScreen=session.documentToScreenRow(firstRow,0);firstRowHeight=session.getRowLength(firstRow)*lineHeight;lastRow=Math.min(session.screenToDocumentRow(lastRow,0),session.getLength()-1);minHeight=size.scrollerHeight+session.getRowLength(lastRow)*lineHeight+firstRowHeight;offset=this.scrollTop-firstRowScreen*lineHeight;var changes=0;if(this.layerConfig.width!=longestLine)changes=this.CHANGE_H_SCROLL;if(hScrollChanged||vScrollChanged){changes=this.$updateCachedSize(true,this.gutterWidth,size.width,size.height);this._signal("scrollbarVisibilityChanged");if(vScrollChanged)longestLine=this.$getLongestLine()}this.layerConfig={width:longestLine,padding:this.$padding,firstRow:firstRow,firstRowScreen:firstRowScreen,lastRow:lastRow,lineHeight:lineHeight,characterWidth:this.characterWidth,minHeight:minHeight,maxHeight:maxHeight,offset:offset,gutterOffset:lineHeight?Math.max(0,Math.ceil((offset+size.height-size.scrollerHeight)/lineHeight)):0,height:this.$size.scrollerHeight};return changes};this.$updateLines=function(){if(!this.$changedLines)return;var firstRow=this.$changedLines.firstRow;var lastRow=this.$changedLines.lastRow;this.$changedLines=null;var layerConfig=this.layerConfig;if(firstRow>layerConfig.lastRow+1){return}if(lastRow<layerConfig.firstRow){return}if(lastRow===Infinity){if(this.$showGutter)this.$gutterLayer.update(layerConfig);this.$textLayer.update(layerConfig);return}this.$textLayer.updateLines(layerConfig,firstRow,lastRow);return true};this.$getLongestLine=function(){var charCount=this.session.getScreenWidth();if(this.showInvisibles&&!this.session.$useWrapMode)charCount+=1;return Math.max(this.$size.scrollerWidth-2*this.$padding,Math.round(charCount*this.characterWidth))};this.updateFrontMarkers=function(){this.$markerFront.setMarkers(this.session.getMarkers(true));this.$loop.schedule(this.CHANGE_MARKER_FRONT)};this.updateBackMarkers=function(){this.$markerBack.setMarkers(this.session.getMarkers());this.$loop.schedule(this.CHANGE_MARKER_BACK)};this.addGutterDecoration=function(row,className){this.$gutterLayer.addGutterDecoration(row,className)};this.removeGutterDecoration=function(row,className){this.$gutterLayer.removeGutterDecoration(row,className)};this.updateBreakpoints=function(rows){this.$loop.schedule(this.CHANGE_GUTTER)};this.setAnnotations=function(annotations){this.$gutterLayer.setAnnotations(annotations);this.$loop.schedule(this.CHANGE_GUTTER)};this.updateCursor=function(){this.$loop.schedule(this.CHANGE_CURSOR)};this.hideCursor=function(){this.$cursorLayer.hideCursor()};this.showCursor=function(){this.$cursorLayer.showCursor()};this.scrollSelectionIntoView=function(anchor,lead,offset){this.scrollCursorIntoView(anchor,offset);this.scrollCursorIntoView(lead,offset)};this.scrollCursorIntoView=function(cursor,offset,$viewMargin){if(this.$size.scrollerHeight===0)return;var pos=this.$cursorLayer.getPixelPosition(cursor);var left=pos.left;var top=pos.top;var topMargin=$viewMargin&&$viewMargin.top||0;var bottomMargin=$viewMargin&&$viewMargin.bottom||0;var scrollTop=this.$scrollAnimation?this.session.getScrollTop():this.scrollTop;if(scrollTop+topMargin>top){if(offset&&scrollTop+topMargin>top+this.lineHeight)top-=offset*this.$size.scrollerHeight;if(top===0)top=-this.scrollMargin.top;this.session.setScrollTop(top)}else if(scrollTop+this.$size.scrollerHeight-bottomMargin<top+this.lineHeight){if(offset&&scrollTop+this.$size.scrollerHeight-bottomMargin<top-this.lineHeight)top+=offset*this.$size.scrollerHeight;this.session.setScrollTop(top+this.lineHeight-this.$size.scrollerHeight)}var scrollLeft=this.scrollLeft;if(scrollLeft>left){if(left<this.$padding+2*this.layerConfig.characterWidth)left=-this.scrollMargin.left;this.session.setScrollLeft(left)}else if(scrollLeft+this.$size.scrollerWidth<left+this.characterWidth){this.session.setScrollLeft(Math.round(left+this.characterWidth-this.$size.scrollerWidth))}else if(scrollLeft<=this.$padding&&left-scrollLeft<this.characterWidth){this.session.setScrollLeft(0)}};this.getScrollTop=function(){return this.session.getScrollTop()};this.getScrollLeft=function(){return this.session.getScrollLeft()};this.getScrollTopRow=function(){return this.scrollTop/this.lineHeight};this.getScrollBottomRow=function(){return Math.max(0,Math.floor((this.scrollTop+this.$size.scrollerHeight)/this.lineHeight)-1)};this.scrollToRow=function(row){this.session.setScrollTop(row*this.lineHeight)};this.alignCursor=function(cursor,alignment){if(typeof cursor=="number")cursor={row:cursor,column:0};var pos=this.$cursorLayer.getPixelPosition(cursor);var h=this.$size.scrollerHeight-this.lineHeight;var offset=pos.top-h*(alignment||0);this.session.setScrollTop(offset);return offset};this.STEPS=8;this.$calcSteps=function(fromValue,toValue){var i=0;var l=this.STEPS;var steps=[];var func=function(t,x_min,dx){return dx*(Math.pow(t-1,3)+1)+x_min};for(i=0;i<l;++i)steps.push(func(i/this.STEPS,fromValue,toValue-fromValue));return steps};this.scrollToLine=function(line,center,animate,callback){var pos=this.$cursorLayer.getPixelPosition({row:line,column:0});var offset=pos.top;if(center)offset-=this.$size.scrollerHeight/2;var initialScroll=this.scrollTop;this.session.setScrollTop(offset);if(animate!==false)this.animateScrolling(initialScroll,callback)};this.animateScrolling=function(fromValue,callback){var toValue=this.scrollTop;if(!this.$animatedScroll)return;var _self=this;if(fromValue==toValue)return;if(this.$scrollAnimation){var oldSteps=this.$scrollAnimation.steps;if(oldSteps.length){fromValue=oldSteps[0];if(fromValue==toValue)return}}var steps=_self.$calcSteps(fromValue,toValue);this.$scrollAnimation={from:fromValue,to:toValue,steps:steps};clearInterval(this.$timer);_self.session.setScrollTop(steps.shift());_self.session.$scrollTop=toValue;this.$timer=setInterval((function(){if(steps.length){_self.session.setScrollTop(steps.shift());_self.session.$scrollTop=toValue}else if(toValue!=null){_self.session.$scrollTop=-1;_self.session.setScrollTop(toValue);toValue=null}else{_self.$timer=clearInterval(_self.$timer);_self.$scrollAnimation=null;callback&&callback()}}),10)};this.scrollToY=function(scrollTop){if(this.scrollTop!==scrollTop){this.$loop.schedule(this.CHANGE_SCROLL);this.scrollTop=scrollTop}};this.scrollToX=function(scrollLeft){if(this.scrollLeft!==scrollLeft)this.scrollLeft=scrollLeft;this.$loop.schedule(this.CHANGE_H_SCROLL)};this.scrollTo=function(x,y){this.session.setScrollTop(y);this.session.setScrollLeft(y)};this.scrollBy=function(deltaX,deltaY){deltaY&&this.session.setScrollTop(this.session.getScrollTop()+deltaY);deltaX&&this.session.setScrollLeft(this.session.getScrollLeft()+deltaX)};this.isScrollableBy=function(deltaX,deltaY){if(deltaY<0&&this.session.getScrollTop()>=1-this.scrollMargin.top)return true;if(deltaY>0&&this.session.getScrollTop()+this.$size.scrollerHeight-this.layerConfig.maxHeight<-1+this.scrollMargin.bottom)return true;if(deltaX<0&&this.session.getScrollLeft()>=1-this.scrollMargin.left)return true;if(deltaX>0&&this.session.getScrollLeft()+this.$size.scrollerWidth-this.layerConfig.width<-1+this.scrollMargin.right)return true};this.pixelToScreenCoordinates=function(x,y){var canvasPos=this.scroller.getBoundingClientRect();var offsetX=x+this.scrollLeft-canvasPos.left-this.$padding;var offset=offsetX/this.characterWidth;var row=Math.floor((y+this.scrollTop-canvasPos.top)/this.lineHeight);var col=Math.round(offset);return{row:row,column:col,side:offset-col>0?1:-1,offsetX:offsetX}};this.screenToTextCoordinates=function(x,y){var canvasPos=this.scroller.getBoundingClientRect();var offsetX=x+this.scrollLeft-canvasPos.left-this.$padding;var col=Math.round(offsetX/this.characterWidth);var row=(y+this.scrollTop-canvasPos.top)/this.lineHeight;return this.session.screenToDocumentPosition(row,Math.max(col,0),offsetX)};this.textToScreenCoordinates=function(row,column){var canvasPos=this.scroller.getBoundingClientRect();var pos=this.session.documentToScreenPosition(row,column);var x=this.$padding+(this.session.$bidiHandler.isBidiRow(pos.row,row)?this.session.$bidiHandler.getPosLeft(pos.column):Math.round(pos.column*this.characterWidth));var y=pos.row*this.lineHeight;return{pageX:canvasPos.left+x-this.scrollLeft,pageY:canvasPos.top+y-this.scrollTop}};this.visualizeFocus=function(){dom.addCssClass(this.container,"ace_focus")};this.visualizeBlur=function(){dom.removeCssClass(this.container,"ace_focus")};this.showComposition=function(position){if(!this.$composition)this.$composition={keepTextAreaAtCursor:this.$keepTextAreaAtCursor,cssText:this.textarea.style.cssText};this.$keepTextAreaAtCursor=true;dom.addCssClass(this.textarea,"ace_composition");this.textarea.style.cssText="";this.$moveTextAreaToCursor()};this.setCompositionText=function(text){this.$moveTextAreaToCursor()};this.hideComposition=function(){if(!this.$composition)return;dom.removeCssClass(this.textarea,"ace_composition");this.$keepTextAreaAtCursor=this.$composition.keepTextAreaAtCursor;this.textarea.style.cssText=this.$composition.cssText;this.$composition=null};this.setTheme=function(theme,cb){var _self=this;this.$themeId=theme;_self._dispatchEvent("themeChange",{theme:theme});if(!theme||typeof theme=="string"){var moduleName=theme||this.$options.theme.initialValue;config.loadModule(["theme",moduleName],afterLoad)}else{afterLoad(theme)}function afterLoad(module){if(_self.$themeId!=theme)return cb&&cb();if(!module||!module.cssClass)throw new Error("couldn't load module "+theme+" or it didn't call define");dom.importCssString(module.cssText,module.cssClass,_self.container.ownerDocument);if(_self.theme)dom.removeCssClass(_self.container,_self.theme.cssClass);var padding="padding"in module?module.padding:"padding"in(_self.theme||{})?4:_self.$padding;if(_self.$padding&&padding!=_self.$padding)_self.setPadding(padding);_self.$theme=module.cssClass;_self.theme=module;dom.addCssClass(_self.container,module.cssClass);dom.setCssClass(_self.container,"ace_dark",module.isDark);if(_self.$size){_self.$size.width=0;_self.$updateSizeAsync()}_self._dispatchEvent("themeLoaded",{theme:module});cb&&cb()}};this.getTheme=function(){return this.$themeId};this.setStyle=function(style,include){dom.setCssClass(this.container,style,include!==false)};this.unsetStyle=function(style){dom.removeCssClass(this.container,style)};this.setCursorStyle=function(style){if(this.scroller.style.cursor!=style)this.scroller.style.cursor=style};this.setMouseCursor=function(cursorStyle){this.scroller.style.cursor=cursorStyle};this.destroy=function(){this.$textLayer.destroy();this.$cursorLayer.destroy()}}).call(VirtualRenderer.prototype);config.defineOptions(VirtualRenderer.prototype,"renderer",{animatedScroll:{initialValue:false},showInvisibles:{set:function(value){if(this.$textLayer.setShowInvisibles(value))this.$loop.schedule(this.CHANGE_TEXT)},initialValue:false},showPrintMargin:{set:function(){this.$updatePrintMargin()},initialValue:true},printMarginColumn:{set:function(){this.$updatePrintMargin()},initialValue:80},printMargin:{set:function(val){if(typeof val=="number")this.$printMarginColumn=val;this.$showPrintMargin=!!val;this.$updatePrintMargin()},get:function(){return this.$showPrintMargin&&this.$printMarginColumn}},showGutter:{set:function(show){this.$gutter.style.display=show?"block":"none";this.$loop.schedule(this.CHANGE_FULL);this.onGutterResize()},initialValue:true},fadeFoldWidgets:{set:function(show){dom.setCssClass(this.$gutter,"ace_fade-fold-widgets",show)},initialValue:false},showFoldWidgets:{set:function(show){this.$gutterLayer.setShowFoldWidgets(show)},initialValue:true},showLineNumbers:{set:function(show){this.$gutterLayer.setShowLineNumbers(show);this.$loop.schedule(this.CHANGE_GUTTER)},initialValue:true},displayIndentGuides:{set:function(show){if(this.$textLayer.setDisplayIndentGuides(show))this.$loop.schedule(this.CHANGE_TEXT)},initialValue:true},highlightGutterLine:{set:function(shouldHighlight){if(!this.$gutterLineHighlight){this.$gutterLineHighlight=dom.createElement("div");this.$gutterLineHighlight.className="ace_gutter-active-line";this.$gutter.appendChild(this.$gutterLineHighlight);return}this.$gutterLineHighlight.style.display=shouldHighlight?"":"none";if(this.$cursorLayer.$pixelPos)this.$updateGutterLineHighlight()},initialValue:false,value:true},hScrollBarAlwaysVisible:{set:function(val){if(!this.$hScrollBarAlwaysVisible||!this.$horizScroll)this.$loop.schedule(this.CHANGE_SCROLL)},initialValue:false},vScrollBarAlwaysVisible:{set:function(val){if(!this.$vScrollBarAlwaysVisible||!this.$vScroll)this.$loop.schedule(this.CHANGE_SCROLL)},initialValue:false},fontSize:{set:function(size){if(typeof size=="number")size=size+"px";this.container.style.fontSize=size;this.updateFontSize()},initialValue:12},fontFamily:{set:function(name){this.container.style.fontFamily=name;this.updateFontSize()}},maxLines:{set:function(val){this.updateFull()}},minLines:{set:function(val){this.updateFull()}},maxPixelHeight:{set:function(val){this.updateFull()},initialValue:0},scrollPastEnd:{set:function(val){val=+val||0;if(this.$scrollPastEnd==val)return;this.$scrollPastEnd=val;this.$loop.schedule(this.CHANGE_SCROLL)},initialValue:0,handlesSet:true},fixedWidthGutter:{set:function(val){this.$gutterLayer.$fixedWidth=!!val;this.$loop.schedule(this.CHANGE_GUTTER)}},theme:{set:function(val){this.setTheme(val)},get:function(){return this.$themeId||this.theme},initialValue:"./theme/textmate",handlesSet:true}});exports.VirtualRenderer=VirtualRenderer}));ace.define("ace/worker/worker_client",["require","exports","module","ace/lib/oop","ace/lib/net","ace/lib/event_emitter","ace/config"],(function(acequire,exports,module){"use strict";var oop=acequire("../lib/oop");var net=acequire("../lib/net");var EventEmitter=acequire("../lib/event_emitter").EventEmitter;var config=acequire("../config");function $workerBlob(workerUrl,mod){var script=mod.src;"importScripts('"+net.qualifyURL(workerUrl)+"');";try{return new Blob([script],{type:"application/javascript"})}catch(e){var BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;var blobBuilder=new BlobBuilder;blobBuilder.append(script);return blobBuilder.getBlob("application/javascript")}}function createWorker(workerUrl,mod){var blob=$workerBlob(workerUrl,mod);var URL=window.URL||window.webkitURL;var blobURL=URL.createObjectURL(blob);return new Worker(blobURL)}var WorkerClient=function(topLevelNamespaces,mod,classname,workerUrl,importScripts){this.$sendDeltaQueue=this.$sendDeltaQueue.bind(this);this.changeListener=this.changeListener.bind(this);this.onMessage=this.onMessage.bind(this);if(acequire.nameToUrl&&!acequire.toUrl)acequire.toUrl=acequire.nameToUrl;if(config.get("packaged")||!acequire.toUrl){workerUrl=workerUrl||config.moduleUrl(mod.id,"worker")}else{var normalizePath=this.$normalizePath;workerUrl=workerUrl||normalizePath(acequire.toUrl("ace/worker/worker.js",null,"_"));var tlns={};topLevelNamespaces.forEach((function(ns){tlns[ns]=normalizePath(acequire.toUrl(ns,null,"_").replace(/(\.js)?(\?.*)?$/,""))}))}this.$worker=createWorker(workerUrl,mod);if(importScripts){this.send("importScripts",importScripts)}this.$worker.postMessage({init:true,tlns:tlns,module:mod.id,classname:classname});this.callbackId=1;this.callbacks={};this.$worker.onmessage=this.onMessage};(function(){oop.implement(this,EventEmitter);this.onMessage=function(e){var msg=e.data;switch(msg.type){case"event":this._signal(msg.name,{data:msg.data});break;case"call":var callback=this.callbacks[msg.id];if(callback){callback(msg.data);delete this.callbacks[msg.id]}break;case"error":this.reportError(msg.data);break;case"log":window.console&&console.log&&console.log.apply(console,msg.data);break}};this.reportError=function(err){window.console&&console.error&&console.error(err)};this.$normalizePath=function(path){return net.qualifyURL(path)};this.terminate=function(){this._signal("terminate",{});this.deltaQueue=null;this.$worker.terminate();this.$worker=null;if(this.$doc)this.$doc.off("change",this.changeListener);this.$doc=null};this.send=function(cmd,args){this.$worker.postMessage({command:cmd,args:args})};this.call=function(cmd,args,callback){if(callback){var id=this.callbackId++;this.callbacks[id]=callback;args.push(id)}this.send(cmd,args)};this.emit=function(event,data){try{this.$worker.postMessage({event:event,data:{data:data.data}})}catch(ex){console.error(ex.stack)}};this.attachToDocument=function(doc){if(this.$doc)this.terminate();this.$doc=doc;this.call("setValue",[doc.getValue()]);doc.on("change",this.changeListener)};this.changeListener=function(delta){if(!this.deltaQueue){this.deltaQueue=[];setTimeout(this.$sendDeltaQueue,0)}if(delta.action=="insert")this.deltaQueue.push(delta.start,delta.lines);else this.deltaQueue.push(delta.start,delta.end)};this.$sendDeltaQueue=function(){var q=this.deltaQueue;if(!q)return;this.deltaQueue=null;if(q.length>50&&q.length>this.$doc.getLength()>>1){this.call("setValue",[this.$doc.getValue()])}else this.emit("change",{data:q})}}).call(WorkerClient.prototype);var UIWorkerClient=function(topLevelNamespaces,mod,classname){this.$sendDeltaQueue=this.$sendDeltaQueue.bind(this);this.changeListener=this.changeListener.bind(this);this.callbackId=1;this.callbacks={};this.messageBuffer=[];var main=null;var emitSync=false;var sender=Object.create(EventEmitter);var _self=this;this.$worker={};this.$worker.terminate=function(){};this.$worker.postMessage=function(e){_self.messageBuffer.push(e);if(main){if(emitSync)setTimeout(processNext);else processNext()}};this.setEmitSync=function(val){emitSync=val};var processNext=function(){var msg=_self.messageBuffer.shift();if(msg.command)main[msg.command].apply(main,msg.args);else if(msg.event)sender._signal(msg.event,msg.data)};sender.postMessage=function(msg){_self.onMessage({data:msg})};sender.callback=function(data,callbackId){this.postMessage({type:"call",id:callbackId,data:data})};sender.emit=function(name,data){this.postMessage({type:"event",name:name,data:data})};config.loadModule(["worker",mod],(function(Main){main=new Main[classname](sender);while(_self.messageBuffer.length)processNext()}))};UIWorkerClient.prototype=WorkerClient.prototype;exports.UIWorkerClient=UIWorkerClient;exports.WorkerClient=WorkerClient;exports.createWorker=createWorker}));ace.define("ace/placeholder",["require","exports","module","ace/range","ace/lib/event_emitter","ace/lib/oop"],(function(acequire,exports,module){"use strict";var Range=acequire("./range").Range;var EventEmitter=acequire("./lib/event_emitter").EventEmitter;var oop=acequire("./lib/oop");var PlaceHolder=function(session,length,pos,others,mainClass,othersClass){var _self=this;this.length=length;this.session=session;this.doc=session.getDocument();this.mainClass=mainClass;this.othersClass=othersClass;this.$onUpdate=this.onUpdate.bind(this);this.doc.on("change",this.$onUpdate);this.$others=others;this.$onCursorChange=function(){setTimeout((function(){_self.onCursorChange()}))};this.$pos=pos;var undoStack=session.getUndoManager().$undoStack||session.getUndoManager().$undostack||{length:-1};this.$undoStackDepth=undoStack.length;this.setup();session.selection.on("changeCursor",this.$onCursorChange)};(function(){oop.implement(this,EventEmitter);this.setup=function(){var _self=this;var doc=this.doc;var session=this.session;this.selectionBefore=session.selection.toJSON();if(session.selection.inMultiSelectMode)session.selection.toSingleRange();this.pos=doc.createAnchor(this.$pos.row,this.$pos.column);var pos=this.pos;pos.$insertRight=true;pos.detach();pos.markerId=session.addMarker(new Range(pos.row,pos.column,pos.row,pos.column+this.length),this.mainClass,null,false);this.others=[];this.$others.forEach((function(other){var anchor=doc.createAnchor(other.row,other.column);anchor.$insertRight=true;anchor.detach();_self.others.push(anchor)}));session.setUndoSelect(false)};this.showOtherMarkers=function(){if(this.othersActive)return;var session=this.session;var _self=this;this.othersActive=true;this.others.forEach((function(anchor){anchor.markerId=session.addMarker(new Range(anchor.row,anchor.column,anchor.row,anchor.column+_self.length),_self.othersClass,null,false)}))};this.hideOtherMarkers=function(){if(!this.othersActive)return;this.othersActive=false;for(var i=0;i<this.others.length;i++){this.session.removeMarker(this.others[i].markerId)}};this.onUpdate=function(delta){if(this.$updating)return this.updateAnchors(delta);var range=delta;if(range.start.row!==range.end.row)return;if(range.start.row!==this.pos.row)return;this.$updating=true;var lengthDiff=delta.action==="insert"?range.end.column-range.start.column:range.start.column-range.end.column;var inMainRange=range.start.column>=this.pos.column&&range.start.column<=this.pos.column+this.length+1;var distanceFromStart=range.start.column-this.pos.column;this.updateAnchors(delta);if(inMainRange)this.length+=lengthDiff;if(inMainRange&&!this.session.$fromUndo){if(delta.action==="insert"){for(var i=this.others.length-1;i>=0;i--){var otherPos=this.others[i];var newPos={row:otherPos.row,column:otherPos.column+distanceFromStart};this.doc.insertMergedLines(newPos,delta.lines)}}else if(delta.action==="remove"){for(var i=this.others.length-1;i>=0;i--){var otherPos=this.others[i];var newPos={row:otherPos.row,column:otherPos.column+distanceFromStart};this.doc.remove(new Range(newPos.row,newPos.column,newPos.row,newPos.column-lengthDiff))}}}this.$updating=false;this.updateMarkers()};this.updateAnchors=function(delta){this.pos.onChange(delta);for(var i=this.others.length;i--;)this.others[i].onChange(delta);this.updateMarkers()};this.updateMarkers=function(){if(this.$updating)return;var _self=this;var session=this.session;var updateMarker=function(pos,className){session.removeMarker(pos.markerId);pos.markerId=session.addMarker(new Range(pos.row,pos.column,pos.row,pos.column+_self.length),className,null,false)};updateMarker(this.pos,this.mainClass);for(var i=this.others.length;i--;)updateMarker(this.others[i],this.othersClass)};this.onCursorChange=function(event){if(this.$updating||!this.session)return;var pos=this.session.selection.getCursor();if(pos.row===this.pos.row&&pos.column>=this.pos.column&&pos.column<=this.pos.column+this.length){this.showOtherMarkers();this._emit("cursorEnter",event)}else{this.hideOtherMarkers();this._emit("cursorLeave",event)}};this.detach=function(){this.session.removeMarker(this.pos&&this.pos.markerId);this.hideOtherMarkers();this.doc.removeEventListener("change",this.$onUpdate);this.session.selection.removeEventListener("changeCursor",this.$onCursorChange);this.session.setUndoSelect(true);this.session=null};this.cancel=function(){if(this.$undoStackDepth===-1)return;var undoManager=this.session.getUndoManager();var undosRequired=(undoManager.$undoStack||undoManager.$undostack).length-this.$undoStackDepth;for(var i=0;i<undosRequired;i++){undoManager.undo(true)}if(this.selectionBefore)this.session.selection.fromJSON(this.selectionBefore)}}).call(PlaceHolder.prototype);exports.PlaceHolder=PlaceHolder}));ace.define("ace/mouse/multi_select_handler",["require","exports","module","ace/lib/event","ace/lib/useragent"],(function(acequire,exports,module){var event=acequire("../lib/event");var useragent=acequire("../lib/useragent");function isSamePoint(p1,p2){return p1.row==p2.row&&p1.column==p2.column}function onMouseDown(e){var ev=e.domEvent;var alt=ev.altKey;var shift=ev.shiftKey;var ctrl=ev.ctrlKey;var accel=e.getAccelKey();var button=e.getButton();if(ctrl&&useragent.isMac)button=ev.button;if(e.editor.inMultiSelectMode&&button==2){e.editor.textInput.onContextMenu(e.domEvent);return}if(!ctrl&&!alt&&!accel){if(button===0&&e.editor.inMultiSelectMode)e.editor.exitMultiSelectMode();return}if(button!==0)return;var editor=e.editor;var selection=editor.selection;var isMultiSelect=editor.inMultiSelectMode;var pos=e.getDocumentPosition();var cursor=selection.getCursor();var inSelection=e.inSelection()||selection.isEmpty()&&isSamePoint(pos,cursor);var mouseX=e.x,mouseY=e.y;var onMouseSelection=function(e){mouseX=e.clientX;mouseY=e.clientY};var session=editor.session;var screenAnchor=editor.renderer.pixelToScreenCoordinates(mouseX,mouseY);var screenCursor=screenAnchor;var selectionMode;if(editor.$mouseHandler.$enableJumpToDef){if(ctrl&&alt||accel&&alt)selectionMode=shift?"block":"add";else if(alt&&editor.$blockSelectEnabled)selectionMode="block"}else{if(accel&&!alt){selectionMode="add";if(!isMultiSelect&&shift)return}else if(alt&&editor.$blockSelectEnabled){selectionMode="block"}}if(selectionMode&&useragent.isMac&&ev.ctrlKey){editor.$mouseHandler.cancelContextMenu()}if(selectionMode=="add"){if(!isMultiSelect&&inSelection)return;if(!isMultiSelect){var range=selection.toOrientedRange();editor.addSelectionMarker(range)}var oldRange=selection.rangeList.rangeAtPoint(pos);editor.$blockScrolling++;editor.inVirtualSelectionMode=true;if(shift){oldRange=null;range=selection.ranges[0]||range;editor.removeSelectionMarker(range)}editor.once("mouseup",(function(){var tmpSel=selection.toOrientedRange();if(oldRange&&tmpSel.isEmpty()&&isSamePoint(oldRange.cursor,tmpSel.cursor))selection.substractPoint(tmpSel.cursor);else{if(shift){selection.substractPoint(range.cursor)}else if(range){editor.removeSelectionMarker(range);selection.addRange(range)}selection.addRange(tmpSel)}editor.$blockScrolling--;editor.inVirtualSelectionMode=false}))}else if(selectionMode=="block"){e.stop();editor.inVirtualSelectionMode=true;var initialRange;var rectSel=[];var blockSelect=function(){var newCursor=editor.renderer.pixelToScreenCoordinates(mouseX,mouseY);var cursor=session.screenToDocumentPosition(newCursor.row,newCursor.column,newCursor.offsetX);if(isSamePoint(screenCursor,newCursor)&&isSamePoint(cursor,selection.lead))return;screenCursor=newCursor;editor.$blockScrolling++;editor.selection.moveToPosition(cursor);editor.renderer.scrollCursorIntoView();editor.removeSelectionMarkers(rectSel);rectSel=selection.rectangularRangeBlock(screenCursor,screenAnchor);if(editor.$mouseHandler.$clickSelection&&rectSel.length==1&&rectSel[0].isEmpty())rectSel[0]=editor.$mouseHandler.$clickSelection.clone();rectSel.forEach(editor.addSelectionMarker,editor);editor.updateSelectionMarkers();editor.$blockScrolling--};editor.$blockScrolling++;if(isMultiSelect&&!accel){selection.toSingleRange()}else if(!isMultiSelect&&accel){initialRange=selection.toOrientedRange();editor.addSelectionMarker(initialRange)}if(shift)screenAnchor=session.documentToScreenPosition(selection.lead);else selection.moveToPosition(pos);editor.$blockScrolling--;screenCursor={row:-1,column:-1};var onMouseSelectionEnd=function(e){clearInterval(timerId);editor.removeSelectionMarkers(rectSel);if(!rectSel.length)rectSel=[selection.toOrientedRange()];editor.$blockScrolling++;if(initialRange){editor.removeSelectionMarker(initialRange);selection.toSingleRange(initialRange)}for(var i=0;i<rectSel.length;i++)selection.addRange(rectSel[i]);editor.inVirtualSelectionMode=false;editor.$mouseHandler.$clickSelection=null;editor.$blockScrolling--};var onSelectionInterval=blockSelect;event.capture(editor.container,onMouseSelection,onMouseSelectionEnd);var timerId=setInterval((function(){onSelectionInterval()}),20);return e.preventDefault()}}exports.onMouseDown=onMouseDown}));ace.define("ace/commands/multi_select_commands",["require","exports","module","ace/keyboard/hash_handler"],(function(acequire,exports,module){exports.defaultCommands=[{name:"addCursorAbove",exec:function(editor){editor.selectMoreLines(-1)},bindKey:{win:"Ctrl-Alt-Up",mac:"Ctrl-Alt-Up"},scrollIntoView:"cursor",readOnly:true},{name:"addCursorBelow",exec:function(editor){editor.selectMoreLines(1)},bindKey:{win:"Ctrl-Alt-Down",mac:"Ctrl-Alt-Down"},scrollIntoView:"cursor",readOnly:true},{name:"addCursorAboveSkipCurrent",exec:function(editor){editor.selectMoreLines(-1,true)},bindKey:{win:"Ctrl-Alt-Shift-Up",mac:"Ctrl-Alt-Shift-Up"},scrollIntoView:"cursor",readOnly:true},{name:"addCursorBelowSkipCurrent",exec:function(editor){editor.selectMoreLines(1,true)},bindKey:{win:"Ctrl-Alt-Shift-Down",mac:"Ctrl-Alt-Shift-Down"},scrollIntoView:"cursor",readOnly:true},{name:"selectMoreBefore",exec:function(editor){editor.selectMore(-1)},bindKey:{win:"Ctrl-Alt-Left",mac:"Ctrl-Alt-Left"},scrollIntoView:"cursor",readOnly:true},{name:"selectMoreAfter",exec:function(editor){editor.selectMore(1)},bindKey:{win:"Ctrl-Alt-Right",mac:"Ctrl-Alt-Right"},scrollIntoView:"cursor",readOnly:true},{name:"selectNextBefore",exec:function(editor){editor.selectMore(-1,true)},bindKey:{win:"Ctrl-Alt-Shift-Left",mac:"Ctrl-Alt-Shift-Left"},scrollIntoView:"cursor",readOnly:true},{name:"selectNextAfter",exec:function(editor){editor.selectMore(1,true)},bindKey:{win:"Ctrl-Alt-Shift-Right",mac:"Ctrl-Alt-Shift-Right"},scrollIntoView:"cursor",readOnly:true},{name:"splitIntoLines",exec:function(editor){editor.multiSelect.splitIntoLines()},bindKey:{win:"Ctrl-Alt-L",mac:"Ctrl-Alt-L"},readOnly:true},{name:"alignCursors",exec:function(editor){editor.alignCursors()},bindKey:{win:"Ctrl-Alt-A",mac:"Ctrl-Alt-A"},scrollIntoView:"cursor"},{name:"findAll",exec:function(editor){editor.findAll()},bindKey:{win:"Ctrl-Alt-K",mac:"Ctrl-Alt-G"},scrollIntoView:"cursor",readOnly:true}];exports.multiSelectCommands=[{name:"singleSelection",bindKey:"esc",exec:function(editor){editor.exitMultiSelectMode()},scrollIntoView:"cursor",readOnly:true,isAvailable:function(editor){return editor&&editor.inMultiSelectMode}}];var HashHandler=acequire("../keyboard/hash_handler").HashHandler;exports.keyboardHandler=new HashHandler(exports.multiSelectCommands)}));ace.define("ace/multi_select",["require","exports","module","ace/range_list","ace/range","ace/selection","ace/mouse/multi_select_handler","ace/lib/event","ace/lib/lang","ace/commands/multi_select_commands","ace/search","ace/edit_session","ace/editor","ace/config"],(function(acequire,exports,module){var RangeList=acequire("./range_list").RangeList;var Range=acequire("./range").Range;var Selection=acequire("./selection").Selection;var onMouseDown=acequire("./mouse/multi_select_handler").onMouseDown;var event=acequire("./lib/event");var lang=acequire("./lib/lang");var commands=acequire("./commands/multi_select_commands");exports.commands=commands.defaultCommands.concat(commands.multiSelectCommands);var Search=acequire("./search").Search;var search=new Search;function find(session,needle,dir){search.$options.wrap=true;search.$options.needle=needle;search.$options.backwards=dir==-1;return search.find(session)}var EditSession=acequire("./edit_session").EditSession;(function(){this.getSelectionMarkers=function(){return this.$selectionMarkers}}).call(EditSession.prototype);(function(){this.ranges=null;this.rangeList=null;this.addRange=function(range,$blockChangeEvents){if(!range)return;if(!this.inMultiSelectMode&&this.rangeCount===0){var oldRange=this.toOrientedRange();this.rangeList.add(oldRange);this.rangeList.add(range);if(this.rangeList.ranges.length!=2){this.rangeList.removeAll();return $blockChangeEvents||this.fromOrientedRange(range)}this.rangeList.removeAll();this.rangeList.add(oldRange);this.$onAddRange(oldRange)}if(!range.cursor)range.cursor=range.end;var removed=this.rangeList.add(range);this.$onAddRange(range);if(removed.length)this.$onRemoveRange(removed);if(this.rangeCount>1&&!this.inMultiSelectMode){this._signal("multiSelect");this.inMultiSelectMode=true;this.session.$undoSelect=false;this.rangeList.attach(this.session)}return $blockChangeEvents||this.fromOrientedRange(range)};this.toSingleRange=function(range){range=range||this.ranges[0];var removed=this.rangeList.removeAll();if(removed.length)this.$onRemoveRange(removed);range&&this.fromOrientedRange(range)};this.substractPoint=function(pos){var removed=this.rangeList.substractPoint(pos);if(removed){this.$onRemoveRange(removed);return removed[0]}};this.mergeOverlappingRanges=function(){var removed=this.rangeList.merge();if(removed.length)this.$onRemoveRange(removed);else if(this.ranges[0])this.fromOrientedRange(this.ranges[0])};this.$onAddRange=function(range){this.rangeCount=this.rangeList.ranges.length;this.ranges.unshift(range);this._signal("addRange",{range:range})};this.$onRemoveRange=function(removed){this.rangeCount=this.rangeList.ranges.length;if(this.rangeCount==1&&this.inMultiSelectMode){var lastRange=this.rangeList.ranges.pop();removed.push(lastRange);this.rangeCount=0}for(var i=removed.length;i--;){var index=this.ranges.indexOf(removed[i]);this.ranges.splice(index,1)}this._signal("removeRange",{ranges:removed});if(this.rangeCount===0&&this.inMultiSelectMode){this.inMultiSelectMode=false;this._signal("singleSelect");this.session.$undoSelect=true;this.rangeList.detach(this.session)}lastRange=lastRange||this.ranges[0];if(lastRange&&!lastRange.isEqual(this.getRange()))this.fromOrientedRange(lastRange)};this.$initRangeList=function(){if(this.rangeList)return;this.rangeList=new RangeList;this.ranges=[];this.rangeCount=0};this.getAllRanges=function(){return this.rangeCount?this.rangeList.ranges.concat():[this.getRange()]};this.splitIntoLines=function(){if(this.rangeCount>1){var ranges=this.rangeList.ranges;var lastRange=ranges[ranges.length-1];var range=Range.fromPoints(ranges[0].start,lastRange.end);this.toSingleRange();this.setSelectionRange(range,lastRange.cursor==lastRange.start)}else{var range=this.getRange();var isBackwards=this.isBackwards();var startRow=range.start.row;var endRow=range.end.row;if(startRow==endRow){if(isBackwards)var start=range.end,end=range.start;else var start=range.start,end=range.end;this.addRange(Range.fromPoints(end,end));this.addRange(Range.fromPoints(start,start));return}var rectSel=[];var r=this.getLineRange(startRow,true);r.start.column=range.start.column;rectSel.push(r);for(var i=startRow+1;i<endRow;i++)rectSel.push(this.getLineRange(i,true));r=this.getLineRange(endRow,true);r.end.column=range.end.column;rectSel.push(r);rectSel.forEach(this.addRange,this)}};this.toggleBlockSelection=function(){if(this.rangeCount>1){var ranges=this.rangeList.ranges;var lastRange=ranges[ranges.length-1];var range=Range.fromPoints(ranges[0].start,lastRange.end);this.toSingleRange();this.setSelectionRange(range,lastRange.cursor==lastRange.start)}else{var cursor=this.session.documentToScreenPosition(this.selectionLead);var anchor=this.session.documentToScreenPosition(this.selectionAnchor);var rectSel=this.rectangularRangeBlock(cursor,anchor);rectSel.forEach(this.addRange,this)}};this.rectangularRangeBlock=function(screenCursor,screenAnchor,includeEmptyLines){var rectSel=[];var xBackwards=screenCursor.column<screenAnchor.column;if(xBackwards){var startColumn=screenCursor.column;var endColumn=screenAnchor.column;var startOffsetX=screenCursor.offsetX;var endOffsetX=screenAnchor.offsetX}else{var startColumn=screenAnchor.column;var endColumn=screenCursor.column;var startOffsetX=screenAnchor.offsetX;var endOffsetX=screenCursor.offsetX}var yBackwards=screenCursor.row<screenAnchor.row;if(yBackwards){var startRow=screenCursor.row;var endRow=screenAnchor.row}else{var startRow=screenAnchor.row;var endRow=screenCursor.row}if(startColumn<0)startColumn=0;if(startRow<0)startRow=0;if(startRow==endRow)includeEmptyLines=true;for(var row=startRow;row<=endRow;row++){var range=Range.fromPoints(this.session.screenToDocumentPosition(row,startColumn,startOffsetX),this.session.screenToDocumentPosition(row,endColumn,endOffsetX));if(range.isEmpty()){if(docEnd&&isSamePoint(range.end,docEnd))break;var docEnd=range.end}range.cursor=xBackwards?range.start:range.end;rectSel.push(range)}if(yBackwards)rectSel.reverse();if(!includeEmptyLines){var end=rectSel.length-1;while(rectSel[end].isEmpty()&&end>0)end--;if(end>0){var start=0;while(rectSel[start].isEmpty())start++}for(var i=end;i>=start;i--){if(rectSel[i].isEmpty())rectSel.splice(i,1)}}return rectSel}}).call(Selection.prototype);var Editor=acequire("./editor").Editor;(function(){this.updateSelectionMarkers=function(){this.renderer.updateCursor();this.renderer.updateBackMarkers()};this.addSelectionMarker=function(orientedRange){if(!orientedRange.cursor)orientedRange.cursor=orientedRange.end;var style=this.getSelectionStyle();orientedRange.marker=this.session.addMarker(orientedRange,"ace_selection",style);this.session.$selectionMarkers.push(orientedRange);this.session.selectionMarkerCount=this.session.$selectionMarkers.length;return orientedRange};this.removeSelectionMarker=function(range){if(!range.marker)return;this.session.removeMarker(range.marker);var index=this.session.$selectionMarkers.indexOf(range);if(index!=-1)this.session.$selectionMarkers.splice(index,1);this.session.selectionMarkerCount=this.session.$selectionMarkers.length};this.removeSelectionMarkers=function(ranges){var markerList=this.session.$selectionMarkers;for(var i=ranges.length;i--;){var range=ranges[i];if(!range.marker)continue;this.session.removeMarker(range.marker);var index=markerList.indexOf(range);if(index!=-1)markerList.splice(index,1)}this.session.selectionMarkerCount=markerList.length};this.$onAddRange=function(e){this.addSelectionMarker(e.range);this.renderer.updateCursor();this.renderer.updateBackMarkers()};this.$onRemoveRange=function(e){this.removeSelectionMarkers(e.ranges);this.renderer.updateCursor();this.renderer.updateBackMarkers()};this.$onMultiSelect=function(e){if(this.inMultiSelectMode)return;this.inMultiSelectMode=true;this.setStyle("ace_multiselect");this.keyBinding.addKeyboardHandler(commands.keyboardHandler);this.commands.setDefaultHandler("exec",this.$onMultiSelectExec);this.renderer.updateCursor();this.renderer.updateBackMarkers()};this.$onSingleSelect=function(e){if(this.session.multiSelect.inVirtualMode)return;this.inMultiSelectMode=false;this.unsetStyle("ace_multiselect");this.keyBinding.removeKeyboardHandler(commands.keyboardHandler);this.commands.removeDefaultHandler("exec",this.$onMultiSelectExec);this.renderer.updateCursor();this.renderer.updateBackMarkers();this._emit("changeSelection")};this.$onMultiSelectExec=function(e){var command=e.command;var editor=e.editor;if(!editor.multiSelect)return;if(!command.multiSelectAction){var result=command.exec(editor,e.args||{});editor.multiSelect.addRange(editor.multiSelect.toOrientedRange());editor.multiSelect.mergeOverlappingRanges()}else if(command.multiSelectAction=="forEach"){result=editor.forEachSelection(command,e.args)}else if(command.multiSelectAction=="forEachLine"){result=editor.forEachSelection(command,e.args,true)}else if(command.multiSelectAction=="single"){editor.exitMultiSelectMode();result=command.exec(editor,e.args||{})}else{result=command.multiSelectAction(editor,e.args||{})}return result};this.forEachSelection=function(cmd,args,options){if(this.inVirtualSelectionMode)return;var keepOrder=options&&options.keepOrder;var $byLines=options==true||options&&options.$byLines;var session=this.session;var selection=this.selection;var rangeList=selection.rangeList;var ranges=(keepOrder?selection:rangeList).ranges;var result;if(!ranges.length)return cmd.exec?cmd.exec(this,args||{}):cmd(this,args||{});var reg=selection._eventRegistry;selection._eventRegistry={};var tmpSel=new Selection(session);this.inVirtualSelectionMode=true;for(var i=ranges.length;i--;){if($byLines){while(i>0&&ranges[i].start.row==ranges[i-1].end.row)i--}tmpSel.fromOrientedRange(ranges[i]);tmpSel.index=i;this.selection=session.selection=tmpSel;var cmdResult=cmd.exec?cmd.exec(this,args||{}):cmd(this,args||{});if(!result&&cmdResult!==undefined)result=cmdResult;tmpSel.toOrientedRange(ranges[i])}tmpSel.detach();this.selection=session.selection=selection;this.inVirtualSelectionMode=false;selection._eventRegistry=reg;selection.mergeOverlappingRanges();var anim=this.renderer.$scrollAnimation;this.onCursorChange();this.onSelectionChange();if(anim&&anim.from==anim.to)this.renderer.animateScrolling(anim.from);return result};this.exitMultiSelectMode=function(){if(!this.inMultiSelectMode||this.inVirtualSelectionMode)return;this.multiSelect.toSingleRange()};this.getSelectedText=function(){var text="";if(this.inMultiSelectMode&&!this.inVirtualSelectionMode){var ranges=this.multiSelect.rangeList.ranges;var buf=[];for(var i=0;i<ranges.length;i++){buf.push(this.session.getTextRange(ranges[i]))}var nl=this.session.getDocument().getNewLineCharacter();text=buf.join(nl);if(text.length==(buf.length-1)*nl.length)text=""}else if(!this.selection.isEmpty()){text=this.session.getTextRange(this.getSelectionRange())}return text};this.$checkMultiselectChange=function(e,anchor){if(this.inMultiSelectMode&&!this.inVirtualSelectionMode){var range=this.multiSelect.ranges[0];if(this.multiSelect.isEmpty()&&anchor==this.multiSelect.anchor)return;var pos=anchor==this.multiSelect.anchor?range.cursor==range.start?range.end:range.start:range.cursor;if(pos.row!=anchor.row||this.session.$clipPositionToDocument(pos.row,pos.column).column!=anchor.column)this.multiSelect.toSingleRange(this.multiSelect.toOrientedRange())}};this.findAll=function(needle,options,additive){options=options||{};options.needle=needle||options.needle;if(options.needle==undefined){var range=this.selection.isEmpty()?this.selection.getWordRange():this.selection.getRange();options.needle=this.session.getTextRange(range)}this.$search.set(options);var ranges=this.$search.findAll(this.session);if(!ranges.length)return 0;this.$blockScrolling+=1;var selection=this.multiSelect;if(!additive)selection.toSingleRange(ranges[0]);for(var i=ranges.length;i--;)selection.addRange(ranges[i],true);if(range&&selection.rangeList.rangeAtPoint(range.start))selection.addRange(range,true);this.$blockScrolling-=1;return ranges.length};this.selectMoreLines=function(dir,skip){var range=this.selection.toOrientedRange();var isBackwards=range.cursor==range.end;var screenLead=this.session.documentToScreenPosition(range.cursor);if(this.selection.$desiredColumn)screenLead.column=this.selection.$desiredColumn;var lead=this.session.screenToDocumentPosition(screenLead.row+dir,screenLead.column);if(!range.isEmpty()){var screenAnchor=this.session.documentToScreenPosition(isBackwards?range.end:range.start);var anchor=this.session.screenToDocumentPosition(screenAnchor.row+dir,screenAnchor.column)}else{var anchor=lead}if(isBackwards){var newRange=Range.fromPoints(lead,anchor);newRange.cursor=newRange.start}else{var newRange=Range.fromPoints(anchor,lead);newRange.cursor=newRange.end}newRange.desiredColumn=screenLead.column;if(!this.selection.inMultiSelectMode){this.selection.addRange(range)}else{if(skip)var toRemove=range.cursor}this.selection.addRange(newRange);if(toRemove)this.selection.substractPoint(toRemove)};this.transposeSelections=function(dir){var session=this.session;var sel=session.multiSelect;var all=sel.ranges;for(var i=all.length;i--;){var range=all[i];if(range.isEmpty()){var tmp=session.getWordRange(range.start.row,range.start.column);range.start.row=tmp.start.row;range.start.column=tmp.start.column;range.end.row=tmp.end.row;range.end.column=tmp.end.column}}sel.mergeOverlappingRanges();var words=[];for(var i=all.length;i--;){var range=all[i];words.unshift(session.getTextRange(range))}if(dir<0)words.unshift(words.pop());else words.push(words.shift());for(var i=all.length;i--;){var range=all[i];var tmp=range.clone();session.replace(range,words[i]);range.start.row=tmp.start.row;range.start.column=tmp.start.column}};this.selectMore=function(dir,skip,stopAtFirst){var session=this.session;var sel=session.multiSelect;var range=sel.toOrientedRange();if(range.isEmpty()){range=session.getWordRange(range.start.row,range.start.column);range.cursor=dir==-1?range.start:range.end;this.multiSelect.addRange(range);if(stopAtFirst)return}var needle=session.getTextRange(range);var newRange=find(session,needle,dir);if(newRange){newRange.cursor=dir==-1?newRange.start:newRange.end;this.$blockScrolling+=1;this.session.unfold(newRange);this.multiSelect.addRange(newRange);this.$blockScrolling-=1;this.renderer.scrollCursorIntoView(null,.5)}if(skip)this.multiSelect.substractPoint(range.cursor)};this.alignCursors=function(){var session=this.session;var sel=session.multiSelect;var ranges=sel.ranges;var row=-1;var sameRowRanges=ranges.filter((function(r){if(r.cursor.row==row)return true;row=r.cursor.row}));if(!ranges.length||sameRowRanges.length==ranges.length-1){var range=this.selection.getRange();var fr=range.start.row,lr=range.end.row;var guessRange=fr==lr;if(guessRange){var max=this.session.getLength();var line;do{line=this.session.getLine(lr)}while(/[=:]/.test(line)&&++lr<max);do{line=this.session.getLine(fr)}while(/[=:]/.test(line)&&--fr>0);if(fr<0)fr=0;if(lr>=max)lr=max-1}var lines=this.session.removeFullLines(fr,lr);lines=this.$reAlignText(lines,guessRange);this.session.insert({row:fr,column:0},lines.join("\n")+"\n");if(!guessRange){range.start.column=0;range.end.column=lines[lines.length-1].length}this.selection.setRange(range)}else{sameRowRanges.forEach((function(r){sel.substractPoint(r.cursor)}));var maxCol=0;var minSpace=Infinity;var spaceOffsets=ranges.map((function(r){var p=r.cursor;var line=session.getLine(p.row);var spaceOffset=line.substr(p.column).search(/\S/g);if(spaceOffset==-1)spaceOffset=0;if(p.column>maxCol)maxCol=p.column;if(spaceOffset<minSpace)minSpace=spaceOffset;return spaceOffset}));ranges.forEach((function(r,i){var p=r.cursor;var l=maxCol-p.column;var d=spaceOffsets[i]-minSpace;if(l>d)session.insert(p,lang.stringRepeat(" ",l-d));else session.remove(new Range(p.row,p.column,p.row,p.column-l+d));r.start.column=r.end.column=maxCol;r.start.row=r.end.row=p.row;r.cursor=r.end}));sel.fromOrientedRange(ranges[0]);this.renderer.updateCursor();this.renderer.updateBackMarkers()}};this.$reAlignText=function(lines,forceLeft){var isLeftAligned=true,isRightAligned=true;var startW,textW,endW;return lines.map((function(line){var m=line.match(/(\s*)(.*?)(\s*)([=:].*)/);if(!m)return[line];if(startW==null){startW=m[1].length;textW=m[2].length;endW=m[3].length;return m}if(startW+textW+endW!=m[1].length+m[2].length+m[3].length)isRightAligned=false;if(startW!=m[1].length)isLeftAligned=false;if(startW>m[1].length)startW=m[1].length;if(textW<m[2].length)textW=m[2].length;if(endW>m[3].length)endW=m[3].length;return m})).map(forceLeft?alignLeft:isLeftAligned?isRightAligned?alignRight:alignLeft:unAlign);function spaces(n){return lang.stringRepeat(" ",n)}function alignLeft(m){return!m[2]?m[0]:spaces(startW)+m[2]+spaces(textW-m[2].length+endW)+m[4].replace(/^([=:])\s+/,"$1 ")}function alignRight(m){return!m[2]?m[0]:spaces(startW+textW-m[2].length)+m[2]+spaces(endW," ")+m[4].replace(/^([=:])\s+/,"$1 ")}function unAlign(m){return!m[2]?m[0]:spaces(startW)+m[2]+spaces(endW)+m[4].replace(/^([=:])\s+/,"$1 ")}}}).call(Editor.prototype);function isSamePoint(p1,p2){return p1.row==p2.row&&p1.column==p2.column}exports.onSessionChange=function(e){var session=e.session;if(session&&!session.multiSelect){session.$selectionMarkers=[];session.selection.$initRangeList();session.multiSelect=session.selection}this.multiSelect=session&&session.multiSelect;var oldSession=e.oldSession;if(oldSession){oldSession.multiSelect.off("addRange",this.$onAddRange);oldSession.multiSelect.off("removeRange",this.$onRemoveRange);oldSession.multiSelect.off("multiSelect",this.$onMultiSelect);oldSession.multiSelect.off("singleSelect",this.$onSingleSelect);oldSession.multiSelect.lead.off("change",this.$checkMultiselectChange);oldSession.multiSelect.anchor.off("change",this.$checkMultiselectChange)}if(session){session.multiSelect.on("addRange",this.$onAddRange);session.multiSelect.on("removeRange",this.$onRemoveRange);session.multiSelect.on("multiSelect",this.$onMultiSelect);session.multiSelect.on("singleSelect",this.$onSingleSelect);session.multiSelect.lead.on("change",this.$checkMultiselectChange);session.multiSelect.anchor.on("change",this.$checkMultiselectChange)}if(session&&this.inMultiSelectMode!=session.selection.inMultiSelectMode){if(session.selection.inMultiSelectMode)this.$onMultiSelect();else this.$onSingleSelect()}};function MultiSelect(editor){if(editor.$multiselectOnSessionChange)return;editor.$onAddRange=editor.$onAddRange.bind(editor);editor.$onRemoveRange=editor.$onRemoveRange.bind(editor);editor.$onMultiSelect=editor.$onMultiSelect.bind(editor);editor.$onSingleSelect=editor.$onSingleSelect.bind(editor);editor.$multiselectOnSessionChange=exports.onSessionChange.bind(editor);editor.$checkMultiselectChange=editor.$checkMultiselectChange.bind(editor);editor.$multiselectOnSessionChange(editor);editor.on("changeSession",editor.$multiselectOnSessionChange);editor.on("mousedown",onMouseDown);editor.commands.addCommands(commands.defaultCommands);addAltCursorListeners(editor)}function addAltCursorListeners(editor){var el=editor.textInput.getElement();var altCursor=false;event.addListener(el,"keydown",(function(e){var altDown=e.keyCode==18&&!(e.ctrlKey||e.shiftKey||e.metaKey);if(editor.$blockSelectEnabled&&altDown){if(!altCursor){editor.renderer.setMouseCursor("crosshair");altCursor=true}}else if(altCursor){reset()}}));event.addListener(el,"keyup",reset);event.addListener(el,"blur",reset);function reset(e){if(altCursor){editor.renderer.setMouseCursor("");altCursor=false}}}exports.MultiSelect=MultiSelect;acequire("./config").defineOptions(Editor.prototype,"editor",{enableMultiselect:{set:function(val){MultiSelect(this);if(val){this.on("changeSession",this.$multiselectOnSessionChange);this.on("mousedown",onMouseDown)}else{this.off("changeSession",this.$multiselectOnSessionChange);this.off("mousedown",onMouseDown)}},value:true},enableBlockSelect:{set:function(val){this.$blockSelectEnabled=val},value:true}})}));ace.define("ace/mode/folding/fold_mode",["require","exports","module","ace/range"],(function(acequire,exports,module){"use strict";var Range=acequire("../../range").Range;var FoldMode=exports.FoldMode=function(){};(function(){this.foldingStartMarker=null;this.foldingStopMarker=null;this.getFoldWidget=function(session,foldStyle,row){var line=session.getLine(row);if(this.foldingStartMarker.test(line))return"start";if(foldStyle=="markbeginend"&&this.foldingStopMarker&&this.foldingStopMarker.test(line))return"end";return""};this.getFoldWidgetRange=function(session,foldStyle,row){return null};this.indentationBlock=function(session,row,column){var re=/\S/;var line=session.getLine(row);var startLevel=line.search(re);if(startLevel==-1)return;var startColumn=column||line.length;var maxRow=session.getLength();var startRow=row;var endRow=row;while(++row<maxRow){var level=session.getLine(row).search(re);if(level==-1)continue;if(level<=startLevel)break;endRow=row}if(endRow>startRow){var endColumn=session.getLine(endRow).length;return new Range(startRow,startColumn,endRow,endColumn)}};this.openingBracketBlock=function(session,bracket,row,column,typeRe){var start={row:row,column:column+1};var end=session.$findClosingBracket(bracket,start,typeRe);if(!end)return;var fw=session.foldWidgets[end.row];if(fw==null)fw=session.getFoldWidget(end.row);if(fw=="start"&&end.row>start.row){end.row--;end.column=session.getLine(end.row).length}return Range.fromPoints(start,end)};this.closingBracketBlock=function(session,bracket,row,column,typeRe){var end={row:row,column:column};var start=session.$findOpeningBracket(bracket,end);if(!start)return;start.column++;end.column--;return Range.fromPoints(start,end)}}).call(FoldMode.prototype)}));ace.define("ace/theme/textmate",["require","exports","module","ace/lib/dom"],(function(acequire,exports,module){"use strict";exports.isDark=false;exports.cssClass="ace-tm";exports.cssText='.ace-tm .ace_gutter {background: #f0f0f0;color: #333;}.ace-tm .ace_print-margin {width: 1px;background: #e8e8e8;}.ace-tm .ace_fold {background-color: #6B72E6;}.ace-tm {background-color: #FFFFFF;color: black;}.ace-tm .ace_cursor {color: black;}.ace-tm .ace_invisible {color: rgb(191, 191, 191);}.ace-tm .ace_storage,.ace-tm .ace_keyword {color: blue;}.ace-tm .ace_constant {color: rgb(197, 6, 11);}.ace-tm .ace_constant.ace_buildin {color: rgb(88, 72, 246);}.ace-tm .ace_constant.ace_language {color: rgb(88, 92, 246);}.ace-tm .ace_constant.ace_library {color: rgb(6, 150, 14);}.ace-tm .ace_invalid {background-color: rgba(255, 0, 0, 0.1);color: red;}.ace-tm .ace_support.ace_function {color: rgb(60, 76, 114);}.ace-tm .ace_support.ace_constant {color: rgb(6, 150, 14);}.ace-tm .ace_support.ace_type,.ace-tm .ace_support.ace_class {color: rgb(109, 121, 222);}.ace-tm .ace_keyword.ace_operator {color: rgb(104, 118, 135);}.ace-tm .ace_string {color: rgb(3, 106, 7);}.ace-tm .ace_comment {color: rgb(76, 136, 107);}.ace-tm .ace_comment.ace_doc {color: rgb(0, 102, 255);}.ace-tm .ace_comment.ace_doc.ace_tag {color: rgb(128, 159, 191);}.ace-tm .ace_constant.ace_numeric {color: rgb(0, 0, 205);}.ace-tm .ace_variable {color: rgb(49, 132, 149);}.ace-tm .ace_xml-pe {color: rgb(104, 104, 91);}.ace-tm .ace_entity.ace_name.ace_function {color: #0000A2;}.ace-tm .ace_heading {color: rgb(12, 7, 255);}.ace-tm .ace_list {color:rgb(185, 6, 144);}.ace-tm .ace_meta.ace_tag {color:rgb(0, 22, 142);}.ace-tm .ace_string.ace_regex {color: rgb(255, 0, 0)}.ace-tm .ace_marker-layer .ace_selection {background: rgb(181, 213, 255);}.ace-tm.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px white;}.ace-tm .ace_marker-layer .ace_step {background: rgb(252, 255, 0);}.ace-tm .ace_marker-layer .ace_stack {background: rgb(164, 229, 101);}.ace-tm .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgb(192, 192, 192);}.ace-tm .ace_marker-layer .ace_active-line {background: rgba(0, 0, 0, 0.07);}.ace-tm .ace_gutter-active-line {background-color : #dcdcdc;}.ace-tm .ace_marker-layer .ace_selected-word {background: rgb(250, 250, 255);border: 1px solid rgb(200, 200, 250);}.ace-tm .ace_indent-guide {background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;}';var dom=acequire("../lib/dom");dom.importCssString(exports.cssText,exports.cssClass)}));ace.define("ace/line_widgets",["require","exports","module","ace/lib/oop","ace/lib/dom","ace/range"],(function(acequire,exports,module){"use strict";var oop=acequire("./lib/oop");var dom=acequire("./lib/dom");var Range=acequire("./range").Range;function LineWidgets(session){this.session=session;this.session.widgetManager=this;this.session.getRowLength=this.getRowLength;this.session.$getWidgetScreenLength=this.$getWidgetScreenLength;this.updateOnChange=this.updateOnChange.bind(this);this.renderWidgets=this.renderWidgets.bind(this);this.measureWidgets=this.measureWidgets.bind(this);this.session._changedWidgets=[];this.$onChangeEditor=this.$onChangeEditor.bind(this);this.session.on("change",this.updateOnChange);this.session.on("changeFold",this.updateOnFold);this.session.on("changeEditor",this.$onChangeEditor)}(function(){this.getRowLength=function(row){var h;if(this.lineWidgets)h=this.lineWidgets[row]&&this.lineWidgets[row].rowCount||0;else h=0;if(!this.$useWrapMode||!this.$wrapData[row]){return 1+h}else{return this.$wrapData[row].length+1+h}};this.$getWidgetScreenLength=function(){var screenRows=0;this.lineWidgets.forEach((function(w){if(w&&w.rowCount&&!w.hidden)screenRows+=w.rowCount}));return screenRows};this.$onChangeEditor=function(e){this.attach(e.editor)};this.attach=function(editor){if(editor&&editor.widgetManager&&editor.widgetManager!=this)editor.widgetManager.detach();if(this.editor==editor)return;this.detach();this.editor=editor;if(editor){editor.widgetManager=this;editor.renderer.on("beforeRender",this.measureWidgets);editor.renderer.on("afterRender",this.renderWidgets)}};this.detach=function(e){var editor=this.editor;if(!editor)return;this.editor=null;editor.widgetManager=null;editor.renderer.off("beforeRender",this.measureWidgets);editor.renderer.off("afterRender",this.renderWidgets);var lineWidgets=this.session.lineWidgets;lineWidgets&&lineWidgets.forEach((function(w){if(w&&w.el&&w.el.parentNode){w._inDocument=false;w.el.parentNode.removeChild(w.el)}}))};this.updateOnFold=function(e,session){var lineWidgets=session.lineWidgets;if(!lineWidgets||!e.action)return;var fold=e.data;var start=fold.start.row;var end=fold.end.row;var hide=e.action=="add";for(var i=start+1;i<end;i++){if(lineWidgets[i])lineWidgets[i].hidden=hide}if(lineWidgets[end]){if(hide){if(!lineWidgets[start])lineWidgets[start]=lineWidgets[end];else lineWidgets[end].hidden=hide}else{if(lineWidgets[start]==lineWidgets[end])lineWidgets[start]=undefined;lineWidgets[end].hidden=hide}}};this.updateOnChange=function(delta){var lineWidgets=this.session.lineWidgets;if(!lineWidgets)return;var startRow=delta.start.row;var len=delta.end.row-startRow;if(len===0){}else if(delta.action=="remove"){var removed=lineWidgets.splice(startRow+1,len);removed.forEach((function(w){w&&this.removeLineWidget(w)}),this);this.$updateRows()}else{var args=new Array(len);args.unshift(startRow,0);lineWidgets.splice.apply(lineWidgets,args);this.$updateRows()}};this.$updateRows=function(){var lineWidgets=this.session.lineWidgets;if(!lineWidgets)return;var noWidgets=true;lineWidgets.forEach((function(w,i){if(w){noWidgets=false;w.row=i;while(w.$oldWidget){w.$oldWidget.row=i;w=w.$oldWidget}}}));if(noWidgets)this.session.lineWidgets=null};this.addLineWidget=function(w){if(!this.session.lineWidgets)this.session.lineWidgets=new Array(this.session.getLength());var old=this.session.lineWidgets[w.row];if(old){w.$oldWidget=old;if(old.el&&old.el.parentNode){old.el.parentNode.removeChild(old.el);old._inDocument=false}}this.session.lineWidgets[w.row]=w;w.session=this.session;var renderer=this.editor.renderer;if(w.html&&!w.el){w.el=dom.createElement("div");w.el.innerHTML=w.html}if(w.el){dom.addCssClass(w.el,"ace_lineWidgetContainer");w.el.style.position="absolute";w.el.style.zIndex=5;renderer.container.appendChild(w.el);w._inDocument=true}if(!w.coverGutter){w.el.style.zIndex=3}if(w.pixelHeight==null){w.pixelHeight=w.el.offsetHeight}if(w.rowCount==null){w.rowCount=w.pixelHeight/renderer.layerConfig.lineHeight}var fold=this.session.getFoldAt(w.row,0);w.$fold=fold;if(fold){var lineWidgets=this.session.lineWidgets;if(w.row==fold.end.row&&!lineWidgets[fold.start.row])lineWidgets[fold.start.row]=w;else w.hidden=true}this.session._emit("changeFold",{data:{start:{row:w.row}}});this.$updateRows();this.renderWidgets(null,renderer);this.onWidgetChanged(w);return w};this.removeLineWidget=function(w){w._inDocument=false;w.session=null;if(w.el&&w.el.parentNode)w.el.parentNode.removeChild(w.el);if(w.editor&&w.editor.destroy)try{w.editor.destroy()}catch(e){}if(this.session.lineWidgets){var w1=this.session.lineWidgets[w.row];if(w1==w){this.session.lineWidgets[w.row]=w.$oldWidget;if(w.$oldWidget)this.onWidgetChanged(w.$oldWidget)}else{while(w1){if(w1.$oldWidget==w){w1.$oldWidget=w.$oldWidget;break}w1=w1.$oldWidget}}}this.session._emit("changeFold",{data:{start:{row:w.row}}});this.$updateRows()};this.getWidgetsAtRow=function(row){var lineWidgets=this.session.lineWidgets;var w=lineWidgets&&lineWidgets[row];var list=[];while(w){list.push(w);w=w.$oldWidget}return list};this.onWidgetChanged=function(w){this.session._changedWidgets.push(w);this.editor&&this.editor.renderer.updateFull()};this.measureWidgets=function(e,renderer){var changedWidgets=this.session._changedWidgets;var config=renderer.layerConfig;if(!changedWidgets||!changedWidgets.length)return;var min=Infinity;for(var i=0;i<changedWidgets.length;i++){var w=changedWidgets[i];if(!w||!w.el)continue;if(w.session!=this.session)continue;if(!w._inDocument){if(this.session.lineWidgets[w.row]!=w)continue;w._inDocument=true;renderer.container.appendChild(w.el)}w.h=w.el.offsetHeight;if(!w.fixedWidth){w.w=w.el.offsetWidth;w.screenWidth=Math.ceil(w.w/config.characterWidth)}var rowCount=w.h/config.lineHeight;if(w.coverLine){rowCount-=this.session.getRowLineCount(w.row);if(rowCount<0)rowCount=0}if(w.rowCount!=rowCount){w.rowCount=rowCount;if(w.row<min)min=w.row}}if(min!=Infinity){this.session._emit("changeFold",{data:{start:{row:min}}});this.session.lineWidgetWidth=null}this.session._changedWidgets=[]};this.renderWidgets=function(e,renderer){var config=renderer.layerConfig;var lineWidgets=this.session.lineWidgets;if(!lineWidgets)return;var first=Math.min(this.firstRow,config.firstRow);var last=Math.max(this.lastRow,config.lastRow,lineWidgets.length);while(first>0&&!lineWidgets[first])first--;this.firstRow=config.firstRow;this.lastRow=config.lastRow;renderer.$cursorLayer.config=config;for(var i=first;i<=last;i++){var w=lineWidgets[i];if(!w||!w.el)continue;if(w.hidden){w.el.style.top=-100-(w.pixelHeight||0)+"px";continue}if(!w._inDocument){w._inDocument=true;renderer.container.appendChild(w.el)}var top=renderer.$cursorLayer.getPixelPosition({row:i,column:0},true).top;if(!w.coverLine)top+=config.lineHeight*this.session.getRowLineCount(w.row);w.el.style.top=top-config.offset+"px";var left=w.coverGutter?0:renderer.gutterWidth;if(!w.fixedWidth)left-=renderer.scrollLeft;w.el.style.left=left+"px";if(w.fullWidth&&w.screenWidth){w.el.style.minWidth=config.width+2*config.padding+"px"}if(w.fixedWidth){w.el.style.right=renderer.scrollBar.getWidth()+"px"}else{w.el.style.right=""}}}}).call(LineWidgets.prototype);exports.LineWidgets=LineWidgets}));ace.define("ace/ext/error_marker",["require","exports","module","ace/line_widgets","ace/lib/dom","ace/range"],(function(acequire,exports,module){"use strict";var LineWidgets=acequire("../line_widgets").LineWidgets;var dom=acequire("../lib/dom");var Range=acequire("../range").Range;function binarySearch(array,needle,comparator){var first=0;var last=array.length-1;while(first<=last){var mid=first+last>>1;var c=comparator(needle,array[mid]);if(c>0)first=mid+1;else if(c<0)last=mid-1;else return mid}return-(first+1)}function findAnnotations(session,row,dir){var annotations=session.getAnnotations().sort(Range.comparePoints);if(!annotations.length)return;var i=binarySearch(annotations,{row:row,column:-1},Range.comparePoints);if(i<0)i=-i-1;if(i>=annotations.length)i=dir>0?0:annotations.length-1;else if(i===0&&dir<0)i=annotations.length-1;var annotation=annotations[i];if(!annotation||!dir)return;if(annotation.row===row){do{annotation=annotations[i+=dir]}while(annotation&&annotation.row===row);if(!annotation)return annotations.slice()}var matched=[];row=annotation.row;do{matched[dir<0?"unshift":"push"](annotation);annotation=annotations[i+=dir]}while(annotation&&annotation.row==row);return matched.length&&matched}exports.showErrorMarker=function(editor,dir){var session=editor.session;if(!session.widgetManager){session.widgetManager=new LineWidgets(session);session.widgetManager.attach(editor)}var pos=editor.getCursorPosition();var row=pos.row;var oldWidget=session.widgetManager.getWidgetsAtRow(row).filter((function(w){return w.type=="errorMarker"}))[0];if(oldWidget){oldWidget.destroy()}else{row-=dir}var annotations=findAnnotations(session,row,dir);var gutterAnno;if(annotations){var annotation=annotations[0];pos.column=(annotation.pos&&typeof annotation.column!="number"?annotation.pos.sc:annotation.column)||0;pos.row=annotation.row;gutterAnno=editor.renderer.$gutterLayer.$annotations[pos.row]}else if(oldWidget){return}else{gutterAnno={text:["Looks good!"],className:"ace_ok"}}editor.session.unfold(pos.row);editor.selection.moveToPosition(pos);var w={row:pos.row,fixedWidth:true,coverGutter:true,el:dom.createElement("div"),type:"errorMarker"};var el=w.el.appendChild(dom.createElement("div"));var arrow=w.el.appendChild(dom.createElement("div"));arrow.className="error_widget_arrow "+gutterAnno.className;var left=editor.renderer.$cursorLayer.getPixelPosition(pos).left;arrow.style.left=left+editor.renderer.gutterWidth-5+"px";w.el.className="error_widget_wrapper";el.className="error_widget "+gutterAnno.className;el.innerHTML=gutterAnno.text.join("<br>");el.appendChild(dom.createElement("div"));var kb=function(_,hashId,keyString){if(hashId===0&&(keyString==="esc"||keyString==="return")){w.destroy();return{command:"null"}}};w.destroy=function(){if(editor.$mouseHandler.isMousePressed)return;editor.keyBinding.removeKeyboardHandler(kb);session.widgetManager.removeLineWidget(w);editor.off("changeSelection",w.destroy);editor.off("changeSession",w.destroy);editor.off("mouseup",w.destroy);editor.off("change",w.destroy)};editor.keyBinding.addKeyboardHandler(kb);editor.on("changeSelection",w.destroy);editor.on("changeSession",w.destroy);editor.on("mouseup",w.destroy);editor.on("change",w.destroy);editor.session.widgetManager.addLineWidget(w);w.el.onmousedown=editor.focus.bind(editor);editor.renderer.scrollCursorIntoView(null,.5,{bottom:w.el.offsetHeight})};dom.importCssString("    .error_widget_wrapper {        background: inherit;        color: inherit;        border:none    }    .error_widget {        border-top: solid 2px;        border-bottom: solid 2px;        margin: 5px 0;        padding: 10px 40px;        white-space: pre-wrap;    }    .error_widget.ace_error, .error_widget_arrow.ace_error{        border-color: #ff5a5a    }    .error_widget.ace_warning, .error_widget_arrow.ace_warning{        border-color: #F1D817    }    .error_widget.ace_info, .error_widget_arrow.ace_info{        border-color: #5a5a5a    }    .error_widget.ace_ok, .error_widget_arrow.ace_ok{        border-color: #5aaa5a    }    .error_widget_arrow {        position: absolute;        border: solid 5px;        border-top-color: transparent!important;        border-right-color: transparent!important;        border-left-color: transparent!important;        top: -5px;    }","")}));ace.define("ace/ace",["require","exports","module","ace/lib/fixoldbrowsers","ace/lib/dom","ace/lib/event","ace/editor","ace/edit_session","ace/undomanager","ace/virtual_renderer","ace/worker/worker_client","ace/keyboard/hash_handler","ace/placeholder","ace/multi_select","ace/mode/folding/fold_mode","ace/theme/textmate","ace/ext/error_marker","ace/config"],(function(acequire,exports,module){"use strict";acequire("./lib/fixoldbrowsers");var dom=acequire("./lib/dom");var event=acequire("./lib/event");var Editor=acequire("./editor").Editor;var EditSession=acequire("./edit_session").EditSession;var UndoManager=acequire("./undomanager").UndoManager;var Renderer=acequire("./virtual_renderer").VirtualRenderer;acequire("./worker/worker_client");acequire("./keyboard/hash_handler");acequire("./placeholder");acequire("./multi_select");acequire("./mode/folding/fold_mode");acequire("./theme/textmate");acequire("./ext/error_marker");exports.config=acequire("./config");exports.acequire=acequire;if(true)exports.define=__webpack_require__(293);exports.edit=function(el){if(typeof el=="string"){var _id=el;el=document.getElementById(_id);if(!el)throw new Error("ace.edit can't find div #"+_id)}if(el&&el.env&&el.env.editor instanceof Editor)return el.env.editor;var value="";if(el&&/input|textarea/i.test(el.tagName)){var oldNode=el;value=oldNode.value;el=dom.createElement("pre");oldNode.parentNode.replaceChild(el,oldNode)}else if(el){value=dom.getInnerText(el);el.innerHTML=""}var doc=exports.createEditSession(value);var editor=new Editor(new Renderer(el));editor.setSession(doc);var env={document:doc,editor:editor,onResize:editor.resize.bind(editor,null)};if(oldNode)env.textarea=oldNode;event.addListener(window,"resize",env.onResize);editor.on("destroy",(function(){event.removeListener(window,"resize",env.onResize);env.editor.container.env=null}));editor.container.env=editor.env=env;return editor};exports.createEditSession=function(text,mode){var doc=new EditSession(text,mode);doc.setUndoManager(new UndoManager);return doc};exports.EditSession=EditSession;exports.UndoManager=UndoManager;exports.version="1.2.9"}));(function(){ace.acequire(["ace/ace"],(function(a){if(a){a.config.init(true);a.define=ace.define}if(!window.ace)window.ace=a;for(var key in a)if(a.hasOwnProperty(key))window.ace[key]=a[key]}))})();module.exports=window.ace.acequire("ace/ace")},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return addItemToRecentlyAccessed}));var _kbn_i18n__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2);var _kbn_i18n__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__);var _dependency_cache__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(18);function addItemToRecentlyAccessed(page,itemId,url){let pageLabel="";let id=`ml-job-${itemId}`;switch(page){case"explorer":pageLabel=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.anomalyExplorerPageLabel",{defaultMessage:"Anomaly Explorer"});break;case"timeseriesexplorer":pageLabel=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.singleMetricViewerPageLabel",{defaultMessage:"Single Metric Viewer"});break;case"jobs/new_job/datavisualizer":pageLabel=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.dataVisualizerPageLabel",{defaultMessage:"Data Visualizer"});id=`ml-datavisualizer-${itemId}`;break;default:console.error("addItemToRecentlyAccessed - No page specified");return}url=url.startsWith("/")?`/app/ml${url}`:`/app/ml/${page}/${url}`;const recentlyAccessed=Object(_dependency_cache__WEBPACK_IMPORTED_MODULE_1__["g"])();recentlyAccessed.add(url,`ML - ${itemId} - ${pageLabel}`,id)}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return combineFieldsAndAggs}));__webpack_require__.d(__webpack_exports__,"b",(function(){return sortFields}));var _types_fields__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(105);var _src_plugins_data_common__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(44);var _src_plugins_data_common__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_src_plugins_data_common__WEBPACK_IMPORTED_MODULE_1__);var _constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(79);function combineFieldsAndAggs(fields,aggs,rollupFields){const keywordFields=getKeywordFields(fields);const textFields=getTextFields(fields);const numericalFields=getNumericalFields(fields);const ipFields=getIpFields(fields);const geoFields=getGeoFields(fields);const isRollup=Object.keys(rollupFields).length>0;const mix=mixFactory(isRollup,rollupFields);aggs.forEach(a=>{if(a.type===_types_fields__WEBPACK_IMPORTED_MODULE_0__["b"]&&a.fields!==undefined){switch(a.id){case _constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].LAT_LONG:geoFields.forEach(f=>mix(f,a));break;case _constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].INFO_CONTENT:case _constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].HIGH_INFO_CONTENT:case _constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].LOW_INFO_CONTENT:textFields.forEach(f=>mix(f,a));case _constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].DISTINCT_COUNT:case _constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].HIGH_DISTINCT_COUNT:case _constants_aggregation_types__WEBPACK_IMPORTED_MODULE_2__["b"].LOW_DISTINCT_COUNT:keywordFields.forEach(f=>mix(f,a));ipFields.forEach(f=>mix(f,a));default:numericalFields.forEach(f=>{mix(f,a)});break}}});return{aggs:aggs,fields:isRollup?filterFields(fields):fields}}function filterFields(fields){return fields.filter(f=>f.aggs&&(f.aggs.length>0||f.aggs.length===0&&f.type===_src_plugins_data_common__WEBPACK_IMPORTED_MODULE_1__["ES_FIELD_TYPES"].DATE))}function mixFactory(isRollup,rollupFields){return function mix(field,agg){if(isRollup===false||rollupFields[field.id]&&rollupFields[field.id].find(f=>f.agg===agg.dslName)){if(field.aggs!==undefined){field.aggs.push(agg)}if(agg.fields!==undefined){agg.fields.push(field)}}}}function getKeywordFields(fields){return fields.filter(f=>f.type===_src_plugins_data_common__WEBPACK_IMPORTED_MODULE_1__["ES_FIELD_TYPES"].KEYWORD)}function getTextFields(fields){return fields.filter(f=>f.type===_src_plugins_data_common__WEBPACK_IMPORTED_MODULE_1__["ES_FIELD_TYPES"].TEXT)}function getIpFields(fields){return fields.filter(f=>f.type===_src_plugins_data_common__WEBPACK_IMPORTED_MODULE_1__["ES_FIELD_TYPES"].IP)}function getNumericalFields(fields){return fields.filter(f=>f.type===_src_plugins_data_common__WEBPACK_IMPORTED_MODULE_1__["ES_FIELD_TYPES"].LONG||f.type===_src_plugins_data_common__WEBPACK_IMPORTED_MODULE_1__["ES_FIELD_TYPES"].UNSIGNED_LONG||f.type===_src_plugins_data_common__WEBPACK_IMPORTED_MODULE_1__["ES_FIELD_TYPES"].INTEGER||f.type===_src_plugins_data_common__WEBPACK_IMPORTED_MODULE_1__["ES_FIELD_TYPES"].SHORT||f.type===_src_plugins_data_common__WEBPACK_IMPORTED_MODULE_1__["ES_FIELD_TYPES"].BYTE||f.type===_src_plugins_data_common__WEBPACK_IMPORTED_MODULE_1__["ES_FIELD_TYPES"].DOUBLE||f.type===_src_plugins_data_common__WEBPACK_IMPORTED_MODULE_1__["ES_FIELD_TYPES"].FLOAT||f.type===_src_plugins_data_common__WEBPACK_IMPORTED_MODULE_1__["ES_FIELD_TYPES"].HALF_FLOAT||f.type===_src_plugins_data_common__WEBPACK_IMPORTED_MODULE_1__["ES_FIELD_TYPES"].SCALED_FLOAT)}function getGeoFields(fields){return fields.filter(f=>f.type===_src_plugins_data_common__WEBPACK_IMPORTED_MODULE_1__["ES_FIELD_TYPES"].GEO_POINT||f.type===_src_plugins_data_common__WEBPACK_IMPORTED_MODULE_1__["ES_FIELD_TYPES"].GEO_SHAPE)}function sortFields(fields){if(fields.length===0){return fields}let eventRate;if(fields[0].id===_types_fields__WEBPACK_IMPORTED_MODULE_0__["a"]){[eventRate]=fields.splice(0,1)}fields.sort((a,b)=>a.name.localeCompare(b.name));if(eventRate!==undefined){fields.splice(0,0,eventRate)}return fields}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return populateValidationMessages}));__webpack_require__.d(__webpack_exports__,"a",(function(){return invalidTimeIntervalMessage}));var _kbn_i18n__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2);var _kbn_i18n__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__);var _common_constants_validation__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(23);var _services_ml_server_info__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(83);function populateValidationMessages(validationResults,basicValidations,jobConfig,datafeedConfig){const limits=Object(_services_ml_server_info__WEBPACK_IMPORTED_MODULE_2__["c"])();if(validationResults.contains("job_id_empty")){basicValidations.jobId.valid=false}else if(validationResults.contains("job_id_invalid")){basicValidations.jobId.valid=false;const msg=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.newJob.wizard.validateJob.jobNameAllowedCharactersDescription",{defaultMessage:"Job ID can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; "+"must start and end with an alphanumeric character"});basicValidations.jobId.message=msg}else if(validationResults.contains("job_id_invalid_max_length")){basicValidations.jobId.valid=false;basicValidations.jobId.message=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.newJob.wizard.validateJob.jobIdInvalidMaxLengthErrorMessage",{defaultMessage:"Job ID must be no more than {maxLength, plural, one {# character} other {# characters}} long.",values:{maxLength:_common_constants_validation__WEBPACK_IMPORTED_MODULE_1__["b"]}})}else if(validationResults.contains("job_id_already_exists")){basicValidations.jobId.valid=false;const msg=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.newJob.wizard.validateJob.jobNameAlreadyExists",{defaultMessage:"Job ID already exists. A job ID cannot be the same as an existing job or group."});basicValidations.jobId.message=msg}if(validationResults.contains("job_group_id_invalid")){basicValidations.groupIds.valid=false;const msg=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.newJob.wizard.validateJob.jobGroupAllowedCharactersDescription",{defaultMessage:"Job group names can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; "+"must start and end with an alphanumeric character"});basicValidations.groupIds.message=msg}else if(validationResults.contains("job_group_id_invalid_max_length")){basicValidations.groupIds.valid=false;basicValidations.groupIds.message=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.newJob.wizard.validateJob.jobGroupMaxLengthDescription",{defaultMessage:"Job group name must be no more than {maxLength, plural, one {# character} other {# characters}} long.",values:{maxLength:_common_constants_validation__WEBPACK_IMPORTED_MODULE_1__["b"]}})}else if(validationResults.contains("job_group_id_already_exists")){basicValidations.groupIds.valid=false;const msg=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.newJob.wizard.validateJob.groupNameAlreadyExists",{defaultMessage:"Group ID already exists. A group ID cannot be the same as an existing job or group."});basicValidations.groupIds.message=msg}if(validationResults.contains("model_memory_limit_units_invalid")){basicValidations.modelMemoryLimit.valid=false;const str=`${_common_constants_validation__WEBPACK_IMPORTED_MODULE_1__["a"].slice(0,_common_constants_validation__WEBPACK_IMPORTED_MODULE_1__["a"].length-1).join(", ")} or ${[..._common_constants_validation__WEBPACK_IMPORTED_MODULE_1__["a"]].pop()}`;const msg=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.newJob.wizard.validateJob.modelMemoryLimitUnitsInvalidErrorMessage",{defaultMessage:"Model memory limit data unit unrecognized. It must be {str}",values:{str:str}});basicValidations.modelMemoryLimit.message=msg}if(validationResults.contains("model_memory_limit_invalid")){basicValidations.modelMemoryLimit.valid=false;const maxModelMemoryLimit=(limits.max_model_memory_limit||"").toUpperCase();const msg=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.newJob.wizard.validateJob.modelMemoryLimitRangeInvalidErrorMessage",{defaultMessage:"Model memory limit cannot be higher than the maximum value of {maxModelMemoryLimit}",values:{maxModelMemoryLimit:maxModelMemoryLimit}});basicValidations.modelMemoryLimit.message=msg}if(validationResults.contains("detectors_duplicates")){basicValidations.duplicateDetectors.valid=false;const msg=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.newJob.wizard.validateJob.duplicatedDetectorsErrorMessage",{defaultMessage:"Duplicate detectors were found."});basicValidations.duplicateDetectors.message=msg}if(validationResults.contains("categorizer_detector_missing_per_partition_field")){basicValidations.categorizerMissingPerPartition.valid=false;const msg=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.newJob.wizard.validateJob.categorizerMissingPerPartitionFieldMessage",{defaultMessage:'Partition field must be set for detectors that reference "mlcategory" when per-partition categorization is enabled.'});basicValidations.categorizerMissingPerPartition.message=msg}if(validationResults.contains("categorizer_varying_per_partition_fields")){basicValidations.categorizerVaryingPerPartitionField.valid=false;const msg=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.newJob.wizard.validateJob.categorizerVaryingPerPartitionFieldNamesMessage",{defaultMessage:'Detectors with keyword "mlcategory" cannot have different partition_field_name when per-partition categorization is enabled.'});basicValidations.categorizerVaryingPerPartitionField.message=msg}if(validationResults.contains("bucket_span_empty")){basicValidations.bucketSpan.valid=false;const msg=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.newJob.wizard.validateJob.bucketSpanMustBeSetErrorMessage",{defaultMessage:"Bucket span must be set"});basicValidations.bucketSpan.message=msg}else if(validationResults.contains("bucket_span_invalid")){basicValidations.bucketSpan.valid=false;basicValidations.bucketSpan.message=invalidTimeIntervalMessage(jobConfig.analysis_config.bucket_span)}if(validationResults.contains("query_empty")){basicValidations.query.valid=false;const msg=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.newJob.wizard.validateJob.queryCannotBeEmpty",{defaultMessage:"Datafeed query cannot be empty."});basicValidations.query.message=msg}else if(validationResults.contains("query_invalid")){basicValidations.query.valid=false;const msg=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.newJob.wizard.validateJob.queryIsInvalidEsQuery",{defaultMessage:"Datafeed query must be a valid elasticsearch query."});basicValidations.query.message=msg}if(validationResults.contains("query_delay_invalid")){basicValidations.queryDelay.valid=false;basicValidations.queryDelay.message=invalidTimeIntervalMessage(datafeedConfig.query_delay)}if(validationResults.contains("frequency_invalid")){basicValidations.frequency.valid=false;basicValidations.frequency.message=invalidTimeIntervalMessage(datafeedConfig.frequency)}if(validationResults.contains("missing_summary_count_field_name")){basicValidations.summaryCountField.valid=false;basicValidations.summaryCountField.message=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.newJob.wizard.validateJob.summaryCountFieldMissing",{defaultMessage:"Required field as the datafeed uses aggregations."})}}function invalidTimeIntervalMessage(value){return _kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.newJob.wizard.validateJob.frequencyInvalidTimeIntervalFormatErrorMessage",{defaultMessage:"{value} is not a valid time interval format e.g. {thirtySeconds}, {tenMinutes}, {oneHour}, {sevenDays}. It also needs to be higher than zero.",values:{value:value,thirtySeconds:"30s",tenMinutes:"10m",oneHour:"1h",sevenDays:"7d"}})}},function(module,exports,__webpack_require__){"use strict";(function(global){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var base64=__webpack_require__(460);var ieee754=__webpack_require__(461);var isArray=__webpack_require__(462);exports.Buffer=Buffer;exports.SlowBuffer=SlowBuffer;exports.INSPECT_MAX_BYTES=50;Buffer.TYPED_ARRAY_SUPPORT=global.TYPED_ARRAY_SUPPORT!==undefined?global.TYPED_ARRAY_SUPPORT:typedArraySupport();exports.kMaxLength=kMaxLength();function typedArraySupport(){try{var arr=new Uint8Array(1);arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return arr.foo()===42&&typeof arr.subarray==="function"&&arr.subarray(1,1).byteLength===0}catch(e){return false}}function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(that,length){if(kMaxLength()<length){throw new RangeError("Invalid typed array length")}if(Buffer.TYPED_ARRAY_SUPPORT){that=new Uint8Array(length);that.__proto__=Buffer.prototype}else{if(that===null){that=new Buffer(length)}that.length=length}return that}function Buffer(arg,encodingOrOffset,length){if(!Buffer.TYPED_ARRAY_SUPPORT&&!(this instanceof Buffer)){return new Buffer(arg,encodingOrOffset,length)}if(typeof arg==="number"){if(typeof encodingOrOffset==="string"){throw new Error("If encoding is specified then the first argument must be a string")}return allocUnsafe(this,arg)}return from(this,arg,encodingOrOffset,length)}Buffer.poolSize=8192;Buffer._augment=function(arr){arr.__proto__=Buffer.prototype;return arr};function from(that,value,encodingOrOffset,length){if(typeof value==="number"){throw new TypeError('"value" argument must not be a number')}if(typeof ArrayBuffer!=="undefined"&&value instanceof ArrayBuffer){return fromArrayBuffer(that,value,encodingOrOffset,length)}if(typeof value==="string"){return fromString(that,value,encodingOrOffset)}return fromObject(that,value)}Buffer.from=function(value,encodingOrOffset,length){return from(null,value,encodingOrOffset,length)};if(Buffer.TYPED_ARRAY_SUPPORT){Buffer.prototype.__proto__=Uint8Array.prototype;Buffer.__proto__=Uint8Array;if(typeof Symbol!=="undefined"&&Symbol.species&&Buffer[Symbol.species]===Buffer){Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:true})}}function assertSize(size){if(typeof size!=="number"){throw new TypeError('"size" argument must be a number')}else if(size<0){throw new RangeError('"size" argument must not be negative')}}function alloc(that,size,fill,encoding){assertSize(size);if(size<=0){return createBuffer(that,size)}if(fill!==undefined){return typeof encoding==="string"?createBuffer(that,size).fill(fill,encoding):createBuffer(that,size).fill(fill)}return createBuffer(that,size)}Buffer.alloc=function(size,fill,encoding){return alloc(null,size,fill,encoding)};function allocUnsafe(that,size){assertSize(size);that=createBuffer(that,size<0?0:checked(size)|0);if(!Buffer.TYPED_ARRAY_SUPPORT){for(var i=0;i<size;++i){that[i]=0}}return that}Buffer.allocUnsafe=function(size){return allocUnsafe(null,size)};Buffer.allocUnsafeSlow=function(size){return allocUnsafe(null,size)};function fromString(that,string,encoding){if(typeof encoding!=="string"||encoding===""){encoding="utf8"}if(!Buffer.isEncoding(encoding)){throw new TypeError('"encoding" must be a valid string encoding')}var length=byteLength(string,encoding)|0;that=createBuffer(that,length);var actual=that.write(string,encoding);if(actual!==length){that=that.slice(0,actual)}return that}function fromArrayLike(that,array){var length=array.length<0?0:checked(array.length)|0;that=createBuffer(that,length);for(var i=0;i<length;i+=1){that[i]=array[i]&255}return that}function fromArrayBuffer(that,array,byteOffset,length){array.byteLength;if(byteOffset<0||array.byteLength<byteOffset){throw new RangeError("'offset' is out of bounds")}if(array.byteLength<byteOffset+(length||0)){throw new RangeError("'length' is out of bounds")}if(byteOffset===undefined&&length===undefined){array=new Uint8Array(array)}else if(length===undefined){array=new Uint8Array(array,byteOffset)}else{array=new Uint8Array(array,byteOffset,length)}if(Buffer.TYPED_ARRAY_SUPPORT){that=array;that.__proto__=Buffer.prototype}else{that=fromArrayLike(that,array)}return that}function fromObject(that,obj){if(Buffer.isBuffer(obj)){var len=checked(obj.length)|0;that=createBuffer(that,len);if(that.length===0){return that}obj.copy(that,0,0,len);return that}if(obj){if(typeof ArrayBuffer!=="undefined"&&obj.buffer instanceof ArrayBuffer||"length"in obj){if(typeof obj.length!=="number"||isnan(obj.length)){return createBuffer(that,0)}return fromArrayLike(that,obj)}if(obj.type==="Buffer"&&isArray(obj.data)){return fromArrayLike(that,obj.data)}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(length){if(length>=kMaxLength()){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+kMaxLength().toString(16)+" bytes")}return length|0}function SlowBuffer(length){if(+length!=length){length=0}return Buffer.alloc(+length)}Buffer.isBuffer=function isBuffer(b){return!!(b!=null&&b._isBuffer)};Buffer.compare=function compare(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError("Arguments must be Buffers")}if(a===b)return 0;var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer.concat=function concat(list,length){if(!isArray(list)){throw new TypeError('"list" argument must be an Array of Buffers')}if(list.length===0){return Buffer.alloc(0)}var i;if(length===undefined){length=0;for(i=0;i<list.length;++i){length+=list[i].length}}var buffer=Buffer.allocUnsafe(length);var pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf)){throw new TypeError('"list" argument must be an Array of Buffers')}buf.copy(buffer,pos);pos+=buf.length}return buffer};function byteLength(string,encoding){if(Buffer.isBuffer(string)){return string.length}if(typeof ArrayBuffer!=="undefined"&&typeof ArrayBuffer.isView==="function"&&(ArrayBuffer.isView(string)||string instanceof ArrayBuffer)){return string.byteLength}if(typeof string!=="string"){string=""+string}var len=string.length;if(len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case undefined:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return len*2;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase();loweredCase=true}}}Buffer.byteLength=byteLength;function slowToString(encoding,start,end){var loweredCase=false;if(start===undefined||start<0){start=0}if(start>this.length){return""}if(end===undefined||end>this.length){end=this.length}if(end<=0){return""}end>>>=0;start>>>=0;if(end<=start){return""}if(!encoding)encoding="utf8";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}}Buffer.prototype._isBuffer=true;function swap(b,n,m){var i=b[n];b[n]=b[m];b[m]=i}Buffer.prototype.swap16=function swap16(){var len=this.length;if(len%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i=0;i<len;i+=2){swap(this,i,i+1)}return this};Buffer.prototype.swap32=function swap32(){var len=this.length;if(len%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i=0;i<len;i+=4){swap(this,i,i+3);swap(this,i+1,i+2)}return this};Buffer.prototype.swap64=function swap64(){var len=this.length;if(len%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var i=0;i<len;i+=8){swap(this,i,i+7);swap(this,i+1,i+6);swap(this,i+2,i+5);swap(this,i+3,i+4)}return this};Buffer.prototype.toString=function toString(){var length=this.length|0;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.equals=function equals(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer.compare(this,b)===0};Buffer.prototype.inspect=function inspect(){var str="";var max=exports.INSPECT_MAX_BYTES;if(this.length>0){str=this.toString("hex",0,max).match(/.{2}/g).join(" ");if(this.length>max)str+=" ... "}return"<Buffer "+str+">"};Buffer.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target)){throw new TypeError("Argument must be a Buffer")}if(start===undefined){start=0}if(end===undefined){end=target?target.length:0}if(thisStart===undefined){thisStart=0}if(thisEnd===undefined){thisEnd=this.length}if(start<0||end>target.length||thisStart<0||thisEnd>this.length){throw new RangeError("out of range index")}if(thisStart>=thisEnd&&start>=end){return 0}if(thisStart>=thisEnd){return-1}if(start>=end){return 1}start>>>=0;end>>>=0;thisStart>>>=0;thisEnd>>>=0;if(this===target)return 0;var x=thisEnd-thisStart;var y=end-start;var len=Math.min(x,y);var thisCopy=this.slice(thisStart,thisEnd);var targetCopy=target.slice(start,end);for(var i=0;i<len;++i){if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i];y=targetCopy[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(buffer.length===0)return-1;if(typeof byteOffset==="string"){encoding=byteOffset;byteOffset=0}else if(byteOffset>2147483647){byteOffset=2147483647}else if(byteOffset<-2147483648){byteOffset=-2147483648}byteOffset=+byteOffset;if(isNaN(byteOffset)){byteOffset=dir?0:buffer.length-1}if(byteOffset<0)byteOffset=buffer.length+byteOffset;if(byteOffset>=buffer.length){if(dir)return-1;else byteOffset=buffer.length-1}else if(byteOffset<0){if(dir)byteOffset=0;else return-1}if(typeof val==="string"){val=Buffer.from(val,encoding)}if(Buffer.isBuffer(val)){if(val.length===0){return-1}return arrayIndexOf(buffer,val,byteOffset,encoding,dir)}else if(typeof val==="number"){val=val&255;if(Buffer.TYPED_ARRAY_SUPPORT&&typeof Uint8Array.prototype.indexOf==="function"){if(dir){return Uint8Array.prototype.indexOf.call(buffer,val,byteOffset)}else{return Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset)}}return arrayIndexOf(buffer,[val],byteOffset,encoding,dir)}throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1;var arrLength=arr.length;var valLength=val.length;if(encoding!==undefined){encoding=String(encoding).toLowerCase();if(encoding==="ucs2"||encoding==="ucs-2"||encoding==="utf16le"||encoding==="utf-16le"){if(arr.length<2||val.length<2){return-1}indexSize=2;arrLength/=2;valLength/=2;byteOffset/=2}}function read(buf,i){if(indexSize===1){return buf[i]}else{return buf.readUInt16BE(i*indexSize)}}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++){if(read(arr,i)===read(val,foundIndex===-1?0:i-foundIndex)){if(foundIndex===-1)foundIndex=i;if(i-foundIndex+1===valLength)return foundIndex*indexSize}else{if(foundIndex!==-1)i-=i-foundIndex;foundIndex=-1}}}else{if(byteOffset+valLength>arrLength)byteOffset=arrLength-valLength;for(i=byteOffset;i>=0;i--){var found=true;for(var j=0;j<valLength;j++){if(read(arr,i+j)!==read(val,j)){found=false;break}}if(found)return i}}return-1}Buffer.prototype.includes=function includes(val,byteOffset,encoding){return this.indexOf(val,byteOffset,encoding)!==-1};Buffer.prototype.indexOf=function indexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,true)};Buffer.prototype.lastIndexOf=function lastIndexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,false)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2!==0)throw new TypeError("Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0;i<length;++i){var parsed=parseInt(string.substr(i*2,2),16);if(isNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function write(string,offset,length,encoding){if(offset===undefined){encoding="utf8";length=this.length;offset=0}else if(length===undefined&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset|0;if(isFinite(length)){length=length|0;if(encoding===undefined)encoding="utf8"}else{encoding=length;length=undefined}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var remaining=this.length-offset;if(length===undefined||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}}};Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);var res=[];var i=start;while(i<end){var firstByte=buf[i];var codePoint=null;var bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:if(firstByte<128){codePoint=firstByte}break;case 2:secondByte=buf[i+1];if((secondByte&192)===128){tempCodePoint=(firstByte&31)<<6|secondByte&63;if(tempCodePoint>127){codePoint=tempCodePoint}}break;case 3:secondByte=buf[i+1];thirdByte=buf[i+2];if((secondByte&192)===128&&(thirdByte&192)===128){tempCodePoint=(firstByte&15)<<12|(secondByte&63)<<6|thirdByte&63;if(tempCodePoint>2047&&(tempCodePoint<55296||tempCodePoint>57343)){codePoint=tempCodePoint}}break;case 4:secondByte=buf[i+1];thirdByte=buf[i+2];fourthByte=buf[i+3];if((secondByte&192)===128&&(thirdByte&192)===128&&(fourthByte&192)===128){tempCodePoint=(firstByte&15)<<18|(secondByte&63)<<12|(thirdByte&63)<<6|fourthByte&63;if(tempCodePoint>65535&&tempCodePoint<1114112){codePoint=tempCodePoint}}}}if(codePoint===null){codePoint=65533;bytesPerSequence=1}else if(codePoint>65535){codePoint-=65536;res.push(codePoint>>>10&1023|55296);codePoint=56320|codePoint&1023}res.push(codePoint);i+=bytesPerSequence}return decodeCodePointsArray(res)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH){return String.fromCharCode.apply(String,codePoints)}var res="";var i=0;while(i<len){res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH))}return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i]&127)}return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i=start;i<end;++i){ret+=String.fromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i=start;i<end;++i){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i=0;i<bytes.length;i+=2){res+=String.fromCharCode(bytes[i]+bytes[i+1]*256)}return res}Buffer.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===undefined?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT){newBuf=this.subarray(start,end);newBuf.__proto__=Buffer.prototype}else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,undefined);for(var i=0;i<sliceLen;++i){newBuf[i]=this[i+start]}}return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function readUIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function readUIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength];var mul=1;while(byteLength>0&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function readUInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function readIntLE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset];var mul=1;var i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function readIntBE(offset,byteLength,noAssert){offset=offset|0;byteLength=byteLength|0;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength;var mul=1;var val=this[offset+--i];while(i>0&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength);return val};Buffer.prototype.readInt8=function readInt8(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer.prototype.readInt16LE=function readInt16LE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt16BE=function readInt16BE(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer.prototype.readInt32LE=function readInt32LE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function readInt32BE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function readFloatLE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer.prototype.readFloatBE=function readFloatBE(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError("Index out of range")}Buffer.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var mul=1;var i=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;byteLength=byteLength|0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var i=byteLength-1;var mul=1;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){this[offset+i]=value/mul&255}return offset+byteLength};Buffer.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,255,0);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);this[offset]=value&255;return offset+1};function objectWriteUInt16(buf,value,offset,littleEndian){if(value<0)value=65535+value+1;for(var i=0,j=Math.min(buf.length-offset,2);i<j;++i){buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>(littleEndian?i:1-i)*8}}Buffer.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value&255}else{objectWriteUInt16(this,value,offset,false)}return offset+2};function objectWriteUInt32(buf,value,offset,littleEndian){if(value<0)value=4294967295+value+1;for(var i=0,j=Math.min(buf.length-offset,4);i<j;++i){buf[offset+i]=value>>>(littleEndian?i:3-i)*8&255}}Buffer.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value&255}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255}else{objectWriteUInt32(this,value,offset,false)}return offset+4};Buffer.prototype.writeIntLE=function writeIntLE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0;var mul=1;var sub=0;this[offset]=value&255;while(++i<byteLength&&(mul*=256)){if(value<0&&sub===0&&this[offset+i-1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeIntBE=function writeIntBE(value,offset,byteLength,noAssert){value=+value;offset=offset|0;if(!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1;var mul=1;var sub=0;this[offset+i]=value&255;while(--i>=0&&(mul*=256)){if(value<0&&sub===0&&this[offset+i+1]!==0){sub=1}this[offset+i]=(value/mul>>0)-sub&255}return offset+byteLength};Buffer.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(!Buffer.TYPED_ARRAY_SUPPORT)value=Math.floor(value);if(value<0)value=255+value+1;this[offset]=value&255;return offset+1};Buffer.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,true)}return offset+2};Buffer.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=value&255}else{objectWriteUInt16(this,value,offset,false)}return offset+2};Buffer.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value&255;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24}else{objectWriteUInt32(this,value,offset,true)}return offset+4};Buffer.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset|0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255}else{objectWriteUInt32(this,value,offset,false)}return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,4,34028234663852886e22,-34028234663852886e22)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,8,17976931348623157e292,-17976931348623157e292)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer.prototype.copy=function copy(target,targetStart,start,end){if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;var i;if(this===target&&start<targetStart&&targetStart<end){for(i=len-1;i>=0;--i){target[i+targetStart]=this[i+start]}}else if(len<1e3||!Buffer.TYPED_ARRAY_SUPPORT){for(i=0;i<len;++i){target[i+targetStart]=this[i+start]}}else{Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart)}return len};Buffer.prototype.fill=function fill(val,start,end,encoding){if(typeof val==="string"){if(typeof start==="string"){encoding=start;start=0;end=this.length}else if(typeof end==="string"){encoding=end;end=this.length}if(val.length===1){var code=val.charCodeAt(0);if(code<256){val=code}}if(encoding!==undefined&&typeof encoding!=="string"){throw new TypeError("encoding must be a string")}if(typeof encoding==="string"&&!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}}else if(typeof val==="number"){val=val&255}if(start<0||this.length<start||this.length<end){throw new RangeError("Out of range index")}if(end<=start){return this}start=start>>>0;end=end===undefined?this.length:end>>>0;if(!val)val=0;var i;if(typeof val==="number"){for(i=start;i<end;++i){this[i]=val}}else{var bytes=Buffer.isBuffer(val)?val:utf8ToBytes(new Buffer(val,encoding).toString());var len=bytes.length;for(i=0;i<end-start;++i){this[i+start]=bytes[i%len]}}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(str){str=stringtrim(str).replace(INVALID_BASE64_RE,"");if(str.length<2)return"";while(str.length%4!==0){str=str+"="}return str}function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];for(var i=0;i<length;++i){codePoint=string.charCodeAt(i);if(codePoint>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189)}leadSurrogate=null;if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<1114112){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){var byteArray=[];for(var i=0;i<str.length;++i){byteArray.push(str.charCodeAt(i)&255)}return byteArray}function utf16leToBytes(str,units){var c,hi,lo;var byteArray=[];for(var i=0;i<str.length;++i){if((units-=2)<0)break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;++i){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function isnan(val){return val!==val}}).call(this,__webpack_require__(106))},function(module,exports,__webpack_require__){var types=__webpack_require__(161);var SUPPORTED_PARTS=["FREQ","INTERVAL","COUNT","UNTIL","BYDAY","BYMONTH","BYMONTHDAY"];var WKDAYS=["SU","MO","TU","WE","TH","FR","SA"];function to_utc_date(dt){if(Array.isArray(dt)){dt=dt.slice(0);dt[1]--}else dt=[dt.getFullYear(),dt.getMonth(),dt.getDate(),dt.getHours(),dt.getMinutes(),dt.getSeconds(),dt.getMilliseconds()];return new Date(Date.UTC.apply(null,dt));return udt}function from_utc_date(udt){var dt=new Date(udt.getUTCFullYear(),udt.getUTCMonth(),udt.getUTCDate(),udt.getUTCHours(),udt.getUTCMinutes(),udt.getUTCSeconds(),udt.getUTCMilliseconds());return dt}function trunc(n){return n<0?Math.ceil(n):Math.floor(n)}function y(dt){return dt.getUTCFullYear()}function m(dt){return dt.getUTCMonth()+1}function d(dt){return dt.getUTCDate()}function hr(dt){return dt.getUTCHours()}function min(dt){return dt.getUTCMinutes()}function sec(dt){return dt.getUTCSeconds()}function ms(dt){return dt.getUTCMilliseconds()}function set_y(dt,v){dt.setUTCFullYear(v);return dt}function set_m(dt,v){dt.setUTCMonth(v-1);return dt}function set_d(dt,v){dt.setUTCDate(v);return dt}function set_hr(dt,v){dt.setUTCHours(v);return dt}function set_min(dt,v){dt.setUTCMinutes(v);return dt}function set_sec(dt,v){dt.setUTCSeconds(v);return dt}function set_ms(dt,v){dt.setUTCMilliseconds(v);return dt}function add_y(dt,v){return set_y(dt,y(dt)+v)}function add_m(dt,v){return set_m(dt,m(dt)+v)}function add_d(dt,v){return set_d(dt,d(dt)+v)}function add_hr(dt,v){return set_hr(dt,hr(dt)+v)}function add_min(dt,v){return set_min(dt,min(dt)+v)}function add_sec(dt,v){return set_sec(dt,sec(dt)+v)}function fst(dt){return new Date(y(dt),m(dt)-1,1)}function wkday(dt){return dt.getUTCDay()}function daydiff(dt1,dt2){return(dt2-dt1)/(1e3*60*60*24)}function wk(dt){var jan1=new Date(Date.UTC(y(dt),0,1));return trunc(daydiff(jan1,dt)/7)}function m_wk(dt,wkst){return(0|d(dt)/7)+(d(dt)%7===0?0:1)}var RRule=exports.RRule=function(rule,options,dtend){if(options instanceof Date)options={DTSTART:options,DTEND:dtend};options=options||{};this.start=options.DTSTART?to_utc_date(options.DTSTART):null;this.end=options.DTEND?to_utc_date(options.DTEND):null;this.exceptions=options.EXDATE||[];if(typeof rule==="string")rule=RRule.parse(rule);this.rule={};for(var i in rule||{}){if(SUPPORTED_PARTS.indexOf(i)==-1)throw new Error(i+" is not currently supported!");this.rule[i]=RULE_PARTS[i]?RULE_PARTS[i].parse(rule[i]):rule[i]}};RRule.parse=function(value){var parts=value.split(/=|;/);var rrule={};for(var i=0;i<parts.length;i+=2){rrule[parts[i]]=parts[i+1]}return rrule};RRule.prototype.setFrequency=function(freq){this.rule.FREQ=freq};RRule.prototype.valueOf=function(){return this.rule};RRule.prototype.toString=function(){var out=["FREQ="+this.rule.FREQ];for(var k in this.rule){if(k=="FREQ")continue;out.push(k+"="+((RULE_PARTS[k]||{}).format?RULE_PARTS[k].format(this.rule[k]):this.rule[k]))}return out.join(";")};RRule.prototype.next=function(after){after=after&&to_utc_date(after);if(!after||after<this.start)after=new Date(this.start.valueOf()-1);if(this.until&&after>this.until)return null;var freq=FREQ[this.rule.FREQ];if(!freq)throw new Error(this.rule.FREQ+" recurrence is not supported");NextOccurs:while(true){var next=freq.next(this.rule,this.start,after);var nextInLocal=from_utc_date(next);for(var i=0;i<this.exceptions.length;i++){var exdate=this.exceptions[i];if(exdate.valueOf()==nextInLocal.valueOf()||exdate.date_only&&y(to_utc_date(exdate))==y(nextInLocal)&&m(to_utc_date(exdate))==m(nextInLocal)&&d(to_utc_date(exdate))==d(nextInLocal)){after=next;continue NextOccurs}}break}if(this.until&&next>this.until)return null;if(this.rule.COUNT&&this.count_end!==null){if(this.count_end===undefined){this.count_end=null;this.count_end=this.nextOccurences(this.rule.COUNT).pop()}if(next>to_utc_date(this.count_end))return null}if(this.rule.UNTIL&&next>to_utc_date(this.rule.UNTIL))return null;return from_utc_date(next)};RRule.prototype.nextOccurences=function(after,count_or_until){if(arguments.length===1){count_or_until=after;after=undefined}var arr=[];if(count_or_until instanceof Date){while(true){after=this.next(after);if(after&&after<=count_or_until)arr.push(after);else break}}else{while(count_or_until--&&after!==null){after=this.next(after);if(after)arr.push(after)}}return arr};var RULE_PARTS={INTERVAL:{parse:function(v){return parseInt(v,10)}},UNTIL:{parse:function(v){if(v instanceof Date)return v;return types.parse_value("DATE-TIME",v)},format:function(v){return types.format_value("DATE-TIME",v)}},FREQ:{parse:function(v){return v}},BYMONTH:{parse:function(v){if(typeof v==="number")return[v];return v.split(",").map((function(mo){return parseInt(mo,10)}))},format:function(v){return v.join(",")}},BYDAY:{parse:function(v){var days=v.split(",").map((function(day){var m=day.match(/([+-]?\d)?(SU|MO|TU|WE|TH|FR|SA)/);return[parseInt(m[1],10)||0,WKDAYS.indexOf(m[2])]}));days.sort((function(d1,d2){if(d1[0]==d2[0])return d1[1]-d2[1];else return d1[0]-d2[0]}));return days},format:function(v){return v.map((function(day){return(day[0]||"")+WKDAYS[day[1]]})).join(",")}},EXDATE:{parse:function(v){return v.split(",").map((function(dt){return dt.length==8?types.parse_value("DATE",dt):types.parse_value("DATE-TIME",dt)}))},format:function(v){return v.map((function(dt){return types.format_value(dt.date_only?"DATE":"DATE-TIME",dt)})).join(",")}}};RULE_PARTS["BYMONTHDAY"]=RULE_PARTS["BYMONTH"];RULE_PARTS["COUNT"]=RULE_PARTS["INTERVAL"];var FREQ={DAILY:{next:function(rule,start,after){var next=new Date(after);set_hr(next,hr(start));set_min(next,min(start));set_sec(next,sec(start));set_ms(next,ms(start));var interval=rule.INTERVAL||1;var mod_days=trunc(daydiff(next,start))%interval;if(mod_days)add_d(next,interval-mod_days);for(var i=0;i<2;++i){next=byday(rule.BYDAY,next,after);if(next.valueOf()>after.valueOf())break;add_d(next,interval)}return next}},WEEKLY:{next:function(rule,start,after){var next=new Date(after);set_hr(next,hr(start));set_min(next,min(start));set_sec(next,sec(start));set_ms(next,ms(start));var interval=rule.INTERVAL||1;var mod_weeks=trunc(daydiff(start,next)/7)%interval;if(mod_weeks)add_d(next,(interval-mod_weeks)*7);while(true){next=byday(rule.BYDAY,next,after);if(!rule.BYDAY||!rule.BYDAY.length){startDayOfWeek=wkday(start);nextDayOfWeek=wkday(next);if(nextDayOfWeek>startDayOfWeek)add_d(next,startDayOfWeek-nextDayOfWeek);else if(startDayOfWeek>nextDayOfWeek)add_d(next,startDayOfWeek-nextDayOfWeek-7)}if(next.valueOf()>after.valueOf()&&check_bymonth(rule.BYMONTH,next))break;add_d(next,interval*7)}return next}},MONTHLY:{next:function(rule,start,after){var next=new Date(after);set_hr(next,hr(start));set_min(next,min(start));set_sec(next,sec(start));set_ms(next,ms(start));var interval=rule.INTERVAL||1;var delta=m(next)-m(start)+(y(next)-y(start))*12;if(delta%interval)add_m(next,interval-delta%interval);for(var i=0;i<2;++i){if(i)set_d(next,1);next=byday(rule.BYDAY,next,after);next=bymonthday(rule.BYMONTHDAY,next,after);if((!rule.BYDAY||!rule.BYDAY.length)&&(!rule.BYMONTHDAY||!rule.BYMONTHDAY.length))set_d(next,d(start));if(next.valueOf()>after.valueOf())break;add_m(next,interval)}return next}},YEARLY:{next:function(rule,start,after){var next=new Date(after);set_hr(next,hr(start));set_min(next,min(start));set_sec(next,sec(start));set_ms(next,ms(start));var interval=rule.INTERVAL||1;var mod_year=(y(after)-y(start))%interval;if(mod_year)add_y(next,interval-mod_year);for(var i=0;i<2;++i){next=bymonth(rule.BYMONTH,next);next=bymonthday(rule.BYMONTHDAY,next,after);next=byday(rule.BYDAY,next,after);if(!rule.BYMONTH||!rule.BYMONTH.length)set_m(next,m(start));if((!rule.BYDAY||!rule.BYDAY.length)&&(!rule.BYMONTHDAY||!rule.BYMONTHDAY.length))set_d(next,d(start));if(next.valueOf()>after.valueOf())break;set_d(set_m(add_y(next,interval),1),1)}return next}}};function sort_dates(dateary){return dateary.sort((function(dt1,dt2){if(dt1===null&&dt2===null)return 0;if(dt1===null)return 1;if(dt2===null)return-1;return dt1.valueOf()-dt2.valueOf()}))}function check_bymonth(rules,dt){if(!rules||!rules.length)return true;return rules.indexOf(m(dt))!==-1}function bymonth(rules,dt){if(!rules||!rules.length)return dt;var candidates=rules.map((function(rule){var delta=rule-m(dt);if(delta<0)delta+=12;var newdt=add_m(new Date(dt),delta);set_d(newdt,1);return newdt}));var newdt=sort_dates(candidates).shift();return newdt||dt}function bymonthday(rules,dt,after){if(!rules||!rules.length)return dt;var candidates=rules.map((function(rule){var newdt=set_d(new Date(dt),rule);return newdt.valueOf()<=after.valueOf()?null:newdt}));var newdt=sort_dates(candidates).shift();return newdt||dt}function byday(rules,dt,after){if(!rules||!rules.length)return dt;var candidates=rules.map((function(rule){var days=rule[1]-wkday(dt);if(days<0)days+=7;var newdt=add_d(new Date(dt),days);if(rule[0]>0){var wk=0|(d(newdt)-1)/7+1;if(wk>rule[0])return null;add_d(newdt,(rule[0]-wk)*7)}else if(rule[0]<0){var dt2=new Date(newdt);var days=[];while(m(dt2)===m(newdt)){days.push(d(dt2));add_d(dt2,7)}set_d(newdt,days.reverse()[-rule[0]-1])}if(newdt.valueOf()<=after.valueOf())return null;return newdt}));var newdt=sort_dates(candidates).shift();return newdt||dt}},function(module,exports,__webpack_require__){var assert=__webpack_require__(231);var util=__webpack_require__(162);var CalendarObject=__webpack_require__(102).CalendarObject;var CalendarProperty=__webpack_require__(102).CalendarProperty;var schema=__webpack_require__(102).schema;var iCalendar=exports.iCalendar=function(empty){CalendarObject.call(this,this,"VCALENDAR");this.calendar=this;if(!empty){this.addProperty("VERSION","2.0");this.addProperty("PRODID",__webpack_require__(302).PRODID)}};util.inherits(iCalendar,CalendarObject);iCalendar.prototype.events=function(){return this.components["VEVENT"]||[]};iCalendar.prototype.timezone=function(tzid){for(var i=0;i<this.components["VTIMEZONE"].length;++i){var tz=this.components["VTIMEZONE"][i];if(tz.getPropertyValue("TZID")==tzid)return tz}};schema.VCALENDAR={factory:iCalendar,valid_properties:[],required_properties:["PRODID","VERSION"],valid_children:["VEVENT"],required_children:[]};schema.VTODO={required_properties:["DTSTAMP","UID"]};schema.VJOURNAL={required_properties:["DTSTAMP","UID"]};schema.VFREEBUSY={required_properties:["DTSTAMP","UID"]};schema.VALARM={required_properties:["ACTION","TRIGGER"]}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return getViewLinkStatus}));var _kbn_i18n__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2);var _kbn_i18n__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__);var _common_analytics__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(62);var _analytics_list_common__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(88);const unknownJobTypeMessage=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.dataframe.analyticsList.viewActionUnknownJobTypeToolTipContent",{defaultMessage:"There is no results page available for this type of data frame analytics job."});const jobNotStartedMessage=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.dataframe.analyticsList.viewActionJobNotStartedToolTipContent",{defaultMessage:"The data frame analytics job did not start. There is no results page available."});const jobNotFinishedMessage=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.dataframe.analyticsList.viewActionJobNotFinishedToolTipContent",{defaultMessage:"The data frame analytics job is not finished. There is no results page available."});const jobFailedMessage=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.dataframe.analyticsList.viewActionJobFailedToolTipContent",{defaultMessage:"The data frame analytics job failed. There is no results page available."});function getViewLinkStatus(item){const viewLinkStatus={disabled:false};const progressStats=Object(_analytics_list_common__WEBPACK_IMPORTED_MODULE_2__["d"])(item.stats);const jobFailed=Object(_analytics_list_common__WEBPACK_IMPORTED_MODULE_2__["f"])(item.stats.state);const jobNotStarted=progressStats.currentPhase===1&&progressStats.progress===0;const jobFinished=Object(_analytics_list_common__WEBPACK_IMPORTED_MODULE_2__["i"])(item.stats.state)&&progressStats.currentPhase===progressStats.totalPhases&&progressStats.progress===100;const isUnknownJobType=!Object(_common_analytics__WEBPACK_IMPORTED_MODULE_1__["D"])(item.config.analysis)&&!Object(_common_analytics__WEBPACK_IMPORTED_MODULE_1__["C"])(item.config.analysis)&&!Object(_common_analytics__WEBPACK_IMPORTED_MODULE_1__["A"])(item.config.analysis);const disabled=!jobFinished||jobFailed||isUnknownJobType;if(disabled){viewLinkStatus.disabled=true;if(isUnknownJobType){viewLinkStatus.tooltipContent=unknownJobTypeMessage}else if(jobFailed){viewLinkStatus.tooltipContent=jobFailedMessage}else if(jobNotStarted){viewLinkStatus.tooltipContent=jobNotStartedMessage}else if(!jobFinished){viewLinkStatus.tooltipContent=jobNotFinishedMessage}}return viewLinkStatus}},function(module,exports,__webpack_require__){var ListCache=__webpack_require__(193),stackClear=__webpack_require__(501),stackDelete=__webpack_require__(502),stackGet=__webpack_require__(503),stackHas=__webpack_require__(504),stackSet=__webpack_require__(505);function Stack(entries){var data=this.__data__=new ListCache(entries);this.size=data.size}Stack.prototype.clear=stackClear;Stack.prototype["delete"]=stackDelete;Stack.prototype.get=stackGet;Stack.prototype.has=stackHas;Stack.prototype.set=stackSet;module.exports=Stack},function(module,exports,__webpack_require__){var listCacheClear=__webpack_require__(496),listCacheDelete=__webpack_require__(497),listCacheGet=__webpack_require__(498),listCacheHas=__webpack_require__(499),listCacheSet=__webpack_require__(500);function ListCache(entries){var index=-1,length=entries==null?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}ListCache.prototype.clear=listCacheClear;ListCache.prototype["delete"]=listCacheDelete;ListCache.prototype.get=listCacheGet;ListCache.prototype.has=listCacheHas;ListCache.prototype.set=listCacheSet;module.exports=ListCache},function(module,exports,__webpack_require__){var eq=__webpack_require__(145);function assocIndexOf(array,key){var length=array.length;while(length--){if(eq(array[length][0],key)){return length}}return-1}module.exports=assocIndexOf},function(module,exports,__webpack_require__){var getNative=__webpack_require__(135);var nativeCreate=getNative(Object,"create");module.exports=nativeCreate},function(module,exports,__webpack_require__){var isKeyable=__webpack_require__(520);function getMapData(map,key){var data=map.__data__;return isKeyable(key)?data[typeof key=="string"?"string":"hash"]:data.map}module.exports=getMapData},function(module,exports,__webpack_require__){var baseAssignValue=__webpack_require__(198),eq=__webpack_require__(145);var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;function assignValue(object,key,value){var objValue=object[key];if(!(hasOwnProperty.call(object,key)&&eq(objValue,value))||value===undefined&&!(key in object)){baseAssignValue(object,key,value)}}module.exports=assignValue},function(module,exports,__webpack_require__){var defineProperty=__webpack_require__(308);function baseAssignValue(object,key,value){if(key=="__proto__"&&defineProperty){defineProperty(object,key,{configurable:true,enumerable:true,value:value,writable:true})}else{object[key]=value}}module.exports=baseAssignValue},function(module,exports){var MAX_SAFE_INTEGER=9007199254740991;var reIsUint=/^(?:0|[1-9]\d*)$/;function isIndex(value,length){var type=typeof value;length=length==null?MAX_SAFE_INTEGER:length;return!!length&&(type=="number"||type!="symbol"&&reIsUint.test(value))&&(value>-1&&value%1==0&&value<length)}module.exports=isIndex},function(module,exports){function baseUnary(func){return function(value){return func(value)}}module.exports=baseUnary},function(module,exports){var objectProto=Object.prototype;function isPrototype(value){var Ctor=value&&value.constructor,proto=typeof Ctor=="function"&&Ctor.prototype||objectProto;return value===proto}module.exports=isPrototype},function(module,exports,__webpack_require__){var overArg=__webpack_require__(310);var getPrototype=overArg(Object.getPrototypeOf,Object);module.exports=getPrototype},function(module,exports,__webpack_require__){var baseForOwn=__webpack_require__(243),createBaseEach=__webpack_require__(549);var baseEach=createBaseEach(baseForOwn);module.exports=baseEach},function(module,exports,__webpack_require__){var castPath=__webpack_require__(205),toKey=__webpack_require__(167);function baseGet(object,path){path=castPath(path,object);var index=0,length=path.length;while(object!=null&&index<length){object=object[toKey(path[index++])]}return index&&index==length?object:undefined}module.exports=baseGet},function(module,exports,__webpack_require__){var isArray=__webpack_require__(77),isKey=__webpack_require__(246),stringToPath=__webpack_require__(563),toString=__webpack_require__(333);function castPath(value,object){if(isArray(value)){return value}return isKey(value,object)?[value]:stringToPath(toString(value))}module.exports=castPath},function(module,exports){function arrayMap(array,iteratee){var index=-1,length=array==null?0:array.length,result=Array(length);while(++index<length){result[index]=iteratee(array[index],index,array)}return result}module.exports=arrayMap},function(module,exports,__webpack_require__){var identity=__webpack_require__(138),overRest=__webpack_require__(342),setToString=__webpack_require__(343);function baseRest(func,start){return setToString(overRest(func,start,identity),func+"")}module.exports=baseRest},function(module,exports,__webpack_require__){var eq=__webpack_require__(145),isArrayLike=__webpack_require__(119),isIndex=__webpack_require__(199),isObject=__webpack_require__(104);function isIterateeCall(value,index,object){if(!isObject(object)){return false}var type=typeof index;if(type=="number"?isArrayLike(object)&&isIndex(index,object.length):type=="string"&&index in object){return eq(object[index],value)}return false}module.exports=isIterateeCall},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(73);module.exports={longestPath:longestPath,slack:slack};function longestPath(g){var visited={};function dfs(v){var label=g.node(v);if(_.has(visited,v)){return label.rank}visited[v]=true;var rank=_.min(_.map(g.outEdges(v),(function(e){return dfs(e.w)-g.edge(e).minlen})));if(rank===Number.POSITIVE_INFINITY||rank===undefined||rank===null){rank=0}return label.rank=rank}_.forEach(g.sources(),dfs)}function slack(g,e){return g.node(e.w).rank-g.node(e.v).rank-g.edge(e).minlen}},,,,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return JobSelectorBadge}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(33);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);var group_color_utils=__webpack_require__(142);function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}const JobSelectorBadge=({icon:icon,id:id,isGroup:isGroup=false,numJobs:numJobs,removeId:removeId})=>{const color=isGroup?Object(group_color_utils["a"])(id):"hollow";let props={color:color};let jobCount;if(icon===true&&removeId){props={...props,iconType:"cross",iconSide:"right",onClick:()=>removeId(id),onClickAriaLabel:"Remove id"}}if(numJobs!==undefined){jobCount=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobSelector.selectedGroupJobs",{defaultMessage:`({jobsCount, plural, one {# job} other {# jobs}})`,values:{jobsCount:numJobs}})}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBadge"],_extends({key:`${id}-id`,"data-test-subj":`mlJobSelectionBadge ${id}`},props),`${id}${jobCount?jobCount:""}`)}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return EventRateChart}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_ElasticCharts_=__webpack_require__(37);var axes=__webpack_require__(295);var settings=__webpack_require__(112);var loading_wrapper=__webpack_require__(272);var anomalies=__webpack_require__(297);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(33);var date_utils=__webpack_require__(67);const OverlayRange=({overlayKey:overlayKey,start:start,end:end,color:color,showMarker:showMarker=true})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["RectAnnotation"],{id:`rect_annotation_${overlayKey}`,zIndex:1,hideTooltips:true,dataValues:[{coordinates:{x0:start,x1:end}}],style:{fill:color,strokeWidth:0}}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["LineAnnotation"],{id:"annotation_1",domainType:external_kbnSharedDeps_ElasticCharts_["AnnotationDomainTypes"].XDomain,dataValues:[{dataValue:start}],style:{line:{strokeWidth:1,stroke:"#343741",opacity:0}},markerPosition:external_kbnSharedDeps_ElasticCharts_["Position"].Bottom,hideTooltips:true,marker:showMarker?external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement("div",{style:{textAlign:"center"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:"arrowUp"})),external_kbnSharedDeps_React_default.a.createElement("div",{style:{fontWeight:"normal",color:"#343741"}},Object(date_utils["d"])(start))):undefined}));const EventRateChart=({eventRateChartData:eventRateChartData,anomalyData:anomalyData,height:height,width:width,showAxis:showAxis,loading:loading=false,fadeChart:fadeChart,overlayRanges:overlayRanges,onBrushEnd:onBrushEnd})=>{const{EVENT_RATE_COLOR_WITH_ANOMALIES:EVENT_RATE_COLOR_WITH_ANOMALIES,EVENT_RATE_COLOR:EVENT_RATE_COLOR}=Object(settings["d"])();const barColor=fadeChart?EVENT_RATE_COLOR_WITH_ANOMALIES:EVENT_RATE_COLOR;const theme={scales:{histogramPadding:.2}};return external_kbnSharedDeps_React_default.a.createElement("div",{style:{width:width,height:height},"data-test-subj":`mlEventRateChart ${eventRateChartData.length?"withData":"empty"}`},external_kbnSharedDeps_React_default.a.createElement(loading_wrapper["a"],{height:height,hasData:eventRateChartData.length>0,loading:loading},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Chart"],null,showAxis===true&&external_kbnSharedDeps_React_default.a.createElement(axes["a"],null),onBrushEnd===undefined?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Settings"],{tooltip:external_kbnSharedDeps_ElasticCharts_["TooltipType"].None,theme:theme}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Settings"],{tooltip:external_kbnSharedDeps_ElasticCharts_["TooltipType"].None,onBrushEnd:onBrushEnd,theme:theme}),overlayRanges&&overlayRanges.map((range,i)=>external_kbnSharedDeps_React_default.a.createElement(OverlayRange,{key:i,overlayKey:i,start:range.start,end:range.end,color:range.color,showMarker:range.showMarker})),external_kbnSharedDeps_React_default.a.createElement(anomalies["a"],{anomalyData:anomalyData}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["HistogramBarSeries"],{id:"event_rate",xScaleType:external_kbnSharedDeps_ElasticCharts_["ScaleType"].Time,yScaleType:external_kbnSharedDeps_ElasticCharts_["ScaleType"].Linear,xAccessor:"time",yAccessors:["value"],data:eventRateChartData,color:barColor}))))}},,,,,,,,,,,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return getDefaultAnomalyDetectionJobsListState}));__webpack_require__.d(__webpack_exports__,"a",(function(){return JobsPage}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(10);var react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);var _components_navigation_menu__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(94);var _components_jobs_list_view_index__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(381);var _util_url_state__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(70);var _common_constants_ml_url_generator__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(0);var _components_help_menu__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(98);var _contexts_kibana__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(58);function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}const getDefaultAnomalyDetectionJobsListState=()=>({pageIndex:0,pageSize:10,sortField:"id",sortDirection:"asc"});const JobsPage=props=>{const[pageState,setPageState]=Object(_util_url_state__WEBPACK_IMPORTED_MODULE_3__["b"])(_common_constants_ml_url_generator__WEBPACK_IMPORTED_MODULE_4__["b"].ANOMALY_DETECTION_JOBS_MANAGE,getDefaultAnomalyDetectionJobsListState());const{services:{docLinks:docLinks}}=Object(_contexts_kibana__WEBPACK_IMPORTED_MODULE_6__["b"])();const helpLink=docLinks.links.ml.anomalyDetection;return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement("div",{"data-test-subj":"mlPageJobManagement"},react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_components_navigation_menu__WEBPACK_IMPORTED_MODULE_1__["a"],{tabId:"anomaly_detection"}),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_components_jobs_list_view_index__WEBPACK_IMPORTED_MODULE_2__["a"],_extends({},props,{jobsViewState:pageState,onJobsViewStateUpdate:setPageState})),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_components_help_menu__WEBPACK_IMPORTED_MODULE_5__["a"],{docLink:helpLink}))}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return useCreateADLinks}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(10);var react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);var _contexts_kibana__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(58);var _common_constants_settings__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(183);var _services_job_service__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(65);const useCreateADLinks=()=>{const{services:{http:{basePath:basePath}}}=Object(_contexts_kibana__WEBPACK_IMPORTED_MODULE_1__["b"])();const useUserTimeSettings=Object(_contexts_kibana__WEBPACK_IMPORTED_MODULE_1__["h"])().get(_common_constants_settings__WEBPACK_IMPORTED_MODULE_2__["b"]);const userTimeSettings=Object(_contexts_kibana__WEBPACK_IMPORTED_MODULE_1__["h"])().get(_common_constants_settings__WEBPACK_IMPORTED_MODULE_2__["a"]);const createLinkWithUserDefaults=Object(react__WEBPACK_IMPORTED_MODULE_0__["useCallback"])((location,jobList)=>{const resultsUrl=_services_job_service__WEBPACK_IMPORTED_MODULE_3__["a"].createResultsUrlForJobs(jobList,location,useUserTimeSettings===true&&userTimeSettings!==undefined?userTimeSettings:undefined);return`${basePath.get()}/app/ml/${resultsUrl}`},[basePath]);return{createLinkWithUserDefaults:createLinkWithUserDefaults}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return mlTableService}));var rxjs__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(19);var rxjs__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(rxjs__WEBPACK_IMPORTED_MODULE_0__);const mlTableService={rowMouseenter$:new rxjs__WEBPACK_IMPORTED_MODULE_0__["Subject"],rowMouseleave$:new rxjs__WEBPACK_IMPORTED_MODULE_0__["Subject"]}},function(module,exports,__webpack_require__){"use strict";function areInputsEqual(newInputs,lastInputs){if(newInputs.length!==lastInputs.length){return false}for(var i=0;i<newInputs.length;i++){if(newInputs[i]!==lastInputs[i]){return false}}return true}function memoizeOne(resultFn,isEqual){if(isEqual===void 0){isEqual=areInputsEqual}var lastThis;var lastArgs=[];var lastResult;var calledOnce=false;function memoized(){var newArgs=[];for(var _i=0;_i<arguments.length;_i++){newArgs[_i]=arguments[_i]}if(calledOnce&&lastThis===this&&isEqual(newArgs,lastArgs)){return lastResult}lastResult=resultFn.apply(this,newArgs);calledOnce=true;lastThis=this;lastArgs=newArgs;return lastResult}return memoized}module.exports=memoizeOne},function(module,exports,__webpack_require__){"use strict";(function(global){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
function compare(a,b){if(a===b){return 0}var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y){return-1}if(y<x){return 1}return 0}function isBuffer(b){if(global.Buffer&&typeof global.Buffer.isBuffer==="function"){return global.Buffer.isBuffer(b)}return!!(b!=null&&b._isBuffer)}var util=__webpack_require__(162);var hasOwn=Object.prototype.hasOwnProperty;var pSlice=Array.prototype.slice;var functionsHaveNames=function(){return function foo(){}.name==="foo"}();function pToString(obj){return Object.prototype.toString.call(obj)}function isView(arrbuf){if(isBuffer(arrbuf)){return false}if(typeof global.ArrayBuffer!=="function"){return false}if(typeof ArrayBuffer.isView==="function"){return ArrayBuffer.isView(arrbuf)}if(!arrbuf){return false}if(arrbuf instanceof DataView){return true}if(arrbuf.buffer&&arrbuf.buffer instanceof ArrayBuffer){return true}return false}var assert=module.exports=ok;var regex=/\s*function\s+([^\(\s]*)\s*/;function getName(func){if(!util.isFunction(func)){return}if(functionsHaveNames){return func.name}var str=func.toString();var match=str.match(regex);return match&&match[1]}assert.AssertionError=function AssertionError(options){this.name="AssertionError";this.actual=options.actual;this.expected=options.expected;this.operator=options.operator;if(options.message){this.message=options.message;this.generatedMessage=false}else{this.message=getMessage(this);this.generatedMessage=true}var stackStartFunction=options.stackStartFunction||fail;if(Error.captureStackTrace){Error.captureStackTrace(this,stackStartFunction)}else{var err=new Error;if(err.stack){var out=err.stack;var fn_name=getName(stackStartFunction);var idx=out.indexOf("\n"+fn_name);if(idx>=0){var next_line=out.indexOf("\n",idx+1);out=out.substring(next_line+1)}this.stack=out}}};util.inherits(assert.AssertionError,Error);function truncate(s,n){if(typeof s==="string"){return s.length<n?s:s.slice(0,n)}else{return s}}function inspect(something){if(functionsHaveNames||!util.isFunction(something)){return util.inspect(something)}var rawname=getName(something);var name=rawname?": "+rawname:"";return"[Function"+name+"]"}function getMessage(self){return truncate(inspect(self.actual),128)+" "+self.operator+" "+truncate(inspect(self.expected),128)}function fail(actual,expected,message,operator,stackStartFunction){throw new assert.AssertionError({message:message,actual:actual,expected:expected,operator:operator,stackStartFunction:stackStartFunction})}assert.fail=fail;function ok(value,message){if(!value)fail(value,true,message,"==",assert.ok)}assert.ok=ok;assert.equal=function equal(actual,expected,message){if(actual!=expected)fail(actual,expected,message,"==",assert.equal)};assert.notEqual=function notEqual(actual,expected,message){if(actual==expected){fail(actual,expected,message,"!=",assert.notEqual)}};assert.deepEqual=function deepEqual(actual,expected,message){if(!_deepEqual(actual,expected,false)){fail(actual,expected,message,"deepEqual",assert.deepEqual)}};assert.deepStrictEqual=function deepStrictEqual(actual,expected,message){if(!_deepEqual(actual,expected,true)){fail(actual,expected,message,"deepStrictEqual",assert.deepStrictEqual)}};function _deepEqual(actual,expected,strict,memos){if(actual===expected){return true}else if(isBuffer(actual)&&isBuffer(expected)){return compare(actual,expected)===0}else if(util.isDate(actual)&&util.isDate(expected)){return actual.getTime()===expected.getTime()}else if(util.isRegExp(actual)&&util.isRegExp(expected)){return actual.source===expected.source&&actual.global===expected.global&&actual.multiline===expected.multiline&&actual.lastIndex===expected.lastIndex&&actual.ignoreCase===expected.ignoreCase}else if((actual===null||typeof actual!=="object")&&(expected===null||typeof expected!=="object")){return strict?actual===expected:actual==expected}else if(isView(actual)&&isView(expected)&&pToString(actual)===pToString(expected)&&!(actual instanceof Float32Array||actual instanceof Float64Array)){return compare(new Uint8Array(actual.buffer),new Uint8Array(expected.buffer))===0}else if(isBuffer(actual)!==isBuffer(expected)){return false}else{memos=memos||{actual:[],expected:[]};var actualIndex=memos.actual.indexOf(actual);if(actualIndex!==-1){if(actualIndex===memos.expected.indexOf(expected)){return true}}memos.actual.push(actual);memos.expected.push(expected);return objEquiv(actual,expected,strict,memos)}}function isArguments(object){return Object.prototype.toString.call(object)=="[object Arguments]"}function objEquiv(a,b,strict,actualVisitedObjects){if(a===null||a===undefined||b===null||b===undefined)return false;if(util.isPrimitive(a)||util.isPrimitive(b))return a===b;if(strict&&Object.getPrototypeOf(a)!==Object.getPrototypeOf(b))return false;var aIsArgs=isArguments(a);var bIsArgs=isArguments(b);if(aIsArgs&&!bIsArgs||!aIsArgs&&bIsArgs)return false;if(aIsArgs){a=pSlice.call(a);b=pSlice.call(b);return _deepEqual(a,b,strict)}var ka=objectKeys(a);var kb=objectKeys(b);var key,i;if(ka.length!==kb.length)return false;ka.sort();kb.sort();for(i=ka.length-1;i>=0;i--){if(ka[i]!==kb[i])return false}for(i=ka.length-1;i>=0;i--){key=ka[i];if(!_deepEqual(a[key],b[key],strict,actualVisitedObjects))return false}return true}assert.notDeepEqual=function notDeepEqual(actual,expected,message){if(_deepEqual(actual,expected,false)){fail(actual,expected,message,"notDeepEqual",assert.notDeepEqual)}};assert.notDeepStrictEqual=notDeepStrictEqual;function notDeepStrictEqual(actual,expected,message){if(_deepEqual(actual,expected,true)){fail(actual,expected,message,"notDeepStrictEqual",notDeepStrictEqual)}}assert.strictEqual=function strictEqual(actual,expected,message){if(actual!==expected){fail(actual,expected,message,"===",assert.strictEqual)}};assert.notStrictEqual=function notStrictEqual(actual,expected,message){if(actual===expected){fail(actual,expected,message,"!==",assert.notStrictEqual)}};function expectedException(actual,expected){if(!actual||!expected){return false}if(Object.prototype.toString.call(expected)=="[object RegExp]"){return expected.test(actual)}try{if(actual instanceof expected){return true}}catch(e){}if(Error.isPrototypeOf(expected)){return false}return expected.call({},actual)===true}function _tryBlock(block){var error;try{block()}catch(e){error=e}return error}function _throws(shouldThrow,block,expected,message){var actual;if(typeof block!=="function"){throw new TypeError('"block" argument must be a function')}if(typeof expected==="string"){message=expected;expected=null}actual=_tryBlock(block);message=(expected&&expected.name?" ("+expected.name+").":".")+(message?" "+message:".");if(shouldThrow&&!actual){fail(actual,expected,"Missing expected exception"+message)}var userProvidedMessage=typeof message==="string";var isUnwantedException=!shouldThrow&&util.isError(actual);var isUnexpectedException=!shouldThrow&&actual&&!expected;if(isUnwantedException&&userProvidedMessage&&expectedException(actual,expected)||isUnexpectedException){fail(actual,expected,"Got unwanted exception"+message)}if(shouldThrow&&actual&&expected&&!expectedException(actual,expected)||!shouldThrow&&actual){throw actual}}assert.throws=function(block,error,message){_throws(true,block,error,message)};assert.doesNotThrow=function(block,error,message){_throws(false,block,error,message)};assert.ifError=function(err){if(err)throw err};var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj){if(hasOwn.call(obj,key))keys.push(key)}return keys}}).call(this,__webpack_require__(106))},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(103);module.exports=Graph;var DEFAULT_EDGE_NAME="\0";var GRAPH_NODE="\0";var EDGE_KEY_DELIM="";function Graph(opts){this._isDirected=_.has(opts,"directed")?opts.directed:true;this._isMultigraph=_.has(opts,"multigraph")?opts.multigraph:false;this._isCompound=_.has(opts,"compound")?opts.compound:false;this._label=undefined;this._defaultNodeLabelFn=_.constant(undefined);this._defaultEdgeLabelFn=_.constant(undefined);this._nodes={};if(this._isCompound){this._parent={};this._children={};this._children[GRAPH_NODE]={}}this._in={};this._preds={};this._out={};this._sucs={};this._edgeObjs={};this._edgeLabels={}}Graph.prototype._nodeCount=0;Graph.prototype._edgeCount=0;Graph.prototype.isDirected=function(){return this._isDirected};Graph.prototype.isMultigraph=function(){return this._isMultigraph};Graph.prototype.isCompound=function(){return this._isCompound};Graph.prototype.setGraph=function(label){this._label=label;return this};Graph.prototype.graph=function(){return this._label};Graph.prototype.setDefaultNodeLabel=function(newDefault){if(!_.isFunction(newDefault)){newDefault=_.constant(newDefault)}this._defaultNodeLabelFn=newDefault;return this};Graph.prototype.nodeCount=function(){return this._nodeCount};Graph.prototype.nodes=function(){return _.keys(this._nodes)};Graph.prototype.sources=function(){var self=this;return _.filter(this.nodes(),(function(v){return _.isEmpty(self._in[v])}))};Graph.prototype.sinks=function(){var self=this;return _.filter(this.nodes(),(function(v){return _.isEmpty(self._out[v])}))};Graph.prototype.setNodes=function(vs,value){var args=arguments;var self=this;_.each(vs,(function(v){if(args.length>1){self.setNode(v,value)}else{self.setNode(v)}}));return this};Graph.prototype.setNode=function(v,value){if(_.has(this._nodes,v)){if(arguments.length>1){this._nodes[v]=value}return this}this._nodes[v]=arguments.length>1?value:this._defaultNodeLabelFn(v);if(this._isCompound){this._parent[v]=GRAPH_NODE;this._children[v]={};this._children[GRAPH_NODE][v]=true}this._in[v]={};this._preds[v]={};this._out[v]={};this._sucs[v]={};++this._nodeCount;return this};Graph.prototype.node=function(v){return this._nodes[v]};Graph.prototype.hasNode=function(v){return _.has(this._nodes,v)};Graph.prototype.removeNode=function(v){var self=this;if(_.has(this._nodes,v)){var removeEdge=function(e){self.removeEdge(self._edgeObjs[e])};delete this._nodes[v];if(this._isCompound){this._removeFromParentsChildList(v);delete this._parent[v];_.each(this.children(v),(function(child){self.setParent(child)}));delete this._children[v]}_.each(_.keys(this._in[v]),removeEdge);delete this._in[v];delete this._preds[v];_.each(_.keys(this._out[v]),removeEdge);delete this._out[v];delete this._sucs[v];--this._nodeCount}return this};Graph.prototype.setParent=function(v,parent){if(!this._isCompound){throw new Error("Cannot set parent in a non-compound graph")}if(_.isUndefined(parent)){parent=GRAPH_NODE}else{parent+="";for(var ancestor=parent;!_.isUndefined(ancestor);ancestor=this.parent(ancestor)){if(ancestor===v){throw new Error("Setting "+parent+" as parent of "+v+" would create a cycle")}}this.setNode(parent)}this.setNode(v);this._removeFromParentsChildList(v);this._parent[v]=parent;this._children[parent][v]=true;return this};Graph.prototype._removeFromParentsChildList=function(v){delete this._children[this._parent[v]][v]};Graph.prototype.parent=function(v){if(this._isCompound){var parent=this._parent[v];if(parent!==GRAPH_NODE){return parent}}};Graph.prototype.children=function(v){if(_.isUndefined(v)){v=GRAPH_NODE}if(this._isCompound){var children=this._children[v];if(children){return _.keys(children)}}else if(v===GRAPH_NODE){return this.nodes()}else if(this.hasNode(v)){return[]}};Graph.prototype.predecessors=function(v){var predsV=this._preds[v];if(predsV){return _.keys(predsV)}};Graph.prototype.successors=function(v){var sucsV=this._sucs[v];if(sucsV){return _.keys(sucsV)}};Graph.prototype.neighbors=function(v){var preds=this.predecessors(v);if(preds){return _.union(preds,this.successors(v))}};Graph.prototype.isLeaf=function(v){var neighbors;if(this.isDirected()){neighbors=this.successors(v)}else{neighbors=this.neighbors(v)}return neighbors.length===0};Graph.prototype.filterNodes=function(filter){var copy=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});copy.setGraph(this.graph());var self=this;_.each(this._nodes,(function(value,v){if(filter(v)){copy.setNode(v,value)}}));_.each(this._edgeObjs,(function(e){if(copy.hasNode(e.v)&&copy.hasNode(e.w)){copy.setEdge(e,self.edge(e))}}));var parents={};function findParent(v){var parent=self.parent(v);if(parent===undefined||copy.hasNode(parent)){parents[v]=parent;return parent}else if(parent in parents){return parents[parent]}else{return findParent(parent)}}if(this._isCompound){_.each(copy.nodes(),(function(v){copy.setParent(v,findParent(v))}))}return copy};Graph.prototype.setDefaultEdgeLabel=function(newDefault){if(!_.isFunction(newDefault)){newDefault=_.constant(newDefault)}this._defaultEdgeLabelFn=newDefault;return this};Graph.prototype.edgeCount=function(){return this._edgeCount};Graph.prototype.edges=function(){return _.values(this._edgeObjs)};Graph.prototype.setPath=function(vs,value){var self=this;var args=arguments;_.reduce(vs,(function(v,w){if(args.length>1){self.setEdge(v,w,value)}else{self.setEdge(v,w)}return w}));return this};Graph.prototype.setEdge=function(){var v,w,name,value;var valueSpecified=false;var arg0=arguments[0];if(typeof arg0==="object"&&arg0!==null&&"v"in arg0){v=arg0.v;w=arg0.w;name=arg0.name;if(arguments.length===2){value=arguments[1];valueSpecified=true}}else{v=arg0;w=arguments[1];name=arguments[3];if(arguments.length>2){value=arguments[2];valueSpecified=true}}v=""+v;w=""+w;if(!_.isUndefined(name)){name=""+name}var e=edgeArgsToId(this._isDirected,v,w,name);if(_.has(this._edgeLabels,e)){if(valueSpecified){this._edgeLabels[e]=value}return this}if(!_.isUndefined(name)&&!this._isMultigraph){throw new Error("Cannot set a named edge when isMultigraph = false")}this.setNode(v);this.setNode(w);this._edgeLabels[e]=valueSpecified?value:this._defaultEdgeLabelFn(v,w,name);var edgeObj=edgeArgsToObj(this._isDirected,v,w,name);v=edgeObj.v;w=edgeObj.w;Object.freeze(edgeObj);this._edgeObjs[e]=edgeObj;incrementOrInitEntry(this._preds[w],v);incrementOrInitEntry(this._sucs[v],w);this._in[w][e]=edgeObj;this._out[v][e]=edgeObj;this._edgeCount++;return this};Graph.prototype.edge=function(v,w,name){var e=arguments.length===1?edgeObjToId(this._isDirected,arguments[0]):edgeArgsToId(this._isDirected,v,w,name);return this._edgeLabels[e]};Graph.prototype.hasEdge=function(v,w,name){var e=arguments.length===1?edgeObjToId(this._isDirected,arguments[0]):edgeArgsToId(this._isDirected,v,w,name);return _.has(this._edgeLabels,e)};Graph.prototype.removeEdge=function(v,w,name){var e=arguments.length===1?edgeObjToId(this._isDirected,arguments[0]):edgeArgsToId(this._isDirected,v,w,name);var edge=this._edgeObjs[e];if(edge){v=edge.v;w=edge.w;delete this._edgeLabels[e];delete this._edgeObjs[e];decrementOrRemoveEntry(this._preds[w],v);decrementOrRemoveEntry(this._sucs[v],w);delete this._in[w][e];delete this._out[v][e];this._edgeCount--}return this};Graph.prototype.inEdges=function(v,u){var inV=this._in[v];if(inV){var edges=_.values(inV);if(!u){return edges}return _.filter(edges,(function(edge){return edge.v===u}))}};Graph.prototype.outEdges=function(v,w){var outV=this._out[v];if(outV){var edges=_.values(outV);if(!w){return edges}return _.filter(edges,(function(edge){return edge.w===w}))}};Graph.prototype.nodeEdges=function(v,w){var inEdges=this.inEdges(v,w);if(inEdges){return inEdges.concat(this.outEdges(v,w))}};function incrementOrInitEntry(map,k){if(map[k]){map[k]++}else{map[k]=1}}function decrementOrRemoveEntry(map,k){if(!--map[k]){delete map[k]}}function edgeArgsToId(isDirected,v_,w_,name){var v=""+v_;var w=""+w_;if(!isDirected&&v>w){var tmp=v;v=w;w=tmp}return v+EDGE_KEY_DELIM+w+EDGE_KEY_DELIM+(_.isUndefined(name)?DEFAULT_EDGE_NAME:name)}function edgeArgsToObj(isDirected,v_,w_,name){var v=""+v_;var w=""+w_;if(!isDirected&&v>w){var tmp=v;v=w;w=tmp}var edgeObj={v:v,w:w};if(name){edgeObj.name=name}return edgeObj}function edgeObjToId(isDirected,edgeObj){return edgeArgsToId(isDirected,edgeObj.v,edgeObj.w,edgeObj.name)}},function(module,exports,__webpack_require__){var getNative=__webpack_require__(135),root=__webpack_require__(108);var Map=getNative(root,"Map");module.exports=Map},function(module,exports,__webpack_require__){var mapCacheClear=__webpack_require__(512),mapCacheDelete=__webpack_require__(519),mapCacheGet=__webpack_require__(521),mapCacheHas=__webpack_require__(522),mapCacheSet=__webpack_require__(523);function MapCache(entries){var index=-1,length=entries==null?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}MapCache.prototype.clear=mapCacheClear;MapCache.prototype["delete"]=mapCacheDelete;MapCache.prototype.get=mapCacheGet;MapCache.prototype.has=mapCacheHas;MapCache.prototype.set=mapCacheSet;module.exports=MapCache},function(module,exports){function arrayEach(array,iteratee){var index=-1,length=array==null?0:array.length;while(++index<length){if(iteratee(array[index],index,array)===false){break}}return array}module.exports=arrayEach},function(module,exports){var MAX_SAFE_INTEGER=9007199254740991;function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}module.exports=isLength},function(module,exports,__webpack_require__){(function(module){var freeGlobal=__webpack_require__(306);var freeExports=true&&exports&&!exports.nodeType&&exports;var freeModule=freeExports&&typeof module=="object"&&module&&!module.nodeType&&module;var moduleExports=freeModule&&freeModule.exports===freeExports;var freeProcess=moduleExports&&freeGlobal.process;var nodeUtil=function(){try{var types=freeModule&&freeModule.require&&freeModule.require("util").types;if(types){return types}return freeProcess&&freeProcess.binding&&freeProcess.binding("util")}catch(e){}}();module.exports=nodeUtil}).call(this,__webpack_require__(158)(module))},function(module,exports,__webpack_require__){var isPrototype=__webpack_require__(201),nativeKeys=__webpack_require__(529);var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;function baseKeys(object){if(!isPrototype(object)){return nativeKeys(object)}var result=[];for(var key in Object(object)){if(hasOwnProperty.call(object,key)&&key!="constructor"){result.push(key)}}return result}module.exports=baseKeys},function(module,exports,__webpack_require__){var arrayFilter=__webpack_require__(313),stubArray=__webpack_require__(314);var objectProto=Object.prototype;var propertyIsEnumerable=objectProto.propertyIsEnumerable;var nativeGetSymbols=Object.getOwnPropertySymbols;var getSymbols=!nativeGetSymbols?stubArray:function(object){if(object==null){return[]}object=Object(object);return arrayFilter(nativeGetSymbols(object),(function(symbol){return propertyIsEnumerable.call(object,symbol)}))};module.exports=getSymbols},function(module,exports){function arrayPush(array,values){var index=-1,length=values.length,offset=array.length;while(++index<length){array[offset+index]=values[index]}return array}module.exports=arrayPush},function(module,exports,__webpack_require__){var Uint8Array=__webpack_require__(319);function cloneArrayBuffer(arrayBuffer){var result=new arrayBuffer.constructor(arrayBuffer.byteLength);new Uint8Array(result).set(new Uint8Array(arrayBuffer));return result}module.exports=cloneArrayBuffer},function(module,exports){function constant(value){return function(){return value}}module.exports=constant},function(module,exports,__webpack_require__){var baseFor=__webpack_require__(244),keys=__webpack_require__(123);function baseForOwn(object,iteratee){return object&&baseFor(object,iteratee,keys)}module.exports=baseForOwn},function(module,exports,__webpack_require__){var createBaseFor=__webpack_require__(548);var baseFor=createBaseFor();module.exports=baseFor},function(module,exports){function setToArray(set){var index=-1,result=Array(set.size);set.forEach((function(value){result[++index]=value}));return result}module.exports=setToArray},function(module,exports,__webpack_require__){var isArray=__webpack_require__(77),isSymbol=__webpack_require__(149);var reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;function isKey(value,object){if(isArray(value)){return false}var type=typeof value;if(type=="number"||type=="symbol"||type=="boolean"||value==null||isSymbol(value)){return true}return reIsPlainProp.test(value)||!reIsDeepProp.test(value)||object!=null&&value in Object(object)}module.exports=isKey},function(module,exports,__webpack_require__){var arrayPush=__webpack_require__(240),isFlattenable=__webpack_require__(582);function baseFlatten(array,depth,predicate,isStrict,result){var index=-1,length=array.length;predicate||(predicate=isFlattenable);result||(result=[]);while(++index<length){var value=array[index];if(depth>0&&predicate(value)){if(depth>1){baseFlatten(value,depth-1,predicate,isStrict,result)}else{arrayPush(result,value)}}else if(!isStrict){result[result.length]=value}}return result}module.exports=baseFlatten},function(module,exports,__webpack_require__){var isSymbol=__webpack_require__(149);function baseExtremum(array,iteratee,comparator){var index=-1,length=array.length;while(++index<length){var value=array[index],current=iteratee(value);if(current!=null&&(computed===undefined?current===current&&!isSymbol(current):comparator(current,computed))){var computed=current,result=value}}return result}module.exports=baseExtremum},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var react_1=__webpack_require__(10);var useEffectOnce=function(effect){react_1.useEffect(effect,[])};exports.default=useEffectOnce},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return getGroupsFromJobs}));__webpack_require__.d(__webpack_exports__,"b",(function(){return getTimeRangeFromSelection}));__webpack_require__.d(__webpack_exports__,"c",(function(){return normalizeTimes}));var _kbn_i18n__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2);var _kbn_i18n__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__);var moment__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(12);var moment__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(moment__WEBPACK_IMPORTED_MODULE_1__);var d3__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(100);var d3__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(d3__WEBPACK_IMPORTED_MODULE_2__);function getGroupsFromJobs(jobs){const groups={};const groupsMap={};jobs.forEach(job=>{if(job.groups!==undefined){job.groups.forEach(g=>{if(groups[g]===undefined){groups[g]={id:g,jobIds:[job.job_id],timeRange:{to:job.timeRange.to,toMoment:null,from:job.timeRange.from,fromMoment:null,fromPx:job.timeRange.fromPx,toPx:job.timeRange.toPx,widthPx:null}};groupsMap[g]=[job.job_id]}else{groups[g].jobIds.push(job.job_id);groupsMap[g].push(job.job_id);if(groups[g].timeRange.to===null||job.timeRange.to>groups[g].timeRange.to){groups[g].timeRange.to=job.timeRange.to;groups[g].timeRange.toMoment=job.timeRange.toMoment}if(groups[g].timeRange.from===null||job.timeRange.from<groups[g].timeRange.from){groups[g].timeRange.from=job.timeRange.from;groups[g].timeRange.fromMoment=job.timeRange.fromMoment}if(groups[g].timeRange.toPx===null||job.timeRange.toPx>groups[g].timeRange.toPx){groups[g].timeRange.toPx=job.timeRange.toPx}if(groups[g].timeRange.fromPx===null||job.timeRange.fromPx<groups[g].timeRange.fromPx){groups[g].timeRange.fromPx=job.timeRange.fromPx}}})}});Object.keys(groups).forEach(groupId=>{const group=groups[groupId];group.timeRange.widthPx=group.timeRange.toPx-group.timeRange.fromPx;group.timeRange.toMoment=moment__WEBPACK_IMPORTED_MODULE_1___default()(group.timeRange.to);group.timeRange.fromMoment=moment__WEBPACK_IMPORTED_MODULE_1___default()(group.timeRange.from);const fromString=group.timeRange.fromMoment.format("MMM Do YYYY, HH:mm");const toString=group.timeRange.toMoment.format("MMM Do YYYY, HH:mm");group.timeRange.label=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.jobSelectList.groupTimeRangeLabel",{defaultMessage:"{fromString} to {toString}",values:{fromString:fromString,toString:toString}})});return{groups:Object.keys(groups).map(g=>groups[g]),groupsMap:groupsMap}}function getTimeRangeFromSelection(jobs,selection){if(jobs.length>0){const times=[];jobs.forEach(job=>{if(selection.includes(job.job_id)){if(job.timeRange.from!==undefined){times.push(job.timeRange.from)}if(job.timeRange.to!==undefined){times.push(job.timeRange.to)}}});if(times.length){const extent=d3__WEBPACK_IMPORTED_MODULE_2___default.a.extent(times);const selectedTime={from:moment__WEBPACK_IMPORTED_MODULE_1___default()(extent[0]).toISOString(),to:moment__WEBPACK_IMPORTED_MODULE_1___default()(extent[1]).toISOString()};return selectedTime}}}function normalizeTimes(jobs,dateFormatTz,ganttBarWidth){const jobsWithTimeRange=jobs.filter(job=>job.timeRange.to!==undefined&&job.timeRange.from!==undefined);const min=Math.min(...jobsWithTimeRange.map(job=>+job.timeRange.from));const max=Math.max(...jobsWithTimeRange.map(job=>+job.timeRange.to));const ganttScale=d3__WEBPACK_IMPORTED_MODULE_2___default.a.scale.linear().domain([min,max]).range([1,ganttBarWidth]);jobs.forEach(job=>{if(job.timeRange.to!==undefined&&job.timeRange.from!==undefined){job.timeRange.fromPx=ganttScale(job.timeRange.from);job.timeRange.toPx=ganttScale(job.timeRange.to);job.timeRange.widthPx=job.timeRange.toPx-job.timeRange.fromPx;if(job.timeRange.widthPx<1){job.timeRange.widthPx=1}job.timeRange.toMoment=moment__WEBPACK_IMPORTED_MODULE_1___default()(job.timeRange.to).tz(dateFormatTz);job.timeRange.fromMoment=moment__WEBPACK_IMPORTED_MODULE_1___default()(job.timeRange.from).tz(dateFormatTz);const fromString=job.timeRange.fromMoment.format("MMM Do YYYY, HH:mm");const toString=job.timeRange.toMoment.format("MMM Do YYYY, HH:mm");job.timeRange.label=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.jobSelector.jobTimeRangeLabel",{defaultMessage:"{fromString} to {toString}",values:{fromString:fromString,toString:toString}})}else{job.timeRange.widthPx=0;job.timeRange.fromPx=0;job.timeRange.toPx=0;job.timeRange.label=_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.jobSelector.noResultsForJobLabel",{defaultMessage:"No results"})}});return jobs}},,,,,,,,,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return getTaskStateBadge}));__webpack_require__.d(__webpack_exports__,"a",(function(){return getJobTypeBadge}));__webpack_require__.d(__webpack_exports__,"c",(function(){return progressColumn}));__webpack_require__.d(__webpack_exports__,"d",(function(){return useColumns}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(34);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(33);var common=__webpack_require__(66);var analytics_list_common=__webpack_require__(88);var check_capabilities=__webpack_require__(63);var delete_job_check_modal=__webpack_require__(271);var action_clone=__webpack_require__(393);var action_delete=__webpack_require__(386);var kibana=__webpack_require__(58);var ml_api_service=__webpack_require__(59);var toast_notification_service=__webpack_require__(72);var validators=__webpack_require__(14);var analytics=__webpack_require__(62);let mmLValidator;const EditActionFlyout=({closeFlyout:closeFlyout,item:item})=>{const{id:jobId,config:config}=item;const{state:state}=item.stats;const initialAllowLazyStart=config.allow_lazy_start!==undefined?String(config.allow_lazy_start):"";const[allowLazyStart,setAllowLazyStart]=Object(external_kbnSharedDeps_React_["useState"])(initialAllowLazyStart);const[description,setDescription]=Object(external_kbnSharedDeps_React_["useState"])(config.description||"");const[modelMemoryLimit,setModelMemoryLimit]=Object(external_kbnSharedDeps_React_["useState"])(config.model_memory_limit);const[mmlValidationError,setMmlValidationError]=Object(external_kbnSharedDeps_React_["useState"])();const[maxNumThreads,setMaxNumThreads]=Object(external_kbnSharedDeps_React_["useState"])(config.max_num_threads);const{services:{notifications:notifications}}=Object(kibana["b"])();const{refresh:refresh}=Object(analytics["J"])();const toastNotificationService=Object(toast_notification_service["c"])();const updateButtonDisabled=mmlValidationError!==undefined||maxNumThreads===0;Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(mmLValidator===undefined){mmLValidator=Object(validators["c"])()}if(modelMemoryLimit!==""){const validationResult=mmLValidator(modelMemoryLimit);if(validationResult!==null&&validationResult.invalidUnits){setMmlValidationError(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.modelMemoryUnitsInvalidError",{defaultMessage:"Model memory limit data unit unrecognized. It must be {str}",values:{str:validationResult.invalidUnits.allowedUnits}}))}else{setMmlValidationError(undefined)}}else{setMmlValidationError(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.modelMemoryEmptyError",{defaultMessage:"Model memory limit must not be empty"}))}},[modelMemoryLimit]);const onSubmit=async()=>{const updateConfig=Object.assign({allow_lazy_start:allowLazyStart,description:description},modelMemoryLimit&&{model_memory_limit:modelMemoryLimit},maxNumThreads&&{max_num_threads:maxNumThreads});try{await ml_api_service["ml"].dataFrameAnalytics.updateDataFrameAnalytics(jobId,updateConfig);notifications.toasts.addSuccess(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.editFlyoutSuccessMessage",{defaultMessage:"Analytics job {jobId} has been updated.",values:{jobId:jobId}}));refresh();closeFlyout()}catch(e){console.error(e);toastNotificationService.displayErrorToast(e,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.editFlyoutErrorMessage",{defaultMessage:"Could not save changes to analytics job {jobId}",values:{jobId:jobId}}))}};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiOverlayMask"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyout"],{onClose:closeFlyout,hideCloseButton:true,"aria-labelledby":"analyticsEditFlyoutTitle","data-test-subj":"mlAnalyticsEditFlyout"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutHeader"],{hasBorder:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"m"},external_kbnSharedDeps_React_default.a.createElement("h2",{id:"analyticsEditFlyoutTitle"},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.editFlyoutTitle",{defaultMessage:"Edit {jobId}",values:{jobId:jobId}})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiForm"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.editFlyout.allowLazyStartLabel",{defaultMessage:"Allow lazy start"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.editFlyout.allowLazyStartAriaLabel",{defaultMessage:"Update allow lazy start."}),"data-test-subj":"mlAnalyticsEditFlyoutAllowLazyStartInput",options:[{value:"true",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.editFlyout.allowLazyStartTrueValue",{defaultMessage:"True"})},{value:"false",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.editFlyout.allowLazyStartFalseValue",{defaultMessage:"False"})}],value:allowLazyStart,onChange:e=>setAllowLazyStart(e.target.value)})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.editFlyout.descriptionLabel",{defaultMessage:"Description"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{"data-test-subj":"mlAnalyticsEditFlyoutDescriptionInput",value:description,onChange:e=>setDescription(e.target.value),"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.editFlyout.descriptionAriaLabel",{defaultMessage:"Update the job description."})})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{helpText:state!==analytics_list_common["b"].STOPPED&&external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.editFlyout.modelMemoryHelpText",{defaultMessage:"Model memory limit cannot be edited until the job has stopped."}),label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.editFlyout.modelMemoryLimitLabel",{defaultMessage:"Model memory limit"}),isInvalid:mmlValidationError!==undefined,error:mmlValidationError},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{"data-test-subj":"mlAnalyticsEditFlyoutmodelMemoryLimitInput",isInvalid:mmlValidationError!==undefined,readOnly:state!==analytics_list_common["b"].STOPPED,value:modelMemoryLimit,onChange:e=>setModelMemoryLimit(e.target.value),"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.editFlyout.modelMemoryLimitAriaLabel",{defaultMessage:"Update the model memory limit."})})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{helpText:state!==analytics_list_common["b"].STOPPED&&external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.editFlyout.maxNumThreadsHelpText",{defaultMessage:"Maximum number of threads cannot be edited until the job has stopped."}),label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.editFlyout.maxNumThreadsLabel",{defaultMessage:"Maximum number of threads"}),isInvalid:maxNumThreads===0,error:maxNumThreads===0&&external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.editFlyout.maxNumThreadsError",{defaultMessage:"The minimum value is 1."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.editFlyout.maxNumThreadsAriaLabel",{defaultMessage:"Update the maximum number of threads to be used by the analysis."}),"data-test-subj":"mlAnalyticsEditFlyoutMaxNumThreadsLimitInput",onChange:e=>setMaxNumThreads(e.target.value===""?undefined:+e.target.value),step:1,min:1,readOnly:state!==analytics_list_common["b"].STOPPED,value:maxNumThreads})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutFooter"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{iconType:"cross",onClick:closeFlyout,flush:"left"},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.editFlyoutCancelButtonText",{defaultMessage:"Cancel"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{"data-test-subj":"mlAnalyticsEditFlyoutUpdateButton",onClick:onSubmit,fill:true,isDisabled:updateButtonDisabled},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.editFlyoutUpdateButtonText",{defaultMessage:"Update"})))))))};const editActionNameText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.editActionNameText",{defaultMessage:"Edit"});const EditActionName=({isDisabled:isDisabled})=>{if(isDisabled){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{position:"top",content:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.editActionPermissionTooltip",{defaultMessage:"You do not have permission to edit analytics jobs."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,editActionNameText))}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,editActionNameText)};const isEditActionFlyoutVisible=editAction=>editAction.isFlyoutVisible===true&&editAction.item!==undefined;const useEditAction=canStartStopDataFrameAnalytics=>{const[item,setItem]=Object(external_kbnSharedDeps_React_["useState"])();const[isFlyoutVisible,setIsFlyoutVisible]=Object(external_kbnSharedDeps_React_["useState"])(false);const closeFlyout=()=>setIsFlyoutVisible(false);const openFlyout=newItem=>{setItem(newItem);setIsFlyoutVisible(true)};const action=Object(external_kbnSharedDeps_React_["useMemo"])(()=>({name:()=>external_kbnSharedDeps_React_default.a.createElement(EditActionName,{isDisabled:!canStartStopDataFrameAnalytics}),enabled:()=>canStartStopDataFrameAnalytics,description:editActionNameText,icon:"pencil",type:"icon",onClick:i=>openFlyout(i),"data-test-subj":"mlAnalyticsJobEditButton"}),[canStartStopDataFrameAnalytics]);return{action:action,isFlyoutVisible:isFlyoutVisible,item:item,closeFlyout:closeFlyout,openFlyout:openFlyout}};var analytics_service=__webpack_require__(172);const startActionNameText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.startActionNameText",{defaultMessage:"Start"});const StartActionName=({canStartStopDataFrameAnalytics:canStartStopDataFrameAnalytics,isDisabled:isDisabled,item:item})=>{if(isDisabled){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{position:"top",content:!canStartStopDataFrameAnalytics?Object(check_capabilities["f"])("canStartStopDataFrameAnalytics"):external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.completeBatchAnalyticsToolTip",{defaultMessage:"{analyticsId} is a completed analytics job and cannot be restarted.",values:{analyticsId:item.config.id}})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,startActionNameText))}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,startActionNameText)};const useStartAction=canStartStopDataFrameAnalytics=>{const[isModalVisible,setModalVisible]=Object(external_kbnSharedDeps_React_["useState"])(false);const[item,setItem]=Object(external_kbnSharedDeps_React_["useState"])();const toastNotificationService=Object(toast_notification_service["c"])();const closeModal=()=>setModalVisible(false);const startAndCloseModal=()=>{if(item!==undefined){setModalVisible(false);Object(analytics_service["e"])(item,toastNotificationService)}};const openModal=newItem=>{setItem(newItem);setModalVisible(true)};const startButtonEnabled=i=>{if(!Object(analytics_list_common["g"])(i.stats.state)){const completeAnalytics=Object(analytics_list_common["e"])(i.stats);return canStartStopDataFrameAnalytics&&!completeAnalytics}return canStartStopDataFrameAnalytics};const action=Object(external_kbnSharedDeps_React_["useMemo"])(()=>({name:i=>external_kbnSharedDeps_React_default.a.createElement(StartActionName,{isDisabled:!startButtonEnabled(i),item:i,canStartStopDataFrameAnalytics:canStartStopDataFrameAnalytics}),available:i=>!Object(analytics_list_common["g"])(i.stats.state)&&!Object(analytics_list_common["f"])(i.stats.state),enabled:startButtonEnabled,description:startActionNameText,icon:"play",type:"icon",onClick:openModal,"data-test-subj":"mlAnalyticsJobStartButton"}),[]);return{action:action,closeModal:closeModal,isModalVisible:isModalVisible,item:item,openModal:openModal,startAndCloseModal:startAndCloseModal}};const StartActionModal=({closeModal:closeModal,item:item,startAndCloseModal:startAndCloseModal})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,item!==undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiConfirmModal"],{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.startModalTitle",{defaultMessage:"Start {analyticsId}?",values:{analyticsId:item.config.id}}),onCancel:closeModal,onConfirm:startAndCloseModal,cancelButtonText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.startModalCancelButton",{defaultMessage:"Cancel"}),confirmButtonText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.startModalStartButton",{defaultMessage:"Start"}),defaultFocusedButton:external_kbnSharedDeps_ElasticEui_["EUI_MODAL_CONFIRM_BUTTON"],buttonColor:"primary"},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.startModalBody",{defaultMessage:"A data frame analytics job increases search and indexing load in your cluster. If excessive load occurs, stop the job."}))));const stopActionNameText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.stopActionNameText",{defaultMessage:"Stop"});const StopActionName=({isDisabled:isDisabled})=>{if(isDisabled){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{position:"top",content:Object(check_capabilities["f"])("canStartStopDataFrameAnalytics")},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,stopActionNameText))}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,stopActionNameText)};const useStopAction=canStartStopDataFrameAnalytics=>{const[isModalVisible,setModalVisible]=Object(external_kbnSharedDeps_React_["useState"])(false);const[item,setItem]=Object(external_kbnSharedDeps_React_["useState"])();const closeModal=()=>setModalVisible(false);const forceStopAndCloseModal=()=>{if(item!==undefined){setModalVisible(false);Object(analytics_service["f"])(item)}};const openModal=newItem=>{setItem(newItem);setModalVisible(true)};const clickHandler=Object(external_kbnSharedDeps_React_["useCallback"])(i=>{if(canStartStopDataFrameAnalytics){if(Object(analytics_list_common["f"])(i.stats.state)){openModal(i)}else{Object(analytics_service["f"])(i)}}},[analytics_service["f"]]);const action=Object(external_kbnSharedDeps_React_["useMemo"])(()=>({name:()=>external_kbnSharedDeps_React_default.a.createElement(StopActionName,{isDisabled:!canStartStopDataFrameAnalytics}),available:i=>Object(analytics_list_common["g"])(i.stats.state)||Object(analytics_list_common["f"])(i.stats.state),enabled:()=>canStartStopDataFrameAnalytics,description:stopActionNameText,icon:"stop",type:"icon",onClick:clickHandler,"data-test-subj":"mlAnalyticsJobStopButton"}),[clickHandler]);return{action:action,closeModal:closeModal,isModalVisible:isModalVisible,item:item,openModal:openModal,forceStopAndCloseModal:forceStopAndCloseModal}};const StopActionModal=({closeModal:closeModal,item:item,forceStopAndCloseModal:forceStopAndCloseModal})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,item!==undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiConfirmModal"],{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.forceStopModalTitle",{defaultMessage:"Force this job to stop?"}),onCancel:closeModal,onConfirm:forceStopAndCloseModal,cancelButtonText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.forceStopModalCancelButton",{defaultMessage:"Cancel"}),confirmButtonText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.forceStopModalStartButton",{defaultMessage:"Force stop"}),defaultFocusedButton:external_kbnSharedDeps_ElasticEui_["EUI_MODAL_CONFIRM_BUTTON"],buttonColor:"primary"},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analyticsList.forceStopModalBody",defaultMessage:"{analyticsId} is in a failed state. You must stop the job and fix the failure.",values:{analyticsId:item.config.id}}))));var get_view_link_status=__webpack_require__(191);const viewActionButtonText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.viewActionName",{defaultMessage:"View"});const ViewButton=({item:item})=>{const{disabled:disabled,tooltipContent:tooltipContent}=Object(get_view_link_status["a"])(item);if(disabled){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{position:"top",content:tooltipContent},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,viewActionButtonText))}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,viewActionButtonText)};var ml_url_generator=__webpack_require__(0);const useViewAction=()=>{const mlUrlGenerator=Object(kibana["d"])();const navigateToPath=Object(kibana["e"])();const redirectToTab=async(jobId,analysisType)=>{const path=await mlUrlGenerator.createUrl({page:ml_url_generator["b"].DATA_FRAME_ANALYTICS_EXPLORATION,pageState:{jobId:jobId,analysisType:analysisType}});await navigateToPath(path,false)};const clickHandler=Object(external_kbnSharedDeps_React_["useCallback"])(item=>{const analysisType=Object(analytics["r"])(item.config.analysis);redirectToTab(item.id,analysisType)},[]);const action=Object(external_kbnSharedDeps_React_["useMemo"])(()=>({isPrimary:true,name:item=>external_kbnSharedDeps_React_default.a.createElement(ViewButton,{item:item}),enabled:item=>!Object(get_view_link_status["a"])(item).disabled,description:viewActionButtonText,icon:"visTable",type:"icon",onClick:clickHandler,"data-test-subj":"mlAnalyticsJobViewButton"}),[clickHandler]);return{action:action}};const mapActionButtonText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.mapActionName",{defaultMessage:"Map"});const MapButton=({item:item})=>{const disabled=!Object(analytics["D"])(item.config.analysis)&&!Object(analytics["C"])(item.config.analysis)&&!Object(analytics["A"])(item.config.analysis);if(disabled){const toolTipContent=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.mapActionDisabledTooltipContent",{defaultMessage:"Unknown analysis type."});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{position:"top",content:toolTipContent},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,mapActionButtonText))}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,mapActionButtonText)};const useMapAction=()=>{const mlUrlGenerator=Object(kibana["d"])();const navigateToPath=Object(kibana["e"])();const clickHandler=Object(external_kbnSharedDeps_React_["useCallback"])(async item=>{const path=await mlUrlGenerator.createUrl({page:ml_url_generator["b"].DATA_FRAME_ANALYTICS_MAP,pageState:{jobId:item.id}});await navigateToPath(path,false)},[]);const action=Object(external_kbnSharedDeps_React_["useMemo"])(()=>({isPrimary:true,name:item=>external_kbnSharedDeps_React_default.a.createElement(MapButton,{item:item}),enabled:item=>!Object(get_view_link_status["a"])(item).disabled,description:mapActionButtonText,icon:"graphApp",type:"icon",onClick:clickHandler,"data-test-subj":"mlAnalyticsJobMapButton"}),[clickHandler]);return{action:action}};const useActions=isManagementTable=>{const canCreateDataFrameAnalytics=Object(check_capabilities["e"])("canCreateDataFrameAnalytics");const canDeleteDataFrameAnalytics=Object(check_capabilities["e"])("canDeleteDataFrameAnalytics");const canStartStopDataFrameAnalytics=Object(check_capabilities["e"])("canStartStopDataFrameAnalytics");const viewAction=useViewAction();const mapAction=useMapAction();const cloneAction=Object(action_clone["c"])(canCreateDataFrameAnalytics);const deleteAction=Object(action_delete["b"])(canDeleteDataFrameAnalytics);const editAction=useEditAction(canStartStopDataFrameAnalytics);const startAction=useStartAction(canStartStopDataFrameAnalytics);const stopAction=useStopAction(canStartStopDataFrameAnalytics);const{refresh:refresh}=Object(analytics["J"])();let modals=null;const actions=[viewAction.action,mapAction.action];if(isManagementTable===false){var _deleteAction$item;modals=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,startAction.isModalVisible&&external_kbnSharedDeps_React_default.a.createElement(StartActionModal,startAction),stopAction.isModalVisible&&external_kbnSharedDeps_React_default.a.createElement(StopActionModal,stopAction),deleteAction.isDeleteJobCheckModalVisible&&(deleteAction===null||deleteAction===void 0?void 0:(_deleteAction$item=deleteAction.item)===null||_deleteAction$item===void 0?void 0:_deleteAction$item.config)&&external_kbnSharedDeps_React_default.a.createElement(delete_job_check_modal["a"],{onCloseCallback:deleteAction.closeDeleteJobCheckModal,canDeleteCallback:()=>{deleteAction.openModal(deleteAction.item);deleteAction.closeDeleteJobCheckModal()},refreshJobsCallback:refresh,jobType:deleteAction.jobType,jobIds:[deleteAction.item.config.id]}),deleteAction.isModalVisible&&external_kbnSharedDeps_React_default.a.createElement(action_delete["a"],deleteAction),isEditActionFlyoutVisible(editAction)&&external_kbnSharedDeps_React_default.a.createElement(EditActionFlyout,editAction));actions.push(...[startAction.action,stopAction.action,editAction.action,cloneAction.action,deleteAction.action])}return{actions:actions,modals:modals}};var job_spaces_list=__webpack_require__(390);var TASK_STATE_COLOR;(function(TASK_STATE_COLOR){TASK_STATE_COLOR["analyzing"]="primary";TASK_STATE_COLOR["failed"]="danger";TASK_STATE_COLOR["reindexing"]="primary";TASK_STATE_COLOR["started"]="primary";TASK_STATE_COLOR["starting"]="primary";TASK_STATE_COLOR["stopped"]="hollow"})(TASK_STATE_COLOR||(TASK_STATE_COLOR={}));const getTaskStateBadge=(state,failureReason)=>{const color=TASK_STATE_COLOR[state];if(Object(analytics_list_common["f"])(state)&&failureReason!==undefined){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{content:failureReason},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBadge"],{className:"mlTaskStateBadge",color:color},state))}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBadge"],{className:"mlTaskStateBadge",color:color},state)};const getJobTypeBadge=jobType=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBadge"],{className:"mlTaskStateBadge",color:"hollow"},jobType);const progressColumn={name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.progress",{defaultMessage:"Progress"}),truncateText:true,render(item){const{currentPhase:currentPhase,progress:progress,totalPhases:totalPhases}=Object(analytics_list_common["d"])(item.stats);const isBatchTransform=true;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center",gutterSize:"xs"},isBatchTransform&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{style:{width:"60px"},grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs"},"Phase ",currentPhase,"/",totalPhases)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{style:{width:"40px"},grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{content:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.progressOfPhase",{defaultMessage:"Progress of phase {currentPhase}: {progress}%",values:{currentPhase:currentPhase,progress:progress}})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiProgress"],{value:progress,max:100,color:"primary",size:"m","data-test-subj":"mlAnalyticsTableProgress"})))),!isBatchTransform&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{style:{width:"40px"},grow:false},Object(analytics_list_common["g"])(item.stats.state)&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiProgress"],{color:"primary",size:"m"}),Object(analytics_list_common["i"])(item.stats.state)&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiProgress"],{value:0,max:100,color:"primary",size:"m"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{style:{width:"35px"},grow:false}," ")))},width:"130px","data-test-subj":"mlAnalyticsTableColumnProgress"};const DFAnalyticsJobIdLink=({jobId:jobId})=>{const href=Object(kibana["c"])({page:ml_url_generator["b"].DATA_FRAME_ANALYTICS_JOBS_MANAGE,pageState:{jobId:jobId}});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{href:href},jobId)};const useColumns=(expandedRowItemIds,setExpandedRowItemIds,isManagementTable=false,isMlEnabledInSpace=true,spacesApi,refresh=(()=>{}))=>{const{actions:actions,modals:modals}=useActions(isManagementTable);function toggleDetails(item){const index=expandedRowItemIds.indexOf(item.config.id);if(index!==-1){expandedRowItemIds.splice(index,1);setExpandedRowItemIds([...expandedRowItemIds])}else{expandedRowItemIds.push(item.config.id)}setExpandedRowItemIds([...expandedRowItemIds])}const columns=[{name:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiScreenReaderOnly"],null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analyticsList.showDetailsColumn.screenReaderDescription",defaultMessage:"This column contains clickable controls for showing more details on each job"}))),align:external_kbnSharedDeps_ElasticEui_["RIGHT_ALIGNMENT"],width:"40px",isExpander:true,render:item=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{onClick:()=>toggleDetails(item),"aria-label":expandedRowItemIds.includes(item.config.id)?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.rowCollapse",{defaultMessage:"Hide details for {analyticsId}",values:{analyticsId:item.config.id}}):external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.rowExpand",{defaultMessage:"Show details for {analyticsId}",values:{analyticsId:item.config.id}}),iconType:expandedRowItemIds.includes(item.config.id)?"arrowUp":"arrowDown"}),"data-test-subj":"mlAnalyticsTableRowDetailsToggle"},{field:analytics_list_common["c"].id,name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.id",{defaultMessage:"ID"}),sortable:item=>item.id,truncateText:true,"data-test-subj":"mlAnalyticsTableColumnId",scope:"row",render:jobId=>isManagementTable?external_kbnSharedDeps_React_default.a.createElement(DFAnalyticsJobIdLink,{jobId:jobId}):jobId},{field:analytics_list_common["c"].description,name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.description",{defaultMessage:"Description"}),sortable:true,truncateText:true,"data-test-subj":"mlAnalyticsTableColumnJobDescription"},{field:analytics_list_common["c"].memoryStatus,name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.memoryStatus",{defaultMessage:"Memory status"}),truncateText:true,"data-test-subj":"mlAnalyticsTableColumnJobMemoryStatus"},{field:analytics_list_common["c"].configSourceIndex,name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.sourceIndex",{defaultMessage:"Source index"}),sortable:true,truncateText:true,"data-test-subj":"mlAnalyticsTableColumnSourceIndex"},{field:analytics_list_common["c"].configDestIndex,name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.destinationIndex",{defaultMessage:"Destination index"}),sortable:true,truncateText:true,"data-test-subj":"mlAnalyticsTableColumnDestIndex"},{name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.type",{defaultMessage:"Type"}),sortable:item=>Object(common["t"])(item.config.analysis),truncateText:true,render(item){return getJobTypeBadge(Object(common["t"])(item.config.analysis))},width:"150px","data-test-subj":"mlAnalyticsTableColumnType"},{name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.status",{defaultMessage:"Status"}),sortable:item=>item.stats.state,truncateText:true,render(item){return getTaskStateBadge(item.stats.state,item.stats.failure_reason)},width:"100px","data-test-subj":"mlAnalyticsTableColumnStatus"},progressColumn,{name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.tableActionLabel",{defaultMessage:"Actions"}),actions:actions,width:isManagementTable===true?"100px":"150px","data-test-subj":"mlAnalyticsTableColumnActions"}];if(isManagementTable===true){if(spacesApi){columns.splice(columns.length-1,0,{name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.analyticsSpacesLabel",{defaultMessage:"Spaces"}),render:item=>{var _item$spaceIds;return Array.isArray(item.spaceIds)?external_kbnSharedDeps_React_default.a.createElement(job_spaces_list["a"],{spacesApi:spacesApi,spaceIds:(_item$spaceIds=item.spaceIds)!==null&&_item$spaceIds!==void 0?_item$spaceIds:[],jobId:item.id,jobType:"data-frame-analytics",refresh:refresh}):null},width:"90px"})}if(isMlEnabledInSpace===false){columns.pop()}}return{columns:columns,modals:modals}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return getDefaultDFAListState}));__webpack_require__.d(__webpack_exports__,"a",(function(){return Page}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(34);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(33);var external_kbnSharedDeps_ReactRouterDom_=__webpack_require__(39);var url_state=__webpack_require__(70);var navigation_menu=__webpack_require__(94);var date_picker_wrapper=__webpack_require__(174);var analytics_list=__webpack_require__(382);var kibana=__webpack_require__(58);var jobs_list=__webpack_require__(181);var common=__webpack_require__(66);const useRefreshInterval=setBlockRefresh=>{const{services:services}=Object(kibana["b"])();const{timefilter:timefilter}=services.data.query.timefilter;const{refresh:refresh}=Object(common["I"])();Object(external_kbnSharedDeps_React_["useEffect"])(()=>{let analyticsRefreshInterval=null;const refreshIntervalSubscription=timefilter.getRefreshIntervalUpdate$().subscribe(setAutoRefresh);timefilter.disableTimeRangeSelector();timefilter.enableAutoRefreshSelector();initAutoRefresh();function initAutoRefresh(){const{value:value}=timefilter.getRefreshInterval();if(value===0){timefilter.setRefreshInterval({pause:false,value:jobs_list["a"]})}setAutoRefresh()}function setAutoRefresh(){const{value:value,pause:pause}=timefilter.getRefreshInterval();if(pause){clearRefreshInterval()}else{setRefreshInterval(value)}refresh()}function setRefreshInterval(interval){clearRefreshInterval();if(interval>=jobs_list["c"]){setBlockRefresh(false);const intervalId=window.setInterval(()=>{refresh()},interval);analyticsRefreshInterval=intervalId}}function clearRefreshInterval(){setBlockRefresh(true);if(analyticsRefreshInterval!==null){window.clearInterval(analyticsRefreshInterval)}}return()=>{refreshIntervalSubscription.unsubscribe();clearRefreshInterval()}},[])};var refresh_analytics_list_button=__webpack_require__(387);var node_available_warning=__webpack_require__(267);var saved_objects_warning=__webpack_require__(268);var upgrade=__webpack_require__(269);const AnalyticsNavigationBar=({jobId:jobId,modelId:modelId,selectedTabId:selectedTabId})=>{const navigateToPath=Object(kibana["e"])();const tabs=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{const navTabs=[{id:"data_frame_analytics",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.jobsTabLabel",{defaultMessage:"Jobs"}),path:"/data_frame_analytics"},{id:"models",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.modelsTabLabel",{defaultMessage:"Models"}),path:"/data_frame_analytics/models"}];if(jobId!==undefined||modelId!==undefined){navTabs.push({id:"map",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.mapTabLabel",{defaultMessage:"Map"}),path:"/data_frame_analytics/map"})}return navTabs},[jobId!==undefined]);const onTabClick=Object(external_kbnSharedDeps_React_["useCallback"])(async tab=>{await navigateToPath(tab.path,true)},[navigateToPath]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTabs"],null,tabs.map(tab=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTab"],{key:`tab-${tab.id}`,isSelected:tab.id===selectedTabId,onClick:onTabClick.bind(null,tab)},tab.name)))};var stats_bar=__webpack_require__(173);var trained_models=__webpack_require__(225);const DeleteModelsModal=({models:models,onClose:onClose})=>{const modelsWithPipelines=models.filter(model=>!!model.pipelines).map(model=>model.model_id);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModal"],{onClose:onClose.bind(null,false),initialFocus:"[name=cancelModelDeletion]"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalHeaderTitle"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.trainedModels.modelsList.deleteModal.header",defaultMessage:"Delete {modelsCount, plural, one {{modelId}} other {# models}}?",values:{modelId:models[0].model_id,modelsCount:models.length}}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalBody"],null,modelsWithPipelines.length>0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{"data-test-subj":"modelsWithPipelinesWarning",color:"danger",iconType:"alert",size:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.trainedModels.modelsList.deleteModal.modelsWithPipelinesWarningMessage",defaultMessage:"{modelsWithPipelinesCount, plural, one{Model} other {Models}} {modelsWithPipelines} {modelsWithPipelinesCount, plural, one{has} other {have}} associated pipelines!",values:{modelsWithPipelinesCount:modelsWithPipelines.length,modelsWithPipelines:modelsWithPipelines.join(", ")}}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalFooter"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:onClose.bind(null,false),name:"cancelModelDeletion"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.trainedModels.modelsList.deleteModal.cancelButtonLabel",defaultMessage:"Cancel"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:onClose.bind(null,true),fill:true,color:"danger"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.trainedModels.modelsList.deleteModal.deleteButtonLabel",defaultMessage:"Delete"}))))};var date_utils=__webpack_require__(67);const formatterDictionary={tags:tags=>{if(tags.length===0)return;return external_kbnSharedDeps_React_default.a.createElement("div",null,tags.map(tag=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBadge"],{key:tag,color:"hollow"},tag)))},create_time:date_utils["d"],timestamp:date_utils["d"]};const ExpandedRow=({item:item})=>{var _stats$ingest,_stats$ingest2;const{inference_config:inferenceConfig,stats:stats,metadata:metadata,tags:tags,version:version,estimated_operations:estimated_operations,estimated_heap_memory_usage_bytes:estimated_heap_memory_usage_bytes,default_field_map:default_field_map,license_level:license_level,pipelines:pipelines,description:description}=item;const details={description:description,tags:tags,version:version,estimated_operations:estimated_operations,estimated_heap_memory_usage_bytes:estimated_heap_memory_usage_bytes,default_field_map:default_field_map,license_level:license_level};function formatToListItems(items){return Object.entries(items).map(([title,value])=>{if(title in formatterDictionary){return{title:title,description:formatterDictionary[title](value)}}return{title:title,description:typeof value==="object"?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCodeBlock"],{language:"json",fontSize:"s",paddingSize:"s",overflowHeight:300,isCopyable:false},JSON.stringify(value,null,2)):value}}).filter(({description:d})=>d!==undefined)}const{services:{share:share,application:{navigateToUrl:navigateToUrl}}}=Object(kibana["b"])();const tabs=[{id:"details",name:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.trainedModels.modelsList.expandedRow.detailsTabLabel",defaultMessage:"Details"}),content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGrid"],{columns:2,gutterSize:"m"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h5",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.trainedModels.modelsList.expandedRow.detailsTitle",defaultMessage:"Details"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{compressed:true,type:"column",listItems:formatToListItems(details)})))))},...inferenceConfig?[{id:"config",name:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.trainedModels.modelsList.expandedRow.configTabLabel",defaultMessage:"Config"}),content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGrid"],{columns:2,gutterSize:"m"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h5",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.trainedModels.modelsList.expandedRow.inferenceConfigTitle",defaultMessage:"Inference configuration"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{compressed:true,type:"column",listItems:formatToListItems(inferenceConfig[Object.keys(inferenceConfig)[0]])}))),(metadata===null||metadata===void 0?void 0:metadata.analytics_config)&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h5",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.trainedModels.modelsList.expandedRow.analyticsConfigTitle",defaultMessage:"Analytics configuration"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{compressed:true,type:"column",listItems:formatToListItems(metadata.analytics_config)})))))}]:[],{id:"stats",name:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.trainedModels.modelsList.expandedRow.statsTabLabel",defaultMessage:"Stats"}),content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGrid"],{columns:2},stats.inference_stats&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h5",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.trainedModels.modelsList.expandedRow.inferenceStatsTitle",defaultMessage:"Inference stats"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{compressed:true,type:"column",listItems:formatToListItems(stats.inference_stats)}))),((_stats$ingest=stats.ingest)===null||_stats$ingest===void 0?void 0:_stats$ingest.total)&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],{style:{maxHeight:"400px",overflow:"auto"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h5",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.trainedModels.modelsList.expandedRow.ingestStatsTitle",defaultMessage:"Ingest stats"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{compressed:true,type:"column",listItems:formatToListItems(stats.ingest.total)}),((_stats$ingest2=stats.ingest)===null||_stats$ingest2===void 0?void 0:_stats$ingest2.pipelines)&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h5",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.trainedModels.modelsList.expandedRow.byPipelineTitle",defaultMessage:"By pipeline"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),Object.entries(stats.ingest.pipelines).map(([pipelineName,{processors:processors,...pipelineStats}],i)=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],{key:pipelineName},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTextColor"],{color:"subdued"},external_kbnSharedDeps_React_default.a.createElement("h5",null,i+1,". ",pipelineName)))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{size:"full",margin:"s"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{compressed:true,type:"column",listItems:formatToListItems(pipelineStats)}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xxs"},external_kbnSharedDeps_React_default.a.createElement("h6",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.trainedModels.modelsList.expandedRow.byProcessorTitle",defaultMessage:"By processor"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,processors.map(processor=>{const name=Object.keys(processor)[0];const{stats:processorStats}=processor[name];return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],{key:name},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xxs"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTextColor"],{color:"subdued"},external_kbnSharedDeps_React_default.a.createElement("h6",null,name)))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{size:"full",margin:"s"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{compressed:true,type:"column",listItems:formatToListItems(processorStats)}))})))))))))},...pipelines&&Object.keys(pipelines).length>0?[{id:"pipelines",name:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.trainedModels.modelsList.expandedRow.pipelinesTabLabel",defaultMessage:"Pipelines"})," ",external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiNotificationBadge"],null,stats.pipeline_count)),content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGrid"],{columns:2,gutterSize:"m"},Object.entries(pipelines).map(([pipelineName,{processors:processors,description:pipelineDescription}])=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{key:pipelineName},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center",justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h5",null,pipelineName))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:async()=>{const ingestPipelinesAppUrlGenerator=share.urlGenerators.getUrlGenerator("INGEST_PIPELINES_APP_URL_GENERATOR");await navigateToUrl(await ingestPipelinesAppUrlGenerator.createUrl({page:"pipeline_edit",pipelineId:pipelineName,absolute:true}))}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.trainedModels.modelsList.expandedRow.editPipelineLabel",defaultMessage:"Edit"})))),pipelineDescription&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,pipelineDescription),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xxs"},external_kbnSharedDeps_React_default.a.createElement("h6",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.trainedModels.modelsList.expandedRow.processorsTitle",defaultMessage:"Processors"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCodeBlock"],{language:"painless",fontSize:"m",paddingSize:"m",overflowHeight:300,isCopyable:true},JSON.stringify(processors,null,2)))))))}]:[]];return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTabbedContent"],{size:"s",style:{width:"100%"},tabs:tabs,initialSelectedTab:tabs[0],autoFocus:"selected",onTabClick:tab=>{}})};var ml_url_generator=__webpack_require__(0);var data_frame_analytics=__webpack_require__(74);const getDefaultModelsListState=()=>({pageIndex:0,pageSize:10,sortField:ModelsTableToConfigMapping.id,sortDirection:"asc"});const BUILT_IN_MODEL_TYPE=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.trainedModels.modelsList.builtInModelLabel",{defaultMessage:"built-in"});const ModelsList=()=>{var _pageState$queryText;const{services:{application:{navigateToUrl:navigateToUrl,capabilities:capabilities}}}=Object(kibana["b"])();const urlGenerator=Object(kibana["d"])();const[pageState,updatePageState]=Object(url_state["b"])(ml_url_generator["b"].DATA_FRAME_ANALYTICS_MODELS_MANAGE,getDefaultModelsListState());const searchQueryText=(_pageState$queryText=pageState.queryText)!==null&&_pageState$queryText!==void 0?_pageState$queryText:"";const setSearchQueryText=Object(external_kbnSharedDeps_React_["useCallback"])(value=>{updatePageState({queryText:value})},[updatePageState]);const canDeleteDataFrameAnalytics=capabilities.ml.canDeleteDataFrameAnalytics;const trainedModelsApiService=Object(trained_models["a"])();const{toasts:toasts}=Object(kibana["f"])();const[isLoading,setIsLoading]=Object(external_kbnSharedDeps_React_["useState"])(false);const[items,setItems]=Object(external_kbnSharedDeps_React_["useState"])([]);const[selectedModels,setSelectedModels]=Object(external_kbnSharedDeps_React_["useState"])([]);const[modelsToDelete,setModelsToDelete]=Object(external_kbnSharedDeps_React_["useState"])([]);const[itemIdToExpandedRowMap,setItemIdToExpandedRowMap]=Object(external_kbnSharedDeps_React_["useState"])({});const mlUrlGenerator=Object(kibana["d"])();const navigateToPath=Object(kibana["e"])();const isBuiltInModel=Object(external_kbnSharedDeps_React_["useCallback"])(item=>item.tags.includes(data_frame_analytics["b"]),[]);const fetchModelsData=Object(external_kbnSharedDeps_React_["useCallback"])(async()=>{try{const response=await trainedModelsApiService.getTrainedModels(undefined,{with_pipelines:true,size:1e3});const newItems=[];const expandedItemsToRefresh=[];for(const model of response){const tableItem={...model,...typeof model.inference_config==="object"?{type:[...Object.keys(model.inference_config),...isBuiltInModel(model)?[BUILT_IN_MODEL_TYPE]:[]]}:{}};newItems.push(tableItem);if(itemIdToExpandedRowMap[model.model_id]){expandedItemsToRefresh.push(tableItem)}}setItems(newItems);if(expandedItemsToRefresh.length>0){await fetchModelsStats(expandedItemsToRefresh);setItemIdToExpandedRowMap(expandedItemsToRefresh.reduce((acc,item)=>{acc[item.model_id]=external_kbnSharedDeps_React_default.a.createElement(ExpandedRow,{item:item});return acc},{}))}}catch(error){var _error$body;toasts.addError(new Error((_error$body=error.body)===null||_error$body===void 0?void 0:_error$body.message),{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.trainedModels.modelsList.fetchFailedErrorMessage",{defaultMessage:"Models fetch failed"})})}setIsLoading(false);common["G"].next(common["n"].IDLE)},[itemIdToExpandedRowMap]);Object(common["I"])({isLoading:setIsLoading,onRefresh:fetchModelsData});const modelsStats=Object(external_kbnSharedDeps_React_["useMemo"])(()=>({total:{show:true,value:items.length,label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.trainedModels.modelsList.totalAmountLabel",{defaultMessage:"Total trained models"})}}),[items]);const fetchModelsStats=Object(external_kbnSharedDeps_React_["useCallback"])(async models=>{const modelIdsToFetch=models.map(model=>model.model_id);try{const{trained_model_stats:modelsStatsResponse}=await trainedModelsApiService.getTrainedModelStats(modelIdsToFetch);for(const{model_id:id,...stats}of modelsStatsResponse){const model=models.find(m=>m.model_id===id);model.stats=stats}return true}catch(error){toasts.addError(new Error(error.body.message),{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.trainedModels.modelsList.fetchModelStatsErrorMessage",{defaultMessage:"Fetch model stats failed"})})}},[]);const inferenceTypesOptions=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{const result=items.reduce((acc,item)=>{const type=item.inference_config&&Object.keys(item.inference_config)[0];if(type){acc.add(type)}return acc},new Set);return[...result].map(v=>({value:v,name:v}))},[items]);async function prepareModelsForDeletion(models){if(await fetchModelsStats(models)){setModelsToDelete(models)}else{toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.trainedModels.modelsList.unableToDeleteModelsErrorMessage",{defaultMessage:"Unable to delete models"}))}}async function deleteModels(){const modelsToDeleteIds=modelsToDelete.map(model=>model.model_id);try{await Promise.all(modelsToDeleteIds.map(modelId=>trainedModelsApiService.deleteTrainedModel(modelId)));setItems(items.filter(model=>!modelsToDelete.some(toDelete=>toDelete.model_id===model.model_id)));toasts.addSuccess(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.trainedModels.modelsList.successfullyDeletedMessage",{defaultMessage:"{modelsCount, plural, one {Model {modelsToDeleteIds}} other {# models}} {modelsCount, plural, one {has} other {have}} been successfully deleted",values:{modelsCount:modelsToDeleteIds.length,modelsToDeleteIds:modelsToDeleteIds.join(", ")}}))}catch(error){var _error$body2;toasts.addError(new Error(error===null||error===void 0?void 0:(_error$body2=error.body)===null||_error$body2===void 0?void 0:_error$body2.message),{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.trainedModels.modelsList.fetchDeletionErrorMessage",{defaultMessage:"{modelsCount, plural, one {Model} other {Models}} deletion failed",values:{modelsCount:modelsToDeleteIds.length}})})}}const actions=[{name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.trainedModels.modelsList.viewTrainingDataActionLabel",{defaultMessage:"View training data"}),description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.trainedModels.modelsList.viewTrainingDataActionLabel",{defaultMessage:"View training data"}),icon:"visTable",type:"icon",available:item=>{var _item$metadata,_item$metadata$analyt;return(_item$metadata=item.metadata)===null||_item$metadata===void 0?void 0:(_item$metadata$analyt=_item$metadata.analytics_config)===null||_item$metadata$analyt===void 0?void 0:_item$metadata$analyt.id},onClick:async item=>{var _item$metadata2,_item$metadata3,_item$metadata4,_item$metadata5;if(((_item$metadata2=item.metadata)===null||_item$metadata2===void 0?void 0:_item$metadata2.analytics_config)===undefined)return;const analysisType=Object(common["t"])((_item$metadata3=item.metadata)===null||_item$metadata3===void 0?void 0:_item$metadata3.analytics_config.analysis);const url=await urlGenerator.createUrl({page:ml_url_generator["b"].DATA_FRAME_ANALYTICS_EXPLORATION,pageState:{jobId:(_item$metadata4=item.metadata)===null||_item$metadata4===void 0?void 0:_item$metadata4.analytics_config.id,analysisType:analysisType,...analysisType==="classification"||analysisType==="regression"?{queryText:`${(_item$metadata5=item.metadata)===null||_item$metadata5===void 0?void 0:_item$metadata5.analytics_config.dest.results_field}.is_training : true`}:{}}});await navigateToUrl(url)},isPrimary:true},{name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.inference.modelsList.analyticsMapActionLabel",{defaultMessage:"Analytics map"}),description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.inference.modelsList.analyticsMapActionLabel",{defaultMessage:"Analytics map"}),icon:"graphApp",type:"icon",isPrimary:true,available:item=>{var _item$metadata6,_item$metadata6$analy;return(_item$metadata6=item.metadata)===null||_item$metadata6===void 0?void 0:(_item$metadata6$analy=_item$metadata6.analytics_config)===null||_item$metadata6$analy===void 0?void 0:_item$metadata6$analy.id},onClick:async item=>{const path=await mlUrlGenerator.createUrl({page:ml_url_generator["b"].DATA_FRAME_ANALYTICS_MAP,pageState:{modelId:item.model_id}});await navigateToPath(path,false)}},{name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.trainedModels.modelsList.deleteModelActionLabel",{defaultMessage:"Delete model"}),description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.trainedModels.modelsList.deleteModelActionLabel",{defaultMessage:"Delete model"}),icon:"trash",type:"icon",color:"danger",isPrimary:false,onClick:async model=>{await prepareModelsForDeletion([model])},available:item=>canDeleteDataFrameAnalytics&&!isBuiltInModel(item),enabled:item=>!item.pipelines}];const toggleDetails=async item=>{const itemIdToExpandedRowMapValues={...itemIdToExpandedRowMap};if(itemIdToExpandedRowMapValues[item.model_id]){delete itemIdToExpandedRowMapValues[item.model_id]}else{await fetchModelsStats([item]);itemIdToExpandedRowMapValues[item.model_id]=external_kbnSharedDeps_React_default.a.createElement(ExpandedRow,{item:item})}setItemIdToExpandedRowMap(itemIdToExpandedRowMapValues)};const columns=[{align:"left",width:"40px",isExpander:true,render:item=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{onClick:toggleDetails.bind(null,item),"aria-label":itemIdToExpandedRowMap[item.model_id]?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.trainedModels.modelsList.collapseRow",{defaultMessage:"Collapse"}):external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.trainedModels.modelsList.expandRow",{defaultMessage:"Expand"}),iconType:itemIdToExpandedRowMap[item.model_id]?"arrowUp":"arrowDown"})},{field:ModelsTableToConfigMapping.id,name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.trainedModels.modelsList.modelIdHeader",{defaultMessage:"ID"}),sortable:true,truncateText:true},{field:ModelsTableToConfigMapping.description,width:"350px",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.trainedModels.modelsList.modelDescriptionHeader",{defaultMessage:"Description"}),sortable:false,truncateText:true},{field:ModelsTableToConfigMapping.type,name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.trainedModels.modelsList.typeHeader",{defaultMessage:"Type"}),sortable:true,align:"left",render:types=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xs",wrap:true},types.map(type=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{key:type,grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBadge"],{color:"hollow"},type))))},{field:ModelsTableToConfigMapping.createdAt,name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.trainedModels.modelsList.createdAtHeader",{defaultMessage:"Created at"}),dataType:"date",render:date_utils["d"],sortable:true},{name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.trainedModels.modelsList.actionsHeader",{defaultMessage:"Actions"}),actions:actions}];const filters=inferenceTypesOptions&&inferenceTypesOptions.length>0?[{type:"field_value_selection",field:"type",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.typeFilter",{defaultMessage:"Type"}),multiSelect:"or",options:inferenceTypesOptions}]:[];const toolsLeft=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween",alignItems:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h5",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.trainedModels.modelsList.selectedModelsMessage",defaultMessage:"{modelsCount, plural, one{# model} other {# models}} selected",values:{modelsCount:selectedModels.length}})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{color:"danger",onClick:prepareModelsForDeletion.bind(null,selectedModels)},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.trainedModels.modelsList.deleteModelsButtonLabel",defaultMessage:"Delete"})))));const isSelectionAllowed=canDeleteDataFrameAnalytics;const selection=isSelectionAllowed?{selectableMessage:(selectable,item)=>{if(selectable){return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.trainedModels.modelsList.selectableMessage",{defaultMessage:"Select a model"})}if(Array.isArray(item.pipelines)&&item.pipelines.length>0){return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.trainedModels.modelsList.disableSelectableMessage",{defaultMessage:"Model has associated pipelines"})}if(isBuiltInModel(item)){return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.trainedModels.modelsList.builtInModelMessage",{defaultMessage:"Built-in model"})}return""},selectable:item=>!item.pipelines&&!isBuiltInModel(item),onSelectionChange:selectedItems=>{setSelectedModels(selectedItems)}}:undefined;const search={query:searchQueryText,onChange:searchChange=>{if(searchChange.error!==null){return false}setSearchQueryText(searchChange.queryText);return true},box:{incremental:true},...inferenceTypesOptions&&inferenceTypesOptions.length>0?{filters:filters}:{},...selectedModels.length>0?{toolsLeft:toolsLeft}:{}};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween"},modelsStats&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(stats_bar["a"],{stats:modelsStats,dataTestSub:"mlInferenceModelsStatsBar"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement("div",{"data-test-subj":"mlModelsTableContainer"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiInMemoryTable"],{allowNeutralSort:false,columns:columns,hasActions:true,isExpandable:true,itemIdToExpandedRowMap:itemIdToExpandedRowMap,isSelectable:false,items:items,itemId:ModelsTableToConfigMapping.id,loading:isLoading,search:search,selection:selection,rowProps:item=>({"data-test-subj":`mlModelsTableRow row-${item.model_id}`})})),modelsToDelete.length>0&&external_kbnSharedDeps_React_default.a.createElement(DeleteModelsModal,{onClose:async deletionApproved=>{if(deletionApproved){await deleteModels()}setModelsToDelete([])},models:modelsToDelete}))};const ModelsTableToConfigMapping={id:"model_id",description:"description",createdAt:"create_time",type:"type"};var cytoscape_cjs=__webpack_require__(485);var cytoscape_cjs_default=__webpack_require__.n(cytoscape_cjs);var cytoscape_dagre=__webpack_require__(491);var cytoscape_dagre_default=__webpack_require__.n(cytoscape_dagre);var ml_classification_job=__webpack_require__(669);var ml_classification_job_default=__webpack_require__.n(ml_classification_job);var ml_outlier_detection_job=__webpack_require__(670);var ml_outlier_detection_job_default=__webpack_require__.n(ml_outlier_detection_job);var ml_regression_job=__webpack_require__(671);var ml_regression_job_default=__webpack_require__.n(ml_regression_job);const lineColor="#C5CCD7";const MAP_SHAPES={ELLIPSE:"ellipse",RECTANGLE:"rectangle",DIAMOND:"diamond",TRIANGLE:"triangle"};function shapeForNode(el,theme){const type=el.data("type");switch(type){case data_frame_analytics["e"].ANALYTICS:return MAP_SHAPES.ELLIPSE;case data_frame_analytics["e"].TRANSFORM:return MAP_SHAPES.RECTANGLE;case data_frame_analytics["e"].INDEX:return MAP_SHAPES.DIAMOND;case data_frame_analytics["e"].TRAINED_MODEL:return MAP_SHAPES.TRIANGLE;default:return MAP_SHAPES.ELLIPSE}}function iconForNode(el){const type=el.data("analysisType");switch(type){case data_frame_analytics["a"].OUTLIER_DETECTION:return ml_outlier_detection_job_default.a;case data_frame_analytics["a"].CLASSIFICATION:return ml_classification_job_default.a;case data_frame_analytics["a"].REGRESSION:return ml_regression_job_default.a;default:return undefined}}function borderColorForNode(el,theme){if(el.selected()){return theme.euiColorPrimary}const type=el.data("type");switch(type){case data_frame_analytics["e"].ANALYTICS:return theme.euiColorSecondary;case data_frame_analytics["e"].TRANSFORM:return theme.euiColorVis1;case data_frame_analytics["e"].INDEX:return theme.euiColorVis2;case data_frame_analytics["e"].TRAINED_MODEL:return theme.euiColorVis3;default:return theme.euiColorMediumShade}}const getCytoscapeOptions=theme=>({autoungrabify:true,boxSelectionEnabled:false,maxZoom:3,minZoom:.2,style:[{selector:"node",style:{"background-color":el=>el.data("isRoot")?theme.euiColorWarning:theme.euiColorGhost,"background-height":"60%","background-width":"60%","border-color":el=>borderColorForNode(el,theme),"border-style":"solid","background-image":el=>iconForNode(el),"border-width":el=>el.selected()?4:3,color:theme.euiTextColors.default,"font-family":"Inter UI, Segoe UI, Helvetica, Arial, sans-serif","font-size":theme.euiFontSizeXS,"min-zoomed-font-size":parseInt(theme.euiSizeL,10),label:"data(label)",shape:el=>shapeForNode(el,theme),"text-background-color":theme.euiColorLightestShade,"text-background-opacity":0,"text-background-padding":theme.paddingSizes.xs,"text-background-shape":"roundrectangle","text-margin-y":parseInt(theme.paddingSizes.s,10),"text-max-width":"200px","text-valign":"bottom","text-wrap":"wrap"}},{selector:"edge",style:{"curve-style":"taxi","taxi-direction":"rightward","line-color":lineColor,"overlay-opacity":0,"target-arrow-color":lineColor,"target-arrow-shape":"triangle","target-distance-from-node":theme.paddingSizes.xs,width:1,"source-arrow-shape":"none"}}]});cytoscape_cjs_default.a.use(cytoscape_dagre_default.a);const CytoscapeContext=Object(external_kbnSharedDeps_React_["createContext"])(undefined);function useCytoscape(options){const[cy,setCy]=Object(external_kbnSharedDeps_React_["useState"])();const ref=Object(external_kbnSharedDeps_React_["useRef"])(null);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(!cy){setCy(cytoscape_cjs_default()({...options,container:ref.current}))}},[options,cy]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>()=>{if(cy){cy.destroy()}},[cy]);return[ref,cy]}function getLayoutOptions(width,height){return{name:"dagre",rankDir:"LR",fit:true,padding:20,spacingFactor:.95,boundingBox:{x1:0,y1:0,w:width,h:height}}}function Cytoscape({children:children,elements:elements,theme:theme,height:height,itemsDeleted:itemsDeleted,resetCy:resetCy,style:style,width:width}){const[ref,cy]=useCytoscape({...getCytoscapeOptions(theme),elements:elements});const divStyle={...style,height:height};const dataHandler=Object(external_kbnSharedDeps_React_["useCallback"])(event=>{if(cy&&height>0){setTimeout(()=>cy.layout(getLayoutOptions(width,height)).run(),150)}},[cy,height,width]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(cy){cy.on("data",dataHandler)}return()=>{if(cy){cy.removeListener("data",undefined,dataHandler)}}},[cy,elements,height,width]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(cy){if(itemsDeleted===false){cy.add(elements)}else{cy.elements().remove();cy.add(elements)}cy.trigger("data")}},[cy,elements]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(cy){cy.reset()}},[cy,resetCy]);return external_kbnSharedDeps_React_default.a.createElement(CytoscapeContext.Provider,{value:cy},external_kbnSharedDeps_React_default.a.createElement("div",{ref:ref,style:divStyle,"data-test-subj":"mlPageDataFrameAnalyticsMapCytoscape"},children))}var external_kbnSharedDeps_MomentTimezone_=__webpack_require__(43);var external_kbnSharedDeps_MomentTimezone_default=__webpack_require__.n(external_kbnSharedDeps_MomentTimezone_);var check_capabilities=__webpack_require__(63);var index_utils=__webpack_require__(78);var clone_action_name=__webpack_require__(134);var action_delete=__webpack_require__(386);var delete_job_check_modal=__webpack_require__(271);function getListItems(details){return Object.entries(details).map(([key,value])=>{let description;if(key==="create_time"){description=Object(date_utils["c"])(external_kbnSharedDeps_MomentTimezone_default()(value).unix()*1e3)}else{description=typeof value==="object"?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCodeBlock"],{language:"json",fontSize:"s",paddingSize:"s"},JSON.stringify(value,null,2)):value}return{title:key,description:description}})}const Controls=external_kbnSharedDeps_React_default.a.memo(({details:details,getNodeData:getNodeData,modelId:modelId,refreshJobsCallback:refreshJobsCallback,updateElements:updateElements})=>{const[showFlyout,setShowFlyout]=Object(external_kbnSharedDeps_React_["useState"])(false);const[selectedNode,setSelectedNode]=Object(external_kbnSharedDeps_React_["useState"])();const[isPopoverOpen,setPopover]=Object(external_kbnSharedDeps_React_["useState"])(false);const[didUntag,setDidUntag]=Object(external_kbnSharedDeps_React_["useState"])(false);const canCreateDataFrameAnalytics=Object(check_capabilities["e"])("canCreateDataFrameAnalytics");const canDeleteDataFrameAnalytics=Object(check_capabilities["e"])("canDeleteDataFrameAnalytics");const deleteAction=Object(action_delete["b"])(canDeleteDataFrameAnalytics);const{closeDeleteJobCheckModal:closeDeleteJobCheckModal,deleteItem:deleteItem,deleteTargetIndex:deleteTargetIndex,isModalVisible:isModalVisible,isDeleteJobCheckModalVisible:isDeleteJobCheckModalVisible,item:item,jobType:jobType,openModal:openModal,openDeleteJobCheckModal:openDeleteJobCheckModal}=deleteAction;const{toasts:toasts}=Object(kibana["f"])();const mlUrlGenerator=Object(kibana["d"])();const navigateToPath=Object(kibana["e"])();const navigateToWizardWithClonedJob=Object(clone_action_name["e"])();const cy=Object(external_kbnSharedDeps_React_["useContext"])(CytoscapeContext);const deselect=Object(external_kbnSharedDeps_React_["useCallback"])(()=>{if(cy){cy.elements().unselect()}setShowFlyout(false);setSelectedNode(undefined)},[cy,setSelectedNode]);const nodeId=selectedNode===null||selectedNode===void 0?void 0:selectedNode.data("id");const nodeLabel=selectedNode===null||selectedNode===void 0?void 0:selectedNode.data("label");const nodeType=selectedNode===null||selectedNode===void 0?void 0:selectedNode.data("type");const onCreateJobClick=Object(external_kbnSharedDeps_React_["useCallback"])(async()=>{const indexId=Object(index_utils["c"])(nodeLabel);if(indexId){const path=await mlUrlGenerator.createUrl({page:ml_url_generator["b"].DATA_FRAME_ANALYTICS_CREATE_JOB,pageState:{index:indexId}});await navigateToPath(path)}else{toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsMap.flyout.indexPatternMissingMessage",{defaultMessage:"To create a job from this index please create an index pattern for {indexTitle}.",values:{indexTitle:nodeLabel}}))}},[nodeLabel]);const onCloneJobClick=Object(external_kbnSharedDeps_React_["useCallback"])(async()=>{var _details$nodeId;navigateToWizardWithClonedJob({config:details[nodeId],stats:(_details$nodeId=details[nodeId])===null||_details$nodeId===void 0?void 0:_details$nodeId.stats})},[nodeId]);const onActionsButtonClick=()=>{setPopover(!isPopoverOpen)};const closePopover=()=>{setPopover(false)};Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const selectHandler=event=>{setSelectedNode(event.target);setShowFlyout(true)};if(cy){cy.on("select","node",selectHandler);cy.on("unselect","node",deselect)}return()=>{if(cy){cy.removeListener("select","node",selectHandler);cy.removeListener("unselect","node",deselect)}}},[cy,deselect]);Object(external_kbnSharedDeps_React_["useEffect"])((function updateElementsOnClose(){if(isModalVisible===false&&deleteItem===true||didUntag===true){let destIndexNode;if(deleteTargetIndex===true||didUntag===true){const jobDetails=details[nodeId];const destIndex=jobDetails.dest.index;destIndexNode=`${destIndex}-${data_frame_analytics["e"].INDEX}`}updateElements(nodeId,nodeLabel,destIndexNode);setShowFlyout(false)}}),[isModalVisible,deleteItem,didUntag]);if(showFlyout===false){return null}const button=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{size:"s",iconType:"arrowDown",iconSide:"right",onClick:onActionsButtonClick},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analyticsMap.flyout.nodeActionsButton",defaultMessage:"Node actions"}));const items=[...nodeType===data_frame_analytics["e"].ANALYTICS?[external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiContextMenuItem"],{key:`${nodeId}-delete`,icon:"trash",disabled:!canDeleteDataFrameAnalytics,onClick:()=>{var _details$nodeId2;openDeleteJobCheckModal({config:details[nodeId],stats:(_details$nodeId2=details[nodeId])===null||_details$nodeId2===void 0?void 0:_details$nodeId2.stats})}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analyticsMap.flyout.deleteJobButton",defaultMessage:"Delete job"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiContextMenuItem"],{key:`${nodeId}-clone`,icon:"copy",disabled:!canCreateDataFrameAnalytics,onClick:onCloneJobClick},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analyticsMap.flyout.cloneJobButton",defaultMessage:"Clone job"}))]:[],...nodeType===data_frame_analytics["e"].INDEX?[external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiContextMenuItem"],{disabled:!canCreateDataFrameAnalytics,key:`${nodeId}-create`,icon:"plusInCircle",onClick:onCreateJobClick},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analyticsMap.flyout.createJobButton",defaultMessage:"Create job from this index"}))]:[],...modelId!==nodeLabel&&(nodeType===data_frame_analytics["e"].ANALYTICS||nodeType===data_frame_analytics["e"].INDEX)?[external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiContextMenuItem"],{key:`${nodeId}-fetch-related`,icon:"branch",onClick:()=>{getNodeData({id:nodeLabel,type:nodeType});setShowFlyout(false);setPopover(false)}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analyticsMap.flyout.fetchRelatedNodesButton",defaultMessage:"Fetch related nodes"}))]:[]];return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPortal"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyout"],{ownFocus:true,size:"m",onClose:()=>setShowFlyout(false),"data-test-subj":"mlAnalyticsJobMapFlyout"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"column",gutterSize:"xs"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h3",{"data-test-subj":"mlDataFrameAnalyticsNodeDetailsTitle"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analyticsMap.flyoutHeaderTitle",defaultMessage:"Details for {type} {id}",values:{id:nodeLabel,type:nodeType}})))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"column",gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{compressed:true,type:"column",listItems:nodeType==="index-pattern"?getListItems(details[nodeId][nodeLabel]):getListItems(details[nodeId])})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutFooter"],null,nodeType!==data_frame_analytics["e"].TRAINED_MODEL&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopover"],{button:button,isOpen:isPopoverOpen,closePopover:closePopover,panelPaddingSize:"s",anchorPosition:"downLeft"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiContextMenuPanel"],{items:items})))),isDeleteJobCheckModalVisible&&item&&external_kbnSharedDeps_React_default.a.createElement(delete_job_check_modal["a"],{jobType:jobType,jobIds:[item.config.id],onCloseCallback:closeDeleteJobCheckModal,canDeleteCallback:()=>{openModal(deleteAction.item);closeDeleteJobCheckModal()},refreshJobsCallback:refreshJobsCallback,setDidUntag:setDidUntag}),isModalVisible&&external_kbnSharedDeps_React_default.a.createElement(action_delete["a"],deleteAction))});const getJobTypeList=()=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiListGroup"],{flush:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiListGroupItem"],{iconType:"outlierDetectionJob",label:"Outlier detection",size:"xs"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiListGroupItem"],{iconType:"regressionJob",label:"Regression",size:"xs"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiListGroupItem"],{iconType:"classificationJob",label:"Classification",size:"xs"})));const JobMapLegend=({theme:theme})=>{const[showJobTypes,setShowJobTypes]=Object(external_kbnSharedDeps_React_["useState"])(false);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{className:"mlJobMapLegend__container",alignItems:"center","data-test-subj":"mlPageDataFrameAnalyticsMapLegend"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xs",alignItems:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement("span",{className:"mlJobMapLegend__sourceNode"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",color:"subdued"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analyticsMap.legend.rootNodeLabel",defaultMessage:"source node"}))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xs",alignItems:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement("span",{className:"mlJobMapLegend__indexPattern"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",color:"subdued"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analyticsMap.legend.indexLabel",defaultMessage:"index"}))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xs",alignItems:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement("span",{className:"mlJobMapLegend__transform"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",color:"subdued"},data_frame_analytics["e"].TRANSFORM)))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xs",alignItems:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement("span",{style:{display:"inline-block",width:"0px",height:"0px",borderLeft:`${theme.euiSizeS} solid ${theme.euiPageBackgroundColor}`,borderRight:`${theme.euiSizeS} solid ${theme.euiPageBackgroundColor}`,borderBottom:`${theme.euiSizeM} solid ${theme.euiColorVis3}`}})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",color:"subdued"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analyticsMap.legend.trainedModelLabel",defaultMessage:"trained model"}))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xs",alignItems:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement("span",{className:"mlJobMapLegend__analytics"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xs",alignItems:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",color:"subdued"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analyticsMap.legend.analyticsJobLabel",defaultMessage:"analytics jobs"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopover"],{ownFocus:true,button:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{iconSize:"s",onClick:()=>setShowJobTypes(!showJobTypes),iconType:showJobTypes?"arrowUp":"arrowDown","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsMap.legend.showJobTypesAriaLabel",{defaultMessage:"Show job types"})}),isOpen:showJobTypes,closePopover:()=>setShowJobTypes(false)},getJobTypeList())))))))};var color_range_legend=__webpack_require__(139);var useWindowSize=__webpack_require__(672);var useWindowSize_default=__webpack_require__.n(useWindowSize);function useRefDimensions(){const ref=Object(external_kbnSharedDeps_React_["useRef"])(null);const windowHeight=useWindowSize_default()().height;if(!ref.current){return{ref:ref,width:0,height:0}}const{top:top,width:width}=ref.current.getBoundingClientRect();const height=windowHeight-top;return{ref:ref,width:width,height:height}}var external_kbnSharedDeps_Lodash_=__webpack_require__(5);var ml_api_service=__webpack_require__(59);const useFetchAnalyticsMapData=()=>{const[isLoading,setIsLoading]=Object(external_kbnSharedDeps_React_["useState"])(false);const[elements,setElements]=Object(external_kbnSharedDeps_React_["useState"])([]);const[nodeDetails,setNodeDetails]=Object(external_kbnSharedDeps_React_["useState"])({});const[error,setError]=Object(external_kbnSharedDeps_React_["useState"])();const[message,setMessage]=Object(external_kbnSharedDeps_React_["useState"])();const fetchAndSetElements=async(idToUse,treatAsRoot,type)=>{setIsLoading(true);const analyticsMap=await ml_api_service["ml"].dataFrameAnalytics.getDataFrameAnalyticsMap(idToUse,treatAsRoot,type);const{elements:nodeElements,details:details,error:fetchError}=analyticsMap;if(fetchError!==null){setIsLoading(false);setError(fetchError)}if((nodeElements===null||nodeElements===void 0?void 0:nodeElements.length)===0){setMessage(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsMap.emptyResponseMessage",{defaultMessage:"No related analytics jobs found for {id}.",values:{id:idToUse}}))}if((nodeElements===null||nodeElements===void 0?void 0:nodeElements.length)>0){if(treatAsRoot===false){setElements(nodeElements);setNodeDetails(details)}else{const uniqueElements=Object(external_kbnSharedDeps_Lodash_["uniqWith"])([...nodeElements,...elements],external_kbnSharedDeps_Lodash_["isEqual"]);setElements(uniqueElements);setNodeDetails({...details,...nodeDetails})}}setIsLoading(false)};const fetchAndSetElementsWrapper=async params=>{const{analyticsId:analyticsId,id:id,modelId:modelId,type:type}=params!==null&&params!==void 0?params:{};const treatAsRoot=id!==undefined;let idToUse;if(id!==undefined){idToUse=id}else if(modelId!==undefined){idToUse=modelId}else{idToUse=analyticsId}await fetchAndSetElements(idToUse,treatAsRoot,modelId!==undefined&&treatAsRoot===false?data_frame_analytics["e"].TRAINED_MODEL:type)};return{elements:elements,error:error,fetchAndSetElementsWrapper:fetchAndSetElementsWrapper,isLoading:isLoading,message:message,nodeDetails:nodeDetails,setElements:setElements,setError:setError}};const JobMapTitle=({analyticsId:analyticsId,modelId:modelId})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("span",{"data-test-subj":"mlPageDataFrameAnalyticsMapTitle"},analyticsId?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analyticsMap.analyticsIdTitle",defaultMessage:"Map for analytics ID {analyticsId}",values:{analyticsId:analyticsId}}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analyticsMap.modelIdTitle",defaultMessage:"Map for trained model ID {modelId}",values:{modelId:modelId}})));const getCytoscapeDivStyle=theme=>({background:`linear-gradient(\n  90deg,\n  ${theme.euiPageBackgroundColor}\n    calc(${theme.euiSizeL} - calc(${theme.euiSizeXS} / 2)),\n  transparent 1%\n)\ncenter,\nlinear-gradient(\n  ${theme.euiPageBackgroundColor}\n    calc(${theme.euiSizeL} - calc(${theme.euiSizeXS} / 2)),\n  transparent 1%\n)\ncenter,\n${theme.euiColorLightShade}`,backgroundSize:`${theme.euiSizeL} ${theme.euiSizeL}`,margin:`-${theme.gutterTypes.gutterLarge}`,marginTop:0});const JobMap=({analyticsId:analyticsId,modelId:modelId})=>{const[itemsDeleted,setItemsDeleted]=Object(external_kbnSharedDeps_React_["useState"])(false);const[resetCyToggle,setResetCyToggle]=Object(external_kbnSharedDeps_React_["useState"])(false);const{elements:elements,error:error,fetchAndSetElementsWrapper:fetchAndSetElementsWrapper,isLoading:isLoading,message:message,nodeDetails:nodeDetails,setElements:setElements,setError:setError}=useFetchAnalyticsMapData();const{services:{notifications:notifications,application:{navigateToUrl:navigateToUrl}}}=Object(kibana["b"])();const urlGenerator=Object(kibana["d"])();const{euiTheme:euiTheme}=Object(color_range_legend["e"])();const redirectToAnalyticsManagementPage=async()=>{const url=await urlGenerator.createUrl({page:ml_url_generator["b"].DATA_FRAME_ANALYTICS_JOBS_MANAGE});await navigateToUrl(url)};const updateElements=(nodeId,nodeLabel,destIndexNode)=>{if(nodeLabel===analyticsId){redirectToAnalyticsManagementPage()}else{const filteredElements=elements.filter(e=>{let isNotDeletedNodeOrRelated=e.data.id!==nodeId&&e.data.target!==nodeId&&e.data.source!==nodeId;if(e.data.id!==undefined&&e.data.type===data_frame_analytics["e"].TRAINED_MODEL){var _nodeDetails$e$data$i,_nodeDetails$e$data$i2,_nodeDetails$e$data$i3;isNotDeletedNodeOrRelated=isNotDeletedNodeOrRelated&&((_nodeDetails$e$data$i=nodeDetails[e.data.id])===null||_nodeDetails$e$data$i===void 0?void 0:(_nodeDetails$e$data$i2=_nodeDetails$e$data$i.metadata)===null||_nodeDetails$e$data$i2===void 0?void 0:(_nodeDetails$e$data$i3=_nodeDetails$e$data$i2.analytics_config)===null||_nodeDetails$e$data$i3===void 0?void 0:_nodeDetails$e$data$i3.id)!==nodeLabel}if(destIndexNode!==undefined){return isNotDeletedNodeOrRelated&&e.data.id!==destIndexNode&&e.data.target!==destIndexNode&&e.data.source!==destIndexNode}return isNotDeletedNodeOrRelated});setItemsDeleted(true);setElements(filteredElements)}};Object(external_kbnSharedDeps_React_["useEffect"])(()=>{fetchAndSetElementsWrapper({analyticsId:analyticsId,modelId:modelId})},[analyticsId,modelId]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(message!==undefined){notifications.toasts.add(message)}},[message]);if(error!==undefined){notifications.toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsMap.fetchDataErrorMessage",{defaultMessage:"Unable to fetch some data. An error occurred: {error}",values:{error:JSON.stringify(error)}}));setError(undefined)}const{ref:ref,width:width,height:height}=useRefDimensions();const refreshCallback=()=>fetchAndSetElementsWrapper({analyticsId:analyticsId,modelId:modelId});return external_kbnSharedDeps_React_default.a.createElement("div",{"data-test-subj":"mlPageDataFrameAnalyticsMap"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"column",gutterSize:"none",justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween",alignItems:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(JobMapTitle,{analyticsId:analyticsId,modelId:modelId})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(JobMapLegend,{theme:euiTheme})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xs",component:"span"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{size:"xs","data-test-subj":`mlAnalyticsRefreshMapButton${isLoading?" loading":" loaded"}`,onClick:refreshCallback,isLoading:isLoading},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analyticsList.refreshMapButtonLabel",defaultMessage:"Refresh"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{size:"xs","data-test-subj":"mlAnalyticsResetGraphButton",onClick:()=>setResetCyToggle(!resetCyToggle)},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analyticsList.resetMapButtonLabel",defaultMessage:"Reset"})))))),external_kbnSharedDeps_React_default.a.createElement("div",{style:{height:height-parseInt(euiTheme.gutterTypes.gutterLarge,10)-20},ref:ref},external_kbnSharedDeps_React_default.a.createElement(Cytoscape,{theme:euiTheme,height:height-20,elements:elements,width:width,style:getCytoscapeDivStyle(euiTheme),itemsDeleted:itemsDeleted,resetCy:resetCyToggle},external_kbnSharedDeps_React_default.a.createElement(Controls,{details:nodeDetails,getNodeData:fetchAndSetElementsWrapper,modelId:modelId,updateElements:updateElements,refreshJobsCallback:refreshCallback}))))};var analytics_list_common=__webpack_require__(88);var help_menu=__webpack_require__(98);const getDefaultDFAListState=()=>({pageIndex:0,pageSize:10,sortField:analytics_list_common["c"].id,sortDirection:"asc"});const Page=()=>{var _globalState$ml,_globalState$ml2;const[blockRefresh,setBlockRefresh]=Object(external_kbnSharedDeps_React_["useState"])(false);const[globalState]=Object(url_state["c"])("_g");const[dfaPageState,setDfaPageState]=Object(url_state["b"])(ml_url_generator["b"].DATA_FRAME_ANALYTICS_JOBS_MANAGE,getDefaultDFAListState());useRefreshInterval(setBlockRefresh);const location=Object(external_kbnSharedDeps_ReactRouterDom_["useLocation"])();const selectedTabId=Object(external_kbnSharedDeps_React_["useMemo"])(()=>location.pathname.split("/").pop(),[location]);const mapJobId=globalState===null||globalState===void 0?void 0:(_globalState$ml=globalState.ml)===null||_globalState$ml===void 0?void 0:_globalState$ml.jobId;const mapModelId=globalState===null||globalState===void 0?void 0:(_globalState$ml2=globalState.ml)===null||_globalState$ml2===void 0?void 0:_globalState$ml2.modelId;const{services:{docLinks:docLinks}}=Object(kibana["b"])();const helpLink=docLinks.links.ml.dataFrameAnalytics;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(navigation_menu["a"],{tabId:"data_frame_analytics"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPage"],{"data-test-subj":"mlPageDataFrameAnalytics"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageHeaderSection"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],null,external_kbnSharedDeps_React_default.a.createElement("h1",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analyticsList.title",defaultMessage:"Data frame analytics"}),external_kbnSharedDeps_React_default.a.createElement("span",null," "),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBetaBadge"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.betaBadgeLabel",{defaultMessage:"Beta"}),tooltipContent:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.betaBadgeTooltipContent",{defaultMessage:`Data frame analytics are a beta feature. We'd love to hear your feedback.`})})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageHeaderSection"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center",gutterSize:"s"},selectedTabId!=="map"&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(refresh_analytics_list_button["a"],null)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(date_picker_wrapper["a"],null)))))),external_kbnSharedDeps_React_default.a.createElement(node_available_warning["a"],null),external_kbnSharedDeps_React_default.a.createElement(saved_objects_warning["a"],{jobType:"data-frame-analytics"}),external_kbnSharedDeps_React_default.a.createElement(upgrade["a"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageContent"],null,external_kbnSharedDeps_React_default.a.createElement(AnalyticsNavigationBar,{selectedTabId:selectedTabId,jobId:mapJobId,modelId:mapModelId}),selectedTabId==="map"&&(mapJobId||mapModelId)&&external_kbnSharedDeps_React_default.a.createElement(JobMap,{analyticsId:mapJobId,modelId:mapModelId}),selectedTabId==="data_frame_analytics"&&external_kbnSharedDeps_React_default.a.createElement(analytics_list["a"],{blockRefresh:blockRefresh,pageState:dfaPageState,updatePageState:setDfaPageState}),selectedTabId==="models"&&external_kbnSharedDeps_React_default.a.createElement(ModelsList,null)))),external_kbnSharedDeps_React_default.a.createElement(help_menu["a"],{docLink:helpLink}))}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return CustomUrls}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(33);var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(34);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);var kibana=__webpack_require__(58);var custom_url_utils=__webpack_require__(144);const URL_TYPE={KIBANA_DASHBOARD:"KIBANA_DASHBOARD",KIBANA_DISCOVER:"KIBANA_DISCOVER",OTHER:"OTHER"};const TIME_RANGE_TYPE={AUTO:"auto",INTERVAL:"interval"};var rison=__webpack_require__(179);var rison_default=__webpack_require__.n(rison);var url=__webpack_require__(440);var url_default=__webpack_require__.n(url);var public_=__webpack_require__(49);var job_utils=__webpack_require__(64);var parse_interval=__webpack_require__(22);var ml_api_service=__webpack_require__(59);var job_service=__webpack_require__(65);var string_utils=__webpack_require__(84);var dependency_cache=__webpack_require__(18);var data_grid=__webpack_require__(109);function getNewCustomUrlDefaults(job,dashboards,indexPatterns){const kibanaSettings={queryFieldNames:[]};let urlType=URL_TYPE.OTHER;if(dashboards!==undefined&&dashboards.length>0){urlType=URL_TYPE.KIBANA_DASHBOARD;kibanaSettings.dashboardId=dashboards[0].id}else if(indexPatterns!==undefined&&indexPatterns.length>0){urlType=URL_TYPE.KIBANA_DISCOVER}const datafeedConfig=job.datafeed_config;if(indexPatterns!==undefined&&indexPatterns.length>0&&datafeedConfig!==undefined&&datafeedConfig.indices!==undefined&&datafeedConfig.indices.length>0){const datafeedIndex=datafeedConfig.indices[0];let defaultIndexPattern=indexPatterns.find(indexPattern=>indexPattern.title===datafeedIndex);if(defaultIndexPattern===undefined){defaultIndexPattern=indexPatterns[0]}kibanaSettings.discoverIndexPatternId=defaultIndexPattern.id}return{label:"",type:urlType,timeRange:{type:TIME_RANGE_TYPE.AUTO,interval:""},kibanaSettings:kibanaSettings,otherUrlSettings:{urlValue:""}}}function getQueryEntityFieldNames(job){const influencers=job.analysis_config.influencers;const detectors=job.analysis_config.detectors;const entityFieldNames=[];if(influencers!==undefined){entityFieldNames.push(...influencers)}detectors.forEach((detector,detectorIndex)=>{const partitioningFields=Object(job_utils["h"])(job,detectorIndex);partitioningFields.forEach(fieldName=>{if(entityFieldNames.indexOf(fieldName)===-1){entityFieldNames.push(fieldName)}})});return entityFieldNames}function isValidCustomUrlSettingsTimeRange(timeRangeSettings){if(timeRangeSettings.type===TIME_RANGE_TYPE.INTERVAL){const interval=Object(parse_interval["a"])(timeRangeSettings.interval);return interval!==null}return true}function isValidCustomUrlSettings(settings,savedCustomUrls){let isValid=Object(custom_url_utils["b"])(settings.label,savedCustomUrls);if(isValid===true){isValid=isValidCustomUrlSettingsTimeRange(settings.timeRange)}return isValid}function buildCustomUrlFromSettings(settings){if(settings.type===URL_TYPE.KIBANA_DASHBOARD){return buildDashboardUrlFromSettings(settings)}else if(settings.type===URL_TYPE.KIBANA_DISCOVER){return Promise.resolve(buildDiscoverUrlFromSettings(settings))}else{const urlToAdd={url_name:settings.label,url_value:settings.otherUrlSettings.urlValue};return Promise.resolve(urlToAdd)}}function buildDashboardUrlFromSettings(settings){return new Promise((resolve,reject)=>{const{dashboardId:dashboardId,queryFieldNames:queryFieldNames}=settings.kibanaSettings;const savedObjectsClient=Object(dependency_cache["h"])();savedObjectsClient.get("dashboard",dashboardId).then(response=>{let filters=[];let query=undefined;const searchSourceJSON=response.get("kibanaSavedObjectMeta.searchSourceJSON");if(searchSourceJSON!==undefined){const searchSourceData=JSON.parse(searchSourceJSON);if(searchSourceData.filter!==undefined){filters=searchSourceData.filter}query=searchSourceData.query}const queryFromEntityFieldNames=buildAppStateQueryParam(queryFieldNames);if(queryFromEntityFieldNames!==undefined){query=queryFromEntityFieldNames}const getUrlGenerator=Object(dependency_cache["d"])();const generator=getUrlGenerator(public_["DASHBOARD_APP_URL_GENERATOR"]);return generator.createUrl({dashboardId:dashboardId,timeRange:{from:"$earliest$",to:"$latest$",mode:"absolute"},filters:filters,query:query,useHash:false}).then(urlValue=>{const urlToAdd={url_name:settings.label,url_value:decodeURIComponent(`dashboards${url_default.a.parse(urlValue).hash}`),time_range:TIME_RANGE_TYPE.AUTO};if(settings.timeRange.type===TIME_RANGE_TYPE.INTERVAL){urlToAdd.time_range=settings.timeRange.interval}resolve(urlToAdd)})}).catch(resp=>{reject(resp)})})}function buildDiscoverUrlFromSettings(settings){const{discoverIndexPatternId:discoverIndexPatternId,queryFieldNames:queryFieldNames}=settings.kibanaSettings;const _g=rison_default.a.encode({time:{from:"$earliest$",to:"$latest$",mode:"absolute"}});const appState={index:discoverIndexPatternId};const queryFromEntityFieldNames=buildAppStateQueryParam(queryFieldNames);if(queryFromEntityFieldNames!==undefined){appState.query=queryFromEntityFieldNames}const _a=rison_default.a.encode(appState);const urlValue=`discover#/?_g=${_g}&_a=${_a}`;const urlToAdd={url_name:settings.label,url_value:urlValue,time_range:TIME_RANGE_TYPE.AUTO};if(settings.timeRange.type===TIME_RANGE_TYPE.INTERVAL){urlToAdd.time_range=settings.timeRange.interval}return urlToAdd}function buildAppStateQueryParam(queryFieldNames){let queryParam;if(queryFieldNames!==undefined&&queryFieldNames.length>0){let queryString="";queryFieldNames.forEach((fieldName,i)=>{if(i>0){queryString+=" and "}queryString+=`${Object(string_utils["c"])(fieldName)}:"$${fieldName}$"`});queryParam={language:"kuery",query:queryString}}return queryParam}function getTestUrl(job,customUrl){const urlValue=customUrl.url_value;const bucketSpanSecs=Object(parse_interval["a"])(job.analysis_config.bucket_span).asSeconds();let testUrl=customUrl.url_value;const body={query:{bool:{must:[{term:{job_id:job.job_id}},{term:{result_type:"record"}}]}},size:1,_source:{excludes:[]},sort:[{record_score:{order:"desc"}}]};return new Promise((resolve,reject)=>{ml_api_service["ml"].results.anomalySearch({body:body},[job.job_id]).then(resp=>{if(resp.hits.total.value>0){const record=resp.hits.hits[0]._source;testUrl=Object(custom_url_utils["e"])(customUrl,bucketSpanSecs,record,"timestamp");resolve(testUrl)}else{job_service["a"].searchPreview(job).then(response=>{let testDoc;const docTimeFieldName=job.data_description.time_field;if(response.aggregations){const firstBucket=response.aggregations.buckets.buckets[0];testDoc={[docTimeFieldName]:firstBucket.key};urlValue.replace(/\$([^?&$\'"]{1,40})\$/g,(match,name)=>{if(name!=="earliest"&&name!=="latest"&&firstBucket[name]!==undefined){const tokenBuckets=firstBucket[name];if(tokenBuckets.buckets){testDoc[name]=tokenBuckets.buckets[0].key}}})}else{if(response.hits.total.value>0){testDoc=Object(data_grid["m"])(response.hits.hits[0].fields)}}if(testDoc!==undefined){testUrl=Object(custom_url_utils["e"])(customUrl,bucketSpanSecs,testDoc,docTimeFieldName)}resolve(testUrl)})}}).catch(resp=>{reject(resp)})})}function isValidTimeRange(timeRange){if(timeRange===undefined||timeRange.length===0||timeRange===TIME_RANGE_TYPE.AUTO){return true}const interval=Object(parse_interval["a"])(timeRange);return interval!==null}const CustomUrlList=({job:job,customUrls:customUrls,setCustomUrls:setCustomUrls})=>{const{services:{http:http,notifications:notifications}}=Object(kibana["b"])();const[expandedUrlIndex,setExpandedUrlIndex]=Object(external_kbnSharedDeps_React_["useState"])(null);const onLabelChange=(e,index)=>{if(index<customUrls.length){customUrls[index]={...customUrls[index],url_name:e.target.value};setCustomUrls(customUrls)}};const onUrlValueChange=(e,index)=>{if(index<customUrls.length){customUrls[index]={...customUrls[index],url_value:e.target.value};setCustomUrls(customUrls)}};const onTimeRangeChange=(e,index)=>{if(index<customUrls.length){customUrls[index]={...customUrls[index]};const timeRange=e.target.value;if(timeRange!==undefined&&timeRange.length>0){customUrls[index].time_range=timeRange}else{delete customUrls[index].time_range}setCustomUrls(customUrls)}};const onDeleteButtonClick=index=>{if(index<customUrls.length){customUrls.splice(index,1);setCustomUrls(customUrls)}};const onTestButtonClick=index=>{if(index<customUrls.length){getTestUrl(job,customUrls[index]).then(testUrl=>{Object(custom_url_utils["d"])(testUrl,customUrls[index],http.basePath.get())}).catch(resp=>{console.error("Error obtaining URL for test:",resp);const{toasts:toasts}=notifications;toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.customUrlEditorList.obtainingUrlToTestConfigurationErrorMessage",{defaultMessage:"An error occurred obtaining the URL to test the configuration"}))})}};const customUrlRows=customUrls.map((customUrl,index)=>{const label=customUrl.url_name;const otherUrls=[...customUrls];otherUrls.splice(index,1);const isInvalidLabel=!Object(custom_url_utils["b"])(label,otherUrls);const invalidLabelError=isInvalidLabel?[external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.customUrlEditorList.labelIsNotUniqueErrorMessage",{defaultMessage:"A unique label must be supplied"})]:[];const timeRange=customUrl.time_range;const isInvalidTimeRange=!isValidTimeRange(timeRange);const invalidIntervalError=isInvalidTimeRange?[external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.customUrlEditorList.invalidTimeRangeFormatErrorMessage",{defaultMessage:"Invalid format"})]:[];return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{key:`url_${index}`,"data-test-subj":`mlJobEditCustomUrlItem_${index}`},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.customUrlEditorList.labelLabel",defaultMessage:"Label"}),isInvalid:isInvalidLabel,error:invalidLabelError},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{value:label,isInvalid:isInvalidLabel,onChange:e=>onLabelChange(e,index),"data-test-subj":`mlJobEditCustomUrlLabelInput_${index}`}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true,label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.customUrlEditorList.urlLabel",defaultMessage:"URL"})},index===expandedUrlIndex?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTextArea"],{inputRef:input=>{if(input){input.focus()}},fullWidth:true,value:customUrl.url_value,onChange:e=>onUrlValueChange(e,index),onBlur:()=>{setExpandedUrlIndex(null)},"data-test-subj":`mlJobEditCustomUrlTextarea_${index}`}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{fullWidth:true,value:customUrl.url_value,readOnly:true,onFocus:()=>setExpandedUrlIndex(index),"data-test-subj":`mlJobEditCustomUrlInput_${index}`}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.customUrlEditorList.timeRangeLabel",defaultMessage:"Time range"}),error:invalidIntervalError,isInvalid:isInvalidTimeRange},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{value:customUrl.time_range||"",isInvalid:isInvalidTimeRange,placeholder:TIME_RANGE_TYPE.AUTO,onChange:e=>onTimeRangeChange(e,index)}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{hasEmptyLabelSpace:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.customUrlEditorList.testCustomUrlTooltip",defaultMessage:"Test custom URL"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{size:"s",color:"primary",onClick:()=>onTestButtonClick(index),iconType:"popout","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.customUrlEditorList.testCustomUrlAriaLabel",{defaultMessage:"Test custom URL"})})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{hasEmptyLabelSpace:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.customUrlEditorList.deleteCustomUrlTooltip",defaultMessage:"Delete custom URL"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{size:"s",color:"danger",onClick:()=>onDeleteButtonClick(index),iconType:"trash","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.customUrlEditorList.deleteCustomUrlAriaLabel",{defaultMessage:"Delete custom URL"})})))))});return external_kbnSharedDeps_React_default.a.createElement("div",{"data-test-subj":"mlJobEditCustomUrlsList"},customUrlRows)};function getLinkToOptions(){return[{id:URL_TYPE.KIBANA_DASHBOARD,label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.customUrlEditor.kibanaDashboardLabel",{defaultMessage:"Kibana dashboard"})},{id:URL_TYPE.KIBANA_DISCOVER,label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.customUrlEditor.discoverLabel",{defaultMessage:"Discover"})},{id:URL_TYPE.OTHER,label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.customUrlEditor.otherLabel",{defaultMessage:"Other"})}]}const CustomUrlEditor=({customUrl:customUrl,setEditCustomUrl:setEditCustomUrl,savedCustomUrls:savedCustomUrls,dashboards:dashboards,indexPatterns:indexPatterns,queryEntityFieldNames:queryEntityFieldNames})=>{if(customUrl===undefined){return null}const onLabelChange=e=>{setEditCustomUrl({...customUrl,label:e.target.value})};const onTypeChange=linkType=>{setEditCustomUrl({...customUrl,type:linkType})};const onDashboardChange=e=>{const kibanaSettings=customUrl.kibanaSettings;setEditCustomUrl({...customUrl,kibanaSettings:{...kibanaSettings,dashboardId:e.target.value}})};const onDiscoverIndexPatternChange=e=>{const kibanaSettings=customUrl.kibanaSettings;setEditCustomUrl({...customUrl,kibanaSettings:{...kibanaSettings,discoverIndexPatternId:e.target.value}})};const onQueryEntitiesChange=selectedOptions=>{const selectedFieldNames=selectedOptions.map(option=>option.label);const kibanaSettings=customUrl.kibanaSettings;setEditCustomUrl({...customUrl,kibanaSettings:{...kibanaSettings,queryFieldNames:selectedFieldNames}})};const onOtherUrlValueChange=e=>{setEditCustomUrl({...customUrl,otherUrlSettings:{urlValue:e.target.value}})};const onTimeRangeTypeChange=e=>{const timeRange=customUrl.timeRange;setEditCustomUrl({...customUrl,timeRange:{...timeRange,type:e.target.value}})};const onTimeRangeIntervalChange=e=>{const timeRange=customUrl.timeRange;setEditCustomUrl({...customUrl,timeRange:{...timeRange,interval:e.target.value}})};const{label:label,type:type,timeRange:timeRange,kibanaSettings:kibanaSettings,otherUrlSettings:otherUrlSettings}=customUrl;const dashboardOptions=dashboards.map(dashboard=>({value:dashboard.id,text:dashboard.title}));const indexPatternOptions=indexPatterns.map(indexPattern=>({value:indexPattern.id,text:indexPattern.title}));const entityOptions=queryEntityFieldNames.map(fieldName=>({label:fieldName}));let selectedEntityOptions=[];if(kibanaSettings!==undefined&&kibanaSettings.queryFieldNames!==undefined){const queryFieldNames=kibanaSettings.queryFieldNames;selectedEntityOptions=queryFieldNames.map(fieldName=>({label:fieldName}))}const timeRangeOptions=Object.values(TIME_RANGE_TYPE).map(timeRangeType=>({value:timeRangeType,text:timeRangeType}));const isInvalidLabel=!Object(custom_url_utils["b"])(label,savedCustomUrls);const invalidLabelError=isInvalidLabel?[external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.customUrlsEditor.invalidLabelErrorMessage",{defaultMessage:"A unique label must be supplied"})]:[];const isInvalidTimeRange=!isValidCustomUrlSettingsTimeRange(timeRange);const invalidIntervalError=isInvalidTimeRange?[external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.customUrlsList.invalidIntervalFormatErrorMessage",{defaultMessage:"Invalid interval format"})]:[];return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h4",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.customUrlsEditor.createNewCustomUrlTitle",defaultMessage:"Create new custom URL"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiForm"],{className:"ml-edit-url-form"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.customUrlsEditor.labelLabel",defaultMessage:"Label"}),className:"url-label",error:invalidLabelError,isInvalid:isInvalidLabel,display:"rowCompressed"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{name:"label",value:label,onChange:onLabelChange,isInvalid:isInvalidLabel,compressed:true,"data-test-subj":"mlJobCustomUrlLabelInput"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.customUrlsEditor.linkToLabel",defaultMessage:"Link to"}),display:"rowCompressed"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiRadioGroup"],{options:getLinkToOptions(),idSelected:type,onChange:onTypeChange,className:"url-link-to-radio"})),type===URL_TYPE.KIBANA_DASHBOARD&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.customUrlsEditor.dashboardNameLabel",defaultMessage:"Dashboard name"}),display:"rowCompressed"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{options:dashboardOptions,value:kibanaSettings.dashboardId,onChange:onDashboardChange,compressed:true})),type===URL_TYPE.KIBANA_DISCOVER&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.customUrlsEditor.indexPatternLabel",defaultMessage:"Index pattern"}),display:"rowCompressed"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{options:indexPatternOptions,value:kibanaSettings.discoverIndexPatternId,onChange:onDiscoverIndexPatternChange,compressed:true})),(type===URL_TYPE.KIBANA_DASHBOARD||type===URL_TYPE.KIBANA_DISCOVER)&&entityOptions.length>0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.customUrlsEditor.queryEntitiesLabel",defaultMessage:"Query entities"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{placeholder:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.customUrlsEditor.selectEntitiesPlaceholder",{defaultMessage:"Select entities"}),options:entityOptions,selectedOptions:selectedEntityOptions,onChange:onQueryEntitiesChange,isClearable:true})),(type===URL_TYPE.KIBANA_DASHBOARD||type===URL_TYPE.KIBANA_DISCOVER)&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.customUrlsEditor.timeRangeLabel",defaultMessage:"Time range"}),className:"url-time-range",display:"rowCompressed"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{options:timeRangeOptions,value:timeRange.type,onChange:onTimeRangeTypeChange,compressed:true}))),timeRange.type===TIME_RANGE_TYPE.INTERVAL&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.customUrlsEditor.intervalLabel",defaultMessage:"Interval"}),className:"url-time-range",error:invalidIntervalError,isInvalid:isInvalidTimeRange,display:"rowCompressed"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{value:timeRange.interval,onChange:onTimeRangeIntervalChange,isInvalid:isInvalidTimeRange,compressed:true}))))),type===URL_TYPE.OTHER&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.customUrlsEditor.urlLabel",defaultMessage:"URL"}),display:"rowCompressed",fullWidth:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTextArea"],{fullWidth:true,rows:2,value:otherUrlSettings.urlValue,onChange:onOtherUrlValueChange,compressed:true}))))};var kibanaReact_public_=__webpack_require__(36);var edit_utils=__webpack_require__(298);function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const MAX_NUMBER_DASHBOARDS=1e3;const MAX_NUMBER_INDEX_PATTERNS=1e3;class custom_urls_CustomUrlsUI extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);_defineProperty(this,"editNewCustomUrl",()=>{this.setState(prevState=>{const{dashboards:dashboards,indexPatterns:indexPatterns}=prevState;return{editorOpen:true,editorSettings:getNewCustomUrlDefaults(this.props.job,dashboards,indexPatterns)}})});_defineProperty(this,"setEditCustomUrl",customUrl=>{this.setState({editorSettings:customUrl})});_defineProperty(this,"addNewCustomUrl",()=>{buildCustomUrlFromSettings(this.state.editorSettings).then(customUrl=>{const customUrls=[...this.state.customUrls,customUrl];this.props.setCustomUrls(customUrls);this.setState({editorOpen:false})}).catch(error=>{console.error("Error building custom URL from settings:",error);const{toasts:toasts}=this.props.kibana.services.notifications;toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.editJobFlyout.customUrls.addNewUrlErrorNotificationMessage",{defaultMessage:"An error occurred building the new custom URL from the supplied settings"}))})});_defineProperty(this,"onTestButtonClick",()=>{const{http:{basePath:basePath},notifications:{toasts:toasts}}=this.props.kibana.services;const job=this.props.job;buildCustomUrlFromSettings(this.state.editorSettings).then(customUrl=>{getTestUrl(job,customUrl).then(testUrl=>{Object(custom_url_utils["d"])(testUrl,customUrl,basePath.get())}).catch(resp=>{console.error("Error obtaining URL for test:",resp);toasts.addWarning(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.editJobFlyout.customUrls.getTestUrlErrorNotificationMessage",{defaultMessage:"An error occurred obtaining the URL to test the configuration"}))})}).catch(resp=>{console.error("Error building custom URL from settings:",resp);toasts.addWarning(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.editJobFlyout.customUrls.buildUrlErrorNotificationMessage",{defaultMessage:"An error occurred building the custom URL for testing from the supplied settings"}))})});_defineProperty(this,"closeEditor",()=>{this.setState({editorOpen:false})});this.state={customUrls:[],dashboards:[],indexPatterns:[],queryEntityFieldNames:[],editorOpen:false}}static getDerivedStateFromProps(props){return{job:props.job,customUrls:props.jobCustomUrls,queryEntityFieldNames:getQueryEntityFieldNames(props.job)}}componentDidMount(){const{toasts:toasts}=this.props.kibana.services.notifications;Object(edit_utils["b"])(MAX_NUMBER_DASHBOARDS).then(dashboards=>{this.setState({dashboards:dashboards})}).catch(resp=>{console.error("Error loading list of dashboards:",resp);toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.editJobFlyout.customUrls.loadSavedDashboardsErrorNotificationMessage",{defaultMessage:"An error occurred loading the list of saved Kibana dashboards"}))});Object(edit_utils["a"])(MAX_NUMBER_INDEX_PATTERNS).then(indexPatterns=>{this.setState({indexPatterns:indexPatterns})}).catch(resp=>{console.error("Error loading list of dashboards:",resp);toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.editJobFlyout.customUrls.loadIndexPatternsErrorNotificationMessage",{defaultMessage:"An error occurred loading the list of saved index patterns"}))})}renderEditor(){var _this$props$editMode;const{customUrls:customUrls,editorOpen:editorOpen,editorSettings:editorSettings,dashboards:dashboards,indexPatterns:indexPatterns,queryEntityFieldNames:queryEntityFieldNames}=this.state;const editMode=(_this$props$editMode=this.props.editMode)!==null&&_this$props$editMode!==void 0?_this$props$editMode:"inline";const editor=external_kbnSharedDeps_React_default.a.createElement(CustomUrlEditor,{customUrl:editorSettings,setEditCustomUrl:this.setEditCustomUrl,savedCustomUrls:customUrls,dashboards:dashboards,indexPatterns:indexPatterns,queryEntityFieldNames:queryEntityFieldNames});const isValidEditorSettings=editorOpen&&editorSettings!==undefined?isValidCustomUrlSettings(editorSettings,customUrls):true;const addButton=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:this.addNewCustomUrl,isDisabled:!isValidEditorSettings,"data-test-subj":"mlJobAddCustomUrl"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.editJobFlyout.customUrls.addButtonLabel",defaultMessage:"Add"}));const testButton=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{iconType:"popout",iconSide:"right",onClick:this.onTestButtonClick,isDisabled:!isValidEditorSettings},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.editJobFlyout.customUrls.testButtonLabel",defaultMessage:"Test"}));return editMode==="inline"?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],{className:"edit-custom-url-panel"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{color:"text",onClick:this.closeEditor,iconType:"cross","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.editJobFlyout.customUrls.closeEditorAriaLabel",{defaultMessage:"Close custom URL editor"}),className:"close-editor-button"}),editor,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},addButton),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},testButton))):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModal"],{onClose:this.closeEditor,initialFocus:"[name=label]",style:{width:500},"data-test-subj":"mlJobNewCustomUrlFormModal"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalHeaderTitle"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.editJobFlyout.customUrls.addCustomUrlButtonLabel",defaultMessage:"Add custom URL"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalBody"],null,editor),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalFooter"],null,testButton,addButton))}render(){const{customUrls:customUrls,editorOpen:editorOpen}=this.state;const{editMode:editMode="inline"}=this.props;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),(!editorOpen||editMode==="modal")&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{size:"s",onClick:this.editNewCustomUrl,"data-test-subj":"mlJobOpenCustomUrlFormButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.editJobFlyout.customUrls.addCustomUrlButtonLabel",defaultMessage:"Add custom URL"})),editorOpen&&this.renderEditor(),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}),external_kbnSharedDeps_React_default.a.createElement(CustomUrlList,{job:this.props.job,customUrls:customUrls,setCustomUrls:this.props.setCustomUrls}))}}const CustomUrls=Object(kibanaReact_public_["withKibana"])(custom_urls_CustomUrlsUI)},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return AnnotationFlyout}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var useObservable=__webpack_require__(128);var useObservable_default=__webpack_require__.n(useObservable);var external_kbnSharedDeps_Lodash_=__webpack_require__(5);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(33);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(34);var annotations=__webpack_require__(131);var annotations_service=__webpack_require__(130);var date_utils=__webpack_require__(67);const AnnotationDescriptionList=({annotation:annotation,detectorDescription:detectorDescription})=>{const listItems=[{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.annotationDescriptionList.jobIdTitle",{defaultMessage:"Job ID"}),description:annotation.job_id},{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.annotationDescriptionList.startTitle",{defaultMessage:"Start"}),description:Object(date_utils["c"])(annotation.timestamp)}];if(annotation.end_timestamp!==undefined){listItems.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.annotationDescriptionList.endTitle",{defaultMessage:"End"}),description:Object(date_utils["c"])(annotation.end_timestamp)})}if(annotation.create_time!==undefined&&annotation.modified_time!==undefined){var _annotation$create_us,_annotation$modified_;listItems.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.annotationDescriptionList.createdTitle",{defaultMessage:"Created"}),description:Object(date_utils["c"])(annotation.create_time)});listItems.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.annotationDescriptionList.createdByTitle",{defaultMessage:"Created by"}),description:(_annotation$create_us=annotation.create_username)!==null&&_annotation$create_us!==void 0?_annotation$create_us:""});listItems.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.annotationDescriptionList.lastModifiedTitle",{defaultMessage:"Last modified"}),description:Object(date_utils["c"])(annotation.modified_time)});listItems.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.annotationDescriptionList.modifiedByTitle",{defaultMessage:"Modified by"}),description:(_annotation$modified_=annotation.modified_username)!==null&&_annotation$modified_!==void 0?_annotation$modified_:""})}if(detectorDescription!==undefined){listItems.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.annotationDescriptionList.detectorTitle",{defaultMessage:"Detector"}),description:detectorDescription})}if(annotation.partition_field_name!==undefined){var _annotation$partition;listItems.push({title:annotation.partition_field_name,description:(_annotation$partition=annotation.partition_field_value)!==null&&_annotation$partition!==void 0?_annotation$partition:""})}if(annotation.over_field_name!==undefined){var _annotation$over_fiel;listItems.push({title:annotation.over_field_name,description:(_annotation$over_fiel=annotation.over_field_value)!==null&&_annotation$over_fiel!==void 0?_annotation$over_fiel:""})}if(annotation.by_field_name!==undefined){var _annotation$by_field_;listItems.push({title:annotation.by_field_name,description:(_annotation$by_field_=annotation.by_field_value)!==null&&_annotation$by_field_!==void 0?_annotation$by_field_:""})}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{className:"ml-annotation-description-list",type:"column",listItems:listItems})};const DeleteAnnotationModal=({cancelAction:cancelAction,deleteAction:deleteAction,isVisible:isVisible})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,isVisible===true&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiConfirmModal"],{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.timeSeriesExplorer.deleteAnnotationModal.deleteAnnotationTitle",defaultMessage:"Delete this annotation?"}),onCancel:cancelAction,onConfirm:deleteAction,cancelButtonText:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.timeSeriesExplorer.deleteAnnotationModal.cancelButtonLabel",defaultMessage:"Cancel"}),confirmButtonText:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.timeSeriesExplorer.deleteAnnotationModal.deleteButtonLabel",defaultMessage:"Delete"}),buttonColor:"danger",defaultFocusedButton:external_kbnSharedDeps_ElasticEui_["EUI_MODAL_CONFIRM_BUTTON"],className:"eui-textBreakWord"}));var ml_api_service=__webpack_require__(59);var dependency_cache=__webpack_require__(18);function getAnnotationFieldName(fieldType){return`${fieldType}_name`}function getAnnotationFieldValue(fieldType){return`${fieldType}_value`}function isAnnotation(arg){return arg.timestamp!==undefined&&typeof arg.annotation==="string"&&typeof arg.job_id==="string"&&(arg.type===annotations["d"].ANNOTATION||arg.type===annotations["d"].COMMENT)}function isAnnotations(arg){if(Array.isArray(arg)===false){return false}return arg.every(d=>isAnnotation(d))}var anomalies=__webpack_require__(1);var ml_annotation_updates_context=__webpack_require__(132);function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class annotation_flyout_AnnotationFlyoutUI extends external_kbnSharedDeps_React_["Component"]{constructor(...args){super(...args);_defineProperty(this,"state",{isDeleteModalVisible:false,applyAnnotationToSeries:true,annotationState:null});_defineProperty(this,"annotationSub",null);_defineProperty(this,"annotationTextChangeHandler",e=>{if(this.state.annotationState===null){return}const{annotationUpdatesService:annotationUpdatesService}=this.props;annotationUpdatesService.setValue({...this.state.annotationState,annotation:e.target.value})});_defineProperty(this,"cancelEditingHandler",()=>{const{annotationUpdatesService:annotationUpdatesService}=this.props;annotationUpdatesService.setValue(null)});_defineProperty(this,"deleteConfirmHandler",()=>{this.setState({isDeleteModalVisible:true})});_defineProperty(this,"deleteHandler",async()=>{const{annotationState:annotationState}=this.state;const toastNotifications=Object(dependency_cache["j"])();if(annotationState===null||annotationState._id===undefined){return}try{await ml_api_service["ml"].annotations.deleteAnnotation(annotationState._id);toastNotifications.addSuccess(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.deletedAnnotationNotificationMessage",{defaultMessage:"Deleted annotation for job with ID {jobId}.",values:{jobId:annotationState.job_id}}))}catch(err){toastNotifications.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.errorWithDeletingAnnotationNotificationErrorMessage",{defaultMessage:"An error occurred deleting the annotation for job with ID {jobId}: {error}",values:{jobId:annotationState.job_id,error:JSON.stringify(err)}}))}this.closeDeleteModal();const{annotationUpdatesService:annotationUpdatesService}=this.props;annotationUpdatesService.setValue(null);Object(annotations_service["c"])()});_defineProperty(this,"closeDeleteModal",()=>{this.setState({isDeleteModalVisible:false})});_defineProperty(this,"validateAnnotationText",()=>{const{annotationState:annotationState}=this.state;const errors=[];if(annotationState===null){return errors}if(annotationState.annotation.trim().length===0){errors.push(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.annotationFlyout.noAnnotationTextError",{defaultMessage:"Enter annotation text"}))}const textLength=annotationState.annotation.length;if(textLength>annotations["c"]){const charsOver=textLength-annotations["c"];errors.push(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.annotationFlyout.maxLengthError",{defaultMessage:"{charsOver, number} {charsOver, plural, one {character} other {characters}} above maximum length of {maxChars}",values:{maxChars:annotations["c"],charsOver:charsOver}}))}return errors});_defineProperty(this,"saveOrUpdateAnnotation",()=>{var _chartDetails$entityD,_annotation$event;const{annotationState:originalAnnotation}=this.state;const{chartDetails:chartDetails,detectorIndex:detectorIndex,annotationUpdatesService:annotationUpdatesService}=this.props;if(originalAnnotation===null){return}const annotation=Object(external_kbnSharedDeps_Lodash_["cloneDeep"])(originalAnnotation);if(this.state.applyAnnotationToSeries&&chartDetails!==null&&chartDetails!==void 0&&(_chartDetails$entityD=chartDetails.entityData)!==null&&_chartDetails$entityD!==void 0&&_chartDetails$entityD.entities){chartDetails.entityData.entities.forEach(entity=>{const{fieldName:fieldName,fieldValue:fieldValue}=entity;const fieldType=entity.fieldType;annotation[getAnnotationFieldName(fieldType)]=fieldName;annotation[getAnnotationFieldValue(fieldType)]=fieldValue});annotation.detector_index=detectorIndex}if(!this.state.applyAnnotationToSeries){delete annotation.detector_index;anomalies["e"].forEach(fieldType=>{delete annotation[getAnnotationFieldName(fieldType)];delete annotation[getAnnotationFieldValue(fieldType)]})}annotation.event=(_annotation$event=annotation.event)!==null&&_annotation$event!==void 0?_annotation$event:annotations["b"];annotationUpdatesService.setValue(null);ml_api_service["ml"].annotations.indexAnnotation(annotation).then(()=>{Object(annotations_service["c"])();const toastNotifications=Object(dependency_cache["j"])();if(typeof annotation._id==="undefined"){toastNotifications.addSuccess(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.addedAnnotationNotificationMessage",{defaultMessage:"Added an annotation for job with ID {jobId}.",values:{jobId:annotation.job_id}}))}else{toastNotifications.addSuccess(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.updatedAnnotationNotificationMessage",{defaultMessage:"Updated annotation for job with ID {jobId}.",values:{jobId:annotation.job_id}}))}}).catch(resp=>{const toastNotifications=Object(dependency_cache["j"])();if(typeof annotation._id==="undefined"){toastNotifications.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.errorWithCreatingAnnotationNotificationErrorMessage",{defaultMessage:"An error occurred creating the annotation for job with ID {jobId}: {error}",values:{jobId:annotation.job_id,error:JSON.stringify(resp)}}))}else{toastNotifications.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.errorWithUpdatingAnnotationNotificationErrorMessage",{defaultMessage:"An error occurred updating the annotation for job with ID {jobId}: {error}",values:{jobId:annotation.job_id,error:JSON.stringify(resp)}}))}})})}componentDidMount(){const{annotationUpdatesService:annotationUpdatesService}=this.props;this.annotationSub=annotationUpdatesService.update$().subscribe(v=>{this.setState({annotationState:v})})}componentWillUnmount(){this.annotationSub.unsubscribe()}render(){const{detectors:detectors,detectorIndex:detectorIndex}=this.props;const{annotationState:annotationState,isDeleteModalVisible:isDeleteModalVisible}=this.state;if(!annotationState)return null;const isExistingAnnotation=typeof annotationState._id!=="undefined";const validationErrors=this.validateAnnotationText();const isInvalid=validationErrors.length>0;const lengthRatioToShowWarning=.95;let helpText=null;if(isInvalid===false&&annotationState.annotation.length>annotations["c"]*lengthRatioToShowWarning){helpText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.annotationFlyout.approachingMaxLengthWarning",{defaultMessage:"{charsRemaining, number} {charsRemaining, plural, one {character} other {characters}} remaining",values:{charsRemaining:annotations["c"]-annotationState.annotation.length}})}const detector=detectors?detectors.find(d=>d.index===detectorIndex):undefined;const detectorDescription=detector&&"detector_description"in detector?detector.detector_description:"";return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutBody"],null,external_kbnSharedDeps_React_default.a.createElement(AnnotationDescriptionList,{annotation:annotationState,detectorDescription:detectorDescription}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.timeSeriesExplorer.annotationFlyout.annotationTextLabel",defaultMessage:"Annotation text"}),fullWidth:true,helpText:helpText,isInvalid:isInvalid,error:validationErrors},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTextArea"],{fullWidth:true,isInvalid:isInvalid,onChange:this.annotationTextChangeHandler,placeholder:"...",value:annotationState.annotation})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCheckbox"],{id:"xpack.ml.annotationFlyout.applyToPartition",label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.annotationFlyout.applyToPartitionTextLabel",defaultMessage:"Apply annotation to this series"}),checked:this.state.applyAnnotationToSeries,onChange:()=>this.setState({applyAnnotationToSeries:!this.state.applyAnnotationToSeries})}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutFooter"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:this.cancelEditingHandler,flush:"left"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.timeSeriesExplorer.annotationFlyout.cancelButtonLabel",defaultMessage:"Cancel"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:{marginLeft:"auto"}},isExistingAnnotation&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{color:"danger",onClick:this.deleteConfirmHandler},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.timeSeriesExplorer.annotationFlyout.deleteButtonLabel",defaultMessage:"Delete"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{fill:true,isDisabled:isInvalid===true,onClick:this.saveOrUpdateAnnotation,"data-test-subj":"annotationFlyoutUpdateButton"},isExistingAnnotation?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.timeSeriesExplorer.annotationFlyout.updateButtonLabel",defaultMessage:"Update"}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.timeSeriesExplorer.annotationFlyout.createButtonLabel",defaultMessage:"Create"}))))),external_kbnSharedDeps_React_default.a.createElement(DeleteAnnotationModal,{cancelAction:this.closeDeleteModal,deleteAction:this.deleteHandler,isVisible:isDeleteModalVisible}))}}const AnnotationFlyout=props=>{const annotationUpdatesService=Object(external_kbnSharedDeps_React_["useContext"])(ml_annotation_updates_context["a"]);const annotationProp=useObservable_default()(annotationUpdatesService.isAnnotationInitialized$());const cancelEditingHandler=Object(external_kbnSharedDeps_React_["useCallback"])(()=>{annotationUpdatesService.setValue(null)},[]);if(annotationProp===undefined||annotationProp===null){return null}const isExistingAnnotation=typeof annotationProp._id!=="undefined";return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyout"],{onClose:cancelEditingHandler,size:"m","aria-labelledby":"Add annotation","data-test-subj":"mlAnnotationFlyout"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutHeader"],{hasBorder:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h2",{id:"mlAnnotationFlyoutTitle"},isExistingAnnotation?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.timeSeriesExplorer.annotationFlyout.editAnnotationTitle",defaultMessage:"Edit annotation"}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.timeSeriesExplorer.annotationFlyout.addAnnotationTitle",defaultMessage:"Add annotation"})))),external_kbnSharedDeps_React_default.a.createElement(annotation_flyout_AnnotationFlyoutUI,_extends({},props,{annotationUpdatesService:annotationUpdatesService})))}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return getInitialGroupsMap}));__webpack_require__.d(__webpack_exports__,"a",(function(){return JobSelector}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(33);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);var url_state=__webpack_require__(70);var prop_types=__webpack_require__(122);var job_selector_badge=__webpack_require__(214);function IdBadges({limit:limit,maps:maps,onLinkClick:onLinkClick,selectedIds:selectedIds,showAllBarBadges:showAllBarBadges}){const badges=[];const currentGroups=[];for(let i=0;i<selectedIds.length;i++){const currentId=selectedIds[i];if(maps.groupsMap[currentId]!==undefined){currentGroups.push(currentId);badges.push(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,key:currentId},external_kbnSharedDeps_React_default.a.createElement(job_selector_badge["a"],{id:currentId,isGroup:true,numJobs:maps.groupsMap[currentId].length})))}else{continue}}for(let i=0;i<selectedIds.length;i++){const currentId=selectedIds[i];if(maps.groupsMap[currentId]===undefined){const jobGroups=maps.jobsMap[currentId]||[];if(jobGroups.some(g=>currentGroups.includes(g))===false){badges.push(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,key:currentId},external_kbnSharedDeps_React_default.a.createElement(job_selector_badge["a"],{id:currentId})))}else{continue}}else{continue}}if(showAllBarBadges||badges.length<=limit){if(badges.length>limit){badges.push(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{key:"more-badges-bar-link",onClick:onLinkClick},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{grow:false,size:"xs"},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobSelector.hideBarBadges",{defaultMessage:"Hide"}))))}return badges}else{const overFlow=badges.length-limit;badges.splice(limit);badges.push(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{key:"more-badges-bar-link",onClick:onLinkClick},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{grow:false,size:"xs"},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobSelector.showBarBadges",{defaultMessage:`And {overFlow} more`,values:{overFlow:overFlow}}))));return badges}}IdBadges.propTypes={limit:prop_types["PropTypes"].number,maps:prop_types["PropTypes"].shape({jobsMap:prop_types["PropTypes"].object,groupsMap:prop_types["PropTypes"].object}),onLinkClick:prop_types["PropTypes"].func,selectedIds:prop_types["PropTypes"].array,showAllBarBadges:prop_types["PropTypes"].bool};var job_selector_flyout=__webpack_require__(383);function mergeSelection(jobIds,groupObjs,singleSelection){if(singleSelection){return jobIds}const selectedIds=[];const alreadySelected=[];groupObjs.forEach(group=>{selectedIds.push(group.groupId);alreadySelected.push(...group.jobIds)});jobIds.forEach(jobId=>{if(alreadySelected.includes(jobId)===false){selectedIds.push(jobId)}});return selectedIds}function getInitialGroupsMap(selectedGroups){const map={};if(selectedGroups.length){selectedGroups.forEach(group=>{map[group.groupId]=group.jobIds})}return map}function JobSelector({dateFormatTz:dateFormatTz,singleSelection:singleSelection,timeseriesOnly:timeseriesOnly}){var _globalState$ml$jobId,_globalState$ml,_globalState$ml$group,_globalState$ml2;const[globalState,setGlobalState]=Object(url_state["c"])("_g");const selectedJobIds=(_globalState$ml$jobId=globalState===null||globalState===void 0?void 0:(_globalState$ml=globalState.ml)===null||_globalState$ml===void 0?void 0:_globalState$ml.jobIds)!==null&&_globalState$ml$jobId!==void 0?_globalState$ml$jobId:[];const selectedGroups=(_globalState$ml$group=globalState===null||globalState===void 0?void 0:(_globalState$ml2=globalState.ml)===null||_globalState$ml2===void 0?void 0:_globalState$ml2.groups)!==null&&_globalState$ml$group!==void 0?_globalState$ml$group:[];const[maps,setMaps]=Object(external_kbnSharedDeps_React_["useState"])({groupsMap:getInitialGroupsMap(selectedGroups),jobsMap:{}});const[selectedIds,setSelectedIds]=Object(external_kbnSharedDeps_React_["useState"])(mergeSelection(selectedJobIds,selectedGroups,singleSelection));const[showAllBarBadges,setShowAllBarBadges]=Object(external_kbnSharedDeps_React_["useState"])(false);const[isFlyoutVisible,setIsFlyoutVisible]=Object(external_kbnSharedDeps_React_["useState"])(false);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setSelectedIds(mergeSelection(selectedJobIds,selectedGroups,singleSelection))},[JSON.stringify([selectedJobIds,selectedGroups])]);function closeFlyout(){setIsFlyoutVisible(false)}function showFlyout(){setIsFlyoutVisible(true)}function handleJobSelectionClick(){showFlyout()}const applySelection=Object(external_kbnSharedDeps_React_["useCallback"])(({newSelection:newSelection,jobIds:jobIds,groups:newGroups,time:time})=>{setSelectedIds(newSelection);setGlobalState({ml:{jobIds:jobIds,groups:newGroups},...time!==undefined?{time:time}:{}});closeFlyout()},[setGlobalState,setSelectedIds]);function renderJobSelectionBar(){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{responsive:false,gutterSize:"xs",alignItems:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{wrap:true,responsive:false,gutterSize:"xs",alignItems:"center","data-test-subj":"mlJobSelectionBadges"},external_kbnSharedDeps_React_default.a.createElement(IdBadges,{limit:job_selector_flyout["a"],maps:maps,onLinkClick:()=>setShowAllBarBadges(!showAllBarBadges),selectedIds:selectedIds,showAllBarBadges:showAllBarBadges}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{size:"xs",iconType:"pencil",onClick:handleJobSelectionClick,"data-test-subj":"mlButtonEditJobSelection"},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobSelector.jobSelectionButton",{defaultMessage:"Edit job selection"}))))}function renderFlyout(){if(isFlyoutVisible){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyout"],{onClose:closeFlyout,"data-test-subj":"mlFlyoutJobSelector","aria-labelledby":"jobSelectorFlyout"},external_kbnSharedDeps_React_default.a.createElement(job_selector_flyout["b"],{dateFormatTz:dateFormatTz,timeseriesOnly:timeseriesOnly,singleSelection:singleSelection,selectedIds:selectedIds,onSelectionConfirmed:applySelection,onJobsFetched:setMaps,onFlyoutClose:closeFlyout,maps:maps}))}}return external_kbnSharedDeps_React_default.a.createElement("div",{className:"mlJobSelectorBar"},selectedIds.length>0&&renderJobSelectionBar(),renderFlyout())}},,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"getDefaultPanelTitle",(function(){return getDefaultPanelTitle}));__webpack_require__.d(__webpack_exports__,"AnomalySwimlaneEmbeddable",(function(){return anomaly_swimlane_embeddable_AnomalySwimlaneEmbeddable}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_ReactDom_=__webpack_require__(46);var external_kbnSharedDeps_ReactDom_default=__webpack_require__.n(external_kbnSharedDeps_ReactDom_);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);var external_kbnSharedDeps_Rxjs_=__webpack_require__(19);var public_=__webpack_require__(36);var embeddable_public_=__webpack_require__(41);const EmbeddableSwimLaneContainer=external_kbnSharedDeps_React_default.a.lazy(()=>Promise.all([__webpack_require__.e(3),__webpack_require__.e(2),__webpack_require__.e(4),__webpack_require__.e(5),__webpack_require__.e(21)]).then(__webpack_require__.bind(null,844)));var ui_actions=__webpack_require__(152);var embeddables=__webpack_require__(89);function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const getDefaultPanelTitle=jobIds=>external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.swimlaneEmbeddable.title",{defaultMessage:"ML anomaly swim lane for {jobIds}",values:{jobIds:jobIds.join(", ")}});class anomaly_swimlane_embeddable_AnomalySwimlaneEmbeddable extends embeddable_public_["Embeddable"]{constructor(initialInput,services,parent){super(initialInput,{defaultTitle:initialInput.title},parent);this.services=services;_defineProperty(this,"node",void 0);_defineProperty(this,"reload$",new external_kbnSharedDeps_Rxjs_["Subject"]);_defineProperty(this,"type",embeddables["ANOMALY_SWIMLANE_EMBEDDABLE_TYPE"])}render(node){super.render(node);this.node=node;const I18nContext=this.services[0].i18n.Context;external_kbnSharedDeps_ReactDom_default.a.render(external_kbnSharedDeps_React_default.a.createElement(I18nContext,null,external_kbnSharedDeps_React_default.a.createElement(public_["KibanaContextProvider"],{services:{...this.services[0]}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Suspense"],{fallback:null},external_kbnSharedDeps_React_default.a.createElement(EmbeddableSwimLaneContainer,{id:this.input.id,embeddableContext:this,embeddableInput:this.getInput$(),services:this.services,refresh:this.reload$.asObservable(),onInputChange:this.updateInput.bind(this),onOutputChange:this.updateOutput.bind(this)})))),node)}destroy(){super.destroy();if(this.node){external_kbnSharedDeps_ReactDom_default.a.unmountComponentAtNode(this.node)}}reload(){this.reload$.next()}supportedTriggers(){return[ui_actions["a"]]}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return NodeAvailableWarning}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(33);var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(34);var ml_nodes_check=__webpack_require__(121);var ml_server_info=__webpack_require__(83);const NodeAvailableWarning=()=>{if(Object(ml_nodes_check["d"])()===true||Object(ml_nodes_check["e"])()===false){return null}const id=Object(ml_server_info["a"])();return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.nodeAvailableWarning.noMLNodesAvailableTitle",defaultMessage:"No ML nodes available"}),color:"warning",iconType:"alert"},external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.nodeAvailableWarning.noMLNodesAvailableDescription",defaultMessage:"There are no ML nodes available."})),external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.nodeAvailableWarning.unavailableCreateOrRunJobsDescription",defaultMessage:"You will not be able to create or run jobs."})),Object(ml_server_info["d"])()&&id!==null&&external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.nodeAvailableWarning.linkToCloudDescription",defaultMessage:"Please edit your {link}. You may enable a free 1GB machine learning node or expand your existing ML configuration.",values:{link:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{href:`https://cloud.elastic.co/deployments?q=${id}`},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.nodeAvailableWarning.linkToCloud.hereLinkText",defaultMessage:"Elastic Cloud deployment"}))}}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}))}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return SavedObjectsWarning}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(33);var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(34);var kibana=__webpack_require__(58);const SavedObjectsWarning=({jobType:jobType})=>{const{savedObjects:{initSavedObjects:initSavedObjects}}=Object(kibana["a"])();const{services:{http:{basePath:basePath}}}=Object(kibana["b"])();const[showWarning,setShowWarning]=Object(external_kbnSharedDeps_React_["useState"])(false);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{let unmounted=false;initSavedObjects(true).then(({jobs:jobs})=>{if(unmounted===true){return}const missingJobs=jobs.length>0&&(jobType===undefined||jobs.some(({type:type})=>type===jobType));setShowWarning(missingJobs)}).catch(()=>{console.log("Saved object synchronization check could not be performed.")});return()=>{unmounted=true}},[]);return showWarning===false?null:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.missingSavedObjectWarning.title",defaultMessage:"ML job synchronization required"}),color:"warning",iconType:"alert"},external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.missingSavedObjectWarning.description",defaultMessage:"Some jobs are missing their saved object and require synchronization in {link}.",values:{link:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{href:`${basePath.get()}/app/management/insightsAndAlerting/jobsListLink`},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.missingSavedObjectWarning.linkToManagement.link",defaultMessage:"Stack Management"}))}}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}))}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return UpgradeWarning}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(33);var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(34);var upgrade_service=__webpack_require__(288);const UpgradeWarning=()=>{if(Object(upgrade_service["a"])()===true){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.upgrade.upgradeWarning.upgradeInProgressWarningTitle",defaultMessage:"Index migration in progress"}),color:"warning",iconType:"alert"},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.upgrade.upgradeWarning.upgradeInProgressWarningDescription",defaultMessage:"Indices related to Machine Learning are currently being upgraded."}),external_kbnSharedDeps_React_default.a.createElement("br",null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.upgrade.upgradeWarning.upgradeInProgressWarningDescriptionExtra",defaultMessage:"Some actions will not be available during this time."}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}))}return null}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return AnnotationsTable}));var external_kbnSharedDeps_Lodash_=__webpack_require__(5);var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var memoize_one_cjs=__webpack_require__(230);var memoize_one_cjs_default=__webpack_require__.n(memoize_one_cjs);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(33);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(34);var external_kbnSharedDeps_ElasticEuiLibServices_=__webpack_require__(47);var recently_accessed=__webpack_require__(185);var ml_api_service=__webpack_require__(59);var job_service=__webpack_require__(65);var table_service=__webpack_require__(229);var constants_search=__webpack_require__(96);var job_utils=__webpack_require__(64);var annotations_service=__webpack_require__(130);var constants_annotations=__webpack_require__(131);var public_=__webpack_require__(36);var ml_url_generator=__webpack_require__(0);var app=__webpack_require__(4);var date_utils=__webpack_require__(67);var ml_annotation_updates_context=__webpack_require__(132);function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const CURRENT_SERIES="current_series";class annotations_table_AnnotationsTableUI extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);_defineProperty(this,"getAnnotationsWithExtraInfo",memoize_one_cjs_default()(annotations=>{var _this$props$chartDeta,_this$props$chartDeta2;if(Array.isArray((_this$props$chartDeta=this.props.chartDetails)===null||_this$props$chartDeta===void 0?void 0:(_this$props$chartDeta2=_this$props$chartDeta.entityData)===null||_this$props$chartDeta2===void 0?void 0:_this$props$chartDeta2.entities)){return annotations.map(annotation=>{var _this$props$chartDeta3,_this$props$chartDeta4;const allMatched=(_this$props$chartDeta3=this.props.chartDetails)===null||_this$props$chartDeta3===void 0?void 0:(_this$props$chartDeta4=_this$props$chartDeta3.entityData)===null||_this$props$chartDeta4===void 0?void 0:_this$props$chartDeta4.entities.every(({fieldType:fieldType,fieldValue:fieldValue})=>{const field=`${fieldType}_value`;return!(!annotation[field]||annotation[field]!==fieldValue)});return{...annotation,[CURRENT_SERIES]:allMatched}})}else{return annotations}}));_defineProperty(this,"annotationsRefreshSubscription",null);_defineProperty(this,"previousJobId",undefined);_defineProperty(this,"openSingleMetricView",async(annotation={})=>{const{services:{application:{navigateToApp:navigateToApp},share:{urlGenerators:{getUrlGenerator:getUrlGenerator}}}}=this.props.kibana;const job=this.getJob(annotation.job_id);const dataCounts=job.data_counts;const resultLatest=Object(job_utils["g"])(dataCounts.latest_record_timestamp,dataCounts.latest_bucket_timestamp);const from=new Date(dataCounts.earliest_record_timestamp).toISOString();const to=new Date(resultLatest).toISOString();const timeRange={from:from,to:to,mode:"absolute"};let mlTimeSeriesExplorer={};const entityCondition={};if(annotation.timestamp!==undefined&&annotation.end_timestamp!==undefined){mlTimeSeriesExplorer={zoom:{from:new Date(annotation.timestamp).toISOString(),to:new Date(annotation.end_timestamp).toISOString()}};if(annotation.timestamp<dataCounts.earliest_record_timestamp){timeRange.from=new Date(annotation.timestamp).toISOString()}if(annotation.end_timestamp>dataCounts.latest_record_timestamp){timeRange.to=new Date(annotation.end_timestamp).toISOString()}}if(annotation.detector_index!==undefined){mlTimeSeriesExplorer.detectorIndex=annotation.detector_index}if(annotation.partition_field_value!==undefined){entityCondition[annotation.partition_field_name]=annotation.partition_field_value}if(annotation.over_field_value!==undefined){entityCondition[annotation.over_field_name]=annotation.over_field_value}if(annotation.by_field_value!==undefined){entityCondition[annotation.by_field_name]=annotation.by_field_value}mlTimeSeriesExplorer.entities=entityCondition;const mlUrlGenerator=getUrlGenerator(ml_url_generator["a"]);const singleMetricViewerLink=await mlUrlGenerator.createUrl({page:ml_url_generator["b"].SINGLE_METRIC_VIEWER,pageState:{timeRange:timeRange,refreshInterval:{display:"Off",pause:true,value:0},jobIds:[job.job_id],query:{query_string:{analyze_wildcard:true,query:"*"}},...mlTimeSeriesExplorer},excludeBasePath:true});Object(recently_accessed["a"])("timeseriesexplorer",job.job_id,singleMetricViewerLink);await navigateToApp(app["d"],{path:singleMetricViewerLink})});_defineProperty(this,"onMouseOverRow",record=>{if(this.mouseOverRecord!==undefined){if(this.mouseOverRecord.rowId!==record.rowId){table_service["a"].rowMouseleave$.next({record:this.mouseOverRecord,type:"annotation"});table_service["a"].rowMouseenter$.next({record:record,type:"annotation"})}}else{table_service["a"].rowMouseenter$.next({record:record,type:"annotation"})}this.mouseOverRecord=record});_defineProperty(this,"onMouseLeaveRow",()=>{if(this.mouseOverRecord!==undefined){table_service["a"].rowMouseleave$.next({record:this.mouseOverRecord,type:"annotation"});this.mouseOverRecord=undefined}});this.state={annotations:[],aggregations:null,isLoading:false,queryText:`event:(${constants_annotations["b"]} or ${constants_annotations["a"]})`,searchError:undefined,jobId:Array.isArray(this.props.jobs)&&this.props.jobs.length>0&&this.props.jobs[0]!==undefined?this.props.jobs[0].job_id:undefined};this.sorting={sort:{field:"timestamp",direction:"asc"}}}getAnnotations(){const job=this.props.jobs[0];const dataCounts=job.data_counts;this.setState({isLoading:true});if(dataCounts.processed_record_count>0){ml_api_service["ml"].annotations.getAnnotations$({jobIds:[job.job_id],earliestMs:null,latestMs:null,maxAnnotations:constants_search["a"],fields:[{field:"event",missing:constants_annotations["b"]}]}).toPromise().then(resp=>{this.setState((prevState,props)=>({annotations:resp.annotations[props.jobs[0].job_id]||[],aggregations:resp.aggregations,errorMessage:undefined,isLoading:false,jobId:props.jobs[0].job_id}))}).catch(resp=>{console.log("Error loading list of annotations for jobs list:",resp);this.setState({annotations:[],errorMessage:"Error loading the list of annotations for this job",isLoading:false,jobId:undefined})})}}getJob(jobId){if(Array.isArray(this.props.jobs)&&this.props.jobs.length>0){const job=this.props.jobs[0];if(jobId===undefined||job.job_id===jobId){return job}}return job_service["a"].getJob(jobId)}componentDidMount(){if(this.props.annotations===undefined&&Array.isArray(this.props.jobs)&&this.props.jobs.length>0){this.annotationsRefreshSubscription=annotations_service["b"].subscribe(()=>{this.getAnnotations()});Object(annotations_service["c"])()}}componentDidUpdate(){if(Array.isArray(this.props.jobs)&&this.props.jobs.length>0&&this.previousJobId!==this.props.jobs[0].job_id&&this.props.annotations===undefined&&this.state.isLoading===false&&this.state.jobId!==this.props.jobs[0].job_id){Object(annotations_service["c"])();this.previousJobId=this.props.jobs[0].job_id}}componentWillUnmount(){if(this.annotationsRefreshSubscription!==null){this.annotationsRefreshSubscription.unsubscribe()}}render(){var _this$props$aggregati,_this$props$chartDeta5,_this$props$chartDeta6;const{isSingleMetricViewerLinkVisible:isSingleMetricViewerLinkVisible=true,isNumberBadgeVisible:isNumberBadgeVisible=false,annotationUpdatesService:annotationUpdatesService}=this.props;const{queryText:queryText,searchError:searchError}=this.state;if(this.props.annotations===undefined){if(this.state.isLoading===true){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceAround"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLoadingSpinner"],{size:"l"})))}if(this.state.errorMessage!==undefined){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:this.state.errorMessage,color:"danger",iconType:"cross"})}}const annotations=this.props.annotations||this.state.annotations;if(annotations.length===0){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.annotationsTable.annotationsNotCreatedTitle",defaultMessage:"No annotations created for this job"}),iconType:"iInCircle",role:"alert"},this.state.jobId&&Object(job_utils["p"])(this.getJob(this.state.jobId))&&external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.annotationsTable.howToCreateAnnotationDescription",defaultMessage:"To create an annotation, open the {linkToSingleMetricView}",values:{linkToSingleMetricView:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{onClick:()=>this.openSingleMetricView()},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.annotationsTable.howToCreateAnnotationDescription.singleMetricViewerLinkText",defaultMessage:"Single Metric Viewer"}))}})))}const columns=[{field:"annotation",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.annotationsTable.annotationColumnName",{defaultMessage:"Annotation"}),sortable:true,width:"40%",scope:"row"},{field:"timestamp",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.annotationsTable.fromColumnName",{defaultMessage:"From"}),dataType:"date",render:date_utils["d"],sortable:true},{field:"end_timestamp",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.annotationsTable.toColumnName",{defaultMessage:"To"}),dataType:"date",render:date_utils["d"],sortable:true},{field:"modified_time",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.annotationsTable.lastModifiedDateColumnName",{defaultMessage:"Last modified date"}),dataType:"date",render:date_utils["d"],sortable:true},{field:"modified_username",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.annotationsTable.lastModifiedByColumnName",{defaultMessage:"Last modified by"}),sortable:true},{field:"event",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.annotationsTable.eventColumnName",{defaultMessage:"Event"}),sortable:true,width:"10%"}];const jobIds=Object(external_kbnSharedDeps_Lodash_["uniq"])(annotations.map(a=>a.job_id));if(jobIds.length>1){columns.unshift({field:"job_id",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.annotationsTable.jobIdColumnName",{defaultMessage:"job ID"}),sortable:true})}if(isNumberBadgeVisible){columns.unshift({field:"key",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.annotationsTable.labelColumnName",{defaultMessage:"Label"}),sortable:key=>+key,width:"60px",render:key=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBadge"],{color:"default"},key)})}const actions=[];actions.push({render:annotation=>{const annotationId=annotation._id;const originalAnnotation=annotations.find(d=>d._id===annotationId);const editAnnotationsTooltipText=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.annotationsTable.editAnnotationsTooltip",defaultMessage:"Edit annotation"});const editAnnotationsTooltipAriaLabelText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.annotationsTable.editAnnotationsTooltipAriaLabel",{defaultMessage:"Edit annotation"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{position:"bottom",content:editAnnotationsTooltipText},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{onClick:()=>annotationUpdatesService.setValue(originalAnnotation!==null&&originalAnnotation!==void 0?originalAnnotation:annotation),iconType:"pencil","aria-label":editAnnotationsTooltipAriaLabelText}))}});if(isSingleMetricViewerLinkVisible){actions.push({render:annotation=>{const isDrillDownAvailable=Object(job_utils["p"])(this.getJob(annotation.job_id));const openInSingleMetricViewerTooltipText=isDrillDownAvailable?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.annotationsTable.openInSingleMetricViewerTooltip",defaultMessage:"Open in Single Metric Viewer"}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.annotationsTable.jobConfigurationNotSupportedInSingleMetricViewerTooltip",defaultMessage:"Job configuration not supported in Single Metric Viewer"});const openInSingleMetricViewerAriaLabelText=isDrillDownAvailable?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.annotationsTable.openInSingleMetricViewerAriaLabel",{defaultMessage:"Open in Single Metric Viewer"}):external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.annotationsTable.jobConfigurationNotSupportedInSingleMetricViewerAriaLabel",{defaultMessage:"Job configuration not supported in Single Metric Viewer"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{position:"bottom",content:openInSingleMetricViewerTooltipText},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{onClick:()=>this.openSingleMetricView(annotation),disabled:!isDrillDownAvailable,iconType:"visLine","aria-label":openInSingleMetricViewerAriaLabelText}))}})}const getRowProps=item=>({onMouseOver:()=>this.onMouseOverRow(item),onMouseLeave:()=>this.onMouseLeaveRow()});let filterOptions=[];const aggregations=(_this$props$aggregati=this.props.aggregations)!==null&&_this$props$aggregati!==void 0?_this$props$aggregati:this.state.aggregations;if(aggregations){const buckets=aggregations.event.buckets;let foundUser=false;let foundDelayedData=false;buckets.forEach(bucket=>{if(bucket.key===constants_annotations["b"]){foundUser=true}if(bucket.key===constants_annotations["a"]){foundDelayedData=true}});const adjustedBuckets=[];if(!foundUser){adjustedBuckets.push({key:constants_annotations["b"],doc_count:0})}if(!foundDelayedData){adjustedBuckets.push({key:constants_annotations["a"],doc_count:0})}filterOptions=[...adjustedBuckets,...buckets]}const filters=[{type:"field_value_selection",field:"event",name:"Event",multiSelect:"or",options:filterOptions.map(field=>({value:field.key,name:field.key,view:`${field.key} (${field.doc_count})`}))}];if(this.props.detectors){columns.push({name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.annotationsTable.detectorColumnName",{defaultMessage:"Detector"}),width:"10%",render:item=>{if("detector_index"in item){return this.props.detectors[item.detector_index].detector_description}return""}})}if(Array.isArray((_this$props$chartDeta5=this.props.chartDetails)===null||_this$props$chartDeta5===void 0?void 0:(_this$props$chartDeta6=_this$props$chartDeta5.entityData)===null||_this$props$chartDeta6===void 0?void 0:_this$props$chartDeta6.entities)){var _this$props$chartDeta7,_this$props$chartDeta8;(_this$props$chartDeta7=this.props.chartDetails)===null||_this$props$chartDeta7===void 0?void 0:(_this$props$chartDeta8=_this$props$chartDeta7.entityData)===null||_this$props$chartDeta8===void 0?void 0:_this$props$chartDeta8.entities.forEach(entity=>{if(entity.fieldType==="partition_field"){columns.push({field:"partition_field_value",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.annotationsTable.partitionSMVColumnName",{defaultMessage:"Partition"}),sortable:true})}if(entity.fieldType==="over_field"){columns.push({field:"over_field_value",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.annotationsTable.overColumnSMVName",{defaultMessage:"Over"}),sortable:true})}if(entity.fieldType==="by_field"){columns.push({field:"by_field_value",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.annotationsTable.byColumnSMVName",{defaultMessage:"By"}),sortable:true})}});filters.push({type:"is",field:CURRENT_SERIES,name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.annotationsTable.seriesOnlyFilterName",{defaultMessage:"Filter to series"})})}else{columns.push({field:"partition_field_value",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.annotationsTable.partitionAEColumnName",{defaultMessage:"Partition"}),sortable:true});columns.push({field:"over_field_value",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.annotationsTable.overAEColumnName",{defaultMessage:"Over"}),sortable:true});columns.push({field:"by_field_value",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.annotationsTable.byAEColumnName",{defaultMessage:"By"}),sortable:true})}const search={defaultQuery:queryText,box:{incremental:true,schema:true},filters:filters};columns.push({align:external_kbnSharedDeps_ElasticEuiLibServices_["RIGHT_ALIGNMENT"],width:"60px",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.annotationsTable.actionsColumnName",{defaultMessage:"Actions"}),actions:actions},{field:CURRENT_SERIES,name:CURRENT_SERIES,dataType:"boolean",width:"0px",render:()=>""});const items=this.getAnnotationsWithExtraInfo(annotations);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiInMemoryTable"],{error:searchError,className:"eui-textOverflowWrap",compressed:true,items:items,columns:columns,pagination:{pageSizeOptions:[5,10,25]},sorting:this.sorting,search:search,rowProps:getRowProps}))}}const AnnotationsTable=Object(public_["withKibana"])(props=>{const annotationUpdatesService=Object(external_kbnSharedDeps_React_["useContext"])(ml_annotation_updates_context["a"]);return external_kbnSharedDeps_React_default.a.createElement(annotations_table_AnnotationsTableUI,_extends({annotationUpdatesService:annotationUpdatesService},props))})},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return DeleteJobCheckModal}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(34);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(33);var kibana=__webpack_require__(58);var toast_notification_service=__webpack_require__(72);const shouldUnTagLabel=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.deleteJobCheckModal.shouldUnTagLabel",{defaultMessage:"Remove job from current space"});function getRespSummary(resp){const jobsChecked=Object.keys(resp);const{canDelete:canDelete,canRemoveFromSpace:canRemoveFromSpace}=resp[jobsChecked[0]];let canTakeAnyAction=true;if(jobsChecked.length>1){canTakeAnyAction=jobsChecked.every(id=>resp[id].canDelete===canDelete&&resp[id].canRemoveFromSpace===canRemoveFromSpace)}return{canDelete:canDelete,canRemoveFromSpace:canRemoveFromSpace,canTakeAnyAction:canTakeAnyAction}}function getModalContent(jobIds,respSummary){const{canDelete:canDelete,canRemoveFromSpace:canRemoveFromSpace,canTakeAnyAction:canTakeAnyAction}=respSummary;if(canTakeAnyAction===false){return{buttonText:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.deleteJobCheckModal.buttonTextNoAction",defaultMessage:"Close"}),modalText:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.deleteJobCheckModal.modalTextNoAction",defaultMessage:"{ids} have different space permissions. When you delete multiple jobs, they must have the same permissions. Deselect the jobs and try deleting each job individually.",values:{ids:jobIds.join(", ")}}))}}const noActionContent={buttonText:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.deleteJobCheckModal.buttonTextClose",defaultMessage:"Close"}),modalText:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.deleteJobCheckModal.modalTextClose",defaultMessage:"{ids} cannot be deleted and cannot be removed from the current space. This job is assigned to the * space and you do not have access to all spaces.",values:{ids:jobIds.join(", ")}}))};if(canDelete){return{buttonText:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.deleteJobCheckModal.buttonTextCanDelete",defaultMessage:"Continue to delete {length, plural, one {# job} other {# jobs}}",values:{length:jobIds.length}}),modalText:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.deleteJobCheckModal.modalTextCanDelete",defaultMessage:"{ids} can be deleted.",values:{ids:jobIds.join(", ")}}))}}else if(canRemoveFromSpace){return{buttonText:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.deleteJobCheckModal.buttonTextCanUnTagConfirm",defaultMessage:"Remove from current space"}),modalText:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.deleteJobCheckModal.modalTextCanUnTag",defaultMessage:"{ids} cannot be deleted but can be removed from the current space.",values:{ids:jobIds.join(", ")}}))}}else{return noActionContent}}const DeleteJobCheckModal=({canDeleteCallback:canDeleteCallback,onCloseCallback:onCloseCallback,refreshJobsCallback:refreshJobsCallback,jobType:jobType,jobIds:jobIds,setDidUntag:setDidUntag})=>{const[buttonContent,setButtonContent]=Object(external_kbnSharedDeps_React_["useState"])();const[modalContent,setModalContent]=Object(external_kbnSharedDeps_React_["useState"])();const[hasUntagged,setHasUntagged]=Object(external_kbnSharedDeps_React_["useState"])(false);const[isUntagging,setIsUntagging]=Object(external_kbnSharedDeps_React_["useState"])(false);const[isLoading,setIsLoading]=Object(external_kbnSharedDeps_React_["useState"])(false);const[jobCheckRespSummary,setJobCheckRespSummary]=Object(external_kbnSharedDeps_React_["useState"])();const{savedObjects:{canDeleteJob:canDeleteJob,removeJobFromCurrentSpace:removeJobFromCurrentSpace}}=Object(kibana["a"])();const{displayErrorToast:displayErrorToast,displaySuccessToast:displaySuccessToast}=Object(toast_notification_service["c"])();Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setIsLoading(true);canDeleteJob(jobType,jobIds).then(resp=>{const respSummary=getRespSummary(resp);const{canDelete:canDelete,canRemoveFromSpace:canRemoveFromSpace,canTakeAnyAction:canTakeAnyAction}=respSummary;if(canTakeAnyAction&&canDelete&&!canRemoveFromSpace){canDeleteCallback();return}setJobCheckRespSummary(respSummary);const{buttonText:buttonText,modalText:modalText}=getModalContent(jobIds,respSummary);setButtonContent(buttonText);setModalContent(modalText)});if(typeof setDidUntag==="function"){setDidUntag(false)}setIsLoading(false)},[]);const onUntagClick=async()=>{setIsUntagging(true);const resp=await removeJobFromCurrentSpace(jobType,jobIds);setIsUntagging(false);if(typeof setDidUntag==="function"){setDidUntag(true)}Object.entries(resp).forEach(([id,{success:success,error:error}])=>{if(success===false){const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.deleteJobCheckModal.unTagErrorTitle",{defaultMessage:"Error updating {id}",values:{id:id}});displayErrorToast(error,title)}else{setHasUntagged(true);const message=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.deleteJobCheckModal.unTagSuccessTitle",{defaultMessage:"Successfully updated {id}",values:{id:id}});displaySuccessToast(message)}});onCloseCallback();if(typeof refreshJobsCallback==="function"){refreshJobsCallback()}};const onClick=async()=>{if(jobCheckRespSummary!==null&&jobCheckRespSummary!==void 0&&jobCheckRespSummary.canTakeAnyAction&&jobCheckRespSummary!==null&&jobCheckRespSummary!==void 0&&jobCheckRespSummary.canDelete){canDeleteCallback()}else{onCloseCallback()}};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModal"],{onClose:onCloseCallback,"data-test-subj":"mlAnalyticsJobDeleteCheckOverlay"},isLoading===true&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceAround"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLoadingSpinner"],{size:"xl"}))))),isLoading===false&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalHeaderTitle"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.deleteJobCheckModal.modalTitle",defaultMessage:"Checking space permissions"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalBody"],null,modalContent),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalFooter"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},!hasUntagged&&(jobCheckRespSummary===null||jobCheckRespSummary===void 0?void 0:jobCheckRespSummary.canTakeAnyAction)&&(jobCheckRespSummary===null||jobCheckRespSummary===void 0?void 0:jobCheckRespSummary.canRemoveFromSpace)&&(jobCheckRespSummary===null||jobCheckRespSummary===void 0?void 0:jobCheckRespSummary.canDelete)&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{isLoading:isUntagging,color:"primary",size:"s",onClick:onUntagClick},shouldUnTagLabel)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{size:"s",onClick:jobCheckRespSummary!==null&&jobCheckRespSummary!==void 0&&jobCheckRespSummary.canTakeAnyAction&&jobCheckRespSummary!==null&&jobCheckRespSummary!==void 0&&jobCheckRespSummary.canRemoveFromSpace&&!(jobCheckRespSummary!==null&&jobCheckRespSummary!==void 0&&jobCheckRespSummary.canDelete)?onUntagClick:onClick,fill:true},buttonContent))))))}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return LoadingWrapper}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(33);const LoadingWrapper=({hasData:hasData,loading:loading=false,height:height,children:children})=>{const opacity=loading===true?hasData===true?.3:0:1;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement("div",{style:{height:"100%",opacity:opacity,transition:"opacity 0.2s"}},children),loading===true&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceAround",alignItems:"center",style:height!==undefined?{height:height,marginTop:`-${height}`}:{}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLoadingSpinner"],{size:"xl"}))))}},,,,,,,,,,,,,,,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return setUpgradeInProgress}));__webpack_require__.d(__webpack_exports__,"a",(function(){return isUpgradeInProgress}));let upgradeInProgress=false;function setUpgradeInProgress(show){upgradeInProgress=show}function isUpgradeInProgress(){return upgradeInProgress}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return mlCalendarService}));var _kbn_i18n__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2);var _kbn_i18n__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__);var _ml_api_service__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(59);class CalendarService{async assignNewJobId(calendar,jobId){const{calendar_id:calendarId}=calendar;try{await _ml_api_service__WEBPACK_IMPORTED_MODULE_1__["ml"].updateCalendar({...calendar,calendarId:calendarId,job_ids:[...calendar.job_ids,jobId]})}catch(e){throw new Error(_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.calendarService.assignNewJobIdErrorMessage",{defaultMessage:"Unable to assign {jobId} to {calendarId}",values:{calendarId:calendarId,jobId:jobId}}))}}async fetchCalendarsByIds(calendarIds){try{const calendars=await _ml_api_service__WEBPACK_IMPORTED_MODULE_1__["ml"].calendars({calendarIds:calendarIds});return Array.isArray(calendars)?calendars:[calendars]}catch(e){throw new Error(_kbn_i18n__WEBPACK_IMPORTED_MODULE_0__["i18n"].translate("xpack.ml.calendarService.fetchCalendarsByIdsErrorMessage",{defaultMessage:"Unable to fetch calendars: {calendarIds}",values:{calendarIds:calendarIds.join(", ")}}))}}}const mlCalendarService=new CalendarService},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.installXJsonMode=exports.XJsonMode=exports.addXJsonToRules=exports.XJsonHighlightRules=exports.ScriptHighlightRules=exports.ElasticsearchSqlHighlightRules=void 0;var modes_1=__webpack_require__(291);Object.defineProperty(exports,"ElasticsearchSqlHighlightRules",{enumerable:true,get:function(){return modes_1.ElasticsearchSqlHighlightRules}});Object.defineProperty(exports,"ScriptHighlightRules",{enumerable:true,get:function(){return modes_1.ScriptHighlightRules}});Object.defineProperty(exports,"XJsonHighlightRules",{enumerable:true,get:function(){return modes_1.XJsonHighlightRules}});Object.defineProperty(exports,"addXJsonToRules",{enumerable:true,get:function(){return modes_1.addXJsonToRules}});Object.defineProperty(exports,"XJsonMode",{enumerable:true,get:function(){return modes_1.XJsonMode}});Object.defineProperty(exports,"installXJsonMode",{enumerable:true,get:function(){return modes_1.installXJsonMode}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.XJsonMode=exports.installXJsonMode=exports.addXJsonToRules=exports.XJsonHighlightRules=exports.ScriptHighlightRules=exports.ElasticsearchSqlHighlightRules=void 0;var lexer_rules_1=__webpack_require__(432);Object.defineProperty(exports,"ElasticsearchSqlHighlightRules",{enumerable:true,get:function(){return lexer_rules_1.ElasticsearchSqlHighlightRules}});Object.defineProperty(exports,"ScriptHighlightRules",{enumerable:true,get:function(){return lexer_rules_1.ScriptHighlightRules}});Object.defineProperty(exports,"XJsonHighlightRules",{enumerable:true,get:function(){return lexer_rules_1.XJsonHighlightRules}});Object.defineProperty(exports,"addXJsonToRules",{enumerable:true,get:function(){return lexer_rules_1.addXJsonToRules}});var x_json_1=__webpack_require__(436);Object.defineProperty(exports,"installXJsonMode",{enumerable:true,get:function(){return x_json_1.installXJsonMode}});Object.defineProperty(exports,"XJsonMode",{enumerable:true,get:function(){return x_json_1.XJsonMode}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ElasticsearchSqlHighlightRules=void 0;const tslib_1=__webpack_require__(38);const brace_1=tslib_1.__importDefault(__webpack_require__(184));const{TextHighlightRules:TextHighlightRules}=brace_1.default.acequire("ace/mode/text_highlight_rules");const oop=brace_1.default.acequire("ace/lib/oop");const ElasticsearchSqlHighlightRules=function(){const keywords="describe|between|in|like|not|and|or|desc|select|from|where|having|group|by|order"+"asc|desc|pivot|for|in|as|show|columns|include|frozen|tables|escape|limit|rlike|all|distinct|is";const builtinConstants="true|false";const builtinFunctions="avg|count|first|first_value|last|last_value|max|min|sum|kurtosis|mad|percentile|percentile_rank|skewness"+"|stddev_pop|sum_of_squares|var_pop|histogram|case|coalesce|greatest|ifnull|iif|isnull|least|nullif|nvl"+"|curdate|current_date|current_time|current_timestamp|curtime|dateadd|datediff|datepart|datetrunc|date_add"+"|date_diff|date_part|date_trunc|day|dayname|dayofmonth|dayofweek|dayofyear|day_name|day_of_month|day_of_week"+"|day_of_year|dom|dow|doy|hour|hour_of_day|idow|isodayofweek|isodow|isoweek|isoweekofyear|iso_day_of_week|iso_week_of_year"+"|iw|iwoy|minute|minute_of_day|minute_of_hour|month|monthname|month_name|month_of_year|now|quarter|second|second_of_minute"+"|timestampadd|timestampdiff|timestamp_add|timestamp_diff|today|week|week_of_year|year|abs|acos|asin|atan|atan2|cbrt"+"|ceil|ceiling|cos|cosh|cot|degrees|e|exp|expm1|floor|log|log10|mod|pi|power|radians|rand|random|round|sign|signum|sin"+"|sinh|sqrt|tan|truncate|ascii|bit_length|char|character_length|char_length|concat|insert|lcase|left|length|locate"+"|ltrim|octet_length|position|repeat|replace|right|rtrim|space|substring|ucase|cast|convert|database|user|st_astext|st_aswkt"+"|st_distance|st_geometrytype|st_geomfromtext|st_wkttosql|st_x|st_y|st_z|score";const dataTypes="null|boolean|byte|short|integer|long|double|float|half_float|scaled_float|keyword|text|binary|date|ip|object|nested|time"+"|interval_year|interval_month|interval_day|interval_hour|interval_minute|interval_second|interval_year_to_month"+"inteval_day_to_hour|interval_day_to_minute|interval_day_to_second|interval_hour_to_minute|interval_hour_to_second"+"interval_minute_to_second|geo_point|geo_shape|shape";const keywordMapper=this.createKeywordMapper({keyword:[keywords,builtinFunctions,builtinConstants,dataTypes].join("|")},"identifier",true);this.$rules={start:[{token:"comment",regex:"--.*$"},{token:"comment",start:"/\\*",end:"\\*/"},{token:"string",regex:'".*?"'},{token:"constant",regex:"'.*?'"},{token:"string",regex:"`.*?`"},{token:"entity.name.function",regex:"[+-]?\\d+(?:(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)?\\b"},{token:keywordMapper,regex:"[a-zA-Z_$][a-zA-Z0-9_$]*\\b"},{token:"keyword.operator",regex:"⇐|<⇒|\\*|\\.|\\:\\:|\\+|\\-|\\/|\\/\\/|%|&|\\^|~|<|>|<=|=>|==|!=|<>|="},{token:"paren.lparen",regex:"[\\(]"},{token:"paren.rparen",regex:"[\\)]"},{token:"text",regex:"\\s+"}]};this.normalizeRules()};exports.ElasticsearchSqlHighlightRules=ElasticsearchSqlHighlightRules;oop.inherits(exports.ElasticsearchSqlHighlightRules,TextHighlightRules)},function(module,exports){module.exports=function(){throw new Error("define cannot be used indirect")}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ScriptHighlightRules=void 0;const tslib_1=__webpack_require__(38);const brace_1=tslib_1.__importDefault(__webpack_require__(184));const oop=brace_1.default.acequire("ace/lib/oop");const{TextHighlightRules:TextHighlightRules}=brace_1.default.acequire("ace/mode/text_highlight_rules");const painlessKeywords="def|int|long|byte|String|float|double|char|null|if|else|while|do|for|continue|break|new|try|catch|throw|this|instanceof|return|ctx";function ScriptHighlightRules(){this.name="ScriptHighlightRules";this.$rules={start:[{token:"script.comment",regex:"\\/\\/.*$"},{token:"script.string.regexp",regex:"[/](?:(?:\\[(?:\\\\]|[^\\]])+\\])|(?:\\\\/|[^\\]/]))*[/]\\w*\\s*(?=[).,;]|$)"},{token:"script.string",regex:"['](?:(?:\\\\.)|(?:[^'\\\\]))*?[']"},{token:"script.constant.numeric",regex:"0[xX][0-9a-fA-F]+\\b"},{token:"script.constant.numeric",regex:"[+-]?\\d+(?:(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)?\\b"},{token:"script.constant.language.boolean",regex:"(?:true|false)\\b"},{token:"script.keyword",regex:painlessKeywords},{token:"script.text",regex:"[a-zA-Z_$][a-zA-Z0-9_$]*\\b"},{token:"script.keyword.operator",regex:"\\?\\.|\\*\\.|=~|==~|!|%|&|\\*|\\-\\-|\\-|\\+\\+|\\+|~|===|==|=|!=|!==|<=|>=|<<=|>>=|>>>=|<>|<|>|->|!|&&|\\|\\||\\?\\:|\\*=|%=|\\+=|\\-=|&=|\\^=|\\b(?:in|instanceof|new|typeof|void)"},{token:"script.lparen",regex:"[[({]"},{token:"script.rparen",regex:"[\\])}]"},{token:"script.text",regex:"\\s+"}]}}exports.ScriptHighlightRules=ScriptHighlightRules;oop.inherits(ScriptHighlightRules,TextHighlightRules)},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return Axes}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(10);var react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);var _elastic_charts__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(37);var _elastic_charts__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_elastic_charts__WEBPACK_IMPORTED_MODULE_1__);var _utils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(296);const dateFormatter=Object(_elastic_charts__WEBPACK_IMPORTED_MODULE_1__["timeFormatter"])(Object(_elastic_charts__WEBPACK_IMPORTED_MODULE_1__["niceTimeFormatByDay"])(3));function tickFormatter(d){return(Math.round(d*100)/100).toString()}const Axes=({chartData:chartData})=>{const yDomain=chartData!==undefined?Object(_utils__WEBPACK_IMPORTED_MODULE_2__["b"])(chartData):undefined;return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_0__["Fragment"],null,react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_charts__WEBPACK_IMPORTED_MODULE_1__["Axis"],{id:"bottom",position:_elastic_charts__WEBPACK_IMPORTED_MODULE_1__["Position"].Bottom,showOverlappingTicks:true,tickFormat:dateFormatter}),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_charts__WEBPACK_IMPORTED_MODULE_1__["Axis"],{id:"left",position:_elastic_charts__WEBPACK_IMPORTED_MODULE_1__["Position"].Left,tickFormat:tickFormatter,domain:yDomain}))}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return getYRange}));__webpack_require__.d(__webpack_exports__,"a",(function(){return getXRange}));function getYRange(chartData){if(chartData.length===0){return{min:0,max:0}}let max=Number.MIN_VALUE;let min=Number.MAX_VALUE;chartData.forEach(r=>{max=Math.max(r.value,max);min=Math.min(r.value,min)});const padding=(max-min)*.1;max+=padding;min-=padding;return{min:min,max:max}}function getXRange(lineChartData){if(lineChartData.length===0){return{min:0,max:0}}return{min:lineChartData[0].time,max:lineChartData[lineChartData.length-1].time}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return Anomalies}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(10);var react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);var _elastic_charts__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(37);var _elastic_charts__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_elastic_charts__WEBPACK_IMPORTED_MODULE_1__);var _common_util_anomaly_utils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(6);var _common_constants_anomalies__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(1);function getAnomalyStyle(threshold){return{line:{stroke:Object(_common_util_anomaly_utils__WEBPACK_IMPORTED_MODULE_2__["i"])(threshold),strokeWidth:3,opacity:1}}}function splitAnomalySeverities(anomalies){const severities={critical:[],major:[],minor:[],warning:[],unknown:[],low:[]};anomalies.forEach(a=>{if(a.value!==0){severities[a.severity].push({dataValue:a.time})}});return severities}const Anomalies=({anomalyData:anomalyData})=>{const anomalies=anomalyData===undefined?[]:anomalyData;const severities=splitAnomalySeverities(anomalies);return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_0__["Fragment"],null,react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_charts__WEBPACK_IMPORTED_MODULE_1__["LineAnnotation"],{id:"low",domainType:_elastic_charts__WEBPACK_IMPORTED_MODULE_1__["AnnotationDomainTypes"].XDomain,dataValues:severities.low,style:getAnomalyStyle(_common_constants_anomalies__WEBPACK_IMPORTED_MODULE_3__["c"].LOW),hideTooltips:true}),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_charts__WEBPACK_IMPORTED_MODULE_1__["LineAnnotation"],{id:"warning",domainType:_elastic_charts__WEBPACK_IMPORTED_MODULE_1__["AnnotationDomainTypes"].XDomain,dataValues:severities.warning,style:getAnomalyStyle(_common_constants_anomalies__WEBPACK_IMPORTED_MODULE_3__["c"].WARNING),hideTooltips:true}),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_charts__WEBPACK_IMPORTED_MODULE_1__["LineAnnotation"],{id:"minor",domainType:_elastic_charts__WEBPACK_IMPORTED_MODULE_1__["AnnotationDomainTypes"].XDomain,dataValues:severities.minor,style:getAnomalyStyle(_common_constants_anomalies__WEBPACK_IMPORTED_MODULE_3__["c"].MINOR),hideTooltips:true}),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_charts__WEBPACK_IMPORTED_MODULE_1__["LineAnnotation"],{id:"major",domainType:_elastic_charts__WEBPACK_IMPORTED_MODULE_1__["AnnotationDomainTypes"].XDomain,dataValues:severities.major,style:getAnomalyStyle(_common_constants_anomalies__WEBPACK_IMPORTED_MODULE_3__["c"].MAJOR),hideTooltips:true}),react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(_elastic_charts__WEBPACK_IMPORTED_MODULE_1__["LineAnnotation"],{id:"critical",domainType:_elastic_charts__WEBPACK_IMPORTED_MODULE_1__["AnnotationDomainTypes"].XDomain,dataValues:severities.critical,style:getAnomalyStyle(_common_constants_anomalies__WEBPACK_IMPORTED_MODULE_3__["c"].CRITICAL),hideTooltips:true}))}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"c",(function(){return saveJob}));__webpack_require__.d(__webpack_exports__,"b",(function(){return loadSavedDashboards}));__webpack_require__.d(__webpack_exports__,"a",(function(){return loadIndexPatterns}));var lodash__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(5);var lodash__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__);var _services_ml_server_info__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(83);var _common_util_job_utils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(64);var _util_dependency_cache__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(18);var _services_ml_api_service__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(59);function saveJob(job,newJobData,finish){return new Promise((resolve,reject)=>{const jobData={...extractDescription(job,newJobData),...extractGroups(job,newJobData),...extractMML(job,newJobData),...extractModelSnapshotRetentionDays(job,newJobData),...extractDailyModelSnapshotRetentionAfterDays(job,newJobData),...extractDetectorDescriptions(job,newJobData),...extractCustomSettings(job,newJobData)};const datafeedData={...extractDatafeed(job,newJobData)};if(jobData.custom_settings!==undefined){jobData.custom_settings=processCustomSettings(jobData,datafeedData)}const saveDatafeedWrapper=()=>{saveDatafeed(datafeedData,job,finish).then(()=>{resolve()}).catch(error=>{reject(error)})};if(Object.keys(jobData).length){_services_ml_api_service__WEBPACK_IMPORTED_MODULE_4__["ml"].updateJob({jobId:job.job_id,job:jobData}).then(()=>{saveDatafeedWrapper()}).catch(error=>{reject(error)})}else{saveDatafeedWrapper()}})}function saveDatafeed(datafeedConfig,job){return new Promise((resolve,reject)=>{if(Object.keys(datafeedConfig).length){const datafeedId=job.datafeed_config.datafeed_id;_services_ml_api_service__WEBPACK_IMPORTED_MODULE_4__["ml"].updateDatafeed({datafeedId:datafeedId,datafeedConfig:datafeedConfig}).then(()=>{resolve()}).catch(error=>{reject(error)})}else{resolve()}})}function loadSavedDashboards(maxNumber){return new Promise((resolve,reject)=>{const savedObjectsClient=Object(_util_dependency_cache__WEBPACK_IMPORTED_MODULE_3__["h"])();savedObjectsClient.find({type:"dashboard",fields:["title"],perPage:maxNumber}).then(resp=>{const savedObjects=resp.savedObjects;if(savedObjects!==undefined){const dashboards=savedObjects.map(savedObj=>({id:savedObj.id,title:savedObj.attributes.title}));dashboards.sort((dash1,dash2)=>dash1.title.localeCompare(dash2.title));resolve(dashboards)}}).catch(resp=>{reject(resp)})})}function loadIndexPatterns(maxNumber){return new Promise((resolve,reject)=>{const savedObjectsClient=Object(_util_dependency_cache__WEBPACK_IMPORTED_MODULE_3__["h"])();savedObjectsClient.find({type:"index-pattern",fields:["title"],perPage:maxNumber}).then(resp=>{const savedObjects=resp.savedObjects;if(savedObjects!==undefined){const indexPatterns=savedObjects.map(savedObj=>({id:savedObj.id,title:savedObj.attributes.title}));indexPatterns.sort((dash1,dash2)=>dash1.title.localeCompare(dash2.title));resolve(indexPatterns)}}).catch(resp=>{reject(resp)})})}function extractDescription(job,newJobData){const description=newJobData.description;if(newJobData.description!==job.description){return{description:description}}return{}}function extractGroups(job,newJobData){const groups=newJobData.groups;if(newJobData.groups!==undefined){const diffCount=Object(lodash__WEBPACK_IMPORTED_MODULE_0__["difference"])(job.groups,groups).length+Object(lodash__WEBPACK_IMPORTED_MODULE_0__["difference"])(groups,job.groups).length;return diffCount===0?{}:{groups:groups}}return{}}function extractMML(job,newJobData){const jobLimits=Object(_services_ml_server_info__WEBPACK_IMPORTED_MODULE_1__["c"])();const mmlData={};if(job.analysis_limits.model_memory_limit!==undefined){let{mml:mml}=newJobData;if(mml===""){mml=jobLimits.max_model_memory_limit}if(mml!==job.analysis_limits.model_memory_limit){mmlData.analysis_limits={model_memory_limit:mml}}}return mmlData}function extractModelSnapshotRetentionDays(job,newJobData){const modelSnapshotRetentionDays=newJobData.modelSnapshotRetentionDays;if(modelSnapshotRetentionDays!==job.model_snapshot_retention_days){return{model_snapshot_retention_days:modelSnapshotRetentionDays}}return{}}function extractDailyModelSnapshotRetentionAfterDays(job,newJobData){const dailyModelSnapshotRetentionAfterDays=newJobData.dailyModelSnapshotRetentionAfterDays;if(dailyModelSnapshotRetentionAfterDays!==job.daily_model_snapshot_retention_after_days){return{daily_model_snapshot_retention_after_days:dailyModelSnapshotRetentionAfterDays}}return{}}function extractDetectorDescriptions(job,newJobData){const detectors=[];const descriptions=newJobData.detectorDescriptions.map((d,i)=>({detector_index:i,description:d}));const originalDetectors=job.analysis_config.detectors;originalDetectors.forEach(d=>{if(descriptions[d.detector_index].description!==d.detector_description){detectors.push(descriptions[d.detector_index])}});return detectors.length?{detectors:detectors}:{}}function extractCustomSettings(job,newJobData){const settingsData={};if(newJobData&&newJobData.customUrls){settingsData.custom_settings=job.custom_settings||{};settingsData.custom_settings.custom_urls=newJobData.customUrls}return settingsData}function extractDatafeed(job,newDatafeedData){const datafeedData={};if(job.datafeed_config!==undefined){const origQueryString=JSON.stringify(job.datafeed_config.query);const newQuery=JSON.parse(newDatafeedData.datafeedQuery);const newQueryString=JSON.stringify(newQuery);if(origQueryString!==newQueryString){datafeedData.query=newQuery}if(job.datafeed_config.query_delay!==newDatafeedData.datafeedQueryDelay){datafeedData.query_delay=newDatafeedData.datafeedQueryDelay}if(job.datafeed_config.frequency!==newDatafeedData.datafeedFrequency&&newDatafeedData.datafeedFrequency!==""){datafeedData.frequency=newDatafeedData.datafeedFrequency}if(job.datafeed_config.scroll_size!==newDatafeedData.datafeedScrollSize){datafeedData.scroll_size=newDatafeedData.datafeedScrollSize}}return datafeedData}function processCustomSettings(jobData,datafeedData){let customSettings={};if(jobData.custom_settings!==undefined){customSettings={...jobData.custom_settings};if(jobData.custom_settings.created_by!==undefined&&(jobData.detectors!==undefined||Object.keys(datafeedData).length)){Object(_common_util_job_utils__WEBPACK_IMPORTED_MODULE_2__["r"])(customSettings)}}return customSettings}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return MlAnomalyAlertFlyout}));__webpack_require__.d(__webpack_exports__,"a",(function(){return JobListMlAnomalyAlertFlyout}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(10);var react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);var _application_contexts_kibana__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(58);var _common_constants_alerts__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(28);var _common_constants_app__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(4);const MlAnomalyAlertFlyout=({jobIds:jobIds,onCloseFlyout:onCloseFlyout,onSave:onSave})=>{const{services:{triggersActionsUi:triggersActionsUi}}=Object(_application_contexts_kibana__WEBPACK_IMPORTED_MODULE_1__["b"])();const AddAlertFlyout=Object(react__WEBPACK_IMPORTED_MODULE_0__["useMemo"])(()=>triggersActionsUi&&triggersActionsUi.getAddAlertFlyout({consumer:_common_constants_app__WEBPACK_IMPORTED_MODULE_3__["d"],onClose:()=>{onCloseFlyout()},reloadAlerts:async()=>{if(onSave){onSave()}},canChangeTrigger:false,alertTypeId:_common_constants_alerts__WEBPACK_IMPORTED_MODULE_2__["b"].ANOMALY_DETECTION,metadata:{},initialValues:{params:{jobSelection:{jobIds:jobIds}}}}),[triggersActionsUi]);return react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(react__WEBPACK_IMPORTED_MODULE_0___default.a.Fragment,null,AddAlertFlyout)};const JobListMlAnomalyAlertFlyout=({setShowFunction:setShowFunction,unsetShowFunction:unsetShowFunction})=>{const[isVisible,setIsVisible]=Object(react__WEBPACK_IMPORTED_MODULE_0__["useState"])(false);const[jobIds,setJobIds]=Object(react__WEBPACK_IMPORTED_MODULE_0__["useState"])();const showFlyoutCallback=Object(react__WEBPACK_IMPORTED_MODULE_0__["useCallback"])(jobIdsUpdate=>{setJobIds(jobIdsUpdate);setIsVisible(true)},[]);Object(react__WEBPACK_IMPORTED_MODULE_0__["useEffect"])(()=>{setShowFunction(showFlyoutCallback);return()=>{unsetShowFunction()}},[]);return isVisible&&jobIds?react__WEBPACK_IMPORTED_MODULE_0___default.a.createElement(MlAnomalyAlertFlyout,{jobIds:jobIds,onCloseFlyout:()=>setIsVisible(false),onSave:()=>{setIsVisible(false)}}):null}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return useTableSettings}));var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(10);var react__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);const PAGE_SIZE_OPTIONS=[10,25,50];function useTableSettings(items,pageState,updatePageState){const{pageIndex:pageIndex,pageSize:pageSize,sortField:sortField,sortDirection:sortDirection}=pageState;const onTableChange=Object(react__WEBPACK_IMPORTED_MODULE_0__["useCallback"])(({page:page,sort:sort})=>{var _page$index,_page$size,_ref,_sort$direction;const result={pageIndex:(_page$index=page===null||page===void 0?void 0:page.index)!==null&&_page$index!==void 0?_page$index:pageState.pageIndex,pageSize:(_page$size=page===null||page===void 0?void 0:page.size)!==null&&_page$size!==void 0?_page$size:pageState.pageSize,sortField:(_ref=sort===null||sort===void 0?void 0:sort.field)!==null&&_ref!==void 0?_ref:pageState.sortField,sortDirection:(_sort$direction=sort===null||sort===void 0?void 0:sort.direction)!==null&&_sort$direction!==void 0?_sort$direction:pageState.sortDirection};updatePageState(result)},[pageState,updatePageState]);const pagination=Object(react__WEBPACK_IMPORTED_MODULE_0__["useMemo"])(()=>({pageIndex:pageIndex,pageSize:pageSize,totalItemCount:items.length,pageSizeOptions:PAGE_SIZE_OPTIONS}),[items,pageIndex,pageSize]);const sorting=Object(react__WEBPACK_IMPORTED_MODULE_0__["useMemo"])(()=>({sort:{field:sortField,direction:sortDirection}}),[sortField,sortDirection]);return{onTableChange:onTableChange,pagination:pagination,sorting:sorting}}},function(module,exports){},function(module,exports,__webpack_require__){exports.format_value=__webpack_require__(161).format_value;exports.parse_value=__webpack_require__(161).parse_value;exports.RRule=__webpack_require__(189).RRule;exports.parse_calendar=__webpack_require__(303).parse_calendar;exports.ParseError=__webpack_require__(303).ParseError;exports.CalendarObject=__webpack_require__(102).CalendarObject;exports.CalendarProperty=__webpack_require__(102).CalendarProperty;exports.iCalendar=__webpack_require__(190).iCalendar;exports.VEvent=__webpack_require__(465).VEvent;exports.VTimezone=__webpack_require__(466).VTimezone;exports.PRODID="-//Tri Tech Computers//node-icalendar//EN"},function(module,exports,__webpack_require__){var assert=__webpack_require__(231);var util=__webpack_require__(162);var types=__webpack_require__(161);var CalendarObject=__webpack_require__(102).CalendarObject;var schema=__webpack_require__(102).schema;var properties=__webpack_require__(102).properties;var iCalendar=__webpack_require__(190).iCalendar;var parse_value=types.parse_value;var format_value=types.format_value;var ParseError=exports.ParseError=function(){Error.apply(this,arguments)};util.inherits(ParseError,Error);function expect(expect_element,expect_value,next_state){return function(element,value,parameters){if(element!=expect_element)throw new ParseError("Expected "+expect_element+" got "+element);if(expect_value&&expect_value!=value)throw new ParseError("Expected "+expect_value+" got "+value);return next_state}}function parse_component(component,next_state){var cal=component.calendar;return function this_state(element,value,parameters){if(element=="BEGIN"){var factory=(schema[value]||{}).factory;var child=factory!==undefined?new factory(cal):new CalendarObject(cal,value);return parse_component(child,(function(){component.addComponent(child);return this_state.apply(this,arguments)}))}else if(element=="END"){return next_state}else{var prop=properties[element]||{};value=parse_value(prop.type,value,parameters,cal,prop.list);component.addProperty(element,value,parameters);return this_state}}}PROP_NAME=0;PARAM_NAME=1;PARAM_VALUE=2;MAYBE_QUOTED_PARAM=3;QUOTED_PARAM_VALUE=4;PARAM_OR_VALUE=5;PROP_VALUE=6;function parse_record(rec){var propname;var params={};var state=PROP_NAME;var lastpos=0;var current_param;function newstate(s){state=s;lastpos=i+1}function str(){return rec.substr(lastpos,i-lastpos)}var i=0,j=rec.length;for(;i<j;++i){var ch=rec[i];switch(state){case PROP_NAME:if(ch==":"||ch==";"){propname=str();state=PARAM_OR_VALUE;--i}break;case PARAM_OR_VALUE:if(ch==":")newstate(PROP_VALUE);else if(ch==";")newstate(PARAM_NAME);else throw new Error("Parse error");break;case PARAM_NAME:if(ch=="="){current_param=str();newstate(MAYBE_QUOTED_PARAM)}break;case MAYBE_QUOTED_PARAM:if(ch=='"')newstate(QUOTED_PARAM_VALUE);else state=PARAM_VALUE;break;case PARAM_VALUE:if(ch==":"||ch==";"){params[current_param]=str();state=PARAM_OR_VALUE;--i}break;case QUOTED_PARAM_VALUE:if(ch=='"'){params[current_param]=str();state=PARAM_OR_VALUE}break;case PROP_VALUE:i=j;break;default:throw new Error("Invalid parser state")}}return[propname,str(),params]}exports.parse_calendar=function(data,timezone){data=data.split(/\r?\n/);var calendar=new iCalendar(true);if(timezone){if(typeof timezone==="string")timezone=exports.parse_calendar(timezone);if(timezone instanceof iCalendar){var tzs=timezone.getComponents("VTIMEZONE");for(var i=0;i<tzs.length;++i)calendar.addComponent(tzs[i])}else calendar.addComponent(tzs[i])}var state=expect("BEGIN","VCALENDAR",parse_component(calendar));for(var i=0;i<data.length-1;++i){if(!data[i].length)continue;if(state===undefined)throw new ParseError("Mismatched BEGIN/END tags");var j=i;while(j+1<data.length&&(data[j+1][0]===" "||data[j+1][0]==="\t"))++j;var record=data[i];if(j!=i){var d=data.slice(i,j+1);for(var k=1;k<d.length;++k)d[k]=d[k].substr(1);record=d.join("");i=j}state=state.apply(null,parse_record(record))}if(state!==undefined)throw new ParseError("Unable to parse calendar data; END:VCALENDAR not found!");return calendar}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return ACTION}));let ACTION;(function(ACTION){ACTION[ACTION["ADD_REQUEST_MESSAGE"]=0]="ADD_REQUEST_MESSAGE";ACTION[ACTION["RESET_REQUEST_MESSAGES"]=1]="RESET_REQUEST_MESSAGES";ACTION[ACTION["CLOSE_MODAL"]=2]="CLOSE_MODAL";ACTION[ACTION["OPEN_MODAL"]=3]="OPEN_MODAL";ACTION[ACTION["RESET_ADVANCED_EDITOR_MESSAGES"]=4]="RESET_ADVANCED_EDITOR_MESSAGES";ACTION[ACTION["RESET_FORM"]=5]="RESET_FORM";ACTION[ACTION["SET_ADVANCED_EDITOR_RAW_STRING"]=6]="SET_ADVANCED_EDITOR_RAW_STRING";ACTION[ACTION["SET_FORM_STATE"]=7]="SET_FORM_STATE";ACTION[ACTION["SET_INDEX_PATTERN_TITLES"]=8]="SET_INDEX_PATTERN_TITLES";ACTION[ACTION["SET_IS_JOB_CREATED"]=9]="SET_IS_JOB_CREATED";ACTION[ACTION["SET_IS_JOB_STARTED"]=10]="SET_IS_JOB_STARTED";ACTION[ACTION["SET_IS_MODAL_BUTTON_DISABLED"]=11]="SET_IS_MODAL_BUTTON_DISABLED";ACTION[ACTION["SET_IS_MODAL_VISIBLE"]=12]="SET_IS_MODAL_VISIBLE";ACTION[ACTION["SET_JOB_CONFIG"]=13]="SET_JOB_CONFIG";ACTION[ACTION["SET_JOB_IDS"]=14]="SET_JOB_IDS";ACTION[ACTION["SWITCH_TO_ADVANCED_EDITOR"]=15]="SWITCH_TO_ADVANCED_EDITOR";ACTION[ACTION["SWITCH_TO_FORM"]=16]="SWITCH_TO_FORM";ACTION[ACTION["SET_ESTIMATED_MODEL_MEMORY_LIMIT"]=17]="SET_ESTIMATED_MODEL_MEMORY_LIMIT";ACTION[ACTION["SET_JOB_CLONE"]=18]="SET_JOB_CLONE"})(ACTION||(ACTION={}))},function(module,exports,__webpack_require__){var Stack=__webpack_require__(192),arrayEach=__webpack_require__(235),assignValue=__webpack_require__(197),baseAssign=__webpack_require__(524),baseAssignIn=__webpack_require__(530),cloneBuffer=__webpack_require__(311),copyArray=__webpack_require__(312),copySymbols=__webpack_require__(533),copySymbolsIn=__webpack_require__(534),getAllKeys=__webpack_require__(316),getAllKeysIn=__webpack_require__(535),getTag=__webpack_require__(148),initCloneArray=__webpack_require__(539),initCloneByTag=__webpack_require__(540),initCloneObject=__webpack_require__(321),isArray=__webpack_require__(77),isBuffer=__webpack_require__(147),isMap=__webpack_require__(544),isObject=__webpack_require__(104),isSet=__webpack_require__(546),keys=__webpack_require__(123),keysIn=__webpack_require__(137);var CLONE_DEEP_FLAG=1,CLONE_FLAT_FLAG=2,CLONE_SYMBOLS_FLAG=4;var argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",genTag="[object GeneratorFunction]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",symbolTag="[object Symbol]",weakMapTag="[object WeakMap]";var arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]";var cloneableTags={};cloneableTags[argsTag]=cloneableTags[arrayTag]=cloneableTags[arrayBufferTag]=cloneableTags[dataViewTag]=cloneableTags[boolTag]=cloneableTags[dateTag]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[mapTag]=cloneableTags[numberTag]=cloneableTags[objectTag]=cloneableTags[regexpTag]=cloneableTags[setTag]=cloneableTags[stringTag]=cloneableTags[symbolTag]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=true;cloneableTags[errorTag]=cloneableTags[funcTag]=cloneableTags[weakMapTag]=false;function baseClone(value,bitmask,customizer,key,object,stack){var result,isDeep=bitmask&CLONE_DEEP_FLAG,isFlat=bitmask&CLONE_FLAT_FLAG,isFull=bitmask&CLONE_SYMBOLS_FLAG;if(customizer){result=object?customizer(value,key,object,stack):customizer(value)}if(result!==undefined){return result}if(!isObject(value)){return value}var isArr=isArray(value);if(isArr){result=initCloneArray(value);if(!isDeep){return copyArray(value,result)}}else{var tag=getTag(value),isFunc=tag==funcTag||tag==genTag;if(isBuffer(value)){return cloneBuffer(value,isDeep)}if(tag==objectTag||tag==argsTag||isFunc&&!object){result=isFlat||isFunc?{}:initCloneObject(value);if(!isDeep){return isFlat?copySymbolsIn(value,baseAssignIn(result,value)):copySymbols(value,baseAssign(result,value))}}else{if(!cloneableTags[tag]){return object?value:{}}result=initCloneByTag(value,tag,isDeep)}}stack||(stack=new Stack);var stacked=stack.get(value);if(stacked){return stacked}stack.set(value,result);if(isSet(value)){value.forEach((function(subValue){result.add(baseClone(subValue,bitmask,customizer,subValue,value,stack))}))}else if(isMap(value)){value.forEach((function(subValue,key){result.set(key,baseClone(subValue,bitmask,customizer,key,value,stack))}))}var keysFunc=isFull?isFlat?getAllKeysIn:getAllKeys:isFlat?keysIn:keys;var props=isArr?undefined:keysFunc(value);arrayEach(props||value,(function(subValue,key){if(props){key=subValue;subValue=value[key]}assignValue(result,key,baseClone(subValue,bitmask,customizer,key,value,stack))}));return result}module.exports=baseClone},function(module,exports,__webpack_require__){(function(global){var freeGlobal=typeof global=="object"&&global&&global.Object===Object&&global;module.exports=freeGlobal}).call(this,__webpack_require__(106))},function(module,exports){var funcProto=Function.prototype;var funcToString=funcProto.toString;function toSource(func){if(func!=null){try{return funcToString.call(func)}catch(e){}try{return func+""}catch(e){}}return""}module.exports=toSource},function(module,exports,__webpack_require__){var getNative=__webpack_require__(135);var defineProperty=function(){try{var func=getNative(Object,"defineProperty");func({},"",{});return func}catch(e){}}();module.exports=defineProperty},function(module,exports,__webpack_require__){var baseTimes=__webpack_require__(525),isArguments=__webpack_require__(165),isArray=__webpack_require__(77),isBuffer=__webpack_require__(147),isIndex=__webpack_require__(199),isTypedArray=__webpack_require__(166);var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;function arrayLikeKeys(value,inherited){var isArr=isArray(value),isArg=!isArr&&isArguments(value),isBuff=!isArr&&!isArg&&isBuffer(value),isType=!isArr&&!isArg&&!isBuff&&isTypedArray(value),skipIndexes=isArr||isArg||isBuff||isType,result=skipIndexes?baseTimes(value.length,String):[],length=result.length;for(var key in value){if((inherited||hasOwnProperty.call(value,key))&&!(skipIndexes&&(key=="length"||isBuff&&(key=="offset"||key=="parent")||isType&&(key=="buffer"||key=="byteLength"||key=="byteOffset")||isIndex(key,length)))){result.push(key)}}return result}module.exports=arrayLikeKeys},function(module,exports){function overArg(func,transform){return function(arg){return func(transform(arg))}}module.exports=overArg},function(module,exports,__webpack_require__){(function(module){var root=__webpack_require__(108);var freeExports=true&&exports&&!exports.nodeType&&exports;var freeModule=freeExports&&typeof module=="object"&&module&&!module.nodeType&&module;var moduleExports=freeModule&&freeModule.exports===freeExports;var Buffer=moduleExports?root.Buffer:undefined,allocUnsafe=Buffer?Buffer.allocUnsafe:undefined;function cloneBuffer(buffer,isDeep){if(isDeep){return buffer.slice()}var length=buffer.length,result=allocUnsafe?allocUnsafe(length):new buffer.constructor(length);buffer.copy(result);return result}module.exports=cloneBuffer}).call(this,__webpack_require__(158)(module))},function(module,exports){function copyArray(source,array){var index=-1,length=source.length;array||(array=Array(length));while(++index<length){array[index]=source[index]}return array}module.exports=copyArray},function(module,exports){function arrayFilter(array,predicate){var index=-1,length=array==null?0:array.length,resIndex=0,result=[];while(++index<length){var value=array[index];if(predicate(value,index,array)){result[resIndex++]=value}}return result}module.exports=arrayFilter},function(module,exports){function stubArray(){return[]}module.exports=stubArray},function(module,exports,__webpack_require__){var arrayPush=__webpack_require__(240),getPrototype=__webpack_require__(202),getSymbols=__webpack_require__(239),stubArray=__webpack_require__(314);var nativeGetSymbols=Object.getOwnPropertySymbols;var getSymbolsIn=!nativeGetSymbols?stubArray:function(object){var result=[];while(object){arrayPush(result,getSymbols(object));object=getPrototype(object)}return result};module.exports=getSymbolsIn},function(module,exports,__webpack_require__){var baseGetAllKeys=__webpack_require__(317),getSymbols=__webpack_require__(239),keys=__webpack_require__(123);function getAllKeys(object){return baseGetAllKeys(object,keys,getSymbols)}module.exports=getAllKeys},function(module,exports,__webpack_require__){var arrayPush=__webpack_require__(240),isArray=__webpack_require__(77);function baseGetAllKeys(object,keysFunc,symbolsFunc){var result=keysFunc(object);return isArray(object)?result:arrayPush(result,symbolsFunc(object))}module.exports=baseGetAllKeys},function(module,exports,__webpack_require__){var getNative=__webpack_require__(135),root=__webpack_require__(108);var Set=getNative(root,"Set");module.exports=Set},function(module,exports,__webpack_require__){var root=__webpack_require__(108);var Uint8Array=root.Uint8Array;module.exports=Uint8Array},function(module,exports,__webpack_require__){var cloneArrayBuffer=__webpack_require__(241);function cloneTypedArray(typedArray,isDeep){var buffer=isDeep?cloneArrayBuffer(typedArray.buffer):typedArray.buffer;return new typedArray.constructor(buffer,typedArray.byteOffset,typedArray.length)}module.exports=cloneTypedArray},function(module,exports,__webpack_require__){var baseCreate=__webpack_require__(322),getPrototype=__webpack_require__(202),isPrototype=__webpack_require__(201);function initCloneObject(object){return typeof object.constructor=="function"&&!isPrototype(object)?baseCreate(getPrototype(object)):{}}module.exports=initCloneObject},function(module,exports,__webpack_require__){var isObject=__webpack_require__(104);var objectCreate=Object.create;var baseCreate=function(){function object(){}return function(proto){if(!isObject(proto)){return{}}if(objectCreate){return objectCreate(proto)}object.prototype=proto;var result=new object;object.prototype=undefined;return result}}();module.exports=baseCreate},function(module,exports,__webpack_require__){module.exports=__webpack_require__(324)},function(module,exports,__webpack_require__){var arrayEach=__webpack_require__(235),baseEach=__webpack_require__(203),castFunction=__webpack_require__(325),isArray=__webpack_require__(77);function forEach(collection,iteratee){var func=isArray(collection)?arrayEach:baseEach;return func(collection,castFunction(iteratee))}module.exports=forEach},function(module,exports,__webpack_require__){var identity=__webpack_require__(138);function castFunction(value){return typeof value=="function"?value:identity}module.exports=castFunction},function(module,exports,__webpack_require__){var arrayFilter=__webpack_require__(313),baseFilter=__webpack_require__(550),baseIteratee=__webpack_require__(120),isArray=__webpack_require__(77);function filter(collection,predicate){var func=isArray(collection)?arrayFilter:baseFilter;return func(collection,baseIteratee(predicate,3))}module.exports=filter},function(module,exports,__webpack_require__){var baseIsEqualDeep=__webpack_require__(553),isObjectLike=__webpack_require__(113);function baseIsEqual(value,other,bitmask,customizer,stack){if(value===other){return true}if(value==null||other==null||!isObjectLike(value)&&!isObjectLike(other)){return value!==value&&other!==other}return baseIsEqualDeep(value,other,bitmask,customizer,baseIsEqual,stack)}module.exports=baseIsEqual},function(module,exports,__webpack_require__){var SetCache=__webpack_require__(329),arraySome=__webpack_require__(556),cacheHas=__webpack_require__(330);var COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2;function equalArrays(array,other,bitmask,customizer,equalFunc,stack){var isPartial=bitmask&COMPARE_PARTIAL_FLAG,arrLength=array.length,othLength=other.length;if(arrLength!=othLength&&!(isPartial&&othLength>arrLength)){return false}var arrStacked=stack.get(array);var othStacked=stack.get(other);if(arrStacked&&othStacked){return arrStacked==other&&othStacked==array}var index=-1,result=true,seen=bitmask&COMPARE_UNORDERED_FLAG?new SetCache:undefined;stack.set(array,other);stack.set(other,array);while(++index<arrLength){var arrValue=array[index],othValue=other[index];if(customizer){var compared=isPartial?customizer(othValue,arrValue,index,other,array,stack):customizer(arrValue,othValue,index,array,other,stack)}if(compared!==undefined){if(compared){continue}result=false;break}if(seen){if(!arraySome(other,(function(othValue,othIndex){if(!cacheHas(seen,othIndex)&&(arrValue===othValue||equalFunc(arrValue,othValue,bitmask,customizer,stack))){return seen.push(othIndex)}}))){result=false;break}}else if(!(arrValue===othValue||equalFunc(arrValue,othValue,bitmask,customizer,stack))){result=false;break}}stack["delete"](array);stack["delete"](other);return result}module.exports=equalArrays},function(module,exports,__webpack_require__){var MapCache=__webpack_require__(234),setCacheAdd=__webpack_require__(554),setCacheHas=__webpack_require__(555);function SetCache(values){var index=-1,length=values==null?0:values.length;this.__data__=new MapCache;while(++index<length){this.add(values[index])}}SetCache.prototype.add=SetCache.prototype.push=setCacheAdd;SetCache.prototype.has=setCacheHas;module.exports=SetCache},function(module,exports){function cacheHas(cache,key){return cache.has(key)}module.exports=cacheHas},function(module,exports,__webpack_require__){var isObject=__webpack_require__(104);function isStrictComparable(value){return value===value&&!isObject(value)}module.exports=isStrictComparable},function(module,exports){function matchesStrictComparable(key,srcValue){return function(object){if(object==null){return false}return object[key]===srcValue&&(srcValue!==undefined||key in Object(object))}}module.exports=matchesStrictComparable},function(module,exports,__webpack_require__){var baseToString=__webpack_require__(566);function toString(value){return value==null?"":baseToString(value)}module.exports=toString},function(module,exports,__webpack_require__){var baseHasIn=__webpack_require__(567),hasPath=__webpack_require__(335);function hasIn(object,path){return object!=null&&hasPath(object,path,baseHasIn)}module.exports=hasIn},function(module,exports,__webpack_require__){var castPath=__webpack_require__(205),isArguments=__webpack_require__(165),isArray=__webpack_require__(77),isIndex=__webpack_require__(199),isLength=__webpack_require__(236),toKey=__webpack_require__(167);function hasPath(object,path,hasFunc){path=castPath(path,object);var index=-1,length=path.length,result=false;while(++index<length){var key=toKey(path[index]);if(!(result=object!=null&&hasFunc(object,key))){break}object=object[key]}if(result||++index!=length){return result}length=object==null?0:object.length;return!!length&&isLength(length)&&isIndex(key,length)&&(isArray(object)||isArguments(object))}module.exports=hasPath},function(module,exports){function baseProperty(key){return function(object){return object==null?undefined:object[key]}}module.exports=baseProperty},function(module,exports,__webpack_require__){var baseHas=__webpack_require__(570),hasPath=__webpack_require__(335);function has(object,path){return object!=null&&hasPath(object,path,baseHas)}module.exports=has},function(module,exports){function isUndefined(value){return value===undefined}module.exports=isUndefined},function(module,exports,__webpack_require__){var arrayMap=__webpack_require__(206),baseIteratee=__webpack_require__(120),baseMap=__webpack_require__(340),isArray=__webpack_require__(77);function map(collection,iteratee){var func=isArray(collection)?arrayMap:baseMap;return func(collection,baseIteratee(iteratee,3))}module.exports=map},function(module,exports,__webpack_require__){var baseEach=__webpack_require__(203),isArrayLike=__webpack_require__(119);function baseMap(collection,iteratee){var index=-1,result=isArrayLike(collection)?Array(collection.length):[];baseEach(collection,(function(value,key,collection){result[++index]=iteratee(value,key,collection)}));return result}module.exports=baseMap},function(module,exports,__webpack_require__){var arrayReduce=__webpack_require__(572),baseEach=__webpack_require__(203),baseIteratee=__webpack_require__(120),baseReduce=__webpack_require__(573),isArray=__webpack_require__(77);function reduce(collection,iteratee,accumulator){var func=isArray(collection)?arrayReduce:baseReduce,initAccum=arguments.length<3;return func(collection,baseIteratee(iteratee,4),accumulator,initAccum,baseEach)}module.exports=reduce},function(module,exports,__webpack_require__){var apply=__webpack_require__(583);var nativeMax=Math.max;function overRest(func,start,transform){start=nativeMax(start===undefined?func.length-1:start,0);return function(){var args=arguments,index=-1,length=nativeMax(args.length-start,0),array=Array(length);while(++index<length){array[index]=args[start+index]}index=-1;var otherArgs=Array(start+1);while(++index<start){otherArgs[index]=args[index]}otherArgs[start]=transform(array);return apply(func,this,otherArgs)}}module.exports=overRest},function(module,exports,__webpack_require__){var baseSetToString=__webpack_require__(584),shortOut=__webpack_require__(585);var setToString=shortOut(baseSetToString);module.exports=setToString},function(module,exports){function baseFindIndex(array,predicate,fromIndex,fromRight){var length=array.length,index=fromIndex+(fromRight?1:-1);while(fromRight?index--:++index<length){if(predicate(array[index],index,array)){return index}}return-1}module.exports=baseFindIndex},function(module,exports,__webpack_require__){var isArrayLike=__webpack_require__(119),isObjectLike=__webpack_require__(113);function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value)}module.exports=isArrayLikeObject},function(module,exports,__webpack_require__){var baseValues=__webpack_require__(594),keys=__webpack_require__(123);function values(object){return object==null?[]:baseValues(object,keys(object))}module.exports=values},function(module,exports,__webpack_require__){var _=__webpack_require__(103);var PriorityQueue=__webpack_require__(348);module.exports=dijkstra;var DEFAULT_WEIGHT_FUNC=_.constant(1);function dijkstra(g,source,weightFn,edgeFn){return runDijkstra(g,String(source),weightFn||DEFAULT_WEIGHT_FUNC,edgeFn||function(v){return g.outEdges(v)})}function runDijkstra(g,source,weightFn,edgeFn){var results={};var pq=new PriorityQueue;var v,vEntry;var updateNeighbors=function(edge){var w=edge.v!==v?edge.v:edge.w;var wEntry=results[w];var weight=weightFn(edge);var distance=vEntry.distance+weight;if(weight<0){throw new Error("dijkstra does not allow negative edge weights. "+"Bad edge: "+edge+" Weight: "+weight)}if(distance<wEntry.distance){wEntry.distance=distance;wEntry.predecessor=v;pq.decrease(w,distance)}};g.nodes().forEach((function(v){var distance=v===source?0:Number.POSITIVE_INFINITY;results[v]={distance:distance};pq.add(v,distance)}));while(pq.size()>0){v=pq.removeMin();vEntry=results[v];if(vEntry.distance===Number.POSITIVE_INFINITY){break}edgeFn(v).forEach(updateNeighbors)}return results}},function(module,exports,__webpack_require__){var _=__webpack_require__(103);module.exports=PriorityQueue;function PriorityQueue(){this._arr=[];this._keyIndices={}}PriorityQueue.prototype.size=function(){return this._arr.length};PriorityQueue.prototype.keys=function(){return this._arr.map((function(x){return x.key}))};PriorityQueue.prototype.has=function(key){return _.has(this._keyIndices,key)};PriorityQueue.prototype.priority=function(key){var index=this._keyIndices[key];if(index!==undefined){return this._arr[index].priority}};PriorityQueue.prototype.min=function(){if(this.size()===0){throw new Error("Queue underflow")}return this._arr[0].key};PriorityQueue.prototype.add=function(key,priority){var keyIndices=this._keyIndices;key=String(key);if(!_.has(keyIndices,key)){var arr=this._arr;var index=arr.length;keyIndices[key]=index;arr.push({key:key,priority:priority});this._decrease(index);return true}return false};PriorityQueue.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var min=this._arr.pop();delete this._keyIndices[min.key];this._heapify(0);return min.key};PriorityQueue.prototype.decrease=function(key,priority){var index=this._keyIndices[key];if(priority>this._arr[index].priority){throw new Error("New priority is greater than current priority. "+"Key: "+key+" Old: "+this._arr[index].priority+" New: "+priority)}this._arr[index].priority=priority;this._decrease(index)};PriorityQueue.prototype._heapify=function(i){var arr=this._arr;var l=2*i;var r=l+1;var largest=i;if(l<arr.length){largest=arr[l].priority<arr[largest].priority?l:largest;if(r<arr.length){largest=arr[r].priority<arr[largest].priority?r:largest}if(largest!==i){this._swap(i,largest);this._heapify(largest)}}};PriorityQueue.prototype._decrease=function(index){var arr=this._arr;var priority=arr[index].priority;var parent;while(index!==0){parent=index>>1;if(arr[parent].priority<priority){break}this._swap(index,parent);index=parent}};PriorityQueue.prototype._swap=function(i,j){var arr=this._arr;var keyIndices=this._keyIndices;var origArrI=arr[i];var origArrJ=arr[j];arr[i]=origArrJ;arr[j]=origArrI;keyIndices[origArrJ.key]=i;keyIndices[origArrI.key]=j}},function(module,exports,__webpack_require__){var _=__webpack_require__(103);module.exports=tarjan;function tarjan(g){var index=0;var stack=[];var visited={};var results=[];function dfs(v){var entry=visited[v]={onStack:true,lowlink:index,index:index++};stack.push(v);g.successors(v).forEach((function(w){if(!_.has(visited,w)){dfs(w);entry.lowlink=Math.min(entry.lowlink,visited[w].lowlink)}else if(visited[w].onStack){entry.lowlink=Math.min(entry.lowlink,visited[w].index)}}));if(entry.lowlink===entry.index){var cmpt=[];var w;do{w=stack.pop();visited[w].onStack=false;cmpt.push(w)}while(v!==w);results.push(cmpt)}}g.nodes().forEach((function(v){if(!_.has(visited,v)){dfs(v)}}));return results}},function(module,exports,__webpack_require__){var _=__webpack_require__(103);module.exports=topsort;topsort.CycleException=CycleException;function topsort(g){var visited={};var stack={};var results=[];function visit(node){if(_.has(stack,node)){throw new CycleException}if(!_.has(visited,node)){stack[node]=true;visited[node]=true;_.each(g.predecessors(node),visit);delete stack[node];results.push(node)}}_.each(g.sinks(),visit);if(_.size(visited)!==g.nodeCount()){throw new CycleException}return results}function CycleException(){}CycleException.prototype=new Error},function(module,exports,__webpack_require__){var _=__webpack_require__(103);module.exports=dfs;function dfs(g,vs,order){if(!_.isArray(vs)){vs=[vs]}var navigation=(g.isDirected()?g.successors:g.neighbors).bind(g);var acc=[];var visited={};_.each(vs,(function(v){if(!g.hasNode(v)){throw new Error("Graph does not have node: "+v)}doDfs(g,v,order==="post",visited,navigation,acc)}));return acc}function doDfs(g,v,postorder,visited,navigation,acc){if(!_.has(visited,v)){visited[v]=true;if(!postorder){acc.push(v)}_.each(navigation(v),(function(w){doDfs(g,w,postorder,visited,navigation,acc)}));if(postorder){acc.push(v)}}}},function(module,exports,__webpack_require__){var toNumber=__webpack_require__(613);var INFINITY=1/0,MAX_INTEGER=17976931348623157e292;function toFinite(value){if(!value){return value===0?value:0}value=toNumber(value);if(value===INFINITY||value===-INFINITY){var sign=value<0?-1:1;return sign*MAX_INTEGER}return value===value?value:0}module.exports=toFinite},function(module,exports,__webpack_require__){var baseFlatten=__webpack_require__(247);function flatten(array){var length=array==null?0:array.length;return length?baseFlatten(array,1):[]}module.exports=flatten},function(module,exports,__webpack_require__){var baseAssignValue=__webpack_require__(198),eq=__webpack_require__(145);function assignMergeValue(object,key,value){if(value!==undefined&&!eq(object[key],value)||value===undefined&&!(key in object)){baseAssignValue(object,key,value)}}module.exports=assignMergeValue},function(module,exports){function safeGet(object,key){if(key==="constructor"&&typeof object[key]==="function"){return}if(key=="__proto__"){return}return object[key]}module.exports=safeGet},function(module,exports){function baseLt(value,other){return value<other}module.exports=baseLt},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(73);var Graph=__webpack_require__(107).Graph;var slack=__webpack_require__(209).slack;module.exports=feasibleTree;function feasibleTree(g){var t=new Graph({directed:false});var start=g.nodes()[0];var size=g.nodeCount();t.setNode(start,{});var edge,delta;while(tightTree(t,g)<size){edge=findMinSlackEdge(t,g);delta=t.hasNode(edge.v)?slack(g,edge):-slack(g,edge);shiftRanks(t,g,delta)}return t}function tightTree(t,g){function dfs(v){_.forEach(g.nodeEdges(v),(function(e){var edgeV=e.v,w=v===edgeV?e.w:edgeV;if(!t.hasNode(w)&&!slack(g,e)){t.setNode(w,{});t.setEdge(v,w,{});dfs(w)}}))}_.forEach(t.nodes(),dfs);return t.nodeCount()}function findMinSlackEdge(t,g){return _.minBy(g.edges(),(function(e){if(t.hasNode(e.v)!==t.hasNode(e.w)){return slack(g,e)}}))}function shiftRanks(t,g,delta){_.forEach(t.nodes(),(function(v){g.node(v).rank+=delta}))}},function(module,exports,__webpack_require__){switch(window.__kbnThemeTag__){case"v7dark":return __webpack_require__(686);case"v7light":return __webpack_require__(688);case"v8dark":return __webpack_require__(690);case"v8light":return __webpack_require__(692)}},,,,,,,,,,,,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"AnomalyTimelineService",(function(){return AnomalyTimelineService}));var _src_plugins_data_public__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(35);var _src_plugins_data_public__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_src_plugins_data_public__WEBPACK_IMPORTED_MODULE_0__);var _util_time_buckets__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(95);var _explorer_explorer_constants__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(69);function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class AnomalyTimelineService{constructor(timeFilter,uiSettings,mlResultsService){this.timeFilter=timeFilter;this.mlResultsService=mlResultsService;_defineProperty(this,"timeBuckets",void 0);_defineProperty(this,"_customTimeRange",void 0);this.timeBuckets=new _util_time_buckets__WEBPACK_IMPORTED_MODULE_1__["a"]({"histogram:maxBars":uiSettings.get(_src_plugins_data_public__WEBPACK_IMPORTED_MODULE_0__["UI_SETTINGS"].HISTOGRAM_MAX_BARS),"histogram:barTarget":uiSettings.get(_src_plugins_data_public__WEBPACK_IMPORTED_MODULE_0__["UI_SETTINGS"].HISTOGRAM_BAR_TARGET),dateFormat:uiSettings.get("dateFormat"),"dateFormat:scaled":uiSettings.get("dateFormat:scaled")});this.timeFilter.enableTimeRangeSelector()}setTimeRange(timeRange){this._customTimeRange=timeRange}getSwimlaneBucketInterval(selectedJobs,swimlaneContainerWidth){const bounds=this.getTimeBounds();if(bounds===undefined){throw new Error("timeRangeSelectorEnabled has to be enabled")}this.timeBuckets.setInterval("auto");this.timeBuckets.setBounds(bounds);const intervalSeconds=this.timeBuckets.getInterval().asSeconds();const timerangeSeconds=(bounds.max.valueOf()-bounds.min.valueOf())/1e3;const numBuckets=timerangeSeconds/intervalSeconds;const cellWidth=Math.floor(swimlaneContainerWidth/numBuckets*100)/100;if(cellWidth<8){this.timeBuckets.setInterval(intervalSeconds*2+"s")}const maxBucketSpanSeconds=selectedJobs.reduce((memo,job)=>Math.max(memo,job.bucketSpanSeconds),0);if(maxBucketSpanSeconds>intervalSeconds){this.timeBuckets.setInterval(maxBucketSpanSeconds+"s");this.timeBuckets.setBounds(bounds)}return this.timeBuckets.getInterval()}async loadOverallData(selectedJobs,chartWidth){const interval=this.getSwimlaneBucketInterval(selectedJobs,chartWidth);if(!selectedJobs||!selectedJobs.length){throw new Error("Explorer jobs collection is required")}const bounds=this.getTimeBounds();const searchBounds=Object(_util_time_buckets__WEBPACK_IMPORTED_MODULE_1__["b"])(bounds,interval,false);const selectedJobIds=selectedJobs.map(d=>d.id);const overallBucketsBounds=Object(_util_time_buckets__WEBPACK_IMPORTED_MODULE_1__["b"])(bounds,interval,true);const resp=await this.mlResultsService.getOverallBucketScores(selectedJobIds,1,overallBucketsBounds.min.valueOf(),overallBucketsBounds.max.valueOf(),interval.asSeconds()+"s");const overallSwimlaneData=this.processOverallResults(resp.results,searchBounds,interval.asSeconds());console.log("Explorer overall swim lane data set:",overallSwimlaneData);return overallSwimlaneData}async loadViewBySwimlane(fieldValues,bounds,selectedJobs,viewBySwimlaneFieldName,swimlaneLimit,perPage,fromPage,swimlaneContainerWidth,influencersFilterQuery){const timefilterBounds=this.getTimeBounds();if(timefilterBounds===undefined){throw new Error("timeRangeSelectorEnabled has to be enabled")}const swimlaneBucketInterval=this.getSwimlaneBucketInterval(selectedJobs,swimlaneContainerWidth);const searchBounds=Object(_util_time_buckets__WEBPACK_IMPORTED_MODULE_1__["b"])(timefilterBounds,swimlaneBucketInterval,false);const selectedJobIds=selectedJobs.map(d=>d.id);const intervalMs=swimlaneBucketInterval.asMilliseconds();let response;if(viewBySwimlaneFieldName===_explorer_explorer_constants__WEBPACK_IMPORTED_MODULE_2__["j"]){const jobIds=fieldValues!==undefined&&fieldValues.length>0?fieldValues:selectedJobIds;response=await this.mlResultsService.getScoresByBucket(jobIds,searchBounds.min.valueOf(),searchBounds.max.valueOf(),intervalMs,perPage,fromPage)}else{response=await this.mlResultsService.getInfluencerValueMaxScoreByTime(selectedJobIds,viewBySwimlaneFieldName,fieldValues,searchBounds.min.valueOf(),searchBounds.max.valueOf(),intervalMs,swimlaneLimit,perPage,fromPage,influencersFilterQuery)}if(response===undefined){return}const viewBySwimlaneData=this.processViewByResults(response.results,response.cardinality,fieldValues,bounds,viewBySwimlaneFieldName,swimlaneBucketInterval.asSeconds());console.log("Explorer view by swim lane data set:",viewBySwimlaneData);return viewBySwimlaneData}async loadViewByTopFieldValuesForSelectedTime(earliestMs,latestMs,selectedJobs,viewBySwimlaneFieldName,swimlaneLimit,perPage,fromPage,swimlaneContainerWidth){const selectedJobIds=selectedJobs.map(d=>d.id);if(viewBySwimlaneFieldName!==_explorer_explorer_constants__WEBPACK_IMPORTED_MODULE_2__["j"]){const resp=await this.mlResultsService.getTopInfluencers(selectedJobIds,earliestMs,latestMs,swimlaneLimit,perPage,fromPage);if(resp.influencers[viewBySwimlaneFieldName]===undefined){return[]}const topFieldValues=[];const topInfluencers=resp.influencers[viewBySwimlaneFieldName];if(Array.isArray(topInfluencers)){topInfluencers.forEach(influencerData=>{if(influencerData.maxAnomalyScore>0){topFieldValues.push(influencerData.influencerFieldValue)}})}return topFieldValues}else{const resp=await this.mlResultsService.getScoresByBucket(selectedJobIds,earliestMs,latestMs,this.getSwimlaneBucketInterval(selectedJobs,swimlaneContainerWidth).asMilliseconds(),swimlaneLimit);return Object.keys(resp.results)}}getTimeBounds(){return this._customTimeRange!==undefined?this.timeFilter.calculateBounds(this._customTimeRange):this.timeFilter.getBounds()}processOverallResults(scoresByTime,searchBounds,interval){const overallLabel=_explorer_explorer_constants__WEBPACK_IMPORTED_MODULE_2__["g"];const dataset={laneLabels:[overallLabel],points:[],interval:interval,earliest:searchBounds.min.valueOf()/1e3,latest:searchBounds.max.valueOf()/1e3};Object.entries(scoresByTime).forEach(([timeMs,score])=>{const time=+timeMs/1e3;dataset.points.push({laneLabel:overallLabel,time:time,value:score});dataset.earliest=Math.min(time,dataset.earliest);dataset.latest=Math.max(time+dataset.interval,dataset.latest)});return dataset}processViewByResults(scoresByInfluencerAndTime,cardinality,sortedLaneValues,bounds,viewBySwimlaneFieldName,interval){const dataset={fieldName:viewBySwimlaneFieldName,points:[],laneLabels:[],interval:interval,earliest:bounds.earliest,latest:bounds.latest,cardinality:cardinality};const maxScoreByLaneLabel={};Object.entries(scoresByInfluencerAndTime).forEach(([influencerFieldValue,influencerData])=>{dataset.laneLabels.push(influencerFieldValue);maxScoreByLaneLabel[influencerFieldValue]=0;Object.entries(influencerData).forEach(([timeMs,anomalyScore])=>{const time=+timeMs/1e3;dataset.points.push({laneLabel:influencerFieldValue,time:time,value:anomalyScore});maxScoreByLaneLabel[influencerFieldValue]=Math.max(maxScoreByLaneLabel[influencerFieldValue],anomalyScore)})});const sortValuesLength=sortedLaneValues.length;if(sortValuesLength===0){dataset.laneLabels=dataset.laneLabels.sort((a,b)=>maxScoreByLaneLabel[b]-maxScoreByLaneLabel[a])}else{dataset.laneLabels=dataset.laneLabels.sort((a,b)=>{let aIndex=sortedLaneValues.indexOf(a);let bIndex=sortedLaneValues.indexOf(b);aIndex=aIndex>-1?aIndex:sortValuesLength;bIndex=bIndex>-1?bIndex:sortValuesLength;return aIndex-bIndex})}return dataset}}},,,,,,,,,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"getMlGlobalServices",(function(){return getMlGlobalServices}));__webpack_require__.d(__webpack_exports__,"renderApp",(function(){return renderApp}));var routes_namespaceObject={};__webpack_require__.r(routes_namespaceObject);__webpack_require__.d(routes_namespaceObject,"overviewRouteFactory",(function(){return overviewRouteFactory}));__webpack_require__.d(routes_namespaceObject,"appRootRouteFactory",(function(){return appRootRouteFactory}));__webpack_require__.d(routes_namespaceObject,"jobListRouteFactory",(function(){return jobListRouteFactory}));__webpack_require__.d(routes_namespaceObject,"indexOrSearchRouteFactory",(function(){return indexOrSearchRouteFactory}));__webpack_require__.d(routes_namespaceObject,"dataVizIndexOrSearchRouteFactory",(function(){return dataVizIndexOrSearchRouteFactory}));__webpack_require__.d(routes_namespaceObject,"jobTypeRouteFactory",(function(){return jobTypeRouteFactory}));__webpack_require__.d(routes_namespaceObject,"newJobRouteFactory",(function(){return newJobRouteFactory}));__webpack_require__.d(routes_namespaceObject,"singleMetricRouteFactory",(function(){return singleMetricRouteFactory}));__webpack_require__.d(routes_namespaceObject,"multiMetricRouteFactory",(function(){return multiMetricRouteFactory}));__webpack_require__.d(routes_namespaceObject,"populationRouteFactory",(function(){return populationRouteFactory}));__webpack_require__.d(routes_namespaceObject,"advancedRouteFactory",(function(){return advancedRouteFactory}));__webpack_require__.d(routes_namespaceObject,"categorizationRouteFactory",(function(){return categorizationRouteFactory}));__webpack_require__.d(routes_namespaceObject,"recognizeRouteFactory",(function(){return recognizeRouteFactory}));__webpack_require__.d(routes_namespaceObject,"checkViewOrCreateRouteFactory",(function(){return checkViewOrCreateRouteFactory}));__webpack_require__.d(routes_namespaceObject,"selectorRouteFactory",(function(){return selectorRouteFactory}));__webpack_require__.d(routes_namespaceObject,"indexBasedRouteFactory",(function(){return indexBasedRouteFactory}));__webpack_require__.d(routes_namespaceObject,"fileBasedRouteFactory",(function(){return fileBasedRouteFactory}));__webpack_require__.d(routes_namespaceObject,"settingsRouteFactory",(function(){return settingsRouteFactory}));__webpack_require__.d(routes_namespaceObject,"calendarListRouteFactory",(function(){return calendarListRouteFactory}));__webpack_require__.d(routes_namespaceObject,"newCalendarRouteFactory",(function(){return newCalendarRouteFactory}));__webpack_require__.d(routes_namespaceObject,"editCalendarRouteFactory",(function(){return editCalendarRouteFactory}));__webpack_require__.d(routes_namespaceObject,"filterListRouteFactory",(function(){return filterListRouteFactory}));__webpack_require__.d(routes_namespaceObject,"newFilterListRouteFactory",(function(){return newFilterListRouteFactory}));__webpack_require__.d(routes_namespaceObject,"editFilterListRouteFactory",(function(){return editFilterListRouteFactory}));__webpack_require__.d(routes_namespaceObject,"analyticsJobsListRouteFactory",(function(){return analyticsJobsListRouteFactory}));__webpack_require__.d(routes_namespaceObject,"analyticsJobExplorationRouteFactory",(function(){return analyticsJobExplorationRouteFactory}));__webpack_require__.d(routes_namespaceObject,"analyticsJobsCreationRouteFactory",(function(){return analyticsJobsCreationRouteFactory}));__webpack_require__.d(routes_namespaceObject,"modelsListRouteFactory",(function(){return modelsListRouteFactory}));__webpack_require__.d(routes_namespaceObject,"analyticsMapRouteFactory",(function(){return analyticsMapRouteFactory}));__webpack_require__.d(routes_namespaceObject,"timeSeriesExplorerRouteFactory",(function(){return timeSeriesExplorerRouteFactory}));__webpack_require__.d(routes_namespaceObject,"explorerRouteFactory",(function(){return explorerRouteFactory}));__webpack_require__.d(routes_namespaceObject,"accessDeniedRouteFactory",(function(){return accessDeniedRouteFactory}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var _index=__webpack_require__(422);var external_kbnSharedDeps_ReactDom_=__webpack_require__(46);var external_kbnSharedDeps_ReactDom_default=__webpack_require__.n(external_kbnSharedDeps_ReactDom_);var public_=__webpack_require__(3);var kibanaReact_public_=__webpack_require__(36);var dependency_cache=__webpack_require__(18);var license=__webpack_require__(85);var external_kbnSharedDeps_ReactRouterDom_=__webpack_require__(39);var contexts_kibana=__webpack_require__(58);var ml=__webpack_require__(86);var url_state=__webpack_require__(70);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);var index_utils=__webpack_require__(78);var external_kbnSharedDeps_Lodash_=__webpack_require__(5);var data_public_=__webpack_require__(35);var constants_search=__webpack_require__(96);const DEFAULT_QUERY={bool:{must:[{match_all:{}}]}};function getDefaultDatafeedQuery(){return Object(external_kbnSharedDeps_Lodash_["cloneDeep"])(DEFAULT_QUERY)}function createSearchItems(kibanaConfig,indexPattern,savedSearch){let query={query:"",language:"lucene"};let combinedQuery=getDefaultDatafeedQuery();if(savedSearch!==null){const data=Object(index_utils["f"])(savedSearch);query=data.query;const filter=data.filter;const filters=Array.isArray(filter)?filter:[];if(query.language===constants_search["c"].KUERY){const ast=data_public_["esKuery"].fromKueryExpression(query.query);if(query.query!==""){combinedQuery=data_public_["esKuery"].toElasticsearchQuery(ast,indexPattern)}const filterQuery=data_public_["esQuery"].buildQueryFromFilters(filters,indexPattern);if(Array.isArray(combinedQuery.bool.filter)===false){combinedQuery.bool.filter=combinedQuery.bool.filter===undefined?[]:[combinedQuery.bool.filter]}if(Array.isArray(combinedQuery.bool.must_not)===false){combinedQuery.bool.must_not=combinedQuery.bool.must_not===undefined?[]:[combinedQuery.bool.must_not]}combinedQuery.bool.filter=[...combinedQuery.bool.filter,...filterQuery.filter];combinedQuery.bool.must_not=[...combinedQuery.bool.must_not,...filterQuery.must_not]}else{const esQueryConfigs=data_public_["esQuery"].getEsQueryConfig(kibanaConfig);combinedQuery=data_public_["esQuery"].buildEsQuery(indexPattern,[query],filters,esQueryConfigs)}}return{query:query,combinedQuery:combinedQuery}}function checkCardinalitySuccess(data){const response={success:true};if(Array.isArray(data)&&data.length===0){return response}for(let i=0;i<data.length;i++){if(data[i].id==="success_cardinality"){break}if(data[i].id==="cardinality_model_plot_high"){response.success=false;response.highCardinality=data[i].modelPlotCardinality;break}}return response}var use_create_url=__webpack_require__(87);var ml_url_generator=__webpack_require__(0);const useResolver=(indexPatternId,savedSearchId,config,resolvers)=>{const notifications=Object(contexts_kibana["f"])();const funcNames=Object.keys(resolvers);const funcs=Object.values(resolvers);const tempResults=funcNames.reduce((p,c)=>{p[c]={};return p},{});const[context,setContext]=Object(external_kbnSharedDeps_React_["useState"])(null);const[results,setResults]=Object(external_kbnSharedDeps_React_["useState"])(tempResults);const redirectToJobsManagementPage=Object(use_create_url["a"])(ml_url_generator["b"].ANOMALY_DETECTION_JOBS_MANAGE);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{(async()=>{try{const res=await Promise.all(funcs.map(r=>r()));res.forEach((r,i)=>tempResults[funcNames[i]]=r);setResults(tempResults)}catch(error){return}try{if(indexPatternId===""){throw new Error(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.useResolver.errorIndexPatternIdEmptyString",{defaultMessage:"indexPatternId must not be empty string."}))}let indexPatternAndSavedSearch={savedSearch:null,indexPattern:null};if(savedSearchId!==undefined){indexPatternAndSavedSearch=await Object(index_utils["a"])(savedSearchId)}else if(indexPatternId!==undefined){indexPatternAndSavedSearch.indexPattern=await Object(index_utils["b"])(indexPatternId)}const{savedSearch:savedSearch,indexPattern:indexPattern}=indexPatternAndSavedSearch;const{combinedQuery:combinedQuery}=createSearchItems(config,indexPattern!==null?indexPattern:undefined,savedSearch);setContext({combinedQuery:combinedQuery,currentIndexPattern:indexPattern,currentSavedSearch:savedSearch,indexPatterns:Object(index_utils["e"])(),kibanaConfig:config})}catch(error){notifications.toasts.addError(new Error(error),{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.useResolver.errorTitle",{defaultMessage:"An error has occurred"})});await redirectToJobsManagementPage()}})()},[]);return{context:context,results:results}};var check_capabilities=__webpack_require__(63);var ml_nodes_check=__webpack_require__(121);var ml_server_info=__webpack_require__(83);const ML_BREADCRUMB=Object.freeze({text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.machineLearningBreadcrumbLabel",{defaultMessage:"Machine Learning"}),href:"/"});const SETTINGS_BREADCRUMB=Object.freeze({text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.settingsBreadcrumbLabel",{defaultMessage:"Settings"}),href:"/settings"});const ANOMALY_DETECTION_BREADCRUMB=Object.freeze({text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomalyDetectionBreadcrumbLabel",{defaultMessage:"Anomaly Detection"}),href:"/jobs"});const DATA_FRAME_ANALYTICS_BREADCRUMB=Object.freeze({text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataFrameAnalyticsLabel",{defaultMessage:"Data Frame Analytics"}),href:"/data_frame_analytics"});const DATA_VISUALIZER_BREADCRUMB=Object.freeze({text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.datavisualizerBreadcrumbLabel",{defaultMessage:"Data Visualizer"}),href:"/datavisualizer"});const CREATE_JOB_BREADCRUMB=Object.freeze({text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.createJobsBreadcrumbLabel",{defaultMessage:"Create job"}),href:"/jobs/new_job"});const CALENDAR_MANAGEMENT_BREADCRUMB=Object.freeze({text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.settings.breadcrumbs.calendarManagementLabel",{defaultMessage:"Calendar management"}),href:"/settings/calendars_list"});const FILTER_LISTS_BREADCRUMB=Object.freeze({text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.settings.breadcrumbs.filterListsLabel",{defaultMessage:"Filter lists"}),href:"/settings/filter_lists"});const breadcrumbs={ML_BREADCRUMB:ML_BREADCRUMB,SETTINGS_BREADCRUMB:SETTINGS_BREADCRUMB,ANOMALY_DETECTION_BREADCRUMB:ANOMALY_DETECTION_BREADCRUMB,DATA_FRAME_ANALYTICS_BREADCRUMB:DATA_FRAME_ANALYTICS_BREADCRUMB,DATA_VISUALIZER_BREADCRUMB:DATA_VISUALIZER_BREADCRUMB,CREATE_JOB_BREADCRUMB:CREATE_JOB_BREADCRUMB,CALENDAR_MANAGEMENT_BREADCRUMB:CALENDAR_MANAGEMENT_BREADCRUMB,FILTER_LISTS_BREADCRUMB:FILTER_LISTS_BREADCRUMB};const breadcrumbOnClickFactory=(path,navigateToPath)=>e=>{e.preventDefault();navigateToPath(path)};const getBreadcrumbWithUrlForApp=(breadcrumbName,navigateToPath,basePath)=>({text:breadcrumbs[breadcrumbName].text,href:`${basePath}/app/ml${breadcrumbs[breadcrumbName].href}`,onClick:breadcrumbOnClickFactory(breadcrumbs[breadcrumbName].href,navigateToPath)});function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}const OverviewPage=external_kbnSharedDeps_React_default.a.lazy(()=>__webpack_require__.e(18).then(__webpack_require__.bind(null,839)));const overviewRouteFactory=(navigateToPath,basePath)=>({path:"/overview",render:(props,deps)=>external_kbnSharedDeps_React_default.a.createElement(PageWrapper,_extends({},props,{deps:deps})),breadcrumbs:[getBreadcrumbWithUrlForApp("ML_BREADCRUMB",navigateToPath,basePath),{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.overview.overviewLabel",{defaultMessage:"Overview"}),onClick:breadcrumbOnClickFactory("/overview",navigateToPath)}]});const PageWrapper=({deps:deps})=>{const{redirectToMlAccessDeniedPage:redirectToMlAccessDeniedPage}=deps;const{context:context}=useResolver(undefined,undefined,deps.config,{checkFullLicense:license["b"],checkGetJobsCapabilities:()=>Object(check_capabilities["c"])(redirectToMlAccessDeniedPage),getMlNodeCount:ml_nodes_check["b"],loadMlServerInfo:ml_server_info["e"]});Object(contexts_kibana["g"])({timeRangeSelector:false,autoRefreshSelector:false});return external_kbnSharedDeps_React_default.a.createElement(PageLoader,{context:context},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Suspense"],{fallback:null},external_kbnSharedDeps_React_default.a.createElement(OverviewPage,null)))};const appRootRouteFactory=(navigateToPath,basePath)=>({path:"/",render:()=>external_kbnSharedDeps_React_default.a.createElement(Page,null),breadcrumbs:[]});const Page=()=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ReactRouterDom_["Redirect"],{to:"/overview"});var useObservable=__webpack_require__(128);var useObservable_default=__webpack_require__.n(useObservable);var jobs_list=__webpack_require__(181);var timefilter_refresh_service=__webpack_require__(182);var check_ml_nodes=__webpack_require__(80);const basicResolvers=({indexPatterns:indexPatterns,redirectToMlAccessDeniedPage:redirectToMlAccessDeniedPage})=>({checkFullLicense:license["b"],getMlNodeCount:check_ml_nodes["c"],loadMlServerInfo:ml_server_info["e"],loadIndexPatterns:()=>Object(index_utils["g"])(indexPatterns),checkGetJobsCapabilities:()=>Object(check_capabilities["c"])(redirectToMlAccessDeniedPage),loadSavedSearches:index_utils["h"]});var jobs_list_jobs=__webpack_require__(227);var annotations_service=__webpack_require__(130);var ml_annotation_updates_context=__webpack_require__(132);function jobs_list_extends(){jobs_list_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return jobs_list_extends.apply(this,arguments)}const jobListRouteFactory=(navigateToPath,basePath)=>({path:"/jobs",render:(props,deps)=>external_kbnSharedDeps_React_default.a.createElement(jobs_list_PageWrapper,jobs_list_extends({},props,{deps:deps})),breadcrumbs:[getBreadcrumbWithUrlForApp("ML_BREADCRUMB",navigateToPath,basePath),getBreadcrumbWithUrlForApp("ANOMALY_DETECTION_BREADCRUMB",navigateToPath,basePath),{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomalyDetection.jobManagementLabel",{defaultMessage:"Job Management"}),href:""}]});const jobs_list_PageWrapper=({deps:deps})=>{var _mlTimefilterRefresh$,_globalState$refreshI,_globalState$refreshI2,_globalState$refreshI3,_globalState$refreshI4;const{context:context}=useResolver(undefined,undefined,deps.config,basicResolvers(deps));const timefilter=Object(contexts_kibana["g"])({timeRangeSelector:false,autoRefreshSelector:true});const[globalState,setGlobalState]=Object(url_state["c"])("_g");const mlTimefilterRefresh=useObservable_default()(timefilter_refresh_service["a"]);const lastRefresh=(_mlTimefilterRefresh$=mlTimefilterRefresh===null||mlTimefilterRefresh===void 0?void 0:mlTimefilterRefresh.lastRefresh)!==null&&_mlTimefilterRefresh$!==void 0?_mlTimefilterRefresh$:0;const refreshValue=(_globalState$refreshI=globalState===null||globalState===void 0?void 0:(_globalState$refreshI2=globalState.refreshInterval)===null||_globalState$refreshI2===void 0?void 0:_globalState$refreshI2.value)!==null&&_globalState$refreshI!==void 0?_globalState$refreshI:0;const refreshPause=(_globalState$refreshI3=globalState===null||globalState===void 0?void 0:(_globalState$refreshI4=globalState.refreshInterval)===null||_globalState$refreshI4===void 0?void 0:_globalState$refreshI4.pause)!==null&&_globalState$refreshI3!==void 0?_globalState$refreshI3:true;const blockRefresh=refreshValue===0||refreshPause===true;Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const refreshInterval=refreshValue===0&&refreshPause===true?{pause:false,value:jobs_list["a"]}:{pause:refreshPause,value:refreshValue};setGlobalState({refreshInterval:refreshInterval},undefined,true);timefilter.setRefreshInterval(refreshInterval)},[]);const annotationUpdatesService=Object(external_kbnSharedDeps_React_["useMemo"])(()=>new annotations_service["a"],[]);return external_kbnSharedDeps_React_default.a.createElement(PageLoader,{context:context},external_kbnSharedDeps_React_default.a.createElement(ml_annotation_updates_context["a"].Provider,{value:annotationUpdatesService},external_kbnSharedDeps_React_default.a.createElement(jobs_list_jobs["a"],{blockRefresh:blockRefresh,lastRefresh:lastRefresh})))};var external_kbnSharedDeps_ElasticEui_=__webpack_require__(33);var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(34);var savedObjects_public_=__webpack_require__(52);const page_Page=({nextStepPath:nextStepPath})=>{const RESULTS_PER_PAGE=20;const{uiSettings:uiSettings,savedObjects:savedObjects}=Object(contexts_kibana["b"])().services;const navigateToPath=Object(contexts_kibana["e"])();const onObjectSelection=(id,type)=>{navigateToPath(`${nextStepPath}?${type==="index-pattern"?"index":"savedSearchId"}=${encodeURIComponent(id)}`)};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPage"],{"data-test-subj":"mlPageSourceSelection"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageBody"],{restrictWidth:1200},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageHeaderSection"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"m"},external_kbnSharedDeps_React_default.a.createElement("h1",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.selectIndexPatternOrSavedSearch",defaultMessage:"Select index pattern or saved search"}))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageContent"],null,external_kbnSharedDeps_React_default.a.createElement(savedObjects_public_["SavedObjectFinderUi"],{key:"searchSavedObjectFinder",onChoose:onObjectSelection,showFilter:true,noItemsMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.searchSelection.notFoundLabel",{defaultMessage:"No matching indices or saved searches found."}),savedObjectMetaData:[{type:"search",getIconForSavedObject:()=>"search",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.searchSelection.savedObjectType.search",{defaultMessage:"Saved search"})},{type:"index-pattern",getIconForSavedObject:()=>"indexPatternApp",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.searchSelection.savedObjectType.indexPattern",{defaultMessage:"Index pattern"})}],fixedPageSize:RESULTS_PER_PAGE,uiSettings:uiSettings,savedObjects:savedObjects}))))};var job_service=__webpack_require__(65);var new_job=__webpack_require__(68);async function preConfiguredJobRedirect(indexPatterns,basePath,navigateToUrl){const{createdBy:createdBy,job:job,datafeed:datafeed}=job_service["a"].tempJobCloningObjects;if(job&&datafeed){try{await Object(index_utils["g"])(indexPatterns);const redirectUrl=getWizardUrlFromCloningJob(createdBy,job,datafeed);await navigateToUrl(`${basePath}/app/ml/${redirectUrl}`);return Promise.reject()}catch(error){return Promise.resolve()}}else{return Promise.resolve()}}function getWizardUrlFromCloningJob(createdBy,job,datafeed){const created=createdBy;let page="";switch(created){case new_job["a"].SINGLE_METRIC:page=new_job["f"].SINGLE_METRIC;break;case new_job["a"].MULTI_METRIC:page=new_job["f"].MULTI_METRIC;break;case new_job["a"].POPULATION:page=new_job["f"].POPULATION;break;case new_job["a"].CATEGORIZATION:page=new_job["f"].CATEGORIZATION;break;default:page=new_job["f"].ADVANCED;break}const indexPatternId=Object(index_utils["c"])(datafeed.indices.join());return`jobs/new_job/${page}?index=${indexPatternId}&_g=()`}function index_or_search_extends(){index_or_search_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return index_or_search_extends.apply(this,arguments)}var MODE;(function(MODE){MODE[MODE["NEW_JOB"]=0]="NEW_JOB";MODE[MODE["DATAVISUALIZER"]=1]="DATAVISUALIZER"})(MODE||(MODE={}));const getBreadcrumbs=(navigateToPath,basePath)=>[getBreadcrumbWithUrlForApp("ML_BREADCRUMB",navigateToPath,basePath),getBreadcrumbWithUrlForApp("ANOMALY_DETECTION_BREADCRUMB",navigateToPath,basePath),{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsBreadcrumbs.selectIndexOrSearchLabel",{defaultMessage:"Create job"}),href:""}];const indexOrSearchRouteFactory=(navigateToPath,basePath)=>({path:"/jobs/new_job/step/index_or_search",render:(props,deps)=>external_kbnSharedDeps_React_default.a.createElement(index_or_search_PageWrapper,index_or_search_extends({},props,{nextStepPath:"/jobs/new_job/step/job_type",deps:deps,mode:MODE.NEW_JOB})),breadcrumbs:getBreadcrumbs(navigateToPath,basePath)});const dataVizIndexOrSearchRouteFactory=(navigateToPath,basePath)=>({path:"/datavisualizer_index_select",render:(props,deps)=>external_kbnSharedDeps_React_default.a.createElement(index_or_search_PageWrapper,index_or_search_extends({},props,{nextStepPath:"/jobs/new_job/datavisualizer",deps:deps,mode:MODE.DATAVISUALIZER})),breadcrumbs:getBreadcrumbs(navigateToPath,basePath)});const index_or_search_PageWrapper=({nextStepPath:nextStepPath,deps:deps,mode:mode})=>{const{services:{http:{basePath:basePath},application:{navigateToUrl:navigateToUrl}}}=Object(contexts_kibana["b"])();const{redirectToMlAccessDeniedPage:redirectToMlAccessDeniedPage}=deps;const redirectToJobsManagementPage=Object(use_create_url["a"])(ml_url_generator["b"].ANOMALY_DETECTION_JOBS_MANAGE);const newJobResolvers={...basicResolvers(deps),preConfiguredJobRedirect:()=>preConfiguredJobRedirect(deps.indexPatterns,basePath.get(),navigateToUrl)};const dataVizResolvers={checkBasicLicense:license["a"],loadIndexPatterns:()=>Object(index_utils["g"])(deps.indexPatterns),checkGetJobsCapabilities:()=>Object(check_capabilities["c"])(redirectToMlAccessDeniedPage),checkMlNodesAvailable:()=>Object(ml_nodes_check["a"])(redirectToJobsManagementPage)};const{context:context}=useResolver(undefined,undefined,deps.config,mode===MODE.NEW_JOB?newJobResolvers:dataVizResolvers);return external_kbnSharedDeps_React_default.a.createElement(PageLoader,{context:context},external_kbnSharedDeps_React_default.a.createElement(page_Page,{nextStepPath:nextStepPath}))};var query_string=__webpack_require__(141);function isSavedSearchSavedObject(ss){return ss!==null}function link_card_extends(){link_card_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return link_card_extends.apply(this,arguments)}const LinkCard=({icon:icon,iconAreaLabel:iconAreaLabel,title:title,description:description,onClick:onClick,href:href,isDisabled:isDisabled,"data-test-subj":dateTestSubj})=>{const linkHrefAndOnClickProps={...href?{href:href}:{},...onClick?{onClick:onClick}:{}};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],{style:{cursor:isDisabled?"not-allowed":undefined}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],link_card_extends({style:{display:"block",pointerEvents:isDisabled?"none":undefined,background:"transparent",outline:"none"},"data-test-subj":dateTestSubj,color:"subdued"},linkHrefAndOnClickProps),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"l",responsive:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:{paddingTop:"8px"}},typeof icon==="string"?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{size:"xl",type:icon,"aria-label":iconAreaLabel}):icon),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h3",null,title)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{color:"subdued"},external_kbnSharedDeps_React_default.a.createElement("p",null,description))))))};const RecognizedResult=({config:config,indexPattern:indexPattern,savedSearch:savedSearch})=>{const{services:{http:{basePath:basePath}}}=Object(contexts_kibana["b"])();const id=savedSearch===null?`index=${indexPattern.id}`:`savedSearchId=${savedSearch.id}`;const href=`${basePath.get()}/app/ml/jobs/new_job/recognize?id=${config.id}&${id}`;let logo=null;if(config.logo&&config.logo.icon){logo=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:config.logo.icon,size:"xl"})}else if(config.logo&&config.logo.src){logo=external_kbnSharedDeps_React_default.a.createElement("img",{alt:"",src:config.logo.src})}else{logo=external_kbnSharedDeps_React_default.a.createElement("h3",{className:"euiTitle euiTitle--small"},config.id)}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(LinkCard,{"data-test-subj":`mlRecognizerCard ${config.id}`,href:href,title:config.title,description:config.description,icon:logo}))};var ml_api_service=__webpack_require__(59);class data_recognizer_DataRecognizer extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);this.state={results:[]};this.indexPattern=props.indexPattern;this.savedSearch=props.savedSearch;this.className=props.className;this.results=props.results}componentDidMount(){ml_api_service["ml"].recognizeIndex({indexPatternTitle:this.indexPattern.title}).then(resp=>{resp.sort((res1,res2)=>res1.title.localeCompare(res2.title));const results=resp.map(r=>external_kbnSharedDeps_React_default.a.createElement(RecognizedResult,{key:r.id,config:r,indexPattern:this.indexPattern,savedSearch:this.savedSearch}));if(typeof this.results==="object"){this.results.count=results.length;if(typeof this.results.onChange==="function"){this.results.onChange()}}this.setState({results:results})}).catch(e=>{console.error("Error attempting to recognize index",e)})}render(){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,this.state.results)}}var recently_accessed=__webpack_require__(185);const CategorizationIcon=external_kbnSharedDeps_React_default.a.createElement("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg"},external_kbnSharedDeps_React_default.a.createElement("path",{d:"M16 32C7.16344 32 0 24.8366 0 16C0 7.16344 7.16344 0 16 0C24.8366 0 32 7.16344 32 16H30C30 8.26801 23.732 2 16 2C8.26801 2 2 8.26801 2 16C2 23.732 8.26801 30 16 30V32Z",fill:"#343741"}),external_kbnSharedDeps_React_default.a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17 15H23V17H17V23H15V17H9V15H15V9H17V15ZM32 30V32H20V30H32ZM32 22L20 22V24L32 24V22ZM32 26V28H20V26H32Z",fill:"#017D73"}));const job_type_page_Page=()=>{const mlContext=Object(ml["b"])();const navigateToPath=Object(contexts_kibana["e"])();const onSelectDifferentIndex=Object(use_create_url["a"])(ml_url_generator["b"].ANOMALY_DETECTION_CREATE_JOB_SELECT_INDEX);const[recognizerResultsCount,setRecognizerResultsCount]=Object(external_kbnSharedDeps_React_["useState"])(0);const{currentSavedSearch:currentSavedSearch,currentIndexPattern:currentIndexPattern}=mlContext;const isTimeBasedIndex=Object(index_utils["i"])(currentIndexPattern);const indexWarningTitle=!isTimeBasedIndex&&isSavedSearchSavedObject(currentSavedSearch)?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobType.indexPatternFromSavedSearchNotTimeBasedMessage",{defaultMessage:"{savedSearchTitle} uses index pattern {indexPatternTitle} which is not time based",values:{savedSearchTitle:currentSavedSearch.attributes.title,indexPatternTitle:currentIndexPattern.title}}):external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobType.indexPatternNotTimeBasedMessage",{defaultMessage:"Index pattern {indexPatternTitle} is not time based",values:{indexPatternTitle:currentIndexPattern.title}});const pageTitleLabel=isSavedSearchSavedObject(currentSavedSearch)?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobType.savedSearchPageTitleLabel",{defaultMessage:"saved search {savedSearchTitle}",values:{savedSearchTitle:currentSavedSearch.attributes.title}}):external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobType.indexPatternPageTitleLabel",{defaultMessage:"index pattern {indexPatternTitle}",values:{indexPatternTitle:currentIndexPattern.title}});const recognizerResults={count:0,onChange(){setRecognizerResultsCount(recognizerResults.count)}};const getUrlParams=()=>!isSavedSearchSavedObject(currentSavedSearch)?`?index=${currentIndexPattern.id}`:`?savedSearchId=${currentSavedSearch.id}`;const addSelectionToRecentlyAccessed=()=>{const title=!isSavedSearchSavedObject(currentSavedSearch)?currentIndexPattern.title:currentSavedSearch.attributes.title;Object(recently_accessed["a"])("jobs/new_job/datavisualizer",title,"");navigateToPath(`/jobs/new_job/datavisualizer${getUrlParams()}`)};const jobTypes=[{onClick:()=>navigateToPath(`/jobs/new_job/single_metric${getUrlParams()}`),icon:{type:"createSingleMetricJob",ariaLabel:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobType.singleMetricAriaLabel",{defaultMessage:"Single metric job"})},title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobType.singleMetricTitle",{defaultMessage:"Single metric"}),description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobType.singleMetricDescription",{defaultMessage:"Detect anomalies in a single time series."}),id:"mlJobTypeLinkSingleMetricJob"},{onClick:()=>navigateToPath(`/jobs/new_job/multi_metric${getUrlParams()}`),icon:{type:"createMultiMetricJob",ariaLabel:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobType.multiMetricAriaLabel",{defaultMessage:"Multi-metric job"})},title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobType.multiMetricTitle",{defaultMessage:"Multi-metric"}),description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobType.multiMetricDescription",{defaultMessage:"Detect anomalies with one or more metrics and optionally split the analysis."}),id:"mlJobTypeLinkMultiMetricJob"},{onClick:()=>navigateToPath(`/jobs/new_job/population${getUrlParams()}`),icon:{type:"createPopulationJob",ariaLabel:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobType.populationAriaLabel",{defaultMessage:"Population job"})},title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobType.populationTitle",{defaultMessage:"Population"}),description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobType.populationDescription",{defaultMessage:"Detect activity that is unusual compared to the behavior of the population."}),id:"mlJobTypeLinkPopulationJob"},{onClick:()=>navigateToPath(`/jobs/new_job/advanced${getUrlParams()}`),icon:{type:"createAdvancedJob",ariaLabel:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobType.advancedAriaLabel",{defaultMessage:"Advanced job"})},title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobType.advancedTitle",{defaultMessage:"Advanced"}),description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobType.advancedDescription",{defaultMessage:"Use the full range of options to create a job for more advanced use cases."}),id:"mlJobTypeLinkAdvancedJob"},{onClick:()=>navigateToPath(`/jobs/new_job/categorization${getUrlParams()}`),icon:{type:CategorizationIcon,ariaLabel:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobType.categorizationAriaLabel",{defaultMessage:"Categorization job"})},title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobType.categorizationTitle",{defaultMessage:"Categorization"}),description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobType.categorizationDescription",{defaultMessage:"Group log messages into categories and detect anomalies within them."}),id:"mlJobTypeLinkCategorizationJob"}];return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPage"],{"data-test-subj":"mlPageJobTypeSelection"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageBody"],{restrictWidth:1200},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"l"},external_kbnSharedDeps_React_default.a.createElement("h1",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.jobType.createJobFromTitle",defaultMessage:"Create a job from the {pageTitleLabel}",values:{pageTitleLabel:pageTitleLabel}}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),isTimeBasedIndex===false&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:indexWarningTitle,color:"warning",iconType:"alert"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.jobType.howToRunAnomalyDetectionDescription",defaultMessage:"Anomaly detection can only be run over indices which are time based."}),external_kbnSharedDeps_React_default.a.createElement("br",null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{onClick:onSelectDifferentIndex},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.jobType.selectDifferentIndexLinkText",defaultMessage:"Select a different index"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xxl"})),external_kbnSharedDeps_React_default.a.createElement("div",{hidden:recognizerResultsCount===0},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.jobType.useSuppliedConfigurationTitle",defaultMessage:"Use preconfigured jobs"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.jobType.useSuppliedConfigurationDescription",defaultMessage:"The fields in your data match known configurations. Create a set of preconfigured jobs."}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGrid"],{gutterSize:"l",columns:4},external_kbnSharedDeps_React_default.a.createElement(data_recognizer_DataRecognizer,{indexPattern:currentIndexPattern,savedSearch:currentSavedSearch,results:recognizerResults})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xxl"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.jobType.useWizardTitle",defaultMessage:"Use a wizard"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGrid"],{gutterSize:"l",columns:4},jobTypes.map(({onClick:onClick,icon:icon,title:title,description:description,id:id})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{key:id},external_kbnSharedDeps_React_default.a.createElement(LinkCard,{"data-test-subj":id,onClick:onClick,icon:icon.type,iconAreaLabel:icon.ariaLabel,title:title,description:description,isDisabled:!isTimeBasedIndex})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xxl"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h3",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.jobType.learnMoreAboutDataTitle",defaultMessage:"Learn more about your data"}))),external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.jobType.learnMoreAboutDataDescription",defaultMessage:"If you're not sure what type of job to create, first explore the fields and metrics in your data."}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGrid"],{gutterSize:"l",columns:4},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(LinkCard,{icon:"dataVisualizer",iconAreaLabel:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobType.dataVisualizerAriaLabel",{defaultMessage:"Data Visualizer"}),title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.jobType.dataVisualizerTitle",defaultMessage:"Data Visualizer"}),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.jobType.dataVisualizerDescription",defaultMessage:"Learn more about the characteristics of your data and identify the fields for analysis with machine learning."}),onClick:addSelectionToRecentlyAccessed})))))};function job_type_extends(){job_type_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return job_type_extends.apply(this,arguments)}const jobTypeRouteFactory=(navigateToPath,basePath)=>({path:"/jobs/new_job/step/job_type",render:(props,deps)=>external_kbnSharedDeps_React_default.a.createElement(job_type_PageWrapper,job_type_extends({},props,{deps:deps})),breadcrumbs:[getBreadcrumbWithUrlForApp("ML_BREADCRUMB",navigateToPath,basePath),getBreadcrumbWithUrlForApp("ANOMALY_DETECTION_BREADCRUMB",navigateToPath,basePath),{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsBreadcrumbs.selectJobType",{defaultMessage:"Create job"}),href:""}]});const job_type_PageWrapper=({location:location,deps:deps})=>{const{index:index,savedSearchId:savedSearchId}=Object(query_string["parse"])(location.search,{sort:false});const{context:context}=useResolver(index,savedSearchId,deps.config,basicResolvers(deps));return external_kbnSharedDeps_React_default.a.createElement(PageLoader,{context:context},external_kbnSharedDeps_React_default.a.createElement(job_type_page_Page,null))};const newJobRouteFactory=()=>({path:"/jobs/new_job",render:()=>external_kbnSharedDeps_React_default.a.createElement(new_job_Page,null),breadcrumbs:[]});const new_job_Page=()=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ReactRouterDom_["Redirect"],{to:"/jobs/new_job/step/index_or_search"});var external_kbnSharedDeps_Rxjs_=__webpack_require__(19);var external_kbnSharedDeps_RxjsOperators_=__webpack_require__(21);var job_utils=__webpack_require__(64);var job_creator=__webpack_require__(93);var util=__webpack_require__(187);let VALIDATOR_SEVERITY;(function(VALIDATOR_SEVERITY){VALIDATOR_SEVERITY[VALIDATOR_SEVERITY["ERROR"]=0]="ERROR";VALIDATOR_SEVERITY[VALIDATOR_SEVERITY["WARNING"]=1]="WARNING"})(VALIDATOR_SEVERITY||(VALIDATOR_SEVERITY={}));const jobExistsErrorMessage=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.validateJob.asyncJobNameAlreadyExists",{defaultMessage:"Job ID already exists. A job ID cannot be the same as an existing job or group."});const groupExistsErrorMessage=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.validateJob.asyncGroupNameAlreadyExists",{defaultMessage:"Group ID already exists. A group ID cannot be the same as an existing group or job."});function isCardinalityModelPlotHigh(cardinalityValidationResult){return cardinalityValidationResult.modelPlotCardinality!==undefined}function cardinalityValidator(jobCreator$){return Object(external_kbnSharedDeps_Rxjs_["combineLatest"])([jobCreator$.pipe(Object(external_kbnSharedDeps_RxjsOperators_["pluck"])("modelPlot")),jobCreator$.pipe(Object(external_kbnSharedDeps_RxjsOperators_["filter"])(jobCreator=>jobCreator===null||jobCreator===void 0?void 0:jobCreator.modelPlot),Object(external_kbnSharedDeps_RxjsOperators_["map"])(jobCreator=>({jobCreator:jobCreator,analysisConfigString:JSON.stringify(jobCreator.jobConfig.analysis_config,null,2)})),Object(external_kbnSharedDeps_RxjsOperators_["distinctUntilChanged"])((prev,curr)=>prev.analysisConfigString===curr.analysisConfigString),Object(external_kbnSharedDeps_RxjsOperators_["switchMap"])(({jobCreator:jobCreator})=>ml_api_service["ml"].validateCardinality$({...jobCreator.jobConfig,datafeed_config:jobCreator.datafeedConfig}).pipe(Object(external_kbnSharedDeps_RxjsOperators_["map"])(validationResults=>{for(const validationResult of validationResults){if(isCardinalityModelPlotHigh(validationResult)){return{highCardinality:{value:validationResult.modelPlotCardinality,severity:VALIDATOR_SEVERITY.WARNING}}}}return null}))),Object(external_kbnSharedDeps_RxjsOperators_["startWith"])(null))]).pipe(Object(external_kbnSharedDeps_RxjsOperators_["map"])(([isModelPlotEnabled,cardinalityValidationResult])=>isModelPlotEnabled?cardinalityValidationResult:null))}function jobIdValidator(jobCreator$){return jobCreator$.pipe(Object(external_kbnSharedDeps_RxjsOperators_["map"])(jobCreator=>jobCreator.jobId),Object(external_kbnSharedDeps_RxjsOperators_["distinctUntilChanged"])((prevJobId,currJobId)=>prevJobId===currJobId),Object(external_kbnSharedDeps_RxjsOperators_["switchMap"])(jobId=>ml_api_service["ml"].jobs.jobsExist$([jobId],true)),Object(external_kbnSharedDeps_RxjsOperators_["map"])(jobExistsResults=>{const jobs=Object.values(jobExistsResults);const valid=(jobs===null||jobs===void 0?void 0:jobs[0].exists)===false;return{jobIdExists:{valid:valid,...valid?{}:{message:jobExistsErrorMessage}}}}))}function groupIdsValidator(jobCreator$){return jobCreator$.pipe(Object(external_kbnSharedDeps_RxjsOperators_["map"])(jobCreator=>jobCreator.groups),Object(external_kbnSharedDeps_RxjsOperators_["distinctUntilChanged"])((prevGroups,currGroups)=>JSON.stringify(prevGroups)===JSON.stringify(currGroups)),Object(external_kbnSharedDeps_RxjsOperators_["switchMap"])(groups=>ml_api_service["ml"].jobs.jobsExist$(groups,true)),Object(external_kbnSharedDeps_RxjsOperators_["map"])(jobExistsResults=>{const groups=Object.values(jobExistsResults);const valid=groups.some(g=>g.exists===true&&g.isGroup===false)===false;return{groupIdsExist:{valid:valid,...valid?{}:{message:groupExistsErrorMessage}}}}))}var categorization_job=__webpack_require__(155);function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const VALIDATION_DELAY_MS=500;class job_validator_JobValidator{constructor(jobCreator){_defineProperty(this,"_jobCreator",void 0);_defineProperty(this,"_validationSummary",void 0);_defineProperty(this,"_lastJobConfig",void 0);_defineProperty(this,"_lastDatafeedConfig",void 0);_defineProperty(this,"_validateTimeout",null);_defineProperty(this,"_asyncValidators$",[]);_defineProperty(this,"_asyncValidatorsResult$",void 0);_defineProperty(this,"_basicValidations",{jobId:{valid:true},groupIds:{valid:true},modelMemoryLimit:{valid:true},bucketSpan:{valid:true},duplicateDetectors:{valid:true},query:{valid:true},queryDelay:{valid:true},frequency:{valid:true},scrollSize:{valid:true},categorizerMissingPerPartition:{valid:true},categorizerVaryingPerPartitionField:{valid:true},summaryCountField:{valid:true}});_defineProperty(this,"_advancedValidations",{categorizationFieldValid:{valid:true}});_defineProperty(this,"_validating",false);_defineProperty(this,"_basicValidationResult$",new external_kbnSharedDeps_Rxjs_["ReplaySubject"](2));_defineProperty(this,"_jobCreatorSubject$",new external_kbnSharedDeps_Rxjs_["Subject"]);_defineProperty(this,"validationResult$",void 0);_defineProperty(this,"latestValidationResult",this._basicValidations);this._jobCreator=jobCreator;this._lastJobConfig=this._jobCreator.formattedJobJson;this._lastDatafeedConfig=this._jobCreator.formattedDatafeedJson;this._validationSummary={basic:false,advanced:false};this._asyncValidators$=[cardinalityValidator(this._jobCreatorSubject$),jobIdValidator(this._jobCreatorSubject$),groupIdsValidator(this._jobCreatorSubject$)];this._asyncValidatorsResult$=Object(external_kbnSharedDeps_Rxjs_["combineLatest"])(this._asyncValidators$).pipe(Object(external_kbnSharedDeps_RxjsOperators_["map"])(res=>res.reduce((acc,curr)=>({...acc,...curr?curr:{}}),{})),Object(external_kbnSharedDeps_RxjsOperators_["startWith"])({}));this.validationResult$=Object(external_kbnSharedDeps_Rxjs_["combineLatest"])([this._basicValidationResult$,this._asyncValidatorsResult$]).pipe(Object(external_kbnSharedDeps_RxjsOperators_["map"])(([basicValidationResult,asyncValidatorsResult])=>({...basicValidationResult,...asyncValidatorsResult})),Object(external_kbnSharedDeps_RxjsOperators_["tap"])(latestValidationResult=>{this.latestValidationResult=latestValidationResult}))}validate(callback,forceValidate=false){this._validating=true;const formattedJobConfig=this._jobCreator.formattedJobJson;const formattedDatafeedConfig=this._jobCreator.formattedDatafeedJson;this._runAdvancedValidation();if(forceValidate||formattedJobConfig!==this._lastJobConfig||formattedDatafeedConfig!==this._lastDatafeedConfig){if(this._validateTimeout!==null){clearTimeout(this._validateTimeout)}this._lastJobConfig=formattedJobConfig;this._lastDatafeedConfig=formattedDatafeedConfig;this._validateTimeout=setTimeout(()=>{this._runBasicValidation();this._jobCreatorSubject$.next(this._jobCreator);this._validating=false;this._validateTimeout=null;callback()},VALIDATION_DELAY_MS)}else{this._validating=this._validateTimeout!==null}callback()}_resetBasicValidations(){this._validationSummary.basic=true;Object.values(this._basicValidations).forEach(v=>{v.valid=true;delete v.message})}_runBasicValidation(){this._resetBasicValidations();const jobConfig=this._jobCreator.jobConfig;const datafeedConfig=this._jobCreator.datafeedConfig;const limits=Object(ml_server_info["c"])();const basicJobResults=Object(job_utils["e"])(jobConfig,undefined,limits);Object(util["b"])(basicJobResults,this._basicValidations,jobConfig,datafeedConfig);const basicDatafeedResults=Object(job_utils["c"])(datafeedConfig);Object(util["b"])(basicDatafeedResults,this._basicValidations,jobConfig,datafeedConfig);const basicJobAndDatafeedResults=Object(job_utils["d"])(jobConfig,datafeedConfig);Object(util["b"])(basicJobAndDatafeedResults,this._basicValidations,jobConfig,datafeedConfig);this._validationSummary.basic=this._isOverallBasicValid();this._basicValidationResult$.next(this._basicValidations)}_runAdvancedValidation(){if(Object(job_creator["b"])(this._jobCreator)){this._advancedValidations.categorizationFieldValid.valid=this._jobCreator.overallValidStatus!==categorization_job["a"].INVALID}}_isOverallBasicValid(){return Object.values(this._basicValidations).some(v=>v.valid===false)===false}get validationSummary(){return this._validationSummary}get bucketSpan(){return this._basicValidations.bucketSpan}get summaryCountField(){return this._basicValidations.summaryCountField}get duplicateDetectors(){return this._basicValidations.duplicateDetectors}get jobId(){return this._basicValidations.jobId}get groupIds(){return this._basicValidations.groupIds}get modelMemoryLimit(){return this._basicValidations.modelMemoryLimit}get query(){return this._basicValidations.query}get queryDelay(){return this._basicValidations.queryDelay}get frequency(){return this._basicValidations.frequency}get scrollSize(){return this._basicValidations.scrollSize}set advancedValid(valid){this._validationSummary.advanced=valid}get validating(){return this._validating}get categorizationField(){return this._advancedValidations.categorizationFieldValid.valid}set categorizationField(valid){this._advancedValidations.categorizationFieldValid.valid=valid}get categorizerMissingPerPartition(){return this._basicValidations.categorizerMissingPerPartition}get categorizerVaryingPerPartitionField(){return this._basicValidations.categorizerVaryingPerPartitionField}get isPickFieldsStepValid(){return this._jobCreator.detectors.length>0&&(this._jobCreator.type!==new_job["f"].ADVANCED||this._jobCreator.type===new_job["f"].ADVANCED&&this.modelMemoryLimit.valid)&&this.bucketSpan.valid&&this.duplicateDetectors.valid&&this.categorizerMissingPerPartition.valid&&this.categorizerVaryingPerPartitionField.valid&&this.summaryCountField.valid&&!this.validating&&(this._jobCreator.type!==new_job["f"].CATEGORIZATION||this._jobCreator.type===new_job["f"].CATEGORIZATION&&this.categorizationField)}get isModelMemoryEstimationPayloadValid(){return this._jobCreator.detectors.length>0&&this.bucketSpan.valid&&this.duplicateDetectors.valid&&(this._jobCreator.type!==new_job["f"].CATEGORIZATION||this._jobCreator.type===new_job["f"].CATEGORIZATION&&this.categorizationField)}}var util_errors=__webpack_require__(20);const modelMemoryEstimatorProvider=(jobCreator,jobValidator)=>{const modelMemoryCheck$=new external_kbnSharedDeps_Rxjs_["Subject"];const error$=new external_kbnSharedDeps_Rxjs_["Subject"];return{get error$(){return error$.asObservable()},get updates$(){return Object(external_kbnSharedDeps_Rxjs_["combineLatest"])([jobCreator.wizardInitialized$.pipe(Object(external_kbnSharedDeps_RxjsOperators_["skipWhile"])(wizardInitialized=>wizardInitialized===false)),modelMemoryCheck$]).pipe(Object(external_kbnSharedDeps_RxjsOperators_["map"])(([,payload])=>payload),Object(external_kbnSharedDeps_RxjsOperators_["debounceTime"])(VALIDATION_DELAY_MS+100),Object(external_kbnSharedDeps_RxjsOperators_["map"])(external_kbnSharedDeps_Lodash_["cloneDeep"]),Object(external_kbnSharedDeps_RxjsOperators_["distinctUntilChanged"])(external_kbnSharedDeps_Lodash_["isEqual"]),Object(external_kbnSharedDeps_RxjsOperators_["filter"])(()=>jobValidator.isModelMemoryEstimationPayloadValid),Object(external_kbnSharedDeps_RxjsOperators_["switchMap"])(payload=>ml_api_service["ml"].calculateModelMemoryLimit$(payload).pipe(Object(external_kbnSharedDeps_RxjsOperators_["pluck"])("modelMemoryLimit"),Object(external_kbnSharedDeps_RxjsOperators_["catchError"])(error=>{console.error("Model memory limit could not be calculated",error.body);error$.next(error);return Object(external_kbnSharedDeps_Rxjs_["of"])(new_job["c"])}))))},update(payload){modelMemoryCheck$.next(payload)}}};const useModelMemoryEstimator=(jobCreator,jobValidator,jobCreatorUpdate,jobCreatorUpdated)=>{const{services:{notifications:notifications}}=Object(contexts_kibana["b"])();const modelMemoryEstimator=Object(external_kbnSharedDeps_React_["useMemo"])(()=>modelMemoryEstimatorProvider(jobCreator,jobValidator),[]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const subscription=new external_kbnSharedDeps_Rxjs_["Subscription"];subscription.add(modelMemoryEstimator.updates$.pipe(Object(external_kbnSharedDeps_RxjsOperators_["startWith"])(jobCreator.modelMemoryLimit),Object(external_kbnSharedDeps_RxjsOperators_["pairwise"])()).subscribe(([previousEstimation,currentEstimation])=>{if(jobCreator.modelMemoryLimit===null||jobCreator.modelMemoryLimit===previousEstimation){jobCreator.modelMemoryLimit=currentEstimation;jobCreatorUpdate()}}));subscription.add(modelMemoryEstimator.error$.subscribe(error=>{notifications.toasts.addWarning({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.estimateModelMemoryError",{defaultMessage:"Model memory limit could not be calculated"}),text:Object(util_errors["i"])(error)})}));return()=>{subscription.unsubscribe()}},[]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{modelMemoryEstimator.update({datafeedConfig:jobCreator.datafeedConfig,analysisConfig:jobCreator.jobConfig.analysis_config,indexPattern:jobCreator.indexPatternTitle,query:jobCreator.datafeedConfig.query,timeFieldName:jobCreator.jobConfig.data_description.time_field,earliestMs:jobCreator.start,latestMs:jobCreator.end})},[jobCreatorUpdated])};let WIZARD_STEPS;(function(WIZARD_STEPS){WIZARD_STEPS[WIZARD_STEPS["TIME_RANGE"]=0]="TIME_RANGE";WIZARD_STEPS[WIZARD_STEPS["ADVANCED_CONFIGURE_DATAFEED"]=1]="ADVANCED_CONFIGURE_DATAFEED";WIZARD_STEPS[WIZARD_STEPS["PICK_FIELDS"]=2]="PICK_FIELDS";WIZARD_STEPS[WIZARD_STEPS["JOB_DETAILS"]=3]="JOB_DETAILS";WIZARD_STEPS[WIZARD_STEPS["VALIDATION"]=4]="VALIDATION";WIZARD_STEPS[WIZARD_STEPS["SUMMARY"]=5]="SUMMARY"})(WIZARD_STEPS||(WIZARD_STEPS={}));const JobCreatorContext=Object(external_kbnSharedDeps_React_["createContext"])({jobCreatorUpdated:0,jobCreatorUpdate:()=>{},jobCreator:{},chartLoader:{},resultsLoader:{},chartInterval:{},jobValidator:{},jobValidatorUpdated:0,fields:[],aggs:[],existingJobsAndGroups:{}});var new_job_capabilities_service=__webpack_require__(75);var external_kbnSharedDeps_Moment_=__webpack_require__(12);var external_kbnSharedDeps_Moment_default=__webpack_require__.n(external_kbnSharedDeps_Moment_);const WizardNav=({previous:previous,previousActive:previousActive=true,next:next,nextActive:nextActive=true,children:children})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,previous&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(PreviousButton,{previous:previous,previousActive:previousActive})),next&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(NextButton,{next:next,nextActive:nextActive})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},children),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null)));const PreviousButton=({previous:previous,previousActive:previousActive=true})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{disabled:!previousActive,onClick:previous,iconType:"arrowLeft",iconSide:"left","data-test-subj":"mlJobWizardNavButtonPrevious"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.previousStepButton",defaultMessage:"Previous"}));const NextButton=({next:next,nextActive:nextActive=true})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{fill:true,disabled:!nextActive,onClick:next,iconSide:"right",iconType:"arrowRight","data-test-subj":"mlJobWizardNavButtonNext"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.nextStepButton",defaultMessage:"Next"}));var elastic_datemath=__webpack_require__(26);var elastic_datemath_default=__webpack_require__.n(elastic_datemath);async function setFullTimeRange(indexPattern,query){try{const timefilter=Object(dependency_cache["i"])();const resp=await ml_api_service["ml"].getTimeFieldRange({index:indexPattern.title,timeFieldName:indexPattern.timeFieldName,query:query});timefilter.setTime({from:external_kbnSharedDeps_Moment_default()(resp.start.epoch).toISOString(),to:external_kbnSharedDeps_Moment_default()(resp.end.epoch).toISOString()});return resp}catch(resp){const toastNotifications=Object(dependency_cache["j"])();toastNotifications.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fullTimeRangeSelector.errorSettingTimeRangeNotification",{defaultMessage:"An error occurred setting the time range."}));return resp}}function getTimeFilterRange(){const timefilter=Object(dependency_cache["i"])();const fromMoment=elastic_datemath_default.a.parse(timefilter.getTime().from);const toMoment=elastic_datemath_default.a.parse(timefilter.getTime().to);const from=fromMoment!==undefined?fromMoment.valueOf():0;const to=toMoment!==undefined?toMoment.valueOf():0;return{to:to,from:from}}const FullTimeRangeSelector=({indexPattern:indexPattern,query:query,disabled:disabled,callback:callback})=>{async function setRange(i,q){const fullTimeRange=await setFullTimeRange(i,q);if(typeof callback==="function"){callback(fullTimeRange)}}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{isDisabled:disabled,onClick:()=>setRange(indexPattern,query),"data-test-subj":"mlButtonUseFullData"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fullTimeRangeSelector.useFullDataButtonLabel",defaultMessage:"Use full {indexPatternTitle} data",values:{indexPatternTitle:indexPattern.title}}))};var event_rate_chart=__webpack_require__(215);var group_color_utils=__webpack_require__(142);const Description=Object(external_kbnSharedDeps_React_["memo"])(({children:children,validation:validation})=>{const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobDetailsStep.jobGroupSelect.title",{defaultMessage:"Groups"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{title:external_kbnSharedDeps_React_default.a.createElement("h3",null,title),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.jobDetailsStep.jobGroupSelect.description",defaultMessage:" Optional grouping for jobs. New groups can be created or picked from the list of existing groups."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:title,error:validation.message,isInvalid:validation.valid===false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children)))});const JobGroupsInput=Object(external_kbnSharedDeps_React_["memo"])(({existingGroups:existingGroups,selectedGroups:selectedGroups,onChange:onChange,validation:validation})=>{const options=existingGroups.map(g=>({label:g,color:Object(group_color_utils["a"])(g)}));const selectedOptions=selectedGroups.map(g=>({label:g,color:Object(group_color_utils["a"])(g)}));function onChangeCallback(optionsIn){onChange(optionsIn.map(g=>g.label))}function onCreateGroup(input,flattenedOptions){const normalizedSearchValue=input.trim().toLowerCase();if(!normalizedSearchValue){return}const newGroup={label:input,color:Object(group_color_utils["a"])(input)};if(flattenedOptions.findIndex(option=>option.label.trim().toLowerCase()===normalizedSearchValue)===-1){options.push(newGroup)}onChangeCallback([...selectedOptions,newGroup])}return external_kbnSharedDeps_React_default.a.createElement(Description,{validation:validation},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{placeholder:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobDetailsStep.jobGroupSelect.placeholder",{defaultMessage:"Select or create groups"}),options:options,selectedOptions:selectedOptions,onChange:onChangeCallback,onCreateOption:onCreateGroup,isClearable:true,isInvalid:!validation.valid,"data-test-subj":"mlJobWizardComboBoxJobGroups"}))});const WIDTH="512px";const TimeRangePicker=({setTimeRange:setTimeRange,timeRange:timeRange})=>{const mlContext=Object(ml["b"])();const dateFormat=mlContext.kibanaConfig.get("dateFormat");const[startMoment,setStartMoment]=Object(external_kbnSharedDeps_React_["useState"])(external_kbnSharedDeps_Moment_default()(timeRange.start));const[endMoment,setEndMoment]=Object(external_kbnSharedDeps_React_["useState"])(external_kbnSharedDeps_Moment_default()(timeRange.end));function handleChangeStart(date){setStartMoment(date||undefined)}function handleChangeEnd(date){setEndMoment(date||undefined)}Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(startMoment!==undefined&&endMoment!==undefined){setTimeRange({start:startMoment.valueOf(),end:endMoment.valueOf()})}},[startMoment,endMoment]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setStartMoment(external_kbnSharedDeps_Moment_default()(timeRange.start));setEndMoment(external_kbnSharedDeps_Moment_default()(timeRange.end))},[JSON.stringify(timeRange)]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement("div",{style:{minWidth:WIDTH},"data-test-subj":`mlJobWizardDateRange`},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDatePickerRange"],{fullWidth:true,startDateControl:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDatePicker"],{selected:startMoment,onChange:handleChangeStart,startDate:startMoment,endDate:endMoment,"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.timeRangeStep.timeRangePicker.startDateLabel",{defaultMessage:"Start date"}),showTimeSelect:true,dateFormat:dateFormat,maxDate:endMoment}),endDateControl:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDatePicker"],{selected:endMoment,onChange:handleChangeEnd,startDate:startMoment,endDate:endMoment,"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.timeRangeStep.timeRangePicker.endDateLabel",{defaultMessage:"End date"}),showTimeSelect:true,dateFormat:dateFormat,minDate:startMoment})})))};const TimeRangeStep=({setCurrentStep:setCurrentStep,isCurrentStep:isCurrentStep})=>{const{services:services}=Object(contexts_kibana["b"])();const mlContext=Object(ml["b"])();const{jobCreator:jobCreator,jobCreatorUpdate:jobCreatorUpdate,jobCreatorUpdated:jobCreatorUpdated,chartLoader:chartLoader,chartInterval:chartInterval}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const[timeRange,setTimeRange]=Object(external_kbnSharedDeps_React_["useState"])({start:jobCreator.start,end:jobCreator.end});const[eventRateChartData,setEventRateChartData]=Object(external_kbnSharedDeps_React_["useState"])([]);const[loadingData,setLoadingData]=Object(external_kbnSharedDeps_React_["useState"])(false);async function loadChart(){setLoadingData(true);try{const resp=await chartLoader.loadEventRateChart(jobCreator.start,jobCreator.end,chartInterval.getInterval().asMilliseconds());setEventRateChartData(resp)}catch(error){setEventRateChartData([])}setLoadingData(false)}Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const{start:start,end:end}=timeRange;jobCreator.setTimeRange(start,end);chartInterval.setBounds({min:external_kbnSharedDeps_Moment_default()(start),max:external_kbnSharedDeps_Moment_default()(end)});const{timefilter:timefilter}=services.data.query.timefilter;timefilter.setTime({from:external_kbnSharedDeps_Moment_default()(start).toISOString(),to:external_kbnSharedDeps_Moment_default()(end).toISOString()});jobCreatorUpdate();loadChart()},[JSON.stringify(timeRange)]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setTimeRange({start:jobCreator.start,end:jobCreator.end})},[jobCreatorUpdated]);function fullTimeRangeCallback(range){if(range.start.epoch!==null&&range.end.epoch!==null){setTimeRange({start:range.start.epoch,end:range.end.epoch})}else{const{toasts:toasts}=services.notifications;toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.timeRangeStep.fullTimeRangeError",{defaultMessage:"An error occurred obtaining the time range for the index"}))}}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,isCurrentStep&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(TimeRangePicker,{setTimeRange:setTimeRange,timeRange:timeRange})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(FullTimeRangeSelector,{indexPattern:mlContext.currentIndexPattern,query:mlContext.combinedQuery,disabled:false,callback:fullTimeRangeCallback})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement(event_rate_chart["a"],{eventRateChartData:eventRateChartData,height:"300px",width:"100%",showAxis:true,loading:loadingData}),external_kbnSharedDeps_React_default.a.createElement(WizardNav,{next:()=>setCurrentStep(jobCreator.type===new_job["f"].ADVANCED?WIZARD_STEPS.ADVANCED_CONFIGURE_DATAFEED:WIZARD_STEPS.PICK_FIELDS),nextActive:true})))};const AggSelect=({fields:fields,changeHandler:changeHandler,selectedOptions:selectedOptions,removeOptions:removeOptions})=>{const{jobValidator:jobValidator,jobValidatorUpdated:jobValidatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const[validation,setValidation]=Object(external_kbnSharedDeps_React_["useState"])(jobValidator.duplicateDetectors);const removeLabels=removeOptions.map(createLabel);const options=fields.map(f=>{const aggOption={label:f.name,options:[]};if(typeof f.aggs!=="undefined"){aggOption.options=f.aggs.filter(a=>a.dslName!==null).map(a=>({label:`${a.title}(${f.name})`,agg:a,field:f})).filter(o=>removeLabels.includes(o.label)===false)}return aggOption});Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setValidation(jobValidator.duplicateDetectors)},[jobValidatorUpdated]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{error:validation.message,isInvalid:validation.valid===false,"data-test-subj":"mlJobWizardAggSelection"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{singleSelection:{asPlainText:true},options:options,selectedOptions:selectedOptions,onChange:changeHandler,isClearable:false,isInvalid:validation.valid===false}))};function createLabel(pair){return`${pair.agg.title}(${pair.field.name})`}var fields_utils=__webpack_require__(186);var external_kbnSharedDeps_ElasticCharts_=__webpack_require__(37);var common_anomalies=__webpack_require__(297);var common_settings=__webpack_require__(112);const SPEC_ID="model";const areaSeriesStyle={...common_settings["c"],area:{...common_settings["c"].area,visible:true},line:{...common_settings["c"].line,strokeWidth:1,opacity:.4}};const ModelBounds=({modelData:modelData})=>{const{MODEL_COLOR:MODEL_COLOR}=Object(common_settings["d"])();const model=modelData===undefined?[]:modelData;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["AreaSeries"],{id:SPEC_ID,xScaleType:external_kbnSharedDeps_ElasticCharts_["ScaleType"].Time,yScaleType:external_kbnSharedDeps_ElasticCharts_["ScaleType"].Linear,xAccessor:"time",yAccessors:["modelUpper"],y0Accessors:["modelLower"],data:model,stackAccessors:["time"],yScaleToDataExtent:false,curve:external_kbnSharedDeps_ElasticCharts_["CurveType"].CURVE_MONOTONE_X,areaSeriesStyle:areaSeriesStyle,color:MODEL_COLOR})};const line_SPEC_ID="line";const lineSeriesStyle={...common_settings["c"]};const Line=({chartData:chartData})=>{const{LINE_COLOR:LINE_COLOR}=Object(common_settings["d"])();return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["LineSeries"],{id:line_SPEC_ID,xScaleType:external_kbnSharedDeps_ElasticCharts_["ScaleType"].Time,yScaleType:external_kbnSharedDeps_ElasticCharts_["ScaleType"].Linear,xAccessor:"time",yAccessors:["value"],data:chartData,yScaleToDataExtent:false,curve:external_kbnSharedDeps_ElasticCharts_["CurveType"].CURVE_MONOTONE_X,lineSeriesStyle:lineSeriesStyle,color:LINE_COLOR})};const scatter_SPEC_ID="scatter";const scatterSeriesStyle={...common_settings["c"],line:{...common_settings["c"].line,visible:false},point:{...common_settings["c"].point,visible:true}};const Scatter=({chartData:chartData})=>{const{LINE_COLOR:LINE_COLOR}=Object(common_settings["d"])();return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["LineSeries"],{id:scatter_SPEC_ID,xScaleType:external_kbnSharedDeps_ElasticCharts_["ScaleType"].Time,yScaleType:external_kbnSharedDeps_ElasticCharts_["ScaleType"].Linear,xAccessor:"time",yAccessors:["value"],data:chartData,yScaleToDataExtent:false,curve:external_kbnSharedDeps_ElasticCharts_["CurveType"].CURVE_MONOTONE_X,lineSeriesStyle:scatterSeriesStyle,color:LINE_COLOR})};var common_axes=__webpack_require__(295);var utils=__webpack_require__(296);var loading_wrapper=__webpack_require__(272);let CHART_TYPE;(function(CHART_TYPE){CHART_TYPE[CHART_TYPE["LINE"]=0]="LINE";CHART_TYPE[CHART_TYPE["SCATTER"]=1]="SCATTER"})(CHART_TYPE||(CHART_TYPE={}));const AnomalyChart=({chartType:chartType,chartData:chartData=[],modelData:modelData,anomalyData:anomalyData,height:height,width:width,loading:loading=false})=>{const data=chartType===CHART_TYPE.SCATTER?flattenData(chartData):chartData;const xDomain=Object(utils["a"])(data);return external_kbnSharedDeps_React_default.a.createElement("div",{style:{width:width,height:height},"data-test-subj":`mlAnomalyChart ${CHART_TYPE[chartType]}`},external_kbnSharedDeps_React_default.a.createElement(loading_wrapper["a"],{height:height,hasData:data.length>0,loading:loading},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Chart"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Settings"],{xDomain:xDomain,tooltip:external_kbnSharedDeps_ElasticCharts_["TooltipType"].None}),external_kbnSharedDeps_React_default.a.createElement(common_axes["a"],{chartData:data}),external_kbnSharedDeps_React_default.a.createElement(common_anomalies["a"],{anomalyData:anomalyData}),external_kbnSharedDeps_React_default.a.createElement(ModelBounds,{modelData:modelData}),chartType===CHART_TYPE.LINE&&external_kbnSharedDeps_React_default.a.createElement(Line,{chartData:data}),chartType===CHART_TYPE.SCATTER&&external_kbnSharedDeps_React_default.a.createElement(Scatter,{chartData:data}))))};function flattenData(data){const chartData=data.reduce((p,c)=>{p.push(...c.values.map(v=>({time:c.time,value:v.value})));return p},[]);return chartData}var toast_notification_service=__webpack_require__(72);const DTR_IDX=0;const SingleMetricDetectors=({setIsValid:setIsValid})=>{const{jobCreator:jc,jobCreatorUpdate:jobCreatorUpdate,jobCreatorUpdated:jobCreatorUpdated,chartLoader:chartLoader,chartInterval:chartInterval}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const jobCreator=jc;const fields=Object(external_kbnSharedDeps_React_["useMemo"])(()=>Object(fields_utils["b"])([...new_job_capabilities_service["c"].fields,...jobCreator.runtimeFields]),[]);const[selectedOptions,setSelectedOptions]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.aggFieldPair!==null?[{label:createLabel(jobCreator.aggFieldPair)}]:[]);const[aggFieldPair,setAggFieldPair]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.aggFieldPair);const[lineChartsData,setLineChartData]=Object(external_kbnSharedDeps_React_["useState"])({});const[loadingData,setLoadingData]=Object(external_kbnSharedDeps_React_["useState"])(false);const[start,setStart]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.start);const[end,setEnd]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.end);const[bucketSpanMs,setBucketSpanMs]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.bucketSpanMs);function detectorChangeHandler(selectedOptionsIn){setSelectedOptions(selectedOptionsIn);if(selectedOptionsIn.length){const option=selectedOptionsIn[0];if(typeof option!=="undefined"){setAggFieldPair({agg:option.agg,field:option.field})}else{setAggFieldPair(null)}}}Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(aggFieldPair!==null){jobCreator.setDetector(aggFieldPair.agg,aggFieldPair.field);jobCreatorUpdate();loadChart();setIsValid(aggFieldPair!==null)}},[aggFieldPair]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(jobCreator.start!==start||jobCreator.end!==end){setStart(jobCreator.start);setEnd(jobCreator.end);loadChart()}if(jobCreator.bucketSpanMs!==bucketSpanMs){setBucketSpanMs(jobCreator.bucketSpanMs);loadChart()}},[jobCreatorUpdated]);async function loadChart(){if(aggFieldPair!==null){setLoadingData(true);try{const cs=Object(common_settings["b"])(jobCreator,chartInterval);const resp=await chartLoader.loadLineCharts(jobCreator.start,jobCreator.end,[aggFieldPair],null,null,cs.intervalMs,jobCreator.runtimeMappings);if(resp[DTR_IDX]!==undefined){setLineChartData(resp)}}catch(error){Object(toast_notification_service["a"])().displayErrorToast(error);setLineChartData({})}setLoadingData(false)}}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(AggSelect,{fields:fields,changeHandler:detectorChangeHandler,selectedOptions:selectedOptions,removeOptions:[]}),(lineChartsData[DTR_IDX]!==undefined||loadingData===true)&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(AnomalyChart,{chartType:CHART_TYPE.LINE,chartData:lineChartsData[DTR_IDX],modelData:[],anomalyData:[],height:"300px",width:"100%",loading:loadingData})))};const metric_selection_summary_DTR_IDX=0;const SingleMetricDetectorsSummary=()=>{const{jobCreator:jc,chartLoader:chartLoader,resultsLoader:resultsLoader,chartInterval:chartInterval}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const jobCreator=jc;const[lineChartsData,setLineChartData]=Object(external_kbnSharedDeps_React_["useState"])({});const[loadingData,setLoadingData]=Object(external_kbnSharedDeps_React_["useState"])(false);const[modelData,setModelData]=Object(external_kbnSharedDeps_React_["useState"])([]);const[anomalyData,setAnomalyData]=Object(external_kbnSharedDeps_React_["useState"])([]);function setResultsWrapper(results){const model=results.model[metric_selection_summary_DTR_IDX];if(model!==undefined){setModelData(model)}const anomalies=results.anomalies[metric_selection_summary_DTR_IDX];if(anomalies!==undefined){setAnomalyData(anomalies)}}Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const subscription=resultsLoader.subscribeToResults(setResultsWrapper);loadChart();return()=>{subscription.unsubscribe()}},[]);async function loadChart(){if(jobCreator.aggFieldPair!==null){setLoadingData(true);try{const cs=Object(common_settings["b"])(jobCreator,chartInterval);const resp=await chartLoader.loadLineCharts(jobCreator.start,jobCreator.end,[jobCreator.aggFieldPair],null,null,cs.intervalMs,jobCreator.runtimeMappings);if(resp[metric_selection_summary_DTR_IDX]!==undefined){setLineChartData(resp)}}catch(error){Object(toast_notification_service["a"])().displayErrorToast(error);setLineChartData({})}setLoadingData(false)}}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,(lineChartsData[metric_selection_summary_DTR_IDX]!==undefined||loadingData===true)&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(AnomalyChart,{chartType:CHART_TYPE.LINE,chartData:lineChartsData[metric_selection_summary_DTR_IDX],modelData:modelData,anomalyData:anomalyData,height:"300px",width:"100%",loading:loadingData})))};var general=__webpack_require__(81);const BucketSpanInput=({bucketSpan:bucketSpan,setBucketSpan:setBucketSpan,isInvalid:isInvalid,disabled:disabled})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{disabled:disabled,placeholder:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.pickFieldsStep.bucketSpan.placeholder",{defaultMessage:"Bucket span"}),value:bucketSpan,onChange:e=>setBucketSpan(e.target.value),isInvalid:isInvalid,"data-test-subj":"mlJobWizardInputBucketSpan"});const description_Description=Object(external_kbnSharedDeps_React_["memo"])(({children:children,validation:validation})=>{const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.pickFieldsStep.bucketSpan.title",{defaultMessage:"Bucket span"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{title:external_kbnSharedDeps_React_default.a.createElement("h3",null,title),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.bucketSpan.description",defaultMessage:"Set the interval for time series analysis, typically between 15m to 1h."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:title,error:validation.message,isInvalid:validation.valid===false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children)))});var field_types=__webpack_require__(76);var types_fields=__webpack_require__(105);let ESTIMATE_STATUS;(function(ESTIMATE_STATUS){ESTIMATE_STATUS[ESTIMATE_STATUS["NOT_RUNNING"]=0]="NOT_RUNNING";ESTIMATE_STATUS[ESTIMATE_STATUS["RUNNING"]=1]="RUNNING"})(ESTIMATE_STATUS||(ESTIMATE_STATUS={}));function useEstimateBucketSpan(){var _jobCreator$runtimeMa;const{jobCreator:jobCreator,jobCreatorUpdate:jobCreatorUpdate}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const mlContext=Object(ml["b"])();const[status,setStatus]=Object(external_kbnSharedDeps_React_["useState"])(ESTIMATE_STATUS.NOT_RUNNING);const data={aggTypes:jobCreator.aggregations.map(a=>a.dslName),duration:{start:jobCreator.start,end:jobCreator.end},fields:jobCreator.fields.map(f=>f.id===types_fields["a"]?null:f.id),index:mlContext.currentIndexPattern.title,query:mlContext.combinedQuery,splitField:undefined,timeField:mlContext.currentIndexPattern.timeFieldName,runtimeMappings:(_jobCreator$runtimeMa=jobCreator.runtimeMappings)!==null&&_jobCreator$runtimeMa!==void 0?_jobCreator$runtimeMa:undefined};if((Object(job_creator["c"])(jobCreator)||Object(job_creator["d"])(jobCreator))&&jobCreator.splitField!==null){data.splitField=jobCreator.splitField.id}else if(Object(job_creator["a"])(jobCreator)){jobCreator.richDetectors.some(d=>{if(d.partitionField!==null){data.splitField=d.partitionField.id;return true}if(d.overField!==null){data.splitField=d.overField.id;return true}if(d.byField!==null){data.splitField=d.byField.id;return true}})}async function estimateBucketSpan(){setStatus(ESTIMATE_STATUS.RUNNING);const{name:name,error:error,message:message}=await ml_api_service["ml"].estimateBucketSpan(data);setStatus(ESTIMATE_STATUS.NOT_RUNNING);if(error===true){Object(toast_notification_service["a"])().displayErrorToast(message)}else{jobCreator.bucketSpan=name;jobCreatorUpdate()}}return{status:status,estimateBucketSpan:estimateBucketSpan}}const BucketSpanEstimator=({setEstimating:setEstimating})=>{const{jobCreator:jobCreator,jobCreatorUpdate:jobCreatorUpdate}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const{status:status,estimateBucketSpan:estimateBucketSpan}=useEstimateBucketSpan();const[noDetectors,setNoDetectors]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.detectors.length===0);const[isUsingMlCategory,setIsUsingMlCategory]=Object(external_kbnSharedDeps_React_["useState"])(checkIsUsingMlCategory());Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setEstimating(status===ESTIMATE_STATUS.RUNNING)},[status]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setNoDetectors(jobCreator.detectors.length===0);setIsUsingMlCategory(checkIsUsingMlCategory())},[jobCreatorUpdate]);function checkIsUsingMlCategory(){return Object(job_creator["a"])(jobCreator)&&jobCreator.detectors.some(d=>{if(d.partition_field_name===field_types["b"]||d.over_field_name===field_types["b"]||d.by_field_name===field_types["b"]){return true}})}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{disabled:status===ESTIMATE_STATUS.RUNNING||noDetectors===true||isUsingMlCategory===true,onClick:estimateBucketSpan},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.bucketSpanEstimatorButton",defaultMessage:"Estimate bucket span"}))};const BucketSpan=({setIsValid:setIsValid,hideEstimateButton:hideEstimateButton=false})=>{const{jobCreator:jobCreator,jobCreatorUpdate:jobCreatorUpdate,jobCreatorUpdated:jobCreatorUpdated,jobValidator:jobValidator,jobValidatorUpdated:jobValidatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const[bucketSpan,setBucketSpan]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.bucketSpan);const[validation,setValidation]=Object(external_kbnSharedDeps_React_["useState"])(jobValidator.bucketSpan);const[estimating,setEstimating]=Object(external_kbnSharedDeps_React_["useState"])(false);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{jobCreator.bucketSpan=bucketSpan;jobCreatorUpdate()},[bucketSpan]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setBucketSpan(jobCreator.bucketSpan)},[jobCreatorUpdated]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setValidation(jobValidator.bucketSpan)},[jobValidatorUpdated]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setIsValid(estimating===false)},[estimating]);return external_kbnSharedDeps_React_default.a.createElement(description_Description,{validation:validation},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(BucketSpanInput,{setBucketSpan:setBucketSpan,bucketSpan:bucketSpan,isInvalid:validation.valid===false,disabled:estimating})),hideEstimateButton===false&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(BucketSpanEstimator,{setEstimating:setEstimating}))))};const sparse_data_description_Description=Object(external_kbnSharedDeps_React_["memo"])(({children:children})=>{const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.pickFieldsStep.sparseData.title",{defaultMessage:"Sparse data"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{title:external_kbnSharedDeps_React_default.a.createElement("h3",null,title),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.sparseData.description",defaultMessage:"Select if you wish to ignore empty buckets from being considered anomalous. Available for count and sum analysis."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:title},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children)))});var aggregation_types=__webpack_require__(79);const SparseDataSwitch=()=>{const{jobCreator:jobCreator,jobCreatorUpdated:jobCreatorUpdated,jobCreatorUpdate:jobCreatorUpdate}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const[sparseData,setSparseData]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.sparseData);const[enabled,setEnabled]=Object(external_kbnSharedDeps_React_["useState"])(false);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{jobCreator.sparseData=sparseData;jobCreatorUpdate()},[sparseData]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const aggs=[aggregation_types["a"].COUNT,aggregation_types["a"].SUM];const isCountOrSum=jobCreator.aggregations.some(agg=>agg.dslName!==null&&aggs.includes(agg.dslName));setEnabled(isCountOrSum);if(isCountOrSum===false&&sparseData===true){setSparseData(false)}},[jobCreatorUpdated]);function toggleSparseData(){setSparseData(!sparseData)}return external_kbnSharedDeps_React_default.a.createElement(sparse_data_description_Description,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{name:"switch",disabled:enabled===false,checked:sparseData,onChange:toggleSparseData,"data-test-subj":"mlJobWizardSwitchSparseData",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.pickFieldsStep.sparseData.title",{defaultMessage:"Sparse data"})}))};const SingleMetricSettings=({setIsValid:setIsValid})=>{const{jobCreator:jobCreator}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const navigateToPath=Object(contexts_kibana["e"])();const convertToMultiMetric=()=>{Object(general["e"])(jobCreator,navigateToPath)};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xl"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(BucketSpan,{setIsValid:setIsValid})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(SparseDataSwitch,null))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:convertToMultiMetric},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.singleMetricView.convertToMultiMetricButton",defaultMessage:"Convert to multi-metric job"})))))};const SingleMetricView=({isActive:isActive,setCanProceed:setCanProceed})=>{const[metricsValid,setMetricValid]=Object(external_kbnSharedDeps_React_["useState"])(false);const[settingsValid,setSettingsValid]=Object(external_kbnSharedDeps_React_["useState"])(false);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(typeof setCanProceed==="function"){setCanProceed(metricsValid&&settingsValid)}},[metricsValid,settingsValid]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,isActive===false?external_kbnSharedDeps_React_default.a.createElement(SingleMetricDetectorsSummary,null):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(SingleMetricDetectors,{setIsValid:setMetricValid}),metricsValid&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"l"}),external_kbnSharedDeps_React_default.a.createElement(SingleMetricSettings,{setIsValid:setSettingsValid}))))};const MAX_WIDTH=560;const MetricSelector=({fields:fields,detectorChangeHandler:detectorChangeHandler,selectedOptions:selectedOptions,maxWidth:maxWidth,removeOptions:removeOptions})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{style:{maxWidth:maxWidth!==undefined?maxWidth:MAX_WIDTH}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.pickFieldsStep.multiMetricView.addMetric",{defaultMessage:"Add metric"})},external_kbnSharedDeps_React_default.a.createElement(AggSelect,{fields:fields,changeHandler:detectorChangeHandler,selectedOptions:selectedOptions,removeOptions:removeOptions}))));const SplitCards=Object(external_kbnSharedDeps_React_["memo"])(({fieldValues:fieldValues,splitField:splitField,children:children,numberOfDetectors:numberOfDetectors,jobType:jobType,animate:animate=false})=>{const panels=[];function storePanels(panel,marginBottom){if(panel!==null){if(animate===false){panel.style.marginBottom=`${marginBottom}px`}panels.push({panel:panel,marginBottom:marginBottom})}}function getBackPanels(){panels.length=0;const fieldValuesCopy=[...fieldValues];fieldValuesCopy.shift();let margin=5;const sideMargins=fieldValuesCopy.map((f,i)=>margin+=10-i).reverse();if(animate===true){setTimeout(()=>{panels.forEach(p=>p.panel.style.marginBottom=`${p.marginBottom}px`)},100)}const SPACING=100;const SPLIT_HEIGHT_MULTIPLIER=1.6;return fieldValuesCopy.map((fieldName,i)=>{const diff=(i+1)*(SPLIT_HEIGHT_MULTIPLIER*(10/fieldValuesCopy.length));const marginBottom=-SPACING+diff;const sideMargin=sideMargins[i];const style={height:`${SPACING}px`,marginBottom:`-${SPACING}px`,marginLeft:`${sideMargin}px`,marginRight:`${sideMargin}px`,...animate?{transition:"margin 0.5s"}:{}};return external_kbnSharedDeps_React_default.a.createElement("div",{key:fieldName,ref:ref=>storePanels(ref,marginBottom),style:style},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],{paddingSize:"m",style:{paddingTop:"4px"},"data-test-subj":"mlSplitCard back"},external_kbnSharedDeps_React_default.a.createElement("div",{style:{fontWeight:"bold",fontSize:"small"},"data-test-subj":"mlSplitCardTitle"},fieldName)))})}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{"data-test-subj":"mlDataSplit"},(fieldValues.length===0||numberOfDetectors===0)&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children),fieldValues.length>0&&numberOfDetectors>0&&splitField!==null&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,jobType===new_job["f"].MULTI_METRIC&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement("div",{style:{fontSize:"small"},"data-test-subj":`mlDataSplitTitle ${splitField.name}`},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.splitCards.dataSplitBy",defaultMessage:"Data split by {field}",values:{field:splitField.name}})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"})),getBackPanels(),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],{paddingSize:"m",style:{paddingTop:"4px"},"data-test-subj":"mlSplitCard front"},external_kbnSharedDeps_React_default.a.createElement("div",{style:{fontWeight:"bold",fontSize:"small"},"data-test-subj":"mlSplitCardTitle"},fieldValues[0]),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children)))))});const ANIMATION_SWITCH_DELAY_MS=1e3;function useAnimateSplit(){const[animateSplit,setAnimateSplit]=Object(external_kbnSharedDeps_React_["useState"])(false);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setTimeout(()=>{setAnimateSplit(true)},ANIMATION_SWITCH_DELAY_MS)},[]);return animateSplit}const DetectorTitle=({index:index,agg:agg,field:field,byField:byField,deleteDetector:deleteDetector,children:children})=>{const splitField=children===false&&byField!==undefined?byField.field:null;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"s",justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement("span",{style:{fontSize:"small"},"data-test-subj":"mlDetectorTitle"},getTitle(agg,field,splitField))),children!==false&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{style:{width:"100%",maxWidth:"400px"}},children),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},deleteDetector!==undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{color:"danger",onClick:()=>deleteDetector(index),iconType:"cross",size:"s","aria-label":"Next"})))};function getTitle(agg,field,splitField){const title=`${agg.title}(${field.name})`;if(splitField===null){return title}else{return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.pickFieldsStep.detectorTitle.placeholder",{defaultMessage:"{title} split by {field}",values:{title:title,field:splitField.name}})}}const ChartGrid=({aggFieldPairList:aggFieldPairList,chartSettings:chartSettings,splitField:splitField,fieldValues:fieldValues,lineChartsData:lineChartsData,modelData:modelData,anomalyData:anomalyData,deleteDetector:deleteDetector,jobType:jobType,loading:loading=false})=>{const animateSplit=useAnimateSplit();return external_kbnSharedDeps_React_default.a.createElement(SplitCards,{fieldValues:fieldValues,splitField:splitField,numberOfDetectors:aggFieldPairList.length,jobType:jobType,animate:animateSplit},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGrid"],{columns:chartSettings.cols},aggFieldPairList.map((af,i)=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{key:i,"data-test-subj":`mlDetector ${i}`},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(DetectorTitle,{index:i,agg:aggFieldPairList[i].agg,field:aggFieldPairList[i].field,deleteDetector:deleteDetector}),external_kbnSharedDeps_React_default.a.createElement(AnomalyChart,{chartType:CHART_TYPE.LINE,chartData:lineChartsData[i],modelData:modelData[i],anomalyData:anomalyData[i],height:chartSettings.height,width:chartSettings.width,loading:loading}))))))};const MultiMetricDetectors=({setIsValid:setIsValid})=>{const{jobCreator:jc,jobCreatorUpdate:jobCreatorUpdate,jobCreatorUpdated:jobCreatorUpdated,chartLoader:chartLoader,chartInterval:chartInterval}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const jobCreator=jc;const fields=Object(external_kbnSharedDeps_React_["useMemo"])(()=>Object(fields_utils["b"])([...new_job_capabilities_service["c"].fields,...jobCreator.runtimeFields]),[]);const[selectedOptions,setSelectedOptions]=Object(external_kbnSharedDeps_React_["useState"])([]);const[aggFieldPairList,setAggFieldPairList]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.aggFieldPairs);const[lineChartsData,setLineChartsData]=Object(external_kbnSharedDeps_React_["useState"])({});const[loadingData,setLoadingData]=Object(external_kbnSharedDeps_React_["useState"])(false);const[start,setStart]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.start);const[end,setEnd]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.end);const[bucketSpanMs,setBucketSpanMs]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.bucketSpanMs);const[chartSettings,setChartSettings]=Object(external_kbnSharedDeps_React_["useState"])(common_settings["a"]);const[splitField,setSplitField]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.splitField);const[fieldValues,setFieldValues]=Object(external_kbnSharedDeps_React_["useState"])([]);const[pageReady,setPageReady]=Object(external_kbnSharedDeps_React_["useState"])(false);function detectorChangeHandler(selectedOptionsIn){addDetector(selectedOptionsIn)}function addDetector(selectedOptionsIn){if(selectedOptionsIn!==null&&selectedOptionsIn.length){const option=selectedOptionsIn[0];if(typeof option!=="undefined"){const newPair={agg:option.agg,field:option.field};setAggFieldPairList([...aggFieldPairList,newPair]);setSelectedOptions([])}else{setAggFieldPairList([])}}}function deleteDetector(index){aggFieldPairList.splice(index,1);setAggFieldPairList([...aggFieldPairList])}Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setPageReady(true)},[]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{jobCreator.removeAllDetectors();aggFieldPairList.forEach(pair=>{jobCreator.addDetector(pair.agg,pair.field)});jobCreatorUpdate();loadCharts();setIsValid(aggFieldPairList.length>0)},[aggFieldPairList.length]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(jobCreator.start!==start||jobCreator.end!==end){setStart(jobCreator.start);setEnd(jobCreator.end);loadCharts()}if(jobCreator.bucketSpanMs!==bucketSpanMs){setBucketSpanMs(jobCreator.bucketSpanMs);loadCharts()}setSplitField(jobCreator.splitField)},[jobCreatorUpdated]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(splitField!==null){chartLoader.loadFieldExampleValues(splitField,jobCreator.runtimeMappings).then(setFieldValues).catch(error=>{Object(toast_notification_service["a"])().displayErrorToast(error)})}else{setFieldValues([])}},[splitField]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{loadCharts()},[fieldValues]);async function loadCharts(){if(allDataReady()){setLoadingData(true);try{const cs=Object(common_settings["b"])(jobCreator,chartInterval);setChartSettings(cs);const resp=await chartLoader.loadLineCharts(jobCreator.start,jobCreator.end,aggFieldPairList,jobCreator.splitField,fieldValues.length>0?fieldValues[0]:null,cs.intervalMs,jobCreator.runtimeMappings);setLineChartsData(resp)}catch(error){Object(toast_notification_service["a"])().displayErrorToast(error);setLineChartsData([])}setLoadingData(false)}}function allDataReady(){return pageReady&&aggFieldPairList.length>0&&(splitField===null||splitField!==null&&fieldValues.length>0)}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(ChartGrid,{aggFieldPairList:aggFieldPairList,chartSettings:chartSettings,splitField:splitField,fieldValues:fieldValues,lineChartsData:lineChartsData,modelData:[],anomalyData:[],deleteDetector:deleteDetector,jobType:jobCreator.type,loading:loadingData}),external_kbnSharedDeps_React_default.a.createElement(MetricSelector,{fields:fields,detectorChangeHandler:detectorChangeHandler,selectedOptions:selectedOptions,removeOptions:aggFieldPairList}))};const MultiMetricDetectorsSummary=()=>{const{jobCreator:jc,chartLoader:chartLoader,resultsLoader:resultsLoader,chartInterval:chartInterval}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const jobCreator=jc;const[lineChartsData,setLineChartsData]=Object(external_kbnSharedDeps_React_["useState"])({});const[loadingData,setLoadingData]=Object(external_kbnSharedDeps_React_["useState"])(false);const[modelData,setModelData]=Object(external_kbnSharedDeps_React_["useState"])([]);const[anomalyData,setAnomalyData]=Object(external_kbnSharedDeps_React_["useState"])([]);const[chartSettings,setChartSettings]=Object(external_kbnSharedDeps_React_["useState"])(common_settings["a"]);const[fieldValues,setFieldValues]=Object(external_kbnSharedDeps_React_["useState"])([]);function setResultsWrapper(results){setModelData(results.model);setAnomalyData(results.anomalies)}Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const subscription=resultsLoader.subscribeToResults(setResultsWrapper);(async()=>{if(jobCreator.splitField!==null){try{const tempFieldValues=await chartLoader.loadFieldExampleValues(jobCreator.splitField,jobCreator.runtimeMappings);setFieldValues(tempFieldValues)}catch(error){Object(toast_notification_service["a"])().displayErrorToast(error)}}})();return()=>{subscription.unsubscribe()}},[]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(allDataReady()){loadCharts()}},[fieldValues]);async function loadCharts(){if(allDataReady()){setLoadingData(true);try{const cs=Object(common_settings["b"])(jobCreator,chartInterval);setChartSettings(cs);const resp=await chartLoader.loadLineCharts(jobCreator.start,jobCreator.end,jobCreator.aggFieldPairs,jobCreator.splitField,fieldValues.length>0?fieldValues[0]:null,cs.intervalMs,jobCreator.runtimeMappings);setLineChartsData(resp)}catch(error){Object(toast_notification_service["a"])().displayErrorToast(error);setLineChartsData({})}setLoadingData(false)}}function allDataReady(){return jobCreator.aggFieldPairs.length>0&&(jobCreator.splitField===null||jobCreator.splitField!==null&&fieldValues.length>0)}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,Object.keys(lineChartsData).length&&external_kbnSharedDeps_React_default.a.createElement(ChartGrid,{aggFieldPairList:jobCreator.aggFieldPairs,chartSettings:chartSettings,splitField:jobCreator.splitField,fieldValues:fieldValues,lineChartsData:lineChartsData,modelData:modelData,anomalyData:anomalyData,deleteDetector:undefined,jobType:jobCreator.type,loading:loadingData}))};const SplitFieldSelect=({fields:fields,changeHandler:changeHandler,selectedField:selectedField,isClearable:isClearable,testSubject:testSubject,placeholder:placeholder})=>{const options=fields.map(f=>({label:f.name,field:f}));const selection=[];if(selectedField!==null){selection.push({label:selectedField.name,field:selectedField})}function onChange(selectedOptions){const option=selectedOptions[0];if(typeof option!=="undefined"){changeHandler(option.field)}else{changeHandler(null)}}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{singleSelection:{asPlainText:true},options:options,selectedOptions:selection,onChange:onChange,isClearable:isClearable,placeholder:placeholder,"data-test-subj":testSubject})};const ByFieldSelector=({detectorIndex:detectorIndex})=>{const{jobCreator:jc,jobCreatorUpdate:jobCreatorUpdate,jobCreatorUpdated:jobCreatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const jobCreator=jc;const runtimeCategoryFields=Object(external_kbnSharedDeps_React_["useMemo"])(()=>Object(new_job_capabilities_service["a"])(jobCreator.runtimeFields),[]);const allCategoryFields=Object(external_kbnSharedDeps_React_["useMemo"])(()=>[...new_job_capabilities_service["c"].categoryFields,...runtimeCategoryFields],[]);const[byField,setByField]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.getByField(detectorIndex));const categoryFields=useFilteredCategoryFields(allCategoryFields,jobCreator,jobCreatorUpdated);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{jobCreator.setByField(byField,detectorIndex);if(byField!==null&&jobCreator.influencers.includes(byField.name)===false){jobCreator.addInfluencer(byField.name)}jobCreatorUpdate()},[byField]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const bf=jobCreator.getByField(detectorIndex);setByField(bf)},[jobCreatorUpdated]);return external_kbnSharedDeps_React_default.a.createElement(SplitFieldSelect,{fields:categoryFields,changeHandler:setByField,selectedField:byField,isClearable:true,testSubject:"mlByFieldSelect",placeholder:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.pickFieldsStep.populationField.placeholder",{defaultMessage:"Split data"})})};function useFilteredCategoryFields(allCategoryFields,jobCreator,jobCreatorUpdated){const[fields,setFields]=Object(external_kbnSharedDeps_React_["useState"])(allCategoryFields);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const sf=jobCreator.splitField;if(sf!==null){setFields(allCategoryFields.filter(f=>f.name!==sf.name))}else{setFields(allCategoryFields)}},[jobCreatorUpdated]);return fields}const split_field_description_Description=Object(external_kbnSharedDeps_React_["memo"])(({children:children,jobType:jobType})=>{if(jobType===new_job["f"].MULTI_METRIC){const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.pickFieldsStep.splitField.title",{defaultMessage:"Split field"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{title:external_kbnSharedDeps_React_default.a.createElement("h3",null,title),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.splitField.description",defaultMessage:"Select a field to partition analysis by. Each value of this field will be modeled independently individually."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:title},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children)))}else if(jobType===new_job["f"].POPULATION){const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.pickFieldsStep.populationField.title",{defaultMessage:"Population field"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{title:external_kbnSharedDeps_React_default.a.createElement("h3",null,title),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.populationField.description",defaultMessage:"All values in the selected field will be modeled together as a population. This analysis type is recommended for high cardinality data."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:title},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children)))}else{return null}});const SplitFieldSelector=()=>{const{jobCreator:jc,jobCreatorUpdate:jobCreatorUpdate,jobCreatorUpdated:jobCreatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const jobCreator=jc;const canClearSelection=Object(job_creator["c"])(jc);const runtimeCategoryFields=Object(external_kbnSharedDeps_React_["useMemo"])(()=>Object(new_job_capabilities_service["a"])(jobCreator.runtimeFields),[]);const categoryFields=Object(external_kbnSharedDeps_React_["useMemo"])(()=>[...new_job_capabilities_service["c"].categoryFields,...runtimeCategoryFields],[]);const[splitField,setSplitField]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.splitField);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{jobCreator.setSplitField(splitField);if(splitField!==null&&jobCreator.influencers.includes(splitField.name)===false){jobCreator.addInfluencer(splitField.name)}jobCreatorUpdate()},[splitField]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setSplitField(jobCreator.splitField)},[jobCreatorUpdated]);return external_kbnSharedDeps_React_default.a.createElement(split_field_description_Description,{jobType:jobCreator.type},external_kbnSharedDeps_React_default.a.createElement(SplitFieldSelect,{fields:categoryFields,changeHandler:setSplitField,selectedField:splitField,isClearable:canClearSelection,testSubject:Object(job_creator["c"])(jc)?"mlMultiMetricSplitFieldSelect":Object(job_creator["d"])(jc)?"mlPopulationSplitFieldSelect":undefined}))};const InfluencersSelect=({fields:fields,changeHandler:changeHandler,selectedInfluencers:selectedInfluencers})=>{const{jobCreator:jobCreator}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const options=[...Object(general["g"])(fields,jobCreator.additionalFields),...Object(general["h"])(jobCreator.categorizationFieldName)];const selection=selectedInfluencers.map(i=>({label:i}));function onChange(selectedOptions){changeHandler(selectedOptions.map(o=>o.label))}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{options:options,selectedOptions:selection,onChange:onChange,isClearable:false,"data-test-subj":"mlInfluencerSelect"})};const influencers_description_Description=Object(external_kbnSharedDeps_React_["memo"])(({children:children})=>{const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.pickFieldsStep.influencers.title",{defaultMessage:"Influencers"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{title:external_kbnSharedDeps_React_default.a.createElement("h3",null,title),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.influencers.description",defaultMessage:"Select which categorical fields have influence on the results. Who/what might you 'blame' for an anomaly? Recommend 1-3 influencers."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:title},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children)))});const Influencers=()=>{const{jobCreator:jc,jobCreatorUpdate:jobCreatorUpdate,jobCreatorUpdated:jobCreatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const jobCreator=jc;const{fields:fields}=new_job_capabilities_service["c"];const[influencers,setInfluencers]=Object(external_kbnSharedDeps_React_["useState"])([...jobCreator.influencers]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{jobCreator.removeAllInfluencers();influencers.forEach(i=>jobCreator.addInfluencer(i));jobCreatorUpdate()},[influencers.join()]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setInfluencers([...jobCreator.influencers])},[jobCreatorUpdated]);return external_kbnSharedDeps_React_default.a.createElement(influencers_description_Description,null,external_kbnSharedDeps_React_default.a.createElement(InfluencersSelect,{fields:fields,changeHandler:setInfluencers,selectedInfluencers:influencers}))};const MultiMetricSettings=({setIsValid:setIsValid})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xl"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(SplitFieldSelector,null)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(Influencers,null))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xl"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(BucketSpan,{setIsValid:setIsValid})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(SparseDataSwitch,null))));const MultiMetricView=({isActive:isActive,setCanProceed:setCanProceed})=>{const[metricsValid,setMetricValid]=Object(external_kbnSharedDeps_React_["useState"])(false);const[settingsValid,setSettingsValid]=Object(external_kbnSharedDeps_React_["useState"])(false);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(typeof setCanProceed==="function"){setCanProceed(metricsValid&&settingsValid)}},[metricsValid,settingsValid]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,isActive===false?external_kbnSharedDeps_React_default.a.createElement(MultiMetricDetectorsSummary,null):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(MultiMetricDetectors,{setIsValid:setMetricValid}),metricsValid&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"l"}),external_kbnSharedDeps_React_default.a.createElement(MultiMetricSettings,{setIsValid:setSettingsValid}))))};const metric_selector_MAX_WIDTH=560;const metric_selector_MetricSelector=({fields:fields,detectorChangeHandler:detectorChangeHandler,selectedOptions:selectedOptions,maxWidth:maxWidth,removeOptions:removeOptions})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{style:{maxWidth:maxWidth!==undefined?maxWidth:metric_selector_MAX_WIDTH}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.pickFieldsStep.populationView.addMetric",{defaultMessage:"Add metric"})},external_kbnSharedDeps_React_default.a.createElement(AggSelect,{fields:fields,changeHandler:detectorChangeHandler,selectedOptions:selectedOptions,removeOptions:removeOptions}))));const chart_grid_ChartGrid=({aggFieldPairList:aggFieldPairList,chartSettings:chartSettings,splitField:splitField,lineChartsData:lineChartsData,modelData:modelData,anomalyData:anomalyData,deleteDetector:deleteDetector,jobType:jobType,fieldValuesPerDetector:fieldValuesPerDetector,loading:loading=false})=>{const animateSplit=useAnimateSplit();return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGrid"],{columns:chartSettings.cols},aggFieldPairList.map((af,i)=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{key:i,"data-test-subj":`mlDetector ${i}`},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(DetectorTitle,{index:i,agg:aggFieldPairList[i].agg,field:aggFieldPairList[i].field,byField:aggFieldPairList[i].by,deleteDetector:deleteDetector},deleteDetector!==undefined&&external_kbnSharedDeps_React_default.a.createElement(ByFieldSelector,{detectorIndex:i})),jobType===new_job["f"].POPULATION&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}))),external_kbnSharedDeps_React_default.a.createElement(SplitCards,{fieldValues:fieldValuesPerDetector[i]||[],splitField:splitField,numberOfDetectors:aggFieldPairList.length,jobType:jobType,animate:animateSplit},external_kbnSharedDeps_React_default.a.createElement(AnomalyChart,{chartType:CHART_TYPE.SCATTER,chartData:lineChartsData[i],modelData:modelData[i],anomalyData:anomalyData[i],height:chartSettings.height,width:chartSettings.width,loading:loading}))))))};const PopulationDetectors=({setIsValid:setIsValid})=>{const{jobCreator:jc,jobCreatorUpdate:jobCreatorUpdate,jobCreatorUpdated:jobCreatorUpdated,chartLoader:chartLoader,chartInterval:chartInterval}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const jobCreator=jc;const fields=Object(external_kbnSharedDeps_React_["useMemo"])(()=>Object(fields_utils["b"])([...new_job_capabilities_service["c"].fields,...jobCreator.runtimeFields]),[]);const[selectedOptions,setSelectedOptions]=Object(external_kbnSharedDeps_React_["useState"])([]);const[aggFieldPairList,setAggFieldPairList]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.aggFieldPairs);const[lineChartsData,setLineChartsData]=Object(external_kbnSharedDeps_React_["useState"])({});const[loadingData,setLoadingData]=Object(external_kbnSharedDeps_React_["useState"])(false);const[start,setStart]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.start);const[end,setEnd]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.end);const[bucketSpanMs,setBucketSpanMs]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.bucketSpanMs);const[chartSettings,setChartSettings]=Object(external_kbnSharedDeps_React_["useState"])(common_settings["a"]);const[splitField,setSplitField]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.splitField);const[fieldValuesPerDetector,setFieldValuesPerDetector]=Object(external_kbnSharedDeps_React_["useState"])({});const[byFieldsUpdated,setByFieldsUpdated]=Object(external_kbnSharedDeps_React_["useReducer"])(s=>s+1,0);const[pageReady,setPageReady]=Object(external_kbnSharedDeps_React_["useState"])(false);const updateByFields=()=>setByFieldsUpdated(0);function detectorChangeHandler(selectedOptionsIn){addDetector(selectedOptionsIn)}function addDetector(selectedOptionsIn){if(selectedOptionsIn!==null&&selectedOptionsIn.length){const option=selectedOptionsIn[0];if(typeof option!=="undefined"){const newPair={agg:option.agg,field:option.field,by:{field:null,value:null}};setAggFieldPairList([...aggFieldPairList,newPair]);setSelectedOptions([])}else{setAggFieldPairList([])}}}function deleteDetector(index){aggFieldPairList.splice(index,1);setAggFieldPairList([...aggFieldPairList]);updateByFields()}Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setPageReady(true)},[]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{jobCreator.removeAllDetectors();aggFieldPairList.forEach((pair,i)=>{jobCreator.addDetector(pair.agg,pair.field);if(pair.by!==undefined){jobCreator.setByField(pair.by.field,i)}});jobCreatorUpdate();loadCharts();setIsValid(aggFieldPairList.length>0)},[aggFieldPairList.length]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{loadCharts()},[JSON.stringify(fieldValuesPerDetector),splitField,pageReady]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(jobCreator.start!==start||jobCreator.end!==end){setStart(jobCreator.start);setEnd(jobCreator.end);loadCharts()}if(jobCreator.bucketSpanMs!==bucketSpanMs){setBucketSpanMs(jobCreator.bucketSpanMs);loadCharts()}setSplitField(jobCreator.splitField);let update=false;const newList=[...aggFieldPairList];newList.forEach((pair,i)=>{const bf=jobCreator.getByField(i);if(pair.by!==undefined&&pair.by.field!==bf){pair.by.field=bf;update=true}});if(update){setAggFieldPairList(newList);updateByFields()}},[jobCreatorUpdated]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{loadFieldExamples()},[splitField,byFieldsUpdated]);async function loadCharts(){if(allDataReady()){setLoadingData(true);try{const cs=Object(common_settings["b"])(jobCreator,chartInterval);setChartSettings(cs);const resp=await chartLoader.loadPopulationCharts(jobCreator.start,jobCreator.end,aggFieldPairList,jobCreator.splitField,cs.intervalMs,jobCreator.runtimeMappings);setLineChartsData(resp)}catch(error){Object(toast_notification_service["a"])().displayErrorToast(error);setLineChartsData([])}setLoadingData(false)}}async function loadFieldExamples(){const promises=[];aggFieldPairList.forEach((af,i)=>{if(af.by!==undefined&&af.by.field!==null){promises.push((async(index,field)=>({index:index,fields:await chartLoader.loadFieldExampleValues(field,jobCreator.runtimeMappings)}))(i,af.by.field))}});const results=await Promise.all(promises);const fieldValues=results.reduce((p,c)=>{p[c.index]=c.fields;return p},{});const newPairs=aggFieldPairList.map((pair,i)=>({...pair,...pair.by===undefined||pair.by.field===null?{}:{by:{...pair.by,value:fieldValues[i][0]}}}));setAggFieldPairList([...newPairs]);setFieldValuesPerDetector(fieldValues)}function allDataReady(){let ready=aggFieldPairList.length>0;aggFieldPairList.forEach(af=>{if(af.by!==undefined&&af.by.field!==null){ready=ready&&af.by.value!==null}});return ready}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(SplitFieldSelector,null),splitField!==null&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"l"}),splitField!==null&&external_kbnSharedDeps_React_default.a.createElement(chart_grid_ChartGrid,{aggFieldPairList:aggFieldPairList,chartSettings:chartSettings,splitField:splitField,lineChartsData:lineChartsData,modelData:[],anomalyData:[],deleteDetector:deleteDetector,jobType:jobCreator.type,fieldValuesPerDetector:fieldValuesPerDetector,loading:loadingData}),splitField!==null&&external_kbnSharedDeps_React_default.a.createElement(metric_selector_MetricSelector,{fields:fields,detectorChangeHandler:detectorChangeHandler,selectedOptions:selectedOptions,removeOptions:[]}))};const PopulationDetectorsSummary=()=>{const{jobCreator:jc,chartLoader:chartLoader,resultsLoader:resultsLoader,chartInterval:chartInterval}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const jobCreator=jc;const[aggFieldPairList,setAggFieldPairList]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.aggFieldPairs);const[lineChartsData,setLineChartsData]=Object(external_kbnSharedDeps_React_["useState"])({});const[loadingData,setLoadingData]=Object(external_kbnSharedDeps_React_["useState"])(false);const[modelData,setModelData]=Object(external_kbnSharedDeps_React_["useState"])([]);const[anomalyData,setAnomalyData]=Object(external_kbnSharedDeps_React_["useState"])([]);const[chartSettings,setChartSettings]=Object(external_kbnSharedDeps_React_["useState"])(common_settings["a"]);const[fieldValuesPerDetector,setFieldValuesPerDetector]=Object(external_kbnSharedDeps_React_["useState"])({});function setResultsWrapper(results){setModelData(results.model);setAnomalyData(results.anomalies)}Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const subscription=resultsLoader.subscribeToResults(setResultsWrapper);return()=>{subscription.unsubscribe()}},[]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(allDataReady()){loadCharts()}},[JSON.stringify(fieldValuesPerDetector),jobCreator.splitField]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{loadFieldExamples()},[jobCreator.splitField]);async function loadCharts(){if(allDataReady()){setLoadingData(true);try{const cs=Object(common_settings["b"])(jobCreator,chartInterval);setChartSettings(cs);const resp=await chartLoader.loadPopulationCharts(jobCreator.start,jobCreator.end,aggFieldPairList,jobCreator.splitField,cs.intervalMs,jobCreator.runtimeMappings);setLineChartsData(resp)}catch(error){Object(toast_notification_service["a"])().displayErrorToast(error);setLineChartsData({})}setLoadingData(false)}}async function loadFieldExamples(){const promises=[];aggFieldPairList.forEach((af,i)=>{if(af.by!==undefined&&af.by.field!==null){promises.push((async(index,field)=>({index:index,fields:await chartLoader.loadFieldExampleValues(field,jobCreator.runtimeMappings)}))(i,af.by.field))}});const results=await Promise.all(promises);const fieldValues=results.reduce((p,c)=>{p[c.index]=c.fields;return p},{});const newPairs=aggFieldPairList.map((pair,i)=>({...pair,...pair.by===undefined||pair.by.field===null?{}:{by:{...pair.by,value:fieldValues[i][0]}}}));setAggFieldPairList([...newPairs]);setFieldValuesPerDetector(fieldValues)}function allDataReady(){let ready=aggFieldPairList.length>0;aggFieldPairList.forEach(af=>{if(af.by!==undefined&&af.by.field!==null){ready=ready&&af.by.value!==null}});return ready}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,jobCreator.splitField!==null&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.populationView.splitFieldTitle",defaultMessage:"Population split by {field}",values:{field:jobCreator.splitField.name}}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement(chart_grid_ChartGrid,{aggFieldPairList:jobCreator.aggFieldPairs,chartSettings:chartSettings,splitField:jobCreator.splitField,lineChartsData:lineChartsData,modelData:modelData,anomalyData:anomalyData,jobType:jobCreator.type,fieldValuesPerDetector:fieldValuesPerDetector,loading:loadingData})))};const PopulationSettings=({setIsValid:setIsValid})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xl"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(BucketSpan,{setIsValid:setIsValid})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(Influencers,null))));const PopulationView=({isActive:isActive,setCanProceed:setCanProceed})=>{const[metricsValid,setMetricValid]=Object(external_kbnSharedDeps_React_["useState"])(false);const[settingsValid,setSettingsValid]=Object(external_kbnSharedDeps_React_["useState"])(false);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(typeof setCanProceed==="function"){setCanProceed(metricsValid&&settingsValid)}},[metricsValid,settingsValid]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,isActive===false?external_kbnSharedDeps_React_default.a.createElement(PopulationDetectorsSummary,null):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(PopulationDetectors,{setIsValid:setMetricValid}),metricsValid&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"l"}),external_kbnSharedDeps_React_default.a.createElement(PopulationSettings,{setIsValid:setSettingsValid}))))};const MAX_MODAL_WIDTH=1200;const ModalWrapper=({onCreateClick:onCreateClick,closeModal:closeModal,saveEnabled:saveEnabled,children:children})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModal"],{onClose:closeModal,maxWidth:MAX_MODAL_WIDTH,"data-test-subj":"mlCreateDetectorModal"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalHeaderTitle"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.title",defaultMessage:"Create detector"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalBody"],null,children),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalFooter"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:closeModal,"data-test-subj":"mlCreateDetectorModalCancelButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.cancelButton",defaultMessage:"Cancel"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:onCreateClick,isDisabled:saveEnabled===false,fill:true,"data-test-subj":"mlCreateDetectorModalSaveButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.saveButton",defaultMessage:"Save"}))));var string_utils=__webpack_require__(84);var default_configs=__webpack_require__(133);const AggDescription=Object(external_kbnSharedDeps_React_["memo"])(({children:children})=>{const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.aggSelect.title",{defaultMessage:"Function"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{title:external_kbnSharedDeps_React_default.a.createElement("h3",null,title),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.aggSelect.description",defaultMessage:"Analysis functions to be performed e.g. sum, count."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:title},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children)))});const FieldDescription=Object(external_kbnSharedDeps_React_["memo"])(({children:children})=>{const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.fieldSelect.title",{defaultMessage:"Field"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{title:external_kbnSharedDeps_React_default.a.createElement("h3",null,title),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.fieldSelect.description",defaultMessage:"Required for functions: sum, mean, median, max, min, info_content, distinct_count, lat_long."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:title},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children)))});const ByFieldDescription=Object(external_kbnSharedDeps_React_["memo"])(({children:children})=>{const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.byFieldSelect.title",{defaultMessage:"By field"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{title:external_kbnSharedDeps_React_default.a.createElement("h3",null,title),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.byFieldSelect.description",defaultMessage:"Required for individual analysis where anomalies are detected compared to an entity's own past behavior."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:title},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children)))});const OverFieldDescription=Object(external_kbnSharedDeps_React_["memo"])(({children:children})=>{const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.overFieldSelect.title",{defaultMessage:"Over field"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{title:external_kbnSharedDeps_React_default.a.createElement("h3",null,title),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.overFieldSelect.description",defaultMessage:"Required for population analysis where anomalies are detected compared to the behavior of the population."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:title},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children)))});const PartitionFieldDescription=Object(external_kbnSharedDeps_React_["memo"])(({children:children})=>{const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.partitionFieldSelect.title",{defaultMessage:"Partition field"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{title:external_kbnSharedDeps_React_default.a.createElement("h3",null,title),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.partitionFieldSelect.description",defaultMessage:"Allows segmentation of modeling into logical groups."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:title},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children)))});const ExcludeFrequentDescription=Object(external_kbnSharedDeps_React_["memo"])(({children:children})=>{const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.excludeFrequent.title",{defaultMessage:"Exclude frequent"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{title:external_kbnSharedDeps_React_default.a.createElement("h3",null,title),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.excludeFrequent.description",defaultMessage:"If set, it will automatically identify and exclude frequently occurring entities which may otherwise have dominated results."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:title},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children)))});const DescriptionDescription=Object(external_kbnSharedDeps_React_["memo"])(({children:children})=>{const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.description.title",{defaultMessage:"Description"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{fullWidth:true,title:external_kbnSharedDeps_React_default.a.createElement("h3",null,title),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorModal.description.description",defaultMessage:"Override the default detector description with a meaningful description of what the detector is analyzing."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:title,fullWidth:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children)))});const emptyOption={label:""};const excludeFrequentOptions=[{label:"all"},{label:"none"},{label:"by"},{label:"over"}];const AdvancedDetectorModal=({payload:payload,fields:fields,aggs:aggs,detectorChangeHandler:detectorChangeHandler,closeModal:closeModal})=>{const{jobCreator:jc}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const jobCreator=jc;const[detector,setDetector]=Object(external_kbnSharedDeps_React_["useState"])(payload.detector);const[aggOption,setAggOption]=Object(external_kbnSharedDeps_React_["useState"])(createAggOption(detector.agg));const[fieldOption,setFieldOption]=Object(external_kbnSharedDeps_React_["useState"])(createFieldOption(detector.field));const[byFieldOption,setByFieldOption]=Object(external_kbnSharedDeps_React_["useState"])(createFieldOption(detector.byField));const[overFieldOption,setOverFieldOption]=Object(external_kbnSharedDeps_React_["useState"])(createFieldOption(detector.overField));const[partitionFieldOption,setPartitionFieldOption]=Object(external_kbnSharedDeps_React_["useState"])(createFieldOption(detector.partitionField));const[excludeFrequentOption,setExcludeFrequentOption]=Object(external_kbnSharedDeps_React_["useState"])(createExcludeFrequentOption(detector.excludeFrequent));const[descriptionOption,setDescriptionOption]=Object(external_kbnSharedDeps_React_["useState"])(detector.description||"");const[splitFieldsEnabled,setSplitFieldsEnabled]=Object(external_kbnSharedDeps_React_["useState"])(true);const[excludeFrequentEnabled,setExcludeFrequentEnabled]=Object(external_kbnSharedDeps_React_["useState"])(true);const[fieldOptionEnabled,setFieldOptionEnabled]=Object(external_kbnSharedDeps_React_["useState"])(true);const{descriptionPlaceholder:descriptionPlaceholder,setDescriptionPlaceholder:setDescriptionPlaceholder}=useDetectorPlaceholder(detector);const usingScriptFields=jobCreator.additionalFields.length>0;const aggOptions=aggs.filter(agg=>filterAggs(agg,usingScriptFields)).map(createAggOption);const{currentFieldOptions:currentFieldOptions,setCurrentFieldOptions:setCurrentFieldOptions}=useCurrentFieldOptions(detector.agg,jobCreator.additionalFields,fields);const allFieldOptions=[...Object(general["g"])(fields,jobCreator.additionalFields)].sort(comboBoxOptionsSort);const splitFieldOptions=[...allFieldOptions,...Object(general["h"])(jobCreator.categorizationFieldName)].sort(comboBoxOptionsSort);const eventRateField=fields.find(f=>f.id===types_fields["a"]);const onOptionChange=func=>selectedOptions=>{func(selectedOptions[0]||emptyOption)};function getAgg(title){return aggs.find(a=>a.id===title)||null}function getField(title){if(title===types_fields["c"].id){return types_fields["c"]}return fields.find(f=>f.id===title)||jobCreator.additionalFields.find(f=>f.id===title)||null}Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const agg=getAgg(aggOption.label);let field=getField(fieldOption.label);const byField=getField(byFieldOption.label);const overField=getField(overFieldOption.label);const partitionField=getField(partitionFieldOption.label);if(agg!==null){setCurrentFieldOptions(agg);if(isFieldlessAgg(agg)&&eventRateField!==undefined){setSplitFieldsEnabled(true);setFieldOption(emptyOption);setFieldOptionEnabled(false);field=eventRateField}else{setSplitFieldsEnabled(field!==null);setFieldOptionEnabled(true)}setExcludeFrequentEnabled(byField!==null||overField!==null)}else{setSplitFieldsEnabled(false);setFieldOptionEnabled(false)}const dtr={agg:agg,field:field,byField:byField,overField:overField,partitionField:partitionField,excludeFrequent:excludeFrequentOption.label!==""?excludeFrequentOption.label:null,description:descriptionOption!==""?descriptionOption:null,customRules:null};setDetector(dtr);setDescriptionPlaceholder(dtr)},[aggOption,fieldOption,byFieldOption,overFieldOption,partitionFieldOption,excludeFrequentOption,descriptionOption]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const agg=getAgg(aggOption.label);setSplitFieldsEnabled(aggOption.label!=="");if(agg!==null){setFieldOptionEnabled(isFieldlessAgg(agg)===false);const byField=getField(byFieldOption.label);const overField=getField(overFieldOption.label);setExcludeFrequentEnabled(byField!==null||overField!==null)}},[]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(excludeFrequentEnabled===false){setExcludeFrequentOption(emptyOption)}},[excludeFrequentEnabled]);function onCreateClick(){detectorChangeHandler(detector,payload.index)}function saveEnabled(){return splitFieldsEnabled&&(fieldOptionEnabled===false||fieldOptionEnabled===true&&fieldOption.label!=="")}return external_kbnSharedDeps_React_default.a.createElement(ModalWrapper,{onCreateClick:onCreateClick,closeModal:closeModal,saveEnabled:saveEnabled()},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{"data-test-subj":"mlAdvancedFunctionSelect"},external_kbnSharedDeps_React_default.a.createElement(AggDescription,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{singleSelection:{asPlainText:true},options:aggOptions,selectedOptions:createSelectedOptions(aggOption,aggOptions),onChange:onOptionChange(setAggOption),isClearable:true}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{"data-test-subj":"mlAdvancedFieldSelect"},external_kbnSharedDeps_React_default.a.createElement(FieldDescription,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{singleSelection:{asPlainText:true},options:currentFieldOptions,selectedOptions:createSelectedOptions(fieldOption,currentFieldOptions),onChange:onOptionChange(setFieldOption),isClearable:true,isDisabled:fieldOptionEnabled===false})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"l"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGrid"],{columns:2},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{"data-test-subj":"mlAdvancedByFieldSelect"},external_kbnSharedDeps_React_default.a.createElement(ByFieldDescription,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{singleSelection:{asPlainText:true},options:splitFieldOptions,selectedOptions:createSelectedOptions(byFieldOption,splitFieldOptions),onChange:onOptionChange(setByFieldOption),isClearable:true,isDisabled:splitFieldsEnabled===false}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{"data-test-subj":"mlAdvancedOverFieldSelect"},external_kbnSharedDeps_React_default.a.createElement(OverFieldDescription,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{singleSelection:{asPlainText:true},options:splitFieldOptions,selectedOptions:createSelectedOptions(overFieldOption,splitFieldOptions),onChange:onOptionChange(setOverFieldOption),isClearable:true,isDisabled:splitFieldsEnabled===false}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{"data-test-subj":"mlAdvancedPartitionFieldSelect"},external_kbnSharedDeps_React_default.a.createElement(PartitionFieldDescription,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{singleSelection:{asPlainText:true},options:splitFieldOptions,selectedOptions:createSelectedOptions(partitionFieldOption,splitFieldOptions),onChange:onOptionChange(setPartitionFieldOption),isClearable:true,isDisabled:splitFieldsEnabled===false}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{"data-test-subj":"mlAdvancedExcludeFrequentSelect"},external_kbnSharedDeps_React_default.a.createElement(ExcludeFrequentDescription,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{singleSelection:{asPlainText:true},options:excludeFrequentOptions,selectedOptions:createSelectedOptions(excludeFrequentOption,excludeFrequentOptions),onChange:onOptionChange(setExcludeFrequentOption),isClearable:true,isDisabled:splitFieldsEnabled===false||excludeFrequentEnabled===false})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"l"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(DescriptionDescription,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTextArea"],{rows:2,fullWidth:true,placeholder:descriptionPlaceholder,value:descriptionOption,onChange:e=>setDescriptionOption(e.target.value),"data-test-subj":"mlAdvancedDetectorDescriptionInput"}))))))};function createAggOption(agg){if(agg===null){return emptyOption}return{label:agg.id}}function filterAggs(agg,usingScriptFields){return agg.fields!==undefined&&(usingScriptFields||agg.fields.length)}function createFieldOption(field){if(field===null){return emptyOption}return{label:field.name}}function createExcludeFrequentOption(excludeFrequent){if(excludeFrequent===null){return emptyOption}return{label:excludeFrequent}}function isFieldlessAgg(agg){return agg.fields&&agg.fields.length===1&&agg.fields[0].id===types_fields["a"]}function useDetectorPlaceholder(detector){const[descriptionPlaceholder,setDescriptionPlaceholderString]=Object(external_kbnSharedDeps_React_["useState"])(createDefaultDescription(detector));function setDescriptionPlaceholder(dtr){setDescriptionPlaceholderString(createDefaultDescription(dtr))}return{descriptionPlaceholder:descriptionPlaceholder,setDescriptionPlaceholder:setDescriptionPlaceholder}}function createFieldOptionsFromAgg(agg,additionalFields){return Object(general["g"])(agg!==null&&agg.fields!==undefined?agg.fields:[],additionalFields)}function useCurrentFieldOptions(aggregation,additionalFields,fields){const[currentFieldOptions,setCurrentFieldOptions]=Object(external_kbnSharedDeps_React_["useState"])(createFieldOptionsFromAgg(aggregation,additionalFields));return{currentFieldOptions:currentFieldOptions,setCurrentFieldOptions:agg=>setCurrentFieldOptions(createFieldOptionsFromAgg(agg,additionalFields))}}function createDefaultDescription(dtr){if(dtr.agg===null||dtr.field===null){return""}const basicDetector=Object(default_configs["a"])(dtr.agg,dtr.field);basicDetector.by_field_name=dtr.byField?dtr.byField.id:undefined;basicDetector.over_field_name=dtr.overField?dtr.overField.id:undefined;basicDetector.partition_field_name=dtr.partitionField?dtr.partitionField.id:undefined;basicDetector.exclude_frequent=dtr.excludeFrequent?dtr.excludeFrequent:undefined;return Object(string_utils["b"])(basicDetector)}function createSelectedOptions(selectedOption,options){return options.length===1&&options[0].label!==selectedOption.label||selectedOption.label===""?[]:[selectedOption]}function comboBoxOptionsSort(a,b){return a.label.localeCompare(b.label)}const advanced_view_metric_selector_MAX_WIDTH=560;const advanced_view_metric_selector_MetricSelector=({payload:payload,fields:fields,aggs:aggs,detectorChangeHandler:detectorChangeHandler,closeModal:closeModal,showModal:showModal})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{style:{maxWidth:advanced_view_metric_selector_MAX_WIDTH}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:showModal,"data-test-subj":"mlAddDetectorButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.addDetectorButton",defaultMessage:"Add detector"}))))),payload!==null&&external_kbnSharedDeps_React_default.a.createElement(AdvancedDetectorModal,{payload:payload,fields:fields,aggs:aggs,detectorChangeHandler:detectorChangeHandler,closeModal:closeModal}));const DetectorList=({isActive:isActive,onEditJob:onEditJob,onDeleteJob:onDeleteJob})=>{const{jobCreator:jc,jobCreatorUpdated:jobCreatorUpdated,jobValidator:jobValidator,jobValidatorUpdated:jobValidatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const jobCreator=jc;const[detectors,setDetectors]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.detectors);const[validation,setValidation]=Object(external_kbnSharedDeps_React_["useState"])(jobValidator.duplicateDetectors);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setDetectors(jobCreator.detectors)},[jobCreatorUpdated]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(!jobValidator.duplicateDetectors.valid){setValidation(jobValidator.duplicateDetectors)}if(!jobValidator.categorizerVaryingPerPartitionField.valid){setValidation(jobValidator.categorizerVaryingPerPartitionField)}if(!jobValidator.categorizerMissingPerPartition.valid){setValidation(jobValidator.categorizerMissingPerPartition)}},[jobValidatorUpdated]);const Buttons=({index:index})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{color:"primary",onClick:()=>onEditJob(index),iconType:"pencil","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorList.editButton",{defaultMessage:"Edit"}),"data-test-subj":"mlAdvancedDetectorEditButton"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{color:"danger",onClick:()=>onDeleteJob(index),iconType:"trash","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorList.deleteButton",{defaultMessage:"Delete"}),"data-test-subj":"mlAdvancedDetectorDeleteButton"})));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h3",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.advancedDetectorList.title",defaultMessage:"Detectors"}))),external_kbnSharedDeps_React_default.a.createElement(NoDetectorsWarning,{show:detectors.length===0}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGrid"],{columns:3},detectors.map((d,i)=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{key:i,"data-test-subj":`mlAdvancedDetector ${i}`},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],{paddingSize:"m"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,d.detector_description!==undefined?external_kbnSharedDeps_React_default.a.createElement("div",{style:{fontWeight:"bold"},"data-test-subj":"mlDetectorDescription"},d.detector_description):external_kbnSharedDeps_React_default.a.createElement(StringifiedDetector,{detector:d})),isActive&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:{margin:"8px"}},external_kbnSharedDeps_React_default.a.createElement(Buttons,{index:i}))),d.detector_description!==undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"s"}),external_kbnSharedDeps_React_default.a.createElement(StringifiedDetector,{detector:d})))))),external_kbnSharedDeps_React_default.a.createElement(DetectorsValidationWarning,{validation:validation}))};const NoDetectorsWarning=({show:show})=>{if(show===false){return null}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.pickFieldsStep.noDetectorsCallout.title",{defaultMessage:"No detectors"}),iconType:"alert","data-test-subj":"mlAdvancedNoDetectorsMessage"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.noDetectorsCallout.message",defaultMessage:"At least one detector is needed to create a job."})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}))};const DetectorsValidationWarning=({validation:validation})=>{if(validation.valid===true){return null}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{error:validation.message,isInvalid:validation.valid===false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}))};const StringifiedDetector=({detector:detector})=>external_kbnSharedDeps_React_default.a.createElement("div",{"data-test-subj":"mlDetectorIdentifier"},Object(string_utils["b"])(detector));const emptyRichDetector={agg:null,field:null,byField:null,overField:null,partitionField:null,excludeFrequent:null,description:null,customRules:null};const AdvancedDetectors=({setIsValid:setIsValid})=>{const{jobCreator:jc,jobCreatorUpdate:jobCreatorUpdate}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const jobCreator=jc;const{fields:fields,aggs:aggs}=new_job_capabilities_service["c"];const[modalPayload,setModalPayload]=Object(external_kbnSharedDeps_React_["useState"])(null);function closeModal(){setModalPayload(null)}function detectorChangeHandler(dtr,index){if(index===undefined){jobCreator.addDetector(dtr.agg,dtr.field,dtr.byField,dtr.overField,dtr.partitionField,dtr.excludeFrequent,dtr.description)}else{jobCreator.editDetector(dtr.agg,dtr.field,dtr.byField,dtr.overField,dtr.partitionField,dtr.excludeFrequent,dtr.description,index)}jobCreatorUpdate();setModalPayload(null)}function showModal(){setModalPayload({detector:emptyRichDetector})}function onDeleteJob(i){jobCreator.removeDetector(i);jobCreatorUpdate()}function onEditJob(i){const dtr=jobCreator.richDetectors[i];if(dtr!==undefined){setModalPayload({detector:dtr,index:i})}}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(DetectorList,{isActive:true,onEditJob:onEditJob,onDeleteJob:onDeleteJob}),external_kbnSharedDeps_React_default.a.createElement(advanced_view_metric_selector_MetricSelector,{payload:modalPayload,fields:fields,aggs:aggs,detectorChangeHandler:detectorChangeHandler,showModal:showModal,closeModal:closeModal}))};const AdvancedDetectorsSummary=()=>external_kbnSharedDeps_React_default.a.createElement(DetectorList,{isActive:false,onEditJob:()=>{},onDeleteJob:()=>{}});const model_memory_limit_description_Description=Object(external_kbnSharedDeps_React_["memo"])(({children:children,validation:validation})=>{const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.modelMemoryLimit.title",{defaultMessage:"Model memory limit"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{title:external_kbnSharedDeps_React_default.a.createElement("h3",null,title),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.modelMemoryLimit.description",defaultMessage:"Set an approximate upper limit for the amount of memory that can be used by the analytical models."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:title,error:validation.message,isInvalid:validation.valid===false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children)))});const ModelMemoryLimitInput=()=>{const{jobCreator:jobCreator,jobCreatorUpdate:jobCreatorUpdate,jobCreatorUpdated:jobCreatorUpdated,jobValidator:jobValidator,jobValidatorUpdated:jobValidatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const[validation,setValidation]=Object(external_kbnSharedDeps_React_["useState"])(jobValidator.modelMemoryLimit);const[modelMemoryLimit,setModelMemoryLimit]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.modelMemoryLimit===null?"":jobCreator.modelMemoryLimit);const{anomaly_detectors:anomalyDetectors}=Object(ml_server_info["b"])();const{model_memory_limit:modelMemoryLimitDefault}=anomalyDetectors;Object(external_kbnSharedDeps_React_["useEffect"])(()=>{jobCreator.modelMemoryLimit=modelMemoryLimit===""?null:modelMemoryLimit;jobCreatorUpdate()},[modelMemoryLimit]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setModelMemoryLimit(jobCreator.modelMemoryLimit===null?"":jobCreator.modelMemoryLimit)},[jobCreatorUpdated]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setValidation(jobValidator.modelMemoryLimit)},[jobValidatorUpdated]);return external_kbnSharedDeps_React_default.a.createElement(model_memory_limit_description_Description,{validation:validation},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{value:modelMemoryLimit,placeholder:modelMemoryLimitDefault,onChange:e=>setModelMemoryLimit(e.target.value),isInvalid:validation.valid===false,"data-test-subj":"mlJobWizardInputModelMemoryLimit"}))};const AdvancedSettings=({setIsValid:setIsValid})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xl"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(BucketSpan,{setIsValid:setIsValid})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(Influencers,null))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xl"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(ModelMemoryLimitInput,null)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null)));const SummaryCountFieldSelect=({fields:fields,changeHandler:changeHandler,selectedField:selectedField})=>{const{jobCreator:jobCreator}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const options=[...Object(general["f"])(jobCreator.aggregationFields.length>0),...Object(general["g"])(fields,jobCreator.additionalFields)];const selection=[];if(selectedField!==null){selection.push({label:selectedField})}function onChange(selectedOptions){const option=selectedOptions[0];if(typeof option!=="undefined"){changeHandler(option.label)}else{changeHandler(null)}}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{singleSelection:{asPlainText:true},options:options,selectedOptions:selection,onChange:onChange,isClearable:true,"data-test-subj":"mlSummaryCountFieldNameSelect"})};const summary_count_field_description_Description=Object(external_kbnSharedDeps_React_["memo"])(({children:children,validation:validation})=>{const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.pickFieldsStep.summaryCountField.title",{defaultMessage:"Summary count field"});const{services:{docLinks:docLinks}}=Object(contexts_kibana["b"])();const docsUrl=docLinks.links.ml.aggregations;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{title:external_kbnSharedDeps_React_default.a.createElement("h3",null,title),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.summaryCountField.description",defaultMessage:"If the input data is {aggregated}, specify the field that contains the document count.",values:{aggregated:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{href:docsUrl,target:"_blank"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.summaryCountField.aggregatedText",defaultMessage:"aggregated"}))}})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:title,error:validation.message,isInvalid:validation.valid===false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children)))});const SummaryCountField=()=>{const{jobCreator:jc,jobCreatorUpdate:jobCreatorUpdate,jobCreatorUpdated:jobCreatorUpdated,jobValidator:jobValidator,jobValidatorUpdated:jobValidatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const jobCreator=jc;const{fields:fields}=new_job_capabilities_service["c"];const[summaryCountFieldName,setSummaryCountFieldName]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.summaryCountFieldName);const[validation,setValidation]=Object(external_kbnSharedDeps_React_["useState"])(jobValidator.summaryCountField);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setValidation(jobValidator.summaryCountField)},[jobValidatorUpdated]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{jobCreator.summaryCountFieldName=summaryCountFieldName;jobCreatorUpdate()},[summaryCountFieldName]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setSummaryCountFieldName(jobCreator.summaryCountFieldName)},[jobCreatorUpdated]);return external_kbnSharedDeps_React_default.a.createElement(summary_count_field_description_Description,{validation:validation},external_kbnSharedDeps_React_default.a.createElement(SummaryCountFieldSelect,{fields:fields,changeHandler:setSummaryCountFieldName,selectedField:summaryCountFieldName}))};const CategorizationFieldSelect=({fields:fields,changeHandler:changeHandler,selectedField:selectedField})=>{const{jobCreator:jobCreator,jobCreatorUpdated:jobCreatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const options=Object(external_kbnSharedDeps_React_["useMemo"])(()=>[...Object(general["g"])(fields,jobCreator.additionalFields)],[fields,jobCreatorUpdated]);const selection=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{const selectedOptions=[];if(selectedField!==null){selectedOptions.push({label:selectedField})}return selectedOptions},[selectedField]);const onChange=Object(external_kbnSharedDeps_React_["useCallback"])(selectedOptions=>{var _ref;return changeHandler((_ref=selectedOptions[0]&&selectedOptions[0].label)!==null&&_ref!==void 0?_ref:null)},[changeHandler]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{singleSelection:{asPlainText:true},options:options,selectedOptions:selection,onChange:onChange,isClearable:true,"data-test-subj":"mlCategorizationFieldNameSelect"})};const categorization_field_description_Description=Object(external_kbnSharedDeps_React_["memo"])(({children:children,isOptional:isOptional})=>{const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.pickFieldsStep.categorizationField.title",{defaultMessage:"Categorization field"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{title:external_kbnSharedDeps_React_default.a.createElement("h3",null,title),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,isOptional?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.categorizationFieldOptional.description",defaultMessage:"Optional, for use if analyzing unstructured log data. Using text data types is recommended."}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.categorizationField.description",defaultMessage:"Specifies which field will be categorized. Using text data types is recommended. Categorization works best on machine written log messages, typically logging written by a developer for the purpose of system troubleshooting."}))},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:title},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children)))});const CategorizationField=()=>{const{jobCreator:jc,jobCreatorUpdate:jobCreatorUpdate,jobCreatorUpdated:jobCreatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const jobCreator=jc;const{catFields:catFields}=new_job_capabilities_service["c"];const[categorizationFieldName,setCategorizationFieldName]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.categorizationFieldName);const isCategorizationJob=Object(job_creator["b"])(jobCreator);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(jobCreator.categorizationFieldName!==categorizationFieldName){jobCreator.categorizationFieldName=categorizationFieldName;jobCreatorUpdate()}},[categorizationFieldName]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setCategorizationFieldName(jobCreator.categorizationFieldName)},[jobCreatorUpdated]);return external_kbnSharedDeps_React_default.a.createElement(categorization_field_description_Description,{isOptional:isCategorizationJob===false},external_kbnSharedDeps_React_default.a.createElement(CategorizationFieldSelect,{fields:catFields,changeHandler:setCategorizationFieldName,selectedField:categorizationFieldName}))};const categorization_partition_field_description_Description=Object(external_kbnSharedDeps_React_["memo"])(({children:children})=>{const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.perPartitionCategorization.enable.title",{defaultMessage:"Enable per-partition categorization"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{title:external_kbnSharedDeps_React_default.a.createElement("h3",null,title),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.perPartitionCategorization.enable.description",defaultMessage:"If per-partition categorization is enabled then categories are determined independently for each value of the partition field."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children))});const CategorizationPerPartitionSwitch=()=>{const{jobCreator:jc,jobCreatorUpdate:jobCreatorUpdate,jobCreatorUpdated:jobCreatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const jobCreator=jc;const[enablePerPartitionCategorization,setEnablePerPartitionCategorization]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.perPartitionCategorization);const toggleEnablePerPartitionCategorization=Object(external_kbnSharedDeps_React_["useCallback"])(()=>setEnablePerPartitionCategorization(!enablePerPartitionCategorization),[enablePerPartitionCategorization]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setEnablePerPartitionCategorization(jobCreator.perPartitionCategorization)},[jobCreatorUpdated]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(enablePerPartitionCategorization===false){jobCreator.perPartitionStopOnWarn=false}jobCreator.perPartitionCategorization=enablePerPartitionCategorization;jobCreatorUpdate()},[enablePerPartitionCategorization]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{name:"categorizationPerPartitionSwitch",disabled:false,checked:enablePerPartitionCategorization,onChange:toggleEnablePerPartitionCategorization,"data-test-subj":"mlJobWizardSwitchCategorizationPerPartition",label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.perPartitionCategorizationSwitchLabel",defaultMessage:"Enable per-partition categorization"})})};const CategorizationPerPartitionStopOnWarnSwitch=()=>{const{jobCreator:jc,jobCreatorUpdate:jobCreatorUpdate,jobCreatorUpdated:jobCreatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const jobCreator=jc;const[stopOnWarn,setStopOnWarn]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.perPartitionStopOnWarn);const toggleStopOnWarn=Object(external_kbnSharedDeps_React_["useCallback"])(()=>setStopOnWarn(!stopOnWarn),[stopOnWarn]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{jobCreator.perPartitionStopOnWarn=stopOnWarn;jobCreatorUpdate()},[stopOnWarn]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setStopOnWarn(jobCreator.perPartitionStopOnWarn)},[jobCreatorUpdated]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{name:"categorizationPerPartitionStopOnWarnSwitch",disabled:false,checked:stopOnWarn,onChange:toggleStopOnWarn,"data-test-subj":"mlJobWizardSwitchCategorizationPerPartitionStopOnWarn",label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.perPartitionCategorizationtopOnWarnSwitchLabel",defaultMessage:"Stop on warn"})})};const CategorizationPerPartitionFieldSelect=({fields:fields,changeHandler:changeHandler,selectedField:selectedField})=>{const{jobCreator:jobCreator,jobCreatorUpdated:jobCreatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const options=Object(external_kbnSharedDeps_React_["useMemo"])(()=>[...Object(general["g"])(fields,jobCreator.additionalFields)],[fields,jobCreatorUpdated]);const selection=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{const selectedOptions=[];if(selectedField!==null){selectedOptions.push({label:selectedField})}return selectedOptions},[selectedField]);const onChange=Object(external_kbnSharedDeps_React_["useCallback"])(selectedOptions=>{var _ref;return changeHandler((_ref=selectedOptions[0]&&selectedOptions[0].label)!==null&&_ref!==void 0?_ref:null)},[changeHandler]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{singleSelection:{asPlainText:true},options:options,selectedOptions:selection,onChange:onChange,isClearable:true,"data-test-subj":"mlJobWizardCategorizationPerPartitionFieldNameSelect"})};const CategorizationPerPartitionFieldDropdown=({setEnablePerPartitionCategorization:setEnablePerPartitionCategorization})=>{const{jobCreator:jc,jobCreatorUpdate:jobCreatorUpdate,jobCreatorUpdated:jobCreatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const jobCreator=jc;const[categorizationPartitionFieldName,setCategorizationPartitionFieldName]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.categorizationPerPartitionField);const{categoryFields:categoryFields}=new_job_capabilities_service["c"];const filteredCategories=Object(external_kbnSharedDeps_React_["useMemo"])(()=>categoryFields.filter(c=>c.id!==jobCreator.categorizationFieldName),[categoryFields,jobCreatorUpdated]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{jobCreator.categorizationPerPartitionField=categorizationPartitionFieldName;jobCreatorUpdate()},[categorizationPartitionFieldName]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(jobCreator.perPartitionCategorization&&jobCreator.categorizationPerPartitionField===null&&filteredCategories.length>0){jobCreator.categorizationPerPartitionField=filteredCategories[0].id}setCategorizationPartitionFieldName(jobCreator.categorizationPerPartitionField);setEnablePerPartitionCategorization(jobCreator.perPartitionCategorization)},[jobCreatorUpdated]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.extraStep.categorizationJob.categorizationPerPartitionFieldLabel",defaultMessage:"Partition field"})},external_kbnSharedDeps_React_default.a.createElement(CategorizationPerPartitionFieldSelect,{fields:filteredCategories,changeHandler:setCategorizationPartitionFieldName,selectedField:categorizationPartitionFieldName||""}))};const CategorizationPerPartitionField=()=>{const{jobCreator:jc,jobCreatorUpdated:jobCreatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const jobCreator=jc;const[enablePerPartitionCategorization,setEnablePerPartitionCategorization]=Object(external_kbnSharedDeps_React_["useState"])(false);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setEnablePerPartitionCategorization(jobCreator.perPartitionCategorization)},[jobCreatorUpdated]);return external_kbnSharedDeps_React_default.a.createElement(categorization_partition_field_description_Description,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.extraStep.categorizationJob.perPartitionCategorizationLabel",defaultMessage:"Enable per-partition categorization"})},external_kbnSharedDeps_React_default.a.createElement(CategorizationPerPartitionSwitch,null)),enablePerPartitionCategorization&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.extraStep.categorizationJob.stopOnWarnLabel",defaultMessage:"Stop on warn"})},external_kbnSharedDeps_React_default.a.createElement(CategorizationPerPartitionStopOnWarnSwitch,null))),Object(job_creator["b"])(jobCreator)&&enablePerPartitionCategorization&&external_kbnSharedDeps_React_default.a.createElement(CategorizationPerPartitionFieldDropdown,{setEnablePerPartitionCategorization:setEnablePerPartitionCategorization}))};const ExtraSettings=()=>{const{jobCreator:jobCreator}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const showCategorizationPerPartitionField=Object(job_creator["a"])(jobCreator)&&jobCreator.categorizationFieldName!==null;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xl"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(CategorizationField,null)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(SummaryCountField,null))),showCategorizationPerPartitionField&&external_kbnSharedDeps_React_default.a.createElement(CategorizationPerPartitionField,null))};const AdvancedView=({isActive:isActive,setCanProceed:setCanProceed})=>{const[metricsValid,setMetricValid]=Object(external_kbnSharedDeps_React_["useState"])(false);const[settingsValid,setSettingsValid]=Object(external_kbnSharedDeps_React_["useState"])(false);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(typeof setCanProceed==="function"){setCanProceed(metricsValid&&settingsValid)}},[metricsValid,settingsValid]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,isActive===false?external_kbnSharedDeps_React_default.a.createElement(AdvancedDetectorsSummary,null):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(ExtraSettings,null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"l"}),external_kbnSharedDeps_React_default.a.createElement(AdvancedDetectors,{setIsValid:setMetricValid}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"l"}),external_kbnSharedDeps_React_default.a.createElement(AdvancedSettings,{setIsValid:setSettingsValid})))};const CountCard=({onClick:onClick,isSelected:isSelected})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCard"],{"data-test-subj":`mlJobWizardCategorizationDetectorCountCard${isSelected?" selected":""}`,title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.pickFieldsStep.categorizationDetectorSelect.countCard.title",{defaultMessage:"Count"}),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.categorizationDetectorSelect.countCard.description",defaultMessage:"Look for anomalies in the event rate of a particular category."})),selectable:{onClick:onClick,isSelected:isSelected}}));const RareCard=({onClick:onClick,isSelected:isSelected})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCard"],{"data-test-subj":`mlJobWizardCategorizationDetectorRareCard${isSelected?" selected":""}`,title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.pickFieldsStep.categorizationDetectorSelect.rareCard.title",{defaultMessage:"Rare"}),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.categorizationDetectorSelect.rareCard.description",defaultMessage:"Look for categories that occur rarely in time."})),selectable:{onClick:onClick,isSelected:isSelected}}));const CategorizationDetector=()=>{const{jobCreator:jc,jobCreatorUpdate:jobCreatorUpdate,jobCreatorUpdated:jobCreatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const jobCreator=jc;const[categorizationDetectorType,setCategorizationDetectorType]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.selectedDetectorType);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(categorizationDetectorType!==jobCreator.selectedDetectorType){jobCreator.setDetectorType(categorizationDetectorType);jobCreatorUpdate()}},[categorizationDetectorType]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setCategorizationDetectorType(jobCreator.selectedDetectorType)},[jobCreatorUpdated]);function onCountSelection(){setCategorizationDetectorType(aggregation_types["b"].COUNT)}function onRareSelection(){setCategorizationDetectorType(aggregation_types["b"].RARE)}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h3",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.categorizationDetectorSelect.title",defaultMessage:"Categorization detector"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"l",style:{maxWidth:"824px"}},external_kbnSharedDeps_React_default.a.createElement(CountCard,{onClick:onCountSelection,isSelected:categorizationDetectorType===aggregation_types["b"].COUNT}),external_kbnSharedDeps_React_default.a.createElement(RareCard,{onClick:onRareSelection,isSelected:categorizationDetectorType===aggregation_types["b"].RARE})))};const TOKEN_HIGHLIGHT_COLOR="#b0ccf7";const FieldExamples=({fieldExamples:fieldExamples})=>{if(fieldExamples===null||fieldExamples.length===0){return null}const columns=[{field:"example",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.pickFieldsStep.categorizationFieldExamples.title",{defaultMessage:"Examples"}),render:example=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("code",null,example))}];const items=fieldExamples.map((example,i)=>{const txt=[];let tokenCounter=0;let buffer="";let charCount=0;while(charCount<example.text.length){const token=example.tokens[tokenCounter];if(token&&charCount===token.start_offset){txt.push(buffer);buffer="";txt.push(external_kbnSharedDeps_React_default.a.createElement(Token,{key:`${i}${charCount}`},token.token));charCount+=token.end_offset-token.start_offset;tokenCounter++}else{buffer+=example.text[charCount];charCount++}}txt.push(buffer);return{example:txt}});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBasicTable"],{columns:columns,items:items,"data-test-subj":"mlJobWizardCategorizationExamplesTable"})};const Token=({children:children})=>external_kbnSharedDeps_React_default.a.createElement("span",{style:{backgroundColor:TOKEN_HIGHLIGHT_COLOR}},children);var ml_job_editor=__webpack_require__(115);var validation_utils=__webpack_require__(126);const EDITOR_HEIGHT="800px";const EditCategorizationAnalyzerFlyout=()=>{const{jobCreator:jc,jobCreatorUpdate:jobCreatorUpdate}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const jobCreator=jc;const[showJsonFlyout,setShowJsonFlyout]=Object(external_kbnSharedDeps_React_["useState"])(false);const[saveable,setSaveable]=Object(external_kbnSharedDeps_React_["useState"])(false);const[categorizationAnalyzerString,setCategorizationAnalyzerString]=Object(external_kbnSharedDeps_React_["useState"])(JSON.stringify(jobCreator.categorizationAnalyzer,null,2));Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(showJsonFlyout===true){setCategorizationAnalyzerString(JSON.stringify(jobCreator.categorizationAnalyzer,null,2))}},[showJsonFlyout]);function toggleJsonFlyout(){setSaveable(false);setShowJsonFlyout(!showJsonFlyout)}function onJSONChange(json){setCategorizationAnalyzerString(json);const valid=Object(validation_utils["c"])(json);setSaveable(valid)}function onSave(){jobCreator.categorizationAnalyzer=JSON.parse(categorizationAnalyzerString);jobCreatorUpdate();setShowJsonFlyout(false)}function onUseDefault(){const{anomaly_detectors:anomalyDetectors}=Object(ml_server_info["b"])();const analyzerString=JSON.stringify(anomalyDetectors.categorization_analyzer,null,2);onJSONChange(analyzerString)}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(FlyoutButton,{onClick:toggleJsonFlyout}),showJsonFlyout===true&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyout"],{onClose:()=>setShowJsonFlyout(false),hideCloseButton:true,size:"m"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutBody"],null,external_kbnSharedDeps_React_default.a.createElement(Contents,{onChange:onJSONChange,title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.categorizationAnalyzerFlyout.title",{defaultMessage:"Edit categorization analyzer JSON"}),value:categorizationAnalyzerString})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutFooter"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{iconType:"cross",onClick:()=>setShowJsonFlyout(false),flush:"left"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.categorizationAnalyzerFlyout.closeButton",defaultMessage:"Close"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:true}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:onUseDefault},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.categorizationAnalyzerFlyout.useDefaultButton",defaultMessage:"Use default ML analyzer"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:onSave,fill:true,isDisabled:saveable===false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.categorizationAnalyzerFlyout.saveButton",defaultMessage:"Save"})))))))};const FlyoutButton=({onClick:onClick})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:onClick,flush:"left","data-test-subj":"mlJobWizardButtonPreviewJobJson"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.editCategorizationAnalyzerFlyoutButton",defaultMessage:"Edit categorization analyzer"}));const Contents=({title:title,value:value,onChange:onChange})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h5",null,title)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(ml_job_editor["a"],{value:value,height:EDITOR_HEIGHT,readOnly:false,onChange:onChange}));const allChecksButtonContent=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobDetailsStep.allChecksButton",{defaultMessage:"View all checks performed"});const ExamplesValidCallout=({overallValidStatus:overallValidStatus,validationChecks:validationChecks,categorizationAnalyzer:categorizationAnalyzer})=>{const analyzerUsed=external_kbnSharedDeps_React_default.a.createElement(AnalyzerUsed,{categorizationAnalyzer:categorizationAnalyzer});let color="success";let title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.pickFieldsStep.categorizationFieldCalloutTitle.valid",{defaultMessage:"Selected category field is valid"});if(overallValidStatus===categorization_job["a"].INVALID){color="danger";title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.pickFieldsStep.categorizationFieldCalloutTitle.invalid",{defaultMessage:"Selected category field is invalid"})}else if(overallValidStatus===categorization_job["a"].PARTIALLY_VALID){color="warning";title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.pickFieldsStep.categorizationFieldCalloutTitle.possiblyInvalid",{defaultMessage:"Selected category field is possibly invalid"})}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{color:color,title:title,"data-test-subj":`mlJobWizardCategorizationExamplesCallout ${overallValidStatus}`},validationChecks.map((v,i)=>external_kbnSharedDeps_React_default.a.createElement("div",{key:i},v.message)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),analyzerUsed,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiAccordion"],{id:"all-checks",buttonContent:allChecksButtonContent},external_kbnSharedDeps_React_default.a.createElement(AllValidationChecks,{validationChecks:validationChecks})))};const AnalyzerUsed=({categorizationAnalyzer:categorizationAnalyzer})=>{let analyzer="";if((categorizationAnalyzer===null||categorizationAnalyzer===void 0?void 0:categorizationAnalyzer.tokenizer)!==undefined){analyzer=categorizationAnalyzer.tokenizer}else if((categorizationAnalyzer===null||categorizationAnalyzer===void 0?void 0:categorizationAnalyzer.analyzer)!==undefined){analyzer=categorizationAnalyzer.analyzer}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.categorizationFieldAnalyzer",defaultMessage:"Analyzer used: {analyzer}",values:{analyzer:analyzer}})),external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(EditCategorizationAnalyzerFlyout,null)))};const AllValidationChecks=({validationChecks:validationChecks})=>{const list=Object.keys(categorization_job["c"]).map((k,i)=>{const failedCheck=validationChecks.find(vc=>vc.id===i);if(failedCheck!==undefined&&(failedCheck===null||failedCheck===void 0?void 0:failedCheck.valid)!==categorization_job["a"].VALID){return{iconType:"cross",label:failedCheck.message,size:"s"}}return{iconType:"check",label:categorization_job["c"][i],size:"s"}});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiListGroup"],{listItems:list,maxWidth:false})};const CategorizationDetectors=({setIsValid:setIsValid})=>{const{jobCreator:jc,jobCreatorUpdate:jobCreatorUpdate,jobCreatorUpdated:jobCreatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const jobCreator=jc;const[loadingData,setLoadingData]=Object(external_kbnSharedDeps_React_["useState"])(false);const[start,setStart]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.start);const[end,setEnd]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.end);const[categorizationAnalyzerString,setCategorizationAnalyzerString]=Object(external_kbnSharedDeps_React_["useState"])(JSON.stringify(jobCreator.categorizationAnalyzer));const[fieldExamples,setFieldExamples]=Object(external_kbnSharedDeps_React_["useState"])(null);const[overallValidStatus,setOverallValidStatus]=Object(external_kbnSharedDeps_React_["useState"])(categorization_job["a"].INVALID);const[validationChecks,setValidationChecks]=Object(external_kbnSharedDeps_React_["useState"])([]);const[categorizationFieldName,setCategorizationFieldName]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.categorizationFieldName);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(jobCreator.categorizationFieldName!==categorizationFieldName){jobCreator.categorizationFieldName=categorizationFieldName;jobCreatorUpdate()}loadFieldExamples()},[categorizationFieldName]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{let updateExamples=false;if(jobCreator.start!==start||jobCreator.end!==end){setStart(jobCreator.start);setEnd(jobCreator.end);updateExamples=true}const tempCategorizationAnalyzerString=JSON.stringify(jobCreator.categorizationAnalyzer);if(tempCategorizationAnalyzerString!==categorizationAnalyzerString){setCategorizationAnalyzerString(tempCategorizationAnalyzerString);updateExamples=true}if(updateExamples){loadFieldExamples()}if(jobCreator.categorizationFieldName!==categorizationFieldName){setCategorizationFieldName(jobCreator.categorizationFieldName)}},[jobCreatorUpdated]);async function loadFieldExamples(){if(categorizationFieldName!==null){setLoadingData(true);try{const{examples:examples,overallValidStatus:tempOverallValidStatus,validationChecks:tempValidationChecks}=await jobCreator.loadCategorizationFieldExamples();setFieldExamples(examples);setOverallValidStatus(tempOverallValidStatus);setValidationChecks(tempValidationChecks);setLoadingData(false)}catch(error){setLoadingData(false);setFieldExamples(null);setValidationChecks([]);setOverallValidStatus(categorization_job["a"].INVALID);Object(toast_notification_service["a"])().displayErrorToast(error)}}else{setFieldExamples(null);setValidationChecks([]);setOverallValidStatus(categorization_job["a"].INVALID)}setIsValid(categorizationFieldName!==null)}Object(external_kbnSharedDeps_React_["useEffect"])(()=>{jobCreatorUpdate()},[overallValidStatus]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(CategorizationDetector,null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],null),external_kbnSharedDeps_React_default.a.createElement(CategorizationField,null),loadingData===true&&external_kbnSharedDeps_React_default.a.createElement(loading_wrapper["a"],{hasData:false,loading:true},external_kbnSharedDeps_React_default.a.createElement("div",null)),fieldExamples!==null&&loadingData===false&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(ExamplesValidCallout,{overallValidStatus:overallValidStatus,validationChecks:validationChecks,categorizationAnalyzer:jobCreator.categorizationAnalyzer}),external_kbnSharedDeps_React_default.a.createElement(FieldExamples,{fieldExamples:fieldExamples})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],null),external_kbnSharedDeps_React_default.a.createElement(CategorizationPerPartitionField,null))};const TopCategories=()=>{const{jobCreator:jc,resultsLoader:resultsLoader}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const jobCreator=jc;const[tableRow,setTableRow]=Object(external_kbnSharedDeps_React_["useState"])([]);const[totalCategories,setTotalCategories]=Object(external_kbnSharedDeps_React_["useState"])(0);function setResultsWrapper(results){loadTopCats()}async function loadTopCats(){const results=await ml_api_service["ml"].jobs.topCategories(jobCreator.jobId,categorization_job["b"]);setTableRow(results.categories.map(c=>{var _c$category$examples;return{count:c.count,example:(_c$category$examples=c.category.examples)!==null&&_c$category$examples!==void 0&&_c$category$examples.length?c.category.examples[0]:""}}));setTotalCategories(results.total)}Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const resultsSubscription=resultsLoader.subscribeToResults(setResultsWrapper);return()=>{resultsSubscription.unsubscribe()}},[]);const columns=[...jobCreator.modelPlot?[{field:"count",name:"count",width:"100px",render:count=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("code",null,count))}]:[],{field:"example",name:"Example",render:example=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("code",null,example))}];return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,totalCategories>0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.categorizationTotalCategories",defaultMessage:"Total categories: {totalCategories}",values:{totalCategories:totalCategories}})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBasicTable"],{columns:columns,items:tableRow})))};const NUMBER_OF_PREVIEW=5;const CategoryStoppedPartitions=()=>{const{jobCreator:jc,resultsLoader:resultsLoader}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const jobCreator=jc;const[tableRow,setTableRow]=Object(external_kbnSharedDeps_React_["useState"])([]);const[stoppedPartitionsError,setStoppedPartitionsError]=Object(external_kbnSharedDeps_React_["useState"])();const columns=Object(external_kbnSharedDeps_React_["useMemo"])(()=>[{field:"partitionName",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.pickFieldsStep.stoppedPartitionsPreviewColumnName",{defaultMessage:"Stopped partition names"}),render:partition=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("code",null,partition))}],[]);const loadCategoryStoppedPartitions=Object(external_kbnSharedDeps_React_["useCallback"])(async()=>{try{const{jobs:jobs}=await ml_api_service["ml"].results.getCategoryStoppedPartitions([jobCreator.jobId]);if(!Array.isArray(jobs)&&Array.isArray(jobs[jobCreator.jobId])&&jobs[jobCreator.jobId].length>0){return jobs[jobCreator.jobId]}}catch(e){const error=Object(util_errors["j"])(e);if(error.statusCode!==404){setStoppedPartitionsError(error.message)}}},[jobCreator.jobId]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(jobCreator.perPartitionCategorization&&jobCreator.perPartitionStopOnWarn){const resultsSubscription=resultsLoader.results$.pipe(Object(external_kbnSharedDeps_RxjsOperators_["switchMap"])(()=>Object(external_kbnSharedDeps_Rxjs_["from"])(loadCategoryStoppedPartitions())),Object(external_kbnSharedDeps_RxjsOperators_["tap"])(results=>{if(Array.isArray(results)){setTableRow(results.slice(0,NUMBER_OF_PREVIEW).map(partitionName=>({partitionName:partitionName})))}}),Object(external_kbnSharedDeps_RxjsOperators_["takeWhile"])(results=>!results||Array.isArray(results)&&results.length<=NUMBER_OF_PREVIEW)).subscribe();return()=>resultsSubscription.unsubscribe()}},[]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,stoppedPartitionsError&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{color:"danger",size:"s",title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.stoppedPartitionsErrorCallout",defaultMessage:"An error occurred while fetching list of stopped partitions."})})),Array.isArray(tableRow)&&tableRow.length>0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.categorizationStoppedPartitionsTitle",defaultMessage:"Stopped partitions"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{color:"warning",size:"s",title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.pickFieldsStep.stoppedPartitionsExistCallout",defaultMessage:"Per-partition categorization and stop_on_warn settings are enabled. Some partitions in job '{jobId}' are unsuitable for categorization and have been excluded from further categorization or anomaly detection analysis.",values:{jobId:jobCreator.jobId}})}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBasicTable"],{columns:columns,items:tableRow})))};const categorization_view_metric_selection_summary_DTR_IDX=0;const CategorizationDetectorsSummary=()=>{const{jobCreator:jc,chartLoader:chartLoader,resultsLoader:resultsLoader,chartInterval:chartInterval}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const jobCreator=jc;const[loadingData,setLoadingData]=Object(external_kbnSharedDeps_React_["useState"])(false);const[anomalyData,setAnomalyData]=Object(external_kbnSharedDeps_React_["useState"])([]);const[eventRateChartData,setEventRateChartData]=Object(external_kbnSharedDeps_React_["useState"])([]);const[jobIsRunning,setJobIsRunning]=Object(external_kbnSharedDeps_React_["useState"])(false);function setResultsWrapper(results){const anomalies=results.anomalies[categorization_view_metric_selection_summary_DTR_IDX];if(anomalies!==undefined){setAnomalyData(anomalies)}}function watchProgress(progress){setJobIsRunning(progress>0)}Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const resultsSubscription=resultsLoader.subscribeToResults(setResultsWrapper);jobCreator.subscribeToProgress(watchProgress);loadChart();return()=>{resultsSubscription.unsubscribe()}},[]);async function loadChart(){setLoadingData(true);try{const resp=await chartLoader.loadEventRateChart(jobCreator.start,jobCreator.end,chartInterval.getInterval().asMilliseconds());setEventRateChartData(resp)}catch(error){setEventRateChartData([])}setLoadingData(false)}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(event_rate_chart["a"],{eventRateChartData:eventRateChartData,anomalyData:anomalyData,height:"300px",width:"100%",showAxis:true,loading:loadingData,fadeChart:jobIsRunning}),external_kbnSharedDeps_React_default.a.createElement(TopCategories,null),external_kbnSharedDeps_React_default.a.createElement(CategoryStoppedPartitions,null))};const CategorizationSettings=({setIsValid:setIsValid})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xl"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(BucketSpan,{setIsValid:setIsValid,hideEstimateButton:true}))));const CategorizationView=({isActive:isActive,setCanProceed:setCanProceed})=>{const[categoryFieldValid,setCategoryFieldValid]=Object(external_kbnSharedDeps_React_["useState"])(false);const[settingsValid,setSettingsValid]=Object(external_kbnSharedDeps_React_["useState"])(false);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(typeof setCanProceed==="function"){setCanProceed(categoryFieldValid&&settingsValid)}},[categoryFieldValid,settingsValid]);return isActive===false?external_kbnSharedDeps_React_default.a.createElement(CategorizationDetectorsSummary,null):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(CategorizationDetectors,{setIsValid:setCategoryFieldValid}),categoryFieldValid&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"l"}),external_kbnSharedDeps_React_default.a.createElement(CategorizationSettings,{setIsValid:setSettingsValid})))};var shared_imports=__webpack_require__(159);var object_utils=__webpack_require__(127);const DatafeedPreview=({combinedJob:combinedJob,heightOffset:heightOffset=0})=>{const editorHeight=Object(external_kbnSharedDeps_React_["useMemo"])(()=>`${window.innerHeight-230-heightOffset}px`,[heightOffset]);const[loading,setLoading]=Object(external_kbnSharedDeps_React_["useState"])(false);const[previewJsonString,setPreviewJsonString]=Object(external_kbnSharedDeps_React_["useState"])("");const[outOfDate,setOutOfDate]=Object(external_kbnSharedDeps_React_["useState"])(false);const[combinedJobString,setCombinedJobString]=Object(external_kbnSharedDeps_React_["useState"])("");Object(external_kbnSharedDeps_React_["useEffect"])(()=>{try{if(combinedJob!==null){if(combinedJobString===""){loadDataPreview()}else{setOutOfDate(JSON.stringify(combinedJob)!==combinedJobString)}}}catch(error){}},[combinedJob]);const loadDataPreview=Object(external_kbnSharedDeps_React_["useCallback"])(async()=>{setPreviewJsonString("");if(combinedJob===null){return}setLoading(true);setCombinedJobString(JSON.stringify(combinedJob));if(combinedJob.datafeed_config&&combinedJob.datafeed_config.indices.length){try{const resp=await job_service["a"].searchPreview(combinedJob);let data=resp.hits.hits;if(Object(object_utils["a"])(resp.aggregations)){const accessor=Object.keys(resp.aggregations)[0];data=resp.aggregations[accessor].buckets.slice(0,job_utils["a"])}setPreviewJsonString(JSON.stringify(data,null,2))}catch(error){setPreviewJsonString(JSON.stringify(error,null,2))}setLoading(false);setOutOfDate(false)}else{const errorText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.datafeedPreviewFlyout.datafeedDoesNotExistLabel",{defaultMessage:"Datafeed does not exist"});setPreviewJsonString(errorText)}},[combinedJob]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h5",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.datafeedPreviewFlyout.title",defaultMessage:"Datafeed preview"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},outOfDate&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{size:"s",onClick:loadDataPreview,iconType:"refresh"},"Refresh"))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),loading===true?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceAround"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xxl"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLoadingSpinner"],{size:"l"}))):external_kbnSharedDeps_React_default.a.createElement(ml_job_editor["a"],{value:previewJsonString,height:editorHeight,readOnly:true}))};let EDITOR_MODE;(function(EDITOR_MODE){EDITOR_MODE[EDITOR_MODE["HIDDEN"]=0]="HIDDEN";EDITOR_MODE[EDITOR_MODE["READONLY"]=1]="READONLY";EDITOR_MODE[EDITOR_MODE["EDITABLE"]=2]="EDITABLE"})(EDITOR_MODE||(EDITOR_MODE={}));const DatafeedPreviewFlyout=({isDisabled:isDisabled})=>{const{jobCreator:jobCreator}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const[showFlyout,setShowFlyout]=Object(external_kbnSharedDeps_React_["useState"])(false);function toggleFlyout(){setShowFlyout(!showFlyout)}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(datafeed_preview_flyout_FlyoutButton,{onClick:toggleFlyout,isDisabled:isDisabled}),showFlyout===true&&isDisabled===false&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyout"],{onClose:()=>setShowFlyout(false),hideCloseButton:true,size:"m"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutBody"],null,external_kbnSharedDeps_React_default.a.createElement(DatafeedPreview,{combinedJob:{...jobCreator.jobConfig,datafeed_config:jobCreator.datafeedConfig}})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutFooter"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{iconType:"cross",onClick:()=>setShowFlyout(false),flush:"left"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.datafeedPreviewFlyout.closeButton",defaultMessage:"Close"})))))))};const datafeed_preview_flyout_FlyoutButton=({isDisabled:isDisabled,onClick:onClick})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:onClick,isDisabled:isDisabled,"data-test-subj":"mlJobWizardButtonPreviewJobJson"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.datafeedPreviewFlyout.showButton",defaultMessage:"Datafeed preview"}));let json_editor_flyout_EDITOR_MODE;(function(EDITOR_MODE){EDITOR_MODE[EDITOR_MODE["HIDDEN"]=0]="HIDDEN";EDITOR_MODE[EDITOR_MODE["READONLY"]=1]="READONLY";EDITOR_MODE[EDITOR_MODE["EDITABLE"]=2]="EDITABLE"})(json_editor_flyout_EDITOR_MODE||(json_editor_flyout_EDITOR_MODE={}));const WARNING_CALLOUT_OFFSET=100;const JsonEditorFlyout=({isDisabled:isDisabled,jobEditorMode:jobEditorMode,datafeedEditorMode:datafeedEditorMode})=>{const{jobCreator:jobCreator,jobCreatorUpdate:jobCreatorUpdate,jobCreatorUpdated:jobCreatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const[showJsonFlyout,setShowJsonFlyout]=Object(external_kbnSharedDeps_React_["useState"])(false);const[showChangedIndicesWarning,setShowChangedIndicesWarning]=Object(external_kbnSharedDeps_React_["useState"])(false);const[jobConfigString,setJobConfigString]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.formattedJobJson);const[datafeedConfigString,setDatafeedConfigString]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.formattedDatafeedJson);const[saveable,setSaveable]=Object(external_kbnSharedDeps_React_["useState"])(false);const[tempCombinedJob,setTempCombinedJob]=Object(external_kbnSharedDeps_React_["useState"])(null);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setJobConfigString(jobCreator.formattedJobJson);setDatafeedConfigString(jobCreator.formattedDatafeedJson)},[jobCreatorUpdated]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(showJsonFlyout===true){setJobConfigString(jobCreator.formattedJobJson);setDatafeedConfigString(jobCreator.formattedDatafeedJson);setTempCombinedJob({...JSON.parse(jobCreator.formattedJobJson),datafeed_config:JSON.parse(jobCreator.formattedDatafeedJson)});setShowChangedIndicesWarning(false)}else{setTempCombinedJob(null)}},[showJsonFlyout]);const editJsonMode=jobEditorMode===json_editor_flyout_EDITOR_MODE.EDITABLE||datafeedEditorMode===json_editor_flyout_EDITOR_MODE.EDITABLE;const readOnlyMode=jobEditorMode===json_editor_flyout_EDITOR_MODE.READONLY&&datafeedEditorMode===json_editor_flyout_EDITOR_MODE.READONLY;function toggleJsonFlyout(){setSaveable(false);setShowJsonFlyout(!showJsonFlyout)}function onJobChange(json){setJobConfigString(json);const valid=Object(validation_utils["c"])(json);setTempCombinedJob(valid?{...JSON.parse(json),datafeed_config:JSON.parse(datafeedConfigString)}:null);setSaveable(valid)}function onDatafeedChange(json){setDatafeedConfigString(json);const jsonValue=Object(shared_imports["b"])(json);let valid=Object(validation_utils["c"])(jsonValue);if(valid){const datafeed=JSON.parse(jsonValue);const originalIndices=jobCreator.indices.sort();valid=originalIndices.length===datafeed.indices.length&&originalIndices.every((value,index)=>value===datafeed.indices[index]);setShowChangedIndicesWarning(valid===false);setTempCombinedJob({...JSON.parse(jobConfigString),datafeed_config:datafeed})}else{setShowChangedIndicesWarning(false);setTempCombinedJob(null)}setSaveable(valid)}function onSave(){const jobConfig=JSON.parse(jobConfigString);const datafeedConfig=JSON.parse(Object(shared_imports["b"])(datafeedConfigString));jobCreator.cloneFromExistingJob(jobConfig,datafeedConfig);jobCreatorUpdate();setShowJsonFlyout(false)}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(json_editor_flyout_FlyoutButton,{onClick:toggleJsonFlyout,isDisabled:isDisabled,editJsonMode:editJsonMode}),showJsonFlyout===true&&isDisabled===false&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyout"],{onClose:()=>setShowJsonFlyout(false),hideCloseButton:true,size:"l"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,jobEditorMode!==json_editor_flyout_EDITOR_MODE.HIDDEN&&external_kbnSharedDeps_React_default.a.createElement(json_editor_flyout_Contents,{editJson:jobEditorMode===json_editor_flyout_EDITOR_MODE.EDITABLE,onChange:onJobChange,title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jsonFlyout.job.title",{defaultMessage:"Job configuration JSON"}),value:jobConfigString,heightOffset:showChangedIndicesWarning?WARNING_CALLOUT_OFFSET:0}),datafeedEditorMode!==json_editor_flyout_EDITOR_MODE.HIDDEN&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(json_editor_flyout_Contents,{editJson:datafeedEditorMode===json_editor_flyout_EDITOR_MODE.EDITABLE,onChange:onDatafeedChange,title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jsonFlyout.datafeed.title",{defaultMessage:"Datafeed configuration JSON"}),value:datafeedConfigString,heightOffset:showChangedIndicesWarning?WARNING_CALLOUT_OFFSET:0}),datafeedEditorMode===json_editor_flyout_EDITOR_MODE.EDITABLE&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(DatafeedPreview,{combinedJob:tempCombinedJob,heightOffset:showChangedIndicesWarning?WARNING_CALLOUT_OFFSET:0})))),showChangedIndicesWarning&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{color:"warning",size:"s",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jsonFlyout.indicesChange.calloutTitle",{defaultMessage:"Indices have changed"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.jsonFlyout.indicesChange.calloutText",defaultMessage:"It is not possible to alter the indices being used by the datafeed here. If you wish to select a different index pattern or saved search, please start the job creation again, selecting a different index pattern."})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutFooter"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{iconType:"cross",onClick:()=>setShowJsonFlyout(false),flush:"left"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.jsonFlyout.closeButton",defaultMessage:"Close"}))),readOnlyMode===false&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:onSave,fill:true,isDisabled:saveable===false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.jsonFlyout.saveButton",defaultMessage:"Save"})))))))};const json_editor_flyout_FlyoutButton=({isDisabled:isDisabled,onClick:onClick,editJsonMode:editJsonMode})=>{const previewJsonTitle=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.previewJsonButton",{defaultMessage:"Preview JSON"});const editJsonTitle=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.editJsonButton",{defaultMessage:"Edit JSON"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:onClick,isDisabled:isDisabled,"data-test-subj":"mlJobWizardButtonPreviewJobJson"},editJsonMode?editJsonTitle:previewJsonTitle)};const json_editor_flyout_Contents=({title:title,value:value,editJson:editJson,onChange:onChange,heightOffset:heightOffset=0})=>{const editorHeight=Object(external_kbnSharedDeps_React_["useMemo"])(()=>`${window.innerHeight-230-heightOffset}px`,[heightOffset]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h5",null,title)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(ml_job_editor["a"],{value:value,height:editorHeight,mode:ml_job_editor["b"].XJSON,readOnly:editJson===false,onChange:onChange}))};const PickFieldsStep=({setCurrentStep:setCurrentStep,isCurrentStep:isCurrentStep})=>{const{jobCreator:jobCreator,jobValidator:jobValidator,jobValidatorUpdated:jobValidatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const[nextActive,setNextActive]=Object(external_kbnSharedDeps_React_["useState"])(false);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setNextActive(jobValidator.isPickFieldsStepValid)},[jobValidatorUpdated]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,isCurrentStep&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,Object(job_creator["e"])(jobCreator)&&external_kbnSharedDeps_React_default.a.createElement(SingleMetricView,{isActive:isCurrentStep,setCanProceed:setNextActive}),Object(job_creator["c"])(jobCreator)&&external_kbnSharedDeps_React_default.a.createElement(MultiMetricView,{isActive:isCurrentStep,setCanProceed:setNextActive}),Object(job_creator["d"])(jobCreator)&&external_kbnSharedDeps_React_default.a.createElement(PopulationView,{isActive:isCurrentStep,setCanProceed:setNextActive}),Object(job_creator["a"])(jobCreator)&&external_kbnSharedDeps_React_default.a.createElement(AdvancedView,{isActive:isCurrentStep,setCanProceed:setNextActive}),Object(job_creator["b"])(jobCreator)&&external_kbnSharedDeps_React_default.a.createElement(CategorizationView,{isActive:isCurrentStep,setCanProceed:setNextActive}),external_kbnSharedDeps_React_default.a.createElement(WizardNav,{previous:()=>setCurrentStep(Object(job_creator["a"])(jobCreator)?WIZARD_STEPS.ADVANCED_CONFIGURE_DATAFEED:WIZARD_STEPS.TIME_RANGE),next:()=>setCurrentStep(WIZARD_STEPS.JOB_DETAILS),nextActive:nextActive},Object(job_creator["a"])(jobCreator)&&external_kbnSharedDeps_React_default.a.createElement(JsonEditorFlyout,{isDisabled:false,jobEditorMode:json_editor_flyout_EDITOR_MODE.EDITABLE,datafeedEditorMode:json_editor_flyout_EDITOR_MODE.EDITABLE}))))};const job_id_description_Description=Object(external_kbnSharedDeps_React_["memo"])(({children:children,validation:validation})=>{const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobDetailsStep.jobId.title",{defaultMessage:"Job ID"});const description=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobDetailsStep.jobId.description",{defaultMessage:'A unique identifier for the job. Spaces and the characters  / ? , " < > | * are not allowed'});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{title:external_kbnSharedDeps_React_default.a.createElement("h3",null,title),description:description},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:title,error:validation.message,isInvalid:validation.valid===false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children)))});const JobIdInput=()=>{const{jobCreator:jobCreator,jobCreatorUpdate:jobCreatorUpdate,jobValidator:jobValidator,jobValidatorUpdated:jobValidatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const[jobId,setJobId]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.jobId);const validation=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{var _jobValidator$latestV,_jobValidator$jobId$m,_jobValidator$latestV2;const isEmptyId=jobId==="";const valid=isEmptyId===true||jobValidator.jobId.valid===true&&((_jobValidator$latestV=jobValidator.latestValidationResult.jobIdExists)===null||_jobValidator$latestV===void 0?void 0:_jobValidator$latestV.valid)===true;const message=(_jobValidator$jobId$m=jobValidator.jobId.message)!==null&&_jobValidator$jobId$m!==void 0?_jobValidator$jobId$m:(_jobValidator$latestV2=jobValidator.latestValidationResult.jobIdExists)===null||_jobValidator$latestV2===void 0?void 0:_jobValidator$latestV2.message;return{valid:valid,message:message}},[jobValidatorUpdated]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{jobCreator.jobId=jobId;jobCreatorUpdate()},[jobId]);return external_kbnSharedDeps_React_default.a.createElement(job_id_description_Description,{validation:validation},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{value:jobId,onChange:e=>setJobId(e.target.value),isInvalid:validation.valid===false,"data-test-subj":"mlJobWizardInputJobId"}))};const job_description_description_Description=Object(external_kbnSharedDeps_React_["memo"])(({children:children})=>{const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobDetailsStep.jobDescription.title",{defaultMessage:"Job description"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{title:external_kbnSharedDeps_React_default.a.createElement("h3",null,title),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.jobDetailsStep.jobDescription.description",defaultMessage:"Optional descriptive text"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:title},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children)))});const JobDescriptionInput=()=>{const{jobCreator:jobCreator,jobCreatorUpdate:jobCreatorUpdate}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const[jobDescription,setJobDescription]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.description);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{jobCreator.description=jobDescription;jobCreatorUpdate()},[jobDescription]);return external_kbnSharedDeps_React_default.a.createElement(job_description_description_Description,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTextArea"],{value:jobDescription,onChange:e=>setJobDescription(e.target.value),"data-test-subj":"mlJobWizardInputJobDescription"}))};const GroupsInput=()=>{const{jobCreator:jobCreator,jobCreatorUpdate:jobCreatorUpdate,jobValidator:jobValidator,jobValidatorUpdated:jobValidatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const{existingJobsAndGroups:existingJobsAndGroups}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const[selectedGroups,setSelectedGroups]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.groups);const validation=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{var _jobValidator$latestV,_jobValidator$groupId,_jobValidator$latestV2;const valid=jobValidator.groupIds.valid===true&&((_jobValidator$latestV=jobValidator.latestValidationResult.groupIdsExist)===null||_jobValidator$latestV===void 0?void 0:_jobValidator$latestV.valid)===true;const message=(_jobValidator$groupId=jobValidator.groupIds.message)!==null&&_jobValidator$groupId!==void 0?_jobValidator$groupId:(_jobValidator$latestV2=jobValidator.latestValidationResult.groupIdsExist)===null||_jobValidator$latestV2===void 0?void 0:_jobValidator$latestV2.message;return{valid:valid,message:message}},[jobValidatorUpdated]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{jobCreator.groups=selectedGroups;jobCreatorUpdate()},[selectedGroups.join()]);const options=existingJobsAndGroups.groupIds.map(g=>({label:g,color:Object(group_color_utils["a"])(g)}));const selectedOptions=selectedGroups.map(g=>({label:g,color:Object(group_color_utils["a"])(g)}));function onChange(optionsIn){setSelectedGroups(optionsIn.map(g=>g.label))}function onCreateGroup(input,flattenedOptions){const normalizedSearchValue=input.trim().toLowerCase();if(!normalizedSearchValue){return}const newGroup={label:input,color:Object(group_color_utils["a"])(input)};if(flattenedOptions.findIndex(option=>option.label.trim().toLowerCase()===normalizedSearchValue)===-1){options.push(newGroup)}setSelectedGroups([...selectedOptions,newGroup].map(g=>g.label))}return external_kbnSharedDeps_React_default.a.createElement(Description,{validation:validation},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{placeholder:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobDetailsStep.jobGroupSelect.placeholder",{defaultMessage:"Select or create groups"}),options:options,selectedOptions:selectedOptions,onChange:onChange,onCreateOption:onCreateGroup,isClearable:true,isInvalid:validation.valid===false,"data-test-subj":"mlJobWizardComboBoxJobGroups"}))};const model_plot_description_Description=Object(external_kbnSharedDeps_React_["memo"])(({children:children})=>{const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.enableModelPlot.title",{defaultMessage:"Enable model plot"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{title:external_kbnSharedDeps_React_default.a.createElement("h3",null,title),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.enableModelPlot.description",defaultMessage:"Select to store additional model information used for plotting model bounds. This will add overhead to the performance of the system and is not recommended for high cardinality data."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:title},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children)))});const MMLCallout=()=>{const{jobCreator:jobCreator,jobValidator:jobValidator,jobValidatorUpdated:jobValidatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const[highCardinality,setHighCardinality]=Object(external_kbnSharedDeps_React_["useState"])(null);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{var _jobValidator$latestV,_jobValidator$latestV2,_jobValidator$latestV3;const value=(_jobValidator$latestV=(_jobValidator$latestV2=jobValidator.latestValidationResult)===null||_jobValidator$latestV2===void 0?void 0:(_jobValidator$latestV3=_jobValidator$latestV2.highCardinality)===null||_jobValidator$latestV3===void 0?void 0:_jobValidator$latestV3.value)!==null&&_jobValidator$latestV!==void 0?_jobValidator$latestV:null;setHighCardinality(value)},[jobValidatorUpdated]);return jobCreator.modelPlot&&highCardinality!==null?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.mmlWarning.title",defaultMessage:"Proceed with caution!"}),color:"warning",iconType:"help"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.mmlWarning.message",defaultMessage:"Creating model plots is resource intensive and not recommended where the cardinality of the selected fields is greater than 100. Estimated cardinality for this job is {highCardinality}. If you enable model plot with this configuration we recommend you use a dedicated results index.",values:{highCardinality:highCardinality}}))):null};const ModelPlotSwitch=()=>{const{jobCreator:jobCreator,jobCreatorUpdate:jobCreatorUpdate,jobCreatorUpdated:jobCreatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const[modelPlotEnabled,setModelPlotEnabled]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.modelPlot);const[enabled,setEnabled]=Object(external_kbnSharedDeps_React_["useState"])(false);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{jobCreator.modelPlot=modelPlotEnabled;jobCreatorUpdate()},[modelPlotEnabled]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const aggs=[aggregation_types["b"].RARE];const isRareCategoryJob=Object(job_creator["b"])(jobCreator)&&jobCreator.aggregations.some(agg=>aggs.includes(agg.id));setEnabled(isRareCategoryJob===false)},[jobCreatorUpdated]);function toggleModelPlot(){setModelPlotEnabled(!modelPlotEnabled)}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(model_plot_description_Description,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{name:"switch",disabled:enabled===false,checked:modelPlotEnabled,onChange:toggleModelPlot,"data-test-subj":"mlJobWizardSwitchModelPlot",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.enableModelPlot.title",{defaultMessage:"Enable model plot"})})),external_kbnSharedDeps_React_default.a.createElement(MMLCallout,null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null))};const annotations_description_Description=Object(external_kbnSharedDeps_React_["memo"])(({children:children})=>{const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.enableModelPlotAnnotations.title",{defaultMessage:"Enable model change annotations"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{title:external_kbnSharedDeps_React_default.a.createElement("h3",null,title),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.enableModelPlotAnnotations.description",defaultMessage:"Select to generate annotations when the model changes significantly. For example, when step changes, periodicity or trends are detected."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:title},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children)))});const AnnotationsSwitch=()=>{const{jobCreator:jobCreator,jobCreatorUpdate:jobCreatorUpdate,jobCreatorUpdated:jobCreatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const[annotationsEnabled,setAnnotationsEnabled]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.modelChangeAnnotations);const[showCallOut,setShowCallout]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.modelPlot&&!jobCreator.modelChangeAnnotations);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{jobCreator.modelChangeAnnotations=annotationsEnabled;jobCreatorUpdate()},[annotationsEnabled]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setShowCallout(jobCreator.modelPlot&&!annotationsEnabled)},[jobCreatorUpdated,annotationsEnabled]);function toggleAnnotations(){setAnnotationsEnabled(!annotationsEnabled)}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(annotations_description_Description,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{name:"switch",checked:annotationsEnabled,onChange:toggleAnnotations,"data-test-subj":"mlJobWizardSwitchAnnotations",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.enableModelPlotAnnotations.title",{defaultMessage:"Enable model change annotations"})})),showCallOut&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.annotationsSwitchCallout.title",defaultMessage:"If you enable model plot with this configuration, we recommend you also enable annotations."}),color:"primary",iconType:"help"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null))};const dedicated_index_description_Description=Object(external_kbnSharedDeps_React_["memo"])(({children:children})=>{const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.useDedicatedIndex.title",{defaultMessage:"Use dedicated index"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{title:external_kbnSharedDeps_React_default.a.createElement("h3",null,title),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.useDedicatedIndex.description",defaultMessage:"Store results in a separate index for this job."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:title},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children)))});const DedicatedIndexSwitch=()=>{const{jobCreator:jobCreator,jobCreatorUpdate:jobCreatorUpdate}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const[useDedicatedIndex,setUseDedicatedIndex]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.useDedicatedIndex);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{jobCreator.useDedicatedIndex=useDedicatedIndex;jobCreatorUpdate()},[useDedicatedIndex]);function toggleModelPlot(){setUseDedicatedIndex(!useDedicatedIndex)}return external_kbnSharedDeps_React_default.a.createElement(dedicated_index_description_Description,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{name:"switch",checked:useDedicatedIndex,onChange:toggleModelPlot,"data-test-subj":"mlJobWizardSwitchUseDedicatedIndex",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobDetailsStep.advancedSection.useDedicatedIndex.title",{defaultMessage:"Use dedicated index"})}))};const buttonContent=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobDetailsStep.advancedSectionButton",{defaultMessage:"Advanced"});const AdvancedSection=({advancedExpanded:advancedExpanded,setAdvancedExpanded:setAdvancedExpanded})=>{const{jobCreator:jobCreator}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);if(jobCreator.type===new_job["f"].ADVANCED){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"xl"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xl"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(ModelPlotSwitch,null),external_kbnSharedDeps_React_default.a.createElement(AnnotationsSwitch,null)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(DedicatedIndexSwitch,null))))}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xl"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiAccordion"],{id:"advanced-section",buttonContent:buttonContent,onToggle:setAdvancedExpanded,initialIsOpen:advancedExpanded,"data-test-subj":"mlJobWizardToggleAdvancedSection"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xl",style:{marginLeft:"0px",marginRight:"0px"},"data-test-subj":"mlJobWizardAdvancedSection"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(ModelPlotSwitch,null),external_kbnSharedDeps_React_default.a.createElement(AnnotationsSwitch,null),external_kbnSharedDeps_React_default.a.createElement(ModelMemoryLimitInput,null)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(DedicatedIndexSwitch,null)))))};const calendars_description_Description=Object(external_kbnSharedDeps_React_["memo"])(({children:children})=>{const{services:{docLinks:docLinks}}=Object(contexts_kibana["b"])();const docsUrl=docLinks.links.ml.calendars;const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobDetailsStep.additionalSection.calendarsSelection.title",{defaultMessage:"Calendars"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{title:external_kbnSharedDeps_React_default.a.createElement("h3",null,title),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.jobDetailsStep.additionalSection.calendarsSelection.description",defaultMessage:"Contains a list of scheduled events that you want to ignore, such as planned system outages or public holidays. {learnMoreLink}",values:{learnMoreLink:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{href:docsUrl,target:"_blank"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.jobDetailsStep.additionalSection.calendarsSelection.learnMoreLinkText",defaultMessage:"Learn more"}))}})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children)))});var app=__webpack_require__(4);const GLOBAL_CALENDAR="_all";function calendars_selection_extends(){calendars_selection_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return calendars_selection_extends.apply(this,arguments)}const CalendarsSelection=()=>{const{services:{application:{getUrlForApp:getUrlForApp}}}=Object(contexts_kibana["b"])();const{jobCreator:jobCreator,jobCreatorUpdate:jobCreatorUpdate}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const[selectedCalendars,setSelectedCalendars]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.calendars);const[selectedOptions,setSelectedOptions]=Object(external_kbnSharedDeps_React_["useState"])([]);const[options,setOptions]=Object(external_kbnSharedDeps_React_["useState"])([]);const[isLoading,setIsLoading]=Object(external_kbnSharedDeps_React_["useState"])(false);async function loadCalendars(){setIsLoading(true);const calendars=(await ml_api_service["ml"].calendars()).filter(c=>c.job_ids.includes(GLOBAL_CALENDAR)===false);setOptions(calendars.map(c=>({label:c.calendar_id,value:c})));setSelectedOptions(selectedCalendars.map(c=>({label:c.calendar_id,value:c})));setIsLoading(false)}Object(external_kbnSharedDeps_React_["useEffect"])(()=>{loadCalendars()},[]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{jobCreator.calendars=selectedCalendars;jobCreatorUpdate()},[selectedCalendars.join()]);const comboBoxProps={async:true,options:options,selectedOptions:selectedOptions,isLoading:isLoading,onChange:optionsIn=>{setSelectedOptions(optionsIn);setSelectedCalendars(optionsIn.map(o=>o.value))}};const manageCalendarsHref=getUrlForApp(app["d"],{path:ml_url_generator["b"].CALENDARS_MANAGE});return external_kbnSharedDeps_React_default.a.createElement(calendars_description_Description,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xs",alignItems:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],calendars_selection_extends({},comboBoxProps,{"data-test-subj":"mlJobWizardComboBoxCalendars"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{position:"right",content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.jobDetailsStep.additionalSection.calendarsSelection.refreshCalendarsButtonLabel",defaultMessage:"Refresh calendars"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{iconType:"refresh",color:"primary","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobDetailsStep.additionalSection.calendarsSelection.refreshCalendarsButtonLabel",{defaultMessage:"Refresh calendars"}),onClick:loadCalendars})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xs"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{href:manageCalendarsHref,target:"_blank",external:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.jobDetailsStep.additionalSection.calendarsSelection.manageCalendarsButtonLabel",defaultMessage:"Manage calendars"}))))};var custom_urls=__webpack_require__(262);const custom_urls_description_Description=Object(external_kbnSharedDeps_React_["memo"])(({children:children})=>{const{services:{docLinks:docLinks}}=Object(contexts_kibana["b"])();const docsUrl=docLinks.links.ml.customUrls;const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobDetailsStep.additionalSection.customUrls.title",{defaultMessage:"Custom URLs"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{fullWidth:true,className:"ml-custom-urls-selection",title:external_kbnSharedDeps_React_default.a.createElement("h3",null,title),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.jobDetailsStep.additionalSection.customUrlsSelection.description",defaultMessage:"Provide links from anomalies to Kibana dashboards, the Discovery page, or other web pages. {learnMoreLink}",values:{learnMoreLink:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{href:docsUrl,target:"_blank"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.jobDetailsStep.additionalSection.customUrlsSelection.learnMoreLinkText",defaultMessage:"Learn more"}))}})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children)))});const CustomUrlsSelection=()=>{var _jobCreator$customUrl;const{jobCreator:jobCreator,jobCreatorUpdate:jobCreatorUpdate}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const setCustomUrls=customUrls=>{jobCreator.customUrls=customUrls;jobCreatorUpdate()};const combinedJob={...jobCreator.jobConfig,datafeed_config:jobCreator.datafeedConfig};return external_kbnSharedDeps_React_default.a.createElement(custom_urls_description_Description,null,external_kbnSharedDeps_React_default.a.createElement(custom_urls["a"],{job:combinedJob,jobCustomUrls:(_jobCreator$customUrl=jobCreator.customUrls)!==null&&_jobCreator$customUrl!==void 0?_jobCreator$customUrl:[],setCustomUrls:setCustomUrls,editMode:"modal"}))};const additional_section_buttonContent=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.jobDetailsStep.additionalSectionButton",{defaultMessage:"Additional settings"});const AdditionalSection=({additionalExpanded:additionalExpanded,setAdditionalExpanded:setAdditionalExpanded})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiAccordion"],{id:"additional-section",buttonContent:additional_section_buttonContent,onToggle:setAdditionalExpanded,initialIsOpen:additionalExpanded,"data-test-subj":"mlJobWizardToggleAdditionalSettingsSection"},external_kbnSharedDeps_React_default.a.createElement("section",{"data-test-subj":"mlJobWizardAdditionalSettingsSection"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xl",style:{marginLeft:"0px",marginRight:"0px"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(CustomUrlsSelection,null))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xl",style:{marginLeft:"0px",marginRight:"0px"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(CalendarsSelection,null)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null)))));const JobDetailsStep=({setCurrentStep:setCurrentStep,isCurrentStep:isCurrentStep,advancedExpanded:advancedExpanded,setAdvancedExpanded:setAdvancedExpanded,additionalExpanded:additionalExpanded,setAdditionalExpanded:setAdditionalExpanded})=>{const{jobCreator:jobCreator,jobValidator:jobValidator,jobValidatorUpdated:jobValidatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const[nextActive,setNextActive]=Object(external_kbnSharedDeps_React_["useState"])(false);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{var _jobValidator$latestV,_jobValidator$latestV2;const active=jobValidator.jobId.valid&&jobValidator.modelMemoryLimit.valid&&jobValidator.groupIds.valid&&((_jobValidator$latestV=jobValidator.latestValidationResult.jobIdExists)===null||_jobValidator$latestV===void 0?void 0:_jobValidator$latestV.valid)===true&&((_jobValidator$latestV2=jobValidator.latestValidationResult.groupIdsExist)===null||_jobValidator$latestV2===void 0?void 0:_jobValidator$latestV2.valid)===true&&jobValidator.validating===false;setNextActive(active)},[jobValidatorUpdated]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,isCurrentStep&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xl"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(JobIdInput,null),external_kbnSharedDeps_React_default.a.createElement(GroupsInput,null)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(JobDescriptionInput,null))),external_kbnSharedDeps_React_default.a.createElement(AdditionalSection,{additionalExpanded:additionalExpanded,setAdditionalExpanded:setAdditionalExpanded}),external_kbnSharedDeps_React_default.a.createElement(AdvancedSection,{advancedExpanded:advancedExpanded,setAdvancedExpanded:setAdvancedExpanded}),external_kbnSharedDeps_React_default.a.createElement(WizardNav,{previous:()=>setCurrentStep(WIZARD_STEPS.PICK_FIELDS),next:()=>setCurrentStep(WIZARD_STEPS.VALIDATION),nextActive:nextActive},Object(job_creator["a"])(jobCreator)&&external_kbnSharedDeps_React_default.a.createElement(JsonEditorFlyout,{isDisabled:false,jobEditorMode:json_editor_flyout_EDITOR_MODE.EDITABLE,datafeedEditorMode:json_editor_flyout_EDITOR_MODE.EDITABLE}))))};var prop_types=__webpack_require__(122);var prop_types_default=__webpack_require__.n(prop_types);var constants_validation=__webpack_require__(23);function validate_job_view_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const defaultIconType="questionInCircle";const getDefaultState=()=>({ui:{iconType:defaultIconType,isLoading:true,isModalVisible:false},data:{messages:[],success:false},title:""});const statusToEuiColor=status=>{switch(status){case constants_validation["c"].INFO:return"primary";break;case constants_validation["c"].ERROR:return"danger";break;default:return status}};const statusToEuiIconType=status=>{switch(status){case constants_validation["c"].INFO:return"iInCircle";break;case constants_validation["c"].ERROR:return"cross";break;case constants_validation["c"].SUCCESS:return"check";break;case constants_validation["c"].WARNING:return"alert";break;default:return status}};const Link=({url:url})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{href:url,target:"_BLANK"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.validateJob.learnMoreLinkText",defaultMessage:"Learn more"}));const Message=({message:message})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,message.text," ",message.url&&external_kbnSharedDeps_React_default.a.createElement(Link,{url:message.url}));const MessageList=({messages:messages,idFilterList:idFilterList})=>{const callouts=messages.filter(m=>idFilterList.includes(m.id)===false).map((m,i)=>external_kbnSharedDeps_React_default.a.createElement(Callout,{key:`${m.id}_${i}`,message:m}));const allPassedCallout=external_kbnSharedDeps_React_default.a.createElement(Callout,{message:{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.validateJob.allPassed",{defaultMessage:"All validation checks passed successfully"}),status:constants_validation["c"].SUCCESS}});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,callouts.length?callouts:allPassedCallout)};const Callout=({message:message})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{color:statusToEuiColor(message.status),size:"s",title:message.heading||external_kbnSharedDeps_React_default.a.createElement(Message,{message:message}),iconType:statusToEuiIconType(message.status)},message.heading&&external_kbnSharedDeps_React_default.a.createElement(Message,{message:message})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}));const LoadingSpinner=()=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceAround",alignItems:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLoadingSpinner"],{size:"xl"})));const Modal=({close:close,title:title,children:children})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModal"],{onClose:close,style:{width:"800px"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalHeaderTitle"],null,title)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalBody"],null,children),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalFooter"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:close,size:"s",fill:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.validateJob.modal.closeButtonLabel",defaultMessage:"Close"}))));Modal.propType={close:prop_types_default.a.func.isRequired,title:prop_types_default.a.string};class validate_job_view_ValidateJobUI extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);validate_job_view_defineProperty(this,"closeModal",()=>{const newState=getDefaultState();newState.ui.iconType=this.state.ui.iconType;this.setState(newState)});validate_job_view_defineProperty(this,"validate",()=>{const job=this.props.getJobConfig();const getDuration=this.props.getDuration;const duration=typeof getDuration==="function"?getDuration():undefined;const fields=this.props.fields;if(typeof job==="object"){if(typeof duration==="object"&&duration.start!==null&&duration.end!==null){let shouldShowLoadingIndicator=true;this.props.ml.validateJob({duration:duration,fields:fields,job:job}).then(messages=>{shouldShowLoadingIndicator=false;const messagesContainError=messages.some(m=>m.status===constants_validation["c"].ERROR);if(messagesContainError){messages.push({id:"job_validation_includes_error",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.validateJob.jobValidationIncludesErrorText",{defaultMessage:"Job validation has failed, but you can still continue and create the job. Please be aware the job may encounter problems when running."}),status:constants_validation["c"].WARNING})}this.setState({...this.state,ui:{...this.state.ui,iconType:statusToEuiIconType(Object(validation_utils["b"])(messages)),isLoading:false,isModalVisible:true},data:{messages:messages,success:true},title:job.job_id});if(typeof this.props.setIsValid==="function"){this.props.setIsValid(!messagesContainError)}}).catch(error=>{const{toasts:toasts}=this.props.kibana.services.notifications;const toastNotificationService=Object(toast_notification_service["b"])(toasts);toastNotificationService.displayErrorToast(error,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobService.validateJobErrorTitle",{defaultMessage:"Job Validation Error"}))});const delay=250;setTimeout(()=>{if(shouldShowLoadingIndicator){this.setState({...this.state,ui:{...this.state.ui,isLoading:true,isModalVisible:false}})}},delay)}else{this.setState({...this.state,ui:{...this.state.ui,iconType:statusToEuiIconType(constants_validation["c"].WARNING),isLoading:false,isModalVisible:true},data:{messages:[{id:"job_validation_skipped",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.validateJob.jobValidationSkippedText",{defaultMessage:"Job validation could not be run because of insufficient sample data. Please be aware the job may encounter problems when running."}),status:constants_validation["c"].WARNING}],success:true},title:job.job_id});if(typeof this.props.setIsValid==="function"){this.props.setIsValid(true)}}}});this.state=getDefaultState()}componentDidMount(){if(this.props.embedded===true){this.validate()}}render(){const jobTipsUrl=Object(dependency_cache["b"])().links.ml.anomalyDetectionJobTips;const fill=this.props.fill===false?false:true;const isCurrentJobConfig=this.props.isCurrentJobConfig!==true?false:true;const isDisabled=this.props.isDisabled!==true?false:true;const embedded=this.props.embedded===true;const idFilterList=this.props.idFilterList||[];const isLoading=this.state.ui.isLoading;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,embedded===false?external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:this.validate,size:"s",fill:fill,iconType:isCurrentJobConfig?this.state.ui.iconType:defaultIconType,iconSide:"right",isDisabled:isDisabled,isLoading:isLoading},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.validateJob.validateJobButtonLabel",defaultMessage:"Validate Job"})),!isDisabled&&this.state.ui.isModalVisible&&external_kbnSharedDeps_React_default.a.createElement(Modal,{close:this.closeModal,title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.validateJob.modal.validateJobTitle",defaultMessage:"Validate job {title}",values:{title:this.state.title}})},isLoading?external_kbnSharedDeps_React_default.a.createElement(LoadingSpinner,null):external_kbnSharedDeps_React_default.a.createElement(MessageList,{messages:this.state.data.messages,idFilterList:idFilterList}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.validateJob.modal.jobValidationDescriptionText",defaultMessage:"Job validation performs certain checks against job configurations and underlying source data and provides specific advice on how to adjust settings that are more likely to produce insightful results."})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.validateJob.modal.linkToJobTipsText",defaultMessage:"For more information, see {mlJobTipsLink}.",values:{mlJobTipsLink:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{href:jobTipsUrl,target:"_blank"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.validateJob.modal.linkToJobTipsText.mlJobTipsLinkText",defaultMessage:"Machine Learning Job Tips"}))}})))):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,isLoading?external_kbnSharedDeps_React_default.a.createElement(LoadingSpinner,null):external_kbnSharedDeps_React_default.a.createElement(MessageList,{messages:this.state.data.messages,idFilterList:idFilterList})))}}const ValidateJob=Object(kibanaReact_public_["withKibana"])(validate_job_view_ValidateJobUI);const validation_idFilterList=["job_id_valid","job_group_id_valid","detectors_function_not_empty","success_bucket_span"];const ValidationStep=({setCurrentStep:setCurrentStep,isCurrentStep:isCurrentStep})=>{const{jobCreator:jobCreator,jobCreatorUpdate:jobCreatorUpdate,jobValidator:jobValidator}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);if(jobCreator.type===new_job["f"].ADVANCED){validation_idFilterList.push(...["time_range_short","success_time_range"])}function getJobConfig(){return{...jobCreator.jobConfig,datafeed_config:jobCreator.datafeedConfig}}function getDuration(){return{start:jobCreator.start,end:jobCreator.end}}Object(external_kbnSharedDeps_React_["useEffect"])(()=>{jobValidator.validate(()=>{},true);jobCreatorUpdate()},[]);function setIsValid(valid){jobValidator.advancedValid=valid}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,isCurrentStep&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(ValidateJob,{getJobConfig:getJobConfig,getDuration:getDuration,ml:ml_api_service["ml"],embedded:true,setIsValid:setIsValid,idFilterList:validation_idFilterList}),external_kbnSharedDeps_React_default.a.createElement(WizardNav,{previous:()=>setCurrentStep(WIZARD_STEPS.JOB_DETAILS),next:()=>setCurrentStep(WIZARD_STEPS.SUMMARY),nextActive:true})),isCurrentStep===false&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null))};const trueLabel=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.summaryStep.trueLabel",{defaultMessage:"True"});const falseLabel=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.summaryStep.falseLabel",{defaultMessage:"False"});const defaultLabel=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.summaryStep.defaultString",{defaultMessage:"default"});const JobSectionTitle=()=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h3",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.summaryStep.jobConfig.title",defaultMessage:"Job configuration"})));const DatafeedSectionTitle=()=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h3",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.summaryStep.datafeedConfig.title",defaultMessage:"Datafeed configuration"})));const Italic=({children:children})=>external_kbnSharedDeps_React_default.a.createElement("span",{style:{fontStyle:"italic"}},children);const JobDetails=()=>{const{jobCreator:jobCreator}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const mlContext=Object(ml["b"])();const dateFormat=mlContext.kibanaConfig.get("dateFormat");const{anomaly_detectors:anomalyDetectors}=Object(ml_server_info["b"])();const isAdvanced=Object(job_creator["a"])(jobCreator);const modelMemoryLimitDefault=anomalyDetectors.model_memory_limit||"";const modelMemoryLimit=jobCreator.modelMemoryLimit!==null?jobCreator.modelMemoryLimit:external_kbnSharedDeps_React_default.a.createElement(Italic,null,`${modelMemoryLimitDefault} (${defaultLabel})`);const jobDetails=[{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.jobDetails.title",{defaultMessage:"Job ID"}),description:jobCreator.jobId},{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.jobDescription.title",{defaultMessage:"Job description"}),description:jobCreator.description.length>0?jobCreator.description:external_kbnSharedDeps_React_default.a.createElement(Italic,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.summaryStep.jobDetails.jobDescription.placeholder",defaultMessage:"No description provided"}))},{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.groups.title",{defaultMessage:"Groups"}),description:jobCreator.groups.length>0?jobCreator.groups.join(", "):external_kbnSharedDeps_React_default.a.createElement(Italic,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.summaryStep.jobDetails.groups.placeholder",defaultMessage:"No groups selected"}))}];const detectorDetails=[{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.bucketSpan.title",{defaultMessage:"Bucket span"}),description:jobCreator.bucketSpan}];if(Object(job_creator["c"])(jobCreator)){detectorDetails.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.splitField.title",{defaultMessage:"Split field"}),description:Object(job_creator["c"])(jobCreator)&&jobCreator.splitField!==null?jobCreator.splitField.name:external_kbnSharedDeps_React_default.a.createElement(Italic,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.summaryStep.jobDetails.splitField.placeholder",defaultMessage:"No split field selected"}))})}if(Object(job_creator["d"])(jobCreator)){detectorDetails.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.populationField.title",{defaultMessage:"Population field"}),description:Object(job_creator["d"])(jobCreator)&&jobCreator.splitField!==null?jobCreator.splitField.name:external_kbnSharedDeps_React_default.a.createElement("span",{style:{fontStyle:jobCreator.splitField!==null?"inherit":"italic"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.summaryStep.jobDetails.populationField.placeholder",defaultMessage:"No population field selected"}))})}if(isAdvanced&&jobCreator.categorizationFieldName!==null){detectorDetails.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.categorizationField.title",{defaultMessage:"Categorization field"}),description:jobCreator.categorizationFieldName})}if(isAdvanced&&jobCreator.summaryCountFieldName!==null){detectorDetails.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.summaryCountField.title",{defaultMessage:"Summary count field"}),description:jobCreator.summaryCountFieldName})}detectorDetails.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.influencers.title",{defaultMessage:"Influencers"}),description:jobCreator.influencers.length>0?jobCreator.influencers.join(", "):external_kbnSharedDeps_React_default.a.createElement(Italic,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.summaryStep.jobDetails.influencers.placeholder",defaultMessage:"No influencers selected"}))});const advancedDetails=[{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.enableModelPlot.title",{defaultMessage:"Enable model plot"}),description:jobCreator.modelPlot?trueLabel:falseLabel},{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.useDedicatedIndex.title",{defaultMessage:"Use dedicated index"}),description:jobCreator.useDedicatedIndex?trueLabel:falseLabel},{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.summaryStep.jobDetails.modelMemoryLimit.title",{defaultMessage:"Model memory limit"}),description:modelMemoryLimit}];const timeRangeDetails=[{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.summaryStep.timeRange.start.title",{defaultMessage:"Start"}),description:external_kbnSharedDeps_Moment_default()(jobCreator.start).format(dateFormat)},{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.summaryStep.timeRange.end.title",{defaultMessage:"End"}),description:external_kbnSharedDeps_Moment_default()(jobCreator.end).format(dateFormat)}];return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{compressed:true,listItems:jobDetails})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{compressed:true,listItems:detectorDetails})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{compressed:true,listItems:advancedDetails})),isAdvanced===false&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{compressed:true,listItems:timeRangeDetails})))};const datafeed_details_EDITOR_HEIGHT="200px";const DatafeedDetails=()=>{const{jobCreator:jobCreator}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const{datafeeds:datafeeds}=Object(ml_server_info["b"])();const queryString=JSON.stringify(jobCreator.query,null,2);const defaultFrequency=Object(job_utils["f"])(jobCreator.bucketSpanMs/1e3);const scrollSizeDefault=datafeeds.scroll_size||"";const queryDelay=jobCreator.queryDelay||external_kbnSharedDeps_React_default.a.createElement(Italic,null,`${new_job["d"]} (${defaultLabel})`);const frequency=jobCreator.frequency||external_kbnSharedDeps_React_default.a.createElement(Italic,null,`${defaultFrequency}s (${defaultLabel})`);const scrollSize=jobCreator.scrollSize!==null?`${jobCreator.scrollSize}`:external_kbnSharedDeps_React_default.a.createElement(Italic,null,`${scrollSizeDefault} (${defaultLabel})`);const datafeedDetails=[{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.summaryStep.datafeedDetails.timeField.title",{defaultMessage:"Time field"}),description:jobCreator.timeFieldName},{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.summaryStep.datafeedDetails.queryDelay.title",{defaultMessage:"Query delay"}),description:queryDelay},{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.summaryStep.datafeedDetails.frequency.title",{defaultMessage:"Frequency"}),description:frequency},{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.summaryStep.datafeedDetails.scrollSize.title",{defaultMessage:"Scroll size"}),description:scrollSize}];const queryTitle=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.summaryStep.datafeedDetails.query.title",{defaultMessage:"Elasticsearch query"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:queryTitle,fullWidth:true},external_kbnSharedDeps_React_default.a.createElement(ml_job_editor["a"],{value:queryString,height:datafeed_details_EDITOR_HEIGHT,readOnly:true}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{compressed:true,listItems:datafeedDetails})))};const DetectorChart=()=>{const{jobCreator:jobCreator}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,jobCreator.type===new_job["f"].SINGLE_METRIC&&external_kbnSharedDeps_React_default.a.createElement(SingleMetricView,{isActive:false}),jobCreator.type===new_job["f"].MULTI_METRIC&&external_kbnSharedDeps_React_default.a.createElement(MultiMetricView,{isActive:false}),jobCreator.type===new_job["f"].POPULATION&&external_kbnSharedDeps_React_default.a.createElement(PopulationView,{isActive:false}),jobCreator.type===new_job["f"].ADVANCED&&external_kbnSharedDeps_React_default.a.createElement(AdvancedView,{isActive:false}),jobCreator.type===new_job["f"].CATEGORIZATION&&external_kbnSharedDeps_React_default.a.createElement(CategorizationView,{isActive:false}))};const JobProgress=({progress:progress})=>{if(progress>0&&progress<100){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiProgress"],{value:progress,color:"primary",size:"xs",max:100})}else{return null}};var states=__webpack_require__(101);var ml_alerting_flyout=__webpack_require__(299);const PostSaveOptions=({jobRunner:jobRunner})=>{const{services:{notifications:notifications}}=Object(contexts_kibana["b"])();const{jobCreator:jobCreator}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const[datafeedState,setDatafeedState]=Object(external_kbnSharedDeps_React_["useState"])(states["a"].STOPPED);const[alertFlyoutVisible,setAlertFlyoutVisible]=Object(external_kbnSharedDeps_React_["useState"])(false);async function startJobInRealTime(){const{toasts:toasts}=notifications;setDatafeedState(states["a"].STARTING);if(jobRunner!==null){try{const started=await jobRunner.startDatafeedInRealTime(true);setDatafeedState(started===true?states["a"].STARTED:states["a"].STOPPED);toasts.addSuccess({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.summaryStep.postSaveOptions.startJobInRealTimeSuccess",{defaultMessage:`Job {jobId} started`,values:{jobId:jobCreator.jobId}})})}catch(error){setDatafeedState(states["a"].STOPPED);toasts.addDanger({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.summaryStep.postSaveOptions.startJobInRealTimeError",{defaultMessage:`Error starting job`}),text:Object(util_errors["i"])(error)})}}}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{isDisabled:datafeedState===states["a"].STARTING||datafeedState===states["a"].STARTED,onClick:startJobInRealTime,"data-test-subj":"mlJobWizardButtonRunInRealTime"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.summaryStep.postSaveOptions.startJobInRealTime",defaultMessage:"Start job running in real time"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{isDisabled:datafeedState===states["a"].STOPPED||datafeedState===states["a"].STARTING,onClick:setAlertFlyoutVisible.bind(null,true),"data-test-subj":"mlJobWizardButtonCreateAlert"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.summaryStep.postSaveOptions.createAlert",defaultMessage:"Create alert"}))),datafeedState===states["a"].STARTED&&alertFlyoutVisible&&external_kbnSharedDeps_React_default.a.createElement(ml_alerting_flyout["b"],{jobIds:[jobCreator.jobId],onCloseFlyout:setAlertFlyoutVisible.bind(null,false)}))};const StartDatafeedSwitch=({startDatafeed:startDatafeed,setStartDatafeed:setStartDatafeed,disabled:disabled=false})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.summaryStep.startDatafeedCheckboxHelpText",{defaultMessage:"If unselected, job can be started later from the jobs list."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{"data-test-subj":"mlJobWizardStartDatafeedCheckbox",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.summaryStep.startDatafeedCheckbox",{defaultMessage:"Start immediately"}),checked:startDatafeed,onChange:e=>setStartDatafeed(e.target.checked),disabled:disabled})));var jobs_awaiting_node_warning=__webpack_require__(153);const SummaryStep=({setCurrentStep:setCurrentStep,isCurrentStep:isCurrentStep})=>{const{services:{notifications:notifications,http:{basePath:basePath}}}=Object(contexts_kibana["b"])();const navigateToPath=Object(contexts_kibana["e"])();const{jobCreator:jobCreator,jobValidator:jobValidator,jobValidatorUpdated:jobValidatorUpdated,resultsLoader:resultsLoader}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const[progress,setProgress]=Object(external_kbnSharedDeps_React_["useState"])(resultsLoader.progress);const[creatingJob,setCreatingJob]=Object(external_kbnSharedDeps_React_["useState"])(false);const[isValid,setIsValid]=Object(external_kbnSharedDeps_React_["useState"])(jobValidator.validationSummary.basic);const[jobRunner,setJobRunner]=Object(external_kbnSharedDeps_React_["useState"])(null);const[startDatafeed,setStartDatafeed]=Object(external_kbnSharedDeps_React_["useState"])(true);const[showJobAssignWarning,setShowJobAssignWarning]=Object(external_kbnSharedDeps_React_["useState"])(false);const isAdvanced=Object(job_creator["a"])(jobCreator);const jsonEditorMode=isAdvanced?json_editor_flyout_EDITOR_MODE.EDITABLE:json_editor_flyout_EDITOR_MODE.READONLY;Object(external_kbnSharedDeps_React_["useEffect"])(()=>{jobCreator.subscribeToProgress(setProgress)},[]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{let s=null;if(jobRunner!==null){s=jobRunner.subscribeToJobAssignment(assigned=>setShowJobAssignWarning(!assigned))}return()=>{if(s!==null){var _s;(_s=s)===null||_s===void 0?void 0:_s.unsubscribe()}}},[jobRunner]);async function start(){setCreatingJob(true);if(isAdvanced){await createAdvancedJob()}else if(startDatafeed===true){await createAndStartJob()}else{await createAdvancedJob(false)}}async function createAndStartJob(){try{const jr=await jobCreator.createAndStartJob();setJobRunner(jr)}catch(error){handleJobCreationError(error)}}async function createAdvancedJob(showStartModal=true){try{await jobCreator.createJob();await jobCreator.createDatafeed();Object(general["a"])(showStartModal?jobCreator:null,navigateToPath)}catch(error){handleJobCreationError(error)}}function handleJobCreationError(error){const{displayErrorToast:displayErrorToast}=Object(toast_notification_service["b"])(notifications.toasts);displayErrorToast(error,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.summaryStep.createJobError",{defaultMessage:`Job creation error`}));setCreatingJob(false)}function viewResults(){const url=job_service["a"].createResultsUrl([jobCreator.jobId],jobCreator.start,jobCreator.end,Object(job_creator["e"])(jobCreator)===true?"timeseriesexplorer":"explorer");navigateToPath(`${basePath.get()}/app/ml/${url}`)}function clickResetJob(){Object(general["l"])(jobCreator,navigateToPath)}const convertToAdvanced=()=>{Object(general["d"])(jobCreator,navigateToPath)};Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setIsValid(jobValidator.validationSummary.basic)},[jobValidatorUpdated]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,isCurrentStep&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,isAdvanced&&external_kbnSharedDeps_React_default.a.createElement(JobSectionTitle,null),external_kbnSharedDeps_React_default.a.createElement(DetectorChart,null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(JobProgress,{progress:progress}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(JobDetails,null),isAdvanced===false&&external_kbnSharedDeps_React_default.a.createElement(StartDatafeedSwitch,{startDatafeed:startDatafeed,setStartDatafeed:setStartDatafeed,disabled:creatingJob}),isAdvanced&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],null),external_kbnSharedDeps_React_default.a.createElement(DatafeedSectionTitle,null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(DatafeedDetails,null)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],null),showJobAssignWarning&&external_kbnSharedDeps_React_default.a.createElement(jobs_awaiting_node_warning["b"],{jobType:"anomaly-detector"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,progress<100&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(PreviousButton,{previous:()=>setCurrentStep(WIZARD_STEPS.VALIDATION),previousActive:creatingJob===false&&isValid===true})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:start,isDisabled:creatingJob===true||isValid===false,"data-test-subj":"mlJobWizardButtonCreateJob",fill:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.summaryStep.createJobButton",defaultMessage:"Create job"})))),creatingJob===false&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(JsonEditorFlyout,{isDisabled:progress>0,jobEditorMode:jsonEditorMode,datafeedEditorMode:jsonEditorMode})),isAdvanced===false&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:convertToAdvanced},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.summaryStep.convertToAdvancedButton",defaultMessage:"Convert to advanced job"})))),progress>0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:viewResults,"data-test-subj":"mlJobWizardButtonViewResults"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.summaryStep.viewResultsButton",defaultMessage:"View results"})))),progress===100&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:clickResetJob,"data-test-subj":"mlJobWizardButtonResetJob"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.summaryStep.resetJobButton",defaultMessage:"Reset job"}))),external_kbnSharedDeps_React_default.a.createElement(PostSaveOptions,{jobRunner:jobRunner})))))};const query_description_Description=Object(external_kbnSharedDeps_React_["memo"])(({children:children})=>{const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.datafeedStep.query.title",{defaultMessage:"Elasticsearch query"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:title,describedByIds:["description"],fullWidth:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children))});const query_input_EDITOR_HEIGHT="400px";const QueryInput=({setIsValidQuery:setIsValidQuery})=>{const{jobCreator:jc,jobCreatorUpdate:jobCreatorUpdate,jobCreatorUpdated:jobCreatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const jobCreator=jc;const[queryString,setQueryString]=Object(external_kbnSharedDeps_React_["useState"])(JSON.stringify(jobCreator.query,null,2));Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const validJson=Object(validation_utils["c"])(queryString);setIsValidQuery(validJson);if(validJson){jobCreator.query=JSON.parse(queryString);jobCreatorUpdate()}},[queryString]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(Object(validation_utils["c"])(queryString)){const query=JSON.parse(queryString);const newQueryString=JSON.stringify(query,null,2);const actualQuery=JSON.stringify(jobCreator.query,null,2);if(newQueryString!==actualQuery){setQueryString(actualQuery)}}},[jobCreatorUpdated]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const validJson=Object(validation_utils["c"])(queryString);setIsValidQuery(validJson)},[]);function onChange(qs){setQueryString(qs)}return external_kbnSharedDeps_React_default.a.createElement(query_description_Description,null,external_kbnSharedDeps_React_default.a.createElement(ml_job_editor["a"],{value:queryString,height:query_input_EDITOR_HEIGHT,readOnly:false,onChange:onChange}))};const query_delay_description_Description=Object(external_kbnSharedDeps_React_["memo"])(({children:children,validation:validation})=>{const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.datafeedStep.queryDelay.title",{defaultMessage:"Query delay"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{title:external_kbnSharedDeps_React_default.a.createElement("h3",null,title),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.datafeedStep.queryDelay.description",defaultMessage:"Time delay in seconds, between current time and latest input data time."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:title,error:validation.message,isInvalid:validation.valid===false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children)))});function useStringifiedValue(initialValue){const[value,setValueInner]=Object(external_kbnSharedDeps_React_["useState"])(stringify(initialValue));function stringify(f){return f===null?"":f}function setValue(f){setValueInner(stringify(f))}return{value:value,setValue:setValue}}const QueryDelayInput=()=>{const{jobCreator:jobCreator,jobCreatorUpdate:jobCreatorUpdate,jobValidator:jobValidator,jobValidatorUpdated:jobValidatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const[validation,setValidation]=Object(external_kbnSharedDeps_React_["useState"])(jobValidator.queryDelay);const{value:queryDelay,setValue:setQueryDelay}=useStringifiedValue(jobCreator.queryDelay);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{jobCreator.queryDelay=queryDelay===""?null:queryDelay;jobCreatorUpdate()},[queryDelay]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setQueryDelay(jobCreator.queryDelay===null?"":jobCreator.queryDelay)},[jobCreatorUpdate]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setValidation(jobValidator.queryDelay)},[jobValidatorUpdated]);return external_kbnSharedDeps_React_default.a.createElement(query_delay_description_Description,{validation:validation},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{value:queryDelay,placeholder:new_job["d"],onChange:e=>setQueryDelay(e.target.value),isInvalid:validation.valid===false,"data-test-subj":"mlJobWizardInputQueryDelay"}))};const frequency_description_Description=Object(external_kbnSharedDeps_React_["memo"])(({children:children,validation:validation})=>{const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.datafeedStep.frequency.title",{defaultMessage:"Frequency"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{title:external_kbnSharedDeps_React_default.a.createElement("h3",null,title),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.datafeedStep.frequency.description",defaultMessage:"The interval between searches."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:title,error:validation.message,isInvalid:validation.valid===false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children)))});const FrequencyInput=()=>{const{jobCreator:jobCreator,jobCreatorUpdate:jobCreatorUpdate,jobCreatorUpdated:jobCreatorUpdated,jobValidator:jobValidator,jobValidatorUpdated:jobValidatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const[validation,setValidation]=Object(external_kbnSharedDeps_React_["useState"])(jobValidator.frequency);const{value:frequency,setValue:setFrequency}=useStringifiedValue(jobCreator.frequency);const[defaultFrequency,setDefaultFrequency]=Object(external_kbnSharedDeps_React_["useState"])(createDefaultFrequency());Object(external_kbnSharedDeps_React_["useEffect"])(()=>{jobCreator.frequency=frequency===""?null:frequency;jobCreatorUpdate()},[frequency]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setFrequency(jobCreator.frequency);const df=createDefaultFrequency();setDefaultFrequency(df)},[jobCreatorUpdated]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setValidation(jobValidator.frequency)},[jobValidatorUpdated]);function createDefaultFrequency(){const df=Object(job_utils["f"])(jobCreator.bucketSpanMs/1e3);return`${df}s`}return external_kbnSharedDeps_React_default.a.createElement(frequency_description_Description,{validation:validation},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{value:frequency,placeholder:defaultFrequency,onChange:e=>setFrequency(e.target.value),isInvalid:validation.valid===false,"data-test-subj":"mlJobWizardInputFrequency"}))};const scroll_size_description_Description=Object(external_kbnSharedDeps_React_["memo"])(({children:children,validation:validation})=>{const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.datafeedStep.scrollSize.title",{defaultMessage:"Scroll size"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{title:external_kbnSharedDeps_React_default.a.createElement("h3",null,title),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.datafeedStep.scrollSize.description",defaultMessage:"The maximum number of documents requested for a search."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:title,error:validation.message,isInvalid:validation.valid===false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children)))});const ScrollSizeInput=()=>{const{jobCreator:jobCreator,jobCreatorUpdate:jobCreatorUpdate,jobValidator:jobValidator,jobValidatorUpdated:jobValidatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const[validation,setValidation]=Object(external_kbnSharedDeps_React_["useState"])(jobValidator.scrollSize);const[scrollSizeString,setScrollSize]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.scrollSize===null?"":`${jobCreator.scrollSize}`);const{datafeeds:datafeeds}=Object(ml_server_info["b"])();const scrollSizeDefault=datafeeds.scroll_size!==undefined?`${datafeeds.scroll_size}`:"";Object(external_kbnSharedDeps_React_["useEffect"])(()=>{jobCreator.scrollSize=scrollSizeString===""?null:+scrollSizeString;jobCreatorUpdate()},[scrollSizeString]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setScrollSize(jobCreator.scrollSize===null?"":`${jobCreator.scrollSize}`)},[jobCreatorUpdate]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setValidation(jobValidator.scrollSize)},[jobValidatorUpdated]);return external_kbnSharedDeps_React_default.a.createElement(scroll_size_description_Description,{validation:validation},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{min:0,placeholder:scrollSizeDefault,value:scrollSizeString===""?scrollSizeString:+scrollSizeString,onChange:e=>setScrollSize(e.target.value),isInvalid:validation.valid===false,"data-test-subj":"mlJobWizardInputScrollSize"}))};const ResetQueryButton=()=>{const{jobCreator:jobCreator,jobCreatorUpdate:jobCreatorUpdate}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const[confirmModalVisible,setConfirmModalVisible]=Object(external_kbnSharedDeps_React_["useState"])(false);const[defaultQueryString]=Object(external_kbnSharedDeps_React_["useState"])(JSON.stringify(getDefaultDatafeedQuery(),null,2));const closeModal=()=>setConfirmModalVisible(false);const showModal=()=>setConfirmModalVisible(true);function resetDatafeed(){jobCreator.query=getDefaultDatafeedQuery();jobCreatorUpdate();closeModal()}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,confirmModalVisible&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiConfirmModal"],{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.datafeedStep.resetQueryConfirm.title",{defaultMessage:"Reset datafeed query"}),onCancel:closeModal,onConfirm:resetDatafeed,cancelButtonText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.datafeedStep.resetQueryConfirm.cancel",{defaultMessage:"Cancel"}),confirmButtonText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.datafeedStep.resetQueryConfirm.confirm",{defaultMessage:"Confirm"}),defaultFocusedButton:"confirm"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.datafeedStep.resetQueryConfirm.description",defaultMessage:"Set the datafeed query to be the default."}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCodeBlock"],{language:"js",fontSize:"m",paddingSize:"s"},defaultQueryString)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{size:"s",onClick:showModal},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.datafeedStep.resetQueryButton",defaultMessage:"Reset datafeed query to default"})))};const TimeFieldSelect=({fields:fields,changeHandler:changeHandler,selectedField:selectedField})=>{const{jobCreator:jobCreator}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const options=Object(general["g"])(fields,jobCreator.additionalFields);const selection=[];if(selectedField!==null){selection.push({label:selectedField})}function onChange(selectedOptions){const option=selectedOptions[0];if(typeof option!=="undefined"){changeHandler(option.label)}}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{singleSelection:{asPlainText:true},options:options,selectedOptions:selection,onChange:onChange,isClearable:false,"data-test-subj":"mlTimeFieldNameSelect"})};const time_field_description_Description=Object(external_kbnSharedDeps_React_["memo"])(({children:children})=>{const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.datafeedStep.timeField.title",{defaultMessage:"Time field"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{title:external_kbnSharedDeps_React_default.a.createElement("h3",null,title),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.datafeedStep.timeField.description",defaultMessage:"The default time field for the index pattern is automatically selected, but can be overridden."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:title},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children)))});const TimeField=()=>{const{jobCreator:jc,jobCreatorUpdate:jobCreatorUpdate,jobCreatorUpdated:jobCreatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const jobCreator=jc;const{dateFields:dateFields}=new_job_capabilities_service["c"];const[timeFieldName,setTimeFieldName]=Object(external_kbnSharedDeps_React_["useState"])(jobCreator.timeFieldName);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{jobCreator.timeFieldName=timeFieldName;jobCreatorUpdate()},[timeFieldName]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setTimeFieldName(jobCreator.timeFieldName)},[jobCreatorUpdated]);return external_kbnSharedDeps_React_default.a.createElement(time_field_description_Description,null,external_kbnSharedDeps_React_default.a.createElement(TimeFieldSelect,{fields:dateFields,changeHandler:setTimeFieldName,selectedField:timeFieldName}))};const DatafeedStep=({setCurrentStep:setCurrentStep,isCurrentStep:isCurrentStep})=>{const{jobValidator:jobValidator,jobValidatorUpdated:jobValidatorUpdated}=Object(external_kbnSharedDeps_React_["useContext"])(JobCreatorContext);const[nextActive,setNextActive]=Object(external_kbnSharedDeps_React_["useState"])(false);const[isValidQuery,setIsValidQuery]=Object(external_kbnSharedDeps_React_["useState"])(false);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const active=isValidQuery&&jobValidator.queryDelay.valid&&jobValidator.frequency.valid&&jobValidator.scrollSize.valid&&jobValidator.validating===false;setNextActive(active)},[jobValidatorUpdated,isValidQuery]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,isCurrentStep&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xl"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{"data-test-subj":"mlAdvancedDatafeedQueryEditor"},external_kbnSharedDeps_React_default.a.createElement(QueryInput,{setIsValidQuery:setIsValidQuery})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(QueryDelayInput,null),external_kbnSharedDeps_React_default.a.createElement(FrequencyInput,null),external_kbnSharedDeps_React_default.a.createElement(ScrollSizeInput,null),external_kbnSharedDeps_React_default.a.createElement(TimeField,null))),external_kbnSharedDeps_React_default.a.createElement(ResetQueryButton,null),external_kbnSharedDeps_React_default.a.createElement(WizardNav,{next:()=>setCurrentStep(WIZARD_STEPS.PICK_FIELDS),nextActive:nextActive},external_kbnSharedDeps_React_default.a.createElement(JsonEditorFlyout,{isDisabled:false,jobEditorMode:json_editor_flyout_EDITOR_MODE.EDITABLE,datafeedEditorMode:json_editor_flyout_EDITOR_MODE.EDITABLE}))))};const WizardSteps=({currentStep:currentStep,setCurrentStep:setCurrentStep})=>{const mlContext=Object(ml["b"])();const[advancedExpanded,setAdvancedExpanded]=Object(external_kbnSharedDeps_React_["useState"])(false);const[additionalExpanded,setAdditionalExpanded]=Object(external_kbnSharedDeps_React_["useState"])(false);function getSummaryStepTitle(){if(mlContext.currentSavedSearch!==null){return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.stepComponentWrapper.summaryTitleSavedSearch",{defaultMessage:"New job from saved search {title}",values:{title:mlContext.currentSavedSearch.attributes.title}})}else if(mlContext.currentIndexPattern.id!==undefined){return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.stepComponentWrapper.summaryTitleIndexPattern",{defaultMessage:"New job from index pattern {title}",values:{title:mlContext.currentIndexPattern.title}})}return""}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,currentStep===WIZARD_STEPS.TIME_RANGE&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(Title,{"data-test-subj":"mlJobWizardStepTitleTimeRange"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.stepComponentWrapper.timeRangeTitle",defaultMessage:"Time range"})),external_kbnSharedDeps_React_default.a.createElement(TimeRangeStep,{isCurrentStep:currentStep===WIZARD_STEPS.TIME_RANGE,setCurrentStep:setCurrentStep})),currentStep===WIZARD_STEPS.ADVANCED_CONFIGURE_DATAFEED&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(Title,{"data-test-subj":"mlJobWizardStepTitleConfigureDatafeed"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.stepComponentWrapper.configureDatafeedTitle",defaultMessage:"Configure datafeed"})),external_kbnSharedDeps_React_default.a.createElement(DatafeedStep,{isCurrentStep:currentStep===WIZARD_STEPS.ADVANCED_CONFIGURE_DATAFEED,setCurrentStep:setCurrentStep})),currentStep===WIZARD_STEPS.PICK_FIELDS&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(Title,{"data-test-subj":"mlJobWizardStepTitlePickFields"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.stepComponentWrapper.pickFieldsTitle",defaultMessage:"Pick fields"})),external_kbnSharedDeps_React_default.a.createElement(PickFieldsStep,{isCurrentStep:currentStep===WIZARD_STEPS.PICK_FIELDS,setCurrentStep:setCurrentStep})),currentStep===WIZARD_STEPS.JOB_DETAILS&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(Title,{"data-test-subj":"mlJobWizardStepTitleJobDetails"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.stepComponentWrapper.jobDetailsTitle",defaultMessage:"Job details"})),external_kbnSharedDeps_React_default.a.createElement(JobDetailsStep,{isCurrentStep:currentStep===WIZARD_STEPS.JOB_DETAILS,setCurrentStep:setCurrentStep,advancedExpanded:advancedExpanded,setAdvancedExpanded:setAdvancedExpanded,additionalExpanded:additionalExpanded,setAdditionalExpanded:setAdditionalExpanded})),currentStep===WIZARD_STEPS.VALIDATION&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(Title,{"data-test-subj":"mlJobWizardStepTitleValidation"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.stepComponentWrapper.validationTitle",defaultMessage:"Validation"})),external_kbnSharedDeps_React_default.a.createElement(ValidationStep,{isCurrentStep:currentStep===WIZARD_STEPS.VALIDATION,setCurrentStep:setCurrentStep})),currentStep===WIZARD_STEPS.SUMMARY&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(Title,{"data-test-subj":"mlJobWizardStepTitleSummary"},getSummaryStepTitle()),external_kbnSharedDeps_React_default.a.createElement(SummaryStep,{isCurrentStep:currentStep===WIZARD_STEPS.SUMMARY,setCurrentStep:setCurrentStep})))};const Title=({"data-test-subj":dataTestSubj,children:children})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h2",{"data-test-subj":dataTestSubj},children)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null));const WizardHorizontalSteps=({currentStep:currentStep,highestStep:highestStep,setCurrentStep:setCurrentStep,disableSteps:disableSteps,jobType:jobType})=>{function jumpToStep(step){if(step<=highestStep){setCurrentStep(step)}}const stepsConfig=[{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.step.timeRangeTitle",{defaultMessage:"Time range"}),...createStepProps(WIZARD_STEPS.TIME_RANGE)},{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.step.pickFieldsTitle",{defaultMessage:"Pick fields"}),...createStepProps(WIZARD_STEPS.PICK_FIELDS)},{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.step.jobDetailsTitle",{defaultMessage:"Job details"}),...createStepProps(WIZARD_STEPS.JOB_DETAILS)},{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.step.validationTitle",{defaultMessage:"Validation"}),...createStepProps(WIZARD_STEPS.VALIDATION)},{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.step.summaryTitle",{defaultMessage:"Summary"}),...createStepProps(WIZARD_STEPS.SUMMARY)}];if(jobType===new_job["f"].ADVANCED){stepsConfig.splice(0,1,{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.step.configureDatafeedTitle",{defaultMessage:"Configure datafeed"}),...createStepProps(WIZARD_STEPS.ADVANCED_CONFIGURE_DATAFEED)})}function createStepProps(step){return{onClick:()=>jumpToStep(step),isSelected:currentStep===step,isComplete:currentStep>step,disabled:disableSteps||highestStep<step}}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiStepsHorizontal"],{steps:stepsConfig,style:{backgroundColor:"inherit"}})};const Wizard=({jobCreator:jobCreator,chartLoader:chartLoader,resultsLoader:resultsLoader,chartInterval:chartInterval,jobValidator:jobValidator,existingJobsAndGroups:existingJobsAndGroups,firstWizardStep:firstWizardStep=WIZARD_STEPS.TIME_RANGE})=>{const[jobCreatorUpdated,setJobCreatorUpdate]=Object(external_kbnSharedDeps_React_["useReducer"])(s=>s+1,0);const jobCreatorUpdate=()=>setJobCreatorUpdate(jobCreatorUpdated);const[jobValidatorUpdated,setJobValidatorUpdate]=Object(external_kbnSharedDeps_React_["useReducer"])(s=>s+1,0);const jobCreatorContext={jobCreatorUpdated:jobCreatorUpdated,jobCreatorUpdate:jobCreatorUpdate,jobCreator:jobCreator,chartLoader:chartLoader,resultsLoader:resultsLoader,chartInterval:chartInterval,jobValidator:jobValidator,jobValidatorUpdated:jobValidatorUpdated,fields:new_job_capabilities_service["c"].fields,aggs:new_job_capabilities_service["c"].aggs,existingJobsAndGroups:existingJobsAndGroups};const firstStep=jobCreator.type===new_job["f"].ADVANCED?WIZARD_STEPS.ADVANCED_CONFIGURE_DATAFEED:WIZARD_STEPS.TIME_RANGE;const[currentStep,setCurrentStep]=Object(external_kbnSharedDeps_React_["useState"])(firstStep);const[highestStep,setHighestStep]=Object(external_kbnSharedDeps_React_["useState"])(firstStep);const[disableSteps,setDisableSteps]=Object(external_kbnSharedDeps_React_["useState"])(false);const[progress,setProgress]=Object(external_kbnSharedDeps_React_["useState"])(resultsLoader.progress);const[stringifiedConfigs,setStringifiedConfigs]=Object(external_kbnSharedDeps_React_["useState"])(stringifyConfigs(jobCreator.jobConfig,jobCreator.datafeedConfig));Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const subscription=jobValidator.validationResult$.subscribe(()=>{setJobValidatorUpdate(jobValidatorUpdated)});return()=>subscription.unsubscribe()},[]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{jobValidator.validate(()=>{setJobValidatorUpdate(jobValidatorUpdated)});const tempConfigs=stringifyConfigs(jobCreator.jobConfig,jobCreator.datafeedConfig);if(tempConfigs!==stringifiedConfigs){setHighestStep(currentStep);setStringifiedConfigs(tempConfigs)}},[jobCreatorUpdated]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{jobCreator.subscribeToProgress(setProgress);setCurrentStep(firstWizardStep)},[]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setDisableSteps(progress>0)},[progress]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(currentStep>=highestStep){setHighestStep(currentStep)}},[currentStep]);useModelMemoryEstimator(jobCreator,jobValidator,jobCreatorUpdate,jobCreatorUpdated);return external_kbnSharedDeps_React_default.a.createElement(JobCreatorContext.Provider,{value:jobCreatorContext},external_kbnSharedDeps_React_default.a.createElement(WizardHorizontalSteps,{currentStep:currentStep,highestStep:highestStep,setCurrentStep:setCurrentStep,disableSteps:disableSteps,jobType:jobCreator.type}),external_kbnSharedDeps_React_default.a.createElement(WizardSteps,{currentStep:currentStep,setCurrentStep:setCurrentStep}))};function stringifyConfigs(jobConfig,datafeedConfig){return JSON.stringify(jobConfig)+JSON.stringify(datafeedConfig)}var memoize_one_cjs=__webpack_require__(230);var memoize_one_cjs_default=__webpack_require__.n(memoize_one_cjs);var results_service=__webpack_require__(114);function getCategoryFields(indexPatternName,fieldName,size,query,runtimeMappings){return new Promise((resolve,reject)=>{ml_api_service["ml"].esSearch({index:indexPatternName,size:0,body:{query:query,aggs:{catFields:{terms:{field:fieldName,size:size}}},...runtimeMappings!==undefined?{runtime_mappings:runtimeMappings}:{}}}).then(resp=>{const catFields=Object(external_kbnSharedDeps_Lodash_["get"])(resp,["aggregations","catFields","buckets"],[]);resolve({success:true,results:catFields.map(f=>f.key)})}).catch(resp=>{reject(resp)})})}function chart_loader_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const eq=(newArgs,lastArgs)=>Object(external_kbnSharedDeps_Lodash_["isEqual"])(newArgs,lastArgs);const newJobLineChart=memoize_one_cjs_default()(ml_api_service["ml"].jobs.newJobLineChart,eq);const newJobPopulationsChart=memoize_one_cjs_default()(ml_api_service["ml"].jobs.newJobPopulationsChart,eq);const getEventRateData=memoize_one_cjs_default()(results_service["mlResultsService"].getEventRateData,eq);const chart_loader_getCategoryFields=memoize_one_cjs_default()(getCategoryFields,eq);class chart_loader_ChartLoader{constructor(indexPattern,query){chart_loader_defineProperty(this,"_indexPatternTitle","");chart_loader_defineProperty(this,"_timeFieldName","");chart_loader_defineProperty(this,"_query",{});this._indexPatternTitle=indexPattern.title;this._query=query;if(typeof indexPattern.timeFieldName==="string"){this._timeFieldName=indexPattern.timeFieldName}}async loadLineCharts(start,end,aggFieldPairs,splitField,splitFieldValue,intervalMs,runtimeMappings){if(this._timeFieldName!==""){if(Object(general["b"])(aggFieldPairs)===false){return{}}const splitFieldName=splitField!==null?splitField.name:null;const aggFieldPairNames=aggFieldPairs.map(getAggFieldPairNames);const resp=await newJobLineChart(this._indexPatternTitle,this._timeFieldName,start,end,intervalMs,this._query,aggFieldPairNames,splitFieldName,splitFieldValue,runtimeMappings!==null&&runtimeMappings!==void 0?runtimeMappings:undefined);return resp.results}return{}}async loadPopulationCharts(start,end,aggFieldPairs,splitField,intervalMs,runtimeMappings){if(this._timeFieldName!==""){if(Object(general["b"])(aggFieldPairs)===false){return{}}const splitFieldName=splitField!==null?splitField.name:"";const aggFieldPairNames=aggFieldPairs.map(getAggFieldPairNames);const resp=await newJobPopulationsChart(this._indexPatternTitle,this._timeFieldName,start,end,intervalMs,this._query,aggFieldPairNames,splitFieldName,runtimeMappings!==null&&runtimeMappings!==void 0?runtimeMappings:undefined);return resp.results}return{}}async loadEventRateChart(start,end,intervalMs){if(this._timeFieldName!==""){const resp=await getEventRateData(this._indexPatternTitle,this._query,this._timeFieldName,start,end,intervalMs*3);if(resp.error!==undefined){throw resp.error}return Object.entries(resp.results).map(([time,value])=>({time:+time,value:value}))}return[]}async loadFieldExampleValues(field,runtimeMappings){const{results:results}=await chart_loader_getCategoryFields(this._indexPatternTitle,field.name,10,this._query,runtimeMappings!==null&&runtimeMappings!==void 0?runtimeMappings:undefined);return results}}function getAggFieldPairNames(af){const by=af.by!==undefined&&af.by.field!==null&&af.by.value!==null?{field:af.by.field.id,value:af.by.value}:{field:null,value:null};return{agg:af.agg.dslName||"",field:af.field.id,by:by}}var results_loader=__webpack_require__(385);var time_buckets=__webpack_require__(95);const PAGE_WIDTH=1200;const page_BAR_TARGET=PAGE_WIDTH>2e3?1e3:PAGE_WIDTH/2;const MAX_BARS=page_BAR_TARGET+page_BAR_TARGET/100*100;const new_job_page_Page=({existingJobsAndGroups:existingJobsAndGroups,jobType:jobType})=>{const{services:{notifications:notifications}}=Object(contexts_kibana["b"])();const mlContext=Object(ml["b"])();const jobCreator=Object(job_creator["f"])(jobType)(mlContext.currentIndexPattern,mlContext.currentSavedSearch,mlContext.combinedQuery);const{from:from,to:to}=getTimeFilterRange();jobCreator.setTimeRange(from,to);let firstWizardStep=jobType===new_job["f"].ADVANCED?WIZARD_STEPS.ADVANCED_CONFIGURE_DATAFEED:WIZARD_STEPS.TIME_RANGE;let autoSetTimeRange=false;if(job_service["a"].tempJobCloningObjects.job!==undefined&&job_service["a"].tempJobCloningObjects.datafeed!==undefined){const clonedJob=job_service["a"].tempJobCloningObjects.job;const clonedDatafeed=job_service["a"].cloneDatafeed(job_service["a"].tempJobCloningObjects.datafeed);initCategorizationSettings();jobCreator.cloneFromExistingJob(clonedJob,clonedDatafeed);if(job_service["a"].tempJobCloningObjects.skipTimeRangeStep===false){jobCreator.jobId=""}else if(jobType!==new_job["f"].ADVANCED){firstWizardStep=WIZARD_STEPS.PICK_FIELDS}job_service["a"].tempJobCloningObjects.skipTimeRangeStep=false;job_service["a"].tempJobCloningObjects.job=undefined;job_service["a"].tempJobCloningObjects.datafeed=undefined;job_service["a"].tempJobCloningObjects.createdBy=undefined;if(job_service["a"].tempJobCloningObjects.start!==undefined&&job_service["a"].tempJobCloningObjects.end!==undefined){jobCreator.setTimeRange(job_service["a"].tempJobCloningObjects.start,job_service["a"].tempJobCloningObjects.end);job_service["a"].tempJobCloningObjects.start=undefined;job_service["a"].tempJobCloningObjects.end=undefined}else{autoSetTimeRange=Object(job_creator["a"])(jobCreator)}if(job_service["a"].tempJobCloningObjects.calendars){jobCreator.calendars=job_service["a"].tempJobCloningObjects.calendars;job_service["a"].tempJobCloningObjects.calendars=undefined}}else{jobCreator.bucketSpan=new_job["b"];if(jobCreator.type!==new_job["f"].POPULATION&&jobCreator.type!==new_job["f"].ADVANCED&&jobCreator.type!==new_job["f"].CATEGORIZATION){jobCreator.modelMemoryLimit=new_job["c"]}if(jobCreator.type===new_job["f"].SINGLE_METRIC){jobCreator.modelPlot=true;jobCreator.modelChangeAnnotations=true}if(mlContext.currentSavedSearch!==null){jobCreator.createdBy=null}autoSetTimeRange=Object(job_creator["a"])(jobCreator);initCategorizationSettings();if(Object(job_creator["b"])(jobCreator)){const{catFields:catFields}=new_job_capabilities_service["c"];if(catFields.length===1){jobCreator.categorizationFieldName=catFields[0].name}}}if(autoSetTimeRange&&Object(job_creator["a"])(jobCreator)){try{jobCreator.autoSetTimeRange()}catch(error){const{toasts:toasts}=notifications;toasts.addDanger({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.autoSetJobCreatorTimeRange.error",{defaultMessage:`Error retrieving beginning and end times of index`}),text:error})}}function initCategorizationSettings(){if(Object(job_creator["b"])(jobCreator)){const count=new_job_capabilities_service["c"].getAggById("count");const rare=new_job_capabilities_service["c"].getAggById("rare");const eventRate=new_job_capabilities_service["c"].getFieldById(types_fields["a"]);jobCreator.setDefaultDetectorProperties(count,rare,eventRate);const{anomaly_detectors:anomalyDetectors}=Object(ml_server_info["b"])();jobCreator.categorizationAnalyzer=anomalyDetectors.categorization_analyzer}}const chartInterval=Object(time_buckets["c"])();chartInterval.setBarTarget(page_BAR_TARGET);chartInterval.setMaxBars(MAX_BARS);chartInterval.setInterval("auto");const chartLoader=new chart_loader_ChartLoader(mlContext.currentIndexPattern,mlContext.combinedQuery);const jobValidator=new job_validator_JobValidator(jobCreator);const resultsLoader=new results_loader["b"](jobCreator,chartInterval,chartLoader);Object(external_kbnSharedDeps_React_["useEffect"])(()=>()=>{jobCreator.forceStopRefreshPolls()});const jobCreatorTitle=Object(general["i"])(jobCreator);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPage"],{style:{backgroundColor:"inherit"},"data-test-subj":`mlPageJobWizard ${jobType}`},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageContent"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageContentHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageContentHeaderSection"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],null,external_kbnSharedDeps_React_default.a.createElement("h1",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.page.createJob",defaultMessage:"Create job"}),": ",jobCreatorTitle)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.page.createJob.indexPatternTitle",defaultMessage:"Using index pattern {index}",values:{index:jobCreator.indexPatternTitle}}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageContentBody"],null,external_kbnSharedDeps_React_default.a.createElement(Wizard,{jobCreator:jobCreator,chartLoader:chartLoader,resultsLoader:resultsLoader,chartInterval:chartInterval,jobValidator:jobValidator,existingJobsAndGroups:existingJobsAndGroups,firstWizardStep:firstWizardStep}))))))};function wizard_extends(){wizard_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return wizard_extends.apply(this,arguments)}const getBaseBreadcrumbs=(navigateToPath,basePath)=>[getBreadcrumbWithUrlForApp("ML_BREADCRUMB",navigateToPath,basePath),getBreadcrumbWithUrlForApp("ANOMALY_DETECTION_BREADCRUMB",navigateToPath,basePath),getBreadcrumbWithUrlForApp("CREATE_JOB_BREADCRUMB",navigateToPath,basePath)];const getSingleMetricBreadcrumbs=(navigateToPath,basePath)=>[...getBaseBreadcrumbs(navigateToPath,basePath),{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsBreadcrumbs.singleMetricLabel",{defaultMessage:"Single metric"}),href:""}];const getMultiMetricBreadcrumbs=(navigateToPath,basePath)=>[...getBaseBreadcrumbs(navigateToPath,basePath),{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsBreadcrumbs.multiMetricLabel",{defaultMessage:"Multi-metric"}),href:""}];const getPopulationBreadcrumbs=(navigateToPath,basePath)=>[...getBaseBreadcrumbs(navigateToPath,basePath),{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsBreadcrumbs.populationLabel",{defaultMessage:"Population"}),href:""}];const getAdvancedBreadcrumbs=(navigateToPath,basePath)=>[...getBaseBreadcrumbs(navigateToPath,basePath),{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsBreadcrumbs.advancedConfigurationLabel",{defaultMessage:"Advanced configuration"}),href:""}];const getCategorizationBreadcrumbs=(navigateToPath,basePath)=>[...getBaseBreadcrumbs(navigateToPath,basePath),{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsBreadcrumbs.categorizationLabel",{defaultMessage:"Categorization"}),href:""}];const singleMetricRouteFactory=(navigateToPath,basePath)=>({path:"/jobs/new_job/single_metric",render:(props,deps)=>external_kbnSharedDeps_React_default.a.createElement(wizard_PageWrapper,wizard_extends({},props,{jobType:new_job["f"].SINGLE_METRIC,deps:deps})),breadcrumbs:getSingleMetricBreadcrumbs(navigateToPath,basePath)});const multiMetricRouteFactory=(navigateToPath,basePath)=>({path:"/jobs/new_job/multi_metric",render:(props,deps)=>external_kbnSharedDeps_React_default.a.createElement(wizard_PageWrapper,wizard_extends({},props,{jobType:new_job["f"].MULTI_METRIC,deps:deps})),breadcrumbs:getMultiMetricBreadcrumbs(navigateToPath,basePath)});const populationRouteFactory=(navigateToPath,basePath)=>({path:"/jobs/new_job/population",render:(props,deps)=>external_kbnSharedDeps_React_default.a.createElement(wizard_PageWrapper,wizard_extends({},props,{jobType:new_job["f"].POPULATION,deps:deps})),breadcrumbs:getPopulationBreadcrumbs(navigateToPath,basePath)});const advancedRouteFactory=(navigateToPath,basePath)=>({path:"/jobs/new_job/advanced",render:(props,deps)=>external_kbnSharedDeps_React_default.a.createElement(wizard_PageWrapper,wizard_extends({},props,{jobType:new_job["f"].ADVANCED,deps:deps})),breadcrumbs:getAdvancedBreadcrumbs(navigateToPath,basePath)});const categorizationRouteFactory=(navigateToPath,basePath)=>({path:"/jobs/new_job/categorization",render:(props,deps)=>external_kbnSharedDeps_React_default.a.createElement(wizard_PageWrapper,wizard_extends({},props,{jobType:new_job["f"].CATEGORIZATION,deps:deps})),breadcrumbs:getCategorizationBreadcrumbs(navigateToPath,basePath)});const wizard_PageWrapper=({location:location,jobType:jobType,deps:deps})=>{const redirectToJobsManagementPage=Object(use_create_url["a"])(ml_url_generator["b"].ANOMALY_DETECTION_JOBS_MANAGE);const{index:index,savedSearchId:savedSearchId}=Object(query_string["parse"])(location.search,{sort:false});const{context:context,results:results}=useResolver(index,savedSearchId,deps.config,{...basicResolvers(deps),privileges:()=>Object(check_capabilities["a"])(redirectToJobsManagementPage),jobCaps:()=>Object(new_job_capabilities_service["b"])(index,savedSearchId,deps.indexPatterns),existingJobsAndGroups:job_service["a"].getJobAndGroupIds});return external_kbnSharedDeps_React_default.a.createElement(PageLoader,{context:context},external_kbnSharedDeps_React_default.a.createElement(new_job_page_Page,{jobType:jobType,existingJobsAndGroups:results.existingJobsAndGroups}))};const CreateResultCallout=Object(external_kbnSharedDeps_React_["memo"])(({saveState:saveState,resultsUrl:resultsUrl,onReset:onReset})=>{if(saveState===SAVE_STATE.NOT_SAVED){return null}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,saveState===SAVE_STATE.SAVED&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.recognize.jobsCreatedTitle",defaultMessage:"Jobs created"}),color:"success",iconType:"checkInCircleFilled"}),saveState===SAVE_STATE.FAILED&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.simple.recognize.jobsCreationFailedTitle",defaultMessage:"Jobs creation failed"}),color:"danger",iconType:"alert"}),saveState===SAVE_STATE.PARTIAL_FAILURE&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.recognize.someJobsCreationFailedTitle",defaultMessage:"Some jobs failed to be created"}),color:"warning",iconType:"alert"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"flexEnd",alignItems:"center"},saveState!==SAVE_STATE.SAVING&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{color:"primary",fill:false,"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.recognize.jobsCreationFailed.resetButtonAriaLabel",{defaultMessage:"Reset"}),onClick:onReset},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.recognize.someJobsCreationFailed.resetButtonLabel",defaultMessage:"Reset"}))),(saveState===SAVE_STATE.SAVED||saveState===SAVE_STATE.PARTIAL_FAILURE)&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{color:"primary",fill:true,href:resultsUrl,"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.recognize.viewResultsAriaLabel",{defaultMessage:"View results"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.recognize.viewResultsLinkText",defaultMessage:"View results"})))))});const KibanaObjects=Object(external_kbnSharedDeps_React_["memo"])(({objectType:objectType,kibanaObjects:kibanaObjects,isSaving:isSaving})=>{const kibanaObjectLabels={dashboard:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.recognize.dashboardsLabel",{defaultMessage:"Dashboards"}),search:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.recognize.searchesLabel",{defaultMessage:"Searches"}),visualization:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.recognize.visualizationsLabel",{defaultMessage:"Visualizations"})};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h4",null,kibanaObjectLabels[objectType])),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement("ul",null,kibanaObjects.map(({id:id,title:title,success:success,exists:exists,error:error},i)=>external_kbnSharedDeps_React_default.a.createElement("li",{key:id},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center",gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xs"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s",color:exists?"subdued":"secondary"},title),success===false&&error!==undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",color:"danger"},Object(util_errors["i"])(error))),exists&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",color:"default"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.recognize.alreadyExistsLabel",defaultMessage:"(already exists)"}))))),!exists&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:{width:"60px"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{textAlign:"center"},isSaving?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLoadingSpinner"],{size:"m"}):null,success!==undefined?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:success?"check":"cross",color:success?"success":"danger","aria-label":success?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.recognize.results.savedAriaLabel",{defaultMessage:"Saved"}):external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.recognize.results.saveFailedAriaLabel",{defaultMessage:"Save failed"})}):null))),(kibanaObjects.length===1||i<kibanaObjects.length-1)&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"s"})))))});const JobItem=Object(external_kbnSharedDeps_React_["memo"])(({job:job,jobOverride:jobOverride,isSaving:isSaving,jobPrefix:jobPrefix,onEditRequest:onEditRequest})=>{const{id:id,config:{description:description,groups:groups},datafeedResult:datafeedResult,setupResult:setupResult}=job;const jobGroups=jobOverride&&jobOverride.groups||groups;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center",gutterSize:"s",justifyContent:"spaceBetween",responsive:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s",color:"secondary"},jobPrefix,id)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{position:"right",content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.recognize.job.overrideJobConfigurationLabel",defaultMessage:"Override job configuration"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.recognize.job.overrideJobConfigurationLabel",{defaultMessage:"Override job configuration"}),iconType:"pencil",onClick:()=>onEditRequest(job)})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s",color:"subdued"},description),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{wrap:true,responsive:false,gutterSize:"xs"},jobGroups.map(group=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,key:group},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBadge"],{color:Object(group_color_utils["a"])(group)},group)))),setupResult&&setupResult.error&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",color:"danger"},Object(util_errors["i"])(setupResult.error)),datafeedResult&&datafeedResult.error&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",color:"danger"},Object(util_errors["i"])(datafeedResult.error))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:{width:SETUP_RESULTS_WIDTH}},isSaving&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLoadingSpinner"],{size:"m"}),setupResult&&datafeedResult&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"s",wrap:false,responsive:false,justifyContent:"spaceAround"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:setupResult.success?"check":"cross",color:setupResult.success?"secondary":"danger",size:"m","aria-label":setupResult.success?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.recognize.job.savedAriaLabel",{defaultMessage:"Saved"}):external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.recognize.job.saveFailedAriaLabel",{defaultMessage:"Save failed"})})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:datafeedResult.success?"check":"cross",color:datafeedResult.success?"secondary":"danger",size:"m","aria-label":setupResult.success?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.recognize.datafeed.savedAriaLabel",{defaultMessage:"Saved"}):external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.recognize.datafeed.saveFailedAriaLabel",{defaultMessage:"Save failed"})})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:getDatafeedStartedIcon(datafeedResult).type,color:getDatafeedStartedIcon(datafeedResult).color,size:"m","aria-label":setupResult.success?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.recognize.running.startedAriaLabel",{defaultMessage:"Started"}):external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.recognize.running.startFailedAriaLabel",{defaultMessage:"Start failed"})})))))});function getDatafeedStartedIcon({awaitingMlNodeAllocation:awaitingMlNodeAllocation,success:success}){if(awaitingMlNodeAllocation===true){return{type:"alert",color:"warning"}}return success?{type:"check",color:"secondary"}:{type:"cross",color:"danger"}}function usePartialState(initialValue){const[state,setState]=Object(external_kbnSharedDeps_React_["useState"])(initialValue);const setFormStateCallback=update=>{setState({...state,...update})};return[state,setFormStateCallback]}var validators=__webpack_require__(14);const EditJob=({job:job,jobOverride:jobOverride,existingGroupIds:existingGroupIds,onClose:onClose})=>{const[formState,setFormState]=usePartialState({jobGroups:jobOverride&&jobOverride.groups||job.config.groups});const[validationResult,setValidationResult]=Object(external_kbnSharedDeps_React_["useState"])({});const groupValidator=Object(validators["a"])(value=>Object(job_utils["i"])(value)?null:{pattern:true},Object(validators["b"])(constants_validation["b"]));const handleValidation=()=>{const jobGroupsValidationResult=formState.jobGroups.map(group=>groupValidator(group)).filter(result=>result!==null);setValidationResult({jobGroups:jobGroupsValidationResult,formValid:jobGroupsValidationResult.length===0})};Object(external_kbnSharedDeps_React_["useEffect"])(()=>{handleValidation()},[formState.jobGroups]);const onSave=()=>{const result={job_id:job.id,groups:formState.jobGroups};onClose(result)};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyout"],{onClose:()=>onClose(null)},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutHeader"],{hasBorder:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"m"},external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.recognize.overrideConfigurationHeader",defaultMessage:"Override configuration for {jobID}",values:{jobID:job.id}})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiForm"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true},external_kbnSharedDeps_React_default.a.createElement(JobGroupsInput,{existingGroups:existingGroupIds,selectedGroups:formState.jobGroups,onChange:value=>{setFormState({jobGroups:value})},validation:{valid:!validationResult.jobGroups||validationResult.jobGroups.length===0,message:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.recognize.jobGroupAllowedCharactersDescription",defaultMessage:"Job group names can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; must start and end with an alphanumeric character"})}}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutFooter"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{iconType:"cross",onClick:()=>onClose(null),flush:"left"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.recognize.cancelJobOverrideLabel",defaultMessage:"Close"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:()=>onSave(),fill:true,disabled:!validationResult.formValid},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.recognize.saveJobOverrideLabel",defaultMessage:"Save"}))))))};const SETUP_RESULTS_WIDTH="200px";const ModuleJobs=({jobs:jobs,jobPrefix:jobPrefix,jobOverrides:jobOverrides,saveState:saveState,existingGroupIds:existingGroupIds,onJobOverridesChange:onJobOverridesChange})=>{const isSaving=saveState===SAVE_STATE.SAVING;const[jobToEdit,setJobToEdit]=Object(external_kbnSharedDeps_React_["useState"])(null);const onFlyoutClose=result=>{setJobToEdit(null);if(result===null){return}onJobOverridesChange(result)};const getJobOverride=job=>jobOverrides[job.id];const editJobFlyout=jobToEdit!==null?external_kbnSharedDeps_React_default.a.createElement(EditJob,{job:jobToEdit,jobOverride:getJobOverride(jobToEdit),onClose:onFlyoutClose,existingGroupIds:existingGroupIds}):null;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h4",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.recognize.jobsTitle",defaultMessage:"Jobs"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),saveState!==SAVE_STATE.SAVING&&saveState!==SAVE_STATE.NOT_SAVED&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"flexEnd",responsive:false,gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{style:{width:SETUP_RESULTS_WIDTH},grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceAround",responsive:false,gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s",textAlign:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.recognize.jobLabel",defaultMessage:"Job"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s",textAlign:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.recognize.datafeedLabel",defaultMessage:"Datafeed"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s",textAlign:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.recognize.runningLabel",defaultMessage:"Running"})))))),external_kbnSharedDeps_React_default.a.createElement("ul",null,jobs.map((job,i)=>external_kbnSharedDeps_React_default.a.createElement("li",{key:job.id},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(JobItem,{jobPrefix:jobPrefix,job:job,jobOverride:getJobOverride(job),isSaving:isSaving,onEditRequest:()=>setJobToEdit(job)}))),i<jobs.length-1&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"s"})))),editJobFlyout)};function checkViewOrCreateJobs(moduleId,indexPatternId,createLinkWithUserDefaults,navigateToPath){return new Promise((resolve,reject)=>{ml_api_service["ml"].dataRecognizerModuleJobsExist({moduleId:moduleId}).then(async resp=>{if(resp.jobsExist===true){const url=createLinkWithUserDefaults("explorer",resp.jobs);await navigateToPath(url);reject()}else{await navigateToPath(`/jobs/new_job/recognize?id=${moduleId}&index=${indexPatternId}`);reject()}}).catch(async err=>{console.error(`Error checking whether jobs in module ${moduleId} exists`,err);const toastNotifications=Object(dependency_cache["j"])();toastNotifications.addWarning({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.recognize.moduleCheckJobsExistWarningTitle",{defaultMessage:"Error checking module {moduleId}",values:{moduleId:moduleId}}),text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.recognize.moduleCheckJobsExistWarningDescription",{defaultMessage:"An error occurred trying to check whether the jobs in the module have been created."})});await navigateToPath(`/jobs`);reject()})})}const checkForSavedObjects=async objects=>{const savedObjectsClient=Object(dependency_cache["h"])();try{return await Object.keys(objects).reduce(async(prevPromise,type)=>{const acc=await prevPromise;const{savedObjects:savedObjects}=await savedObjectsClient.find({type:type,perPage:1e3});acc[type]=objects[type].map(obj=>{const find=savedObjects.find(savedObject=>savedObject.attributes.title===obj.title);return{...obj,exists:!!find,id:!!find&&find.id||obj.id}});return Promise.resolve(acc)},Promise.resolve({}))}catch(e){console.error("Could not load saved objects",e)}return Promise.resolve(objects)};const JobSettingsForm=({onSubmit:onSubmit,onChange:onChange,saveState:saveState,jobs:jobs})=>{const{from:from,to:to}=getTimeFilterRange();const{currentIndexPattern:indexPattern}=Object(ml["b"])();const jobPrefixValidator=Object(validators["a"])(Object(validators["d"])(/^([a-z0-9]+[a-z0-9\-_]*)?$/),Object(validators["b"])(constants_validation["b"]-Math.max(...jobs.map(({id:id})=>id.length))));const[formState,setFormState]=usePartialState({jobPrefix:"",startDatafeedAfterSave:true,useFullIndexData:true,timeRange:{start:from,end:to},useDedicatedIndex:false});const[validationResult,setValidationResult]=Object(external_kbnSharedDeps_React_["useState"])({});const onJobPrefixChange=value=>{setFormState({jobPrefix:value&&value.toLowerCase()})};const handleValidation=()=>{const jobPrefixValidationResult=jobPrefixValidator(formState.jobPrefix);setValidationResult({jobPrefix:jobPrefixValidationResult,formValid:!jobPrefixValidationResult})};Object(external_kbnSharedDeps_React_["useEffect"])(()=>{handleValidation()},[formState.jobPrefix]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{onChange(formState)},[formState]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiForm"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{title:external_kbnSharedDeps_React_default.a.createElement("h4",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.recognize.jobIdPrefixLabel",defaultMessage:"Job ID prefix"})),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.tooltips.newJobRecognizerJobPrefixTooltip",defaultMessage:"The prefix is added to the beginning of each job ID."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.recognize.jobIdPrefixLabel",defaultMessage:"Job ID prefix"}),isInvalid:!!validationResult.jobPrefix,error:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,validationResult.jobPrefix&&validationResult.jobPrefix.maxLength?external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.recognize.jobPrefixInvalidMaxLengthErrorMessage",defaultMessage:"Job ID prefix must be no more than {maxLength, plural, one {# character} other {# characters}} long.",values:{maxLength:validationResult.jobPrefix.maxLength.requiredLength}})):null,validationResult.jobPrefix&&validationResult.jobPrefix.pattern&&external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.recognize.jobLabelAllowedCharactersDescription",defaultMessage:"Job label can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; must start and end with an alphanumeric character"})))},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{name:"jobPrefix",value:formState.jobPrefix,onChange:({target:{value:value}})=>onJobPrefixChange(value),isInvalid:!!validationResult.jobPrefix}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{id:"startDataFeed",name:"startDataFeed",label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.recognize.startDatafeedAfterSaveLabel",defaultMessage:"Start datafeed after save"}),checked:formState.startDatafeedAfterSave,onChange:({target:{checked:checked}})=>{setFormState({startDatafeedAfterSave:checked})}})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{id:"useFullData",name:"useFullData",label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.recognize.useFullDataLabel",defaultMessage:"Use full {indexPatternTitle} data",values:{indexPatternTitle:indexPattern.title}}),checked:formState.useFullIndexData,onChange:({target:{checked:checked}})=>{setFormState({useFullIndexData:checked})}})),!formState.useFullIndexData&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(TimeRangePicker,{setTimeRange:value=>{setFormState({timeRange:value})},timeRange:formState.timeRange})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiAccordion"],{id:"advancedOptions","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.recognize.advancedSettingsAriaLabel",{defaultMessage:"Advanced settings"}),buttonContent:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.recognize.advancedLabel",defaultMessage:"Advanced"}),paddingSize:"l"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescribedFormGroup"],{title:external_kbnSharedDeps_React_default.a.createElement("h4",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.recognize.useDedicatedIndexLabel",defaultMessage:"Use dedicated index"})),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.tooltips.newJobDedicatedIndexTooltip",defaultMessage:"Store results in a separate index for this job."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{describedByIds:["ml_aria_label_new_job_dedicated_index"]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{id:"useDedicatedIndex",name:"useDedicatedIndex",checked:formState.useDedicatedIndex,onChange:({target:{checked:checked}})=>{setFormState({useDedicatedIndex:checked})},label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.recognize.useDedicatedIndexLabel",{defaultMessage:"Use dedicated index"})})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTextAlign"],{textAlign:"right"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{fill:true,type:"submit",isLoading:saveState===SAVE_STATE.SAVING,disabled:!validationResult.formValid||saveState===SAVE_STATE.SAVING,onClick:()=>{onSubmit(formState)},"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.recognize.createJobButtonAriaLabel",{defaultMessage:"Create job"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.recognize.createJobButtonLabel",defaultMessage:"Create {numberOfJobs, plural, zero {Job} one {Job} other {Jobs}}",values:{numberOfJobs:jobs.length}}))))};var time_format=__webpack_require__(116);let SAVE_STATE;(function(SAVE_STATE){SAVE_STATE[SAVE_STATE["NOT_SAVED"]=0]="NOT_SAVED";SAVE_STATE[SAVE_STATE["SAVING"]=1]="SAVING";SAVE_STATE[SAVE_STATE["SAVED"]=2]="SAVED";SAVE_STATE[SAVE_STATE["FAILED"]=3]="FAILED";SAVE_STATE[SAVE_STATE["PARTIAL_FAILURE"]=4]="PARTIAL_FAILURE"})(SAVE_STATE||(SAVE_STATE={}));const recognize_page_Page=({moduleId:moduleId,existingGroupIds:existingGroupIds})=>{const{services:{notifications:notifications}}=Object(contexts_kibana["b"])();const urlGenerator=Object(contexts_kibana["d"])();const[jobPrefix,setJobPrefix]=Object(external_kbnSharedDeps_React_["useState"])("");const[jobs,setJobs]=Object(external_kbnSharedDeps_React_["useState"])([]);const[jobOverrides,setJobOverrides]=Object(external_kbnSharedDeps_React_["useState"])({});const[kibanaObjects,setKibanaObjects]=Object(external_kbnSharedDeps_React_["useState"])({});const[saveState,setSaveState]=Object(external_kbnSharedDeps_React_["useState"])(SAVE_STATE.NOT_SAVED);const[resultsUrl,setResultsUrl]=Object(external_kbnSharedDeps_React_["useState"])("");const[existingGroups,setExistingGroups]=Object(external_kbnSharedDeps_React_["useState"])(existingGroupIds);const[jobsAwaitingNodeCount,setJobsAwaitingNodeCount]=Object(external_kbnSharedDeps_React_["useState"])(0);const{currentSavedSearch:savedSearch,currentIndexPattern:indexPattern,combinedQuery:combinedQuery}=Object(ml["b"])();const pageTitle=savedSearch!==null?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.recognize.savedSearchPageTitle",{defaultMessage:"saved search {savedSearchTitle}",values:{savedSearchTitle:savedSearch.attributes.title}}):external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.recognize.indexPatternPageTitle",{defaultMessage:"index pattern {indexPatternTitle}",values:{indexPatternTitle:indexPattern.title}});const displayQueryWarning=savedSearch!==null;const tempQuery=savedSearch===null?undefined:combinedQuery;const loadModule=async()=>{try{const response=await ml_api_service["ml"].getDataRecognizerModule({moduleId:moduleId});setJobs(response.jobs);const kibanaObjectsResult=await checkForSavedObjects(response.kibana);setKibanaObjects(kibanaObjectsResult);setSaveState(SAVE_STATE.NOT_SAVED);const moduleGroups=[...response.jobs.map(j=>j.config.groups||[])].flat();setExistingGroups([...new Set([...existingGroups,...moduleGroups])])}catch(e){console.error(e)}};const getTimeRange=async(useFullIndexData,timeRange)=>{if(useFullIndexData){const{start:start,end:end}=await ml_api_service["ml"].getTimeFieldRange({index:indexPattern.title,timeFieldName:indexPattern.timeFieldName,query:combinedQuery});return{start:start.epoch,end:end.epoch}}else{return Promise.resolve(timeRange)}};Object(external_kbnSharedDeps_React_["useEffect"])(()=>{loadModule()},[]);const save=async formValues=>{setSaveState(SAVE_STATE.SAVING);const{jobPrefix:resultJobPrefix,startDatafeedAfterSave:startDatafeedAfterSave,useDedicatedIndex:useDedicatedIndex,useFullIndexData:useFullIndexData,timeRange:timeRange}=formValues;const resultTimeRange=await getTimeRange(useFullIndexData,timeRange);try{let jobOverridesPayload=Object.values(jobOverrides);jobOverridesPayload=jobOverridesPayload.length>0?jobOverridesPayload:null;const response=await ml_api_service["ml"].setupDataRecognizerConfig({moduleId:moduleId,prefix:resultJobPrefix,query:tempQuery,indexPatternName:indexPattern.title,useDedicatedIndex:useDedicatedIndex,startDatafeed:startDatafeedAfterSave,...jobOverridesPayload!==null?{jobOverrides:jobOverridesPayload}:{},...resultTimeRange});const{datafeeds:datafeedsResponse,jobs:jobsResponse,kibana:kibanaResponse}=response;setJobs(jobs.map(job=>({...job,datafeedResult:datafeedsResponse.find(({id:id})=>id.endsWith(job.id)),setupResult:jobsResponse.find(({id:id})=>id===resultJobPrefix+job.id)})));setKibanaObjects(Object(external_kbnSharedDeps_Lodash_["merge"])(kibanaObjects,kibanaResponse));const url=await urlGenerator.createUrl({page:ml_url_generator["b"].ANOMALY_EXPLORER,pageState:{jobIds:jobsResponse.filter(({success:success})=>success).map(({id:id})=>id),timeRange:{from:external_kbnSharedDeps_Moment_default()(resultTimeRange.start).format(time_format["a"]),to:external_kbnSharedDeps_Moment_default()(resultTimeRange.end).format(time_format["a"]),mode:"absolute"}}});setResultsUrl(url);const failedJobsCount=jobsResponse.reduce((count,{success:success})=>success?count:count+1,0);const lazyJobsCount=datafeedsResponse.reduce((count,{awaitingMlNodeAllocation:awaitingMlNodeAllocation})=>awaitingMlNodeAllocation===true?count+1:count,0);setJobsAwaitingNodeCount(lazyJobsCount);setSaveState(failedJobsCount===0?SAVE_STATE.SAVED:failedJobsCount===jobs.length?SAVE_STATE.FAILED:SAVE_STATE.PARTIAL_FAILURE)}catch(e){setSaveState(SAVE_STATE.FAILED);console.error("Error setting up module",e);const{toasts:toasts}=notifications;toasts.addDanger({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.recognize.moduleSetupFailedWarningTitle",{defaultMessage:"Error setting up module {moduleId}",values:{moduleId:moduleId}}),text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.recognize.moduleSetupFailedWarningDescription",{defaultMessage:"An error occurred trying to create the {count, plural, one {job} other {jobs}} in the module.",values:{count:jobs.length}})})}};const onJobOverridesChange=job=>{setJobOverrides({...jobOverrides,[job.job_id]:job});if(job.groups!==undefined){const groups=[...new Set([...existingGroups,...job.groups])];setExistingGroups(groups)}};const isFormVisible=[SAVE_STATE.NOT_SAVED,SAVE_STATE.SAVING].includes(saveState);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPage"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageHeaderSection"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"l"},external_kbnSharedDeps_React_default.a.createElement("h3",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.recognize.newJobFromTitle",defaultMessage:"New job from {pageTitle}",values:{pageTitle:pageTitle}}))))),displayQueryWarning&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.recognize.searchWillBeOverwrittenLabel",defaultMessage:"Search will be overwritten"}),color:"warning",iconType:"alert"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.recognize.usingSavedSearchDescription",defaultMessage:"Using a saved search will mean the query used in the datafeeds will be different from the default ones we supply in the {moduleId} module.",values:{moduleId:moduleId}}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"})),jobsAwaitingNodeCount>0&&external_kbnSharedDeps_React_default.a.createElement(jobs_awaiting_node_warning["a"],{jobCount:jobsAwaitingNodeCount}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{wrap:true,gutterSize:"m"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h4",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.recognize.jobSettingsTitle",defaultMessage:"Job settings"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),isFormVisible&&external_kbnSharedDeps_React_default.a.createElement(JobSettingsForm,{onSubmit:save,onChange:formValues=>{setJobPrefix(formValues.jobPrefix)},saveState:saveState,jobs:jobs}),external_kbnSharedDeps_React_default.a.createElement(CreateResultCallout,{saveState:saveState,resultsUrl:resultsUrl,onReset:loadModule}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:2},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(ModuleJobs,{jobs:jobs,jobPrefix:jobPrefix,saveState:saveState,existingGroupIds:existingGroups,jobOverrides:jobOverrides,onJobOverridesChange:onJobOverridesChange})),Object.keys(kibanaObjects).length>0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],{grow:false},Object.keys(kibanaObjects).map((objectType,i)=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],{key:objectType},external_kbnSharedDeps_React_default.a.createElement(KibanaObjects,{objectType:objectType,kibanaObjects:kibanaObjects[objectType],isSaving:saveState===SAVE_STATE.SAVING}),i<Object.keys(kibanaObjects).length-1&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}))))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"})))};var use_create_ad_links=__webpack_require__(228);function recognize_extends(){recognize_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return recognize_extends.apply(this,arguments)}const recognizeRouteFactory=(navigateToPath,basePath)=>({path:"/jobs/new_job/recognize",render:(props,deps)=>external_kbnSharedDeps_React_default.a.createElement(recognize_PageWrapper,recognize_extends({},props,{deps:deps})),breadcrumbs:[getBreadcrumbWithUrlForApp("ML_BREADCRUMB",navigateToPath,basePath),getBreadcrumbWithUrlForApp("ANOMALY_DETECTION_BREADCRUMB",navigateToPath,basePath),getBreadcrumbWithUrlForApp("CREATE_JOB_BREADCRUMB",navigateToPath,basePath),{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsBreadcrumbs.selectIndexOrSearchLabelRecognize",{defaultMessage:"Recognized index"}),href:""}]});const checkViewOrCreateRouteFactory=()=>({path:"/modules/check_view_or_create",render:(props,deps)=>external_kbnSharedDeps_React_default.a.createElement(CheckViewOrCreateWrapper,recognize_extends({},props,{deps:deps})),breadcrumbs:[]});const recognize_PageWrapper=({location:location,deps:deps})=>{const{id:id,index:index,savedSearchId:savedSearchId}=Object(query_string["parse"])(location.search,{sort:false});const{context:context,results:results}=useResolver(index,savedSearchId,deps.config,{...basicResolvers(deps),existingJobsAndGroups:job_service["a"].getJobAndGroupIds});return external_kbnSharedDeps_React_default.a.createElement(PageLoader,{context:context},external_kbnSharedDeps_React_default.a.createElement(recognize_page_Page,{moduleId:id,existingGroupIds:results.existingJobsAndGroups.groupIds}))};const CheckViewOrCreateWrapper=({location:location,deps:deps})=>{const{id:moduleId,index:indexPatternId}=Object(query_string["parse"])(location.search,{sort:false});const{createLinkWithUserDefaults:createLinkWithUserDefaults}=Object(use_create_ad_links["a"])();const navigateToPath=Object(contexts_kibana["e"])();useResolver(undefined,undefined,deps.config,{checkViewOrCreateJobs:()=>checkViewOrCreateJobs(moduleId,indexPatternId,createLinkWithUserDefaults,navigateToPath)});return null};var navigation_menu=__webpack_require__(94);var external_kbnSharedDeps_ElasticNumeral_=__webpack_require__(42);var external_kbnSharedDeps_ElasticNumeral_default=__webpack_require__.n(external_kbnSharedDeps_ElasticNumeral_);var fileUpload_public_=__webpack_require__(53);var constants_settings=__webpack_require__(183);const DEFAULT_LINES_TO_SAMPLE=1e3;const UPLOAD_SIZE_MB=5;const overrideDefaults={timestampFormat:undefined,timestampField:undefined,format:undefined,delimiter:undefined,quote:undefined,hasHeaderRow:undefined,charset:undefined,columnNames:undefined,shouldTrimFields:undefined,grokPattern:undefined,linesToSample:undefined};function readFile(file){return new Promise((resolve,reject)=>{if(file&&file.size){const reader=new FileReader;reader.readAsArrayBuffer(file);reader.onload=(()=>()=>{const decoder=new TextDecoder;const data=reader.result;if(data===null||typeof data==="string"){return reject()}const size=UPLOAD_SIZE_MB*Math.pow(2,20);const fileContents=decoder.decode(data.slice(0,size));if(fileContents===""){reject()}else{resolve({fileContents:fileContents,data:data})}})()}else{reject()}})}function getMaxBytes(){const maxFileSize=Object(dependency_cache["k"])().get(constants_settings["c"],fileUpload_public_["MAX_FILE_SIZE"]);const maxBytes=external_kbnSharedDeps_ElasticNumeral_default()(maxFileSize.toUpperCase()).value();if(maxBytes<fileUpload_public_["MAX_FILE_SIZE_BYTES"]){return fileUpload_public_["MAX_FILE_SIZE_BYTES"]}return maxBytes<=fileUpload_public_["ABSOLUTE_MAX_FILE_SIZE_BYTES"]?maxBytes:fileUpload_public_["ABSOLUTE_MAX_FILE_SIZE_BYTES"]}function getMaxBytesFormatted(){return external_kbnSharedDeps_ElasticNumeral_default()(getMaxBytes()).format(fileUpload_public_["FILE_SIZE_DISPLAY_FORMAT"])}function createUrlOverrides(overrides,originalSettings){const formattedOverrides={};for(const o in overrideDefaults){if(overrideDefaults.hasOwnProperty(o)){let value=overrides[o];if(Array.isArray(value)&&Object(external_kbnSharedDeps_Lodash_["isEqual"])(value,originalSettings[o])||value===undefined||value===originalSettings[o]){value=""}const snakeCaseO=o.replace(/([A-Z])/g,$1=>`_${$1.toLowerCase()}`);formattedOverrides[snakeCaseO]=value}}if(formattedOverrides.format===""&&originalSettings.format==="delimited"){if(formattedOverrides.should_trim_fields!==""||formattedOverrides.has_header_row!==""||formattedOverrides.delimiter!==""||formattedOverrides.quote!==""||formattedOverrides.column_names!==""){formattedOverrides.format=originalSettings.format}if(Array.isArray(formattedOverrides.column_names)){formattedOverrides.column_names=formattedOverrides.column_names.join()}}if(formattedOverrides.format===""&&originalSettings.format==="semi_structured_text"){if(formattedOverrides.grok_pattern!==""){formattedOverrides.format=originalSettings.format}}if(formattedOverrides.format==="ndjson"||originalSettings.format==="ndjson"){formattedOverrides.should_trim_fields="";formattedOverrides.has_header_row="";formattedOverrides.delimiter="";formattedOverrides.quote="";formattedOverrides.column_names=""}if(formattedOverrides.lines_to_sample===""){formattedOverrides.lines_to_sample=overrides.linesToSample}return formattedOverrides}function processResults({results:results,overrides:overrides}){const timestampFormat=results.java_timestamp_formats!==undefined&&results.java_timestamp_formats.length?results.java_timestamp_formats[0]:undefined;const linesToSample=overrides!==undefined&&overrides.lines_to_sample!==undefined?overrides.lines_to_sample:DEFAULT_LINES_TO_SAMPLE;return{format:results.format,delimiter:results.delimiter,timestampField:results.timestamp_field,timestampFormat:timestampFormat,quote:results.quote,hasHeaderRow:results.has_header_row,shouldTrimFields:results.should_trim_fields,charset:results.charset,columnNames:results.column_names,grokPattern:results.grok_pattern,linesToSample:linesToSample}}async function hasImportPermission(indexName){const priv={cluster:["cluster:admin/ingest/pipeline/put"]};if(indexName!==undefined){priv.index=[{names:[indexName],privileges:["indices:data/write/bulk","indices:data/write/index","indices:admin/create"]}]}const resp=await ml_api_service["ml"].hasPrivileges(priv);return resp.securityDisabled===true||resp.has_all_requested===true}var help_menu=__webpack_require__(98);function startTrialDescription(){return external_kbnSharedDeps_React_default.a.createElement("span",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.datavisualizer.startTrial.fullMLFeaturesDescription",defaultMessage:"To experience the full Machine Learning features that a {subscriptionsLink} offers, start a 30-day trial.",values:{subscriptionsLink:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{href:"https://www.elastic.co/subscriptions",target:"_blank"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.datavisualizer.startTrial.subscriptionsLinkText",defaultMessage:"Platinum or Enterprise subscription"}))}}))}const DatavisualizerSelector=()=>{Object(contexts_kibana["g"])({timeRangeSelector:false,autoRefreshSelector:false});const{services:{licenseManagement:licenseManagement,http:{basePath:basePath},docLinks:docLinks}}=Object(contexts_kibana["b"])();const helpLink=docLinks.links.ml.guide;const navigateToPath=Object(contexts_kibana["e"])();const startTrialVisible=licenseManagement!==undefined&&licenseManagement.enabled===true&&Object(license["d"])()===false;const maxFileSize=getMaxBytesFormatted();return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(navigation_menu["a"],{tabId:"datavisualizer"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPage"],{restrictWidth:1e3,"data-test-subj":"mlPageDataVisualizerSelector"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xl"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"l"},external_kbnSharedDeps_React_default.a.createElement("h1",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.datavisualizer.selector.dataVisualizerTitle",defaultMessage:"Data Visualizer"}))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xl"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xl"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{color:"subdued"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.datavisualizer.selector.dataVisualizerDescription",defaultMessage:"The Machine Learning Data Visualizer tool helps you understand your data, by analyzing the metrics and fields in a log file or an existing Elasticsearch index."})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xl"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceAround",gutterSize:"xl"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCard"],{icon:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{size:"xxl",type:"addDataApp"}),title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.datavisualizer.selector.importDataTitle",defaultMessage:"Import data"}),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.datavisualizer.selector.importDataDescription",defaultMessage:"Import data from a log file. You can upload files up to {maxFileSize}.",values:{maxFileSize:maxFileSize}}),betaBadgeLabel:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.datavisualizer.selector.experimentalBadgeLabel",{defaultMessage:"Experimental"}),betaBadgeTooltipContent:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.datavisualizer.selector.experimentalBadgeTooltipLabel",defaultMessage:"Experimental feature. We'd love to hear your feedback."}),footer:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{target:"_self",onClick:()=>navigateToPath("/filedatavisualizer"),"data-test-subj":"mlDataVisualizerUploadFileButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.datavisualizer.selector.uploadFileButtonLabel",defaultMessage:"Select file"})),"data-test-subj":"mlDataVisualizerCardImportData"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCard"],{icon:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{size:"xxl",type:"dataVisualizer"}),title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.datavisualizer.selector.selectIndexPatternTitle",defaultMessage:"Select an index pattern"}),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.datavisualizer.selector.selectIndexPatternDescription",defaultMessage:"Visualize the data in an existing Elasticsearch index."}),footer:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{target:"_self",onClick:()=>navigateToPath("/datavisualizer_index_select"),"data-test-subj":"mlDataVisualizerSelectIndexButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.datavisualizer.selector.selectIndexButtonLabel",defaultMessage:"Select index pattern"})),"data-test-subj":"mlDataVisualizerCardIndexData"}))),startTrialVisible===true&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xxl"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xxl"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceAround",gutterSize:"xl"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:{width:"600px"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCard"],{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.datavisualizer.selector.startTrialTitle",defaultMessage:"Start trial"}),description:startTrialDescription(),footer:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{target:"_blank",href:`${basePath.get()}/app/management/stack/license_management/home`,"data-test-subj":"mlDataVisualizerStartTrialButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.datavisualizer.selector.startTrialButtonLabel",defaultMessage:"Start trial"})),"data-test-subj":"mlDataVisualizerCardStartTrial"})))))),external_kbnSharedDeps_React_default.a.createElement(help_menu["a"],{docLink:helpLink}))};function datavisualizer_extends(){datavisualizer_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return datavisualizer_extends.apply(this,arguments)}const selectorRouteFactory=(navigateToPath,basePath)=>({path:"/datavisualizer",render:(props,deps)=>external_kbnSharedDeps_React_default.a.createElement(datavisualizer_PageWrapper,datavisualizer_extends({},props,{deps:deps})),breadcrumbs:[getBreadcrumbWithUrlForApp("ML_BREADCRUMB",navigateToPath,basePath),getBreadcrumbWithUrlForApp("DATA_VISUALIZER_BREADCRUMB",navigateToPath,basePath)]});const datavisualizer_PageWrapper=({location:location,deps:deps})=>{const{redirectToMlAccessDeniedPage:redirectToMlAccessDeniedPage}=deps;const{context:context}=useResolver(undefined,undefined,deps.config,{checkBasicLicense:license["a"],checkFindFileStructurePrivilege:()=>Object(check_capabilities["b"])(redirectToMlAccessDeniedPage)});return external_kbnSharedDeps_React_default.a.createElement(PageLoader,{context:context},external_kbnSharedDeps_React_default.a.createElement(DatavisualizerSelector,null))};var date_picker_wrapper=__webpack_require__(174);function kbnTypeToMLJobType(field){let type;switch(field.type){case data_public_["KBN_FIELD_TYPES"].STRING:type=field.aggregatable?field_types["c"].KEYWORD:field_types["c"].TEXT;break;case data_public_["KBN_FIELD_TYPES"].NUMBER:type=field_types["c"].NUMBER;break;case data_public_["KBN_FIELD_TYPES"].DATE:type=field_types["c"].DATE;break;case data_public_["KBN_FIELD_TYPES"].IP:type=field_types["c"].IP;break;case data_public_["KBN_FIELD_TYPES"].BOOLEAN:type=field_types["c"].BOOLEAN;break;case data_public_["KBN_FIELD_TYPES"].GEO_POINT:type=field_types["c"].GEO_POINT;break;case data_public_["KBN_FIELD_TYPES"].GEO_SHAPE:type=field_types["c"].GEO_SHAPE;break;default:break}return type}const mlJobTypeAriaLabels={BOOLEAN:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fieldTypeIcon.booleanTypeAriaLabel",{defaultMessage:"boolean type"}),DATE:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fieldTypeIcon.dateTypeAriaLabel",{defaultMessage:"date type"}),GEO_POINT:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fieldTypeIcon.geoPointTypeAriaLabel",{defaultMessage:"{geoPointParam} type",values:{geoPointParam:"geo point"}}),IP:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fieldTypeIcon.ipTypeAriaLabel",{defaultMessage:"ip type"}),KEYWORD:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fieldTypeIcon.keywordTypeAriaLabel",{defaultMessage:"keyword type"}),NUMBER:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fieldTypeIcon.numberTypeAriaLabel",{defaultMessage:"number type"}),TEXT:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fieldTypeIcon.textTypeAriaLabel",{defaultMessage:"text type"}),UNKNOWN:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fieldTypeIcon.unknownTypeAriaLabel",{defaultMessage:"unknown type"})};const getMLJobTypeAriaLabel=type=>{const requestedFieldType=Object.keys(field_types["c"]).find(k=>field_types["c"][k]===type);if(requestedFieldType===undefined){return null}return mlJobTypeAriaLabels[requestedFieldType]};var discover_public_=__webpack_require__(54);const ActionsPanel=({indexPattern:indexPattern,searchString:searchString,searchQueryLanguage:searchQueryLanguage})=>{const[recognizerResultsCount,setRecognizerResultsCount]=Object(external_kbnSharedDeps_React_["useState"])(0);const[discoverLink,setDiscoverLink]=Object(external_kbnSharedDeps_React_["useState"])("");const{services:{application:{capabilities:capabilities},share:{urlGenerators:{getUrlGenerator:getUrlGenerator}}}}=Object(contexts_kibana["b"])();const[globalState]=Object(url_state["c"])("_g");const recognizerResults={count:0,onChange(){setRecognizerResultsCount(recognizerResults.count)}};const mlAvailable=Object(license["d"])()&&Object(check_capabilities["e"])("canCreateJob")&&Object(ml_nodes_check["d"])();const showCreateAnomalyDetectionJob=mlAvailable&&indexPattern.timeFieldName!==undefined;const createJobLink=Object(contexts_kibana["c"])({page:ml_url_generator["b"].ANOMALY_DETECTION_CREATE_JOB_ADVANCED,pageState:{index:indexPattern.id}});const createDataFrameAnalyticsLink=Object(contexts_kibana["c"])({page:ml_url_generator["b"].DATA_FRAME_ANALYTICS_CREATE_JOB,pageState:{index:indexPattern.id}});Object(external_kbnSharedDeps_React_["useEffect"])(()=>{let unmounted=false;const indexPatternId=indexPattern.id;const getDiscoverUrl=async()=>{var _capabilities$discove,_capabilities$discove2;const isDiscoverAvailable=(_capabilities$discove=(_capabilities$discove2=capabilities.discover)===null||_capabilities$discove2===void 0?void 0:_capabilities$discove2.show)!==null&&_capabilities$discove!==void 0?_capabilities$discove:false;if(!isDiscoverAvailable){return}const state={indexPatternId:indexPatternId};if(searchString&&searchQueryLanguage!==undefined){state.query={query:searchString,language:searchQueryLanguage}}if(globalState!==null&&globalState!==void 0&&globalState.time){state.timeRange=globalState.time}if(globalState!==null&&globalState!==void 0&&globalState.refreshInterval){state.refreshInterval=globalState.refreshInterval}let discoverUrlGenerator;try{discoverUrlGenerator=getUrlGenerator(discover_public_["DISCOVER_APP_URL_GENERATOR"])}catch(error){return}const discoverUrl=await discoverUrlGenerator.createUrl(state);if(!unmounted){setDiscoverLink(discoverUrl)}};getDiscoverUrl();return()=>{unmounted=true}},[indexPattern,searchString,searchQueryLanguage,globalState]);return external_kbnSharedDeps_React_default.a.createElement("div",{"data-test-subj":"mlDataVisualizerActionsPanel"},mlAvailable&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.datavisualizer.actionsPanel.createJobTitle",defaultMessage:"Create job"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),showCreateAnomalyDetectionJob&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement("div",{hidden:recognizerResultsCount===0},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"l",responsive:true,wrap:true},external_kbnSharedDeps_React_default.a.createElement(data_recognizer_DataRecognizer,{indexPattern:indexPattern,savedSearch:null,results:recognizerResults})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(LinkCard,{href:createJobLink,icon:"createAdvancedJob",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.datavisualizer.actionsPanel.advancedTitle",{defaultMessage:"Advanced anomaly detection"}),description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.datavisualizer.actionsPanel.advancedDescription",{defaultMessage:"Create a job with the full range of options for more advanced use cases."}),"data-test-subj":"mlDataVisualizerCreateAdvancedJobCard"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}))),mlAvailable&&indexPattern.id!==undefined&&createDataFrameAnalyticsLink&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(LinkCard,{href:createDataFrameAnalyticsLink,icon:"classificationJob",description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.datavisualizer.actionsPanel.dataframeTypesDescription",{defaultMessage:"Create outlier detection, regression, or classification analytics."}),title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.datavisualizer.actionsPanel.dataframeAnalyticsTitle",defaultMessage:"Data frame analytics"}),"data-test-subj":"mlDataVisualizerCreateDataFrameAnalyticsCard"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"})),discoverLink&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.datavisualizer.actionsPanel.exploreTitle",defaultMessage:"Explore your data"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(LinkCard,{href:discoverLink,icon:"discoverApp",description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.datavisualizer.actionsPanel.viewIndexInDiscoverDescription",{defaultMessage:"Explore the documents in your index."}),title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.datavisualizer.actionsPanel.discoverAppTitle",defaultMessage:"Discover"}),"data-test-subj":"mlDataVisualizerViewInDiscoverCard"})))};const searchSizeOptions=[1e3,5e3,1e4,1e5,-1].map(v=>({value:String(v),inputDisplay:v>0?external_kbnSharedDeps_React_default.a.createElement("span",{"data-test-subj":`mlDataVisualizerShardSizeOption ${v}`},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.datavisualizer.searchPanel.sampleSizeOptionLabel",defaultMessage:"Sample size (per shard): {wrappedValue}",values:{wrappedValue:external_kbnSharedDeps_React_default.a.createElement("b",null,v)}})):external_kbnSharedDeps_React_default.a.createElement("span",{"data-test-subj":`mlDataVisualizerShardSizeOption all`},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.datavisualizer.searchPanel.allOptionLabel",defaultMessage:"Search all"}))}));const ShardSizeFilter=({samplerShardSize:samplerShardSize,setSamplerShardSize:setSamplerShardSize})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center",gutterSize:"s",responsive:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:{width:270}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSuperSelect"],{options:searchSizeOptions,valueOfSelected:String(samplerShardSize),onChange:value=>setSamplerShardSize(+value),"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.datavisualizer.searchPanel.sampleSizeAriaLabel",{defaultMessage:"Select number of documents to sample"}),"data-test-subj":"mlDataVisualizerShardSizeSelect"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIconTip"],{content:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.datavisualizer.searchPanel.queryBarPlaceholder",{defaultMessage:"Selecting a smaller sample size will reduce query run times and the load on the cluster."}),position:"right"})));const NoFilterItems=()=>external_kbnSharedDeps_React_default.a.createElement("div",{className:"euiFilterSelect__note"},external_kbnSharedDeps_React_default.a.createElement("div",{className:"euiFilterSelect__noteContent"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:"minusInCircle"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xs"}),external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.multiSelectPicker.NoFiltersFoundMessage",defaultMessage:"No filters found"}))));const MultiSelectPicker=({options:options,onChange:onChange,title:title,checkedOptions:checkedOptions,dataTestSubj:dataTestSubj})=>{const[items,setItems]=Object(external_kbnSharedDeps_React_["useState"])(options);const[searchTerm,setSearchTerm]=Object(external_kbnSharedDeps_React_["useState"])("");Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(searchTerm===""){setItems(options)}else{const filteredOptions=options.filter(o=>{var _o$value;return o===null||o===void 0?void 0:(_o$value=o.value)===null||_o$value===void 0?void 0:_o$value.includes(searchTerm)});setItems(filteredOptions)}},[options,searchTerm]);const[isPopoverOpen,setIsPopoverOpen]=Object(external_kbnSharedDeps_React_["useState"])(false);const onButtonClick=()=>{setIsPopoverOpen(!isPopoverOpen)};const closePopover=()=>{setIsPopoverOpen(false)};const handleOnChange=index=>{if(!items[index]||!Array.isArray(checkedOptions)||onChange===undefined){return}const item=items[index];const foundIndex=checkedOptions.findIndex(fieldValue=>fieldValue===item.value);if(foundIndex>-1){onChange(checkedOptions.filter((_,idx)=>idx!==foundIndex))}else{onChange([...checkedOptions,item.value])}};const button=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFilterButton"],{"data-test-subj":`${dataTestSubj}-button`,iconType:"arrowDown",onClick:onButtonClick,isSelected:isPopoverOpen,numFilters:items.length,hasActiveFilters:checkedOptions&&checkedOptions.length>0,numActiveFilters:checkedOptions&&checkedOptions.length},title);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFilterGroup"],{"data-test-subj":dataTestSubj},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopover"],{ownFocus:true,"data-test-subj":`${dataTestSubj}-popover`,button:button,isOpen:isPopoverOpen,closePopover:closePopover,panelPaddingSize:"none"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopoverTitle"],{paddingSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldSearch"],{compressed:true,onChange:e=>setSearchTerm(e.target.value),"data-test-subj":`${dataTestSubj}-searchInput`})),external_kbnSharedDeps_React_default.a.createElement("div",{style:{maxHeight:250,overflow:"auto"}},Array.isArray(items)&&items.length>0?items.map((item,index)=>{var _item$name;const checked=checkedOptions&&checkedOptions.findIndex(fieldValue=>fieldValue===item.value)>-1;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFilterSelectItem"],{checked:checked?"on":undefined,key:index,onClick:()=>handleOnChange(index),style:{flexDirection:"row"},"data-test-subj":`${dataTestSubj}-option-${item.value}${checked?"-checked":""}`},(_item$name=item.name)!==null&&_item$name!==void 0?_item$name:item.value)}):external_kbnSharedDeps_React_default.a.createElement(NoFilterItems,null))))};const DataVisualizerFieldNamesFilter=({overallStats:overallStats,setVisibleFieldNames:setVisibleFieldNames,visibleFieldNames:visibleFieldNames,showEmptyFields:showEmptyFields})=>{const items=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{const options=[];if(overallStats){Object.keys(overallStats).forEach(key=>{const fieldsGroup=overallStats[key];if(Array.isArray(fieldsGroup)&&fieldsGroup.length>0){fieldsGroup.forEach(field=>{if((field.existsInDocs===true||showEmptyFields===true)&&field.fieldName!==undefined){options.push({value:field.fieldName})}})}})}return options},[overallStats]);const fieldNameTitle=Object(external_kbnSharedDeps_React_["useMemo"])(()=>external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataVisualizer.indexBased.fieldNameSelect",{defaultMessage:"Field name"}),[]);return external_kbnSharedDeps_React_default.a.createElement(MultiSelectPicker,{title:fieldNameTitle,options:items,onChange:setVisibleFieldNames,checkedOptions:visibleFieldNames,dataTestSubj:"mlDataVisualizerFieldNameSelect"})};function field_type_icon_extends(){field_type_icon_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return field_type_icon_extends.apply(this,arguments)}const FieldTypeIcon=({tooltipEnabled:tooltipEnabled=false,type:type,fieldName:fieldName,needsAria:needsAria=true})=>{const ariaLabel=getMLJobTypeAriaLabel(type);let iconType="questionInCircle";let color="euiColorVis6";switch(type){case field_types["c"].BOOLEAN:iconType="tokenBoolean";color="euiColorVis5";break;case field_types["c"].DATE:iconType="tokenDate";color="euiColorVis7";break;case field_types["c"].GEO_POINT:case field_types["c"].GEO_SHAPE:iconType="tokenGeo";color="euiColorVis8";break;case field_types["c"].TEXT:iconType="document";color="euiColorVis9";break;case field_types["c"].IP:iconType="tokenIP";color="euiColorVis3";break;case field_types["c"].KEYWORD:iconType="tokenText";color="euiColorVis0";break;case field_types["c"].NUMBER:iconType="tokenNumber";color=fieldName!==undefined?"euiColorVis1":"euiColorVis2";break;case field_types["c"].UNKNOWN:break}const containerProps={ariaLabel:ariaLabel,iconType:iconType,color:color,needsAria:needsAria};if(tooltipEnabled===true){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{position:"left",content:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fieldTypeIcon.fieldTypeTooltip",{defaultMessage:"{type} type",values:{type:type}})},external_kbnSharedDeps_React_default.a.createElement(FieldTypeIconContainer,containerProps))}return external_kbnSharedDeps_React_default.a.createElement(FieldTypeIconContainer,containerProps)};const FieldTypeIconContainer=({ariaLabel:ariaLabel,iconType:iconType,color:color,needsAria:needsAria,...rest})=>{const wrapperProps={className:"field-type-icon"};if(needsAria&&ariaLabel){wrapperProps["aria-label"]=ariaLabel}return external_kbnSharedDeps_React_default.a.createElement("span",field_type_icon_extends({"data-test-subj":"mlFieldTypeIcon"},rest),external_kbnSharedDeps_React_default.a.createElement("span",wrapperProps,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToken"],{iconType:iconType,shape:"square",size:"s",color:color})))};const ML_JOB_FIELD_TYPES_OPTIONS={[field_types["c"].BOOLEAN]:{name:"Boolean",icon:"tokenBoolean"},[field_types["c"].DATE]:{name:"Date",icon:"tokenDate"},[field_types["c"].GEO_POINT]:{name:"Geo point",icon:"tokenGeo"},[field_types["c"].GEO_SHAPE]:{name:"Geo shape",icon:"tokenGeo"},[field_types["c"].IP]:{name:"IP address",icon:"tokenIP"},[field_types["c"].KEYWORD]:{name:"Keyword",icon:"tokenKeyword"},[field_types["c"].NUMBER]:{name:"Number",icon:"tokenNumber"},[field_types["c"].TEXT]:{name:"Text",icon:"tokenString"},[field_types["c"].UNKNOWN]:{name:"Unknown"}};const DatavisualizerFieldTypeFilter=({indexedFieldTypes:indexedFieldTypes,setVisibleFieldTypes:setVisibleFieldTypes,visibleFieldTypes:visibleFieldTypes})=>{const options=Object(external_kbnSharedDeps_React_["useMemo"])(()=>indexedFieldTypes.map(indexedFieldName=>{const item=ML_JOB_FIELD_TYPES_OPTIONS[indexedFieldName];return{value:indexedFieldName,name:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:true}," ",item.name),indexedFieldName&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(FieldTypeIcon,{type:indexedFieldName,fieldName:item.name,tooltipEnabled:false,needsAria:true})))}}),[indexedFieldTypes]);const fieldTypeTitle=Object(external_kbnSharedDeps_React_["useMemo"])(()=>external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataVisualizer.indexBased.fieldTypeSelect",{defaultMessage:"Field type"}),[]);return external_kbnSharedDeps_React_default.a.createElement(MultiSelectPicker,{title:fieldTypeTitle,options:options,onChange:setVisibleFieldTypes,checkedOptions:visibleFieldTypes,dataTestSubj:"mlDataVisualizerFieldTypeSelect"})};const SearchPanel=({indexPattern:indexPattern,searchString:searchString,searchQueryLanguage:searchQueryLanguage,samplerShardSize:samplerShardSize,setSamplerShardSize:setSamplerShardSize,overallStats:overallStats,indexedFieldTypes:indexedFieldTypes,setVisibleFieldTypes:setVisibleFieldTypes,visibleFieldTypes:visibleFieldTypes,setVisibleFieldNames:setVisibleFieldNames,visibleFieldNames:visibleFieldNames,setSearchParams:setSearchParams,showEmptyFields:showEmptyFields})=>{const[searchInput,setSearchInput]=Object(external_kbnSharedDeps_React_["useState"])({query:searchString||"",language:searchQueryLanguage});const[errorMessage,setErrorMessage]=Object(external_kbnSharedDeps_React_["useState"])(undefined);const searchHandler=query=>{let filterQuery;try{if(query.language===constants_search["c"].KUERY){filterQuery=data_public_["esKuery"].toElasticsearchQuery(data_public_["esKuery"].fromKueryExpression(query.query),indexPattern)}else if(query.language===constants_search["c"].LUCENE){filterQuery=data_public_["esQuery"].luceneStringToDsl(query.query)}else{filterQuery={}}setSearchParams({searchQuery:filterQuery,searchString:query.query,queryLanguage:query.language})}catch(e){console.log("Invalid syntax",JSON.stringify(e,null,2));setErrorMessage({query:query.query,message:e.message})}};const searchChangeHandler=query=>setSearchInput(query);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"m",alignItems:"center","data-test-subj":"mlDataVisualizerSearchPanel"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiInputPopover"],{style:{maxWidth:"100%"},closePopover:()=>setErrorMessage(undefined),input:external_kbnSharedDeps_React_default.a.createElement(data_public_["QueryStringInput"],{bubbleSubmitEvent:false,query:searchInput,indexPatterns:[indexPattern],onChange:searchChangeHandler,onSubmit:searchHandler,placeholder:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.datavisualizer.searchPanel.queryBarPlaceholderText",{defaultMessage:'Search… (e.g. status:200 AND extension:"PHP")'}),disableAutoFocus:true,dataTestSubj:"mlDataVisualizerQueryInput",languageSwitcherPopoverAnchorPosition:"rightDown"}),isOpen:(errorMessage===null||errorMessage===void 0?void 0:errorMessage.query)===searchInput.query&&(errorMessage===null||errorMessage===void 0?void 0:errorMessage.message)!==""},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCode"],null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.datavisualizer.searchPanel.invalidKuerySyntaxErrorMessageQueryBar",{defaultMessage:"Invalid query"}),": ",errorMessage===null||errorMessage===void 0?void 0:errorMessage.message.split("\n")[0]))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(ShardSizeFilter,{samplerShardSize:samplerShardSize,setSamplerShardSize:setSamplerShardSize})),external_kbnSharedDeps_React_default.a.createElement(DataVisualizerFieldNamesFilter,{overallStats:overallStats,setVisibleFieldNames:setVisibleFieldNames,visibleFieldNames:visibleFieldNames,showEmptyFields:showEmptyFields}),external_kbnSharedDeps_React_default.a.createElement(DatavisualizerFieldTypeFilter,{indexedFieldTypes:indexedFieldTypes,setVisibleFieldTypes:setVisibleFieldTypes,visibleFieldTypes:visibleFieldTypes}))};const document_count_chart_SPEC_ID="document_count";const DocumentCountChart=({width:width,chartPoints:chartPoints,timeRangeEarliest:timeRangeEarliest,timeRangeLatest:timeRangeLatest})=>{const seriesName=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fieldDataCard.documentCountChart.seriesLabel",{defaultMessage:"document count"});const xDomain={min:timeRangeEarliest,max:timeRangeLatest};const dateFormatter=Object(external_kbnSharedDeps_ElasticCharts_["niceTimeFormatter"])([timeRangeEarliest,timeRangeLatest]);return external_kbnSharedDeps_React_default.a.createElement("div",{style:{width:width!==null&&width!==void 0?width:"100%"},"data-test-subj":"mlFieldDataDocumentCountChart"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Chart"],{size:{width:"100%",height:120}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Settings"],{xDomain:xDomain}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Axis"],{id:"bottom",position:external_kbnSharedDeps_ElasticCharts_["Position"].Bottom,showOverlappingTicks:true,tickFormat:dateFormatter}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Axis"],{id:"left",position:external_kbnSharedDeps_ElasticCharts_["Position"].Left}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["BarSeries"],{id:document_count_chart_SPEC_ID,name:seriesName,xScaleType:external_kbnSharedDeps_ElasticCharts_["ScaleType"].Time,yScaleType:external_kbnSharedDeps_ElasticCharts_["ScaleType"].Linear,xAccessor:"time",yAccessors:["value"],data:chartPoints.length>0?chartPoints:[{time:timeRangeEarliest,value:0}]})))};const TotalCountHeader=({totalCount:totalCount})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s","data-test-subj":"mlDataVisualizerTotalDocCountHeader"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.datavisualizer.searchPanel.totalDocCountLabel",defaultMessage:"Total documents: {strongTotalCount}",values:{strongTotalCount:external_kbnSharedDeps_React_default.a.createElement("strong",{"data-test-subj":"mlDataVisualizerTotalDocCount"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.datavisualizer.searchPanel.totalDocCountNumber",defaultMessage:"{totalCount, plural, one {#} other {#}}",values:{totalCount:totalCount}}))}})));const DocumentCountContent=({config:config,totalCount:totalCount})=>{if((config===null||config===void 0?void 0:config.stats)===undefined){return totalCount!==undefined?external_kbnSharedDeps_React_default.a.createElement(TotalCountHeader,{totalCount:totalCount}):null}const{documentCounts:documentCounts,timeRangeEarliest:timeRangeEarliest,timeRangeLatest:timeRangeLatest}=config.stats;if(documentCounts===undefined||timeRangeEarliest===undefined||timeRangeLatest===undefined)return null;let chartPoints=[];if(documentCounts.buckets!==undefined){const buckets=documentCounts===null||documentCounts===void 0?void 0:documentCounts.buckets;chartPoints=Object.entries(buckets).map(([time,value])=>({time:+time,value:value}))}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(TotalCountHeader,{totalCount:totalCount}),external_kbnSharedDeps_React_default.a.createElement(DocumentCountChart,{chartPoints:chartPoints,timeRangeEarliest:timeRangeEarliest,timeRangeLatest:timeRangeLatest}))};var round_to_decimal_place=__webpack_require__(143);const DocumentStat=({config:config})=>{const{stats:stats}=config;if(stats===undefined)return null;const{count:count,sampleCount:sampleCount}=stats;if(count===undefined||sampleCount===undefined)return null;const docsPercent=Object(round_to_decimal_place["a"])(count/sampleCount*100);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{className:"mlDataVisualizerColumnHeaderIcon"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:"document",size:"s"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("b",null,count)," (",docsPercent,"%)"))};const DistinctValues=({cardinality:cardinality})=>{if(cardinality===undefined)return null;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{className:"mlDataVisualizerColumnHeaderIcon"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:"database",size:"s"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("b",null,cardinality)))};var classnames=__webpack_require__(157);var classnames_default=__webpack_require__.n(classnames);function kibanaFieldFormat(value,fieldFormat){if(fieldFormat!==undefined&&fieldFormat!==null){return fieldFormat.convert(value,"text")}else{return value}}const MetricDistributionChartTooltipHeader=({chartPoint:chartPoint,maxWidth:maxWidth,fieldFormat:fieldFormat})=>{if(chartPoint===undefined){return null}return external_kbnSharedDeps_React_default.a.createElement("div",{style:{maxWidth:maxWidth}},chartPoint.dataMax>chartPoint.dataMin?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fieldDataCard.metricDistributionChart.tooltipValueBetweenLabel",defaultMessage:"{percent}% of documents have values between {minValFormatted} and {maxValFormatted}",values:{percent:chartPoint.percent,minValFormatted:kibanaFieldFormat(chartPoint.dataMin,fieldFormat),maxValFormatted:kibanaFieldFormat(chartPoint.dataMax,fieldFormat)}}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fieldDataCard.metricDistributionChart.tooltipValueEqualLabel",defaultMessage:"{percent}% of documents have a value of {valFormatted}",values:{percent:chartPoint.percent,valFormatted:kibanaFieldFormat(chartPoint.dataMin,fieldFormat)}}))};var color_range_legend=__webpack_require__(139);const useDataVizChartTheme=()=>{const{euiTheme:euiTheme}=Object(color_range_legend["e"])();const chartTheme=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{const AREA_SERIES_COLOR=euiTheme.euiColorVis0;return{axes:{tickLabel:{fontSize:parseInt(euiTheme.euiFontSizeXS,10),fontFamily:euiTheme.euiFontFamily,fontStyle:"italic"}},background:{color:"transparent"},chartMargins:{left:0,right:0,top:0,bottom:0},chartPaddings:{left:0,right:0,top:4,bottom:0},scales:{barsPadding:.1},colors:{vizColors:[AREA_SERIES_COLOR]},areaSeriesStyle:{line:{strokeWidth:1,visible:true},point:{visible:false,radius:0,opacity:0},area:{visible:true,opacity:1}}}},[euiTheme]);return chartTheme};const metric_distribution_chart_SPEC_ID="metric_distribution";const MetricDistributionChart=({width:width,height:height,chartData:chartData,fieldFormat:fieldFormat,hideXAxis:hideXAxis})=>{const seriesName=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fieldDataCard.metricDistributionChart.seriesName",{defaultMessage:"distribution"});const theme=useDataVizChartTheme();const headerFormatter=tooltipData=>{const xValue=tooltipData.value;const chartPoint=chartData.find(data=>data.x===xValue);return external_kbnSharedDeps_React_default.a.createElement(MetricDistributionChartTooltipHeader,{chartPoint:chartPoint,maxWidth:width/2,fieldFormat:fieldFormat})};return external_kbnSharedDeps_React_default.a.createElement("div",{"data-test-subj":"mlFieldDataMetricDistributionChart"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Chart"],{size:{width:width,height:height}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Settings"],{theme:theme,tooltip:{headerFormatter:headerFormatter}}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Axis"],{id:"bottom",position:external_kbnSharedDeps_ElasticCharts_["Position"].Bottom,tickFormat:d=>kibanaFieldFormat(d,fieldFormat),hide:hideXAxis===true}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Axis"],{id:"left",position:external_kbnSharedDeps_ElasticCharts_["Position"].Left,tickFormat:d=>d.toFixed(3),hide:true}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["AreaSeries"],{id:metric_distribution_chart_SPEC_ID,name:seriesName,xScaleType:external_kbnSharedDeps_ElasticCharts_["ScaleType"].Linear,yScaleType:external_kbnSharedDeps_ElasticCharts_["ScaleType"].Linear,xAccessor:"x",yAccessors:["y"],data:chartData.length>0?chartData:[{x:0,y:0}],curve:external_kbnSharedDeps_ElasticCharts_["CurveType"].CURVE_STEP_AFTER})))};const METRIC_DISTRIBUTION_CHART_MIN_BAR_WIDTH=3;const METRIC_DISTRIBUTION_CHART_MAX_BAR_HEIGHT_FACTOR=20;function buildChartDataFromStats(stats,chartWidth){let chartData=[];const distribution=stats.distribution;if(distribution===undefined){return chartData}const percentiles=distribution.percentiles;if(percentiles.length===0){return chartData}const minX=percentiles[0].minValue;const maxX=percentiles[percentiles.length-1].maxValue;let xAxisMin=minX;let xAxisMax=maxX;if(maxX===minX){if(minX!==0){xAxisMin=0;xAxisMax=2*minX}else{xAxisMax=1}}const minBarWidth=METRIC_DISTRIBUTION_CHART_MIN_BAR_WIDTH/chartWidth*(xAxisMax-xAxisMin);const processedData=[];let lastBar;percentiles.forEach((data,index)=>{if(index===0){const bar={x0:data.minValue,x1:Math.max(data.minValue+minBarWidth,data.maxValue),y:0,dataMin:data.minValue,dataMax:data.maxValue,percent:data.percent,isMinWidth:false};bar.y=data.percent/(bar.x1-bar.x0)*Math.max(1,minBarWidth/Math.max(data.maxValue-data.minValue,.5*minBarWidth));bar.isMinWidth=data.maxValue<=data.minValue+minBarWidth;processedData.push(bar);lastBar=bar}else{if(lastBar.isMinWidth===false||data.maxValue>lastBar.x1){const bar={x0:lastBar.x1,x1:Math.max(lastBar.x1+minBarWidth,data.maxValue),y:0,dataMin:data.minValue,dataMax:data.maxValue,percent:data.percent,isMinWidth:false};bar.y=data.percent/(bar.x1-bar.x0)*Math.max(1,minBarWidth/Math.max(data.maxValue-data.minValue,.5*minBarWidth));bar.isMinWidth=data.maxValue<=lastBar.x1+minBarWidth;processedData.push(bar);lastBar=bar}else{lastBar.percent=lastBar.percent+data.percent;lastBar.y=lastBar.percent/(lastBar.x1-lastBar.x0);lastBar.dataMax=data.maxValue}}});if(maxX!==minX){xAxisMax=processedData[processedData.length-1].x1}let barHeights=processedData.map(data=>data.y);barHeights=barHeights.sort((a,b)=>a-b);let maxBarHeight=0;const processedDataLength=processedData.length;if(Math.abs(processedDataLength%2)===1){maxBarHeight=METRIC_DISTRIBUTION_CHART_MAX_BAR_HEIGHT_FACTOR*barHeights[Math.floor(processedDataLength/2)]}else{maxBarHeight=METRIC_DISTRIBUTION_CHART_MAX_BAR_HEIGHT_FACTOR*(barHeights[Math.floor(processedDataLength/2)-1]+barHeights[Math.floor(processedDataLength/2)])/2}processedData.forEach(data=>{data.y=Math.min(data.y,maxBarHeight)});chartData=processedData.map(data=>{const{x0:x0,y:y,dataMin:dataMin,dataMax:dataMax,percent:percent}=data;return{x:x0,y:y,dataMin:dataMin,dataMax:dataMax,percent:percent}});const last=processedData[processedData.length-1];chartData.push({x:last.x1,y:0,dataMin:last.dataMin,dataMax:last.dataMax,percent:last.percent});return chartData}var format_value=__webpack_require__(117);const METRIC_DISTRIBUTION_CHART_WIDTH=150;const METRIC_DISTRIBUTION_CHART_HEIGHT=80;const IndexBasedNumberContentPreview=({config:config})=>{const{stats:stats,fieldFormat:fieldFormat,fieldName:fieldName}=config;const defaultChartData=[];const[distributionChartData,setDistributionChartData]=Object(external_kbnSharedDeps_React_["useState"])(defaultChartData);const[legendText,setLegendText]=Object(external_kbnSharedDeps_React_["useState"])();const dataTestSubj=`mlDataGridChart-${fieldName}`;Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const chartData=buildChartDataFromStats(stats,METRIC_DISTRIBUTION_CHART_WIDTH);if(Array.isArray(chartData)&&chartData[0].x!==undefined&&chartData[chartData.length-1].x!==undefined){setDistributionChartData(chartData);setLegendText({min:Object(format_value["a"])(chartData[0].x),max:Object(format_value["a"])(chartData[chartData.length-1].x)})}},[]);return external_kbnSharedDeps_React_default.a.createElement("div",{"data-test-subj":dataTestSubj},external_kbnSharedDeps_React_default.a.createElement("div",{className:"mlDataGridChart__histogram","data-test-subj":`${dataTestSubj}-histogram`},external_kbnSharedDeps_React_default.a.createElement(MetricDistributionChart,{width:METRIC_DISTRIBUTION_CHART_WIDTH,height:METRIC_DISTRIBUTION_CHART_HEIGHT,chartData:distributionChartData,fieldFormat:fieldFormat,hideXAxis:true})),external_kbnSharedDeps_React_default.a.createElement("div",{className:"mlDataGridChart__legend","data-test-subj":`${dataTestSubj}-legend`},legendText&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"row","data-test-subj":`${dataTestSubj}-legend`},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{className:"mlDataGridChart__legend"},kibanaFieldFormat(legendText.min,fieldFormat)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{className:classnames_default()("mlDataGridChart__legend","mlDataGridChart__legend--numeric")},kibanaFieldFormat(legendText.max,fieldFormat))))))};var use_table_settings=__webpack_require__(300);var column_chart=__webpack_require__(226);const TopValuesPreview=({config:config})=>{const{stats:stats}=config;if(stats===undefined)return null;const{topValues:topValues,cardinality:cardinality}=stats;if(cardinality===undefined||topValues===undefined||config.fieldName===undefined)return null;const data=topValues.map(d=>({...d,key:d.key.toString()}));const chartData={cardinality:cardinality,data:data,id:config.fieldName,type:"ordinal"};const columnType={id:config.fieldName,schema:undefined};return external_kbnSharedDeps_React_default.a.createElement(column_chart["a"],{chartData:chartData,columnType:columnType,dataTestSubj:`mlDataGridChart-${config.fieldName}`,hideLabel:true,maxChartColumns:10})};function isFileBasedFieldVisConfig(field){return!field.hasOwnProperty("existsInDocs")}function isIndexBasedFieldVisConfig(field){return field.hasOwnProperty("existsInDocs")}const FileBasedNumberContentPreview=({config:config})=>{const stats=config.stats;if(stats===undefined||stats.min===undefined||stats.median===undefined||stats.max===undefined)return null;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"column",gutterSize:"xs"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xs"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement("b",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.fieldStatsCard.minTitle",defaultMessage:"min"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement("b",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.fieldStatsCard.medianTitle",defaultMessage:"median"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement("b",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.fieldStatsCard.maxTitle",defaultMessage:"max"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xs"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,stats.min),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,stats.median),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,stats.max)))};const getTFPercentage=config=>{const{stats:stats}=config;if(stats===undefined)return null;const{count:count}=stats;let{trueCount:trueCount,falseCount:falseCount}=stats;if(stats.trueCount===undefined||stats.falseCount===undefined){var _config$stats;if(config!==null&&config!==void 0&&(_config$stats=config.stats)!==null&&_config$stats!==void 0&&_config$stats.topValues){config.stats.topValues.forEach(doc=>{if(doc.doc_count!==undefined){if(doc.key.toString().toLowerCase()==="false"){falseCount=doc.doc_count}if(doc.key.toString().toLowerCase()==="true"){trueCount=doc.doc_count}}})}}if(count===undefined||trueCount===undefined||falseCount===undefined)return null;return{count:count,trueCount:trueCount,falseCount:falseCount}};const BooleanContentPreview=({config:config})=>{const chartData=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{const results=getTFPercentage(config);if(results){const data=[{key:"true",key_as_string:"true",doc_count:results.trueCount},{key:"false",key_as_string:"false",doc_count:results.falseCount}];return{id:config.fieldName,cardinality:2,data:data,type:"boolean"}}},[config]);if(!chartData||config.fieldName===undefined)return null;const columnType={id:config.fieldName,schema:undefined};const dataTestSubj=`mlDataGridChart-${config.fieldName}`;return external_kbnSharedDeps_React_default.a.createElement(column_chart["a"],{dataTestSubj:dataTestSubj,chartData:chartData,columnType:columnType,hideLabel:true})};const FIELD_NAME="fieldName";const DataVisualizerTable=({items:items,pageState:pageState,updatePageState:updatePageState,getItemIdToExpandedRowMap:getItemIdToExpandedRowMap,extendedColumns:extendedColumns})=>{var _ref;const[expandedRowItemIds,setExpandedRowItemIds]=Object(external_kbnSharedDeps_React_["useState"])([]);const[expandAll,toggleExpandAll]=Object(external_kbnSharedDeps_React_["useState"])(false);const{onTableChange:onTableChange,pagination:pagination,sorting:sorting}=Object(use_table_settings["a"])(items,pageState,updatePageState);const showDistributions=(_ref="showDistributions"in pageState&&pageState.showDistributions)!==null&&_ref!==void 0?_ref:true;const toggleShowDistribution=()=>{updatePageState({...pageState,showDistributions:!showDistributions})};function toggleDetails(item){if(item.fieldName===undefined)return;const index=expandedRowItemIds.indexOf(item.fieldName);if(index!==-1){expandedRowItemIds.splice(index,1)}else{expandedRowItemIds.push(item.fieldName)}setExpandedRowItemIds([...expandedRowItemIds])}const columns=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{const expanderColumn={name:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{"data-test-subj":`mlToggleDetailsForAllRowsButton ${expandAll?"expanded":"collapsed"}`,onClick:()=>toggleExpandAll(!expandAll),"aria-label":!expandAll?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.datavisualizer.dataGrid.expandDetailsForAllAriaLabel",{defaultMessage:"Expand details for all fields"}):external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.datavisualizer.dataGrid.collapseDetailsForAllAriaLabel",{defaultMessage:"Collapse details for all fields"}),iconType:expandAll?"arrowUp":"arrowDown"}),align:external_kbnSharedDeps_ElasticEui_["RIGHT_ALIGNMENT"],width:"40px",isExpander:true,render:item=>{if(item.fieldName===undefined)return null;const direction=expandedRowItemIds.includes(item.fieldName)?"arrowUp":"arrowDown";return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{"data-test-subj":`mlDataVisualizerDetailsToggle-${item.fieldName}-${direction}`,onClick:()=>toggleDetails(item),"aria-label":expandedRowItemIds.includes(item.fieldName)?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.datavisualizer.dataGrid.rowCollapse",{defaultMessage:"Hide details for {fieldName}",values:{fieldName:item.fieldName}}):external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.datavisualizer.dataGrid.rowExpand",{defaultMessage:"Show details for {fieldName}",values:{fieldName:item.fieldName}}),iconType:direction})},"data-test-subj":"mlDataVisualizerTableColumnDetailsToggle"};const baseColumns=[expanderColumn,{field:"type",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.datavisualizer.dataGrid.typeColumnName",{defaultMessage:"Type"}),render:fieldType=>external_kbnSharedDeps_React_default.a.createElement(FieldTypeIcon,{type:fieldType,tooltipEnabled:true,needsAria:true}),width:"75px",sortable:true,align:external_kbnSharedDeps_ElasticEui_["CENTER_ALIGNMENT"],"data-test-subj":"mlDataVisualizerTableColumnType"},{field:"fieldName",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.datavisualizer.dataGrid.nameColumnName",{defaultMessage:"Name"}),sortable:true,truncateText:true,render:fieldName=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("b",null,fieldName)),align:external_kbnSharedDeps_ElasticEui_["LEFT_ALIGNMENT"],"data-test-subj":"mlDataVisualizerTableColumnName"},{field:"docCount",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.datavisualizer.dataGrid.documentsCountColumnName",{defaultMessage:"Documents (%)"}),render:(value,item)=>external_kbnSharedDeps_React_default.a.createElement(DocumentStat,{config:item}),sortable:item=>{var _item$stats;return item===null||item===void 0?void 0:(_item$stats=item.stats)===null||_item$stats===void 0?void 0:_item$stats.count},align:external_kbnSharedDeps_ElasticEui_["LEFT_ALIGNMENT"],"data-test-subj":"mlDataVisualizerTableColumnDocumentsCount"},{field:"stats.cardinality",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.datavisualizer.dataGrid.distinctValuesColumnName",{defaultMessage:"Distinct values"}),render:cardinality=>external_kbnSharedDeps_React_default.a.createElement(DistinctValues,{cardinality:cardinality}),sortable:true,align:external_kbnSharedDeps_ElasticEui_["LEFT_ALIGNMENT"],"data-test-subj":"mlDataVisualizerTableColumnDistinctValues"},{name:external_kbnSharedDeps_React_default.a.createElement("div",{style:{display:"flex",alignItems:"center"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:"visBarVertical",style:{paddingRight:4}}),external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.datavisualizer.dataGrid.distributionsColumnName",{defaultMessage:"Distributions"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{style:{marginLeft:4},size:"s",iconType:showDistributions?"eye":"eyeClosed",onClick:()=>toggleShowDistribution(),"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.datavisualizer.dataGrid.showDistributionsAriaLabel",{defaultMessage:"Show distributions"})})),render:item=>{var _item$stats2;if(item===undefined||showDistributions===false)return null;if((item.type===field_types["c"].KEYWORD||item.type===field_types["c"].IP)&&((_item$stats2=item.stats)===null||_item$stats2===void 0?void 0:_item$stats2.topValues)!==undefined){return external_kbnSharedDeps_React_default.a.createElement(TopValuesPreview,{config:item})}if(item.type===field_types["c"].NUMBER){var _item$stats3;if(isIndexBasedFieldVisConfig(item)&&((_item$stats3=item.stats)===null||_item$stats3===void 0?void 0:_item$stats3.distribution)!==undefined){return external_kbnSharedDeps_React_default.a.createElement(IndexBasedNumberContentPreview,{config:item})}else{return external_kbnSharedDeps_React_default.a.createElement(FileBasedNumberContentPreview,{config:item})}}if(item.type===field_types["c"].BOOLEAN){return external_kbnSharedDeps_React_default.a.createElement(BooleanContentPreview,{config:item})}return null},align:external_kbnSharedDeps_ElasticEui_["LEFT_ALIGNMENT"],"data-test-subj":"mlDataVisualizerTableColumnDistribution"}];return extendedColumns?[...baseColumns,...extendedColumns]:baseColumns},[expandAll,showDistributions,updatePageState,extendedColumns]);const itemIdToExpandedRowMap=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{let itemIds=expandedRowItemIds;if(expandAll){itemIds=items.map(i=>i[FIELD_NAME]).filter(f=>f!==undefined)}return getItemIdToExpandedRowMap(itemIds,items)},[expandAll,items,expandedRowItemIds]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{"data-test-subj":"mlDataVisualizerTableContainer"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiInMemoryTable"],{className:"mlDataVisualizer",items:items,itemId:FIELD_NAME,columns:columns,pagination:pagination,sorting:sorting,isExpandable:true,itemIdToExpandedRowMap:itemIdToExpandedRowMap,isSelectable:false,onTableChange:onTableChange,"data-test-subj":"mlDataVisualizerTable",rowProps:item=>({"data-test-subj":`mlDataVisualizerRow row-${item.fieldName}`})}))};const TotalFieldsCount=({fieldsCountStats:fieldsCountStats})=>{if(!fieldsCountStats||fieldsCountStats.visibleFieldsCount===undefined||fieldsCountStats.totalFieldsCount===undefined)return null;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"s",alignItems:"center",className:"mlDataVisualizerFieldCountContainer","data-test-subj":"mlDataVisualizerFieldsSummary"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement("h5",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataVisualizer.searchPanel.allFieldsLabel",defaultMessage:"All fields"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiNotificationBadge"],{color:"subdued",size:"m","data-test-subj":"mlDataVisualizerVisibleFieldsCount"},external_kbnSharedDeps_React_default.a.createElement("strong",null,fieldsCountStats.visibleFieldsCount))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{color:"subdued",size:"s","data-test-subj":"mlDataVisualizerTotalFieldsCount"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataVisualizer.searchPanel.ofFieldsTotal",defaultMessage:"of {totalCount} total",values:{totalCount:fieldsCountStats.totalFieldsCount}}))))};const MetricFieldsCount=({metricsStats:metricsStats})=>{if(!metricsStats||metricsStats.visibleMetricsCount===undefined||metricsStats.totalMetricFieldsCount===undefined)return null;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,metricsStats&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"s",alignItems:"center",className:"mlDataVisualizerFieldCountContainer","data-test-subj":"mlDataVisualizerMetricFieldsSummary"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement("h5",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataVisualizer.searchPanel.numberFieldsLabel",defaultMessage:"Number fields"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiNotificationBadge"],{color:"subdued",size:"m","data-test-subj":"mlDataVisualizerVisibleMetricFieldsCount"},external_kbnSharedDeps_React_default.a.createElement("strong",null,metricsStats.visibleMetricsCount))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{color:"subdued",size:"s","data-test-subj":"mlDataVisualizerMetricFieldsCount"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataVisualizer.searchPanel.ofFieldsTotal",defaultMessage:"of {totalCount} total",values:{totalCount:metricsStats.totalMetricFieldsCount}})))))};const FieldCountPanel=({metricsStats:metricsStats,fieldsCountStats:fieldsCountStats,showEmptyFields:showEmptyFields,toggleShowEmptyFields:toggleShowEmptyFields})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center",gutterSize:"xs",style:{marginLeft:4},"data-test-subj":"mlDataVisualizerFieldCountPanel"},external_kbnSharedDeps_React_default.a.createElement(TotalFieldsCount,{fieldsCountStats:fieldsCountStats}),external_kbnSharedDeps_React_default.a.createElement(MetricFieldsCount,{metricsStats:metricsStats}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{"data-test-subj":"mlDataVisualizerShowEmptyFieldsSwitch",label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataVisualizer.searchPanel.showEmptyFields",defaultMessage:"Show empty fields"}),checked:showEmptyFields,onChange:toggleShowEmptyFields})));var field_histograms=__webpack_require__(287);function data_loader_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const MAX_EXAMPLES_DEFAULT=10;class data_loader_DataLoader{constructor(indexPattern,toastNotifications){data_loader_defineProperty(this,"_indexPattern",void 0);data_loader_defineProperty(this,"_indexPatternTitle","");data_loader_defineProperty(this,"_maxExamples",MAX_EXAMPLES_DEFAULT);data_loader_defineProperty(this,"_toastNotifications",void 0);this._indexPattern=indexPattern;this._indexPatternTitle=indexPattern.title;this._toastNotifications=toastNotifications}async loadOverallData(query,samplerShardSize,earliest,latest){const aggregatableFields=[];const nonAggregatableFields=[];this._indexPattern.fields.forEach(field=>{const fieldName=field.displayName!==undefined?field.displayName:field.name;if(this.isDisplayField(fieldName)===true){if(field.aggregatable===true&&field.type!==data_public_["KBN_FIELD_TYPES"].GEO_SHAPE){aggregatableFields.push(fieldName)}else{nonAggregatableFields.push(fieldName)}}});const stats=await ml_api_service["ml"].getVisualizerOverallStats({indexPatternTitle:this._indexPatternTitle,query:query,timeFieldName:this._indexPattern.timeFieldName,samplerShardSize:samplerShardSize,earliest:earliest,latest:latest,aggregatableFields:aggregatableFields,nonAggregatableFields:nonAggregatableFields});return stats}async loadFieldStats(query,samplerShardSize,earliest,latest,fields,interval){const stats=await ml_api_service["ml"].getVisualizerFieldStats({indexPatternTitle:this._indexPatternTitle,query:query,timeFieldName:this._indexPattern.timeFieldName,earliest:earliest,latest:latest,samplerShardSize:samplerShardSize,interval:interval,fields:fields,maxExamples:this._maxExamples});return stats}async loadFieldHistograms(fields,query,samplerShardSize=field_histograms["a"]){const stats=await ml_api_service["ml"].getVisualizerFieldHistograms({indexPatternTitle:this._indexPatternTitle,query:query,fields:fields,samplerShardSize:samplerShardSize});return stats}displayError(err){if(err.statusCode===500){this._toastNotifications.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.datavisualizer.dataLoader.internalServerErrorMessage",{defaultMessage:"Error loading data in index {index}. {message}. "+"The request may have timed out. Try using a smaller sample size or narrowing the time range.",values:{index:this._indexPattern.title,message:err.message}}))}else{this._toastNotifications.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.datavisualizer.page.errorLoadingDataMessage",{defaultMessage:"Error loading data in index {index}. {message}",values:{index:this._indexPattern.title,message:err.message}}))}}set maxExamples(max){this._maxExamples=max}get maxExamples(){return this._maxExamples}isDisplayField(fieldName){return!field_types["d"].includes(fieldName)}}const LoadingIndicator=()=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xxl"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceAround"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLoadingSpinner"],{size:"l"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceAround"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{color:"subdued"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fieldDataCard.loadingLabel",defaultMessage:"Loading"})))));const NotInDocsContent=()=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xxl"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{textAlign:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:"alert"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{textAlign:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fieldDataCard.fieldNotInDocsLabel",defaultMessage:"This field does not appear in any documents for the selected time range"})));const ExpandedRowFieldHeader=({children:children})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",color:"subdued",className:"mlFieldDataCard__valuesTitle"},children);const metaTableColumns=[{name:"",render:metaItem=>metaItem.display,width:"75px"},{field:"value",name:"",render:v=>external_kbnSharedDeps_React_default.a.createElement("strong",null,v)}];const metaTableTitle=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fieldDataCardExpandedRow.documentStatsTable.metaTableTitle",{defaultMessage:"Documents stats"});const DocumentStatsTable=({config:config})=>{if((config===null||config===void 0?void 0:config.stats)===undefined||config.stats.cardinality===undefined||config.stats.count===undefined||config.stats.sampleCount===undefined)return null;const{cardinality:cardinality,count:count,sampleCount:sampleCount}=config.stats;const metaTableItems=[{function:"count",display:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fieldDataCardExpandedRow.documentStatsTable.countLabel",defaultMessage:"count"}),value:count},{function:"percentage",display:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fieldDataCardExpandedRow.documentStatsTable.percentageLabel",defaultMessage:"percentage"}),value:`${Object(round_to_decimal_place["a"])(count/sampleCount*100)}%`},{function:"distinctValues",display:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fieldDataCardExpandedRow.documentStatsTable.distinctValueLabel",defaultMessage:"distinct values"}),value:cardinality}];return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{"data-test-subj":"mlDVDocumentStatsContent",className:"mlDataVisualizerSummaryTableWrapper"},external_kbnSharedDeps_React_default.a.createElement(ExpandedRowFieldHeader,null,metaTableTitle),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBasicTable"],{className:"mlDataVisualizerSummaryTable",compressed:true,items:metaTableItems,columns:metaTableColumns,tableCaption:metaTableTitle}))};const ExpandedRowContent=({children:children,dataTestSubj:dataTestSubj})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{"data-test-subj":dataTestSubj,gutterSize:"xl",className:"mlDataVisualizerExpandedRow"},children);function getPercentLabel(value){if(value===0){return"0%"}if(value>=.1){return`${Object(round_to_decimal_place["a"])(value)}%`}else{return"< 0.1%"}}function getFormattedValue(value,totalCount){const percentage=value/totalCount*100;return`${value} (${getPercentLabel(percentage)})`}const BOOLEAN_DISTRIBUTION_CHART_HEIGHT=100;const BooleanContent=({config:config})=>{const fieldFormat="fieldFormat"in config?config.fieldFormat:undefined;const formattedPercentages=Object(external_kbnSharedDeps_React_["useMemo"])(()=>getTFPercentage(config),[config]);const theme=useDataVizChartTheme();if(!formattedPercentages)return null;const{trueCount:trueCount,falseCount:falseCount,count:count}=formattedPercentages;const summaryTableItems=[{function:"true",display:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fieldDataCardExpandedRow.booleanContent.trueCountLabel",defaultMessage:"true"}),value:getFormattedValue(trueCount,count)},{function:"false",display:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fieldDataCardExpandedRow.booleanContent.falseCountLabel",defaultMessage:"false"}),value:getFormattedValue(falseCount,count)}];const summaryTableColumns=[{name:"",render:summaryItem=>summaryItem.display,width:"75px"},{field:"value",name:"",render:v=>external_kbnSharedDeps_React_default.a.createElement("strong",null,v)}];const summaryTableTitle=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fieldDataCardExpandedRow.booleanContent.summaryTableTitle",{defaultMessage:"Summary"});return external_kbnSharedDeps_React_default.a.createElement(ExpandedRowContent,{dataTestSubj:"mlDVBooleanContent"},external_kbnSharedDeps_React_default.a.createElement(DocumentStatsTable,{config:config}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{className:"mlDataVisualizerSummaryTableWrapper"},external_kbnSharedDeps_React_default.a.createElement(ExpandedRowFieldHeader,null,summaryTableTitle),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBasicTable"],{className:"mlDataVisualizerSummaryTable",compressed:true,items:summaryTableItems,columns:summaryTableColumns,tableCaption:summaryTableTitle})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(ExpandedRowFieldHeader,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fieldDataCard.cardBoolean.valuesLabel",defaultMessage:"Values"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xs"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Chart"],{renderer:"canvas",size:{height:BOOLEAN_DISTRIBUTION_CHART_HEIGHT}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Axis"],{id:"bottom",position:"bottom",showOverlappingTicks:true}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Axis"],{id:"left2",title:"Left axis",hide:true,tickFormat:d=>getFormattedValue(d,count)}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Settings"],{showLegend:false,theme:theme}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["BarSeries"],{id:config.fieldName||fieldFormat,data:[{x:"true",count:formattedPercentages.trueCount},{x:"false",count:formattedPercentages.falseCount}],splitSeriesAccessors:["x"],stackAccessors:["x"],xAccessor:"x",xScaleType:"ordinal",yAccessors:["count"],yScaleType:"linear"}))))};var external_kbnSharedDeps_ElasticEuiLibServicesFormat_=__webpack_require__(51);const TIME_FORMAT="MMM D YYYY, HH:mm:ss.SSS";const DateContent=({config:config})=>{const{stats:stats}=config;if(stats===undefined)return null;const{earliest:earliest,latest:latest}=stats;const summaryTableTitle=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fieldDataCard.cardDate.summaryTableTitle",{defaultMessage:"Summary"});const summaryTableItems=[{function:"earliest",display:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fieldDataCard.cardDate.earliestLabel",defaultMessage:"earliest"}),value:typeof earliest==="string"?earliest:Object(external_kbnSharedDeps_ElasticEuiLibServicesFormat_["formatDate"])(earliest,TIME_FORMAT)},{function:"latest",display:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fieldDataCard.cardDate.latestLabel",defaultMessage:"latest"}),value:typeof latest==="string"?latest:Object(external_kbnSharedDeps_ElasticEuiLibServicesFormat_["formatDate"])(latest,TIME_FORMAT)}];const summaryTableColumns=[{name:"",render:summaryItem=>summaryItem.display,width:"75px"},{field:"value",name:"",render:v=>external_kbnSharedDeps_React_default.a.createElement("strong",null,v)}];return external_kbnSharedDeps_React_default.a.createElement(ExpandedRowContent,{dataTestSubj:"mlDVDateContent"},external_kbnSharedDeps_React_default.a.createElement(DocumentStatsTable,{config:config}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{className:"mlDataVisualizerSummaryTableWrapper"},external_kbnSharedDeps_React_default.a.createElement(ExpandedRowFieldHeader,null,summaryTableTitle),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBasicTable"],{className:"mlDataVisualizerSummaryTable","data-test-subj":"mlDateSummaryTable",compressed:true,items:summaryTableItems,columns:summaryTableColumns,tableCaption:summaryTableTitle,tableLayout:"auto"})))};var constants_=__webpack_require__(50);var maps_public_=__webpack_require__(57);var embeddable_public_=__webpack_require__(41);function MlEmbeddedMapComponent({layerList:layerList,mapEmbeddableInput:mapEmbeddableInput,renderTooltipContent:renderTooltipContent}){const[embeddable,setEmbeddable]=Object(external_kbnSharedDeps_React_["useState"])();const embeddableRoot=Object(external_kbnSharedDeps_React_["useRef"])(null);const baseLayers=Object(external_kbnSharedDeps_React_["useRef"])();const{services:{embeddable:embeddablePlugin,maps:mapsPlugin}}=Object(contexts_kibana["b"])();const factory=embeddablePlugin?embeddablePlugin.getEmbeddableFactory(maps_public_["MAP_SAVED_OBJECT_TYPE"]):undefined;Object(external_kbnSharedDeps_React_["useEffect"])(()=>{async function updateIndexPatternSearchLayer(){if(embeddable&&!Object(embeddable_public_["isErrorEmbeddable"])(embeddable)&&Array.isArray(layerList)&&Array.isArray(baseLayers.current)){embeddable.setLayerList([...baseLayers.current,...layerList])}}updateIndexPatternSearchLayer()},[embeddable,layerList]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{async function setupEmbeddable(){if(!factory){console.error("Map embeddable not found.");return}const input={id:Object(external_kbnSharedDeps_ElasticEui_["htmlIdGenerator"])()(),attributes:{title:""},filters:[],hidePanelTitles:true,refreshConfig:{value:0,pause:false},viewMode:embeddable_public_["ViewMode"].VIEW,isLayerTOCOpen:false,hideFilterActions:true,mapSettings:{disableInteractive:false,hideToolbarOverlay:false,hideLayerControl:false,hideViewControl:false,initialLocation:constants_["INITIAL_LOCATION"].AUTO_FIT_TO_BOUNDS,autoFitToDataBounds:true}};const embeddableObject=await factory.create(input);if(embeddableObject&&!Object(embeddable_public_["isErrorEmbeddable"])(embeddableObject)){const basemapLayerDescriptor=mapsPlugin?await mapsPlugin.createLayerDescriptors.createBasemapLayerDescriptor():null;if(basemapLayerDescriptor){baseLayers.current=[basemapLayerDescriptor];await embeddableObject.setLayerList(baseLayers.current)}}setEmbeddable(embeddableObject)}setupEmbeddable()},[]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(embeddable&&!Object(embeddable_public_["isErrorEmbeddable"])(embeddable)&&mapEmbeddableInput!==undefined){embeddable.updateInput(mapEmbeddableInput)}},[embeddable,mapEmbeddableInput]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(embeddable&&!Object(embeddable_public_["isErrorEmbeddable"])(embeddable)&&renderTooltipContent!==undefined){embeddable.setRenderTooltipContent(renderTooltipContent)}},[embeddable,renderTooltipContent]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(embeddableRoot.current&&embeddable){embeddable.render(embeddableRoot.current)}},[embeddable,embeddableRoot]);if(!embeddablePlugin){console.error("Embeddable start plugin not found");return null}if(!mapsPlugin){console.error("Maps start plugin not found");return null}return external_kbnSharedDeps_React_default.a.createElement("div",{"data-test-subj":"mlEmbeddedMapContent",className:"mlEmbeddedMapContent",ref:embeddableRoot})}const convertWKTGeoToLonLat=value=>{if(typeof value==="string"){var _parsed$groups,_parsed$groups2;const trimmedValue=value.trim().replace("POINT (","").replace(")","");const regExpSerializer=DEFAULT_GEO_REGEX;const parsed=regExpSerializer.exec(trimmedValue.trim());if((parsed===null||parsed===void 0?void 0:(_parsed$groups=parsed.groups)===null||_parsed$groups===void 0?void 0:_parsed$groups.lat)!=null&&(parsed===null||parsed===void 0?void 0:(_parsed$groups2=parsed.groups)===null||_parsed$groups2===void 0?void 0:_parsed$groups2.lon)!=null){return{lat:parseFloat(parsed.groups.lat.trim()),lon:parseFloat(parsed.groups.lon.trim())}}}};const DEFAULT_POINT_COLOR=Object(external_kbnSharedDeps_ElasticEui_["euiPaletteColorBlind"])()[0];const getGeoPointsLayer=(features,pointColor=DEFAULT_POINT_COLOR)=>({id:"geo_points",label:"Geo points",sourceDescriptor:{type:constants_["SOURCE_TYPES"].GEOJSON_FILE,__featureCollection:{features:features,type:"FeatureCollection"}},visible:true,style:{type:"VECTOR",properties:{fillColor:{type:"STATIC",options:{color:pointColor}},lineColor:{type:"STATIC",options:{color:"#fff"}},lineWidth:{type:"STATIC",options:{size:2}},iconSize:{type:"STATIC",options:{size:6}}}},type:"VECTOR"});const ExamplesList=({examples:examples})=>{if(examples===undefined||examples===null||!Array.isArray(examples)){return null}let examplesContent;if(examples.length===0){examplesContent=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fieldDataCard.examplesList.noExamplesMessage",defaultMessage:"No examples were obtained for this field"})}else{examplesContent=examples.map((example,i)=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiListGroupItem"],{className:"mlFieldDataCard__codeContent",size:"s",key:`example_${i}`,label:typeof example==="string"?example:JSON.stringify(example)}))}return external_kbnSharedDeps_React_default.a.createElement("div",{"data-test-subj":"mlFieldDataExamplesList"},external_kbnSharedDeps_React_default.a.createElement(ExpandedRowFieldHeader,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fieldDataCard.examplesList.title",defaultMessage:"{numExamples, plural, one {Value} other {Examples}}",values:{numExamples:examples.length}})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiListGroup"],{showToolTips:true,maxWidth:"s",gutterSize:"none",flush:true},examplesContent))};const DEFAULT_GEO_REGEX=RegExp("(?<lat>.+) (?<lon>.+)");const GeoPointContent=({config:config})=>{const formattedResults=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{const{stats:stats}=config;if(stats===undefined||stats.topValues===undefined)return null;if(Array.isArray(stats.topValues)){const geoPointsFeatures=[];const formattedExamples=[];for(let i=0;i<stats.topValues.length;i++){const value=stats.topValues[i];const coordinates=convertWKTGeoToLonLat(value.key);if(coordinates){const formattedGeoPoint=`(${coordinates.lat}, ${coordinates.lon})`;formattedExamples.push(coordinates);geoPointsFeatures.push({type:"Feature",id:`ml-${config.fieldName}-${i}`,geometry:{type:"Point",coordinates:[coordinates.lat,coordinates.lon]},properties:{value:formattedGeoPoint,count:value.doc_count}})}}if(geoPointsFeatures.length>0){return{examples:formattedExamples,layerList:[getGeoPointsLayer(geoPointsFeatures)]}}}},[config]);return external_kbnSharedDeps_React_default.a.createElement(ExpandedRowContent,{dataTestSubj:"mlDVGeoPointContent"},external_kbnSharedDeps_React_default.a.createElement(DocumentStatsTable,{config:config}),formattedResults&&Array.isArray(formattedResults.examples)&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(ExamplesList,{examples:formattedResults.examples})),formattedResults&&Array.isArray(formattedResults.layerList)&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{className:"mlDataVisualizerMapWrapper","data-test-subj":"mlDataVisualizerEmbeddedMap"},external_kbnSharedDeps_React_default.a.createElement(MlEmbeddedMapComponent,{layerList:formattedResults.layerList})))};function top_values_getPercentLabel(docCount,topValuesSampleSize){const percent=100*docCount/topValuesSampleSize;if(percent>=.1){return`${Object(round_to_decimal_place["a"])(percent,1)}%`}else{return"< 0.1%"}}const TopValues=({stats:stats,fieldFormat:fieldFormat,barColor:barColor,compressed:compressed})=>{if(stats===undefined)return null;const{topValues:topValues,topValuesSampleSize:topValuesSampleSize,topValuesSamplerShardSize:topValuesSamplerShardSize,count:count,isTopValuesSampled:isTopValuesSampled}=stats;const progressBarMax=isTopValuesSampled===true?topValuesSampleSize:count;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{"data-test-subj":"mlTopValues"},external_kbnSharedDeps_React_default.a.createElement(ExpandedRowFieldHeader,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fieldDataCard.topValuesLabel",defaultMessage:"Top values"})),external_kbnSharedDeps_React_default.a.createElement("div",{"data-test-subj":"mlFieldDataTopValues",className:"mlFieldDataTopValuesContainer"},Array.isArray(topValues)&&topValues.map(value=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xs",alignItems:"center",key:value.key},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,className:classnames_default()("eui-textTruncate","mlTopValuesValueLabelContainer",`mlTopValuesValueLabelContainer--${compressed===true?"small":"large"}`)},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{content:kibanaFieldFormat(value.key,fieldFormat),position:"right"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",textAlign:"right",color:"subdued"},kibanaFieldFormat(value.key,fieldFormat)))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{"data-test-subj":"mlFieldDataTopValueBar"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiProgress"],{value:value.doc_count,max:progressBarMax,color:barColor,size:"m"})),progressBarMax!==undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,className:classnames_default()("eui-textTruncate","mlTopValuesPercentLabelContainer")},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",textAlign:"left",color:"subdued"},top_values_getPercentLabel(value.doc_count,progressBarMax))))),isTopValuesSampled===true&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xs"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",textAlign:"left"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fieldDataCard.topValues.calculatedFromSampleDescription",defaultMessage:"Calculated from sample of {topValuesSamplerShardSize} documents per shard",values:{topValuesSamplerShardSize:topValuesSamplerShardSize}})))))};const KeywordContent=({config:config})=>{const{stats:stats}=config;const fieldFormat="fieldFormat"in config?config.fieldFormat:undefined;return external_kbnSharedDeps_React_default.a.createElement(ExpandedRowContent,{dataTestSubj:"mlDVKeywordContent"},external_kbnSharedDeps_React_default.a.createElement(DocumentStatsTable,{config:config}),external_kbnSharedDeps_React_default.a.createElement(TopValues,{stats:stats,fieldFormat:fieldFormat,barColor:"secondary"}))};const IpContent=({config:config})=>{const{stats:stats}=config;if(stats===undefined)return null;const{count:count,sampleCount:sampleCount,cardinality:cardinality}=stats;if(count===undefined||sampleCount===undefined||cardinality===undefined)return null;const fieldFormat="fieldFormat"in config?config.fieldFormat:undefined;return external_kbnSharedDeps_React_default.a.createElement(ExpandedRowContent,{dataTestSubj:"mlDVIPContent"},external_kbnSharedDeps_React_default.a.createElement(DocumentStatsTable,{config:config}),external_kbnSharedDeps_React_default.a.createElement(TopValues,{stats:stats,fieldFormat:fieldFormat,barColor:"secondary"}))};function numberAsOrdinal(num){const int=Math.floor(num);return`${external_kbnSharedDeps_ElasticNumeral_default()(int).format("0o")}`}const number_content_METRIC_DISTRIBUTION_CHART_WIDTH=325;const number_content_METRIC_DISTRIBUTION_CHART_HEIGHT=200;const NumberContent=({config:config})=>{const{stats:stats}=config;Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const chartData=buildChartDataFromStats(stats,number_content_METRIC_DISTRIBUTION_CHART_WIDTH);setDistributionChartData(chartData)},[]);const defaultChartData=[];const[distributionChartData,setDistributionChartData]=Object(external_kbnSharedDeps_React_["useState"])(defaultChartData);if(stats===undefined)return null;const{min:min,median:median,max:max,distribution:distribution}=stats;const fieldFormat="fieldFormat"in config?config.fieldFormat:undefined;const summaryTableItems=[{function:"min",display:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fieldDataCardExpandedRow.numberContent.minLabel",defaultMessage:"min"}),value:kibanaFieldFormat(min,fieldFormat)},{function:"median",display:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fieldDataCardExpandedRow.numberContent.medianLabel",defaultMessage:"median"}),value:kibanaFieldFormat(median,fieldFormat)},{function:"max",display:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fieldDataCardExpandedRow.numberContent.maxLabel",defaultMessage:"max"}),value:kibanaFieldFormat(max,fieldFormat)}];const summaryTableColumns=[{name:"",render:summaryItem=>summaryItem.display,width:"75px"},{field:"value",name:"",render:v=>external_kbnSharedDeps_React_default.a.createElement("strong",null,v)}];const summaryTableTitle=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fieldDataCardExpandedRow.numberContent.summaryTableTitle",{defaultMessage:"Summary"});return external_kbnSharedDeps_React_default.a.createElement(ExpandedRowContent,{dataTestSubj:"mlDVNumberContent"},external_kbnSharedDeps_React_default.a.createElement(DocumentStatsTable,{config:config}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{className:"mlDataVisualizerSummaryTableWrapper"},external_kbnSharedDeps_React_default.a.createElement(ExpandedRowFieldHeader,null,summaryTableTitle),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBasicTable"],{className:"mlDataVisualizerSummaryTable",compressed:true,items:summaryTableItems,columns:summaryTableColumns,tableCaption:summaryTableTitle,"data-test-subj":"mlNumberSummaryTable"})),stats&&external_kbnSharedDeps_React_default.a.createElement(TopValues,{stats:stats,fieldFormat:fieldFormat,barColor:"secondary",compressed:true}),distribution&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{"data-test-subj":"mlMetricDistribution"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(ExpandedRowFieldHeader,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fieldDataCardExpandedRow.numberContent.distributionTitle",defaultMessage:"Distribution"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{className:"mlMetricDistributionChartContainer"},external_kbnSharedDeps_React_default.a.createElement(MetricDistributionChart,{width:number_content_METRIC_DISTRIBUTION_CHART_WIDTH,height:number_content_METRIC_DISTRIBUTION_CHART_HEIGHT,chartData:distributionChartData,fieldFormat:fieldFormat})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fieldDataCardExpandedRow.numberContent.displayingPercentilesLabel",defaultMessage:"Displaying {minPercent} - {maxPercent} percentiles",values:{minPercent:numberAsOrdinal(distribution.minPercentile),maxPercent:numberAsOrdinal(distribution.maxPercentile)}})))))};const OtherContent=({config:config})=>{const{stats:stats}=config;if(stats===undefined)return null;return external_kbnSharedDeps_React_default.a.createElement(ExpandedRowContent,{dataTestSubj:"mlDVOtherContent"},external_kbnSharedDeps_React_default.a.createElement(DocumentStatsTable,{config:config}),Array.isArray(stats.examples)&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(ExamplesList,{examples:stats.examples})))};const TextContent=({config:config})=>{const{stats:stats}=config;if(stats===undefined)return null;const{examples:examples}=stats;if(examples===undefined)return null;const numExamples=examples.length;return external_kbnSharedDeps_React_default.a.createElement(ExpandedRowContent,{dataTestSubj:"mlDVTextContent"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,numExamples>0&&external_kbnSharedDeps_React_default.a.createElement(ExamplesList,{examples:examples}),numExamples===0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xl"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fieldDataCard.cardText.noExamplesForFieldsTitle",{defaultMessage:"No examples were obtained for this field"}),iconType:"alert"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fieldDataCard.cardText.fieldNotPresentDescription",defaultMessage:"This field was not present in the {sourceParam} field of documents queried.",values:{sourceParam:external_kbnSharedDeps_React_default.a.createElement("span",{className:"mlFieldDataCard__codeContent"},"_source")}}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fieldDataCard.cardText.fieldMayBePopulatedDescription",defaultMessage:"It may be populated, for example, using a {copyToParam} parameter in the document mapping, or be pruned from the {sourceParam} field after indexing through the use of {includesParam} and {excludesParam} parameters.",values:{copyToParam:external_kbnSharedDeps_React_default.a.createElement("span",{className:"mlFieldDataCard__codeContent"},"copy_to"),sourceParam:external_kbnSharedDeps_React_default.a.createElement("span",{className:"mlFieldDataCard__codeContent"},"_source"),includesParam:external_kbnSharedDeps_React_default.a.createElement("span",{className:"mlFieldDataCard__codeContent"},"includes"),excludesParam:external_kbnSharedDeps_React_default.a.createElement("span",{className:"mlFieldDataCard__codeContent"},"excludes")}})))))};const geo_point_content_GeoPointContent=({config:config,indexPattern:indexPattern,combinedQuery:combinedQuery})=>{const{stats:stats}=config;const[layerList,setLayerList]=Object(external_kbnSharedDeps_React_["useState"])([]);const{services:{maps:mapsPlugin}}=Object(contexts_kibana["b"])();Object(external_kbnSharedDeps_React_["useEffect"])(()=>{async function updateIndexPatternSearchLayer(){if((indexPattern===null||indexPattern===void 0?void 0:indexPattern.id)!==undefined&&config!==undefined&&config.fieldName!==undefined&&(config.type===field_types["c"].GEO_POINT||config.type===field_types["c"].GEO_SHAPE)){const params={indexPatternId:indexPattern.id,geoFieldName:config.fieldName,geoFieldType:config.type,query:{query:combinedQuery.searchString,language:combinedQuery.searchQueryLanguage}};const searchLayerDescriptor=mapsPlugin?await mapsPlugin.createLayerDescriptors.createESSearchSourceLayerDescriptor(params):null;if(searchLayerDescriptor){setLayerList([...layerList,searchLayerDescriptor])}}}updateIndexPatternSearchLayer()},[indexPattern,config.fieldName,combinedQuery]);if((stats===null||stats===void 0?void 0:stats.examples)===undefined)return null;return external_kbnSharedDeps_React_default.a.createElement(ExpandedRowContent,{dataTestSubj:"mlDVIndexBasedMapContent"},external_kbnSharedDeps_React_default.a.createElement(DocumentStatsTable,{config:config}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{style:{maxWidth:"50%"}},external_kbnSharedDeps_React_default.a.createElement(ExamplesList,{examples:stats.examples})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{className:"mlDataVisualizerMapWrapper"},external_kbnSharedDeps_React_default.a.createElement(MlEmbeddedMapComponent,{layerList:layerList})))};const IndexBasedDataVisualizerExpandedRow=({item:item,indexPattern:indexPattern,combinedQuery:combinedQuery})=>{const config=item;const{loading:loading,type:type,existsInDocs:existsInDocs,fieldName:fieldName}=config;function getCardContent(){if(existsInDocs===false){return external_kbnSharedDeps_React_default.a.createElement(NotInDocsContent,null)}switch(type){case field_types["c"].NUMBER:return external_kbnSharedDeps_React_default.a.createElement(NumberContent,{config:config});case field_types["c"].BOOLEAN:return external_kbnSharedDeps_React_default.a.createElement(BooleanContent,{config:config});case field_types["c"].DATE:return external_kbnSharedDeps_React_default.a.createElement(DateContent,{config:config});case field_types["c"].GEO_POINT:case field_types["c"].GEO_SHAPE:return external_kbnSharedDeps_React_default.a.createElement(geo_point_content_GeoPointContent,{config:config,indexPattern:indexPattern,combinedQuery:combinedQuery});case field_types["c"].IP:return external_kbnSharedDeps_React_default.a.createElement(IpContent,{config:config});case field_types["c"].KEYWORD:return external_kbnSharedDeps_React_default.a.createElement(KeywordContent,{config:config});case field_types["c"].TEXT:return external_kbnSharedDeps_React_default.a.createElement(TextContent,{config:config});default:return external_kbnSharedDeps_React_default.a.createElement(OtherContent,{config:config})}}return external_kbnSharedDeps_React_default.a.createElement("div",{className:"mlDataVisualizerFieldExpandedRow","data-test-subj":`mlDataVisualizerFieldExpandedRow-${fieldName}`},loading===true?external_kbnSharedDeps_React_default.a.createElement(LoadingIndicator,null):getCardContent())};const TOP_VALUES_LABEL=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataVisualizer.lensChart.topValuesLabel",{defaultMessage:"Top values"});const COUNT=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataVisualizer.lensChart.countLabel",{defaultMessage:"Count"});function getNumberSettings(item,defaultIndexPattern){if(defaultIndexPattern.timeFieldName===undefined){const columns={col1:{label:item.fieldName,dataType:"number",isBucketed:true,operationType:"range",params:{type:"histogram",maxBars:"auto",ranges:[]},sourceField:item.fieldName},col2:{label:COUNT,dataType:"number",isBucketed:false,sourceField:"Records",operationType:"count"}};const layer={accessors:["col2"],layerId:"layer1",seriesType:"bar",xAccessor:"col1"};return{columns:columns,layer:layer}}const columns={col2:{dataType:"number",isBucketed:false,label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataVisualizer.lensChart.averageOfLabel",{defaultMessage:"Average of {fieldName}",values:{fieldName:item.fieldName}}),operationType:"avg",sourceField:item.fieldName},col1:{dataType:"date",isBucketed:true,label:defaultIndexPattern.timeFieldName,operationType:"date_histogram",params:{interval:"auto"},scale:"interval",sourceField:defaultIndexPattern.timeFieldName}};const layer={accessors:["col2"],layerId:"layer1",seriesType:"line",xAccessor:"col1"};return{columns:columns,layer:layer}}function getDateSettings(item){const columns={col2:{dataType:"number",isBucketed:false,label:COUNT,operationType:"count",scale:"ratio",sourceField:"Records"},col1:{dataType:"date",isBucketed:true,label:item.fieldName,operationType:"date_histogram",params:{interval:"auto"},scale:"interval",sourceField:item.fieldName}};const layer={accessors:["col2"],layerId:"layer1",seriesType:"line",xAccessor:"col1"};return{columns:columns,layer:layer}}function getKeywordSettings(item){const columns={col1:{label:TOP_VALUES_LABEL,dataType:"string",isBucketed:true,operationType:"terms",params:{orderBy:{type:"column",columnId:"col2"},size:10,orderDirection:"desc"},sourceField:item.fieldName},col2:{label:COUNT,dataType:"number",isBucketed:false,sourceField:"Records",operationType:"count"}};const layer={accessors:["col2"],layerId:"layer1",seriesType:"bar",xAccessor:"col1"};return{columns:columns,layer:layer}}function getBooleanSettings(item){const columns={col1:{label:TOP_VALUES_LABEL,dataType:"string",isBucketed:true,operationType:"terms",params:{orderBy:{type:"alphabetical"},size:2,orderDirection:"desc"},sourceField:item.fieldName},col2:{label:COUNT,dataType:"number",isBucketed:false,sourceField:"Records",operationType:"count"}};const layer={accessors:["col2"],layerId:"layer1",seriesType:"bar",xAccessor:"col1"};return{columns:columns,layer:layer}}function getCompatibleLensDataType(type){let lensType;switch(type){case field_types["c"].KEYWORD:lensType="string";break;case field_types["c"].DATE:lensType="date";break;case field_types["c"].NUMBER:lensType="number";break;case field_types["c"].IP:lensType="ip";break;case field_types["c"].BOOLEAN:lensType="string";break;default:lensType=undefined}return lensType}function getColumnsAndLayer(fieldType,item,defaultIndexPattern){if(item.fieldName===undefined)return;if(fieldType===field_types["c"].DATE){return getDateSettings(item)}if(fieldType===field_types["c"].NUMBER){return getNumberSettings(item,defaultIndexPattern)}if(fieldType===field_types["c"].IP||fieldType===field_types["c"].KEYWORD){return getKeywordSettings(item)}if(fieldType===field_types["c"].BOOLEAN){return getBooleanSettings(item)}}function getLensAttributes(defaultIndexPattern,combinedQuery,item){if(defaultIndexPattern===undefined||item.type===undefined||item.fieldName===undefined)return;const presets=getColumnsAndLayer(item.type,item,defaultIndexPattern);if(!presets)return;return{visualizationType:"lnsXY",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataVisualizer.lensChart.chartTitle",{defaultMessage:"Lens for {fieldName}",values:{fieldName:item.fieldName}}),references:[{id:defaultIndexPattern.id,name:"indexpattern-datasource-current-indexpattern",type:"index-pattern"},{id:defaultIndexPattern.id,name:"indexpattern-datasource-layer-layer1",type:"index-pattern"}],state:{datasourceStates:{indexpattern:{layers:{layer1:{columnOrder:["col1","col2"],columns:presets.columns}}}},filters:[],query:{language:combinedQuery.searchQueryLanguage,query:combinedQuery.searchString},visualization:{axisTitlesVisibilitySettings:{x:true,yLeft:true,yRight:true},fittingFunction:"None",gridlinesVisibilitySettings:{x:true,yLeft:true,yRight:true},layers:[presets.layer],legend:{isVisible:true,position:"right"},preferredSeriesType:"line",tickLabelsVisibilitySettings:{x:true,yLeft:true,yRight:true},valueLabels:"hide"}}}}function getActions(indexPattern,lensPlugin,combinedQuery){const canUseLensEditor=lensPlugin.canUseEditor();return[{name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataVisualizer.indexBasedDataGrid.exploreInLensTitle",{defaultMessage:"Explore in Lens"}),description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataVisualizer.indexBasedDataGrid.exploreInLensDescription",{defaultMessage:"Explore in Lens"}),type:"icon",icon:"lensApp",available:item=>getCompatibleLensDataType(item.type)!==undefined&&canUseLensEditor,onClick:item=>{const lensAttributes=getLensAttributes(indexPattern,combinedQuery,item);if(lensAttributes){lensPlugin.navigateToPrefilledEditor({id:`ml-dataVisualizer-${item.fieldName}`,attributes:lensAttributes})}},"data-test-subj":"mlActionButtonViewInLens"}]}const defaultSearchQuery={match_all:{}};function getDefaultPageState(){return{overallStats:{totalCount:0,aggregatableExistsFields:[],aggregatableNotExistsFields:[],nonAggregatableExistsFields:[],nonAggregatableNotExistsFields:[]},metricConfigs:[],totalMetricFieldCount:0,populatedMetricFieldCount:0,metricsLoaded:false,nonMetricConfigs:[],nonMetricsLoaded:false,documentCountStats:undefined}}const getDefaultDataVisualizerListState=()=>({pageIndex:0,pageSize:10,sortField:"fieldName",sortDirection:"asc",visibleFieldTypes:[],visibleFieldNames:[],samplerShardSize:5e3,searchString:"",searchQuery:defaultSearchQuery,searchQueryLanguage:constants_search["c"].KUERY,showDistributions:true,showAllFields:false,showEmptyFields:false});const index_based_page_Page=()=>{var _globalState$time,_globalState$time2,_globalState$refreshI,_globalState$refreshI2,_dataVisualizerListSt,_dataVisualizerListSt2,_dataVisualizerListSt3,_dataVisualizerListSt4;const mlContext=Object(ml["b"])();const restorableDefaults=getDefaultDataVisualizerListState();const{services:{lens:lensPlugin,docLinks:docLinks}}=Object(contexts_kibana["b"])();const[dataVisualizerListState,setDataVisualizerListState]=Object(url_state["b"])(ml_url_generator["b"].DATA_VISUALIZER_INDEX_VIEWER,restorableDefaults);const[currentSavedSearch,setCurrentSavedSearch]=Object(external_kbnSharedDeps_React_["useState"])(mlContext.currentSavedSearch);const{combinedQuery:combinedQuery,currentIndexPattern:currentIndexPattern,kibanaConfig:kibanaConfig}=mlContext;const timefilter=Object(contexts_kibana["g"])({timeRangeSelector:currentIndexPattern.timeFieldName!==undefined,autoRefreshSelector:true});const dataLoader=Object(external_kbnSharedDeps_React_["useMemo"])(()=>new data_loader_DataLoader(currentIndexPattern,Object(dependency_cache["j"])()),[currentIndexPattern]);const[globalState,setGlobalState]=Object(url_state["c"])("_g");Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if((globalState===null||globalState===void 0?void 0:globalState.time)!==undefined){timefilter.setTime({from:globalState.time.from,to:globalState.time.to})}},[globalState===null||globalState===void 0?void 0:(_globalState$time=globalState.time)===null||_globalState$time===void 0?void 0:_globalState$time.from,globalState===null||globalState===void 0?void 0:(_globalState$time2=globalState.time)===null||_globalState$time2===void 0?void 0:_globalState$time2.to]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if((globalState===null||globalState===void 0?void 0:globalState.refreshInterval)!==undefined){timefilter.setRefreshInterval(globalState.refreshInterval)}},[globalState===null||globalState===void 0?void 0:(_globalState$refreshI=globalState.refreshInterval)===null||_globalState$refreshI===void 0?void 0:_globalState$refreshI.pause,globalState===null||globalState===void 0?void 0:(_globalState$refreshI2=globalState.refreshInterval)===null||_globalState$refreshI2===void 0?void 0:_globalState$refreshI2.value]);const[lastRefresh,setLastRefresh]=Object(external_kbnSharedDeps_React_["useState"])(0);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{Object(index_utils["i"])(currentIndexPattern,true)},[]);let indexedFieldTypes=[];const indexPatternFields=currentIndexPattern.fields;indexPatternFields.forEach(field=>{if(field.scripted!==true){const dataVisualizerType=kbnTypeToMLJobType(field);if(dataVisualizerType!==undefined&&!indexedFieldTypes.includes(dataVisualizerType)){indexedFieldTypes.push(dataVisualizerType)}}});indexedFieldTypes=indexedFieldTypes.sort();const defaults=getDefaultPageState();const{searchQueryLanguage:searchQueryLanguage,searchString:searchString,searchQuery:searchQuery}=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{const searchData=extractSearchData(currentSavedSearch);if(searchData===undefined||dataVisualizerListState.searchString!==""){return{searchQuery:dataVisualizerListState.searchQuery,searchString:dataVisualizerListState.searchString,searchQueryLanguage:dataVisualizerListState.searchQueryLanguage}}else{return{searchQuery:searchData.searchQuery,searchString:searchData.searchString,searchQueryLanguage:searchData.queryLanguage}}},[currentSavedSearch,dataVisualizerListState]);const setSearchParams=searchParams=>{if(currentSavedSearch!==null){setCurrentSavedSearch(null)}setDataVisualizerListState({...dataVisualizerListState,searchQuery:searchParams.searchQuery,searchString:searchParams.searchString,searchQueryLanguage:searchParams.queryLanguage})};const samplerShardSize=(_dataVisualizerListSt=dataVisualizerListState.samplerShardSize)!==null&&_dataVisualizerListSt!==void 0?_dataVisualizerListSt:restorableDefaults.samplerShardSize;const setSamplerShardSize=value=>{setDataVisualizerListState({...dataVisualizerListState,samplerShardSize:value})};const visibleFieldTypes=(_dataVisualizerListSt2=dataVisualizerListState.visibleFieldTypes)!==null&&_dataVisualizerListSt2!==void 0?_dataVisualizerListSt2:restorableDefaults.visibleFieldTypes;const setVisibleFieldTypes=values=>{setDataVisualizerListState({...dataVisualizerListState,visibleFieldTypes:values})};const visibleFieldNames=(_dataVisualizerListSt3=dataVisualizerListState.visibleFieldNames)!==null&&_dataVisualizerListSt3!==void 0?_dataVisualizerListSt3:restorableDefaults.visibleFieldNames;const setVisibleFieldNames=values=>{setDataVisualizerListState({...dataVisualizerListState,visibleFieldNames:values})};const showEmptyFields=(_dataVisualizerListSt4=dataVisualizerListState.showEmptyFields)!==null&&_dataVisualizerListSt4!==void 0?_dataVisualizerListSt4:restorableDefaults.showEmptyFields;const toggleShowEmptyFields=()=>{setDataVisualizerListState({...dataVisualizerListState,showEmptyFields:!dataVisualizerListState.showEmptyFields})};const[overallStats,setOverallStats]=Object(external_kbnSharedDeps_React_["useState"])(defaults.overallStats);const[documentCountStats,setDocumentCountStats]=Object(external_kbnSharedDeps_React_["useState"])(defaults.documentCountStats);const[metricConfigs,setMetricConfigs]=Object(external_kbnSharedDeps_React_["useState"])(defaults.metricConfigs);const[metricsLoaded,setMetricsLoaded]=Object(external_kbnSharedDeps_React_["useState"])(defaults.metricsLoaded);const[metricsStats,setMetricsStats]=Object(external_kbnSharedDeps_React_["useState"])();const[nonMetricConfigs,setNonMetricConfigs]=Object(external_kbnSharedDeps_React_["useState"])(defaults.nonMetricConfigs);const[nonMetricsLoaded,setNonMetricsLoaded]=Object(external_kbnSharedDeps_React_["useState"])(defaults.nonMetricsLoaded);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const timeUpdateSubscription=Object(external_kbnSharedDeps_Rxjs_["merge"])(timefilter.getTimeUpdate$(),timefilter_refresh_service["a"]).subscribe(()=>{setGlobalState({time:timefilter.getTime(),refreshInterval:timefilter.getRefreshInterval()});setLastRefresh(Date.now())});return()=>{timeUpdateSubscription.unsubscribe()}});Object(external_kbnSharedDeps_React_["useEffect"])(()=>{loadOverallStats()},[searchQuery,samplerShardSize,lastRefresh]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{createMetricCards();createNonMetricCards()},[overallStats,showEmptyFields]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{loadMetricFieldStats()},[metricConfigs]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{loadNonMetricFieldStats()},[nonMetricConfigs]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{createMetricCards()},[metricsLoaded]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{createNonMetricCards()},[nonMetricsLoaded]);function extractSearchData(savedSearch){if(!savedSearch){return undefined}const{query:query}=Object(index_utils["f"])(savedSearch);const queryLanguage=query.language;const qryString=query.query;let qry;if(queryLanguage===constants_search["c"].KUERY){const ast=data_public_["esKuery"].fromKueryExpression(qryString);qry=data_public_["esKuery"].toElasticsearchQuery(ast,currentIndexPattern)}else{qry=data_public_["esQuery"].luceneStringToDsl(qryString);data_public_["esQuery"].decorateQuery(qry,kibanaConfig.get(data_public_["UI_SETTINGS"].QUERY_STRING_OPTIONS))}return{searchQuery:qry,searchString:qryString,queryLanguage:queryLanguage}}async function loadOverallStats(){const tf=timefilter;let earliest;let latest;const activeBounds=tf.getActiveBounds();if(currentIndexPattern.timeFieldName!==undefined&&activeBounds===undefined){return}if(currentIndexPattern.timeFieldName!==undefined){earliest=activeBounds.min.valueOf();latest=activeBounds.max.valueOf()}try{const allStats=await dataLoader.loadOverallData(searchQuery,samplerShardSize,earliest,latest);setOverallStats(allStats)}catch(err){dataLoader.displayError(err)}}async function loadMetricFieldStats(){if(metricConfigs.length===0){return}const configsToLoad=metricConfigs.filter(config=>config.existsInDocs===true&&config.loading===true);if(configsToLoad.length===0){return}const existMetricFields=configsToLoad.map(config=>{const props={fieldName:config.fieldName,type:config.type,cardinality:0};if(config.stats!==undefined&&config.stats.cardinality!==undefined){props.cardinality=config.stats.cardinality}return props});const buckets=Object(time_buckets["c"])();const tf=timefilter;let earliest;let latest;if(currentIndexPattern.timeFieldName!==undefined){earliest=tf.getActiveBounds().min.valueOf();latest=tf.getActiveBounds().max.valueOf()}const bounds=tf.getActiveBounds();const BAR_TARGET=75;buckets.setInterval("auto");buckets.setBounds(bounds);buckets.setBarTarget(BAR_TARGET);const aggInterval=buckets.getInterval();try{const metricFieldStats=await dataLoader.loadFieldStats(searchQuery,samplerShardSize,earliest,latest,existMetricFields,aggInterval.asMilliseconds());const configs=[];metricConfigs.forEach(config=>{const configWithStats={...config};if(config.fieldName!==undefined){configWithStats.stats={...configWithStats.stats,...metricFieldStats.find(fieldStats=>fieldStats.fieldName===config.fieldName)};configWithStats.loading=false;configs.push(configWithStats)}else{configWithStats.stats=metricFieldStats.find(fieldStats=>fieldStats.fieldName===undefined);if(configWithStats.stats!==undefined){configWithStats.stats.timeRangeEarliest=earliest;configWithStats.stats.timeRangeLatest=latest}setDocumentCountStats(configWithStats)}});setMetricConfigs(configs)}catch(err){dataLoader.displayError(err)}}async function loadNonMetricFieldStats(){if(nonMetricConfigs.length===0){return}const configsToLoad=nonMetricConfigs.filter(config=>config.existsInDocs===true&&config.loading===true);if(configsToLoad.length===0){return}const existNonMetricFields=configsToLoad.map(config=>{const props={fieldName:config.fieldName,type:config.type,cardinality:0};if(config.stats!==undefined&&config.stats.cardinality!==undefined){props.cardinality=config.stats.cardinality}return props});const tf=timefilter;let earliest;let latest;if(currentIndexPattern.timeFieldName!==undefined){earliest=tf.getActiveBounds().min.valueOf();latest=tf.getActiveBounds().max.valueOf()}try{const nonMetricFieldStats=await dataLoader.loadFieldStats(searchQuery,samplerShardSize,earliest,latest,existNonMetricFields);const configs=[];nonMetricConfigs.forEach(config=>{const configWithStats={...config};if(config.fieldName!==undefined){configWithStats.stats={...configWithStats.stats,...nonMetricFieldStats.find(fieldStats=>fieldStats.fieldName===config.fieldName)}}configWithStats.loading=false;configs.push(configWithStats)});setNonMetricConfigs(configs)}catch(err){dataLoader.displayError(err)}}function createMetricCards(){const configs=[];const aggregatableExistsFields=overallStats.aggregatableExistsFields||[];const allMetricFields=indexPatternFields.filter(f=>f.type===data_public_["KBN_FIELD_TYPES"].NUMBER&&f.displayName!==undefined&&dataLoader.isDisplayField(f.displayName)===true);const metricExistsFields=allMetricFields.filter(f=>aggregatableExistsFields.find(existsF=>existsF.fieldName===f.displayName));if(currentIndexPattern.timeFieldName!==undefined){configs.push({type:field_types["c"].NUMBER,existsInDocs:true,loading:true,aggregatable:true})}if(metricsLoaded===false){setMetricsLoaded(true);return}let aggregatableFields=overallStats.aggregatableExistsFields;if(allMetricFields.length!==metricExistsFields.length&&metricsLoaded===true){aggregatableFields=aggregatableFields.concat(overallStats.aggregatableNotExistsFields)}const metricFieldsToShow=metricsLoaded===true&&showEmptyFields===true?allMetricFields:metricExistsFields;metricFieldsToShow.forEach(field=>{const fieldData=aggregatableFields.find(f=>f.fieldName===field.displayName);const metricConfig={...fieldData?fieldData:{},fieldFormat:currentIndexPattern.getFormatterForField(field),type:field_types["c"].NUMBER,loading:true,aggregatable:true};configs.push(metricConfig)});setMetricsStats({totalMetricFieldsCount:allMetricFields.length,visibleMetricsCount:metricFieldsToShow.length});setMetricConfigs(configs)}function createNonMetricCards(){const allNonMetricFields=indexPatternFields.filter(f=>f.type!==data_public_["KBN_FIELD_TYPES"].NUMBER&&f.displayName!==undefined&&dataLoader.isDisplayField(f.displayName)===true);const populatedNonMetricFields=[];let nonMetricFieldData=[];const aggregatableExistsFields=overallStats.aggregatableExistsFields||[];const nonAggregatableExistsFields=overallStats.nonAggregatableExistsFields||[];allNonMetricFields.forEach(f=>{const checkAggregatableField=aggregatableExistsFields.find(existsField=>existsField.fieldName===f.displayName);if(checkAggregatableField!==undefined){populatedNonMetricFields.push(f);nonMetricFieldData.push(checkAggregatableField)}else{const checkNonAggregatableField=nonAggregatableExistsFields.find(existsField=>existsField.fieldName===f.displayName);if(checkNonAggregatableField!==undefined){populatedNonMetricFields.push(f);nonMetricFieldData.push(checkNonAggregatableField)}}});if(nonMetricsLoaded===false){setNonMetricsLoaded(true);return}if(allNonMetricFields.length!==nonMetricFieldData.length&&showEmptyFields===true){nonMetricFieldData=nonMetricFieldData.concat(overallStats.aggregatableNotExistsFields,overallStats.nonAggregatableNotExistsFields)}const nonMetricFieldsToShow=showEmptyFields?allNonMetricFields:populatedNonMetricFields;const configs=[];nonMetricFieldsToShow.forEach(field=>{const fieldData=nonMetricFieldData.find(f=>f.fieldName===field.displayName);const nonMetricConfig={...fieldData,fieldFormat:currentIndexPattern.getFormatterForField(field),aggregatable:field.aggregatable,scripted:field.scripted,loading:fieldData.existsInDocs};const dataVisualizerType=kbnTypeToMLJobType(field);if(dataVisualizerType!==undefined){nonMetricConfig.type=dataVisualizerType}else{nonMetricConfig.type=field.type;nonMetricConfig.isUnsupportedType=true}configs.push(nonMetricConfig)});setNonMetricConfigs(configs)}const wizardPanelWidth="280px";const configs=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{let combinedConfigs=[...nonMetricConfigs,...metricConfigs];if(visibleFieldTypes&&visibleFieldTypes.length>0){combinedConfigs=combinedConfigs.filter(config=>visibleFieldTypes.findIndex(field=>field===config.type)>-1)}if(visibleFieldNames&&visibleFieldNames.length>0){combinedConfigs=combinedConfigs.filter(config=>visibleFieldNames.findIndex(field=>field===config.fieldName)>-1)}return combinedConfigs},[nonMetricConfigs,metricConfigs,visibleFieldTypes,visibleFieldNames]);const fieldsCountStats=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{let _visibleFieldsCount=0;let _totalFieldsCount=0;Object.keys(overallStats).forEach(key=>{const fieldsGroup=overallStats[key];if(Array.isArray(fieldsGroup)&&fieldsGroup.length>0){_totalFieldsCount+=fieldsGroup.length}});if(showEmptyFields===true){_visibleFieldsCount=_totalFieldsCount}else{_visibleFieldsCount=overallStats.aggregatableExistsFields.length+overallStats.nonAggregatableExistsFields.length}return{visibleFieldsCount:_visibleFieldsCount,totalFieldsCount:_totalFieldsCount}},[overallStats,showEmptyFields]);const getItemIdToExpandedRowMap=Object(external_kbnSharedDeps_React_["useCallback"])((function(itemIds,items){return itemIds.reduce((m,fieldName)=>{const item=items.find(fieldVisConfig=>fieldVisConfig.fieldName===fieldName);if(item!==undefined){m[fieldName]=external_kbnSharedDeps_React_default.a.createElement(IndexBasedDataVisualizerExpandedRow,{item:item,indexPattern:currentIndexPattern,combinedQuery:{searchQueryLanguage:searchQueryLanguage,searchString:searchString}})}return m},{})}),[currentIndexPattern,searchQuery]);const extendedColumns=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{if(lensPlugin===undefined){console.error("Lens plugin not available");return}const actionColumn={name:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataVisualizer.indexBasedDataGrid.actionsColumnLabel",defaultMessage:"Actions"}),actions:getActions(currentIndexPattern,lensPlugin,{searchQueryLanguage:searchQueryLanguage,searchString:searchString}),width:"100px"};return[actionColumn]},[currentIndexPattern,lensPlugin,searchQueryLanguage,searchString]);const helpLink=docLinks.links.ml.guide;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(navigation_menu["a"],{tabId:"datavisualizer"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPage"],{"data-test-subj":"mlPageIndexDataVisualizer"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"m"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageContentHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageContentHeaderSection"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"l"},external_kbnSharedDeps_React_default.a.createElement("h1",null,currentIndexPattern.title))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageContentHeaderSection"],{"data-test-subj":"mlDataVisualizerTimeRangeSelectorSection"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center",justifyContent:"flexEnd",gutterSize:"s"},currentIndexPattern.timeFieldName!==undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(FullTimeRangeSelector,{indexPattern:currentIndexPattern,query:combinedQuery,disabled:false})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(date_picker_wrapper["a"],null))))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageContentBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"m"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],null,(overallStats===null||overallStats===void 0?void 0:overallStats.totalCount)!==undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:true},external_kbnSharedDeps_React_default.a.createElement(DocumentCountContent,{config:documentCountStats,totalCount:overallStats.totalCount})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(SearchPanel,{indexPattern:currentIndexPattern,searchString:searchString,searchQuery:searchQuery,searchQueryLanguage:searchQueryLanguage,setSearchParams:setSearchParams,samplerShardSize:samplerShardSize,setSamplerShardSize:setSamplerShardSize,overallStats:overallStats,indexedFieldTypes:indexedFieldTypes,setVisibleFieldTypes:setVisibleFieldTypes,visibleFieldTypes:visibleFieldTypes,visibleFieldNames:visibleFieldNames,setVisibleFieldNames:setVisibleFieldNames,showEmptyFields:showEmptyFields}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}),external_kbnSharedDeps_React_default.a.createElement(FieldCountPanel,{showEmptyFields:showEmptyFields,toggleShowEmptyFields:toggleShowEmptyFields,fieldsCountStats:fieldsCountStats,metricsStats:metricsStats}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(DataVisualizerTable,{items:configs,pageState:dataVisualizerListState,updatePageState:setDataVisualizerListState,getItemIdToExpandedRowMap:getItemIdToExpandedRowMap,extendedColumns:extendedColumns}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:{width:wizardPanelWidth}},external_kbnSharedDeps_React_default.a.createElement(ActionsPanel,{indexPattern:currentIndexPattern,searchQueryLanguage:searchQueryLanguage,searchString:searchString})))))),external_kbnSharedDeps_React_default.a.createElement(help_menu["a"],{docLink:helpLink}))};function index_based_extends(){index_based_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return index_based_extends.apply(this,arguments)}const indexBasedRouteFactory=(navigateToPath,basePath)=>({path:"/jobs/new_job/datavisualizer",render:(props,deps)=>external_kbnSharedDeps_React_default.a.createElement(index_based_PageWrapper,index_based_extends({},props,{deps:deps})),breadcrumbs:[getBreadcrumbWithUrlForApp("ML_BREADCRUMB",navigateToPath,basePath),getBreadcrumbWithUrlForApp("DATA_VISUALIZER_BREADCRUMB",navigateToPath,basePath),{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataFrameAnalyticsBreadcrumbs.indexLabel",{defaultMessage:"Index"}),href:""}]});const index_based_PageWrapper=({location:location,deps:deps})=>{const{redirectToMlAccessDeniedPage:redirectToMlAccessDeniedPage}=deps;const redirectToJobsManagementPage=Object(use_create_url["a"])(ml_url_generator["b"].ANOMALY_DETECTION_JOBS_MANAGE);const{index:index,savedSearchId:savedSearchId}=Object(query_string["parse"])(location.search,{sort:false});const{context:context}=useResolver(index,savedSearchId,deps.config,{checkBasicLicense:license["a"],loadIndexPatterns:()=>Object(index_utils["g"])(deps.indexPatterns),checkGetJobsCapabilities:()=>Object(check_capabilities["c"])(redirectToMlAccessDeniedPage),checkMlNodesAvailable:()=>Object(ml_nodes_check["a"])(redirectToJobsManagementPage)});return external_kbnSharedDeps_React_default.a.createElement(PageLoader,{context:context},external_kbnSharedDeps_React_default.a.createElement(index_based_page_Page,null))};const ExperimentalBadge=({tooltipContent:tooltipContent})=>external_kbnSharedDeps_React_default.a.createElement("span",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBetaBadge"],{className:"ml-experimental-badge",label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.experimentalBadge.experimentalLabel",defaultMessage:"Experimental"}),tooltipContent:tooltipContent}));const WelcomeContent=()=>{const toolTipContent=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.welcomeContent.experimentalFeatureTooltip",{defaultMessage:"Experimental feature. We'd love to hear your feedback."});const maxFileSize=getMaxBytesFormatted();return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xl",alignItems:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{size:"xxl",type:"addDataApp",className:"file-datavisualizer-about-panel__icon"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"m"},external_kbnSharedDeps_React_default.a.createElement("h1",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.welcomeContent.visualizeDataFromLogFileTitle",defaultMessage:"Visualize data from a log file {experimentalBadge}",values:{experimentalBadge:external_kbnSharedDeps_React_default.a.createElement(ExperimentalBadge,{tooltipContent:toolTipContent})}}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.welcomeContent.visualizeDataFromLogFileDescription",defaultMessage:"The File Data Visualizer helps you understand the fields and metrics in a log file. Upload your file, analyze its data, and then choose whether to import the data into an Elasticsearch index."}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.welcomeContent.supportedFileFormatDescription",defaultMessage:"The File Data Visualizer supports these file formats:"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"l"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,className:"file-datavisualizer-about-panel__doc-icon"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{size:"m",type:"document"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.welcomeContent.delimitedTextFilesDescription",defaultMessage:"Delimited text files, such as CSV and TSV"}))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"l"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,className:"file-datavisualizer-about-panel__doc-icon"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{size:"m",type:"document"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.welcomeContent.newlineDelimitedJsonDescription",defaultMessage:"Newline-delimited JSON"}))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"l"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,className:"file-datavisualizer-about-panel__doc-icon"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{size:"m",type:"document"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.welcomeContent.logFilesWithCommonFormatDescription",defaultMessage:"Log files with a common format for the timestamp"}))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.welcomeContent.uploadedFilesAllowedSizeDescription",defaultMessage:"You can upload files up to {maxFileSize}.",values:{maxFileSize:maxFileSize}}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.welcomeContent.experimentalFeatureDescription",defaultMessage:"This feature is experimental. Got feedback? Please create an issue in {githubLink}.",values:{githubLink:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{href:"https://github.com/elastic/kibana/issues/new/choose",target:"_blank"},"GitHub")}})))))};const AboutPanel=({onFilePickerChange:onFilePickerChange})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPage"],{restrictWidth:1e3,"data-test-subj":"mlPageFileDataVisualizerUpload"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageContent"],{className:"file-datavisualizer-about-panel__content"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xl"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:true},external_kbnSharedDeps_React_default.a.createElement(WelcomeContent,null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"l"}),external_kbnSharedDeps_React_default.a.createElement("div",{style:{textAlign:"center"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFilePicker"],{id:"filePicker",initialPromptText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.aboutPanel.selectOrDragAndDropFileDescription",{defaultMessage:"Select or drag and drop a file"}),onChange:files=>onFilePickerChange(files),className:"file-datavisualizer-file-picker"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}))))));const LoadingPanel=()=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPage"],{restrictWidth:400,"data-test-subj":"mlPageFileDataVisLoading"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageContent"],{className:"file-datavisualizer-about-panel__content",paddingSize:"l"},external_kbnSharedDeps_React_default.a.createElement("div",{style:{textAlign:"center"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h1",{role:"alert"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.aboutPanel.analyzingDataTitle",defaultMessage:"Analyzing data"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLoadingSpinner"],{size:"xl"})))));let constants_MODE;(function(MODE){MODE[MODE["READ"]=0]="READ";MODE[MODE["IMPORT"]=1]="IMPORT"})(constants_MODE||(constants_MODE={}));const BottomBar=({mode:mode,onChangeMode:onChangeMode,onCancel:onCancel,disableImport:disableImport})=>{if(mode===constants_MODE.READ){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBottomBar"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{position:"top",content:disableImport?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.bottomBar.missingImportPrivilegesMessage",defaultMessage:"You require the ingest_admin role to enable data importing"}):null},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{fill:true,isDisabled:disableImport,onClick:()=>onChangeMode(constants_MODE.IMPORT),"data-test-subj":"mlFileDataVisOpenImportPageButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.bottomBar.readMode.importButtonLabel",defaultMessage:"Import"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{color:"ghost",onClick:()=>onCancel()},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.bottomBar.readMode.cancelButtonLabel",defaultMessage:"Cancel"})))))}else{return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBottomBar"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{color:"ghost",onClick:()=>onChangeMode(constants_MODE.READ)},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.bottomBar.backButtonLabel",defaultMessage:"Back"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{color:"ghost",onClick:()=>onCancel()},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.bottomBar.cancelButtonLabel",defaultMessage:"Cancel"})))))}};const FileContents=({data:data,format:format,numberOfLines:numberOfLines})=>{let mode=ml_job_editor["b"].TEXT;if(format===ml_job_editor["b"].JSON){mode=ml_job_editor["b"].JSON}const formattedData=limitByNumberOfLines(data,numberOfLines);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.fileContents.fileContentsTitle",defaultMessage:"File contents"}))),external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.fileContents.firstLinesDescription",defaultMessage:"First {numberOfLines, plural, zero {# line} one {# line} other {# lines}}",values:{numberOfLines:numberOfLines}})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(ml_job_editor["a"],{mode:mode,readOnly:true,value:formattedData,height:"200px",syntaxChecking:false}))};function limitByNumberOfLines(data,numberOfLines){return data.split("\n").slice(0,numberOfLines).join("\n")}const AnalysisSummary=({results:results})=>{const items=createDisplayItems(results);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.analysisSummary.summaryTitle",defaultMessage:"Summary"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{type:"column",listItems:items,className:"analysis-summary-list"}))};function createDisplayItems(results){const items=[{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.analysisSummary.analyzedLinesNumberTitle",defaultMessage:"Number of lines analyzed"}),description:results.num_lines_analyzed}];if(results.format!==undefined){items.push({title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.analysisSummary.formatTitle",defaultMessage:"Format"}),description:results.format});if(results.format==="delimited"){items.push({title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.analysisSummary.delimiterTitle",defaultMessage:"Delimiter"}),description:results.delimiter});items.push({title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.analysisSummary.hasHeaderRowTitle",defaultMessage:"Has header row"}),description:`${results.has_header_row}`})}}if(results.grok_pattern!==undefined){items.push({title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.analysisSummary.grokPatternTitle",defaultMessage:"Grok pattern"}),description:results.grok_pattern})}if(results.timestamp_field!==undefined){items.push({title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.analysisSummary.timeFieldTitle",defaultMessage:"Time field"}),description:results.timestamp_field})}if(results.java_timestamp_formats!==undefined){items.push({title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.analysisSummary.timeFormatTitle",defaultMessage:"Time {timestampFormats, plural, zero {format} one {format} other {formats}}",values:{timestampFormats:results.java_timestamp_formats.length}}),description:results.java_timestamp_formats.join(", ")})}return items}const FileBasedDataVisualizerExpandedRow=({item:item})=>{const config=item;const{type:type,fieldName:fieldName}=config;function getCardContent(){switch(type){case field_types["c"].NUMBER:return external_kbnSharedDeps_React_default.a.createElement(NumberContent,{config:config});case field_types["c"].BOOLEAN:return external_kbnSharedDeps_React_default.a.createElement(BooleanContent,{config:config});case field_types["c"].DATE:return external_kbnSharedDeps_React_default.a.createElement(DateContent,{config:config});case field_types["c"].GEO_POINT:return external_kbnSharedDeps_React_default.a.createElement(GeoPointContent,{config:config});case field_types["c"].IP:return external_kbnSharedDeps_React_default.a.createElement(IpContent,{config:config});case field_types["c"].KEYWORD:return external_kbnSharedDeps_React_default.a.createElement(KeywordContent,{config:config});case field_types["c"].TEXT:return external_kbnSharedDeps_React_default.a.createElement(TextContent,{config:config});default:return external_kbnSharedDeps_React_default.a.createElement(OtherContent,{config:config})}}return external_kbnSharedDeps_React_default.a.createElement("div",{className:"mlDataVisualizerFieldExpandedRow","data-test-subj":`mlDataVisualizerFieldExpandedRow-${fieldName}`},getCardContent())};const field_names_filter_DataVisualizerFieldNamesFilter=({fields:fields,setVisibleFieldNames:setVisibleFieldNames,visibleFieldNames:visibleFieldNames})=>{const fieldNameTitle=Object(external_kbnSharedDeps_React_["useMemo"])(()=>external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataVisualizer.fileBased.fieldNameSelect",{defaultMessage:"Field name"}),[]);const options=Object(external_kbnSharedDeps_React_["useMemo"])(()=>fields.filter(d=>d.fieldName!==undefined).map(d=>({value:d.fieldName})),[fields]);return external_kbnSharedDeps_React_default.a.createElement(MultiSelectPicker,{title:fieldNameTitle,options:options,onChange:setVisibleFieldNames,checkedOptions:visibleFieldNames,dataTestSubj:"mlDataVisualizerFieldNameSelect"})};const DataVisualizerFieldTypesFilter=({fields:fields,setVisibleFieldTypes:setVisibleFieldTypes,visibleFieldTypes:visibleFieldTypes})=>{const fieldNameTitle=Object(external_kbnSharedDeps_React_["useMemo"])(()=>external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataVisualizer.fileBased.fieldTypeSelect",{defaultMessage:"Field type"}),[]);const options=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{const fieldTypesTracker=new Set;const fieldTypes=[];fields.forEach(({type:type})=>{if(type!==undefined&&!fieldTypesTracker.has(type)&&ML_JOB_FIELD_TYPES_OPTIONS[type]!==undefined){const item=ML_JOB_FIELD_TYPES_OPTIONS[type];fieldTypesTracker.add(type);fieldTypes.push({value:type,name:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:true}," ",item.name),type&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(FieldTypeIcon,{type:type,fieldName:item.name,tooltipEnabled:false,needsAria:true})))})}});return fieldTypes},[fields]);return external_kbnSharedDeps_React_default.a.createElement(MultiSelectPicker,{title:fieldNameTitle,options:options,onChange:setVisibleFieldTypes,checkedOptions:visibleFieldTypes,dataTestSubj:"mlDataVisualizerFieldTypeSelect"})};var common_=__webpack_require__(44);function getFieldNames(results){const{mappings:mappings,field_stats:fieldStats,column_names:columnNames}=results;const tempFields=columnNames!==undefined?columnNames:Object.keys(fieldStats);const differenceFields=Object(external_kbnSharedDeps_Lodash_["difference"])(Object.keys(mappings.properties),tempFields);const timestampIndex=differenceFields.indexOf("@timestamp");if(timestampIndex!==-1){differenceFields.splice(timestampIndex,1)}if(differenceFields.length){tempFields.push(...differenceFields)}return tempFields}function getSupportedFieldType(type){switch(type){case common_["ES_FIELD_TYPES"].FLOAT:case common_["ES_FIELD_TYPES"].HALF_FLOAT:case common_["ES_FIELD_TYPES"].SCALED_FLOAT:case common_["ES_FIELD_TYPES"].DOUBLE:case common_["ES_FIELD_TYPES"].INTEGER:case common_["ES_FIELD_TYPES"].LONG:case common_["ES_FIELD_TYPES"].SHORT:case common_["ES_FIELD_TYPES"].UNSIGNED_LONG:return field_types["c"].NUMBER;case common_["ES_FIELD_TYPES"].DATE:case common_["ES_FIELD_TYPES"].DATE_NANOS:return field_types["c"].DATE;default:return type}}function createFields(results){const{mappings:mappings,field_stats:fieldStats,num_messages_analyzed:numMessagesAnalyzed,timestamp_field:timestampField}=results;let numericFieldsCount=0;if(mappings&&mappings.properties&&fieldStats){const fieldNames=getFieldNames(results);const items=fieldNames.map(name=>{if(fieldStats[name]!==undefined){const field={fieldName:name,type:field_types["c"].UNKNOWN};const f=fieldStats[name];const m=mappings.properties[name];if(name===timestampField&&field.type===field_types["c"].UNKNOWN){field.type=field_types["c"].DATE}if(m!==undefined){field.type=getSupportedFieldType(m.type);if(field.type===field_types["c"].NUMBER){numericFieldsCount+=1}if(m.format!==undefined){field.format=m.format}}let _stats={};if(f.median_value!==undefined){_stats={..._stats,median:Object(round_to_decimal_place["a"])(f.median_value),mean:Object(round_to_decimal_place["a"])(f.mean_value),min:Object(round_to_decimal_place["a"])(f.min_value),max:Object(round_to_decimal_place["a"])(f.max_value)}}if(f.cardinality!==undefined){_stats={..._stats,cardinality:f.cardinality,count:f.count,sampleCount:numMessagesAnalyzed}}if(f.top_hits!==undefined){if(field.type===field_types["c"].TEXT){_stats={..._stats,examples:f.top_hits.map(hit=>hit.value)}}else{_stats={..._stats,topValues:f.top_hits.map(hit=>({key:hit.value,doc_count:hit.count}))}}}if(field.type===field_types["c"].DATE){_stats={..._stats,earliest:f.earliest,latest:f.latest}}field.stats=_stats;return field}else{const type=mappings.properties[name]&&mappings.properties[name].type===field_types["c"].TEXT?field_types["c"].TEXT:field_types["c"].UNKNOWN;return{fieldName:name,type:type,stats:{mean:0,count:0,sampleCount:numMessagesAnalyzed,cardinality:0}}}});return{fields:items,totalFieldsCount:items.length,totalMetricFieldsCount:numericFieldsCount}}return{fields:[],totalFieldsCount:0,totalMetricFieldsCount:0}}function filterFields(fields,visibleFieldNames,visibleFieldTypes){let items=fields;if(visibleFieldTypes&&visibleFieldTypes.length>0){items=items.filter(config=>visibleFieldTypes.findIndex(field=>field===config.type)>-1)}if(visibleFieldNames&&visibleFieldNames.length>0){items=items.filter(config=>visibleFieldNames.findIndex(field=>field===config.fieldName)>-1)}return{filteredFields:items,visibleFieldsCount:items.length,visibleMetricsCount:items.filter(d=>d.type===field_types["c"].NUMBER).length}}const fields_stats_grid_getDefaultDataVisualizerListState=()=>({pageIndex:0,pageSize:10,sortField:"fieldName",sortDirection:"asc",visibleFieldTypes:[],visibleFieldNames:[],showDistributions:true});function fields_stats_grid_getItemIdToExpandedRowMap(itemIds,items){return itemIds.reduce((m,fieldName)=>{const item=items.find(fieldVisConfig=>fieldVisConfig.fieldName===fieldName);if(item!==undefined){m[fieldName]=external_kbnSharedDeps_React_default.a.createElement(FileBasedDataVisualizerExpandedRow,{item:item})}return m},{})}const FieldsStatsGrid=({results:results})=>{var _dataVisualizerListSt,_dataVisualizerListSt2;const restorableDefaults=fields_stats_grid_getDefaultDataVisualizerListState();const[dataVisualizerListState,setDataVisualizerListState]=Object(url_state["b"])(ml_url_generator["b"].DATA_VISUALIZER_FILE,restorableDefaults);const visibleFieldTypes=(_dataVisualizerListSt=dataVisualizerListState.visibleFieldTypes)!==null&&_dataVisualizerListSt!==void 0?_dataVisualizerListSt:restorableDefaults.visibleFieldTypes;const setVisibleFieldTypes=values=>{setDataVisualizerListState({...dataVisualizerListState,visibleFieldTypes:values})};const visibleFieldNames=(_dataVisualizerListSt2=dataVisualizerListState.visibleFieldNames)!==null&&_dataVisualizerListSt2!==void 0?_dataVisualizerListSt2:restorableDefaults.visibleFieldNames;const setVisibleFieldNames=values=>{setDataVisualizerListState({...dataVisualizerListState,visibleFieldNames:values})};const{fields:fields,totalFieldsCount:totalFieldsCount,totalMetricFieldsCount:totalMetricFieldsCount}=Object(external_kbnSharedDeps_React_["useMemo"])(()=>createFields(results),[results,visibleFieldNames,visibleFieldTypes]);const{filteredFields:filteredFields,visibleFieldsCount:visibleFieldsCount,visibleMetricsCount:visibleMetricsCount}=Object(external_kbnSharedDeps_React_["useMemo"])(()=>filterFields(fields,visibleFieldNames,visibleFieldTypes),[results,visibleFieldNames,visibleFieldTypes]);const fieldsCountStats={visibleFieldsCount:visibleFieldsCount,totalFieldsCount:totalFieldsCount};const metricsStats={visibleMetricsCount:visibleMetricsCount,totalMetricFieldsCount:totalMetricFieldsCount};return external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center",gutterSize:"xs",style:{marginLeft:4},"data-test-subj":"mlDataVisualizerFieldCountPanel"},external_kbnSharedDeps_React_default.a.createElement(TotalFieldsCount,{fieldsCountStats:fieldsCountStats}),external_kbnSharedDeps_React_default.a.createElement(MetricFieldsCount,{metricsStats:metricsStats}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xs","data-test-subj":"mlDataVisualizerFieldCountPanel",justifyContent:"flexEnd"},external_kbnSharedDeps_React_default.a.createElement(field_names_filter_DataVisualizerFieldNamesFilter,{fields:fields,setVisibleFieldNames:setVisibleFieldNames,visibleFieldNames:visibleFieldNames}),external_kbnSharedDeps_React_default.a.createElement(DataVisualizerFieldTypesFilter,{fields:fields,setVisibleFieldTypes:setVisibleFieldTypes,visibleFieldTypes:visibleFieldTypes}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(DataVisualizerTable,{items:filteredFields,pageState:dataVisualizerListState,updatePageState:setDataVisualizerListState,getItemIdToExpandedRowMap:fields_stats_grid_getItemIdToExpandedRowMap}))};const ResultsView=({data:data,fileName:fileName,results:results,showEditFlyout:showEditFlyout,showExplanationFlyout:showExplanationFlyout,disableButtons:disableButtons})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPage"],{"data-test-subj":"mlPageFileDataVisResults"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageContentHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],null,external_kbnSharedDeps_React_default.a.createElement("h1",{"data-test-subj":"mlFileDataVisResultsTitle"},fileName))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement("div",{className:"results"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],{"data-test-subj":"mlFileDataVisFileContentPanel"},external_kbnSharedDeps_React_default.a.createElement(FileContents,{data:data,format:results.format,numberOfLines:results.num_lines_analyzed})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],{"data-test-subj":"mlFileDataVisSummaryPanel"},external_kbnSharedDeps_React_default.a.createElement(AnalysisSummary,{results:results}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"s",alignItems:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:()=>showEditFlyout(),disabled:disableButtons},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.resultsView.overrideSettingsButtonLabel",defaultMessage:"Override settings"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:()=>showExplanationFlyout(),disabled:disableButtons},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.resultsView.analysisExplanationButtonLabel",defaultMessage:"Analysis explanation"}))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],{"data-test-subj":"mlFileDataVisFileStatsPanel"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h2",{"data-test-subj":"mlFileDataVisStatsTitle"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.resultsView.fileStatsName",defaultMessage:"File stats"}))),external_kbnSharedDeps_React_default.a.createElement(FieldsStatsGrid,{results:results})))));const FileTooLarge=({fileSize:fileSize,maxFileSize:maxFileSize})=>{const fileSizeFormatted=external_kbnSharedDeps_ElasticNumeral_default()(fileSize).format(fileUpload_public_["FILE_SIZE_DISPLAY_FORMAT"]);const maxFileSizeFormatted=external_kbnSharedDeps_ElasticNumeral_default()(maxFileSize).format(fileUpload_public_["FILE_SIZE_DISPLAY_FORMAT"]);let errorText;if(fileSizeFormatted!==maxFileSizeFormatted){errorText=external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.fileErrorCallouts.fileSizeExceedsAllowedSizeErrorMessage",defaultMessage:"The size of the file you selected for upload is {fileSizeFormatted} which exceeds the maximum permitted size of {maxFileSizeFormatted}",values:{fileSizeFormatted:fileSizeFormatted,maxFileSizeFormatted:maxFileSizeFormatted}}))}else{const diffFormatted=external_kbnSharedDeps_ElasticNumeral_default()(fileSize-maxFileSize).format(fileUpload_public_["FILE_SIZE_DISPLAY_FORMAT"]);errorText=external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.fileErrorCallouts.fileSizeExceedsAllowedSizeByDiffFormatErrorMessage",defaultMessage:"The size of the file you selected for upload exceeds the maximum permitted size of {maxFileSizeFormatted} by {diffFormatted}",values:{maxFileSizeFormatted:maxFileSizeFormatted,diffFormatted:diffFormatted}}))}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.fileErrorCallouts.fileSizeTooLargeTitle",defaultMessage:"File size is too large"}),color:"danger",iconType:"cross","data-test-subj":"mlFileUploadErrorCallout fileTooLarge"},errorText)};const FileCouldNotBeRead=({error:error,loaded:loaded,showEditFlyout:showEditFlyout})=>{var _error$body;const message=(error===null||error===void 0?void 0:(_error$body=error.body)===null||_error$body===void 0?void 0:_error$body.message)||"";return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.fileErrorCallouts.fileCouldNotBeReadTitle",defaultMessage:"File structure cannot be determined"}),color:"danger",iconType:"cross","data-test-subj":"mlFileUploadErrorCallout fileCouldNotBeRead"},loaded===false&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.fileErrorCallouts.applyOverridesDescription",defaultMessage:"If you know something about this data, such as the file format or timestamp format, adding initial overrides may help us to infer the rest of the structure."}),external_kbnSharedDeps_React_default.a.createElement("br",null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:showEditFlyout,flush:"left",size:"xs"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.fileErrorCallouts.overrideButton",defaultMessage:"Apply override settings"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],null)),message,external_kbnSharedDeps_React_default.a.createElement(Explanation,{error:error}),loaded&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.fileErrorCallouts.revertingToPreviousSettingsDescription",defaultMessage:"Reverting to previous settings"}))))};const Explanation=({error:error})=>{var _error$body2,_error$body2$attribut,_error$body2$attribut2,_error$body2$attribut3,_error$body2$attribut4;if(!(error!==null&&error!==void 0&&(_error$body2=error.body)!==null&&_error$body2!==void 0&&(_error$body2$attribut=_error$body2.attributes)!==null&&_error$body2$attribut!==void 0&&(_error$body2$attribut2=_error$body2$attribut.body)!==null&&_error$body2$attribut2!==void 0&&(_error$body2$attribut3=_error$body2$attribut2.error)!==null&&_error$body2$attribut3!==void 0&&(_error$body2$attribut4=_error$body2$attribut3.suppressed)!==null&&_error$body2$attribut4!==void 0&&_error$body2$attribut4.length)){return null}const reason=error.body.attributes.body.error.suppressed[0].reason;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),reason.split("\n").map((m,i)=>external_kbnSharedDeps_React_default.a.createElement("div",{key:i},m)))};const FORMAT_OPTIONS=["delimited","ndjson","semi_structured_text"];const CUSTOM_DROPDOWN_OPTION="custom";const TIMESTAMP_OPTIONS=[CUSTOM_DROPDOWN_OPTION,"dd/MMM/yyyy:HH:mm:ss XX","EEE MMM dd HH:mm zzz yyyy","EEE MMM dd HH:mm:ss yyyy","EEE MMM dd HH:mm:ss zzz yyyy","EEE MMM dd yyyy HH:mm zzz","EEE MMM dd yyyy HH:mm:ss zzz","EEE, dd MMM yyyy HH:mm XX","EEE, dd MMM yyyy HH:mm XXX","EEE, dd MMM yyyy HH:mm:ss XX","EEE, dd MMM yyyy HH:mm:ss XXX","ISO8601","MMM dd HH:mm:ss","MMM dd HH:mm:ss,SSS","MMM dd HH:mm:ss,SSSSSS","MMM dd HH:mm:ss,SSSSSSSSS","MMM dd HH:mm:ss.SSS","MMM dd HH:mm:ss.SSSSSS","MMM dd HH:mm:ss.SSSSSSSSS","MMM dd HH:mm:ss:SSS","MMM dd HH:mm:ss:SSSSSS","MMM dd HH:mm:ss:SSSSSSSSS","MMM dd yyyy HH:mm:ss","MMM dd, yyyy h:mm:ss a","TAI64N","UNIX","UNIX_MS","yyyy-MM-dd HH:mm:ss","yyyy-MM-dd HH:mm:ss,SSS","yyyy-MM-dd HH:mm:ss,SSSSSS","yyyy-MM-dd HH:mm:ss,SSSSSSSSS","yyyy-MM-dd HH:mm:ss.SSS","yyyy-MM-dd HH:mm:ss.SSSSSS","yyyy-MM-dd HH:mm:ss.SSSSSSSSS","yyyy-MM-dd HH:mm:ss:SSS","yyyy-MM-dd HH:mm:ss:SSSSSS","yyyy-MM-dd HH:mm:ss:SSSSSSSSS","yyyy-MM-dd HH:mm:ss,SSS XX","yyyy-MM-dd HH:mm:ss,SSSSSS XX","yyyy-MM-dd HH:mm:ss,SSSSSSSSS XX","yyyy-MM-dd HH:mm:ss.SSS XX","yyyy-MM-dd HH:mm:ss.SSSSSS XX","yyyy-MM-dd HH:mm:ss.SSSSSSSSS XX","yyyy-MM-dd HH:mm:ss:SSS XX","yyyy-MM-dd HH:mm:ss:SSSSSS XX","yyyy-MM-dd HH:mm:ss:SSSSSSSSS XX","yyyy-MM-dd HH:mm:ss,SSSXX","yyyy-MM-dd HH:mm:ss,SSSSSSXX","yyyy-MM-dd HH:mm:ss,SSSSSSSSSXX","yyyy-MM-dd HH:mm:ss.SSSXX","yyyy-MM-dd HH:mm:ss.SSSSSSXX","yyyy-MM-dd HH:mm:ss.SSSSSSSSSXX","yyyy-MM-dd HH:mm:ss:SSSXX","yyyy-MM-dd HH:mm:ss:SSSSSSXX","yyyy-MM-dd HH:mm:ss:SSSSSSSSSXX","yyyy-MM-dd HH:mm:ss,SSSXXX","yyyy-MM-dd HH:mm:ss,SSSSSSXXX","yyyy-MM-dd HH:mm:ss,SSSSSSSSSXXX","yyyy-MM-dd HH:mm:ss.SSSXXX","yyyy-MM-dd HH:mm:ss.SSSSSSXXX","yyyy-MM-dd HH:mm:ss.SSSSSSSSSXXX","yyyy-MM-dd HH:mm:ss:SSSXXX","yyyy-MM-dd HH:mm:ss:SSSSSSXXX","yyyy-MM-dd HH:mm:ss:SSSSSSSSSXXX","yyyy-MM-dd HH:mm:ssXX","yyyy-MM-dd HH:mm:ssXXX","yyyyMMddHHmmss"];const DELIMITER_OPTIONS=["comma","tab","semicolon","pipe","space",CUSTOM_DROPDOWN_OPTION];const QUOTE_OPTIONS=["'",'"',"`"];const CHARSET_OPTIONS=["IBM00858","IBM437","IBM775","IBM850","IBM852","IBM855","IBM857","IBM862","IBM866","ISO-8859-1","ISO-8859-2","ISO-8859-4","ISO-8859-5","ISO-8859-7","ISO-8859-9","ISO-8859-13","ISO-8859-15","KOI8-R","KOI8-U","US-ASCII","UTF-8","UTF-16","UTF-16BE","UTF-16LE","UTF-32","UTF-32BE","UTF-32LE","x-UTF-32BE-BOM","x-UTF-32LE-BOM","windows-1250","windows-1251","windows-1252","windows-1253","windows-1254","windows-1257","Not available","x-IBM737","x-IBM874","x-UTF-16LE-BOM","Big5","Big5-HKSCS","EUC-JP","EUC-KR","GB18030","GB2312","GBK","IBM-Thai","IBM01140","IBM01141","IBM01142","IBM01143","IBM01144","IBM01145","IBM01146","IBM01147","IBM01148","IBM01149","IBM037","IBM1026","IBM1047","IBM273","IBM277","IBM278","IBM280","IBM284","IBM285","IBM297","IBM420","IBM424","IBM500","IBM860","IBM861","IBM863","IBM864","IBM865","IBM868","IBM869","IBM870","IBM871","IBM918","ISO-2022-CN","ISO-2022-JP","ISO-2022-KR","ISO-8859-3","ISO-8859-6","ISO-8859-8","JIS_X0201","JIS_X0212-1990","Shift_JIS","TIS-620","windows-1255","windows-1256","windows-1258","windows-31j","x-Big5-Solaris","x-euc-jp-linux","x-EUC-TW","x-eucJP-Open","x-IBM1006","x-IBM1025","x-IBM1046","x-IBM1097","x-IBM1098","x-IBM1112","x-IBM1122","x-IBM1123","x-IBM1124","x-IBM1381","x-IBM1383","x-IBM33722","x-IBM834","x-IBM856","x-IBM875","x-IBM921","x-IBM922","x-IBM930","x-IBM933","x-IBM935","x-IBM937","x-IBM939","x-IBM942","x-IBM942C","x-IBM943","x-IBM943C","x-IBM948","x-IBM949","x-IBM949C","x-IBM950","x-IBM964","x-IBM970","x-ISCII91","x-ISO2022-CN-CNS","x-ISO2022-CN-GB","x-iso-8859-11","x-JIS0208","x-JISAutoDetect","x-Johab","x-MacArabic","x-MacCentralEurope","x-MacCroatian","x-MacCyrillic","x-MacDingbat","x-MacGreek","x-MacHebrew","x-MacIceland","x-MacRoman","x-MacRomania","x-MacSymbol","x-MacThai","x-MacTurkish","x-MacUkraine","x-MS950-HKSCS","x-mswin-936","x-PCK","x-SJIS_0213","x-windows-50220","x-windows-50221","x-windows-874","x-windows-949","x-windows-950","x-windows-iso2022jp"];function getOptions(list){return list.map(o=>({label:o}))}function getFormatOptions(){return getOptions(FORMAT_OPTIONS)}function getTimestampFormatOptions(){return getOptions(TIMESTAMP_OPTIONS)}function getDelimiterOptions(){return getOptions(DELIMITER_OPTIONS)}function getQuoteOptions(){return getOptions(QUOTE_OPTIONS)}function getCharsetOptions(){return getOptions(CHARSET_OPTIONS)}const FRACTIONAL_SECOND_SEPARATORS=":.,";const VALID_LETTER_GROUPS={yyyy:true,yy:true,M:true,MM:true,MMM:true,MMMM:true,d:true,dd:true,EEE:true,EEEE:true,H:true,HH:true,h:true,mm:true,ss:true,a:true,XX:true,XXX:true,zzz:true};function isLetter(str){return str.length===1&&str.match(/[a-z]/i)}function isTimestampFormatValid(timestampFormat){const result={isValid:true,errorMessage:null};if(timestampFormat.indexOf("?")>=0){result.isValid=false;result.errorMessage=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.editFlyout.overrides.timestampQuestionMarkValidationErrorMessage",{defaultMessage:"Timestamp format {timestampFormat} not supported because it contains a question mark character ({fieldPlaceholder})",values:{timestampFormat:timestampFormat,fieldPlaceholder:"?"}});return result}let notQuoted=true;let prevChar=null;let prevLetterGroup=null;let pos=0;while(pos<timestampFormat.length){const curChar=timestampFormat.charAt(pos);if(curChar==="'"){notQuoted=!notQuoted}else if(notQuoted&&isLetter(curChar)){const startPos=pos;let endPos=startPos+1;while(endPos<timestampFormat.length&&timestampFormat.charAt(endPos)===curChar){++endPos;++pos}const letterGroup=timestampFormat.substring(startPos,endPos);if(VALID_LETTER_GROUPS[letterGroup]!==true){const length=letterGroup.length;if(curChar!=="S"||FRACTIONAL_SECOND_SEPARATORS.indexOf(prevChar)===-1||!("ss"===prevLetterGroup)||endPos-startPos>9){result.isValid=false;result.errorMessage=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.editFlyout.overrides.timestampLetterValidationErrorMessage",{defaultMessage:"Letter { length, plural, one { {lg} } other { group {lg} } } in {format} is not supported",values:{length:length,lg:letterGroup,format:timestampFormat}});if(curChar==="S"){result.errorMessage=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.editFlyout.overrides.timestampLetterSValidationErrorMessage",{defaultMessage:"Letter { length, plural, one { {lg} } other { group {lg} } } in {format} is not supported because it is not preceded by ss and a separator from {sep}",values:{length:length,lg:letterGroup,sep:FRACTIONAL_SECOND_SEPARATORS,format:timestampFormat}})}return result}}prevLetterGroup=letterGroup}prevChar=curChar;++pos}if(prevLetterGroup==null){result.isValid=false;result.errorMessage=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.editFlyout.overrides.timestampEmptyValidationErrorMessage",{defaultMessage:"No time format letter groups in timestamp format {timestampFormat}",values:{timestampFormat:timestampFormat}})}return result}function overrides_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const formatOptions=getFormatOptions();const timestampFormatOptions=getTimestampFormatOptions();const delimiterOptions=getDelimiterOptions();const quoteOptions=getQuoteOptions();const LINES_TO_SAMPLE_VALUE_MIN=3;const LINES_TO_SAMPLE_VALUE_MAX=1e6;class overrides_OverridesUI extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);overrides_defineProperty(this,"linesToSampleErrors",external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.editFlyout.overrides.linesToSampleErrorMessage",{defaultMessage:"Value must be greater than {min} and less than or equal to {max}",values:{min:LINES_TO_SAMPLE_VALUE_MIN,max:LINES_TO_SAMPLE_VALUE_MAX}}));overrides_defineProperty(this,"customTimestampFormatErrors",external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.editFlyout.overrides.customTimestampFormatErrorMessage",{defaultMessage:`Timestamp format must be a combination of these Java date/time formats:\n      yy, yyyy, M, MM, MMM, MMMM, d, dd, EEE, EEEE, H, HH, h, mm, ss, S through SSSSSSSSS, a, XX, XXX, zzz`}));overrides_defineProperty(this,"applyOverrides",()=>{const overrides={...this.state.overrides};overrides.delimiter=convertDelimiterBack(overrides.delimiter,this.state.customDelimiter);if(overrides.timestampFormat===CUSTOM_DROPDOWN_OPTION&&this.state.customTimestampFormat!==""){overrides.timestampFormat=this.state.customTimestampFormat}this.props.setOverrides(overrides)});overrides_defineProperty(this,"onFormatChange",([opt])=>{const format=opt?opt.label:"";this.setOverride({format:format})});overrides_defineProperty(this,"onTimestampFormatChange",([opt])=>{const timestampFormat=opt?opt.label:"";this.setOverride({timestampFormat:timestampFormat});if(opt!==CUSTOM_DROPDOWN_OPTION){this.props.setOverridesValid(true)}});overrides_defineProperty(this,"onCustomTimestampFormatChange",e=>{this.setState({customTimestampFormat:e.target.value});const{isValid:isValid,errorMessage:errorMessage}=isTimestampFormatValid(e.target.value);this.setState({timestampFormatValid:isValid,timestampFormatError:errorMessage});this.props.setOverridesValid(isValid)});overrides_defineProperty(this,"onTimestampFieldChange",([opt])=>{const timestampField=opt?opt.label:"";this.setOverride({timestampField:timestampField})});overrides_defineProperty(this,"onDelimiterChange",([opt])=>{const delimiter=opt?opt.label:"";this.setOverride({delimiter:delimiter})});overrides_defineProperty(this,"onCustomDelimiterChange",e=>{this.setState({customDelimiter:e.target.value})});overrides_defineProperty(this,"onQuoteChange",([opt])=>{const quote=opt?opt.label:"";this.setOverride({quote:quote})});overrides_defineProperty(this,"onHasHeaderRowChange",e=>{this.setOverride({hasHeaderRow:e.target.checked})});overrides_defineProperty(this,"onShouldTrimFieldsChange",e=>{this.setOverride({shouldTrimFields:e.target.checked})});overrides_defineProperty(this,"onCharsetChange",([opt])=>{const charset=opt?opt.label:"";this.setOverride({charset:charset})});overrides_defineProperty(this,"onColumnNameChange",(e,i)=>{const columnNames=this.state.overrides.columnNames;columnNames[i]=e.target.value;this.setOverride({columnNames:columnNames})});overrides_defineProperty(this,"grokPatternChange",e=>{this.setOverride({grokPattern:e.target.value})});overrides_defineProperty(this,"onLinesToSampleChange",e=>{const linesToSample=+e.target.value;this.setOverride({linesToSample:linesToSample});const linesToSampleValid=isLinesToSampleValid(linesToSample);this.setState({linesToSampleValid:linesToSampleValid});this.props.setOverridesValid(linesToSampleValid)});this.state={}}static getDerivedStateFromProps(props,state){const{originalSettings:originalSettings}=props;const{charset:charset,format:format,hasHeaderRow:hasHeaderRow,columnNames:columnNames,delimiter:delimiter,quote:quote,shouldTrimFields:shouldTrimFields,grokPattern:grokPattern,timestampField:timestampField,timestampFormat:timestampFormat,linesToSample:linesToSample}=props.overrides;const{delimiter:d,customDelimiter:customD}=convertDelimiter(delimiter===undefined?originalSettings.delimiter:delimiter);const{newColumnNames:newColumnNames,originalColumnNames:originalColumnNames}=getColumnNames(columnNames,originalSettings);const overrides={charset:charset===undefined?originalSettings.charset:charset,format:format===undefined?originalSettings.format:format,hasHeaderRow:hasHeaderRow===undefined?originalSettings.hasHeaderRow:hasHeaderRow,columnNames:newColumnNames,delimiter:d,quote:quote===undefined?originalSettings.quote:quote,shouldTrimFields:shouldTrimFields===undefined?originalSettings.shouldTrimFields:shouldTrimFields,grokPattern:grokPattern===undefined?originalSettings.grokPattern:grokPattern,timestampFormat:timestampFormat===undefined?originalSettings.timestampFormat:timestampFormat,timestampField:timestampField===undefined?originalSettings.timestampField:timestampField,linesToSample:linesToSample===undefined?originalSettings.linesToSample:+linesToSample};return{originalColumnNames:originalColumnNames,customDelimiter:customD===undefined?"":customD,customTimestampFormat:"",linesToSampleValid:true,timestampFormatValid:true,timestampFormatError:null,overrides:overrides,...state}}componentDidMount(){const originalTimestampFormat=this.props&&this.props.originalSettings&&this.props.originalSettings.timestampFormat;if(typeof this.props.setApplyOverrides==="function"){this.props.setApplyOverrides(this.applyOverrides)}if(originalTimestampFormat!==undefined){const optionExists=TIMESTAMP_OPTIONS.some(option=>option===originalTimestampFormat);if(optionExists===false){const overrides={...this.state.overrides};overrides.timestampFormat=CUSTOM_DROPDOWN_OPTION;this.setState({customTimestampFormat:originalTimestampFormat,overrides:overrides})}}}componentWillUnmount(){if(typeof this.props.unsetApplyOverrides==="function"){this.props.unsetApplyOverrides()}}setOverride(o){const overrides={...this.state.overrides,...o};this.setState({overrides:overrides})}render(){const{fields:fields}=this.props;const{customDelimiter:customDelimiter,customTimestampFormat:customTimestampFormat,originalColumnNames:originalColumnNames,linesToSampleValid:linesToSampleValid,timestampFormatError:timestampFormatError,timestampFormatValid:timestampFormatValid,overrides:overrides}=this.state;const{timestampFormat:timestampFormat,timestampField:timestampField,format:format,delimiter:delimiter,quote:quote,hasHeaderRow:hasHeaderRow,shouldTrimFields:shouldTrimFields,columnNames:columnNames,grokPattern:grokPattern,linesToSample:linesToSample}=overrides;const fieldOptions=getSortedFields(fields);const timestampFormatErrorsList=[this.customTimestampFormatErrors,timestampFormatError];const docsUrl=this.props.kibana.services.docLinks.links.aggs.date_format_pattern;const timestampFormatHelp=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{href:docsUrl,target:"_blank"},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.editFlyout.overrides.timestampFormatHelpText",{defaultMessage:"See more on accepted formats"})));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiForm"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{error:this.linesToSampleErrors,isInvalid:linesToSampleValid===false,label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.editFlyout.overrides.linesToSampleFormRowLabel",defaultMessage:"Number of lines to sample"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{value:linesToSample,onChange:this.onLinesToSampleChange,isInvalid:linesToSampleValid===false})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.editFlyout.overrides.dataFormatFormRowLabel",defaultMessage:"Data format"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{options:formatOptions,selectedOptions:selectedOption(format),onChange:this.onFormatChange,singleSelection:{asPlainText:true},isClearable:false})),format==="delimited"&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.editFlyout.overrides.delimiterFormRowLabel",defaultMessage:"Delimiter"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{options:delimiterOptions,selectedOptions:selectedOption(delimiter),onChange:this.onDelimiterChange,singleSelection:{asPlainText:true},isClearable:false})),delimiter===CUSTOM_DROPDOWN_OPTION&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.editFlyout.overrides.customDelimiterFormRowLabel",defaultMessage:"Custom delimiter"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{value:customDelimiter,onChange:this.onCustomDelimiterChange})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.editFlyout.overrides.quoteCharacterFormRowLabel",defaultMessage:"Quote character"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{options:quoteOptions,selectedOptions:selectedOption(quote),onChange:this.onQuoteChange,singleSelection:{asPlainText:true},isClearable:false})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCheckbox"],{id:"hasHeaderRow",label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.editFlyout.overrides.hasHeaderRowLabel",defaultMessage:"Has header row"}),checked:hasHeaderRow,onChange:this.onHasHeaderRowChange})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCheckbox"],{id:"shouldTrimFields",label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.editFlyout.overrides.trimFieldsLabel",defaultMessage:"Should trim fields"}),checked:shouldTrimFields,onChange:this.onShouldTrimFieldsChange}))),format==="semi_structured_text"&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.editFlyout.overrides.grokPatternFormRowLabel",defaultMessage:"Grok pattern"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTextArea"],{placeholder:grokPattern,value:grokPattern,onChange:this.grokPatternChange}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{helpText:timestampFormatHelp,label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.editFlyout.overrides.timestampFormatFormRowLabel",defaultMessage:"Timestamp format"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{options:timestampFormatOptions,selectedOptions:selectedOption(timestampFormat),onChange:this.onTimestampFormatChange,singleSelection:{asPlainText:true},isClearable:false})),timestampFormat===CUSTOM_DROPDOWN_OPTION&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{error:timestampFormatErrorsList,isInvalid:timestampFormatValid===false,label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.editFlyout.overrides.customTimestampFormatFormRowLabel",defaultMessage:"Custom timestamp format"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{value:customTimestampFormat,onChange:this.onCustomTimestampFormatChange,isInvalid:timestampFormatValid===false})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.editFlyout.overrides.timeFieldFormRowLabel",defaultMessage:"Time field"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{options:fieldOptions,selectedOptions:selectedOption(timestampField),onChange:this.onTimestampFieldChange,singleSelection:{asPlainText:true},isClearable:false})),format==="delimited"&&originalColumnNames.length>0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h3",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.editFlyout.overrides.editFieldNamesTitle",defaultMessage:"Edit field names"}))),originalColumnNames.map((f,i)=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:f,key:f},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{value:columnNames[i],onChange:e=>this.onColumnNameChange(e,i)})))))}}const Overrides=Object(kibanaReact_public_["withKibana"])(overrides_OverridesUI);function selectedOption(opt){return[{label:opt||""}]}function getSortedFields(fields){return fields.map(f=>({label:f})).sort((a,b)=>a.label.localeCompare(b.label,undefined,{numeric:true}))}function convertDelimiter(d){switch(d){case",":return{delimiter:"comma"};case"\t":return{delimiter:"tab"};case";":return{delimiter:"semicolon"};case"|":return{delimiter:"pipe"};case" ":return{delimiter:"space"};default:return{delimiter:CUSTOM_DROPDOWN_OPTION,customDelimiter:d}}}function convertDelimiterBack(delimiter,customDelimiter){switch(delimiter){case"comma":return",";case"tab":return"\t";case"semicolon":return";";case"pipe":return"|";case"space":return" ";case CUSTOM_DROPDOWN_OPTION:return customDelimiter;default:return undefined}}function getColumnNames(columnNames,originalSettings){const newColumnNames=columnNames===undefined&&originalSettings.columnNames!==undefined?[...originalSettings.columnNames]:columnNames;const originalColumnNames=newColumnNames!==undefined?[...newColumnNames]:[];return{newColumnNames:newColumnNames,originalColumnNames:originalColumnNames}}function isLinesToSampleValid(linesToSample){return linesToSample>LINES_TO_SAMPLE_VALUE_MIN&&linesToSample<=LINES_TO_SAMPLE_VALUE_MAX}function edit_flyout_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class edit_flyout_EditFlyout extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);edit_flyout_defineProperty(this,"applyAndClose",()=>{this.applyOverrides();this.props.closeEditFlyout()});edit_flyout_defineProperty(this,"setApplyOverrides",applyOverrides=>{this.applyOverrides=applyOverrides});edit_flyout_defineProperty(this,"unsetApplyOverrides",()=>{this.applyOverrides=()=>{}});edit_flyout_defineProperty(this,"setOverridesValid",overridesValid=>{this.setState({overridesValid:overridesValid})});this.applyOverrides=()=>{};this.state={overridesValid:true}}render(){const{isFlyoutVisible:isFlyoutVisible,closeEditFlyout:closeEditFlyout,setOverrides:setOverrides,overrides:overrides,originalSettings:originalSettings,fields:fields}=this.props;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,isFlyoutVisible&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyout"],{onClose:closeEditFlyout,size:"m"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],null,external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.editFlyout.overrideSettingsTitle",defaultMessage:"Override settings"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutBody"],null,external_kbnSharedDeps_React_default.a.createElement(Overrides,{setOverrides:setOverrides,overrides:overrides,originalSettings:originalSettings,setApplyOverrides:this.setApplyOverrides,setOverridesValid:this.setOverridesValid,fields:fields})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutFooter"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{iconType:"cross",onClick:closeEditFlyout,flush:"left"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.editFlyout.closeOverrideSettingsButtonLabel",defaultMessage:"Close"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:this.applyAndClose,isDisabled:this.state.overridesValid===false,fill:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.editFlyout.applyOverrideSettingsButtonLabel",defaultMessage:"Apply"})))))))}}const ExplanationFlyout=({results:results,closeFlyout:closeFlyout})=>{const explanation=results.explanation;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyout"],{onClose:closeFlyout,hideCloseButton:true,size:"m"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutHeader"],{hasBorder:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"m"},external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.explanationFlyout.title",defaultMessage:"Analysis explanation"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutBody"],null,external_kbnSharedDeps_React_default.a.createElement(Content,{explanation:explanation})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutFooter"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{iconType:"cross",onClick:closeFlyout,flush:"left"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.explanationFlyout.closeButton",defaultMessage:"Close"}))))))};const Content=({explanation:explanation})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.explanationFlyout.content",defaultMessage:"The logical steps that have produced the analysis results."}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSubSteps"],null,external_kbnSharedDeps_React_default.a.createElement("ul",{style:{wordBreak:"break-word"}},explanation.map((e,i)=>external_kbnSharedDeps_React_default.a.createElement("li",{key:i},e,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"})))))));function importer_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const CHUNK_SIZE=5e3;const MAX_CHUNK_CHAR_COUNT=1e6;const IMPORT_RETRIES=5;const STRING_CHUNKS_MB=100;class importer_Importer{constructor({settings:settings,mappings:mappings,pipeline:pipeline}){importer_defineProperty(this,"_settings",void 0);importer_defineProperty(this,"_mappings",void 0);importer_defineProperty(this,"_pipeline",void 0);importer_defineProperty(this,"_docArray",[]);this._settings=settings;this._mappings=mappings;this._pipeline=pipeline}read(data){const decoder=new TextDecoder;const size=STRING_CHUNKS_MB*Math.pow(2,20);const parts=Math.ceil(data.byteLength/size);let remainder=0;for(let i=0;i<parts;i++){const byteArray=decoder.decode(data.slice(i*size-remainder,(i+1)*size));const{success:success,docs:docs,remainder:tempRemainder}=this._createDocs(byteArray);if(success){this._docArray=this._docArray.concat(docs);remainder=tempRemainder}else{return{success:false}}}return{success:true}}async initializeImport(index){const settings=this._settings;const mappings=this._mappings;const pipeline=this._pipeline;updatePipelineTimezone(pipeline);const ingestPipeline=pipeline!==undefined?{id:`${index}-pipeline`,pipeline:pipeline}:{};const createIndexResp=await ml_api_service["ml"].fileDatavisualizer.import({id:undefined,index:index,data:[],settings:settings,mappings:mappings,ingestPipeline:ingestPipeline});return createIndexResp}async import(id,index,pipelineId,setImportProgress){if(!id||!index){return{success:false,error:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.importView.noIdOrIndexSuppliedErrorMessage",{defaultMessage:"no ID or index supplied"})}}const chunks=createDocumentChunks(this._docArray);const ingestPipeline={id:pipelineId};let success=true;const failures=[];let error;for(let i=0;i<chunks.length;i++){const aggs={id:id,index:index,data:chunks[i],settings:{},mappings:{},ingestPipeline:ingestPipeline};let retries=IMPORT_RETRIES;let resp={success:false,failures:[],docCount:0,id:"",index:"",pipelineId:""};while(resp.success===false&&retries>0){try{resp=await ml_api_service["ml"].fileDatavisualizer.import(aggs);if(retries<IMPORT_RETRIES){console.log(`Retrying import ${IMPORT_RETRIES-retries}`)}retries--}catch(err){resp.success=false;resp.error=err;retries=0}}if(resp.success){setImportProgress((i+1)/chunks.length*100)}else{console.error(resp);success=false;error=resp.error;populateFailures(resp,failures,i);break}populateFailures(resp,failures,i)}const result={success:success,failures:failures,docCount:this._docArray.length};if(success){setImportProgress(100)}else{result.error=error}return result}}function populateFailures(error,failures,chunkCount){if(error.failures&&error.failures.length){for(let f=0;f<error.failures.length;f++){const failure=error.failures[f];failure.item=failure.item+CHUNK_SIZE*chunkCount}failures.push(...error.failures)}}function updatePipelineTimezone(ingestPipeline){if(ingestPipeline!==undefined&&ingestPipeline.processors&&ingestPipeline.processors){const dateProcessor=ingestPipeline.processors.find(p=>p.date!==undefined&&p.date.timezone==="{{ event.timezone }}");if(dateProcessor){dateProcessor.date.timezone=external_kbnSharedDeps_Moment_default.a.tz.guess()}}}function createDocumentChunks(docArray){const chunks=[];const tempChunks=Object(external_kbnSharedDeps_Lodash_["chunk"])(docArray,CHUNK_SIZE);for(let i=0;i<tempChunks.length;i++){const docs=tempChunks[i];const numberOfDocs=docs.length;const charCountOfDocs=JSON.stringify(docs).length;if(charCountOfDocs>MAX_CHUNK_CHAR_COUNT){const adjustedChunkSize=Math.floor(MAX_CHUNK_CHAR_COUNT/charCountOfDocs*numberOfDocs);const smallerChunks=Object(external_kbnSharedDeps_Lodash_["chunk"])(docs,adjustedChunkSize);chunks.push(...smallerChunks)}else{chunks.push(docs)}}return chunks}function message_importer_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class message_importer_MessageImporter extends importer_Importer{constructor(results,settings){super(settings);message_importer_defineProperty(this,"_excludeLinesRegex",void 0);message_importer_defineProperty(this,"_multilineStartRegex",void 0);this._excludeLinesRegex=results.exclude_lines_pattern===undefined?null:new RegExp(results.exclude_lines_pattern);this._multilineStartRegex=results.multiline_start_pattern===undefined?null:new RegExp(results.multiline_start_pattern)}_createDocs(text){let remainder=0;try{const docs=[];let message="";let line="";for(let i=0;i<text.length;i++){const char=text[i];if(char==="\n"){message=this._processLine(docs,message,line);line=""}else{line+=char}}remainder=line.length;if(message!==""){this._addMessage(docs,message)}if(docs[0]&&docs[0].message===""){docs.shift()}return{success:true,docs:docs,remainder:remainder}}catch(error){return{success:false,docs:[],remainder:remainder,error:error}}}_processLine(data,message,line){if(this._excludeLinesRegex===null||line.match(this._excludeLinesRegex)===null){if(this._multilineStartRegex===null||line.match(this._multilineStartRegex)!==null){this._addMessage(data,message);message=""}else if(data.length===0){return""}else{message+="\n"}message+=line}return message}_addMessage(data,message){message=message.replace(/\r$/,"");data.push({message:message})}}class ndjson_importer_NdjsonImporter extends importer_Importer{constructor(results,settings){super(settings)}_createDocs(json){let remainder=0;try{const splitJson=json.split(/}\s*\n/);const incompleteLastLine=json.match(/}\s*\n?$/)===null;const docs=[];if(splitJson.length){for(let i=0;i<splitJson.length-1;i++){if(splitJson[i]!==""){docs.push(`${splitJson[i]}}`)}}const lastDoc=splitJson[splitJson.length-1];if(lastDoc){if(incompleteLastLine===true){remainder=lastDoc.length}else{docs.push(`${lastDoc}}`)}}}return{success:true,docs:docs,remainder:remainder}}catch(error){return{success:false,docs:[],remainder:remainder,error:error}}}}function importerFactory(format,results,settings){switch(format){case"delimited":case"semi_structured_text":return new message_importer_MessageImporter(results,settings);case"ndjson":return new ndjson_importer_NdjsonImporter(results,settings);default:return}}const RECHECK_DELAY_MS=3e3;const ResultsLinks=({fieldStats:fieldStats,index:index,indexPatternId:indexPatternId,timeFieldName:timeFieldName,createIndexPattern:createIndexPattern,showFilebeatFlyout:showFilebeatFlyout})=>{const[duration,setDuration]=Object(external_kbnSharedDeps_React_["useState"])({from:"now-30m",to:"now"});const[showCreateJobLink,setShowCreateJobLink]=Object(external_kbnSharedDeps_React_["useState"])(false);const[globalState,setGlobalState]=Object(external_kbnSharedDeps_React_["useState"])();const[discoverLink,setDiscoverLink]=Object(external_kbnSharedDeps_React_["useState"])("");const[indexManagementLink,setIndexManagementLink]=Object(external_kbnSharedDeps_React_["useState"])("");const[indexPatternManagementLink,setIndexPatternManagementLink]=Object(external_kbnSharedDeps_React_["useState"])("");const[dataVisualizerLink,setDataVisualizerLink]=Object(external_kbnSharedDeps_React_["useState"])("");const[createJobsSelectTypePage,setCreateJobsSelectTypePage]=Object(external_kbnSharedDeps_React_["useState"])("");const mlUrlGenerator=Object(contexts_kibana["d"])();const{services:{application:{getUrlForApp:getUrlForApp,capabilities:capabilities},share:{urlGenerators:{getUrlGenerator:getUrlGenerator}}}}=Object(contexts_kibana["b"])();Object(external_kbnSharedDeps_React_["useEffect"])(()=>{let unmounted=false;const getDiscoverUrl=async()=>{var _capabilities$discove,_capabilities$discove2;const isDiscoverAvailable=(_capabilities$discove=(_capabilities$discove2=capabilities.discover)===null||_capabilities$discove2===void 0?void 0:_capabilities$discove2.show)!==null&&_capabilities$discove!==void 0?_capabilities$discove:false;if(!isDiscoverAvailable){return}const state={indexPatternId:indexPatternId};if(globalState!==null&&globalState!==void 0&&globalState.time){state.timeRange=globalState.time}let discoverUrlGenerator;try{discoverUrlGenerator=getUrlGenerator(discover_public_["DISCOVER_APP_URL_GENERATOR"])}catch(error){}if(!discoverUrlGenerator){return}const discoverUrl=await discoverUrlGenerator.createUrl(state);if(!unmounted){setDiscoverLink(discoverUrl)}};const getDataVisualizerLink=async()=>{const _dataVisualizerLink=await mlUrlGenerator.createUrl({page:ml_url_generator["b"].DATA_VISUALIZER_INDEX_VIEWER,pageState:{index:indexPatternId,globalState:globalState}});if(!unmounted){setDataVisualizerLink(_dataVisualizerLink)}};const getADCreateJobsSelectTypePage=async()=>{const _createJobsSelectTypePage=await mlUrlGenerator.createUrl({page:ml_url_generator["b"].ANOMALY_DETECTION_CREATE_JOB_SELECT_TYPE,pageState:{index:indexPatternId,globalState:globalState}});if(!unmounted){setCreateJobsSelectTypePage(_createJobsSelectTypePage)}};getDiscoverUrl();getDataVisualizerLink();getADCreateJobsSelectTypePage();if(!unmounted){setIndexManagementLink(getUrlForApp("management",{path:"/data/index_management/indices"}));setIndexPatternManagementLink(getUrlForApp("management",{path:`/kibana/indexPatterns${createIndexPattern?`/patterns/${indexPatternId}`:""}`}))}return()=>{unmounted=true}},[indexPatternId,getUrlGenerator,JSON.stringify(globalState)]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setShowCreateJobLink(Object(check_capabilities["e"])("canCreateJob")&&Object(check_ml_nodes["e"])());updateTimeValues()},[]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const _globalState={time:{from:duration.from,to:duration.to}};setGlobalState(_globalState)},[duration]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(fieldStats&&typeof fieldStats==="object"&&timeFieldName!==undefined&&fieldStats.hasOwnProperty(timeFieldName)&&fieldStats[timeFieldName].earliest!==undefined&&fieldStats[timeFieldName].latest!==undefined){setGlobalState({time:{from:fieldStats[timeFieldName].earliest,to:fieldStats[timeFieldName].latest}})}},[timeFieldName,fieldStats]);async function updateTimeValues(recheck=true){if(timeFieldName!==undefined){const{from:from,to:to}=await getFullTimeRange(index,timeFieldName);setDuration({from:from===null?duration.from:from,to:to===null?duration.to:to});if(recheck&&(from===null||to===null)){setTimeout(()=>{updateTimeValues(false)},RECHECK_DELAY_MS)}}}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"l"},createIndexPattern&&discoverLink&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCard"],{icon:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{size:"xxl",type:`discoverApp`}),title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.resultsLinks.viewIndexInDiscoverTitle",defaultMessage:"View index in Discover"}),description:"",href:discoverLink})),Object(license["d"])()===true&&timeFieldName!==undefined&&showCreateJobLink&&createIndexPattern&&createJobsSelectTypePage&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCard"],{icon:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{size:"xxl",type:`machineLearningApp`}),title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.resultsLinks.createNewMLJobTitle",defaultMessage:"Create new ML job"}),description:"",href:createJobsSelectTypePage})),createIndexPattern&&dataVisualizerLink&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCard"],{icon:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{size:"xxl",type:`dataVisualizer`}),title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.resultsLinks.openInDataVisualizerTitle",defaultMessage:"Open in Data Visualizer"}),description:"",href:dataVisualizerLink})),indexManagementLink&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCard"],{icon:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{size:"xxl",type:`managementApp`}),title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.resultsLinks.indexManagementTitle",defaultMessage:"Index Management"}),description:"",href:indexManagementLink})),indexPatternManagementLink&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCard"],{icon:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{size:"xxl",type:`managementApp`}),title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.resultsLinks.indexPatternManagementTitle",defaultMessage:"Index Pattern Management"}),description:"",href:indexPatternManagementLink})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCard"],{icon:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{size:"xxl",type:`filebeatApp`}),title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.resultsLinks.fileBeatConfig",defaultMessage:"Create Filebeat configuration"}),description:"",onClick:showFilebeatFlyout})))};async function getFullTimeRange(index,timeFieldName){const query={bool:{must:[{query_string:{analyze_wildcard:true,query:"*"}}]}};const resp=await ml_api_service["ml"].getTimeFieldRange({index:index,timeFieldName:timeFieldName,query:query});return{from:external_kbnSharedDeps_Moment_default()(resp.start.epoch).toISOString(),to:external_kbnSharedDeps_Moment_default()(resp.end.epoch).toISOString()}}function createFilebeatConfig(index,results,ingestPipelineId,username){return["filebeat.inputs:","- type: log",...getPaths(),...getEncoding(results),...getExcludeLines(results),...getMultiline(results),"",...getProcessors(results),"output.elasticsearch:",'  hosts: ["<es_url>"]',...getUserDetails(username),`  index: "${index}"`,`  pipeline: "${ingestPipelineId}"`,"","setup:","  template.enabled: false","  ilm.enabled: false"].join("\n")}function getPaths(){const txt=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.fileBeatConfig.paths",{defaultMessage:"add path to your files here"});return["  paths:",`  - '<${txt}>'`]}function getEncoding(results){return results.charset!=="UTF-8"?[`  encoding: ${results.charset}`]:[]}function getExcludeLines(results){return results.exclude_lines_pattern!==undefined?[`  exclude_lines: ['${results.exclude_lines_pattern.replace(/'/g,"''")}']`]:[]}function getMultiline(results){return results.multiline_start_pattern!==undefined?["  multiline:",`    pattern: '${results.multiline_start_pattern.replace(/'/g,"''")}'`,"    match: after","    negate: true"]:[]}function getProcessors(results){return results.need_client_timezone===true?["processors:","- add_locale: ~",""]:[]}function getUserDetails(username){return username!==null?[`  username: "${username}"`,'  password: "<password>"']:[]}let filebeat_config_flyout_EDITOR_MODE;(function(EDITOR_MODE){EDITOR_MODE[EDITOR_MODE["HIDDEN"]=0]="HIDDEN";EDITOR_MODE[EDITOR_MODE["READONLY"]=1]="READONLY";EDITOR_MODE[EDITOR_MODE["EDITABLE"]=2]="EDITABLE"})(filebeat_config_flyout_EDITOR_MODE||(filebeat_config_flyout_EDITOR_MODE={}));const FilebeatConfigFlyout=({index:index,results:results,indexPatternId:indexPatternId,ingestPipelineId:ingestPipelineId,closeFlyout:closeFlyout})=>{const[fileBeatConfig,setFileBeatConfig]=Object(external_kbnSharedDeps_React_["useState"])("");const[username,setUsername]=Object(external_kbnSharedDeps_React_["useState"])(null);const{services:{security:security}}=Object(contexts_kibana["b"])();Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(security!==undefined){security.authc.getCurrentUser().then(user=>{setUsername(user.username===undefined?null:user.username)})}},[]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const config=createFilebeatConfig(index,results,ingestPipelineId,username);setFileBeatConfig(config)},[username]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyout"],{onClose:closeFlyout,hideCloseButton:true,size:"m"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(filebeat_config_flyout_Contents,{value:fileBeatConfig,username:username,index:index}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutFooter"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{iconType:"cross",onClick:closeFlyout,flush:"left"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.fileBeatConfigFlyout.closeButton",defaultMessage:"Close"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCopy"],{textToCopy:fileBeatConfig},copy=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:copy},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.fileBeatConfigFlyout.copyButton",defaultMessage:"Copy to clipboard"})))))))};const filebeat_config_flyout_Contents=({value:value,index:index,username:username})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h5",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.resultsLinks.fileBeatConfigTitle",defaultMessage:"Filebeat configuration"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.resultsLinks.fileBeatConfigTopText1",defaultMessage:"Additional data can be uploaded to the {index} index using Filebeat.",values:{index:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCode"],null,index)}})),external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.resultsLinks.fileBeatConfigTopText2",defaultMessage:"Modify {filebeatYml} to set the connection information:",values:{filebeatYml:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCode"],null,"filebeat.yml")}})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCodeBlock"],{language:"bash"},value),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement("p",null,username===null?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.resultsLinks.fileBeatConfigBottomTextNoUsername",defaultMessage:"Where {esUrl} is the URL of Elasticsearch.",values:{esUrl:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCode"],null,"<es_url>")}}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.resultsLinks.fileBeatConfigBottomText",defaultMessage:"Where {password} is the password of the {user} user, {esUrl} is the URL of Elasticsearch.",values:{user:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCode"],null,username),password:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCode"],null,"<password>"),esUrl:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCode"],null,"<es_url>")}})));let IMPORT_STATUS;(function(IMPORT_STATUS){IMPORT_STATUS["INCOMPLETE"]="incomplete";IMPORT_STATUS["COMPLETE"]="complete";IMPORT_STATUS["FAILED"]="danger"})(IMPORT_STATUS||(IMPORT_STATUS={}));const ImportProgress=({statuses:statuses})=>{const{reading:reading,readStatus:readStatus,parseJSONStatus:parseJSONStatus,indexCreatedStatus:indexCreatedStatus,ingestPipelineCreatedStatus:ingestPipelineCreatedStatus,indexPatternCreatedStatus:indexPatternCreatedStatus,uploadProgress:uploadProgress,uploadStatus:uploadStatus,createIndexPattern:createIndexPattern,createPipeline:createPipeline}=statuses;let statusInfo=null;let completedStep=0;if(reading===true&&readStatus===IMPORT_STATUS.INCOMPLETE&&parseJSONStatus===IMPORT_STATUS.INCOMPLETE){completedStep=0}if(readStatus===IMPORT_STATUS.COMPLETE&&indexCreatedStatus===IMPORT_STATUS.INCOMPLETE&&ingestPipelineCreatedStatus===IMPORT_STATUS.INCOMPLETE){completedStep=1}if(indexCreatedStatus===IMPORT_STATUS.COMPLETE){completedStep=2}if(ingestPipelineCreatedStatus===IMPORT_STATUS.COMPLETE||createPipeline===false&&indexCreatedStatus===IMPORT_STATUS.COMPLETE){completedStep=3}if(uploadStatus===IMPORT_STATUS.COMPLETE){completedStep=4}if(indexPatternCreatedStatus===IMPORT_STATUS.COMPLETE){completedStep=5}let processFileTitle=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.importProgress.processFileTitle",{defaultMessage:"Process file"});let createIndexTitle=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.importProgress.createIndexTitle",{defaultMessage:"Create index"});let createIngestPipelineTitle=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.importProgress.createIngestPipelineTitle",{defaultMessage:"Create ingest pipeline"});let uploadingDataTitle=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.importProgress.uploadDataTitle",{defaultMessage:"Upload data"});let createIndexPatternTitle=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.importProgress.createIndexPatternTitle",{defaultMessage:"Create index pattern"});const creatingIndexStatus=external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importProgress.stepTwoCreatingIndexDescription",defaultMessage:"Creating index"}));const creatingIndexAndIngestPipelineStatus=external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importProgress.stepTwoCreatingIndexIngestPipelineDescription",defaultMessage:"Creating index and ingest pipeline"}));if(completedStep>=0){processFileTitle=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.importProgress.processingFileTitle",{defaultMessage:"Processing file"});statusInfo=external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importProgress.processingImportedFileDescription",defaultMessage:"Processing file for import"}))}if(completedStep>=1){processFileTitle=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.importProgress.fileProcessedTitle",{defaultMessage:"File processed"});createIndexTitle=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.importProgress.creatingIndexTitle",{defaultMessage:"Creating index"});statusInfo=createPipeline===true?creatingIndexAndIngestPipelineStatus:creatingIndexStatus}if(completedStep>=2){createIndexTitle=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.importProgress.indexCreatedTitle",{defaultMessage:"Index created"});createIngestPipelineTitle=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.importProgress.creatingIngestPipelineTitle",{defaultMessage:"Creating ingest pipeline"});statusInfo=createPipeline===true?creatingIndexAndIngestPipelineStatus:creatingIndexStatus}if(completedStep>=3){createIngestPipelineTitle=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.importProgress.ingestPipelineCreatedTitle",{defaultMessage:"Ingest pipeline created"});uploadingDataTitle=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.importProgress.uploadingDataTitle",{defaultMessage:"Uploading data"});statusInfo=external_kbnSharedDeps_React_default.a.createElement(UploadFunctionProgress,{progress:uploadProgress})}if(completedStep>=4){uploadingDataTitle=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.importProgress.dataUploadedTitle",{defaultMessage:"Data uploaded"});if(createIndexPattern===true){createIndexPatternTitle=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.importProgress.creatingIndexPatternTitle",{defaultMessage:"Creating index pattern"});statusInfo=external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importProgress.creatingIndexPatternDescription",defaultMessage:"Creating index pattern"}))}else{statusInfo=null}}if(completedStep>=5){createIndexPatternTitle=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.importProgress.indexPatternCreatedTitle",{defaultMessage:"Index pattern created"});statusInfo=null}const steps=[{title:processFileTitle,isSelected:true,isComplete:readStatus===IMPORT_STATUS.COMPLETE&&parseJSONStatus===IMPORT_STATUS.COMPLETE,status:parseJSONStatus===IMPORT_STATUS.FAILED?parseJSONStatus:readStatus,onClick:()=>{}},{title:createIndexTitle,isSelected:readStatus===IMPORT_STATUS.COMPLETE,isComplete:indexCreatedStatus===IMPORT_STATUS.COMPLETE,status:indexCreatedStatus,onClick:()=>{}},{title:uploadingDataTitle,isSelected:indexCreatedStatus===IMPORT_STATUS.COMPLETE&&(createPipeline===false||createPipeline===true&&ingestPipelineCreatedStatus===IMPORT_STATUS.COMPLETE),isComplete:uploadStatus===IMPORT_STATUS.COMPLETE,status:uploadStatus,onClick:()=>{}}];if(createPipeline===true){steps.splice(2,0,{title:createIngestPipelineTitle,isSelected:indexCreatedStatus===IMPORT_STATUS.COMPLETE,isComplete:ingestPipelineCreatedStatus===IMPORT_STATUS.COMPLETE,status:ingestPipelineCreatedStatus,onClick:()=>{}})}if(createIndexPattern===true){steps.push({title:createIndexPatternTitle,isSelected:uploadStatus===IMPORT_STATUS.COMPLETE,isComplete:indexPatternCreatedStatus===IMPORT_STATUS.COMPLETE,status:indexPatternCreatedStatus,onClick:()=>{}})}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiStepsHorizontal"],{steps:steps,style:{backgroundColor:"transparent"}}),statusInfo&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),statusInfo))};const UploadFunctionProgress=({progress:progress})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importProgress.uploadingDataDescription",defaultMessage:"Uploading data"})),progress<100&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiProgress"],{value:progress,max:100,color:"primary",size:"s"})));const ImportErrors=({errors:errors,statuses:statuses})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:errors_title(statuses),color:"danger",iconType:"cross"},errors.map((e,i)=>external_kbnSharedDeps_React_default.a.createElement(ImportError,{error:e,key:i})));function errors_title(statuses){switch(IMPORT_STATUS.FAILED){case statuses.readStatus:return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importErrors.readingFileErrorMessage",defaultMessage:"Error reading file"});case statuses.parseJSONStatus:return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importErrors.parsingJSONErrorMessage",defaultMessage:"Error parsing JSON"});case statuses.indexCreatedStatus:return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importErrors.creatingIndexErrorMessage",defaultMessage:"Error creating index"});case statuses.ingestPipelineCreatedStatus:return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importErrors.creatingIngestPipelineErrorMessage",defaultMessage:"Error creating ingest pipeline"});case statuses.uploadStatus:return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importErrors.uploadingDataErrorMessage",defaultMessage:"Error uploading data"});case statuses.indexPatternCreatedStatus:return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importErrors.creatingIndexPatternErrorMessage",defaultMessage:"Error creating index pattern"});case statuses.permissionCheckStatus:return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importErrors.checkingPermissionErrorMessage",defaultMessage:"Import permissions error"});default:return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importErrors.defaultErrorMessage",defaultMessage:"Error"})}}const ImportError=({error:error})=>{const errorObj=errors_toString(error);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement("p",null,errorObj.msg),errorObj.more!==undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiAccordion"],{id:"more",buttonContent:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importErrors.moreButtonLabel",defaultMessage:"More"}),paddingSize:"m"},errorObj.more))};function errors_toString(error){if(typeof error==="string"){return{msg:error}}if(typeof error==="object"){if(error.msg!==undefined){return{msg:error.msg}}else if(error.error!==undefined){if(typeof error.error==="object"){if(error.error.reason!==undefined){const errorObj={msg:error.error.reason};if(error.error.root_cause!==undefined){errorObj.more=JSON.stringify(error.error.root_cause)}return errorObj}if(error.error.message!==undefined){return{msg:error.error.message}}}else{return{msg:error.error}}}else{return{msg:JSON.stringify(error)}}}return{msg:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.importErrors.unknownErrorMessage",{defaultMessage:"Unknown error"})}}const ImportSummary=({index:index,indexPattern:indexPattern,ingestPipelineId:ingestPipelineId,docCount:docCount,importFailures:importFailures,createIndexPattern:createIndexPattern,createPipeline:createPipeline})=>{const items=import_summary_createDisplayItems(index,indexPattern,ingestPipelineId,docCount,importFailures,createIndexPattern,createPipeline);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importSummary.importCompleteTitle",defaultMessage:"Import complete"}),color:"success",iconType:"check","data-test-subj":"mlFileImportSuccessCallout"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{type:"column",listItems:items,className:"import-summary-list"})),importFailures&&importFailures.length>0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importSummary.documentsCouldNotBeImportedTitle",defaultMessage:"Some documents could not be imported"}),color:"warning",iconType:"help"},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importSummary.documentsCouldNotBeImportedDescription",defaultMessage:"{importFailuresLength} out of {docCount} documents could not be imported. This could be due to lines not matching the Grok pattern.",values:{importFailuresLength:importFailures.length,docCount:docCount}})),external_kbnSharedDeps_React_default.a.createElement(Failures,{failedDocs:importFailures}))))};const Failures=({failedDocs:failedDocs})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiAccordion"],{id:"failureList",buttonContent:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importSummary.failedDocumentsButtonLabel",defaultMessage:"Failed documents"}),paddingSize:"m"},external_kbnSharedDeps_React_default.a.createElement("div",{className:"failure-list"},failedDocs.map(({item:item,reason:reason,doc:doc})=>external_kbnSharedDeps_React_default.a.createElement("div",{key:item},external_kbnSharedDeps_React_default.a.createElement("div",{className:"error-message"},item,": ",reason),external_kbnSharedDeps_React_default.a.createElement("div",null,JSON.stringify(doc))))));function import_summary_createDisplayItems(index,indexPattern,ingestPipelineId,docCount,importFailures,createIndexPattern,createPipeline){const items=[{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importSummary.indexTitle",defaultMessage:"Index"}),description:index},{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importSummary.documentsIngestedTitle",defaultMessage:"Documents ingested"}),description:docCount-(importFailures&&importFailures.length||0)}];if(createPipeline){items.splice(1,0,{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importSummary.ingestPipelineTitle",defaultMessage:"Ingest pipeline"}),description:ingestPipelineId})}if(createIndexPattern){items.splice(1,0,{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importSummary.indexPatternTitle",defaultMessage:"Index pattern"}),description:indexPattern})}if(importFailures&&importFailures.length>0){items.push({title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importSummary.failedDocumentsTitle",defaultMessage:"Failed documents"}),description:importFailures.length})}return items}var v4=__webpack_require__(457);var v4_default=__webpack_require__.n(v4);const COMMON_LAT_NAMES=["latitude","lat"];const COMMON_LON_NAMES=["longitude","long","lon"];function getDefaultCombinedFields(results){const combinedFields=[];const geoPointField=getGeoPointField(results);if(geoPointField){combinedFields.push(geoPointField)}return combinedFields}function addCombinedFieldsToMappings(mappings,combinedFields){const updatedMappings={...mappings};combinedFields.forEach(combinedField=>{updatedMappings.properties[combinedField.combinedFieldName]={type:combinedField.mappingType}});return updatedMappings}function removeCombinedFieldsFromMappings(mappings,combinedFields){const updatedMappings={...mappings};combinedFields.forEach(combinedField=>{delete updatedMappings.properties[combinedField.combinedFieldName]});return updatedMappings}function addCombinedFieldsToPipeline(pipeline,combinedFields){const updatedPipeline=Object(external_kbnSharedDeps_Lodash_["cloneDeep"])(pipeline);combinedFields.forEach(combinedField=>{updatedPipeline.processors.push({set:{field:combinedField.combinedFieldName,value:combinedField.fieldNames.map(fieldName=>`{{${fieldName}}}`).join(combinedField.delimiter)}})});return updatedPipeline}function removeCombinedFieldsFromPipeline(pipeline,combinedFields){return{...pipeline,processors:pipeline.processors.filter(processor=>"set"in processor?!combinedFields.some(combinedField=>processor.set.field===combinedField.combinedFieldName):true)}}function isWithinLatRange(fieldName,fieldStats){return fieldName in fieldStats&&"max_value"in fieldStats[fieldName]&&fieldStats[fieldName].max_value<=90&&"min_value"in fieldStats[fieldName]&&fieldStats[fieldName].min_value>=-90}function isWithinLonRange(fieldName,fieldStats){return fieldName in fieldStats&&"max_value"in fieldStats[fieldName]&&fieldStats[fieldName].max_value<=180&&"min_value"in fieldStats[fieldName]&&fieldStats[fieldName].min_value>=-180}function createGeoPointCombinedField(latField,lonField,geoPointField){return{mappingType:"geo_point",delimiter:",",combinedFieldName:geoPointField,fieldNames:[latField,lonField]}}function getNameCollisionMsg(name){return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.nameCollisionMsg",{defaultMessage:'"{name}" already exists, please provide a unique name',values:{name:name}})}function utils_getFieldNames(results){return results.column_names!==undefined?results.column_names:Object.keys(results.field_stats)}function getGeoPointField(results){const fieldNames=utils_getFieldNames(results);const latField=fieldNames.find(columnName=>COMMON_LAT_NAMES.includes(columnName.toLowerCase())&&isWithinLatRange(columnName,results.field_stats));const lonField=fieldNames.find(columnName=>COMMON_LON_NAMES.includes(columnName.toLowerCase())&&isWithinLonRange(columnName,results.field_stats));if(!latField||!lonField){return null}const combinedFieldNames=["location","point_location",`${latField}_${lonField}`,`location_${v4_default()()}`];const geoPointField=combinedFieldNames.find(name=>!fieldNames.includes(name));return geoPointField?createGeoPointCombinedField(latField,lonField,geoPointField):null}function CombinedFieldLabel({combinedField:combinedField}){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s"},getCombinedFieldLabel(combinedField))}function getCombinedFieldLabel(combinedField){return`${combinedField.fieldNames.join(combinedField.delimiter)} => ${combinedField.combinedFieldName} (${combinedField.mappingType})`}function CombinedFieldsReadOnlyForm({combinedFields:combinedFields}){return combinedFields.length?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.combinedFieldsReadOnlyLabel",{defaultMessage:"Combined fields"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.combinedFieldsReadOnlyHelpTextLabel",{defaultMessage:"Edit combined fields in advanced tab"})},external_kbnSharedDeps_React_default.a.createElement("div",null,combinedFields.map((combinedField,idx)=>external_kbnSharedDeps_React_default.a.createElement(CombinedFieldLabel,{key:idx,combinedField:combinedField})))):null}function geo_point_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class geo_point_GeoPointForm extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);geo_point_defineProperty(this,"onLatFieldChange",e=>{this.setState({latField:e.target.value})});geo_point_defineProperty(this,"onLonFieldChange",e=>{this.setState({lonField:e.target.value})});geo_point_defineProperty(this,"onGeoPointFieldChange",e=>{const geoPointField=e.target.value;this.setState({geoPointField:geoPointField});this.hasNameCollision(geoPointField)});geo_point_defineProperty(this,"hasNameCollision",Object(external_kbnSharedDeps_Lodash_["debounce"])(name=>{try{const geoPointFieldError=this.props.hasNameCollision(name)?getNameCollisionMsg(name):"";this.setState({geoPointFieldError:geoPointFieldError})}catch(error){this.setState({submitError:error.message})}},200));geo_point_defineProperty(this,"onSubmit",()=>{try{this.props.addCombinedField(createGeoPointCombinedField(this.state.latField,this.state.lonField,this.state.geoPointField));this.setState({submitError:""})}catch(error){this.setState({submitError:error.message})}});const latFields=[{value:"",text:""}];const lonFields=[{value:"",text:""}];utils_getFieldNames(props.results).forEach(columnName=>{if(isWithinLatRange(columnName,props.results.field_stats)){latFields.push({value:columnName,text:columnName})}if(isWithinLonRange(columnName,props.results.field_stats)){lonFields.push({value:columnName,text:columnName})}});this.state={latField:"",lonField:"",geoPointField:"",geoPointFieldError:"",submitError:"",latFields:latFields,lonFields:lonFields}}render(){let error;if(this.state.submitError){error=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormErrorText"],null,this.state.submitError)}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.geoPointForm.latFieldLabel",{defaultMessage:"Latitude field"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{options:this.state.latFields,value:this.state.latField,onChange:this.onLatFieldChange})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.geoPointForm.lonFieldLabel",{defaultMessage:"Longitude field"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{options:this.state.lonFields,value:this.state.lonField,onChange:this.onLonFieldChange})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.geoPointForm.geoPointFieldLabel",{defaultMessage:"Geo point field"}),isInvalid:this.state.geoPointFieldError!=="",error:[this.state.geoPointFieldError]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{value:this.state.geoPointField,onChange:this.onGeoPointFieldChange,isInvalid:this.state.geoPointFieldError!=="","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.geoPointForm.geoPointFieldAriaLabel",{defaultMessage:"Geo point field, required field"})})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),error,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTextAlign"],{textAlign:"right"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{size:"s",fill:true,disabled:!this.state.latField||!this.state.lonField||!this.state.geoPointField||this.state.geoPointFieldError!=="",onClick:this.onSubmit},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.geoPointForm.submitButtonLabel",defaultMessage:"Add"}))))}}function combined_fields_form_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class combined_fields_form_CombinedFieldsForm extends external_kbnSharedDeps_React_["Component"]{constructor(...args){super(...args);combined_fields_form_defineProperty(this,"state",{isPopoverOpen:false});combined_fields_form_defineProperty(this,"togglePopover",()=>{this.setState(prevState=>({isPopoverOpen:!prevState.isPopoverOpen}))});combined_fields_form_defineProperty(this,"closePopover",()=>{this.setState({isPopoverOpen:false})});combined_fields_form_defineProperty(this,"addCombinedField",combinedField=>{if(this.hasNameCollision(combinedField.combinedFieldName)){throw new Error(getNameCollisionMsg(combinedField.combinedFieldName))}const mappings=this.parseMappings();const pipeline=this.parsePipeline();this.props.onMappingsStringChange(JSON.stringify(addCombinedFieldsToMappings(mappings,[combinedField]),null,2));this.props.onPipelineStringChange(JSON.stringify(addCombinedFieldsToPipeline(pipeline,[combinedField]),null,2));this.props.onCombinedFieldsChange([...this.props.combinedFields,combinedField]);this.closePopover()});combined_fields_form_defineProperty(this,"removeCombinedField",index=>{let mappings;let pipeline;try{mappings=this.parseMappings();pipeline=this.parsePipeline()}catch(error){return}const updatedCombinedFields=[...this.props.combinedFields];const removedCombinedFields=updatedCombinedFields.splice(index,1);this.props.onMappingsStringChange(JSON.stringify(removeCombinedFieldsFromMappings(mappings,removedCombinedFields),null,2));this.props.onPipelineStringChange(JSON.stringify(removeCombinedFieldsFromPipeline(pipeline,removedCombinedFields),null,2));this.props.onCombinedFieldsChange(updatedCombinedFields)});combined_fields_form_defineProperty(this,"hasNameCollision",name=>{var _this$props$results$c;if((_this$props$results$c=this.props.results.column_names)!==null&&_this$props$results$c!==void 0&&_this$props$results$c.includes(name)){return true}if(this.props.combinedFields.some(combinedField=>combinedField.combinedFieldName===name)){return true}const mappings=this.parseMappings();return mappings.properties.hasOwnProperty(name)})}parseMappings(){try{return JSON.parse(this.props.mappingsString)}catch(error){throw new Error(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.combinedFieldsForm.mappingsParseError",{defaultMessage:"Error parsing mappings: {error}",values:{error:error.message}}))}}parsePipeline(){try{return JSON.parse(this.props.pipelineString)}catch(error){throw new Error(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.combinedFieldsForm.pipelineParseError",{defaultMessage:"Error parsing pipeline: {error}",values:{error:error.message}}))}}render(){const geoPointLabel=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.geoPointCombinedFieldLabel",{defaultMessage:"Add geo point field"});const panels=[{id:0,items:[{name:geoPointLabel,panel:1}]},{id:1,title:geoPointLabel,content:external_kbnSharedDeps_React_default.a.createElement(geo_point_GeoPointForm,{addCombinedField:this.addCombinedField,hasNameCollision:this.hasNameCollision,results:this.props.results})}];return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.combinedFieldsLabel",{defaultMessage:"Combined fields"})},external_kbnSharedDeps_React_default.a.createElement("div",null,this.props.combinedFields.map((combinedField,idx)=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{key:idx,gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(CombinedFieldLabel,{combinedField:combinedField})),!this.props.isDisabled&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{iconType:"trash",color:"danger",onClick:this.removeCombinedField.bind(null,idx),title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.removeCombinedFieldsLabel",{defaultMessage:"Remove combined field"}),"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.removeCombinedFieldsLabel",{defaultMessage:"Remove combined field"})})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopover"],{id:"combineFieldsPopover",button:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:this.togglePopover,size:"xs",iconType:"plusInCircleFilled",isDisabled:this.props.isDisabled},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.addCombinedFieldsLabel",defaultMessage:"Add combined field"})),isOpen:this.state.isPopoverOpen,closePopover:this.closePopover,anchorPosition:"rightCenter"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiContextMenu"],{initialPanelId:0,panels:panels}))))}}var types=__webpack_require__(301);const SimpleSettings=({index:index,initialized:initialized,onIndexChange:onIndexChange,createIndexPattern:createIndexPattern,onCreateIndexPatternChange:onCreateIndexPatternChange,indexNameError:indexNameError,combinedFields:combinedFields})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.simpleImportSettings.indexNameFormRowLabel",defaultMessage:"Index name"}),isInvalid:indexNameError!=="",error:[indexNameError]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{placeholder:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.simpleImportSettings.indexNamePlaceholder",{defaultMessage:"index name"}),value:index,disabled:initialized===true,onChange:onIndexChange,isInvalid:indexNameError!=="","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.simpleImportSettings.indexNameAriaLabel",{defaultMessage:"Index name, required field"}),"data-test-subj":"mlFileDataVisIndexNameInput"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCheckbox"],{id:"createIndexPattern",label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.simpleImportSettings.createIndexPatternLabel",defaultMessage:"Create index pattern"}),checked:createIndexPattern===true,disabled:initialized===true,onChange:onCreateIndexPatternChange,"data-test-subj":"mlFileDataVisCreateIndexPatternCheckbox"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(CombinedFieldsReadOnlyForm,{combinedFields:combinedFields}));const advanced_EDITOR_HEIGHT="300px";const advanced_AdvancedSettings=({index:index,indexPattern:indexPattern,initialized:initialized,onIndexChange:onIndexChange,createIndexPattern:createIndexPattern,onCreateIndexPatternChange:onCreateIndexPatternChange,onIndexPatternChange:onIndexPatternChange,indexSettingsString:indexSettingsString,mappingsString:mappingsString,pipelineString:pipelineString,onIndexSettingsStringChange:onIndexSettingsStringChange,onMappingsStringChange:onMappingsStringChange,onPipelineStringChange:onPipelineStringChange,indexNameError:indexNameError,indexPatternNameError:indexPatternNameError,combinedFields:combinedFields,onCombinedFieldsChange:onCombinedFieldsChange,results:results})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.advancedImportSettings.indexNameLabel",defaultMessage:"Index name"}),isInvalid:indexNameError!=="",error:[indexNameError]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{placeholder:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.advancedImportSettings.indexNamePlaceholder",{defaultMessage:"index name"}),value:index,disabled:initialized===true,onChange:onIndexChange,isInvalid:indexNameError!=="","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.advancedImportSettings.indexNameAriaLabel",{defaultMessage:"Index name, required field"})})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCheckbox"],{id:"createIndexPattern",label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.advancedImportSettings.createIndexPatternLabel",defaultMessage:"Create index pattern"}),checked:createIndexPattern===true,disabled:initialized===true,onChange:onCreateIndexPatternChange}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.advancedImportSettings.indexPatternNameLabel",defaultMessage:"Index pattern name"}),isInvalid:indexPatternNameError!=="",error:[indexPatternNameError]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{disabled:createIndexPattern===false||initialized===true,placeholder:createIndexPattern===true?index:"",value:indexPattern,onChange:onIndexPatternChange,isInvalid:indexPatternNameError!==""})),external_kbnSharedDeps_React_default.a.createElement(combined_fields_form_CombinedFieldsForm,{mappingsString:mappingsString,pipelineString:pipelineString,onMappingsStringChange:onMappingsStringChange,onPipelineStringChange:onPipelineStringChange,combinedFields:combinedFields,onCombinedFieldsChange:onCombinedFieldsChange,results:results,isDisabled:initialized===true}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(IndexSettings,{initialized:initialized,data:indexSettingsString,onChange:onIndexSettingsStringChange})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(Mappings,{initialized:initialized,data:mappingsString,onChange:onMappingsStringChange})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(IngestPipeline,{initialized:initialized,data:pipelineString,onChange:onPipelineStringChange}))));const IndexSettings=({initialized:initialized,data:data,onChange:onChange})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.advancedImportSettings.indexSettingsLabel",defaultMessage:"Index settings"}),fullWidth:true},external_kbnSharedDeps_React_default.a.createElement(ml_job_editor["a"],{mode:ml_job_editor["b"].JSON,readOnly:initialized===true,value:data,height:advanced_EDITOR_HEIGHT,syntaxChecking:false,onChange:onChange})));const Mappings=({initialized:initialized,data:data,onChange:onChange})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.advancedImportSettings.mappingsLabel",defaultMessage:"Mappings"}),fullWidth:true},external_kbnSharedDeps_React_default.a.createElement(ml_job_editor["a"],{mode:ml_job_editor["b"].JSON,readOnly:initialized===true,value:data,height:advanced_EDITOR_HEIGHT,syntaxChecking:false,onChange:onChange})));const IngestPipeline=({initialized:initialized,data:data,onChange:onChange})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.advancedImportSettings.ingestPipelineLabel",defaultMessage:"Ingest pipeline"}),fullWidth:true},external_kbnSharedDeps_React_default.a.createElement(ml_job_editor["a"],{mode:ml_job_editor["b"].JSON,readOnly:initialized===true,value:data,height:advanced_EDITOR_HEIGHT,syntaxChecking:false,onChange:onChange})));const ImportSettings=({index:index,indexPattern:indexPattern,initialized:initialized,onIndexChange:onIndexChange,createIndexPattern:createIndexPattern,onCreateIndexPatternChange:onCreateIndexPatternChange,onIndexPatternChange:onIndexPatternChange,indexSettingsString:indexSettingsString,mappingsString:mappingsString,pipelineString:pipelineString,onIndexSettingsStringChange:onIndexSettingsStringChange,onMappingsStringChange:onMappingsStringChange,onPipelineStringChange:onPipelineStringChange,indexNameError:indexNameError,indexPatternNameError:indexPatternNameError,combinedFields:combinedFields,onCombinedFieldsChange:onCombinedFieldsChange,results:results})=>{const tabs=[{id:"simple-settings",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.importSettings.simpleTabName",{defaultMessage:"Simple"}),content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(SimpleSettings,{index:index,initialized:initialized,onIndexChange:onIndexChange,createIndexPattern:createIndexPattern,onCreateIndexPatternChange:onCreateIndexPatternChange,indexNameError:indexNameError,combinedFields:combinedFields}))},{id:"advanced-settings",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.importSettings.advancedTabName",{defaultMessage:"Advanced"}),content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(advanced_AdvancedSettings,{index:index,indexPattern:indexPattern,initialized:initialized,onIndexChange:onIndexChange,createIndexPattern:createIndexPattern,onCreateIndexPatternChange:onCreateIndexPatternChange,onIndexPatternChange:onIndexPatternChange,indexSettingsString:indexSettingsString,mappingsString:mappingsString,pipelineString:pipelineString,onIndexSettingsStringChange:onIndexSettingsStringChange,onMappingsStringChange:onMappingsStringChange,onPipelineStringChange:onPipelineStringChange,indexNameError:indexNameError,indexPatternNameError:indexPatternNameError,combinedFields:combinedFields,onCombinedFieldsChange:onCombinedFieldsChange,results:results}))}];return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTabbedContent"],{tabs:tabs,initialSelectedTab:tabs[0],onTabClick:()=>{}}))};function import_view_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const DEFAULT_TIME_FIELD="@timestamp";const DEFAULT_INDEX_SETTINGS={number_of_shards:1};const CONFIG_MODE={SIMPLE:0,ADVANCED:1};const DEFAULT_STATE={index:"",importing:false,imported:false,initialized:false,reading:false,readProgress:0,readStatus:IMPORT_STATUS.INCOMPLETE,parseJSONStatus:IMPORT_STATUS.INCOMPLETE,indexCreatedStatus:IMPORT_STATUS.INCOMPLETE,indexPatternCreatedStatus:IMPORT_STATUS.INCOMPLETE,ingestPipelineCreatedStatus:IMPORT_STATUS.INCOMPLETE,permissionCheckStatus:IMPORT_STATUS.INCOMPLETE,uploadProgress:0,uploadStatus:IMPORT_STATUS.INCOMPLETE,createIndexPattern:true,indexPattern:"",indexPatternId:"",ingestPipelineId:"",errors:[],importFailures:[],docCount:0,configMode:CONFIG_MODE.SIMPLE,indexSettingsString:"",mappingsString:"",pipelineString:"",indexNames:[],indexPatternNames:[],indexNameError:"",indexPatternNameError:"",timeFieldName:undefined,isFilebeatFlyoutVisible:false,checkingValidIndex:false,combinedFields:[]};class import_view_ImportView extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);import_view_defineProperty(this,"clickReset",()=>{const state=import_view_getDefaultState(this.state,this.props.results);this.setState(state,()=>{this.loadIndexPatternNames()})});import_view_defineProperty(this,"clickImport",()=>{this.import()});import_view_defineProperty(this,"onConfigModeChange",configMode=>{this.setState({configMode:configMode})});import_view_defineProperty(this,"onIndexChange",e=>{const index=e.target.value;this.setState({index:index,checkingValidIndex:true});this.debounceIndexCheck(index)});import_view_defineProperty(this,"debounceIndexCheck",Object(external_kbnSharedDeps_Lodash_["debounce"])(async index=>{if(index===""){this.setState({checkingValidIndex:false});return}const{exists:exists}=await ml_api_service["ml"].checkIndexExists({index:index});const indexNameError=exists?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importView.indexNameAlreadyExistsErrorMessage",defaultMessage:"Index name already exists"}):isIndexNameValid(index);this.setState({checkingValidIndex:false,indexNameError:indexNameError})},500));import_view_defineProperty(this,"onIndexPatternChange",e=>{const name=e.target.value;const{indexPatternNames:indexPatternNames,index:index}=this.state;this.setState({indexPattern:name,indexPatternNameError:isIndexPatternNameValid(name,indexPatternNames,index)})});import_view_defineProperty(this,"onCreateIndexPatternChange",e=>{this.setState({createIndexPattern:e.target.checked})});import_view_defineProperty(this,"onIndexSettingsStringChange",text=>{this.setState({indexSettingsString:text})});import_view_defineProperty(this,"onMappingsStringChange",text=>{this.setState({mappingsString:text})});import_view_defineProperty(this,"onPipelineStringChange",text=>{this.setState({pipelineString:text})});import_view_defineProperty(this,"onCombinedFieldsChange",combinedFields=>{this.setState({combinedFields:combinedFields})});import_view_defineProperty(this,"setImportProgress",progress=>{this.setState({uploadProgress:progress})});import_view_defineProperty(this,"setReadProgress",progress=>{this.setState({readProgress:progress})});import_view_defineProperty(this,"showFilebeatFlyout",()=>{this.setState({isFilebeatFlyoutVisible:true});this.props.hideBottomBar()});import_view_defineProperty(this,"closeFilebeatFlyout",()=>{this.setState({isFilebeatFlyoutVisible:false});this.props.showBottomBar()});this.state=import_view_getDefaultState(DEFAULT_STATE,this.props.results)}componentDidMount(){this.loadIndexPatternNames()}async import(){const{data:data,results:results,indexPatterns:indexPatterns,kibanaConfig:kibanaConfig,showBottomBar:showBottomBar}=this.props;const{format:format}=results;let{timeFieldName:timeFieldName}=this.state;const{index:index,indexPattern:indexPattern,createIndexPattern:createIndexPattern,indexSettingsString:indexSettingsString,mappingsString:mappingsString,pipelineString:pipelineString}=this.state;const errors=[];if(index!==""){this.setState({importing:true,errors:errors},async()=>{if(await hasImportPermission(index)===false){errors.push(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.importView.importPermissionError",{defaultMessage:"You do not have permission to create or import data into index {index}.",values:{index:index}}));this.setState({permissionCheckStatus:IMPORT_STATUS.FAILED,importing:false,imported:false,errors:errors});return}this.setState({importing:true,imported:false,reading:true,initialized:true,permissionCheckStatus:IMPORT_STATUS.COMPLETE},()=>{this.props.hideBottomBar();setTimeout(async()=>{let success=true;const createPipeline=pipelineString!=="";let settings={};let mappings={};let pipeline={};try{settings=JSON.parse(indexSettingsString)}catch(error){success=false;const parseError=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.importView.parseSettingsError",{defaultMessage:"Error parsing settings:"});errors.push(`${parseError} ${error.message}`)}try{mappings=JSON.parse(mappingsString)}catch(error){success=false;const parseError=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.importView.parseMappingsError",{defaultMessage:"Error parsing mappings:"});errors.push(`${parseError} ${error.message}`)}const indexCreationSettings={settings:settings,mappings:mappings};try{if(createPipeline){pipeline=JSON.parse(pipelineString);indexCreationSettings.pipeline=pipeline}}catch(error){success=false;const parseError=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.fileDatavisualizer.importView.parsePipelineError",{defaultMessage:"Error parsing ingest pipeline:"});errors.push(`${parseError} ${error.message}`)}this.setState({parseJSONStatus:success?IMPORT_STATUS.COMPLETE:IMPORT_STATUS.FAILED});if(mappings.properties[DEFAULT_TIME_FIELD]!==undefined){timeFieldName=DEFAULT_TIME_FIELD;this.setState({timeFieldName:timeFieldName})}if(success){const importer=importerFactory(format,results,indexCreationSettings);if(importer!==undefined){const readResp=importer.read(data,this.setReadProgress);success=readResp.success;this.setState({readStatus:success?IMPORT_STATUS.COMPLETE:IMPORT_STATUS.FAILED,reading:false});if(readResp.success===false){console.error(readResp.error);errors.push(readResp.error)}if(success){const initializeImportResp=await importer.initializeImport(index);const indexCreated=initializeImportResp.index!==undefined;this.setState({indexCreatedStatus:indexCreated?IMPORT_STATUS.COMPLETE:IMPORT_STATUS.FAILED});if(createPipeline){const pipelineCreated=initializeImportResp.pipelineId!==undefined;if(indexCreated){this.setState({ingestPipelineCreatedStatus:pipelineCreated?IMPORT_STATUS.COMPLETE:IMPORT_STATUS.FAILED,ingestPipelineId:pipelineCreated?initializeImportResp.pipelineId:""})}success=indexCreated&&pipelineCreated}else{success=indexCreated}if(success){const importId=initializeImportResp.id;const pipelineId=initializeImportResp.pipelineId;const importResp=await importer.import(importId,index,pipelineId,this.setImportProgress);success=importResp.success;this.setState({uploadStatus:importResp.success?IMPORT_STATUS.COMPLETE:IMPORT_STATUS.FAILED,importFailures:importResp.failures,docCount:importResp.docCount});if(success){if(createIndexPattern){const indexPatternName=indexPattern===""?index:indexPattern;const indexPatternResp=await createKibanaIndexPattern(indexPatternName,indexPatterns,timeFieldName,kibanaConfig);success=indexPatternResp.success;this.setState({indexPatternCreatedStatus:indexPatternResp.success?IMPORT_STATUS.COMPLETE:IMPORT_STATUS.FAILED,indexPatternId:indexPatternResp.id});if(indexPatternResp.success===false){errors.push(indexPatternResp.error)}}}else{errors.push(importResp.error)}}else{errors.push(initializeImportResp.error)}}}}showBottomBar();this.setState({importing:false,imported:success,errors:errors})},500)})})}}async loadIndexPatternNames(){await Object(index_utils["g"])(this.props.indexPatterns);const indexPatternNames=Object(index_utils["d"])();this.setState({indexPatternNames:indexPatternNames})}render(){var _this$props$results;const{index:index,indexPattern:indexPattern,indexPatternId:indexPatternId,ingestPipelineId:ingestPipelineId,importing:importing,imported:imported,reading:reading,initialized:initialized,readStatus:readStatus,parseJSONStatus:parseJSONStatus,indexCreatedStatus:indexCreatedStatus,ingestPipelineCreatedStatus:ingestPipelineCreatedStatus,indexPatternCreatedStatus:indexPatternCreatedStatus,permissionCheckStatus:permissionCheckStatus,uploadProgress:uploadProgress,uploadStatus:uploadStatus,createIndexPattern:createIndexPattern,errors:errors,docCount:docCount,importFailures:importFailures,indexSettingsString:indexSettingsString,mappingsString:mappingsString,pipelineString:pipelineString,indexNameError:indexNameError,indexPatternNameError:indexPatternNameError,timeFieldName:timeFieldName,isFilebeatFlyoutVisible:isFilebeatFlyoutVisible,checkingValidIndex:checkingValidIndex,combinedFields:combinedFields}=this.state;const createPipeline=pipelineString!=="";const statuses={reading:reading,readStatus:readStatus,parseJSONStatus:parseJSONStatus,indexCreatedStatus:indexCreatedStatus,ingestPipelineCreatedStatus:ingestPipelineCreatedStatus,indexPatternCreatedStatus:indexPatternCreatedStatus,permissionCheckStatus:permissionCheckStatus,uploadProgress:uploadProgress,uploadStatus:uploadStatus,createIndexPattern:createIndexPattern,createPipeline:createPipeline};const disableImport=index===""||indexNameError!==""||createIndexPattern===true&&indexPatternNameError!==""||initialized===true||checkingValidIndex===true;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPage"],{"data-test-subj":"mlPageFileDataVisImport"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageContentHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],null,external_kbnSharedDeps_React_default.a.createElement("h1",null,this.props.fileName))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],{"data-test-subj":"mlFileDataVisImportSettingsPanel"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importView.importDataTitle",defaultMessage:"Import data"})," ",external_kbnSharedDeps_React_default.a.createElement(ExperimentalBadge,{tooltipContent:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importView.experimentalFeatureTooltip",defaultMessage:"Experimental feature. We'd love to hear your feedback."})}))),external_kbnSharedDeps_React_default.a.createElement(ImportSettings,{index:index,indexPattern:indexPattern,initialized:initialized,onIndexChange:this.onIndexChange,createIndexPattern:createIndexPattern,onCreateIndexPatternChange:this.onCreateIndexPatternChange,onIndexPatternChange:this.onIndexPatternChange,indexSettingsString:indexSettingsString,mappingsString:mappingsString,pipelineString:pipelineString,onIndexSettingsStringChange:this.onIndexSettingsStringChange,onMappingsStringChange:this.onMappingsStringChange,onPipelineStringChange:this.onPipelineStringChange,indexNameError:indexNameError,indexPatternNameError:indexPatternNameError,combinedFields:combinedFields,onCombinedFieldsChange:this.onCombinedFieldsChange,results:this.props.results}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),(initialized===false||importing===true)&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{isDisabled:disableImport,onClick:this.clickImport,isLoading:importing,iconSide:"right",fill:true,"data-test-subj":"mlFileDataVisImportButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importView.importButtonLabel",defaultMessage:"Import"})),initialized===true&&importing===false&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:this.clickReset},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importView.resetButtonLabel",defaultMessage:"Reset"}))),initialized===true&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],null,external_kbnSharedDeps_React_default.a.createElement(ImportProgress,{statuses:statuses}),imported===true&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(ImportSummary,{index:index,indexPattern:indexPattern===""?index:indexPattern,ingestPipelineId:ingestPipelineId,docCount:docCount,importFailures:importFailures,createIndexPattern:createIndexPattern,createPipeline:createPipeline}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}),external_kbnSharedDeps_React_default.a.createElement(ResultsLinks,{fieldStats:(_this$props$results=this.props.results)===null||_this$props$results===void 0?void 0:_this$props$results.field_stats,index:index,indexPatternId:indexPatternId,timeFieldName:timeFieldName,createIndexPattern:createIndexPattern,showFilebeatFlyout:this.showFilebeatFlyout}),isFilebeatFlyoutVisible&&external_kbnSharedDeps_React_default.a.createElement(FilebeatConfigFlyout,{index:index,results:this.props.results,indexPatternId:indexPatternId,ingestPipelineId:ingestPipelineId,closeFlyout:this.closeFilebeatFlyout})))),errors.length>0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(ImportErrors,{errors:errors,statuses:statuses}))))}}async function createKibanaIndexPattern(indexPatternName,indexPatterns,timeFieldName){try{const emptyPattern=await indexPatterns.createAndSave({title:indexPatternName,timeFieldName:timeFieldName});return{success:true,id:emptyPattern.id}}catch(error){return{success:false,error:error}}}function import_view_getDefaultState(state,results){const indexSettingsString=state.indexSettingsString===""?JSON.stringify(DEFAULT_INDEX_SETTINGS,null,2):state.indexSettingsString;const combinedFields=state.combinedFields.length?state.combinedFields:getDefaultCombinedFields(results);const mappingsString=state.mappingsString===""?JSON.stringify(addCombinedFieldsToMappings(results.mappings,combinedFields),null,2):state.mappingsString;const pipelineString=state.pipelineString===""&&results.ingest_pipeline!==undefined?JSON.stringify(addCombinedFieldsToPipeline(results.ingest_pipeline,combinedFields),null,2):state.pipelineString;const timeFieldName=results.timestamp_field;return{...DEFAULT_STATE,indexSettingsString:indexSettingsString,mappingsString:mappingsString,pipelineString:pipelineString,timeFieldName:timeFieldName,combinedFields:combinedFields}}function isIndexNameValid(name){const reg=new RegExp('[\\\\/*?"<>|\\s,#]+');if(name!==name.toLowerCase()||name==="."||name===".."||name.match(/^[-_+]/)!==null||name.match(reg)!==null){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importView.indexNameContainsIllegalCharactersErrorMessage",defaultMessage:"Index name contains illegal characters"})}return""}function isIndexPatternNameValid(name,indexPatternNames,index){if(name===""){return""}if(indexPatternNames.find(i=>i===name)){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importView.indexPatternNameAlreadyExistsErrorMessage",defaultMessage:"Index pattern name already exists"})}let newName=name.replace(/\./g,"\\.");newName=newName.replace(/\+/g,"\\+");newName=newName.replace(/\*/g,".*");const reg=new RegExp(`^${newName}$`);if(index.match(reg)===null){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.importView.indexPatternDoesNotMatchIndexNameErrorMessage",defaultMessage:"Index pattern does not match index name"})}return""}function file_datavisualizer_view_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class file_datavisualizer_view_FileDataVisualizerView extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);file_datavisualizer_view_defineProperty(this,"onFilePickerChange",files=>{this.overrides={};this.setState({loading:files.length>0,bottomBarVisible:files.length>0,loaded:false,fileName:"",fileContents:"",data:[],fileSize:0,fileTooLarge:false,fileCouldNotBeRead:false,serverError:null,results:undefined,explanation:undefined},()=>{if(files.length){this.loadFile(files[0])}})});file_datavisualizer_view_defineProperty(this,"closeEditFlyout",()=>{this.setState({isEditFlyoutVisible:false});this.showBottomBar()});file_datavisualizer_view_defineProperty(this,"showEditFlyout",()=>{this.setState({isEditFlyoutVisible:true});this.hideBottomBar()});file_datavisualizer_view_defineProperty(this,"closeExplanationFlyout",()=>{this.setState({isExplanationFlyoutVisible:false});this.showBottomBar()});file_datavisualizer_view_defineProperty(this,"showExplanationFlyout",()=>{this.setState({isExplanationFlyoutVisible:true});this.hideBottomBar()});file_datavisualizer_view_defineProperty(this,"showBottomBar",()=>{this.setState({bottomBarVisible:true})});file_datavisualizer_view_defineProperty(this,"hideBottomBar",()=>{this.setState({bottomBarVisible:false})});file_datavisualizer_view_defineProperty(this,"setOverrides",overrides=>{this.setState({loading:true,loaded:false},()=>{const formattedOverrides=createUrlOverrides(overrides,this.originalSettings);this.analyzeFile(this.state.fileContents,formattedOverrides)})});file_datavisualizer_view_defineProperty(this,"changeMode",mode=>{this.setState({mode:mode})});file_datavisualizer_view_defineProperty(this,"onCancel",()=>{this.overrides={};this.previousOverrides={};this.originalSettings={linesToSample:DEFAULT_LINES_TO_SAMPLE};this.changeMode(constants_MODE.READ);this.onFilePickerChange([])});this.state={files:{},fileName:"",fileContents:"",data:[],fileSize:0,fileTooLarge:false,fileCouldNotBeRead:false,serverError:null,loading:false,loaded:false,results:undefined,explanation:undefined,mode:constants_MODE.READ,isEditFlyoutVisible:false,isExplanationFlyoutVisible:false,bottomBarVisible:false,hasPermissionToImport:false};this.overrides={};this.previousOverrides={};this.originalSettings={linesToSample:DEFAULT_LINES_TO_SAMPLE};this.maxFileUploadBytes=getMaxBytes()}async componentDidMount(){const hasPermissionToImport=await hasImportPermission();this.setState({hasPermissionToImport:hasPermissionToImport})}async loadFile(file){if(file.size<=this.maxFileUploadBytes){try{const{data:data,fileContents:fileContents}=await readFile(file);this.setState({data:data,fileContents:fileContents,fileName:file.name,fileSize:file.size});await this.analyzeFile(fileContents)}catch(error){this.setState({loaded:false,loading:false,fileCouldNotBeRead:true})}}else{this.setState({loaded:false,loading:false,fileTooLarge:true,fileName:file.name,fileSize:file.size})}}async analyzeFile(fileContents,overrides,isRetry=false){try{const resp=await ml_api_service["ml"].fileDatavisualizer.analyzeFile(fileContents,overrides);const serverSettings=processResults(resp);const serverOverrides=resp.overrides;this.previousOverrides=overrides;this.overrides={};if(serverSettings.format==="xml"){throw{message:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.fileDatavisualizer.fileDatavisualizerView.xmlNotCurrentlySupportedErrorMessage",defaultMessage:"XML not currently supported"})}}if(serverOverrides===undefined){this.originalSettings=serverSettings}else{Object.keys(serverOverrides).forEach(o=>{const camelCaseO=o.replace(/_\w/g,m=>m[1].toUpperCase());this.overrides[camelCaseO]=serverOverrides[o]});Object.keys(serverSettings).forEach(o=>{const value=serverSettings[o];if(this.overrides[o]===undefined&&(Array.isArray(value)&&Object(external_kbnSharedDeps_Lodash_["isEqual"])(value,this.originalSettings[o])===false||value!==this.originalSettings[o])){this.originalSettings[o]=value}})}this.setState({results:resp.results,explanation:resp.explanation,loaded:true,loading:false,fileCouldNotBeRead:isRetry})}catch(error){this.setState({results:undefined,explanation:undefined,loaded:false,loading:false,fileCouldNotBeRead:true,serverError:error});if(isRetry===false){this.setState({loading:true,loaded:false});this.analyzeFile(fileContents,this.previousOverrides,true)}}}render(){const{loading:loading,loaded:loaded,results:results,explanation:explanation,fileContents:fileContents,data:data,fileName:fileName,fileSize:fileSize,fileTooLarge:fileTooLarge,fileCouldNotBeRead:fileCouldNotBeRead,serverError:serverError,mode:mode,isEditFlyoutVisible:isEditFlyoutVisible,isExplanationFlyoutVisible:isExplanationFlyoutVisible,bottomBarVisible:bottomBarVisible,hasPermissionToImport:hasPermissionToImport}=this.state;const fields=results!==undefined&&results.field_stats!==undefined?Object.keys(results.field_stats):[];return external_kbnSharedDeps_React_default.a.createElement("div",null,mode===constants_MODE.READ&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,!loading&&!loaded&&external_kbnSharedDeps_React_default.a.createElement(AboutPanel,{onFilePickerChange:this.onFilePickerChange}),loading&&external_kbnSharedDeps_React_default.a.createElement(LoadingPanel,null),fileTooLarge&&external_kbnSharedDeps_React_default.a.createElement(FileTooLarge,{fileSize:fileSize,maxFileSize:this.maxFileUploadBytes}),fileCouldNotBeRead&&loading===false&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(FileCouldNotBeRead,{error:serverError,loaded:loaded,showEditFlyout:this.showEditFlyout}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"})),loaded&&external_kbnSharedDeps_React_default.a.createElement(ResultsView,{results:results,explanation:explanation,fileName:fileName,data:fileContents,showEditFlyout:this.showEditFlyout,showExplanationFlyout:this.showExplanationFlyout,disableButtons:isEditFlyoutVisible||isExplanationFlyoutVisible}),external_kbnSharedDeps_React_default.a.createElement(edit_flyout_EditFlyout,{setOverrides:this.setOverrides,closeEditFlyout:this.closeEditFlyout,isFlyoutVisible:isEditFlyoutVisible,originalSettings:this.originalSettings,overrides:this.overrides,fields:fields}),isExplanationFlyoutVisible&&external_kbnSharedDeps_React_default.a.createElement(ExplanationFlyout,{results:results,closeFlyout:this.closeExplanationFlyout}),bottomBarVisible&&loaded&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(BottomBar,{mode:constants_MODE.READ,onChangeMode:this.changeMode,onCancel:this.onCancel,disableImport:hasPermissionToImport===false}),external_kbnSharedDeps_React_default.a.createElement(BottomPadding,null))),mode===constants_MODE.IMPORT&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(import_view_ImportView,{results:results,fileName:fileName,fileContents:fileContents,data:data,indexPatterns:this.props.indexPatterns,kibanaConfig:this.props.kibanaConfig,showBottomBar:this.showBottomBar,hideBottomBar:this.hideBottomBar}),bottomBarVisible&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(BottomBar,{mode:constants_MODE.IMPORT,onChangeMode:this.changeMode,onCancel:this.onCancel}),external_kbnSharedDeps_React_default.a.createElement(BottomPadding,null))))}}function BottomPadding(){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}))}const FileDataVisualizerPage=({kibanaConfig:kibanaConfig})=>{Object(contexts_kibana["g"])({timeRangeSelector:false,autoRefreshSelector:false});const indexPatterns=Object(index_utils["e"])();const{services:{docLinks:docLinks}}=Object(contexts_kibana["b"])();const helpLink=docLinks.links.ml.guide;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(navigation_menu["a"],{tabId:"datavisualizer"}),external_kbnSharedDeps_React_default.a.createElement(file_datavisualizer_view_FileDataVisualizerView,{indexPatterns:indexPatterns,kibanaConfig:kibanaConfig}),external_kbnSharedDeps_React_default.a.createElement(help_menu["a"],{docLink:helpLink}))};function file_based_extends(){file_based_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return file_based_extends.apply(this,arguments)}const fileBasedRouteFactory=(navigateToPath,basePath)=>({path:"/filedatavisualizer",render:(props,deps)=>external_kbnSharedDeps_React_default.a.createElement(file_based_PageWrapper,file_based_extends({},props,{deps:deps})),breadcrumbs:[getBreadcrumbWithUrlForApp("ML_BREADCRUMB",navigateToPath,basePath),getBreadcrumbWithUrlForApp("DATA_VISUALIZER_BREADCRUMB",navigateToPath,basePath),{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataVisualizer.fileBasedLabel",{defaultMessage:"File"}),href:""}]});const file_based_PageWrapper=({location:location,deps:deps})=>{const{redirectToMlAccessDeniedPage:redirectToMlAccessDeniedPage}=deps;const{context:context}=useResolver(undefined,undefined,deps.config,{checkBasicLicense:license["a"],loadIndexPatterns:()=>Object(index_utils["g"])(deps.indexPatterns),checkFindFileStructurePrivilege:()=>Object(check_capabilities["b"])(redirectToMlAccessDeniedPage)});return external_kbnSharedDeps_React_default.a.createElement(PageLoader,{context:context},external_kbnSharedDeps_React_default.a.createElement(FileDataVisualizerPage,{kibanaConfig:deps.config}))};const AnomalyDetectionSettingsContext=Object(external_kbnSharedDeps_React_["createContext"])({canGetFilters:false,canCreateFilter:false,canGetCalendars:false,canCreateCalendar:false});const AnomalyDetectionSettings=()=>{const[calendarsCount,setCalendarsCount]=Object(external_kbnSharedDeps_React_["useState"])(0);const[filterListsCount,setFilterListsCount]=Object(external_kbnSharedDeps_React_["useState"])(0);const{canGetFilters:canGetFilters,canCreateFilter:canCreateFilter,canGetCalendars:canGetCalendars,canCreateCalendar:canCreateCalendar}=Object(external_kbnSharedDeps_React_["useContext"])(AnomalyDetectionSettingsContext);const{toasts:toasts}=Object(contexts_kibana["f"])();const redirectToCalendarList=Object(use_create_url["a"])(ml_url_generator["b"].CALENDARS_MANAGE);const redirectToNewCalendarPage=Object(use_create_url["a"])(ml_url_generator["b"].CALENDARS_NEW);const redirectToFilterLists=Object(use_create_url["a"])(ml_url_generator["b"].FILTER_LISTS_MANAGE);const redirectToNewFilterListPage=Object(use_create_url["a"])(ml_url_generator["b"].FILTER_LISTS_NEW);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{loadSummaryStats()},[]);async function loadSummaryStats(){if(canGetCalendars===true){try{const calendars=await ml_api_service["ml"].calendars();setCalendarsCount(calendars.length)}catch(e){toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.settings.anomalyDetection.loadingCalendarsCountErrorMessage",{defaultMessage:"An error occurred obtaining the count of calendars"}))}}if(canGetFilters===true){try{const filterLists=await ml_api_service["ml"].filters.filtersStats();setFilterListsCount(filterLists.length)}catch(e){toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.settings.anomalyDetection.loadingFilterListCountErrorMessage",{defaultMessage:"An error occurred obtaining the count of filter lists"}))}}}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageContent"],{className:"mlSettingsPage__content",horizontalPosition:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageContentHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],null,external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.anomalyDetection.anomalyDetectionTitle",defaultMessage:"Anomaly Detection"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xl"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:5},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h3",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.anomalyDetection.calendarsTitle",defaultMessage:"Calendars"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTextColor"],{color:"subdued"},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.anomalyDetection.calendarsText",defaultMessage:"Calendars contain a list of scheduled events for which you do not want to generate anomalies, such as planned system outages or public holidays."})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center"},canGetCalendars&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:{display:"block"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.anomalyDetection.calendarsSummaryCount",defaultMessage:"You have {calendarsCountBadge} {calendarsCount, plural, one {calendar} other {calendars}}",values:{calendarsCountBadge:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBadge"],null,calendarsCount),calendarsCount:calendarsCount}}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{"data-test-subj":"mlCalendarsMngButton",flush:"left",size:"l",color:"primary",onClick:redirectToCalendarList,isDisabled:canGetCalendars===false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.anomalyDetection.manageCalendarsLink",defaultMessage:"Manage"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{"data-test-subj":"mlCalendarsCreateButton",flush:"left",size:"l",color:"primary",onClick:redirectToNewCalendarPage,isDisabled:canCreateCalendar===false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.anomalyDetection.createCalendarLink",defaultMessage:"Create"}))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:5},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h3",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.anomalyDetection.filterListsTitle",defaultMessage:"Filter Lists"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTextColor"],{color:"subdued"},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.anomalyDetection.filterListsText",defaultMessage:"Filter lists contain values that you can use to include or exclude events from the machine learning analysis."})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center"},canGetFilters&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.anomalyDetection.filterListsSummaryCount",defaultMessage:"You have {filterListsCountBadge} {filterListsCount, plural, one {filter list} other {filter lists}}",values:{filterListsCountBadge:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBadge"],null,filterListsCount),filterListsCount:filterListsCount}}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{"data-test-subj":"mlFilterListsMngButton",flush:"left",size:"l",color:"primary",onClick:redirectToFilterLists,isDisabled:canGetFilters===false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.anomalyDetection.manageFilterListsLink",defaultMessage:"Manage"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{"data-test-subj":"mlFilterListsCreateButton",size:"l",color:"primary",onClick:redirectToNewFilterListPage,isDisabled:canCreateFilter===false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.anomalyDetection.createFilterListsLink",defaultMessage:"Create"}))))))))};const Settings=()=>{const{services:{docLinks:docLinks}}=Object(contexts_kibana["b"])();const helpLink=docLinks.links.ml.guide;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(navigation_menu["a"],{tabId:"settings"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPage"],{className:"mlSettingsPage","data-test-subj":"mlPageSettings"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageHeader"],{className:"mlSettingsPage__header"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageHeaderSection"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],null,external_kbnSharedDeps_React_default.a.createElement("h1",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.title",defaultMessage:"Settings"}))))),external_kbnSharedDeps_React_default.a.createElement(AnomalyDetectionSettings,null))),external_kbnSharedDeps_React_default.a.createElement(help_menu["a"],{docLink:helpLink}))};function settings_extends(){settings_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return settings_extends.apply(this,arguments)}const settingsRouteFactory=(navigateToPath,basePath)=>({path:"/settings",render:(props,deps)=>external_kbnSharedDeps_React_default.a.createElement(settings_PageWrapper,settings_extends({},props,{deps:deps})),breadcrumbs:[getBreadcrumbWithUrlForApp("ML_BREADCRUMB",navigateToPath,basePath),getBreadcrumbWithUrlForApp("SETTINGS_BREADCRUMB",navigateToPath,basePath)]});const settings_PageWrapper=({deps:deps})=>{const{redirectToMlAccessDeniedPage:redirectToMlAccessDeniedPage}=deps;const{context:context}=useResolver(undefined,undefined,deps.config,{checkFullLicense:license["b"],checkGetJobsCapabilities:()=>Object(check_capabilities["c"])(redirectToMlAccessDeniedPage),getMlNodeCount:check_ml_nodes["c"]});Object(contexts_kibana["g"])({timeRangeSelector:false,autoRefreshSelector:false});const canGetFilters=Object(check_capabilities["e"])("canGetFilters");const canCreateFilter=Object(check_capabilities["e"])("canCreateFilter");const canGetCalendars=Object(check_capabilities["e"])("canGetCalendars");const canCreateCalendar=Object(check_capabilities["e"])("canCreateCalendar");return external_kbnSharedDeps_React_default.a.createElement(PageLoader,{context:context},external_kbnSharedDeps_React_default.a.createElement(AnomalyDetectionSettingsContext.Provider,{value:{canGetFilters:canGetFilters,canCreateFilter:canCreateFilter,canGetCalendars:canGetCalendars,canCreateCalendar:canCreateCalendar}},external_kbnSharedDeps_React_default.a.createElement(Settings,null)))};function getJobIds(){return new Promise((resolve,reject)=>{ml_api_service["ml"].jobs.jobsSummary().then(resp=>{resolve(resp.map(job=>job.id))}).catch(err=>{const errorMessage=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.calendarsEdit.errorWithFetchingJobSummariesErrorMessage",{defaultMessage:"Error fetching job summaries: {err}",values:{err:err}});console.log(errorMessage);reject(errorMessage)})})}function getGroupIds(){return new Promise((resolve,reject)=>{ml_api_service["ml"].jobs.groups().then(resp=>{resolve(resp.map(group=>group.id))}).catch(err=>{const errorMessage=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.calendarsEdit.errorWithLoadingGroupsErrorMessage",{defaultMessage:"Error loading groups: {err}",values:{err:err}});console.log(errorMessage);reject(errorMessage)})})}function getCalendars(){return new Promise((resolve,reject)=>{ml_api_service["ml"].calendars().then(resp=>{resolve(resp)}).catch(err=>{const errorMessage=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.calendarsEdit.errorWithLoadingCalendarsErrorMessage",{defaultMessage:"Error loading calendars: {err}",values:{err:err}});console.log(errorMessage);reject(errorMessage)})})}function getCalendarSettingsData(){return new Promise(async(resolve,reject)=>{try{const[jobIds,groupIds,calendars]=await Promise.all([getJobIds(),getGroupIds(),getCalendars()]);resolve({jobIds:jobIds,groupIds:groupIds,calendars:calendars})}catch(error){console.log(error);reject(error)}})}function validateCalendarId(calendarId){let valid=true;if(calendarId===""||calendarId===undefined){valid=false}else if(Object(job_utils["i"])(calendarId)===false){valid=false}return valid}function generateTempId(){return Math.random().toString(36).substr(2,9)}function DeleteButton({onClick:onClick,canDeleteCalendar:canDeleteCalendar,testSubj:testSubj}){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{size:"xs",color:"danger",onClick:onClick,isDisabled:canDeleteCalendar===false,"data-test-subj":testSubj},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsEdit.eventsTable.deleteButtonLabel",defaultMessage:"Delete"})))}const EventsTable=({canCreateCalendar:canCreateCalendar,canDeleteCalendar:canDeleteCalendar,eventsList:eventsList,onDeleteClick:onDeleteClick,showSearchBar:showSearchBar,showImportModal:showImportModal,showNewEventModal:showNewEventModal})=>{const sorting={sort:{field:"description",direction:"asc"}};const pagination={initialPageSize:5,pageSizeOptions:[5,10]};const columns=[{field:"description",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.calendarsEdit.eventsTable.descriptionColumnName",{defaultMessage:"Description"}),sortable:true,truncateText:true,scope:"row"},{field:"start_time",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.calendarsEdit.eventsTable.startColumnName",{defaultMessage:"Start"}),sortable:true,render:timeMs=>{const time=external_kbnSharedDeps_Moment_default()(timeMs);return time.format(time_format["a"])}},{field:"end_time",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.calendarsEdit.eventsTable.endColumnName",{defaultMessage:"End"}),sortable:true,render:timeMs=>{const time=external_kbnSharedDeps_Moment_default()(timeMs);return time.format(time_format["a"])}},{field:"",name:"",render:event=>external_kbnSharedDeps_React_default.a.createElement(DeleteButton,{testSubj:"mlCalendarEventDeleteButton",canDeleteCalendar:canDeleteCalendar,onClick:()=>{onDeleteClick(event.event_id)}})}];const search={toolsRight:[external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{isDisabled:canCreateCalendar===false,key:"ml_new_event","data-test-subj":"mlCalendarNewEventButton",size:"s",iconType:"plusInCircle",onClick:showNewEventModal},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsEdit.eventsTable.newEventButtonLabel",defaultMessage:"New event"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{isDisabled:canCreateCalendar===false,key:"ml_import_event","data-test-subj":"mlCalendarImportEventsButton",size:"s",iconType:"importAction",onClick:showImportModal},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsEdit.eventsTable.importEventsButtonLabel",defaultMessage:"Import events"}))],box:{incremental:true},filters:[]};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiInMemoryTable"],{items:eventsList,itemId:"event_id",columns:columns,pagination:pagination,sorting:sorting,search:showSearchBar?search:undefined,"data-test-subj":"mlCalendarEventsTable",rowProps:item=>({"data-test-subj":`mlCalendarEventListRow row-${item.description}`})}))};EventsTable.defaultProps={showSearchBar:false,canCreateCalendar:true,canDeleteCalendar:true};function EditHeader({calendarId:calendarId,description:description}){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{"data-test-subj":"mlCalendarTitle"},external_kbnSharedDeps_React_default.a.createElement("h1",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsEdit.calendarForm.calendarTitle",defaultMessage:"Calendar {calendarId}",values:{calendarId:calendarId}}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{"data-test-subj":"mlCalendarDescriptionText"},external_kbnSharedDeps_React_default.a.createElement("p",null,description)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}))}const CalendarForm=({calendarId:calendarId,canCreateCalendar:canCreateCalendar,canDeleteCalendar:canDeleteCalendar,description:description,eventsList:eventsList,groupIds:groupIds,isEdit:isEdit,isNewCalendarIdValid:isNewCalendarIdValid,jobIds:jobIds,onCalendarIdChange:onCalendarIdChange,onCreate:onCreate,onCreateGroupOption:onCreateGroupOption,onDescriptionChange:onDescriptionChange,onEdit:onEdit,onEventDelete:onEventDelete,onGroupSelection:onGroupSelection,showImportModal:showImportModal,onJobSelection:onJobSelection,saving:saving,selectedGroupOptions:selectedGroupOptions,selectedJobOptions:selectedJobOptions,showNewEventModal:showNewEventModal,isGlobalCalendar:isGlobalCalendar,onGlobalCalendarChange:onGlobalCalendarChange})=>{const msg=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.calendarsEdit.calendarForm.allowedCharactersDescription",{defaultMessage:"Use lowercase alphanumerics (a-z and 0-9), hyphens or underscores; "+"must start and end with an alphanumeric character"});const helpText=isNewCalendarIdValid===true&&!isEdit?msg:undefined;const error=isNewCalendarIdValid===false&&!isEdit?[msg]:undefined;const saveButtonDisabled=canCreateCalendar===false||saving||!isNewCalendarIdValid||calendarId==="";const redirectToCalendarsManagementPage=Object(use_create_url["a"])(ml_url_generator["b"].CALENDARS_MANAGE);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiForm"],{"data-test-subj":`mlCalendarForm${isEdit===true?"Edit":"New"}`},isEdit===true?external_kbnSharedDeps_React_default.a.createElement(EditHeader,{calendarId:calendarId,description:description}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],null,external_kbnSharedDeps_React_default.a.createElement("h1",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsEdit.calendarForm.createCalendarTitle",defaultMessage:"Create new calendar"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsEdit.calendarForm.calendarIdLabel",defaultMessage:"Calendar ID"}),helpText:helpText,error:error,isInvalid:!isNewCalendarIdValid},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{name:"calendarId",value:calendarId,onChange:onCalendarIdChange,disabled:isEdit===true||saving===true,"data-test-subj":"mlCalendarIdInput"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsEdit.calendarForm.descriptionLabel",defaultMessage:"Description"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{name:"description",value:description,onChange:onDescriptionChange,disabled:isEdit===true||saving===true,"data-test-subj":"mlCalendarDescriptionInput"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xl"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{name:"switch",label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsEdit.calendarForm.allJobsLabel",defaultMessage:"Apply calendar to all jobs"}),checked:isGlobalCalendar,onChange:onGlobalCalendarChange,disabled:saving===true||canCreateCalendar===false,"data-test-subj":"mlCalendarApplyToAllJobsSwitch"}),isGlobalCalendar===false&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsEdit.calendarForm.jobsLabel",defaultMessage:"Jobs"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{options:jobIds,selectedOptions:selectedJobOptions,onChange:onJobSelection,isDisabled:saving===true||canCreateCalendar===false,"data-test-subj":"mlCalendarJobSelection"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsEdit.calendarForm.groupsLabel",defaultMessage:"Groups"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{onCreateOption:onCreateGroupOption,options:groupIds,selectedOptions:selectedGroupOptions,onChange:onGroupSelection,isDisabled:saving===true||canCreateCalendar===false,"data-test-subj":"mlCalendarJobGroupSelection"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xl"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsEdit.calendarForm.eventsLabel",defaultMessage:"Events"}),fullWidth:true},external_kbnSharedDeps_React_default.a.createElement(EventsTable,{canCreateCalendar:canCreateCalendar,canDeleteCalendar:canDeleteCalendar,eventsList:eventsList,onDeleteClick:onEventDelete,showImportModal:showImportModal,showNewEventModal:showNewEventModal,showSearchBar:true})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"flexEnd"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{isDisabled:saving,onClick:redirectToCalendarsManagementPage},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsEdit.calendarForm.cancelButtonLabel",defaultMessage:"Cancel"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{"data-test-subj":"mlSaveCalendarButton",fill:true,onClick:isEdit?onEdit:onCreate,isDisabled:saveButtonDisabled},saving?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsEdit.calendarForm.savingButtonLabel",defaultMessage:"Saving…"}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsEdit.calendarForm.saveButtonLabel",defaultMessage:"Save"})))))};function new_event_modal_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const VALID_DATE_STRING_LENGTH=19;class new_event_modal_NewEventModal extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);new_event_modal_defineProperty(this,"onDescriptionChange",e=>{this.setState({description:e.target.value})});new_event_modal_defineProperty(this,"handleAddEvent",()=>{const{description:description,startDate:startDate,endDate:endDate}=this.state;const tempId=generateTempId();const event={description:description,start_time:startDate.valueOf(),end_time:endDate.valueOf(),event_id:tempId};this.props.addEvent(event)});new_event_modal_defineProperty(this,"handleChangeStart",date=>{let start=null;let end=this.state.endDate;const startMoment=external_kbnSharedDeps_Moment_default()(date);const endMoment=external_kbnSharedDeps_Moment_default()(date);start=startMoment.startOf("day");if(start>end){end=endMoment.startOf("day").add(1,"days")}this.setState({startDate:start,endDate:end,startDateString:start.format(time_format["a"]),endDateString:end.format(time_format["a"])})});new_event_modal_defineProperty(this,"handleChangeEnd",date=>{let start=this.state.startDate;let end=null;const startMoment=external_kbnSharedDeps_Moment_default()(date);const endMoment=external_kbnSharedDeps_Moment_default()(date);end=endMoment.startOf("day");if(start>end){start=startMoment.startOf("day").subtract(1,"days")}this.setState({startDate:start,endDate:end,startDateString:start.format(time_format["a"]),endDateString:end.format(time_format["a"])})});new_event_modal_defineProperty(this,"handleTimeStartChange",event=>{const dateString=event.target.value;let isValidDate=false;if(dateString.length===VALID_DATE_STRING_LENGTH){isValidDate=external_kbnSharedDeps_Moment_default()(dateString).isValid(time_format["a"],true)}else{this.setState({startDateString:dateString})}if(isValidDate){this.setState({startDateString:dateString,startDate:external_kbnSharedDeps_Moment_default()(dateString)})}});new_event_modal_defineProperty(this,"handleTimeEndChange",event=>{const dateString=event.target.value;let isValidDate=false;if(dateString.length===VALID_DATE_STRING_LENGTH){isValidDate=external_kbnSharedDeps_Moment_default()(dateString).isValid(time_format["a"],true)}else{this.setState({endDateString:dateString})}if(isValidDate){this.setState({endDateString:dateString,endDate:external_kbnSharedDeps_Moment_default()(dateString)})}});new_event_modal_defineProperty(this,"renderRangedDatePicker",()=>{const{startDate:startDate,endDate:endDate,startDateString:startDateString,endDateString:endDateString}=this.state;const timeInputs=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsEdit.newEventModal.fromLabel",defaultMessage:"From:"}),helpText:time_format["a"]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{name:"startTime",onChange:this.handleTimeStartChange,placeholder:time_format["a"],value:startDateString}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsEdit.newEventModal.toLabel",defaultMessage:"To:"}),helpText:time_format["a"]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{name:"endTime",onChange:this.handleTimeEndChange,placeholder:time_format["a"],value:endDateString})))));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),timeInputs,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDatePickerRange"],{fullWidth:true,iconType:false,startDateControl:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDatePicker"],{fullWidth:true,inline:true,selected:startDate,onChange:this.handleChangeStart,startDate:startDate,endDate:endDate,isInvalid:startDate>endDate,"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.calendarsEdit.newEventModal.startDateAriaLabel",{defaultMessage:"Start date"}),timeFormat:time_format["a"],dateFormat:time_format["a"]}),endDateControl:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDatePicker"],{fullWidth:true,inline:true,selected:endDate,onChange:this.handleChangeEnd,startDate:startDate,endDate:endDate,isInvalid:startDate>endDate,"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.calendarsEdit.newEventModal.endDateAriaLabel",{defaultMessage:"End date"}),timeFormat:time_format["a"],dateFormat:time_format["a"]})})))});const _startDate=external_kbnSharedDeps_Moment_default()().startOf("day");const _endDate=external_kbnSharedDeps_Moment_default()().startOf("day").add(1,"days");this.state={startDate:_startDate,endDate:_endDate,description:"",startDateString:_startDate.format(time_format["a"]),endDateString:_endDate.format(time_format["a"])}}render(){const{closeModal:closeModal}=this.props;const{description:description}=this.state;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModal"],{onClose:closeModal,initialFocus:"[name=eventDescription]",maxWidth:false,"data-test-subj":"mlCalendarEventForm"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalHeaderTitle"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsEdit.newEventModal.createNewEventTitle",defaultMessage:"Create new event"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiForm"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsEdit.newEventModal.descriptionLabel",defaultMessage:"Description"}),fullWidth:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{name:"eventDescription",onChange:this.onDescriptionChange,isInvalid:!description,fullWidth:true,"data-test-subj":"mlCalendarEventDescriptionInput"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),this.renderRangedDatePicker())),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalFooter"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:closeModal,"data-test-subj":"mlCalendarCancelEventButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsEdit.newEventModal.cancelButtonLabel",defaultMessage:"Cancel"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:this.handleAddEvent,fill:true,disabled:!description,"data-test-subj":"mlCalendarAddEventButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsEdit.newEventModal.addButtonLabel",defaultMessage:"Add"})))))}}function ImportedEvents({events:events,showRecurringWarning:showRecurringWarning,includePastEvents:includePastEvents,onCheckboxToggle:onCheckboxToggle,onEventDelete:onEventDelete}){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement("h4",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsEdit.importedEvents.eventsToImportTitle",defaultMessage:"Events to import: {eventsCount}",values:{eventsCount:events.length}})),showRecurringWarning&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{color:"danger"},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsEdit.importedEvents.recurringEventsNotSupportedDescription",defaultMessage:"Recurring events not supported. Only the first event will be imported."}))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(EventsTable,{eventsList:events,onDeleteClick:onEventDelete})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCheckbox"],{id:"ml-include-past-events",label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsEdit.importedEvents.includePastEventsLabel",defaultMessage:"Include past events"}),checked:includePastEvents,onChange:onCheckboxToggle})))}var lib=__webpack_require__(302);var lib_default=__webpack_require__.n(lib);function createEvents(ical){const events=ical.events();const mlEvents=[];events.forEach(e=>{if(e.element==="VEVENT"){const description=e.properties.SUMMARY;const start=e.properties.DTSTART;const end=e.properties.DTEND;const recurring=e.properties.RRULE!==undefined;if(description&&start&&end&&description.length&&start.length&&end.length){const tempId=generateTempId();mlEvents.push({event_id:tempId,description:description[0].value,start_time:start[0].value.valueOf(),end_time:end[0].value.valueOf(),asterisk:recurring})}}});return mlEvents}function filterEvents(events){const now=external_kbnSharedDeps_Moment_default()().valueOf();return events.filter(e=>e.start_time>now)}function parseICSFile(data){const cal=lib_default.a.parse_calendar(data+"\n");return createEvents(cal)}function utils_readFile(file){return new Promise((resolve,reject)=>{if(file&&file.size){const reader=new FileReader;reader.readAsText(file);reader.onload=(()=>()=>{const data=reader.result;if(data===""){reject()}else{resolve({data:data})}})(file)}else{reject()}})}function import_modal_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const MAX_FILE_SIZE_MB=100;class import_modal_ImportModal extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);import_modal_defineProperty(this,"handleImport",async loadedFile=>{const incomingFile=loadedFile[0];const errorMessage=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.calendarsEdit.importModal.couldNotParseICSFileErrorMessage",{defaultMessage:"Could not parse ICS file."});let events=[];if(incomingFile&&incomingFile.size<=MAX_FILE_SIZE_MB*1e6){this.setState({fileLoading:true,fileLoaded:true});try{const parsedFile=await utils_readFile(incomingFile);events=parseICSFile(parsedFile.data);this.setState({allImportedEvents:events,selectedEvents:filterEvents(events),fileLoading:false,errorMessage:null,includePastEvents:false})}catch(error){console.log(errorMessage,error);this.setState({errorMessage:errorMessage,fileLoading:false})}}else if(incomingFile&&incomingFile.size>MAX_FILE_SIZE_MB*1e6){this.setState({fileLoading:false,errorMessage:errorMessage})}else{this.setState({fileLoading:false,errorMessage:null})}});import_modal_defineProperty(this,"onEventDelete",eventId=>{this.setState(prevState=>({allImportedEvents:prevState.allImportedEvents.filter(event=>event.event_id!==eventId),selectedEvents:prevState.selectedEvents.filter(event=>event.event_id!==eventId)}))});import_modal_defineProperty(this,"onCheckboxToggle",e=>{this.setState({includePastEvents:e.target.checked})});import_modal_defineProperty(this,"handleEventsAdd",()=>{const{allImportedEvents:allImportedEvents,selectedEvents:selectedEvents,includePastEvents:includePastEvents}=this.state;const eventsToImport=includePastEvents?allImportedEvents:selectedEvents;const events=eventsToImport.map(event=>({description:event.description,start_time:event.start_time,end_time:event.end_time,event_id:event.event_id}));this.props.addImportedEvents(events)});import_modal_defineProperty(this,"renderCallout",()=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{color:"danger"},external_kbnSharedDeps_React_default.a.createElement("p",null,this.state.errorMessage)));this.state={includePastEvents:false,allImportedEvents:[],selectedEvents:[],fileLoading:false,fileLoaded:false,errorMessage:null}}render(){const{closeImportModal:closeImportModal}=this.props;const{fileLoading:fileLoading,fileLoaded:fileLoaded,allImportedEvents:allImportedEvents,selectedEvents:selectedEvents,errorMessage:errorMessage,includePastEvents:includePastEvents}=this.state;let showRecurringWarning=false;let importedEvents;if(includePastEvents){importedEvents=allImportedEvents}else{importedEvents=selectedEvents}if(importedEvents.find(e=>e.asterisk)!==undefined){showRecurringWarning=true}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModal"],{onClose:closeImportModal,maxWidth:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"column",gutterSize:"none"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalHeaderTitle"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsEdit.eventsTable.importEventsTitle",defaultMessage:"Import events"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsEdit.eventsTable.importEventsDescription",defaultMessage:"Import events from an ICS file."}))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"column"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFilePicker"],{compressed:true,initialPromptText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.calendarsEdit.importModal.selectOrDragAndDropFilePromptText",{defaultMessage:"Select or drag and drop a file"}),onChange:this.handleImport,disabled:fileLoading})),errorMessage!==null&&this.renderCallout(),allImportedEvents.length>0&&external_kbnSharedDeps_React_default.a.createElement(ImportedEvents,{events:importedEvents,showRecurringWarning:showRecurringWarning,includePastEvents:includePastEvents,onCheckboxToggle:this.onCheckboxToggle,onEventDelete:this.onEventDelete}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalFooter"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:closeImportModal},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsEdit.eventsTable.cancelButtonLabel",defaultMessage:"Cancel"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:this.handleEventsAdd,fill:true,disabled:fileLoaded===false||errorMessage!==null},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsEdit.eventsTable.importButtonLabel",defaultMessage:"Import"})))))}}function new_calendar_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class new_calendar_NewCalendarUI extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);new_calendar_defineProperty(this,"returnToCalendarsManagementPage",async()=>{const{services:{http:{basePath:basePath},application:{navigateToUrl:navigateToUrl}}}=this.props.kibana;await navigateToUrl(`${basePath.get()}/app/ml/${ml_url_generator["b"].CALENDARS_MANAGE}`,true)});new_calendar_defineProperty(this,"isDuplicateId",()=>{const{calendars:calendars,formCalendarId:formCalendarId}=this.state;for(let i=0;i<calendars.length;i++){if(calendars[i].calendar_id===formCalendarId){return true}}return false});new_calendar_defineProperty(this,"onCreate",async()=>{const{formCalendarId:formCalendarId}=this.state;if(this.isDuplicateId()){const{toasts:toasts}=this.props.kibana.services.notifications;toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.calendarsEdit.canNotCreateCalendarWithExistingIdErrorMessag",{defaultMessage:"Cannot create calendar with id [{formCalendarId}] as it already exists.",values:{formCalendarId:formCalendarId}}))}else{const calendar=this.setUpCalendarForApi();this.setState({saving:true});try{await ml_api_service["ml"].addCalendar(calendar);await this.returnToCalendarsManagementPage()}catch(error){console.log("Error saving calendar",error);this.setState({saving:false});const{toasts:toasts}=this.props.kibana.services.notifications;toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.calendarsEdit.errorWithCreatingCalendarErrorMessage",{defaultMessage:"An error occurred creating calendar {calendarId}",values:{calendarId:calendar.calendarId}}))}}});new_calendar_defineProperty(this,"onEdit",async()=>{const calendar=this.setUpCalendarForApi();this.setState({saving:true});try{await ml_api_service["ml"].updateCalendar(calendar);await this.returnToCalendarsManagementPage()}catch(error){console.log("Error saving calendar",error);this.setState({saving:false});const{toasts:toasts}=this.props.kibana.services.notifications;toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.calendarsEdit.errorWithUpdatingCalendarErrorMessage",{defaultMessage:"An error occurred saving calendar {calendarId}. Try refreshing the page.",values:{calendarId:calendar.calendarId}}))}});new_calendar_defineProperty(this,"setUpCalendarForApi",()=>{const{formCalendarId:formCalendarId,description:description,events:events,selectedGroupOptions:selectedGroupOptions,selectedJobOptions:selectedJobOptions,isGlobalCalendar:isGlobalCalendar}=this.state;const allIds=isGlobalCalendar?[GLOBAL_CALENDAR]:[...selectedJobOptions.map(option=>option.label),...selectedGroupOptions.map(option=>option.label)];const eventsToSave=events.map(event=>({description:event.description,start_time:event.start_time,end_time:event.end_time}));const calendar={calendarId:formCalendarId,description:description,events:eventsToSave,job_ids:allIds};return calendar});new_calendar_defineProperty(this,"onCreateGroupOption",newGroup=>{const newOption={label:newGroup};this.setState(prevState=>({selectedGroupOptions:prevState.selectedGroupOptions.concat(newOption)}))});new_calendar_defineProperty(this,"onGlobalCalendarChange",({currentTarget:currentTarget})=>{this.setState({isGlobalCalendar:currentTarget.checked})});new_calendar_defineProperty(this,"onJobSelection",selectedJobOptions=>{this.setState({selectedJobOptions:selectedJobOptions})});new_calendar_defineProperty(this,"onGroupSelection",selectedGroupOptions=>{this.setState({selectedGroupOptions:selectedGroupOptions})});new_calendar_defineProperty(this,"onCalendarIdChange",e=>{const isValid=validateCalendarId(e.target.value);this.setState({formCalendarId:e.target.value,isNewCalendarIdValid:isValid})});new_calendar_defineProperty(this,"onDescriptionChange",e=>{this.setState({description:e.target.value})});new_calendar_defineProperty(this,"showImportModal",()=>{this.setState(prevState=>({isImportModalVisible:!prevState.isImportModalVisible}))});new_calendar_defineProperty(this,"closeImportModal",()=>{this.setState({isImportModalVisible:false})});new_calendar_defineProperty(this,"onEventDelete",eventId=>{this.setState(prevState=>({events:prevState.events.filter(event=>event.event_id!==eventId)}))});new_calendar_defineProperty(this,"closeNewEventModal",()=>{this.setState({isNewEventModalVisible:false})});new_calendar_defineProperty(this,"showNewEventModal",()=>{this.setState({isNewEventModalVisible:true})});new_calendar_defineProperty(this,"addEvent",event=>{this.setState(prevState=>({events:[...prevState.events,event],isNewEventModalVisible:false}))});new_calendar_defineProperty(this,"addImportedEvents",events=>{this.setState(prevState=>({events:[...prevState.events,...events],isImportModalVisible:false}))});this.state={isNewEventModalVisible:false,isImportModalVisible:false,isNewCalendarIdValid:null,loading:true,jobIds:[],jobIdOptions:[],groupIds:[],groupIdOptions:[],calendars:[],formCalendarId:"",description:"",selectedJobOptions:[],selectedGroupOptions:[],events:[],saving:false,selectedCalendar:undefined,isGlobalCalendar:false}}componentDidMount(){this.formSetup()}async formSetup(){try{const{jobIds:jobIds,groupIds:groupIds,calendars:calendars}=await getCalendarSettingsData();const jobIdOptions=jobIds.map(jobId=>({label:jobId}));const groupIdOptions=groupIds.map(groupId=>({label:groupId}));const selectedJobOptions=[];const selectedGroupOptions=[];let eventsList=[];let selectedCalendar;let formCalendarId="";let isGlobalCalendar=false;if(this.props.calendarId!==undefined){selectedCalendar=calendars.find(cal=>cal.calendar_id===this.props.calendarId);if(selectedCalendar){formCalendarId=selectedCalendar.calendar_id;eventsList=selectedCalendar.events;if(selectedCalendar.job_ids.includes(GLOBAL_CALENDAR)){isGlobalCalendar=true}else{selectedCalendar.job_ids.forEach(id=>{if(jobIds.find(jobId=>jobId===id)){selectedJobOptions.push({label:id})}else if(groupIds.find(groupId=>groupId===id)){selectedGroupOptions.push({label:id})}})}}}this.setState({events:eventsList,formCalendarId:formCalendarId,jobIds:jobIds,jobIdOptions:jobIdOptions,groupIds:groupIds,groupIdOptions:groupIdOptions,calendars:calendars,loading:false,selectedJobOptions:selectedJobOptions,selectedGroupOptions:selectedGroupOptions,selectedCalendar:selectedCalendar,isGlobalCalendar:isGlobalCalendar})}catch(error){console.log(error);this.setState({loading:false});const{toasts:toasts}=this.props.kibana.services.notifications;toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.calendarsEdit.errorWithLoadingCalendarFromDataErrorMessage",{defaultMessage:"An error occurred loading calendar form data. Try refreshing the page."}))}}render(){const{events:events,isNewEventModalVisible:isNewEventModalVisible,isImportModalVisible:isImportModalVisible,isNewCalendarIdValid:isNewCalendarIdValid,formCalendarId:formCalendarId,description:description,groupIdOptions:groupIdOptions,jobIdOptions:jobIdOptions,saving:saving,selectedCalendar:selectedCalendar,selectedJobOptions:selectedJobOptions,selectedGroupOptions:selectedGroupOptions,isGlobalCalendar:isGlobalCalendar}=this.state;const helpLink=Object(dependency_cache["b"])().links.ml.calendars;let modal="";if(isNewEventModalVisible){modal=external_kbnSharedDeps_React_default.a.createElement(new_event_modal_NewEventModal,{addEvent:this.addEvent,closeModal:this.closeNewEventModal})}else if(isImportModalVisible){modal=external_kbnSharedDeps_React_default.a.createElement(import_modal_ImportModal,{addImportedEvents:this.addImportedEvents,closeImportModal:this.closeImportModal})}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(navigation_menu["a"],{tabId:"settings"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPage"],{className:"mlCalendarEditForm","data-test-subj":"mlPageCalendarEdit"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageContent"],{className:"mlCalendarEditForm__content",verticalPosition:"center",horizontalPosition:"center"},external_kbnSharedDeps_React_default.a.createElement(CalendarForm,{calendarId:selectedCalendar?selectedCalendar.calendar_id:formCalendarId,canCreateCalendar:this.props.canCreateCalendar,canDeleteCalendar:this.props.canDeleteCalendar,description:selectedCalendar?selectedCalendar.description:description,eventsList:events,groupIds:groupIdOptions,isEdit:selectedCalendar!==undefined,isNewCalendarIdValid:selectedCalendar||isNewCalendarIdValid===null?true:isNewCalendarIdValid,jobIds:jobIdOptions,onCalendarIdChange:this.onCalendarIdChange,onCreate:this.onCreate,onDescriptionChange:this.onDescriptionChange,onEdit:this.onEdit,onEventDelete:this.onEventDelete,onGroupSelection:this.onGroupSelection,showImportModal:this.showImportModal,onJobSelection:this.onJobSelection,saving:saving,selectedGroupOptions:selectedGroupOptions,selectedJobOptions:selectedJobOptions,onCreateGroupOption:this.onCreateGroupOption,showNewEventModal:this.showNewEventModal,isGlobalCalendar:isGlobalCalendar,onGlobalCalendarChange:this.onGlobalCalendarChange})),modal)),external_kbnSharedDeps_React_default.a.createElement(help_menu["a"],{docLink:helpLink}))}}const NewCalendar=Object(kibanaReact_public_["withKibana"])(new_calendar_NewCalendarUI);function CalendarsListHeaderUI({totalCount:totalCount,refreshCalendars:refreshCalendars,kibana:kibana}){const docsUrl=kibana.services.docLinks.links.ml.calendars;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween",alignItems:"baseline"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"baseline",gutterSize:"m",responsive:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],null,external_kbnSharedDeps_React_default.a.createElement("h1",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.calendars.listHeader.calendarsTitle",defaultMessage:"Calendars"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTextColor"],{color:"subdued"},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.calendars.listHeader.calendarsListTotalCount",defaultMessage:"{totalCount} in total",values:{totalCount:totalCount}})))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"baseline",gutterSize:"m",responsive:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{size:"s",iconType:"refresh",onClick:refreshCalendars,"data-test-subj":"mlCalendarListRefreshButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.calendars.listHeader.refreshButtonLabel",defaultMessage:"Refresh"})))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTextColor"],{color:"subdued"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.calendars.listHeader.calendarsDescription",defaultMessage:"Calendars contain a list of scheduled events for which you do not want to generate anomalies, such as planned system outages or public holidays. The same calendar can be assigned to multiple jobs.{br}{learnMoreLink}",values:{br:external_kbnSharedDeps_React_default.a.createElement("br",null),learnMoreLink:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{href:docsUrl,target:"_blank"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.calendars.listHeader.calendarsDescription.learnMoreLinkText",defaultMessage:"Learn more"}))}})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}))}const CalendarsListHeader=Object(kibanaReact_public_["withKibana"])(CalendarsListHeaderUI);const CalendarsListTable=({calendarsList:calendarsList,onDeleteClick:onDeleteClick,setSelectedCalendarList:setSelectedCalendarList,loading:loading,canCreateCalendar:canCreateCalendar,canDeleteCalendar:canDeleteCalendar,mlNodesAvailable:mlNodesAvailable,itemsSelected:itemsSelected})=>{const redirectToNewCalendarPage=Object(use_create_url["a"])(ml_url_generator["b"].CALENDARS_NEW);const sorting={sort:{field:"calendar_id",direction:"asc"}};const pagination={initialPageSize:20,pageSizeOptions:[10,20]};const columns=[{field:"calendar_id",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.calendarsList.table.idColumnName",{defaultMessage:"ID"}),sortable:true,truncateText:true,scope:"row",render:id=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ReactRouterDom_["Link"],{to:`/${ml_url_generator["b"].CALENDARS_EDIT}/${id}`,"data-test-subj":"mlEditCalendarLink"},id),"data-test-subj":"mlCalendarListColumnId"},{field:"job_ids_string",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.calendarsList.table.jobsColumnName",{defaultMessage:"Jobs"}),sortable:true,truncateText:true,render:jobList=>jobList===GLOBAL_CALENDAR?external_kbnSharedDeps_React_default.a.createElement("span",{style:{fontStyle:"italic"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsList.table.allJobsLabel",defaultMessage:"Applies to all jobs"})):jobList,"data-test-subj":"mlCalendarListColumnJobs"},{field:"events_length",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.calendarsList.table.eventsColumnName",{defaultMessage:"Events"}),sortable:true,render:eventsLength=>external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.calendarsList.table.eventsCountLabel",{defaultMessage:"{eventsLength, plural, one {# event} other {# events}}",values:{eventsLength:eventsLength}}),"data-test-subj":"mlCalendarListColumnEvents"}];const tableSelection={onSelectionChange:selection=>setSelectedCalendarList(selection)};const search={toolsRight:[external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{size:"s","data-test-subj":"mlCalendarButtonCreate",key:"new_calendar_button",onClick:redirectToNewCalendarPage,isDisabled:canCreateCalendar===false||mlNodesAvailable===false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsList.table.newButtonLabel",defaultMessage:"New"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{size:"s",color:"danger",iconType:"trash",onClick:onDeleteClick,isDisabled:canDeleteCalendar===false||mlNodesAvailable===false||itemsSelected===false,"data-test-subj":"mlCalendarButtonDelete",key:"delete_calendar_button"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsList.table.deleteButtonLabel",defaultMessage:"Delete"}))],box:{incremental:true},filters:[]};return external_kbnSharedDeps_React_default.a.createElement("div",{"data-test-subj":"mlCalendarTableContainer"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiInMemoryTable"],{items:calendarsList,itemId:"calendar_id",columns:columns,search:search,pagination:pagination,sorting:sorting,loading:loading,selection:tableSelection,isSelectable:true,"data-test-subj":loading?"mlCalendarTable loading":"mlCalendarTable loaded",rowProps:item=>({"data-test-subj":`mlCalendarListRow row-${item.calendar_id}`})}))};async function deleteCalendars(calendarsToDelete,callback){if(calendarsToDelete===undefined||calendarsToDelete.length===0){return}const toastNotifications=Object(dependency_cache["j"])();const messageId=calendarsToDelete.length>1?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.calendarsList.deleteCalendars.calendarsLabel",{defaultMessage:"{calendarsToDeleteCount} calendars",values:{calendarsToDeleteCount:calendarsToDelete.length}}):`${calendarsToDelete[0].calendar_id}`;toastNotifications.add(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.calendarsList.deleteCalendars.deletingCalendarsNotificationMessage",{defaultMessage:"Deleting {messageId}",values:{messageId:messageId}}));for(const calendar of calendarsToDelete){const calendarId=calendar.calendar_id;try{await ml_api_service["ml"].deleteCalendar({calendarId:calendarId})}catch(error){console.log("Error deleting calendar:",error);toastNotifications.addDanger({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.calendarsList.deleteCalendars.deletingCalendarErrorMessage",{defaultMessage:"An error occurred deleting calendar {calendarId}",values:{calendarId:calendar.calendar_id}}),text:Object(util_errors["i"])(error)})}}toastNotifications.addSuccess(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.calendarsList.deleteCalendars.deletingCalendarSuccessNotificationMessage",{defaultMessage:"{messageId} deleted",values:{messageId:messageId}}));callback()}function calendars_list_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class calendars_list_CalendarsListUI extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);calendars_list_defineProperty(this,"loadCalendars",async()=>{this.setState({loading:true});try{const calendars=await ml_api_service["ml"].calendars();this.setState({calendars:calendars,loading:false,isDestroyModalVisible:false})}catch(error){console.log(error);this.setState({loading:false});const{toasts:toasts}=this.props.kibana.services.notifications;toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.calendarsList.errorWithLoadingListOfCalendarsErrorMessage",{defaultMessage:"An error occurred loading the list of calendars."}))}});calendars_list_defineProperty(this,"closeDestroyModal",()=>{this.setState({isDestroyModalVisible:false,calendarId:null})});calendars_list_defineProperty(this,"showDestroyModal",()=>{this.setState({isDestroyModalVisible:true})});calendars_list_defineProperty(this,"setSelectedCalendarList",selectedCalendars=>{this.setState({selectedForDeletion:selectedCalendars})});calendars_list_defineProperty(this,"deleteCalendars",()=>{const{selectedForDeletion:selectedForDeletion}=this.state;this.closeDestroyModal();deleteCalendars(selectedForDeletion,this.loadCalendars)});calendars_list_defineProperty(this,"addRequiredFieldsToList",(calendarsList=[])=>{for(let i=0;i<calendarsList.length;i++){calendarsList[i].job_ids_string=calendarsList[i].job_ids.join(", ");calendarsList[i].events_length=calendarsList[i].events.length}return calendarsList});this.state={loading:true,calendars:[],isDestroyModalVisible:false,calendarId:null,selectedForDeletion:[],nodesAvailable:Object(check_ml_nodes["e"])()}}componentDidMount(){this.loadCalendars()}render(){const{calendars:calendars,selectedForDeletion:selectedForDeletion,loading:loading,nodesAvailable:nodesAvailable}=this.state;const{canCreateCalendar:canCreateCalendar,canDeleteCalendar:canDeleteCalendar}=this.props;let destroyModal="";const helpLink=Object(dependency_cache["b"])().links.ml.calendars;if(this.state.isDestroyModalVisible){destroyModal=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiConfirmModal"],{"data-test-subj":"mlCalendarDeleteConfirmation",title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsList.deleteCalendarsModal.deleteMultipleCalendarsTitle",defaultMessage:"Delete {calendarsCount, plural, one {{calendarsList}} other {# calendars}}?",values:{calendarsCount:selectedForDeletion.length,calendarsList:selectedForDeletion.map(c=>c.calendar_id).join(", ")}}),onCancel:this.closeDestroyModal,onConfirm:this.deleteCalendars,cancelButtonText:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsList.deleteCalendarsModal.cancelButtonLabel",defaultMessage:"Cancel"}),confirmButtonText:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.calendarsList.deleteCalendarsModal.deleteButtonLabel",defaultMessage:"Delete"}),buttonColor:"danger",defaultFocusedButton:external_kbnSharedDeps_ElasticEui_["EUI_MODAL_CONFIRM_BUTTON"]})}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(navigation_menu["a"],{tabId:"settings"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPage"],{className:"mlCalendarList","data-test-subj":"mlPageCalendarManagement"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageContent"],{className:"mlCalendarList__content",verticalPosition:"center",horizontalPosition:"center"},external_kbnSharedDeps_React_default.a.createElement(CalendarsListHeader,{totalCount:calendars.length,refreshCalendars:this.loadCalendars}),external_kbnSharedDeps_React_default.a.createElement(CalendarsListTable,{loading:loading,calendarsList:this.addRequiredFieldsToList(calendars),onDeleteClick:this.showDestroyModal,canCreateCalendar:canCreateCalendar,canDeleteCalendar:canDeleteCalendar,mlNodesAvailable:nodesAvailable,setSelectedCalendarList:this.setSelectedCalendarList,itemsSelected:selectedForDeletion.length>0})),destroyModal)),external_kbnSharedDeps_React_default.a.createElement(help_menu["a"],{docLink:helpLink}))}}const CalendarsList=Object(kibanaReact_public_["withKibana"])(calendars_list_CalendarsListUI);function calendar_list_extends(){calendar_list_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return calendar_list_extends.apply(this,arguments)}const calendarListRouteFactory=(navigateToPath,basePath)=>({path:"/settings/calendars_list",render:(props,deps)=>external_kbnSharedDeps_React_default.a.createElement(calendar_list_PageWrapper,calendar_list_extends({},props,{deps:deps})),breadcrumbs:[getBreadcrumbWithUrlForApp("ML_BREADCRUMB",navigateToPath,basePath),getBreadcrumbWithUrlForApp("SETTINGS_BREADCRUMB",navigateToPath,basePath),getBreadcrumbWithUrlForApp("CALENDAR_MANAGEMENT_BREADCRUMB",navigateToPath,basePath)]});const calendar_list_PageWrapper=({deps:deps})=>{const{redirectToMlAccessDeniedPage:redirectToMlAccessDeniedPage}=deps;const{context:context}=useResolver(undefined,undefined,deps.config,{checkFullLicense:license["b"],checkGetJobsCapabilities:()=>Object(check_capabilities["c"])(redirectToMlAccessDeniedPage),getMlNodeCount:check_ml_nodes["c"]});Object(contexts_kibana["g"])({timeRangeSelector:false,autoRefreshSelector:false});const canCreateCalendar=Object(check_capabilities["e"])("canCreateCalendar");const canDeleteCalendar=Object(check_capabilities["e"])("canDeleteCalendar");return external_kbnSharedDeps_React_default.a.createElement(PageLoader,{context:context},external_kbnSharedDeps_React_default.a.createElement(CalendarsList,{canCreateCalendar:canCreateCalendar,canDeleteCalendar:canDeleteCalendar}))};function calendar_new_edit_extends(){calendar_new_edit_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return calendar_new_edit_extends.apply(this,arguments)}var calendar_new_edit_MODE;(function(MODE){MODE[MODE["NEW"]=0]="NEW";MODE[MODE["EDIT"]=1]="EDIT"})(calendar_new_edit_MODE||(calendar_new_edit_MODE={}));const newCalendarRouteFactory=(navigateToPath,basePath)=>({path:"/settings/calendars_list/new_calendar",render:(props,deps)=>external_kbnSharedDeps_React_default.a.createElement(calendar_new_edit_PageWrapper,calendar_new_edit_extends({},props,{deps:deps,mode:calendar_new_edit_MODE.NEW})),breadcrumbs:[getBreadcrumbWithUrlForApp("ML_BREADCRUMB",navigateToPath,basePath),getBreadcrumbWithUrlForApp("SETTINGS_BREADCRUMB",navigateToPath,basePath),getBreadcrumbWithUrlForApp("CALENDAR_MANAGEMENT_BREADCRUMB",navigateToPath,basePath),{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.settings.breadcrumbs.calendarManagement.createLabel",{defaultMessage:"Create"}),onClick:breadcrumbOnClickFactory("/settings/calendars_list/new_calendar",navigateToPath)}]});const editCalendarRouteFactory=(navigateToPath,basePath)=>({path:"/settings/calendars_list/edit_calendar/:calendarId",render:(props,deps)=>external_kbnSharedDeps_React_default.a.createElement(calendar_new_edit_PageWrapper,calendar_new_edit_extends({},props,{deps:deps,mode:calendar_new_edit_MODE.EDIT})),breadcrumbs:[getBreadcrumbWithUrlForApp("ML_BREADCRUMB",navigateToPath,basePath),getBreadcrumbWithUrlForApp("SETTINGS_BREADCRUMB",navigateToPath,basePath),getBreadcrumbWithUrlForApp("CALENDAR_MANAGEMENT_BREADCRUMB",navigateToPath,basePath),{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.settings.breadcrumbs.calendarManagement.editLabel",{defaultMessage:"Edit"}),onClick:breadcrumbOnClickFactory("/settings/calendars_list/edit_calendar",navigateToPath)}]});const calendar_new_edit_PageWrapper=({location:location,mode:mode,deps:deps})=>{let calendarId;if(mode===calendar_new_edit_MODE.EDIT){const pathMatch=location.pathname.match(/.+\/(.+)$/);calendarId=pathMatch&&pathMatch.length>1?pathMatch[1]:undefined}const{redirectToMlAccessDeniedPage:redirectToMlAccessDeniedPage}=deps;const redirectToJobsManagementPage=Object(use_create_url["a"])(ml_url_generator["b"].ANOMALY_DETECTION_JOBS_MANAGE);const{context:context}=useResolver(undefined,undefined,deps.config,{checkFullLicense:license["b"],checkGetJobsCapabilities:()=>Object(check_capabilities["c"])(redirectToMlAccessDeniedPage),checkMlNodesAvailable:()=>Object(check_ml_nodes["a"])(redirectToJobsManagementPage)});Object(contexts_kibana["g"])({timeRangeSelector:false,autoRefreshSelector:false});const canCreateCalendar=Object(check_capabilities["e"])("canCreateCalendar");const canDeleteCalendar=Object(check_capabilities["e"])("canDeleteCalendar");return external_kbnSharedDeps_React_default.a.createElement(PageLoader,{context:context},external_kbnSharedDeps_React_default.a.createElement(NewCalendar,{calendarId:calendarId,canCreateCalendar:canCreateCalendar,canDeleteCalendar:canDeleteCalendar}))};function edit_description_popover_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class edit_description_popover_EditDescriptionPopover extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);edit_description_popover_defineProperty(this,"onChange",e=>{this.setState({value:e.target.value})});edit_description_popover_defineProperty(this,"onButtonClick",()=>{if(this.state.isPopoverOpen===false){this.setState({isPopoverOpen:!this.state.isPopoverOpen,value:this.props.description})}else{this.closePopover()}});edit_description_popover_defineProperty(this,"closePopover",()=>{if(this.state.isPopoverOpen===true){this.setState({isPopoverOpen:false});this.props.updateDescription(this.state.value)}});this.state={isPopoverOpen:false,value:props.description}}render(){const{isPopoverOpen:isPopoverOpen,value:value}=this.state;const button=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{size:"s",color:"primary",onClick:this.onButtonClick,iconType:"pencil","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.settings.filterLists.editDescriptionPopover.editDescriptionAriaLabel",{defaultMessage:"Edit description"}),isDisabled:this.props.canCreateFilter===false,"data-test-subj":"mlFilterListEditDescriptionButton"});return external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopover"],{id:"filter_list_description_popover",ownFocus:true,button:button,isOpen:isPopoverOpen,closePopover:this.closePopover},external_kbnSharedDeps_React_default.a.createElement("div",{style:{width:"300px"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiForm"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.filterLists.editDescriptionPopover.filterListDescriptionAriaLabel",defaultMessage:"Filter list description"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{name:"filter_list_description",value:value,onChange:this.onChange,"data-test-subj":"mlFilterListDescriptionInput"}))))))}}edit_description_popover_defineProperty(edit_description_popover_EditDescriptionPopover,"displayName","EditDescriptionPopover");function filter_list_usage_popover_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class filter_list_usage_popover_FilterListUsagePopover extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);filter_list_usage_popover_defineProperty(this,"onButtonClick",()=>{this.setState({isPopoverOpen:!this.state.isPopoverOpen})});filter_list_usage_popover_defineProperty(this,"closePopover",()=>{this.setState({isPopoverOpen:false})});this.state={isPopoverOpen:false}}render(){const{entityType:entityType,entityValues:entityValues}=this.props;const linkText=`${entityValues.length} ${entityType}${entityValues.length!==1?"s":""}`;const listItems=entityValues.map(value=>external_kbnSharedDeps_React_default.a.createElement("li",{key:value},value));const button=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{size:"s",color:"primary",onClick:this.onButtonClick},linkText);return external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopover"],{id:`${entityType}_filter_list_usage`,panelClassName:"ml-filter-list-usage-popover",ownFocus:true,button:button,isOpen:this.state.isPopoverOpen,closePopover:this.closePopover},external_kbnSharedDeps_React_default.a.createElement("ul",null,listItems)))}}const EditFilterListHeader=({canCreateFilter:canCreateFilter,filterId:filterId,totalItemCount:totalItemCount,description:description,updateDescription:updateDescription,newFilterId:newFilterId,isNewFilterIdInvalid:isNewFilterIdInvalid,updateNewFilterId:updateNewFilterId,usedBy:usedBy})=>{const title=filterId!==undefined?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.filterLists.editFilterHeader.filterListTitle",defaultMessage:"Filter list {filterId}",values:{filterId:filterId}}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.filterLists.editFilterHeader.createFilterListTitle",defaultMessage:"Create new filter list"});let idField;let descriptionField;let usedByElement;if(filterId===undefined){const msg=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.settings.filterLists.editFilterHeader.allowedCharactersDescription",{defaultMessage:"Use lowercase alphanumerics (a-z and 0-9), hyphens or underscores;"+" must start and end with an alphanumeric character"});const helpText=isNewFilterIdInvalid===false?msg:undefined;const error=isNewFilterIdInvalid===true?[msg]:undefined;idField=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.filterLists.editFilterHeader.filterListIdAriaLabel",defaultMessage:"Filter list ID"}),helpText:helpText,error:error,isInvalid:isNewFilterIdInvalid},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{name:"new_filter_id",value:newFilterId,isInvalid:isNewFilterIdInvalid,onChange:e=>updateNewFilterId(e.target.value),"data-test-subj":"mlNewFilterListIdInput"}))}if(description!==undefined&&description.length>0){descriptionField=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{"data-test-subj":"mlNewFilterListDescriptionText"},external_kbnSharedDeps_React_default.a.createElement("p",null,description))}else{descriptionField=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTextColor"],{color:"subdued"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.filterLists.editFilterList.addDescriptionText",defaultMessage:"Add a description"})))}if(filterId!==undefined){if(usedBy!==undefined&&usedBy.jobs.length>0){usedByElement=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement("div",{className:"ml-filter-list-usage"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.filterLists.editFilterList.filterIsUsedInJobsDescription",defaultMessage:"This filter list is used in"})),external_kbnSharedDeps_React_default.a.createElement(filter_list_usage_popover_FilterListUsagePopover,{entityType:"detector",entityValues:usedBy.detectors}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.filterLists.editFilterList.acrossText",defaultMessage:"across"})),external_kbnSharedDeps_React_default.a.createElement(filter_list_usage_popover_FilterListUsagePopover,{entityType:"job",entityValues:usedBy.jobs})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}))}else{usedByElement=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.filterLists.editFilterList.filterIsNotUsedInJobsDescription",defaultMessage:"This filter list is not used by any jobs."}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}))}}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween",alignItems:"baseline"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"baseline",gutterSize:"m",responsive:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],null,external_kbnSharedDeps_React_default.a.createElement("h1",null,title))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTextColor"],{color:"subdued"},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.filterLists.editFilterList.totalItemsDescription",defaultMessage:"{totalItemCount, plural, one {# item} other {# items}} in total",values:{totalItemCount:totalItemCount}}))))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),idField,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"baseline",gutterSize:"s",responsive:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},descriptionField),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(edit_description_popover_EditDescriptionPopover,{canCreateFilter:canCreateFilter,description:description,updateDescription:updateDescription}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),usedByElement)};EditFilterListHeader.displayName="EditFilterListHeader";function add_item_popover_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class add_item_popover_AddItemPopover extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);add_item_popover_defineProperty(this,"onItemsTextChange",e=>{this.setState({itemsText:e.target.value})});add_item_popover_defineProperty(this,"onButtonClick",()=>{this.setState({isPopoverOpen:!this.state.isPopoverOpen})});add_item_popover_defineProperty(this,"closePopover",()=>{this.setState({isPopoverOpen:false})});add_item_popover_defineProperty(this,"onAddButtonClick",()=>{const items=this.state.itemsText.split("\n");const addItems=[];items.forEach(item=>{if(addItems.indexOf(item)===-1&&item.length>0){addItems.push(item)}});this.props.addItems(addItems);this.setState({isPopoverOpen:false,itemsText:""})});this.state={isPopoverOpen:false,itemsText:""}}render(){const button=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{size:"s",color:"primary",iconType:"arrowDown",iconSide:"right",onClick:this.onButtonClick,isDisabled:this.props.canCreateFilter===false,"data-test-subj":"mlFilterListOpenNewItemsPopoverButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.filterLists.addItemPopover.addItemButtonLabel",defaultMessage:"Add item"}));return external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopover"],{id:"add_item_popover",panelClassName:"ml-add-filter-item-popover",ownFocus:true,button:button,isOpen:this.state.isPopoverOpen,closePopover:this.closePopover},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiForm"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.filterLists.addItemPopover.itemsLabel",defaultMessage:"Items"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTextArea"],{value:this.state.itemsText,onChange:this.onItemsTextChange,"data-test-subj":"mlFilterListAddItemTextArea"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.filterLists.addItemPopover.enterItemPerLineDescription",defaultMessage:"Enter one item per line"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"flexEnd"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:this.onAddButtonClick,disabled:this.state.itemsText.length===0,"data-test-subj":"mlFilterListAddItemsButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.filterLists.addItemPopover.addButtonLabel",defaultMessage:"Add"}))))))}}add_item_popover_defineProperty(add_item_popover_AddItemPopover,"displayName","AddItemPopover");function renderToolsRight(canCreateFilter,canDeleteFilter,addItems,deleteSelectedItems,selectedItemCount){return[external_kbnSharedDeps_React_default.a.createElement(add_item_popover_AddItemPopover,{addItems:addItems,canCreateFilter:canCreateFilter,key:"add_item_btn"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{color:"danger",size:"s",disabled:selectedItemCount===0||canDeleteFilter===false,onClick:deleteSelectedItems,key:"delete_item_btn","data-test-subj":"mlFilterListDeleteItemButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.filterLists.toolbar.deleteItemButtonLabel",defaultMessage:"Delete item"}))]}function EditFilterListToolbar({canCreateFilter:canCreateFilter,canDeleteFilter:canDeleteFilter,onSearchChange:onSearchChange,addItems:addItems,deleteSelectedItems:deleteSelectedItems,selectedItemCount:selectedItemCount}){const toolsRight=renderToolsRight(canCreateFilter,canDeleteFilter,addItems,deleteSelectedItems,selectedItemCount);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center",gutterSize:"xl"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSearchBar"],{toolsRight:toolsRight,onChange:onSearchChange,filters:[]}))))}function items_grid_pagination_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function getContextMenuItemIcon(menuItemSetting,itemsPerPage){return menuItemSetting===itemsPerPage?"check":"empty"}class items_grid_pagination_ItemsGridPagination extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);items_grid_pagination_defineProperty(this,"onButtonClick",()=>{this.setState({isPopoverOpen:!this.state.isPopoverOpen})});items_grid_pagination_defineProperty(this,"closePopover",()=>{this.setState({isPopoverOpen:false})});items_grid_pagination_defineProperty(this,"onPageClick",pageNumber=>{this.props.setActivePage(pageNumber)});items_grid_pagination_defineProperty(this,"onChangeItemsPerPage",pageSize=>{this.closePopover();this.props.setItemsPerPage(pageSize)});this.state={isPopoverOpen:false}}render(){const{itemCount:itemCount,itemsPerPage:itemsPerPage,itemsPerPageOptions:itemsPerPageOptions,activePage:activePage}=this.props;const button=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{size:"s",color:"text",iconType:"arrowDown",iconSide:"right",onClick:this.onButtonClick},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.itemsGrid.itemsPerPageButtonLabel",defaultMessage:"Items per page: {itemsPerPage}",values:{itemsPerPage:itemsPerPage}}));const pageCount=Math.ceil(itemCount/itemsPerPage);const items=itemsPerPageOptions.map(pageSize=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiContextMenuItem"],{key:`${pageSize} items`,icon:getContextMenuItemIcon(pageSize,itemsPerPage),onClick:()=>{this.onChangeItemsPerPage(pageSize)}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.itemsGrid.itemsCountLabel",defaultMessage:"{pageSize} items",values:{pageSize:pageSize}})));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween",alignItems:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopover"],{id:"customizablePagination",button:button,isOpen:this.state.isPopoverOpen,closePopover:this.closePopover,panelPaddingSize:"none"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiContextMenuPanel"],{items:items,className:"ml-items-grid-page-size-menu"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPagination"],{pageCount:pageCount,activePage:activePage,onPageClick:this.onPageClick})))}}function ItemsGrid({numberColumns:numberColumns,totalItemCount:totalItemCount,items:items,selectedItems:selectedItems,itemsPerPage:itemsPerPage,itemsPerPageOptions:itemsPerPageOptions,setItemsPerPage:setItemsPerPage,setItemSelected:setItemSelected,activePage:activePage,setActivePage:setActivePage}){if(items===undefined||items.length===0){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceAround"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement("h4",null,totalItemCount===0?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.itemsGrid.noItemsAddedTitle",defaultMessage:"No items have been added"}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.itemsGrid.noMatchingItemsTitle",defaultMessage:"No matching items"})))))}const startIndex=activePage*itemsPerPage;const pageItems=items.slice(startIndex,startIndex+itemsPerPage);const gridItems=pageItems.map((item,index)=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{key:`ml_grid_item_${index}`,"data-test-subj":`mlGridItem ${item}`},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCheckbox"],{id:`ml_grid_item_${index}`,label:item,checked:selectedItems.indexOf(item)>=0,onChange:e=>{setItemSelected(item,e.target.checked)},"data-test-subj":`mlGridItemCheckbox`})));return external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGrid"],{columns:numberColumns,className:"eui-textBreakWord",gutterSize:"m"},gridItems),external_kbnSharedDeps_React_default.a.createElement(items_grid_pagination_ItemsGridPagination,{itemCount:items.length,itemsPerPage:itemsPerPage,itemsPerPageOptions:itemsPerPageOptions,setItemsPerPage:setItemsPerPage,activePage:activePage,setActivePage:setActivePage}))}ItemsGrid.defaultProps={numberColumns:4,itemsPerPage:50,itemsPerPageOptions:[50,100,500,1e3]};function isValidFilterListId(id){return id!==undefined&&id.length>0&&Object(job_utils["i"])(id)}function saveFilterList(filterId,description,items,loadedFilterList){return new Promise((resolve,reject)=>{if(loadedFilterList===undefined||loadedFilterList.filter_id===undefined){addFilterList(filterId,description,items).then(newFilter=>{resolve(newFilter)}).catch(error=>{reject(error)})}else{updateFilterList(loadedFilterList,description,items).then(updatedFilter=>{resolve(updatedFilter)}).catch(error=>{reject(error)})}})}function addFilterList(filterId,description,items){const filterWithIdExistsErrorMessage=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.settings.filterLists.filterWithIdExistsErrorMessage",{defaultMessage:"A filter with id {filterId} already exists",values:{filterId:filterId}});return new Promise((resolve,reject)=>{ml_api_service["ml"].filters.filtersStats().then(filterLists=>{const savedFilterIds=filterLists.map(filterList=>filterList.filter_id);if(savedFilterIds.indexOf(filterId)===-1){ml_api_service["ml"].filters.addFilter(filterId,description,items).then(newFilter=>{resolve(newFilter)}).catch(error=>{reject(error)})}else{const toastNotifications=Object(dependency_cache["j"])();toastNotifications.addDanger(filterWithIdExistsErrorMessage);reject(new Error(filterWithIdExistsErrorMessage))}}).catch(error=>{reject(error)})})}function updateFilterList(loadedFilterList,description,items){return new Promise((resolve,reject)=>{const loadedItems=loadedFilterList.items;const addItems=items.filter(item=>loadedItems.includes(item)===false);const removeItems=loadedItems.filter(item=>items.includes(item)===false);ml_api_service["ml"].filters.updateFilter(loadedFilterList.filter_id,description,addItems,removeItems).then(updatedFilter=>{resolve(updatedFilter)}).catch(error=>{reject(error)})})}function edit_filter_list_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const DEFAULT_ITEMS_PER_PAGE=50;function getMatchingFilterItems(searchBarQuery,items){if(items===undefined){return[]}if(searchBarQuery===undefined){return[...items]}const allItems=items.map(item=>({value:item}));const matchingObjects=external_kbnSharedDeps_ElasticEui_["EuiSearchBar"].Query.execute(searchBarQuery,allItems,{defaultFields:["value"]});return matchingObjects.map(item=>item.value)}function getActivePage(activePageState,itemsPerPage,numMatchingItems){let activePage=activePageState;const activePageStartIndex=itemsPerPage*activePageState;if(activePageStartIndex>numMatchingItems){activePage=Math.max(Math.ceil(numMatchingItems/itemsPerPage)-1,0)}return activePage}class edit_filter_list_EditFilterListUI extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);edit_filter_list_defineProperty(this,"returnToFiltersList",async()=>{const{services:{http:{basePath:basePath},application:{navigateToUrl:navigateToUrl}}}=this.props.kibana;await navigateToUrl(`${basePath.get()}/app/ml/${ml_url_generator["b"].FILTER_LISTS_MANAGE}`,true)});edit_filter_list_defineProperty(this,"loadFilterList",filterId=>{ml_api_service["ml"].filters.filters({filterId:filterId}).then(filter=>{this.setLoadedFilterState(filter)}).catch(resp=>{console.log(`Error loading filter ${filterId}:`,resp);const{toasts:toasts}=this.props.kibana.services.notifications;toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.settings.filterLists.editFilterList.loadingDetailsOfFilterErrorMessage",{defaultMessage:"An error occurred loading details of filter {filterId}",values:{filterId:filterId}}))})});edit_filter_list_defineProperty(this,"setLoadedFilterState",loadedFilter=>{this.setState(prevState=>{const{itemsPerPage:itemsPerPage,searchQuery:searchQuery}=prevState;const matchingItems=getMatchingFilterItems(searchQuery,loadedFilter.items);const activePage=getActivePage(prevState.activePage,itemsPerPage,matchingItems.length);return{description:loadedFilter.description,items:loadedFilter.items!==undefined?[...loadedFilter.items]:[],matchingItems:matchingItems,selectedItems:[],loadedFilter:loadedFilter,isNewFilterIdInvalid:false,activePage:activePage,searchQuery:searchQuery,saveInProgress:false}})});edit_filter_list_defineProperty(this,"updateNewFilterId",newFilterId=>{this.setState({newFilterId:newFilterId,isNewFilterIdInvalid:!isValidFilterListId(newFilterId)})});edit_filter_list_defineProperty(this,"updateDescription",description=>{this.setState({description:description})});edit_filter_list_defineProperty(this,"addItems",itemsToAdd=>{this.setState(prevState=>{const{itemsPerPage:itemsPerPage,searchQuery:searchQuery}=prevState;const items=[...prevState.items];const alreadyInFilter=[];itemsToAdd.forEach(item=>{if(items.indexOf(item)===-1){items.push(item)}else{alreadyInFilter.push(item)}});items.sort((str1,str2)=>str1.localeCompare(str2));if(alreadyInFilter.length>0){const{toasts:toasts}=this.props.kibana.services.notifications;toasts.addWarning(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.settings.filterLists.editFilterList.duplicatedItemsInFilterListWarningMessage",{defaultMessage:"The following items were already in the filter list: {alreadyInFilter}",values:{alreadyInFilter:alreadyInFilter}}))}const matchingItems=getMatchingFilterItems(searchQuery,items);const activePage=getActivePage(prevState.activePage,itemsPerPage,matchingItems.length);return{items:items,matchingItems:matchingItems,activePage:activePage,searchQuery:searchQuery}})});edit_filter_list_defineProperty(this,"deleteSelectedItems",()=>{this.setState(prevState=>{const{selectedItems:selectedItems,itemsPerPage:itemsPerPage,searchQuery:searchQuery}=prevState;const items=[...prevState.items];selectedItems.forEach(item=>{const index=items.indexOf(item);if(index!==-1){items.splice(index,1)}});const matchingItems=getMatchingFilterItems(searchQuery,items);const activePage=getActivePage(prevState.activePage,itemsPerPage,matchingItems.length);return{items:items,matchingItems:matchingItems,selectedItems:[],activePage:activePage,searchQuery:searchQuery}})});edit_filter_list_defineProperty(this,"onSearchChange",({query:query})=>{this.setState(prevState=>{const{items:items,itemsPerPage:itemsPerPage}=prevState;const matchingItems=getMatchingFilterItems(query,items);const activePage=getActivePage(prevState.activePage,itemsPerPage,matchingItems.length);return{matchingItems:matchingItems,activePage:activePage,searchQuery:query}})});edit_filter_list_defineProperty(this,"setItemSelected",(item,isSelected)=>{this.setState(prevState=>{const selectedItems=[...prevState.selectedItems];const index=selectedItems.indexOf(item);if(isSelected===true&&index===-1){selectedItems.push(item)}else if(isSelected===false&&index!==-1){selectedItems.splice(index,1)}return{selectedItems:selectedItems}})});edit_filter_list_defineProperty(this,"setActivePage",activePage=>{this.setState({activePage:activePage})});edit_filter_list_defineProperty(this,"setItemsPerPage",itemsPerPage=>{this.setState({itemsPerPage:itemsPerPage,activePage:0})});edit_filter_list_defineProperty(this,"save",()=>{this.setState({saveInProgress:true});const{loadedFilter:loadedFilter,newFilterId:newFilterId,description:description,items:items}=this.state;const filterId=this.props.filterId!==undefined?this.props.filterId:newFilterId;saveFilterList(filterId,description,items,loadedFilter).then(savedFilter=>{this.setLoadedFilterState(savedFilter);this.returnToFiltersList()}).catch(resp=>{console.log(`Error saving filter ${filterId}:`,resp);const{toasts:toasts}=this.props.kibana.services.notifications;toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.settings.filterLists.editFilterList.savingFilterErrorMessage",{defaultMessage:"An error occurred saving filter {filterId}",values:{filterId:filterId}}));this.setState({saveInProgress:false})})});this.state={description:"",items:[],matchingItems:[],selectedItems:[],loadedFilter:{},newFilterId:"",isNewFilterIdInvalid:true,activePage:0,itemsPerPage:DEFAULT_ITEMS_PER_PAGE,saveInProgress:false}}componentDidMount(){const filterId=this.props.filterId;if(filterId!==undefined){this.loadFilterList(filterId)}else{this.setState({newFilterId:""})}}render(){const{loadedFilter:loadedFilter,newFilterId:newFilterId,isNewFilterIdInvalid:isNewFilterIdInvalid,description:description,items:items,matchingItems:matchingItems,selectedItems:selectedItems,itemsPerPage:itemsPerPage,activePage:activePage,saveInProgress:saveInProgress}=this.state;const{canCreateFilter:canCreateFilter,canDeleteFilter:canDeleteFilter}=this.props;const totalItemCount=items!==undefined?items.length:0;const helpLink=Object(dependency_cache["b"])().links.ml.customRules;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(navigation_menu["a"],{tabId:"settings"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPage"],{className:"ml-edit-filter-lists","data-test-subj":"mlPageFilterListEdit"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageContent"],{className:"ml-edit-filter-lists-content",verticalPosition:"center",horizontalPosition:"center"},external_kbnSharedDeps_React_default.a.createElement(EditFilterListHeader,{canCreateFilter:canCreateFilter,filterId:this.props.filterId,newFilterId:newFilterId,isNewFilterIdInvalid:isNewFilterIdInvalid,updateNewFilterId:this.updateNewFilterId,description:description,updateDescription:this.updateDescription,totalItemCount:totalItemCount,usedBy:loadedFilter.used_by}),external_kbnSharedDeps_React_default.a.createElement(EditFilterListToolbar,{canCreateFilter:canCreateFilter,canDeleteFilter:canDeleteFilter,onSearchChange:this.onSearchChange,addItems:this.addItems,deleteSelectedItems:this.deleteSelectedItems,selectedItemCount:selectedItems.length}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xl"}),external_kbnSharedDeps_React_default.a.createElement(ItemsGrid,{totalItemCount:totalItemCount,items:matchingItems,selectedItems:selectedItems,itemsPerPage:itemsPerPage,setItemsPerPage:this.setItemsPerPage,setItemSelected:this.setItemSelected,activePage:activePage,setActivePage:this.setActivePage}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"flexEnd"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{"data-test-subj":"mlFilterListCancelButton",onClick:()=>this.returnToFiltersList()},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.filterLists.editFilterList.cancelButtonLabel",defaultMessage:"Cancel"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:this.save,disabled:saveInProgress===true||isNewFilterIdInvalid===true||canCreateFilter===false,fill:true,"data-test-subj":"mlFilterListSaveButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.filterLists.editFilterList.saveButtonLabel",defaultMessage:"Save"}))))))),external_kbnSharedDeps_React_default.a.createElement(help_menu["a"],{docLink:helpLink}))}}edit_filter_list_defineProperty(edit_filter_list_EditFilterListUI,"displayName","EditFilterList");const EditFilterList=Object(kibanaReact_public_["withKibana"])(edit_filter_list_EditFilterListUI);function FilterListsHeaderUI({totalCount:totalCount,refreshFilterLists:refreshFilterLists,kibana:kibana}){const docsUrl=kibana.services.docLinks.links.ml.customRules;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween",alignItems:"baseline"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"baseline",gutterSize:"m",responsive:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],null,external_kbnSharedDeps_React_default.a.createElement("h1",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.filterLists.listHeader.filterListsTitle",defaultMessage:"Filter Lists"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTextColor"],{color:"subdued"},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.filterLists.listHeader.filterListsDescription",defaultMessage:"{totalCount} in total",values:{totalCount:totalCount}})))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"baseline",gutterSize:"m",responsive:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{size:"s",iconType:"refresh",onClick:()=>refreshFilterLists(),"data-test-subj":"mlFilterListRefreshButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.filterLists.listHeader.refreshButtonLabel",defaultMessage:"Refresh"})))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTextColor"],{color:"subdued"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.filterLists.listHeader.filterListsContainsNotAllowedValuesDescription",defaultMessage:"Filter lists contain values that you can use to include or exclude events from the machine learning analysis.\nYou can use the same filter list in multiple jobs.{br}{learnMoreLink}",values:{br:external_kbnSharedDeps_React_default.a.createElement("br",null),learnMoreLink:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{href:docsUrl,target:"_blank"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.filterLists.listHeader.filterListsContainsNotAllowedValuesDescription.learnMoreLinkText",defaultMessage:"Learn more"}))}})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}))}const FilterListsHeader=Object(kibanaReact_public_["withKibana"])(FilterListsHeaderUI);async function deleteFilterLists(filterListsToDelete){if(filterListsToDelete===undefined||filterListsToDelete.length===0){return}const toastNotifications=Object(dependency_cache["j"])();toastNotifications.add(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.settings.filterLists.deleteFilterLists.deletingNotificationMessage",{defaultMessage:"Deleting {filterListsToDeleteLength, plural, one {{filterListToDeleteId}} other {# filter lists}}",values:{filterListsToDeleteLength:filterListsToDelete.length,filterListToDeleteId:!!filterListsToDelete.length&&filterListsToDelete[0].filter_id}}));for(const filterList of filterListsToDelete){const filterId=filterList.filter_id;try{await ml_api_service["ml"].filters.deleteFilter(filterId)}catch(resp){console.log("Error deleting filter list:",resp);toastNotifications.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.settings.filterLists.deleteFilterLists.deletingErrorMessage",{defaultMessage:"An error occurred deleting filter list {filterListId}{respMessage}",values:{filterListId:filterList.filter_id,respMessage:resp.message?` : ${resp.message}`:""}}))}}toastNotifications.addSuccess(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.settings.filterLists.deleteFilterLists.filtersSuccessfullyDeletedNotificationMessage",{defaultMessage:"{filterListsToDeleteLength, plural, one {{filterListToDeleteId}} other {# filter lists}} deleted",values:{filterListsToDeleteLength:filterListsToDelete.length,filterListToDeleteId:!!filterListsToDelete.length&&filterListsToDelete[0].filter_id}}))}function delete_filter_list_modal_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class delete_filter_list_modal_DeleteFilterListModal extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);delete_filter_list_modal_defineProperty(this,"closeModal",()=>{this.setState({isModalVisible:false})});delete_filter_list_modal_defineProperty(this,"showModal",()=>{this.setState({isModalVisible:true})});delete_filter_list_modal_defineProperty(this,"onConfirmDelete",()=>{this.doDelete()});this.state={isModalVisible:false}}async doDelete(){const{selectedFilterLists:selectedFilterLists,refreshFilterLists:refreshFilterLists}=this.props;await deleteFilterLists(selectedFilterLists);refreshFilterLists();this.closeModal()}render(){const{selectedFilterLists:selectedFilterLists,canDeleteFilter:canDeleteFilter}=this.props;let modal;if(this.state.isModalVisible){const title=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.filterLists.deleteFilterListModal.modalTitle",defaultMessage:"Delete {selectedFilterListsLength, plural, one {{selectedFilterId}} other {# filter lists}}?",values:{selectedFilterListsLength:selectedFilterLists.length,selectedFilterId:!!selectedFilterLists.length&&selectedFilterLists[0].filter_id}});modal=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiConfirmModal"],{title:title,className:"eui-textBreakWord",onCancel:this.closeModal,onConfirm:this.onConfirmDelete,cancelButtonText:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.filterLists.deleteFilterListModal.cancelButtonLabel",defaultMessage:"Cancel"}),confirmButtonText:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.filterLists.deleteFilterListModal.confirmButtonLabel",defaultMessage:"Delete"}),buttonColor:"danger",defaultFocusedButton:external_kbnSharedDeps_ElasticEui_["EUI_MODAL_CONFIRM_BUTTON"],"data-test-subj":"mlFilterListDeleteConfirmation"})}return external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{key:"delete_filter_list",iconType:"trash",color:"danger",onClick:this.showModal,isDisabled:selectedFilterLists===undefined||selectedFilterLists.length===0||canDeleteFilter===false,"data-test-subj":"mlFilterListsDeleteButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.filterLists.deleteFilterListModal.deleteButtonLabel",defaultMessage:"Delete"})),modal)}}delete_filter_list_modal_defineProperty(delete_filter_list_modal_DeleteFilterListModal,"displayName","DeleteFilterListModal");function UsedByIcon({usedBy:usedBy}){let icon;if(usedBy!==undefined&&usedBy.jobs.length>0){icon=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:"check","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.settings.filterLists.table.inUseAriaLabel",{defaultMessage:"In use"}),"data-test-subj":"mlFilterListUsedByIcon inUse"})}else{icon=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:"cross","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.settings.filterLists.table.notInUseAriaLabel",{defaultMessage:"Not in use"}),"data-test-subj":"mlFilterListUsedByIcon notInUse"})}return icon}UsedByIcon.propTypes={usedBy:prop_types_default.a.object};function NewFilterButton({canCreateFilter:canCreateFilter}){const redirectToNewFilterListPage=Object(use_create_url["a"])(ml_url_generator["b"].FILTER_LISTS_NEW);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{key:"new_filter_list",onClick:redirectToNewFilterListPage,isDisabled:canCreateFilter===false,"data-test-subj":"mlFilterListsButtonCreate"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.filterLists.table.newButtonLabel",defaultMessage:"New"}))}function getColumns(){const columns=[{field:"filter_id",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.settings.filterLists.table.idColumnName",{defaultMessage:"ID"}),render:id=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ReactRouterDom_["Link"],{to:`/${ml_url_generator["b"].FILTER_LISTS_EDIT}/${id}`,"data-test-subj":"mlEditFilterListLink"},id),sortable:true,scope:"row","data-test-subj":"mlFilterListColumnId"},{field:"description",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.settings.filterLists.table.descriptionColumnName",{defaultMessage:"Description"}),sortable:true,"data-test-subj":"mlFilterListColumnDescription"},{field:"item_count",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.settings.filterLists.table.itemCountColumnName",{defaultMessage:"Item count"}),sortable:true,"data-test-subj":"mlFilterListColumnItemCount"},{field:"used_by",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.settings.filterLists.table.inUseColumnName",{defaultMessage:"In use"}),render:usedBy=>external_kbnSharedDeps_React_default.a.createElement(UsedByIcon,{usedBy:usedBy}),sortable:true,"data-test-subj":"mlFilterListColumnInUse"}];return columns}function table_renderToolsRight(canCreateFilter,canDeleteFilter,selectedFilterLists,refreshFilterLists){return[external_kbnSharedDeps_React_default.a.createElement(NewFilterButton,{key:"new_filter_list",canCreateFilter:canCreateFilter}),external_kbnSharedDeps_React_default.a.createElement(delete_filter_list_modal_DeleteFilterListModal,{canDeleteFilter:canDeleteFilter,selectedFilterLists:selectedFilterLists,refreshFilterLists:refreshFilterLists})]}function FilterListsTable({canCreateFilter:canCreateFilter,canDeleteFilter:canDeleteFilter,filterLists:filterLists,selectedFilterLists:selectedFilterLists,setSelectedFilterLists:setSelectedFilterLists,refreshFilterLists:refreshFilterLists}){const sorting={sort:{field:"filter_id",direction:"asc"}};const search={toolsRight:table_renderToolsRight(canCreateFilter,canDeleteFilter,selectedFilterLists,refreshFilterLists),box:{incremental:true},filters:[]};const tableSelection={selectable:filterList=>filterList.used_by===undefined||filterList.used_by.jobs.length===0,selectableMessage:()=>undefined,onSelectionChange:selection=>setSelectedFilterLists(selection)};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,filterLists===undefined||filterLists.length===0?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"flexEnd",justifyContent:"flexEnd"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(NewFilterButton,null))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceAround"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement("h4",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.settings.filterLists.table.noFiltersCreatedTitle",defaultMessage:"No filters have been created"})))))):external_kbnSharedDeps_React_default.a.createElement("div",{"data-test-subj":"mlFilterListTableContainer"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiInMemoryTable"],{className:"ml-filter-lists-table",items:filterLists,itemId:"filter_id",columns:getColumns(),search:search,pagination:true,sorting:sorting,selection:tableSelection,isSelectable:true,"data-test-subj":"mlFilterListsTable",rowProps:item=>({"data-test-subj":`mlFilterListRow row-${item.filter_id}`})})))}UsedByIcon.displayName="UsedByIcon";function filter_lists_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class filter_lists_FilterListsUI extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);filter_lists_defineProperty(this,"setFilterLists",filterLists=>{this.setState(prevState=>{const loadedFilterIds=filterLists.map(filterList=>filterList.filter_id);const selectedFilterLists=prevState.selectedFilterLists.filter(filterList=>loadedFilterIds.indexOf(filterList.filter_id)!==-1);return{filterLists:filterLists,selectedFilterLists:selectedFilterLists}})});filter_lists_defineProperty(this,"setSelectedFilterLists",selectedFilterLists=>{this.setState({selectedFilterLists:selectedFilterLists})});filter_lists_defineProperty(this,"refreshFilterLists",()=>{ml_api_service["ml"].filters.filtersStats().then(filterLists=>{this.setFilterLists(filterLists)}).catch(resp=>{console.log("Error loading list of filters:",resp);const{toasts:toasts}=this.props.kibana.services.notifications;toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.settings.filterLists.filterLists.loadingFilterListsErrorMessage",{defaultMessage:"An error occurred loading the filter lists"}))})});this.state={filterLists:[],selectedFilterLists:[]}}componentDidMount(){this.refreshFilterLists()}render(){const{filterLists:filterLists,selectedFilterLists:selectedFilterLists}=this.state;const{canCreateFilter:canCreateFilter,canDeleteFilter:canDeleteFilter}=this.props;const helpLink=Object(dependency_cache["b"])().links.ml.customRules;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(navigation_menu["a"],{tabId:"settings"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPage"],{className:"ml-list-filter-lists","data-test-subj":"mlPageFilterListManagement"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageContent"],{className:"ml-list-filter-lists-content",verticalPosition:"center",horizontalPosition:"center"},external_kbnSharedDeps_React_default.a.createElement(FilterListsHeader,{totalCount:filterLists.length,refreshFilterLists:this.refreshFilterLists}),external_kbnSharedDeps_React_default.a.createElement(FilterListsTable,{canCreateFilter:canCreateFilter,canDeleteFilter:canDeleteFilter,filterLists:filterLists,selectedFilterLists:selectedFilterLists,setSelectedFilterLists:this.setSelectedFilterLists,refreshFilterLists:this.refreshFilterLists})))),external_kbnSharedDeps_React_default.a.createElement(help_menu["a"],{docLink:helpLink}))}}filter_lists_defineProperty(filter_lists_FilterListsUI,"displayName","FilterLists");const FilterLists=Object(kibanaReact_public_["withKibana"])(filter_lists_FilterListsUI);function filter_list_extends(){filter_list_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return filter_list_extends.apply(this,arguments)}const filterListRouteFactory=(navigateToPath,basePath)=>({path:"/settings/filter_lists",render:(props,deps)=>external_kbnSharedDeps_React_default.a.createElement(filter_list_PageWrapper,filter_list_extends({},props,{deps:deps})),breadcrumbs:[getBreadcrumbWithUrlForApp("ML_BREADCRUMB",navigateToPath,basePath),getBreadcrumbWithUrlForApp("SETTINGS_BREADCRUMB",navigateToPath,basePath),getBreadcrumbWithUrlForApp("FILTER_LISTS_BREADCRUMB",navigateToPath,basePath)]});const filter_list_PageWrapper=({deps:deps})=>{const{redirectToMlAccessDeniedPage:redirectToMlAccessDeniedPage}=deps;const{context:context}=useResolver(undefined,undefined,deps.config,{checkFullLicense:license["b"],checkGetJobsCapabilities:()=>Object(check_capabilities["c"])(redirectToMlAccessDeniedPage),getMlNodeCount:check_ml_nodes["c"]});Object(contexts_kibana["g"])({timeRangeSelector:false,autoRefreshSelector:false});const canCreateFilter=Object(check_capabilities["e"])("canCreateFilter");const canDeleteFilter=Object(check_capabilities["e"])("canDeleteFilter");return external_kbnSharedDeps_React_default.a.createElement(PageLoader,{context:context},external_kbnSharedDeps_React_default.a.createElement(FilterLists,{canCreateFilter:canCreateFilter,canDeleteFilter:canDeleteFilter}))};function filter_list_new_edit_extends(){filter_list_new_edit_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return filter_list_new_edit_extends.apply(this,arguments)}var filter_list_new_edit_MODE;(function(MODE){MODE[MODE["NEW"]=0]="NEW";MODE[MODE["EDIT"]=1]="EDIT"})(filter_list_new_edit_MODE||(filter_list_new_edit_MODE={}));const newFilterListRouteFactory=(navigateToPath,basePath)=>({path:"/settings/filter_lists/new_filter_list",render:(props,deps)=>external_kbnSharedDeps_React_default.a.createElement(filter_list_new_edit_PageWrapper,filter_list_new_edit_extends({},props,{mode:filter_list_new_edit_MODE.NEW,deps:deps})),breadcrumbs:[getBreadcrumbWithUrlForApp("ML_BREADCRUMB",navigateToPath,basePath),getBreadcrumbWithUrlForApp("SETTINGS_BREADCRUMB",navigateToPath,basePath),getBreadcrumbWithUrlForApp("FILTER_LISTS_BREADCRUMB",navigateToPath,basePath),{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.settings.breadcrumbs.filterLists.createLabel",{defaultMessage:"Create"}),onClick:breadcrumbOnClickFactory("/settings/filter_lists/new",navigateToPath)}]});const editFilterListRouteFactory=(navigateToPath,basePath)=>({path:"/settings/filter_lists/edit_filter_list/:filterId",render:(props,deps)=>external_kbnSharedDeps_React_default.a.createElement(filter_list_new_edit_PageWrapper,filter_list_new_edit_extends({},props,{mode:filter_list_new_edit_MODE.EDIT,deps:deps})),breadcrumbs:[getBreadcrumbWithUrlForApp("ML_BREADCRUMB",navigateToPath,basePath),getBreadcrumbWithUrlForApp("SETTINGS_BREADCRUMB",navigateToPath,basePath),getBreadcrumbWithUrlForApp("FILTER_LISTS_BREADCRUMB",navigateToPath,basePath),{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.settings.breadcrumbs.filterLists.editLabel",{defaultMessage:"Edit"}),onClick:breadcrumbOnClickFactory("/settings/filter_lists/edit",navigateToPath)}]});const filter_list_new_edit_PageWrapper=({location:location,mode:mode,deps:deps})=>{let filterId;if(mode===filter_list_new_edit_MODE.EDIT){const pathMatch=location.pathname.match(/.+\/(.+)$/);filterId=pathMatch&&pathMatch.length>1?pathMatch[1]:undefined}const{redirectToMlAccessDeniedPage:redirectToMlAccessDeniedPage}=deps;const redirectToJobsManagementPage=Object(use_create_url["a"])(ml_url_generator["b"].ANOMALY_DETECTION_JOBS_MANAGE);const{context:context}=useResolver(undefined,undefined,deps.config,{checkFullLicense:license["b"],checkGetJobsCapabilities:()=>Object(check_capabilities["c"])(redirectToMlAccessDeniedPage),checkMlNodesAvailable:()=>Object(check_ml_nodes["a"])(redirectToJobsManagementPage)});Object(contexts_kibana["g"])({timeRangeSelector:false,autoRefreshSelector:false});const canCreateFilter=Object(check_capabilities["e"])("canCreateFilter");const canDeleteFilter=Object(check_capabilities["e"])("canDeleteFilter");return external_kbnSharedDeps_React_default.a.createElement(PageLoader,{context:context},external_kbnSharedDeps_React_default.a.createElement(EditFilterList,{filterId:filterId,canCreateFilter:canCreateFilter,canDeleteFilter:canDeleteFilter}))};var analytics_management_page=__webpack_require__(261);function analytics_jobs_list_extends(){analytics_jobs_list_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return analytics_jobs_list_extends.apply(this,arguments)}const analyticsJobsListRouteFactory=(navigateToPath,basePath)=>({path:"/data_frame_analytics",render:(props,deps)=>external_kbnSharedDeps_React_default.a.createElement(analytics_jobs_list_PageWrapper,analytics_jobs_list_extends({},props,{deps:deps})),breadcrumbs:[getBreadcrumbWithUrlForApp("ML_BREADCRUMB",navigateToPath,basePath),getBreadcrumbWithUrlForApp("DATA_FRAME_ANALYTICS_BREADCRUMB",navigateToPath,basePath),{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataFrameAnalyticsBreadcrumbs.dataFrameListLabel",{defaultMessage:"Job Management"}),href:""}]});const analytics_jobs_list_PageWrapper=({location:location,deps:deps})=>{const{context:context}=useResolver(undefined,undefined,deps.config,basicResolvers(deps));return external_kbnSharedDeps_React_default.a.createElement(PageLoader,{context:context},external_kbnSharedDeps_React_default.a.createElement(analytics_management_page["a"],null))};var common_fields=__webpack_require__(82);const useScatterplotFieldOptions=(indexPattern,includes,excludes,resultsField="")=>Object(external_kbnSharedDeps_React_["useMemo"])(()=>{const fields=[];if(indexPattern===undefined||includes===undefined){return fields}if(includes.length>1){fields.push(...includes.filter(d=>indexPattern.fields.some(f=>f.name===d&&f.type==="number")))}else{fields.push(...indexPattern.fields.filter(f=>f.type==="number"&&!indexPattern.metaFields.includes(f.name)&&!f.name.startsWith(`${resultsField}.`)&&f.name!==common_fields["i"]).map(f=>f.name))}return Array.isArray(excludes)&&excludes.length>0?fields.filter(f=>!excludes.includes(f)):fields},[indexPattern,includes,excludes]);var common=__webpack_require__(13);var util_string_utils=__webpack_require__(8);var data_grid=__webpack_require__(109);const VegaChartLoading=()=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{textAlign:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLoadingSpinner"],{size:"l"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}));const VegaChartView=external_kbnSharedDeps_React_default.a.lazy(()=>__webpack_require__.e(11).then(__webpack_require__.bind(null,838)));const VegaChart=props=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Suspense"],{fallback:external_kbnSharedDeps_React_default.a.createElement(VegaChartLoading,null)},external_kbnSharedDeps_React_default.a.createElement(VegaChartView,props));var vega_chart_common=__webpack_require__(224);const OUTLIER_SCORE_FIELD="outlier_score";const SCATTERPLOT_SIZE=125;const DEFAULT_COLOR=Object(external_kbnSharedDeps_ElasticEui_["euiPaletteColorBlind"])()[0];const COLOR_OUTLIER=Object(external_kbnSharedDeps_ElasticEui_["euiPaletteNegative"])(2)[1];const COLOR_RANGE_NOMINAL=Object(external_kbnSharedDeps_ElasticEui_["euiPaletteColorBlind"])({rotations:2});const COLOR_RANGE_QUANTITATIVE=Object(external_kbnSharedDeps_ElasticEui_["euiPalettePositive"])(5);const getColorSpec=(euiTheme,escapedOutlierScoreField,color,legendType)=>{if(typeof escapedOutlierScoreField==="string"){return{condition:{value:COLOR_OUTLIER,test:`(datum['${escapedOutlierScoreField}'] >= mlOutlierScoreThreshold.cutoff)`},value:euiTheme.euiColorMediumShade}}if(color!==undefined&&legendType!==undefined){return{field:getEscapedVegaFieldName(color),type:legendType,scale:{range:legendType===vega_chart_common["a"].NOMINAL?COLOR_RANGE_NOMINAL:COLOR_RANGE_QUANTITATIVE}}}return{value:DEFAULT_COLOR}};function getEscapedVegaFieldName(fieldName){return fieldName.replace(/\./g,"․")}function getEscapedVegaValues(values){return values.map(d=>Object.keys(d).reduce((p,c)=>({...p,[getEscapedVegaFieldName(c)]:d[c]}),{}))}const getScatterplotMatrixVegaLiteSpec=(values,columns,euiTheme,resultsField,color,legendType,dynamicSize)=>{const vegaValues=getEscapedVegaValues(values);const vegaColumns=columns.map(getEscapedVegaFieldName);const outliers=resultsField!==undefined;const escapedOutlierScoreField=`${resultsField}․${OUTLIER_SCORE_FIELD}`;const colorSpec=getColorSpec(euiTheme,resultsField&&escapedOutlierScoreField,color,legendType);return{$schema:"https://vega.github.io/schema/vega-lite/v4.17.0.json",background:"transparent",view:{fill:"transparent",stroke:euiTheme.euiColorLightestShade},padding:10,config:{axis:{domainColor:euiTheme.euiColorLightShade,gridColor:euiTheme.euiColorLightestShade,tickColor:euiTheme.euiColorLightestShade,labelColor:euiTheme.euiTextSubduedColor,titleColor:euiTheme.euiTextSubduedColor}},repeat:{column:vegaColumns,row:vegaColumns.slice().reverse()},spec:{data:{values:[...vegaValues]},mark:{...outliers&&dynamicSize?{type:"circle",strokeWidth:1.2,strokeOpacity:.75,fillOpacity:.1}:{type:"circle",opacity:.75,size:8}},encoding:{color:colorSpec,...dynamicSize?{stroke:colorSpec,opacity:{condition:{value:1,test:`(datum['${escapedOutlierScoreField}'] >= mlOutlierScoreThreshold.cutoff)`},value:.5}}:{},...outliers?{order:{field:escapedOutlierScoreField},size:{...!dynamicSize?{condition:{value:40,test:`(datum['${escapedOutlierScoreField}'] >= mlOutlierScoreThreshold.cutoff)`},value:8}:{type:vega_chart_common["a"].QUANTITATIVE,field:escapedOutlierScoreField,scale:{type:"linear",range:[8,200],domain:[0,1]}}}}:{},x:{type:vega_chart_common["a"].QUANTITATIVE,field:{repeat:"column"},scale:{zero:false}},y:{type:vega_chart_common["a"].QUANTITATIVE,field:{repeat:"row"},scale:{zero:false}},tooltip:[...color!==undefined?[{type:colorSpec.type,field:getEscapedVegaFieldName(color)}]:[],...vegaColumns.map(d=>({type:vega_chart_common["a"].QUANTITATIVE,field:d})),...outliers?[{type:vega_chart_common["a"].QUANTITATIVE,field:escapedOutlierScoreField,format:".3f"}]:[]]},...outliers?{selection:{mlOutlierScoreThreshold:{type:"single",fields:["cutoff"],bind:{input:"range",max:1,min:0,name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.splomSpec.outlierScoreThresholdName",{defaultMessage:"Outlier score threshold: "}),step:.01},init:{cutoff:.99}}}}:{},width:SCATTERPLOT_SIZE,height:SCATTERPLOT_SIZE}}};var scatterplot_matrix=__webpack_require__(677);const SCATTERPLOT_MATRIX_DEFAULT_FIELDS=4;const SCATTERPLOT_MATRIX_DEFAULT_FETCH_SIZE=1e3;const SCATTERPLOT_MATRIX_DEFAULT_FETCH_MIN_SIZE=1;const SCATTERPLOT_MATRIX_DEFAULT_FETCH_MAX_SIZE=1e4;const TOGGLE_ON=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.splom.toggleOn",{defaultMessage:"On"});const TOGGLE_OFF=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.splom.toggleOff",{defaultMessage:"Off"});const sampleSizeOptions=[100,1e3,1e4].map(d=>({value:d,text:""+d}));const OptionLabelWithIconTip=({label:label,tooltip:tooltip})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,label,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIconTip"],{content:tooltip,iconProps:{className:"eui-alignTop"},size:"s"}));const ScatterplotMatrix=({fields:allFields,index:index,resultsField:resultsField,color:color,legendType:legendType,searchQuery:searchQuery})=>{const{esSearch:esSearch}=Object(contexts_kibana["a"])();const[dynamicSize,setDynamicSize]=Object(external_kbnSharedDeps_React_["useState"])(false);const[fields,setFields]=Object(external_kbnSharedDeps_React_["useState"])([]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const defaultFields=allFields.length>SCATTERPLOT_MATRIX_DEFAULT_FIELDS?allFields.slice(0,SCATTERPLOT_MATRIX_DEFAULT_FIELDS):allFields;setFields(defaultFields)},[allFields]);const[fetchSize,setFetchSize]=Object(external_kbnSharedDeps_React_["useState"])(SCATTERPLOT_MATRIX_DEFAULT_FETCH_SIZE);const[randomizeQuery,setRandomizeQuery]=Object(external_kbnSharedDeps_React_["useState"])(false);const[isLoading,setIsLoading]=Object(external_kbnSharedDeps_React_["useState"])(false);const[splom,setSplom]=Object(external_kbnSharedDeps_React_["useState"])();const fieldOptions=Object(external_kbnSharedDeps_React_["useMemo"])(()=>allFields.map(d=>({label:d})),[allFields]);const fieldsOnChange=newFields=>{setFields(newFields.map(d=>d.label))};const fetchSizeOnChange=e=>{setFetchSize(Math.min(Math.max(parseInt(e.target.value,10),SCATTERPLOT_MATRIX_DEFAULT_FETCH_MIN_SIZE),SCATTERPLOT_MATRIX_DEFAULT_FETCH_MAX_SIZE))};const randomizeQueryOnChange=()=>{setRandomizeQuery(!randomizeQuery)};const dynamicSizeOnChange=()=>{setDynamicSize(!dynamicSize)};const{euiTheme:euiTheme}=Object(color_range_legend["e"])();Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(fields.length===0){setSplom({columns:[],items:[],messages:[]});setIsLoading(false);return}async function fetchSplom(options){setIsLoading(true);const messages=[];try{const outlierScoreField=`${resultsField}.${OUTLIER_SCORE_FIELD}`;const includeOutlierScoreField=resultsField!==undefined;const queryFields=[...fields,...color!==undefined?[color]:[],...includeOutlierScoreField?[outlierScoreField]:[]];const query=randomizeQuery?{function_score:{query:searchQuery,random_score:{seed:10,field:"_seq_no"}}}:searchQuery;const resp=await esSearch({index:index,body:{fields:queryFields,_source:false,query:query,from:0,size:fetchSize}});if(!options.didCancel){const items=resp.hits.hits.map(d=>Object(data_grid["m"])(d.fields,key=>key.startsWith(`${resultsField}.feature_importance`))).filter(d=>!Object.keys(d).some(field=>Array.isArray(d[field])));const originalDocsCount=resp.hits.hits.length;const filteredDocsCount=originalDocsCount-items.length;if(originalDocsCount===filteredDocsCount){messages.push(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.splom.allDocsFilteredWarningMessage",{defaultMessage:"All fetched documents included fields with arrays of values and cannot be visualized."}))}else if(resp.hits.hits.length!==items.length){messages.push(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.splom.arrayFieldsWarningMessage",{defaultMessage:"{filteredDocsCount} out of {originalDocsCount} fetched documents include fields with arrays of values and cannot be visualized.",values:{originalDocsCount:originalDocsCount,filteredDocsCount:filteredDocsCount}}))}setSplom({columns:fields,items:items,messages:messages});setIsLoading(false)}}catch(e){setIsLoading(false);setSplom({columns:[],items:[],messages:[Object(common["extractErrorMessage"])(e)]})}}const options={didCancel:false};fetchSplom(options);return()=>{options.didCancel=true}},[fetchSize,JSON.stringify({fields:fields,searchQuery:searchQuery}),index,randomizeQuery,resultsField]);const vegaSpec=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{if(splom===undefined){return}const{items:items,columns:columns}=splom;return getScatterplotMatrixVegaLiteSpec(items,columns,euiTheme,resultsField,color,legendType,dynamicSize)},[resultsField,splom,color,legendType,dynamicSize]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,splom===undefined||vegaSpec===undefined?external_kbnSharedDeps_React_default.a.createElement(VegaChartLoading,null):external_kbnSharedDeps_React_default.a.createElement("div",{"data-test-subj":`mlScatterplotMatrix ${isLoading?"loading":"loaded"}`},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(OptionLabelWithIconTip,{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.splom.fieldSelectionLabel",{defaultMessage:"Fields"}),tooltip:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.splom.fieldSelectionInfoTooltip",{defaultMessage:"Pick fields to explore their relationships."})}),display:"rowCompressed",fullWidth:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{compressed:true,fullWidth:true,placeholder:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.splom.fieldSelectionPlaceholder",{defaultMessage:"Select fields"}),options:fieldOptions,selectedOptions:fields.map(d=>({label:d})),onChange:fieldsOnChange,isClearable:true,"data-test-subj":"mlScatterplotMatrixFieldsComboBox"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{style:{width:"200px"},grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(OptionLabelWithIconTip,{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.splom.sampleSizeLabel",{defaultMessage:"Sample size"}),tooltip:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.splom.sampleSizeInfoTooltip",{defaultMessage:"Amount of documents to display in the scatterplot matrix."})}),display:"rowCompressed",fullWidth:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{"data-test-subj":"mlScatterplotMatrixSampleSizeSelect",compressed:true,options:sampleSizeOptions,value:fetchSize,onChange:fetchSizeOnChange}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{style:{width:"120px"},grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(OptionLabelWithIconTip,{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.splom.randomScoringLabel",{defaultMessage:"Random scoring"}),tooltip:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.splom.randomScoringInfoTooltip",{defaultMessage:"Uses a function score query to get randomly selected documents as the sample."})}),display:"rowCompressed",fullWidth:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{"data-test-subj":"mlScatterplotMatrixRandomizeQuerySwitch",name:"mlScatterplotMatrixRandomizeQuery",label:randomizeQuery?TOGGLE_ON:TOGGLE_OFF,checked:randomizeQuery,onChange:randomizeQueryOnChange,disabled:isLoading}))),resultsField!==undefined&&legendType===undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{style:{width:"120px"},grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(OptionLabelWithIconTip,{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.splom.dynamicSizeLabel",{defaultMessage:"Dynamic size"}),tooltip:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.splom.dynamicSizeInfoTooltip",{defaultMessage:"Scales the size of each point by its outlier score."})}),display:"rowCompressed",fullWidth:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{name:"mlScatterplotMatrixDynamicSize",label:dynamicSize?TOGGLE_ON:TOGGLE_OFF,checked:dynamicSize,onChange:dynamicSizeOnChange,disabled:isLoading})))),splom.messages.length>0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{color:"warning"},splom.messages.map(m=>external_kbnSharedDeps_React_default.a.createElement("span",{key:Object(util_string_utils["c"])(m)},m,external_kbnSharedDeps_React_default.a.createElement("br",null))))),splom.items.length>0&&external_kbnSharedDeps_React_default.a.createElement(VegaChart,{vegaSpec:vegaSpec})))};var data_frame_analytics_common=__webpack_require__(66);var constants=__webpack_require__(140);var expandable_section=__webpack_require__(358);function getDefaultExplorationPageUrlState(overrides){return{queryText:"",queryLanguage:constants_search["c"].KUERY,pageIndex:0,pageSize:25,analysis:false,evaluation:true,feature_importance:true,results:true,splom:true,...Object(object_utils["a"])(overrides)?overrides:{}}}function useExplorationUrlState(overrides){return Object(url_state["b"])(ml_url_generator["b"].DATA_FRAME_ANALYTICS_EXPLORATION,getDefaultExplorationPageUrlState(overrides))}const isHeaderItems=arg=>Array.isArray(arg);const HEADER_ITEMS_LOADING="header_items_loading";const ExpandableSection=({headerItems:headerItems,content:content,isExpanded:isExpandedDefault,contentPadding:contentPadding=false,dataTestId:dataTestId,title:title,docsLink:docsLink,urlStateKey:urlStateKey})=>{const overrides=Object(external_kbnSharedDeps_React_["useMemo"])(()=>isExpandedDefault!==undefined?{[urlStateKey]:isExpandedDefault}:undefined,[urlStateKey,isExpandedDefault]);const[pageUrlState,setPageUrlState]=useExplorationUrlState(overrides);const isExpanded=isExpandedDefault!==undefined&&pageUrlState[urlStateKey]===getDefaultExplorationPageUrlState(overrides)[urlStateKey]?isExpandedDefault:pageUrlState[urlStateKey];const toggleExpanded=Object(external_kbnSharedDeps_React_["useCallback"])(()=>{setPageUrlState({[urlStateKey]:!isExpanded})},[isExpanded,setPageUrlState,urlStateKey]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],{paddingSize:"none","data-test-subj":`mlDFExpandableSection-${dataTestId}`},external_kbnSharedDeps_React_default.a.createElement("div",{className:"mlExpandableSection"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween",gutterSize:"none"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:toggleExpanded,iconType:isExpanded?"arrowUp":"arrowDown",size:"l",iconSide:"right",flush:"left"},title)),docsLink!==undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},docsLink)),headerItems===HEADER_ITEMS_LOADING&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLoadingContent"],{lines:1}),isHeaderItems(headerItems)&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,headerItems.map(({label:label,value:value,id:id})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,key:id,"data-test-subj":`mlDFExpandableSectionItem-${dataTestId}-${id}`},label!==undefined&&value!==undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",color:"subdued"},external_kbnSharedDeps_React_default.a.createElement("p",null,label)))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBadge"],null,value)))),label===undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",color:"subdued"},value))))),isExpanded&&external_kbnSharedDeps_React_default.a.createElement("div",{className:contentPadding?"mlExpandableSection-contentPadding":""},content))};var get_analytics=__webpack_require__(156);var analytics_list_common=__webpack_require__(88);var expanded_row=__webpack_require__(384);const getAnalyticsSectionHeaderItems=expandedRowItem=>{if(expandedRowItem===undefined){return HEADER_ITEMS_LOADING}const sourceIndex=Array.isArray(expandedRowItem.config.source.index)?expandedRowItem.config.source.index.join():expandedRowItem.config.source.index;return[{id:"analysisTypeLabel",label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.exploration.analysisTypeLabel",defaultMessage:"Type"}),value:expandedRowItem.job_type},{id:"analysisSourceIndexLabel",label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.exploration.analysisSourceIndexLabel",defaultMessage:"Source index"}),value:sourceIndex},{id:"analysisDestinationIndexLabel",label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.exploration.analysisDestinationIndexLabel",defaultMessage:"Destination index"}),value:expandedRowItem.config.dest.index}]};const ExpandableSectionAnalytics=({jobId:jobId})=>{const[expandedRowItem,setExpandedRowItem]=Object(external_kbnSharedDeps_React_["useState"])();const fetchStats=async()=>{const analyticsConfigs=await ml_api_service["ml"].dataFrameAnalytics.getDataFrameAnalytics(jobId);const analyticsStats=await ml_api_service["ml"].dataFrameAnalytics.getDataFrameAnalyticsStats(jobId);const config=analyticsConfigs.data_frame_analytics[0];const stats=Object(get_analytics["b"])(analyticsStats)?analyticsStats.data_frame_analytics[0]:undefined;if(stats===undefined){return}const newExpandedRowItem={checkpointing:{},config:config,id:config.id,job_type:Object(data_frame_analytics_common["t"])(config.analysis),mode:analytics_list_common["a"].BATCH,state:stats.state,stats:stats};setExpandedRowItem(newExpandedRowItem)};Object(external_kbnSharedDeps_React_["useEffect"])(()=>{fetchStats()},[jobId]);const analyticsSectionHeaderItems=getAnalyticsSectionHeaderItems(expandedRowItem);const analyticsSectionContent=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{size:"full",margin:"none"}),expandedRowItem===undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{textAlign:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLoadingSpinner"],{size:"l"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"})),expandedRowItem!==undefined&&external_kbnSharedDeps_React_default.a.createElement(expanded_row["a"],{item:expandedRowItem}));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(ExpandableSection,{dataTestId:"analysis",content:analyticsSectionContent,headerItems:analyticsSectionHeaderItems,urlStateKey:"analysis",title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.exploration.analysisSectionTitle",defaultMessage:"Analysis"})}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}))};var analytics_utils=__webpack_require__(92);var es_client=__webpack_require__(7);const IndexPatternPrompt=({destIndex:destIndex})=>{const{services:{http:{basePath:basePath}}}=Object(contexts_kibana["b"])();return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",color:"warning"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.indexPatternPromptMessage",defaultMessage:"No index pattern exists for index {destIndex}. {linkToIndexPatternManagement} for {destIndex}.",values:{destIndex:destIndex,linkToIndexPatternManagement:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{href:`${basePath.get()}/app/management/kibana/indexPatterns/create`,target:"_blank"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.indexPatternPromptLinkText",defaultMessage:"Create an index pattern"}))}})))};function expandable_section_results_extends(){expandable_section_results_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return expandable_section_results_extends.apply(this,arguments)}const showingDocs=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.explorationResults.documentsShownHelpText",{defaultMessage:"Showing documents for which predictions exist"});const showingFirstDocs=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.explorationResults.firstDocumentsShownHelpText",{defaultMessage:"Showing first {searchSize} documents for which predictions exist",values:{searchSize:data_frame_analytics_common["p"]}});const getResultsSectionHeaderItems=(columnsWithCharts,status,tableItems,rowCount,rowCountRelation,colorRange)=>columnsWithCharts.length>0&&(tableItems.length>0||status===data_frame_analytics_common["i"].LOADED)?[{id:"explorationTableTotalDocs",label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.exploration.explorationTableTotalDocsLabel",defaultMessage:"Total docs"}),value:`${rowCountRelation===es_client["a"].GTE?">":""}${rowCount}`},...colorRange!==undefined?[{id:"colorRangeLegend",value:external_kbnSharedDeps_React_default.a.createElement(color_range_legend["c"],{colorRange:colorRange,title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.exploration.colorRangeLegendTitle",{defaultMessage:"Feature influence score"})})}]:[]]:HEADER_ITEMS_LOADING;const ExpandableSectionResults=({colorRange:colorRange,indexData:indexData,indexPattern:indexPattern,jobConfig:jobConfig,needsDestIndexPattern:needsDestIndexPattern,searchQuery:searchQuery})=>{const{columnsWithCharts:columnsWithCharts,status:status,tableItems:tableItems}=indexData;const resultsSectionHeaderItems=getResultsSectionHeaderItems(columnsWithCharts,status,tableItems,indexData.rowCount,indexData.rowCountRelation,colorRange);const analysisType=jobConfig&&jobConfig.analysis?Object(data_frame_analytics_common["t"])(jobConfig.analysis):undefined;const resultsSectionContent=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,jobConfig!==undefined&&needsDestIndexPattern&&external_kbnSharedDeps_React_default.a.createElement("div",{className:"mlExpandableSection-contentPadding"},external_kbnSharedDeps_React_default.a.createElement(IndexPatternPrompt,{destIndex:jobConfig.dest.index})),jobConfig!==undefined&&(Object(analytics_utils["h"])(jobConfig.analysis)||Object(analytics_utils["f"])(jobConfig.analysis))&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",color:"subdued",className:"mlExpandableSection-contentPadding"},tableItems.length===data_frame_analytics_common["p"]?showingFirstDocs:showingDocs),(columnsWithCharts.length>0||searchQuery!==data_frame_analytics_common["s"])&&indexPattern!==undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,columnsWithCharts.length>0&&(tableItems.length>0||status===data_frame_analytics_common["i"].LOADED)&&external_kbnSharedDeps_React_default.a.createElement(data_grid["a"],expandable_section_results_extends({},indexData,{analysisType:analysisType,dataTestSubj:"mlExplorationDataGrid",toastNotifications:Object(dependency_cache["j"])()}))));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(ExpandableSection,{urlStateKey:"results",dataTestId:"results",content:resultsSectionContent,headerItems:resultsSectionHeaderItems,title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.exploration.explorationTableTitle",defaultMessage:"Results"})}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}))};const ExpandableSectionSplom=props=>{const splomSectionHeaderItems=undefined;const splomSectionContent=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{size:"full",margin:"none"}),external_kbnSharedDeps_React_default.a.createElement("div",{className:"mlExpandableSection-contentPadding"},external_kbnSharedDeps_React_default.a.createElement(ScatterplotMatrix,props)));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(ExpandableSection,{dataTestId:"splom",urlStateKey:"splom",content:splomSectionContent,headerItems:splomSectionHeaderItems,isExpanded:true,title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.exploration.splomSectionTitle",defaultMessage:"Scatterplot matrix"})}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}))};var external_kbnSharedDeps_MomentTimezone_=__webpack_require__(43);var external_kbnSharedDeps_MomentTimezone_default=__webpack_require__.n(external_kbnSharedDeps_MomentTimezone_);var anomaly_utils=__webpack_require__(6);var parse_interval=__webpack_require__(22);var explorer_constants=__webpack_require__(69);var constants_annotations=__webpack_require__(131);function createJobs(jobs){return jobs.map(job=>{const bucketSpan=Object(parse_interval["a"])(job.analysis_config.bucket_span);return{id:job.job_id,selected:false,bucketSpanSeconds:bucketSpan.asSeconds()}})}function getClearedSelectedAnomaliesState(){return{selectedCells:undefined,viewByLoadedForTimeFormatted:null,swimlaneLimit:undefined}}function getDefaultSwimlaneData(){return{fieldName:"",laneLabels:[],points:[],interval:3600}}async function loadFilteredTopInfluencers(jobIds,earliestMs,latestMs,records,influencers,noInfluencersConfigured,influencersFilterQuery){const recordInfluencersByName={};influencers.forEach(influencer=>{const fieldName=influencer.fieldName;if(recordInfluencersByName[influencer.fieldName]===undefined){recordInfluencersByName[influencer.fieldName]=[]}recordInfluencersByName[fieldName].push(influencer.fieldValue)});records.forEach(record=>{const influencersByName=record.influencers||[];influencersByName.forEach(influencer=>{const fieldName=influencer.influencer_field_name;const fieldValues=influencer.influencer_field_values;if(recordInfluencersByName[fieldName]===undefined){recordInfluencersByName[fieldName]=[]}recordInfluencersByName[fieldName].push(...fieldValues)})});const uniqValuesByName={};Object.keys(recordInfluencersByName).forEach(fieldName=>{const fieldValues=recordInfluencersByName[fieldName];uniqValuesByName[fieldName]=Object(external_kbnSharedDeps_Lodash_["uniq"])(fieldValues)});const filterInfluencers=[];Object.keys(uniqValuesByName).forEach(fieldName=>{const matchingFieldName=influencers.find(influencer=>influencer.fieldName===fieldName);if(matchingFieldName!==undefined){filterInfluencers.push(...influencers)}else{uniqValuesByName[fieldName].forEach(fieldValue=>{filterInfluencers.push({fieldName:fieldName,fieldValue:fieldValue})})}});return await loadTopInfluencers(jobIds,earliestMs,latestMs,filterInfluencers,noInfluencersConfigured,influencersFilterQuery)}function getInfluencers(selectedJobs=[]){const influencers=[];selectedJobs.forEach(selectedJob=>{const job=job_service["a"].getJob(selectedJob.id);if(job!==undefined&&job.analysis_config&&job.analysis_config.influencers){influencers.push(...job.analysis_config.influencers)}});return influencers}function getDateFormatTz(){const uiSettings=Object(dependency_cache["k"])();const tzConfig=uiSettings.get("dateFormat:tz");const dateFormatTz=tzConfig!=="Browser"?tzConfig:external_kbnSharedDeps_MomentTimezone_default.a.tz.guess();return dateFormatTz}function getFieldsByJob(){return job_service["a"].jobs.reduce((reducedFieldsByJob,job)=>{const analysisConfig=job.analysis_config;const influencers=analysisConfig.influencers||[];const fieldsForJob=(analysisConfig.detectors||[]).reduce((reducedfieldsForJob,detector)=>{if(detector.partition_field_name!==undefined){reducedfieldsForJob.push(detector.partition_field_name)}if(detector.over_field_name!==undefined){reducedfieldsForJob.push(detector.over_field_name)}if(detector.by_field_name!==undefined&&detector.over_field_name===undefined){reducedfieldsForJob.push(detector.by_field_name)}return reducedfieldsForJob},[]).concat(influencers);reducedFieldsByJob[job.job_id]=Object(external_kbnSharedDeps_Lodash_["uniq"])(fieldsForJob);reducedFieldsByJob["*"]=Object(external_kbnSharedDeps_Lodash_["union"])(reducedFieldsByJob["*"],reducedFieldsByJob[job.job_id]);return reducedFieldsByJob},{"*":[]})}function getSelectionTimeRange(selectedCells,interval,bounds){let earliestMs=bounds.min.valueOf();let latestMs=bounds.max.valueOf();if(selectedCells!==undefined&&selectedCells.times!==undefined){earliestMs=selectedCells.times[0]!==undefined?selectedCells.times[0]*1e3:bounds.min.valueOf();latestMs=bounds.max.valueOf();if(selectedCells.times[1]!==undefined){latestMs=selectedCells.times[1]*1e3-1}}return{earliestMs:earliestMs,latestMs:latestMs}}function getSelectionInfluencers(selectedCells,fieldName){if(selectedCells!==undefined&&selectedCells.type!==explorer_constants["h"].OVERALL&&selectedCells.viewByFieldName!==undefined&&selectedCells.viewByFieldName!==explorer_constants["j"]){return selectedCells.lanes.map(laneLabel=>({fieldName:fieldName,fieldValue:laneLabel}))}return[]}function getSelectionJobIds(selectedCells,selectedJobs){if(selectedCells!==undefined&&selectedCells.type!==explorer_constants["h"].OVERALL&&selectedCells.viewByFieldName!==undefined&&selectedCells.viewByFieldName===explorer_constants["j"]){return selectedCells.lanes}return selectedJobs.map(d=>d.id)}function getSwimlaneBucketInterval(selectedJobs,swimlaneContainerWidth){const timefilter=Object(dependency_cache["i"])();const bounds=timefilter.getActiveBounds();const buckets=Object(time_buckets["c"])();buckets.setInterval("auto");buckets.setBounds(bounds);const intervalSeconds=buckets.getInterval().asSeconds();const timerangeSeconds=(bounds.max.valueOf()-bounds.min.valueOf())/1e3;const numBuckets=parseInt(timerangeSeconds/intervalSeconds);const cellWidth=Math.floor(swimlaneContainerWidth/numBuckets*100)/100;if(cellWidth<8){buckets.setInterval(intervalSeconds*2+"s")}const maxBucketSpanSeconds=selectedJobs.reduce((memo,job)=>Math.max(memo,job.bucketSpanSeconds),0);if(maxBucketSpanSeconds>intervalSeconds){buckets.setInterval(maxBucketSpanSeconds+"s");buckets.setBounds(bounds)}return buckets.getInterval()}function getViewBySwimlaneOptions({currentViewBySwimlaneFieldName:currentViewBySwimlaneFieldName,filterActive:filterActive,filteredFields:filteredFields,isAndOperator:isAndOperator,selectedCells:selectedCells,selectedJobs:selectedJobs}){const selectedJobIds=selectedJobs.map(d=>d.id);const viewByOptions=Object(external_kbnSharedDeps_Lodash_["sortBy"])(Object(external_kbnSharedDeps_Lodash_["uniq"])(job_service["a"].jobs.reduce((reducedViewByOptions,job)=>{if(selectedJobIds.some(jobId=>jobId===job.job_id)){return reducedViewByOptions.concat(job.analysis_config.influencers||[])}return reducedViewByOptions},[])),fieldName=>fieldName.toLowerCase());viewByOptions.push(explorer_constants["j"]);let viewBySwimlaneOptions=viewByOptions;let viewBySwimlaneFieldName=undefined;if(viewBySwimlaneOptions.indexOf(currentViewBySwimlaneFieldName)!==-1){viewBySwimlaneFieldName=currentViewBySwimlaneFieldName}else{if(selectedJobIds.length>1){viewBySwimlaneFieldName=explorer_constants["j"]}else if(job_service["a"].jobs.length>0&&selectedJobIds.length>0){const firstSelectedJob=job_service["a"].jobs.find(job=>job.job_id===selectedJobIds[0]);const firstJobInfluencers=firstSelectedJob.analysis_config.influencers||[];firstSelectedJob.analysis_config.detectors.forEach(detector=>{if(detector.partition_field_name!==undefined&&firstJobInfluencers.indexOf(detector.partition_field_name)!==-1){viewBySwimlaneFieldName=detector.partition_field_name;return false}if(detector.over_field_name!==undefined&&firstJobInfluencers.indexOf(detector.over_field_name)!==-1){viewBySwimlaneFieldName=detector.over_field_name;return false}if(detector.by_field_name!==undefined&&detector.over_field_name===undefined&&firstJobInfluencers.indexOf(detector.by_field_name)!==-1){viewBySwimlaneFieldName=detector.by_field_name;return false}});if(viewBySwimlaneFieldName===undefined){if(firstJobInfluencers.length>0){viewBySwimlaneFieldName=firstJobInfluencers[0]}else{viewBySwimlaneFieldName=viewBySwimlaneOptions.length>0?viewBySwimlaneOptions[0]:undefined}}}}if(filterActive===true&&isAndOperator===true&&selectedCells===null){viewBySwimlaneOptions=[explorer_constants["j"]]}else if(filterActive===true&&Array.isArray(viewBySwimlaneOptions)&&Array.isArray(filteredFields)){const filteredOptions=viewBySwimlaneOptions.filter(option=>filteredFields.includes(option)||option===explorer_constants["j"]||selectedCells&&selectedCells.viewByFieldName===option);if(filteredOptions.length>1){viewBySwimlaneOptions=filteredOptions}}return{viewBySwimlaneFieldName:viewBySwimlaneFieldName,viewBySwimlaneOptions:viewBySwimlaneOptions}}function loadAnnotationsTableData(selectedCells,selectedJobs,interval,bounds){const jobIds=selectedCells!==undefined&&selectedCells.viewByFieldName===explorer_constants["j"]?selectedCells.lanes:selectedJobs.map(d=>d.id);const timeRange=getSelectionTimeRange(selectedCells,interval,bounds);return new Promise(resolve=>{ml_api_service["ml"].annotations.getAnnotations$({jobIds:jobIds,earliestMs:timeRange.earliestMs,latestMs:timeRange.latestMs,maxAnnotations:constants_search["a"],fields:[{field:"event",missing:constants_annotations["b"]}]}).toPromise().then(resp=>{if(resp.error!==undefined||resp.annotations===undefined){const errorMessage=Object(util_errors["i"])(resp.error);return resolve({annotationsData:[],aggregations:{},error:errorMessage!==""?errorMessage:undefined})}const annotationsData=[];jobIds.forEach(jobId=>{const jobAnnotations=resp.annotations[jobId];if(jobAnnotations!==undefined){annotationsData.push(...jobAnnotations)}});return resolve({annotationsData:annotationsData.sort((a,b)=>a.timestamp-b.timestamp).map((d,i)=>{d.key=(i+1).toString();return d}),aggregations:resp.aggregations})}).catch(resp=>{const errorMessage=Object(util_errors["i"])(resp);return resolve({annotationsData:[],aggregations:{},error:errorMessage!==""?errorMessage:undefined})})})}async function loadAnomaliesTableData(selectedCells,selectedJobs,dateFormatTz,interval,bounds,fieldName,tableInterval,tableSeverity,influencersFilterQuery){const jobIds=getSelectionJobIds(selectedCells,selectedJobs);const influencers=getSelectionInfluencers(selectedCells,fieldName);const timeRange=getSelectionTimeRange(selectedCells,interval,bounds);return new Promise((resolve,reject)=>{ml_api_service["ml"].results.getAnomaliesTableData(jobIds,[],influencers,tableInterval,tableSeverity,timeRange.earliestMs,timeRange.latestMs,dateFormatTz,constants_search["b"],explorer_constants["e"],influencersFilterQuery).toPromise().then(resp=>{const anomalies=resp.anomalies;const detectorsByJob=job_service["a"].detectorsByJob;anomalies.forEach(anomaly=>{const jobId=anomaly.jobId;const detector=Object(external_kbnSharedDeps_Lodash_["get"])(detectorsByJob,[jobId,anomaly.detectorIndex]);anomaly.detector=Object(external_kbnSharedDeps_Lodash_["get"])(detector,["detector_description"],anomaly.source.function_description);if(detector!==undefined&&detector.custom_rules!==undefined){anomaly.rulesLength=detector.custom_rules.length}const job=job_service["a"].getJob(jobId);let isChartable=Object(job_utils["n"])(job,anomaly.detectorIndex);if(isChartable===false&&Object(job_utils["l"])(job,anomaly.detectorIndex)){const entityFields=Object(anomaly_utils["c"])(anomaly.source);isChartable=Object(job_utils["m"])(job,anomaly.detectorIndex,entityFields)}anomaly.isTimeSeriesViewRecord=isChartable;if(job_service["a"].customUrlsByJob[jobId]!==undefined){anomaly.customUrls=job_service["a"].customUrlsByJob[jobId]}});resolve({anomalies:anomalies,interval:resp.interval,examplesByJobId:resp.examplesByJobId,showViewSeriesLink:true,jobIds:jobIds})}).catch(resp=>{console.log("Explorer - error loading data for anomalies table:",resp);reject()})})}let requestCount=0;async function loadDataForCharts(jobIds,earliestMs,latestMs,influencers=[],selectedCells,influencersFilterQuery){return new Promise(resolve=>{if(selectedCells===undefined&&influencers.length===0&&influencersFilterQuery===undefined){resolve([])}const newRequestCount=++requestCount;requestCount=newRequestCount;results_service["mlResultsService"].getRecordsForInfluencer(jobIds,influencers,0,earliestMs,latestMs,500,influencersFilterQuery).then(resp=>{if(newRequestCount<requestCount){resolve([])}if(selectedCells!==undefined&&Object.keys(selectedCells).length>0||influencersFilterQuery!==undefined){resolve(resp.records)}resolve([])})})}async function loadTopInfluencers(selectedJobIds,earliestMs,latestMs,influencers=[],noInfluencersConfigured,influencersFilterQuery){return new Promise(resolve=>{if(noInfluencersConfigured!==true){results_service["mlResultsService"].getTopInfluencers(selectedJobIds,earliestMs,latestMs,explorer_constants["f"],10,1,influencers,influencersFilterQuery).then(resp=>{resolve(resp.influencers)})}else{resolve({})}})}function escapeRegExp(string){return string.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function escapeParens(string){return string.replace(/[()]/g,"\\$&")}function escapeDoubleQuotes(string){return string.replace(/[\\"]/g,"\\$&")}function getQueryPattern(fieldName,fieldValue){const sanitizedFieldName=escapeRegExp(fieldName);const sanitizedFieldValue=escapeRegExp(fieldValue);return new RegExp(`(${sanitizedFieldName})\\s?:\\s?(")?(${sanitizedFieldValue})(")?`,"i")}function removeFilterFromQueryString(currentQueryString,fieldName,fieldValue){let newQueryString="";const queryPattern=getQueryPattern(fieldName,fieldValue);newQueryString=currentQueryString.replace(queryPattern,"");const endPattern=/\s(and|or)\s*$/gi;const startPattern=/^\s*(and|or)\s/gi;const invalidOperatorPattern=/\s+(and|or)\s+(and|or)\s+/gi;newQueryString=newQueryString.replace(invalidOperatorPattern," $1 ");newQueryString=newQueryString.replace(endPattern,"");newQueryString=newQueryString.replace(startPattern,"");return newQueryString}const ExplorationQueryBar=({indexPattern:indexPattern,setSearchQuery:setSearchQuery,filters:filters,query:query})=>{const[searchInput,setSearchInput]=Object(external_kbnSharedDeps_React_["useState"])(query);const[idToSelectedMap,setIdToSelectedMap]=Object(external_kbnSharedDeps_React_["useState"])({});const[errorMessage,setErrorMessage]=Object(external_kbnSharedDeps_React_["useState"])(undefined);const searchChangeHandler=q=>setSearchInput(q);const regex=Object(external_kbnSharedDeps_React_["useMemo"])(()=>new RegExp(`${filters===null||filters===void 0?void 0:filters.columnId}\\s*:\\s*(true|false)`,"g"),[filters===null||filters===void 0?void 0:filters.columnId]);Object(external_kbnSharedDeps_React_["useEffect"])((function updateIdToSelectedMap(){if(filters!==undefined){const match=query.query.match(regex);let filterKeyInEffect;if(match!==null&&match[0].includes("true")){filterKeyInEffect=Object.keys(filters.key).find(i=>filters.key[i]===true)}else if(match!==null&&match[0].includes("false")){filterKeyInEffect=Object.keys(filters.key).find(i=>filters.key[i]===false)}if(filterKeyInEffect){setIdToSelectedMap({[filterKeyInEffect]:true})}}}),[]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{try{let convertedQuery;switch(query.language){case constants_search["c"].KUERY:convertedQuery=data_public_["esKuery"].toElasticsearchQuery(data_public_["esKuery"].fromKueryExpression(query.query),indexPattern);break;case constants_search["c"].LUCENE:convertedQuery=data_public_["esQuery"].luceneStringToDsl(query.query);break;default:setErrorMessage({query:query.query,message:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.queryBar.queryLanguageNotSupported",{defaultMessage:"Query language is not supported"})});return}setSearchQuery({queryString:query.query,query:convertedQuery,language:query.language})}catch(e){setErrorMessage({query:query.query,message:e.message})}},[query.query]);const searchSubmitHandler=(q,filtering)=>{if(filtering===undefined){setIdToSelectedMap({})}setSearchQuery({queryString:q.query,language:q.language})};const debouncedHandleFilterUpdate=Object(external_kbnSharedDeps_Lodash_["debounce"])((optionId,currentIdToSelectedMap)=>{let newQuery="";const filterValue=filters===null||filters===void 0?void 0:filters.key[optionId];const filterQueryString=`${filters===null||filters===void 0?void 0:filters.columnId}:${filterValue}`;if(currentIdToSelectedMap[optionId]===false){newQuery=searchInput.query!==""?removeFilterFromQueryString(searchInput.query,filters===null||filters===void 0?void 0:filters.columnId,String(filterValue)):""}else if(currentIdToSelectedMap[optionId]===true){if(searchInput.query===""){newQuery=filterQueryString}else if(searchInput.query.match(regex)!==null){newQuery=searchInput.query.replace(regex,filterQueryString)}else{newQuery=`${searchInput.query} and ${filterQueryString}`}}const newSearchInput={...searchInput,query:newQuery};setSearchInput(newSearchInput);searchSubmitHandler(newSearchInput,true)},200);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiInputPopover"],{style:{maxWidth:"100%"},closePopover:()=>setErrorMessage(undefined),input:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(data_public_["QueryStringInput"],{bubbleSubmitEvent:false,query:searchInput,indexPatterns:[indexPattern],onChange:searchChangeHandler,onSubmit:searchSubmitHandler,placeholder:searchInput.language===constants_search["c"].KUERY?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.stepDefineForm.queryPlaceholderKql",{defaultMessage:"Search for e.g. {example}",values:{example:'method : "GET" or status : "404"'}}):external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.stepDefineForm.queryPlaceholderLucene",{defaultMessage:"Search for e.g. {example}",values:{example:"method:GET OR status:404"}}),disableAutoFocus:true,dataTestSubj:"transformQueryInput",languageSwitcherPopoverAnchorPosition:"rightDown"})),filters&&filters.options&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,"data-test-subj":"mlDFAnalyticsExplorationQueryBarFilterButtons"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonGroup"],{legend:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.explorationQueryBar.buttonGroupLegend",{defaultMessage:"Analytics query bar filter buttons"}),options:filters.options,type:"multi",idToSelectedMap:idToSelectedMap,onChange:optionId=>{const newIdToSelectedMap={[optionId]:!idToSelectedMap[optionId]};setIdToSelectedMap(newIdToSelectedMap);debouncedHandleFilterUpdate(optionId,newIdToSelectedMap)}}))),isOpen:(errorMessage===null||errorMessage===void 0?void 0:errorMessage.query)===searchInput.query&&(errorMessage===null||errorMessage===void 0?void 0:errorMessage.message)!==""},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCode"],null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.stepDefineForm.invalidQuery",{defaultMessage:"Invalid Query"}),": ",errorMessage===null||errorMessage===void 0?void 0:errorMessage.message.split("\n")[0]))};const getOutlierScoreFieldName=jobConfig=>`${jobConfig.dest.results_field}.${constants["c"]}`;const getFeatureCount=(resultsField,tableItems=[])=>{if(tableItems.length===0){return 0}const fullItem=tableItems[0];if(Array.isArray(fullItem[`${resultsField}.${constants["b"]}`])){return fullItem[`${resultsField}.${constants["b"]}`].length}return 0};var data_frame_analytics=__webpack_require__(74);var useUpdateEffect=__webpack_require__(694);var useUpdateEffect_default=__webpack_require__.n(useUpdateEffect);var data_grid_common=__webpack_require__(91);const useExplorationDataGrid=(columns,defaultVisibleColumnsCount=data_grid_common["b"],defaultVisibleColumnsFilter)=>{const[pageUrlState,setPageUrlState]=useExplorationUrlState();const dataGrid=Object(data_grid["q"])(columns,25,defaultVisibleColumnsCount,defaultVisibleColumnsFilter);dataGrid.pagination=Object(external_kbnSharedDeps_React_["useMemo"])(()=>({pageSize:pageUrlState.pageSize,pageIndex:pageUrlState.pageIndex}),[pageUrlState.pageSize,pageUrlState.pageIndex]);dataGrid.setPagination=Object(external_kbnSharedDeps_React_["useCallback"])(u=>{setPageUrlState({...u})},[setPageUrlState]);dataGrid.onChangePage=Object(external_kbnSharedDeps_React_["useCallback"])(pageIndex=>{setPageUrlState({pageIndex:pageIndex})},[setPageUrlState]);dataGrid.onChangeItemsPerPage=Object(external_kbnSharedDeps_React_["useCallback"])(pageSize=>{setPageUrlState({pageSize:pageSize})},[setPageUrlState]);dataGrid.resetPagination=Object(external_kbnSharedDeps_React_["useCallback"])(()=>{const a=getDefaultExplorationPageUrlState();setPageUrlState({pageSize:a.pageSize,pageIndex:a.pageIndex})},[setPageUrlState]);useUpdateEffect_default()((function resetPaginationOnQueryChange(){dataGrid.resetPagination()}),[pageUrlState.queryText]);return dataGrid};const useOutlierData=(indexPattern,jobConfig,searchQuery)=>{var _jobConfig$dest$resul;const needsDestIndexFields=indexPattern!==undefined&&indexPattern.title===(jobConfig===null||jobConfig===void 0?void 0:jobConfig.source.index[0]);const columns=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{const newColumns=[];if(jobConfig!==undefined&&indexPattern!==undefined){const resultsField=jobConfig.dest.results_field;const{fieldTypes:fieldTypes}=Object(data_frame_analytics_common["y"])(jobConfig,needsDestIndexFields);newColumns.push(...Object(data_grid["j"])(fieldTypes,resultsField).sort((a,b)=>Object(common_fields["l"])(a.id,b.id,jobConfig)))}return newColumns},[jobConfig,indexPattern]);const dataGrid=useExplorationDataGrid(columns,8,d=>!d.includes(`.${constants["b"]}.`)&&d!==common_fields["h"]&&d!==common_fields["i"]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(jobConfig!==undefined){dataGrid.setSortingColumns([{id:getOutlierScoreFieldName(jobConfig),direction:"desc"}])}},[jobConfig&&jobConfig.id]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const options={didCancel:false};Object(data_frame_analytics_common["x"])(jobConfig,dataGrid,searchQuery,options);return()=>{options.didCancel=true}},[jobConfig&&jobConfig.id,dataGrid.pagination,searchQuery,dataGrid.sortingColumns]);const dataLoader=Object(external_kbnSharedDeps_React_["useMemo"])(()=>indexPattern!==undefined?new data_loader_DataLoader(indexPattern,Object(dependency_cache["j"])()):undefined,[indexPattern]);const fetchColumnChartsData=async function(){try{if(jobConfig!==undefined&&dataLoader!==undefined){const columnChartsData=await dataLoader.loadFieldHistograms(columns.filter(cT=>dataGrid.visibleColumns.includes(cT.id)).map(cT=>({fieldName:cT.id,type:Object(data_grid["k"])(cT.schema)})),searchQuery);dataGrid.setColumnCharts(columnChartsData)}}catch(e){Object(data_grid["p"])(e,Object(dependency_cache["j"])())}};Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(dataGrid.chartsVisible){fetchColumnChartsData()}},[dataGrid.chartsVisible,jobConfig===null||jobConfig===void 0?void 0:jobConfig.dest.index,JSON.stringify([searchQuery,[...dataGrid.visibleColumns].sort()])]);const colorRange=Object(color_range_legend["d"])(color_range_legend["a"].BLUE,color_range_legend["b"].INFLUENCER,jobConfig!==undefined?getFeatureCount(jobConfig.dest.results_field,dataGrid.tableItems):1);const renderCellValue=Object(data_grid["r"])(indexPattern,dataGrid.pagination,dataGrid.tableItems,(_jobConfig$dest$resul=jobConfig===null||jobConfig===void 0?void 0:jobConfig.dest.results_field)!==null&&_jobConfig$dest$resul!==void 0?_jobConfig$dest$resul:data_frame_analytics["d"],(columnId,cellValue,fullItem,setCellProps)=>{var _jobConfig$dest$resul2;const resultsField=(_jobConfig$dest$resul2=jobConfig===null||jobConfig===void 0?void 0:jobConfig.dest.results_field)!==null&&_jobConfig$dest$resul2!==void 0?_jobConfig$dest$resul2:"";let backgroundColor;const featureNames=fullItem[`${resultsField}.${constants["b"]}`];if(Array.isArray(featureNames)){const featureForColumn=featureNames.find(feature=>columnId===feature.feature_name[0]);if(featureForColumn){backgroundColor=colorRange(featureForColumn.influence[0])}}if(backgroundColor!==undefined){setCellProps({style:{backgroundColor:String(backgroundColor)}})}});return{...dataGrid,renderCellValue:renderCellValue}};const OutlierExploration=external_kbnSharedDeps_React_default.a.memo(({jobId:jobId})=>{var _jobConfig$dest,_jobConfig$dest$resul;const{indexPattern:indexPattern,indexPatternErrorMessage:indexPatternErrorMessage,jobConfig:jobConfig,needsDestIndexPattern:needsDestIndexPattern}=Object(data_frame_analytics_common["J"])(jobId);const[pageUrlState,setPageUrlState]=useExplorationUrlState();const[searchQuery,setSearchQuery]=Object(external_kbnSharedDeps_React_["useState"])(data_frame_analytics_common["s"]);const outlierData=useOutlierData(indexPattern,jobConfig,searchQuery);const searchQueryUpdateHandler=Object(external_kbnSharedDeps_React_["useCallback"])(update=>{if(update.query){setSearchQuery(update.query)}if(update.queryString!==pageUrlState.queryText){setPageUrlState({queryText:update.queryString,queryLanguage:update.language})}},[pageUrlState,setPageUrlState]);const query={query:pageUrlState.queryText,language:pageUrlState.queryLanguage};const{columnsWithCharts:columnsWithCharts,tableItems:tableItems}=outlierData;const featureCount=getFeatureCount((jobConfig===null||jobConfig===void 0?void 0:(_jobConfig$dest=jobConfig.dest)===null||_jobConfig$dest===void 0?void 0:_jobConfig$dest.results_field)||"",tableItems);const colorRange=Object(color_range_legend["d"])(color_range_legend["a"].BLUE,color_range_legend["b"].INFLUENCER,featureCount);const showColorRange=featureCount>0&&Object(data_frame_analytics_common["D"])(jobConfig===null||jobConfig===void 0?void 0:jobConfig.analysis)&&(jobConfig===null||jobConfig===void 0?void 0:jobConfig.analysis.outlier_detection.compute_feature_influence)===true;const resultsField=(_jobConfig$dest$resul=jobConfig===null||jobConfig===void 0?void 0:jobConfig.dest.results_field)!==null&&_jobConfig$dest$resul!==void 0?_jobConfig$dest$resul:"";const showLegacyFeatureInfluenceFormatCallout=!needsDestIndexPattern&&Object(data_frame_analytics_common["D"])(jobConfig===null||jobConfig===void 0?void 0:jobConfig.analysis)&&(jobConfig===null||jobConfig===void 0?void 0:jobConfig.analysis.outlier_detection.compute_feature_influence)===true&&columnsWithCharts.findIndex(d=>d.id===`${resultsField}.${constants["b"]}`)===-1;const scatterplotFieldOptions=useScatterplotFieldOptions(indexPattern,jobConfig===null||jobConfig===void 0?void 0:jobConfig.analyzed_fields.includes,jobConfig===null||jobConfig===void 0?void 0:jobConfig.analyzed_fields.excludes,resultsField);if(indexPatternErrorMessage!==undefined){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.exploration.indexError",{defaultMessage:"An error occurred loading the index data."}),color:"danger",iconType:"cross"},external_kbnSharedDeps_React_default.a.createElement("p",null,indexPatternErrorMessage)))}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,typeof(jobConfig===null||jobConfig===void 0?void 0:jobConfig.description)!=="undefined"&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,jobConfig===null||jobConfig===void 0?void 0:jobConfig.description),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"})),(columnsWithCharts.length>0||searchQuery!==data_frame_analytics_common["s"])&&indexPattern!==undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(ExplorationQueryBar,{indexPattern:indexPattern,setSearchQuery:searchQueryUpdateHandler,query:query}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"})),typeof(jobConfig===null||jobConfig===void 0?void 0:jobConfig.id)==="string"&&external_kbnSharedDeps_React_default.a.createElement(ExpandableSectionAnalytics,{jobId:jobConfig===null||jobConfig===void 0?void 0:jobConfig.id}),typeof(jobConfig===null||jobConfig===void 0?void 0:jobConfig.id)==="string"&&scatterplotFieldOptions.length>1&&external_kbnSharedDeps_React_default.a.createElement(ExpandableSectionSplom,{fields:scatterplotFieldOptions,index:jobConfig===null||jobConfig===void 0?void 0:jobConfig.dest.index,resultsField:jobConfig===null||jobConfig===void 0?void 0:jobConfig.dest.results_field,searchQuery:searchQuery}),showLegacyFeatureInfluenceFormatCallout&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{size:"s",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.outlierExploration.legacyFeatureInfluenceFormatCalloutTitle",{defaultMessage:"Color coded table cells based on feature influence are not available because the results index uses an unsupported legacy format. Please clone and rerun the job."}),iconType:"pin"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"})),external_kbnSharedDeps_React_default.a.createElement(ExpandableSectionResults,{colorRange:showColorRange&&!showLegacyFeatureInfluenceFormatCallout?colorRange:undefined,indexData:outlierData,indexPattern:indexPattern,jobConfig:jobConfig,needsDestIndexPattern:needsDestIndexPattern,searchQuery:searchQuery}))});var analytics=__webpack_require__(62);var trained_models=__webpack_require__(225);const useExplorationResults=(indexPattern,jobConfig,searchQuery,toastNotifications,mlApiServices)=>{var _jobConfig$dest$resul;const[baseline,setBaseLine]=Object(external_kbnSharedDeps_React_["useState"])();const trainedModelsApiService=Object(trained_models["a"])();const needsDestIndexFields=indexPattern!==undefined&&indexPattern.title===(jobConfig===null||jobConfig===void 0?void 0:jobConfig.source.index[0]);const columns=[];if(jobConfig!==undefined){const resultsField=jobConfig.dest.results_field;const{fieldTypes:fieldTypes}=Object(data_frame_analytics_common["y"])(jobConfig,needsDestIndexFields);columns.push(...Object(data_grid["j"])(fieldTypes,resultsField).sort((a,b)=>Object(common_fields["l"])(a.id,b.id,jobConfig)))}const dataGrid=useExplorationDataGrid(columns,8,d=>!d.includes(`.${constants["a"]}.`)&&!d.includes(`.${constants["d"]}.`)&&d!==common_fields["h"]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const options={didCancel:false};Object(data_frame_analytics_common["x"])(jobConfig,dataGrid,searchQuery,options);return()=>{options.didCancel=true}},[jobConfig&&jobConfig.id,dataGrid.pagination,searchQuery,dataGrid.sortingColumns]);const dataLoader=Object(external_kbnSharedDeps_React_["useMemo"])(()=>indexPattern!==undefined?new data_loader_DataLoader(indexPattern,toastNotifications):undefined,[indexPattern]);const fetchColumnChartsData=async function(){try{if(jobConfig!==undefined&&dataLoader!==undefined){const columnChartsData=await dataLoader.loadFieldHistograms(columns.filter(cT=>dataGrid.visibleColumns.includes(cT.id)).map(cT=>({fieldName:cT.id,type:Object(data_grid["k"])(cT.schema)})),searchQuery);dataGrid.setColumnCharts(columnChartsData)}}catch(e){Object(data_grid["p"])(e,toastNotifications)}};Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(dataGrid.chartsVisible){fetchColumnChartsData()}},[dataGrid.chartsVisible,jobConfig===null||jobConfig===void 0?void 0:jobConfig.dest.index,JSON.stringify([searchQuery,dataGrid.visibleColumns])]);const predictionFieldName=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{if(jobConfig){var _getPredictionFieldNa;return(_getPredictionFieldNa=Object(analytics_utils["e"])(jobConfig.analysis))!==null&&_getPredictionFieldNa!==void 0?_getPredictionFieldNa:Object(analytics_utils["b"])(jobConfig.analysis)}return undefined},[jobConfig]);const getAnalyticsBaseline=Object(external_kbnSharedDeps_React_["useCallback"])(async()=>{try{if(jobConfig!==undefined&&jobConfig.analysis!==undefined&&(Object(analytics["D"])(jobConfig.analysis)||Object(analytics_utils["f"])(jobConfig.analysis))){var _inferenceModel$metad;const jobId=jobConfig.id;const inferenceModels=await trainedModelsApiService.getTrainedModels(`${jobId}*`,{include:"feature_importance_baseline"});const inferenceModel=inferenceModels.find(model=>{var _model$metadata,_model$metadata$analy;return((_model$metadata=model.metadata)===null||_model$metadata===void 0?void 0:(_model$metadata$analy=_model$metadata.analytics_config)===null||_model$metadata$analy===void 0?void 0:_model$metadata$analy.id)===jobId});if((inferenceModel===null||inferenceModel===void 0?void 0:(_inferenceModel$metad=inferenceModel.metadata)===null||_inferenceModel$metad===void 0?void 0:_inferenceModel$metad.feature_importance_baseline)!==undefined){var _inferenceModel$metad2;setBaseLine(inferenceModel===null||inferenceModel===void 0?void 0:(_inferenceModel$metad2=inferenceModel.metadata)===null||_inferenceModel$metad2===void 0?void 0:_inferenceModel$metad2.feature_importance_baseline)}}}catch(e){const error=Object(util_errors["i"])(e);toastNotifications.addDanger({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.explorationResults.baselineErrorMessageToast",{defaultMessage:"An error occurred getting feature importance baseline"}),text:error})}},[mlApiServices,jobConfig]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{getAnalyticsBaseline()},[jobConfig]);const resultsField=(_jobConfig$dest$resul=jobConfig===null||jobConfig===void 0?void 0:jobConfig.dest.results_field)!==null&&_jobConfig$dest$resul!==void 0?_jobConfig$dest$resul:data_frame_analytics["d"];const renderCellValue=Object(data_grid["r"])(indexPattern,dataGrid.pagination,dataGrid.tableItems,resultsField);return{...dataGrid,renderCellValue:renderCellValue,baseline:baseline,predictionFieldName:predictionFieldName,resultsField:resultsField}};const ExplorationResultsTable=external_kbnSharedDeps_React_default.a.memo(({indexPattern:indexPattern,jobConfig:jobConfig,needsDestIndexPattern:needsDestIndexPattern,searchQuery:searchQuery})=>{const{services:{mlServices:{mlApiServices:mlApiServices}}}=Object(contexts_kibana["b"])();const classificationData=useExplorationResults(indexPattern,jobConfig,searchQuery,Object(dependency_cache["j"])(),mlApiServices);if(jobConfig===undefined||classificationData===undefined){return null}return external_kbnSharedDeps_React_default.a.createElement("div",{"data-test-subj":"mlDFAnalyticsExplorationTablePanel"},external_kbnSharedDeps_React_default.a.createElement(ExpandableSectionResults,{indexData:classificationData,indexPattern:indexPattern,jobConfig:jobConfig,needsDestIndexPattern:needsDestIndexPattern,searchQuery:searchQuery}))});const jobConfigErrorTitle=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.jobConfig.errorTitle",{defaultMessage:"Unable to fetch results. An error occurred loading the job configuration data."});const jobCapsErrorTitle=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.jobCaps.errorTitle",{defaultMessage:"Unable to fetch results. An error occurred loading the index's field data."});const JobConfigErrorCallout=({jobCapsServiceErrorMessage:jobCapsServiceErrorMessage,jobConfigErrorMessage:jobConfigErrorMessage,title:title})=>{const{services:{application:{getUrlForApp:getUrlForApp}}}=Object(contexts_kibana["b"])();const containsIndexPatternLink=typeof jobCapsServiceErrorMessage==="string"&&jobCapsServiceErrorMessage.includes("locate that index-pattern")&&jobCapsServiceErrorMessage.includes("click here to re-create");const message=external_kbnSharedDeps_React_default.a.createElement("p",null,jobConfigErrorMessage?jobConfigErrorMessage:jobCapsServiceErrorMessage);const newIndexPatternUrl=Object(external_kbnSharedDeps_React_["useMemo"])(()=>getUrlForApp("management",{path:"kibana/indexPatterns"}),[]);const calloutBody=containsIndexPatternLink?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{href:newIndexPatternUrl,target:"_blank"},message):message;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:jobConfigErrorMessage?jobConfigErrorTitle:jobCapsErrorTitle,color:"danger",iconType:"cross"},calloutBody))};const loading_panel_LoadingPanel=()=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],{className:"eui-textCenter"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLoadingSpinner"],{size:"xl"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}));const exploration_page_wrapper_filters={options:[{id:"training",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.explorationResults.trainingSubsetLabel",{defaultMessage:"Training"})},{id:"testing",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.explorationResults.testingSubsetLabel",{defaultMessage:"Testing"})}],columnId:"ml.is_training",key:{training:true,testing:false}};const ExplorationPageWrapper=({jobId:jobId,title:title,EvaluatePanel:EvaluatePanel,FeatureImportanceSummaryPanel:FeatureImportanceSummaryPanel})=>{var _jobConfig$dest$resul;const{indexPattern:indexPattern,indexPatternErrorMessage:indexPatternErrorMessage,isInitialized:isInitialized,isLoadingJobConfig:isLoadingJobConfig,jobCapsServiceErrorMessage:jobCapsServiceErrorMessage,jobConfig:jobConfig,jobConfigErrorMessage:jobConfigErrorMessage,jobStatus:jobStatus,needsDestIndexPattern:needsDestIndexPattern,totalFeatureImportance:totalFeatureImportance}=Object(data_frame_analytics_common["J"])(jobId);const[pageUrlState,setPageUrlState]=useExplorationUrlState();const[searchQuery,setSearchQuery]=Object(external_kbnSharedDeps_React_["useState"])(data_frame_analytics_common["s"]);const searchQueryUpdateHandler=Object(external_kbnSharedDeps_React_["useCallback"])(update=>{if(update.query){setSearchQuery(update.query)}if(update.queryString!==pageUrlState.queryText){setPageUrlState({queryText:update.queryString,queryLanguage:update.language})}},[pageUrlState,setPageUrlState]);const query={query:pageUrlState.queryText,language:pageUrlState.queryLanguage};const resultsField=(_jobConfig$dest$resul=jobConfig===null||jobConfig===void 0?void 0:jobConfig.dest.results_field)!==null&&_jobConfig$dest$resul!==void 0?_jobConfig$dest$resul:"";const scatterplotFieldOptions=useScatterplotFieldOptions(indexPattern,jobConfig===null||jobConfig===void 0?void 0:jobConfig.analyzed_fields.includes,jobConfig===null||jobConfig===void 0?void 0:jobConfig.analyzed_fields.excludes,resultsField);if(indexPatternErrorMessage!==undefined){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.exploration.indexError",{defaultMessage:"An error occurred loading the index data."}),color:"danger",iconType:"cross"},external_kbnSharedDeps_React_default.a.createElement("p",null,indexPatternErrorMessage)))}if(jobConfigErrorMessage!==undefined||jobCapsServiceErrorMessage!==undefined){return external_kbnSharedDeps_React_default.a.createElement(JobConfigErrorCallout,{jobCapsServiceErrorMessage:jobCapsServiceErrorMessage,jobConfigErrorMessage:jobConfigErrorMessage,title:title})}const jobType=jobConfig&&jobConfig.analysis?Object(analytics_utils["a"])(jobConfig===null||jobConfig===void 0?void 0:jobConfig.analysis):undefined;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,typeof(jobConfig===null||jobConfig===void 0?void 0:jobConfig.description)!=="undefined"&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,jobConfig===null||jobConfig===void 0?void 0:jobConfig.description),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"})),indexPattern!==undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"column"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(ExplorationQueryBar,{indexPattern:indexPattern,setSearchQuery:searchQueryUpdateHandler,query:query,filters:exploration_page_wrapper_filters}))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"})),isLoadingJobConfig===true&&jobConfig===undefined&&external_kbnSharedDeps_React_default.a.createElement(loading_panel_LoadingPanel,null),isLoadingJobConfig===false&&jobConfig!==undefined&&isInitialized===true&&external_kbnSharedDeps_React_default.a.createElement(ExpandableSectionAnalytics,{jobId:jobConfig.id}),isLoadingJobConfig===true&&jobConfig===undefined&&external_kbnSharedDeps_React_default.a.createElement(loading_panel_LoadingPanel,null),isLoadingJobConfig===false&&jobConfig!==undefined&&isInitialized===true&&external_kbnSharedDeps_React_default.a.createElement(EvaluatePanel,{jobConfig:jobConfig,jobStatus:jobStatus,searchQuery:searchQuery}),isLoadingJobConfig===true&&jobConfig!==undefined&&totalFeatureImportance===undefined&&external_kbnSharedDeps_React_default.a.createElement(loading_panel_LoadingPanel,null),isLoadingJobConfig===false&&jobConfig!==undefined&&totalFeatureImportance!==undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(FeatureImportanceSummaryPanel,{totalFeatureImportance:totalFeatureImportance,jobConfig:jobConfig})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),isLoadingJobConfig===true&&jobConfig===undefined&&external_kbnSharedDeps_React_default.a.createElement(loading_panel_LoadingPanel,null),isLoadingJobConfig===false&&jobConfig!==undefined&&isInitialized===true&&typeof(jobConfig===null||jobConfig===void 0?void 0:jobConfig.id)==="string"&&scatterplotFieldOptions.length>1&&typeof(jobConfig===null||jobConfig===void 0?void 0:jobConfig.analysis)!=="undefined"&&external_kbnSharedDeps_React_default.a.createElement(ExpandableSectionSplom,{fields:scatterplotFieldOptions,index:jobConfig===null||jobConfig===void 0?void 0:jobConfig.dest.index,color:jobType===analytics["b"].REGRESSION||jobType===analytics["b"].CLASSIFICATION?Object(analytics_utils["c"])(jobConfig.analysis):undefined,legendType:Object(data_frame_analytics_common["B"])(jobType),searchQuery:searchQuery}),isLoadingJobConfig===true&&jobConfig===undefined&&external_kbnSharedDeps_React_default.a.createElement(loading_panel_LoadingPanel,null),isLoadingJobConfig===false&&jobConfig!==undefined&&indexPattern!==undefined&&isInitialized===true&&external_kbnSharedDeps_React_default.a.createElement(ExplorationResultsTable,{indexPattern:indexPattern,jobConfig:jobConfig,jobStatus:jobStatus,needsDestIndexPattern:needsDestIndexPattern,searchQuery:searchQuery}))};const statDescriptions={[analytics["j"].MSE]:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.regressionExploration.meanSquaredErrorText",{defaultMessage:"Mean squared error"}),[analytics["j"].MSLE]:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.regressionExploration.msleText",{defaultMessage:"Mean squared logarithmic error"}),[analytics["j"].R_SQUARED]:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.regressionExploration.rSquaredText",{defaultMessage:"R squared"}),[analytics["j"].HUBER]:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.regressionExploration.huberText",defaultMessage:"{wikiLink}",values:{wikiLink:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{href:"https://en.wikipedia.org/wiki/Huber_loss#Pseudo-Huber_loss_function",target:"_blank",external:true},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.regressionExploration.huberLinkText",{defaultMessage:"Pseudo Huber loss function"}))}})};const evaluate_stat_tooltipContent={[analytics["j"].MSE]:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.regressionExploration.meanSquaredErrorTooltipContent",{defaultMessage:"Measures how well the regression analysis model is performing. Mean squared sum of the difference between true and predicted values."}),[analytics["j"].MSLE]:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.regressionExploration.msleTooltipContent",{defaultMessage:"Average squared difference between the logarithm of the predicted values and the logarithm of the actual (ground truth) value"}),[analytics["j"].R_SQUARED]:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.regressionExploration.rSquaredTooltipContent",{defaultMessage:"Represents the goodness of fit. Measures how well the observed outcomes are replicated by the model."})};const EvaluateStat=({isLoading:isLoading,statType:statType,title:title,dataTestSubj:dataTestSubj})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xs","data-test-subj":dataTestSubj},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiStat"],{reverse:true,isLoading:isLoading,title:title,description:statDescriptions[statType],titleSize:"xxs"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},statType!==analytics["j"].HUBER&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIconTip"],{anchorClassName:"mlDataFrameAnalyticsRegression__evaluateStat",content:evaluate_stat_tooltipContent[statType]})));const EMPTY_STATS={mse:analytics["c"],msle:analytics["c"],huber:analytics["c"],rSquared:analytics["c"]};const defaultEval={...EMPTY_STATS,error:null};const evaluate_panel_EvaluatePanel=({jobConfig:jobConfig,jobStatus:jobStatus,searchQuery:searchQuery})=>{const{services:{docLinks:docLinks}}=Object(contexts_kibana["b"])();const docLink=docLinks.links.ml.regressionEvaluation;const[trainingEval,setTrainingEval]=Object(external_kbnSharedDeps_React_["useState"])(defaultEval);const[generalizationEval,setGeneralizationEval]=Object(external_kbnSharedDeps_React_["useState"])(defaultEval);const[isLoadingTraining,setIsLoadingTraining]=Object(external_kbnSharedDeps_React_["useState"])(false);const[isLoadingGeneralization,setIsLoadingGeneralization]=Object(external_kbnSharedDeps_React_["useState"])(false);const[isTrainingFilter,setIsTrainingFilter]=Object(external_kbnSharedDeps_React_["useState"])(undefined);const[trainingDocsCount,setTrainingDocsCount]=Object(external_kbnSharedDeps_React_["useState"])(null);const[generalizationDocsCount,setGeneralizationDocsCount]=Object(external_kbnSharedDeps_React_["useState"])(null);const index=jobConfig.dest.index;const dependentVariable=Object(data_frame_analytics_common["w"])(jobConfig.analysis);const predictionFieldName=Object(data_frame_analytics_common["A"])(jobConfig.analysis);const resultsField=jobConfig.dest.results_field;const loadGeneralizationData=async(ignoreDefaultQuery=true)=>{setIsLoadingGeneralization(true);const genErrorEval=await Object(data_frame_analytics_common["F"])({isTraining:false,index:index,dependentVariable:dependentVariable,resultsField:resultsField,predictionFieldName:predictionFieldName,searchQuery:searchQuery,ignoreDefaultQuery:ignoreDefaultQuery,jobType:analytics["b"].REGRESSION});if(genErrorEval.success===true&&genErrorEval.eval&&Object(analytics["E"])(genErrorEval.eval)){const{mse:mse,msle:msle,huber:huber,r_squared:r_squared}=Object(data_frame_analytics_common["C"])(genErrorEval.eval);setGeneralizationEval({mse:mse,msle:msle,huber:huber,rSquared:r_squared,error:null});setIsLoadingGeneralization(false)}else{setIsLoadingGeneralization(false);setGeneralizationEval({...EMPTY_STATS,error:genErrorEval.error})}};const loadTrainingData=async(ignoreDefaultQuery=true)=>{setIsLoadingTraining(true);const trainingErrorEval=await Object(data_frame_analytics_common["F"])({isTraining:true,index:index,dependentVariable:dependentVariable,resultsField:resultsField,predictionFieldName:predictionFieldName,searchQuery:searchQuery,ignoreDefaultQuery:ignoreDefaultQuery,jobType:analytics["b"].REGRESSION});if(trainingErrorEval.success===true&&trainingErrorEval.eval&&Object(analytics["E"])(trainingErrorEval.eval)){const{mse:mse,msle:msle,huber:huber,r_squared:r_squared}=Object(data_frame_analytics_common["C"])(trainingErrorEval.eval);setTrainingEval({mse:mse,msle:msle,huber:huber,rSquared:r_squared,error:null});setIsLoadingTraining(false)}else{setIsLoadingTraining(false);setTrainingEval({...EMPTY_STATS,error:trainingErrorEval.error})}};const loadData=async()=>{loadGeneralizationData(false);const genDocsCountResp=await Object(data_frame_analytics_common["E"])({ignoreDefaultQuery:false,isTraining:false,searchQuery:searchQuery,resultsField:resultsField,destIndex:jobConfig.dest.index});if(genDocsCountResp.success===true){setGeneralizationDocsCount(genDocsCountResp.docsCount)}else{setGeneralizationDocsCount(null)}loadTrainingData(false);const trainDocsCountResp=await Object(data_frame_analytics_common["E"])({ignoreDefaultQuery:false,isTraining:true,searchQuery:searchQuery,resultsField:resultsField,destIndex:jobConfig.dest.index});if(trainDocsCountResp.success===true){setTrainingDocsCount(trainDocsCountResp.docsCount)}else{setTrainingDocsCount(null)}};Object(external_kbnSharedDeps_React_["useEffect"])(()=>{let isTraining;const query=Object(analytics["F"])(searchQuery)&&(searchQuery.bool.should||searchQuery.bool.filter);if(query!==undefined&&query!==false){for(let i=0;i<query.length;i++){const clause=query[i];if(clause.match&&clause.match[`${resultsField}.is_training`]!==undefined){isTraining=clause.match[`${resultsField}.is_training`];break}else if(clause.bool&&(clause.bool.should!==undefined||clause.bool.filter!==undefined)){const innerQuery=clause.bool.should||clause.bool.filter;if(innerQuery!==undefined){for(let j=0;j<innerQuery.length;j++){const innerClause=innerQuery[j];if(innerClause.match&&innerClause.match[`${resultsField}.is_training`]!==undefined){isTraining=innerClause.match[`${resultsField}.is_training`];break}}}}}}setIsTrainingFilter(isTraining);loadData()},[JSON.stringify(searchQuery)]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(ExpandableSection,{urlStateKey:"evaluation",dataTestId:"RegressionEvaluation",title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.regressionExploration.evaluateSectionTitle",defaultMessage:"Model evaluation"}),docsLink:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{target:"_blank",iconType:"help",iconSide:"left",color:"primary",href:docLink},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.regressionExploration.regressionDocsLink",{defaultMessage:"Regression evaluation docs "})),headerItems:jobStatus!==undefined?[{id:"jobStatus",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.classificationExploration.evaluateJobStatusLabel",{defaultMessage:"Job status"}),value:jobStatus}]:[],contentPadding:true,content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xxs"},external_kbnSharedDeps_React_default.a.createElement("span",null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.regressionExploration.generalizationErrorTitle",{defaultMessage:"Generalization error"}))),generalizationDocsCount!==null&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",color:"subdued"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.regressionExploration.generalizationDocsCount",defaultMessage:"{docsCount, plural, one {# doc} other {# docs}} evaluated",values:{docsCount:generalizationDocsCount}}),isTrainingFilter===true&&generalizationDocsCount===0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.regressionExploration.generalizationFilterText",defaultMessage:". Filtering for training data."})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"column",gutterSize:"none"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"column",gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(EvaluateStat,{dataTestSubj:"mlDFAnalyticsRegressionGenMSEstat",isLoading:isLoadingGeneralization,title:generalizationEval.mse,statType:analytics["j"].MSE})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(EvaluateStat,{dataTestSubj:"mlDFAnalyticsRegressionGenRSquaredStat",isLoading:isLoadingGeneralization,title:generalizationEval.rSquared,statType:analytics["j"].R_SQUARED})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(EvaluateStat,{dataTestSubj:"mlDFAnalyticsRegressionGenMsleStat",isLoading:isLoadingGeneralization,title:generalizationEval.msle,statType:analytics["j"].MSLE})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(EvaluateStat,{dataTestSubj:"mlDFAnalyticsRegressionGenHuberStat",isLoading:isLoadingGeneralization,title:generalizationEval.huber,statType:analytics["j"].HUBER})))))),generalizationEval.error!==null&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",color:"danger"},isTrainingFilter===true&&generalizationDocsCount===0&&generalizationEval.error.includes("No documents found")?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.regressionExploration.evaluateNoTestingDocsError",{defaultMessage:"No testing documents found"}):generalizationEval.error)))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xxs"},external_kbnSharedDeps_React_default.a.createElement("span",null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.regressionExploration.trainingErrorTitle",{defaultMessage:"Training error"}))),trainingDocsCount!==null&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",color:"subdued"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.regressionExploration.trainingDocsCount",defaultMessage:"{docsCount, plural, one {# doc} other {# docs}} evaluated",values:{docsCount:trainingDocsCount}}),isTrainingFilter===false&&trainingDocsCount===0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.regressionExploration.trainingFilterText",defaultMessage:". Filtering for testing data."})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"column",gutterSize:"none"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"column",gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(EvaluateStat,{dataTestSubj:"mlDFAnalyticsRegressionTrainingMSEstat",isLoading:isLoadingTraining,title:trainingEval.mse,statType:analytics["j"].MSE})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(EvaluateStat,{dataTestSubj:"mlDFAnalyticsRegressionTrainingRSquaredStat",isLoading:isLoadingTraining,title:trainingEval.rSquared,statType:analytics["j"].R_SQUARED})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(EvaluateStat,{dataTestSubj:"mlDFAnalyticsRegressionTrainingMsleStat",isLoading:isLoadingTraining,title:trainingEval.msle,statType:analytics["j"].MSLE})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(EvaluateStat,{dataTestSubj:"mlDFAnalyticsRegressionTrainingHuberStat",isLoading:isLoadingTraining,title:trainingEval.huber,statType:analytics["j"].HUBER})))))),trainingEval.error!==null&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",color:"danger"},isTrainingFilter===false&&trainingDocsCount===0&&trainingEval.error.includes("No documents found")?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.regressionExploration.evaluateNoTrainingDocsError",{defaultMessage:"No training documents found"}):trainingEval.error)))))}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}))};var external_kbnSharedDeps_Theme_euiLightVars_=__webpack_require__(45);var external_kbnSharedDeps_Theme_euiLightVars_default=__webpack_require__.n(external_kbnSharedDeps_Theme_euiLightVars_);var feature_importance=__webpack_require__(180);function feature_importance_summary_extends(){feature_importance_summary_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return feature_importance_summary_extends.apply(this,arguments)}const{euiColorMediumShade:euiColorMediumShade}=external_kbnSharedDeps_Theme_euiLightVars_default.a;const axisColor=euiColorMediumShade;const feature_importance_summary_axes={axisLine:{stroke:axisColor},tickLabel:{fontSize:12,fill:axisColor},tickLine:{stroke:axisColor},gridLine:{horizontal:{dash:[1,2]},vertical:{strokeWidth:0}}};const feature_importance_summary_theme={axes:feature_importance_summary_axes,legend:{spacingBuffer:100}};const feature_importance_summary_tooltipContent=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.exploration.featureImportanceSummaryTooltipContent",{defaultMessage:"Total feature importance values indicate how significantly a field affects the predictions across all the training data."});const calculateTotalMeanImportance=featureClass=>featureClass.classes.reduce((runningSum,fc)=>runningSum+fc.importance.mean_magnitude,0);const feature_importance_summary_FeatureImportanceSummaryPanel=({totalFeatureImportance:totalFeatureImportance,jobConfig:jobConfig})=>{const{services:{docLinks:docLinks}}=Object(contexts_kibana["b"])();const[plotData,barSeriesSpec,showLegend,chartHeight]=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{let sortedData=[];let _barSeriesSpec={xAccessor:"featureName",yAccessors:["meanImportance"],name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.exploration.featureImportanceYSeriesName",{defaultMessage:"magnitude"})};let classificationType="";if(totalFeatureImportance.length<1){return[sortedData,_barSeriesSpec]}if(Object(feature_importance["b"])(totalFeatureImportance[0])){if(totalFeatureImportance[0].classes.length===2){classificationType="binary_classification";sortedData=totalFeatureImportance.map(d=>({featureName:d.feature_name,meanImportance:d.classes[0].importance.mean_magnitude})).sort((a,b)=>b.meanImportance-a.meanImportance)}if(totalFeatureImportance[0].classes.length>2){classificationType="multiclass_classification";totalFeatureImportance.sort((prevFeature,currentFeature)=>calculateTotalMeanImportance(currentFeature)-calculateTotalMeanImportance(prevFeature)).forEach(feature=>{const sortedFeatureClass=feature.classes.sort((a,b)=>b.importance.mean_magnitude-a.importance.mean_magnitude);sortedData.push(...sortedFeatureClass.map(featureClass=>({featureName:feature.feature_name,meanImportance:featureClass.importance.mean_magnitude,className:featureClass.class_name})))});_barSeriesSpec={xAccessor:"featureName",yAccessors:["meanImportance"],splitSeriesAccessors:["className"],stackAccessors:["featureName"]}}}if(Object(feature_importance["d"])(totalFeatureImportance[0])){classificationType="regression";sortedData=totalFeatureImportance.map(d=>({featureName:d.feature_name,meanImportance:d.importance.mean_magnitude})).sort((a,b)=>b.meanImportance-a.meanImportance)}const _showLegend=classificationType==="multiclass_classification";const _chartHeight=totalFeatureImportance.length*(totalFeatureImportance.length<5?40:20)+50;return[sortedData,_barSeriesSpec,_showLegend,_chartHeight]},[totalFeatureImportance]);const docLink=docLinks.links.ml.featureImportance;const tickFormatter=Object(external_kbnSharedDeps_React_["useCallback"])(d=>Number(d.toPrecision(3)).toString(),[]);const noDataCallOut=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{if(totalFeatureImportance.length===0){if(jobConfig!==null&&jobConfig!==void 0&&jobConfig.analysis&&Object(analytics["D"])(jobConfig===null||jobConfig===void 0?void 0:jobConfig.analysis)||Object(analytics["A"])(jobConfig===null||jobConfig===void 0?void 0:jobConfig.analysis)){const analysisType=Object(data_frame_analytics_common["t"])(jobConfig.analysis);if(analysisType!=="unknown"&&jobConfig.analysis[analysisType].num_top_feature_importance_values===0){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{"data-test-subj":"mlTotalFeatureImportanceNotCalculatedCallout",size:"s",title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.exploration.totalFeatureImportanceNotCalculatedCalloutMessage",defaultMessage:"Feature importance was not calculated because num_top_feature_importance values is set to 0."})})}else{return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{"data-test-subj":"mlNoTotalFeatureImportanceCallout",size:"s",title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.exploration.noTotalFeatureImportanceCalloutMessage",defaultMessage:"Total feature importance data is not available; the data set is uniform and the features have no significant impact on the prediction."})})}}}},[totalFeatureImportance,jobConfig]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(ExpandableSection,{urlStateKey:"feature_importance",isExpanded:noDataCallOut===undefined,dataTestId:"FeatureImportanceSummary",title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.exploration.featureImportanceSummaryTitle",defaultMessage:"Total feature importance"}),docsLink:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{target:"_blank",iconType:"help",iconSide:"left",color:"primary",href:docLink},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.exploration.featureImportanceDocsLink",defaultMessage:"Feature importance docs"})),headerItems:[{id:"FeatureImportanceSummary",value:feature_importance_summary_tooltipContent}],content:noDataCallOut?noDataCallOut:external_kbnSharedDeps_React_default.a.createElement("div",{"data-test-subj":"mlTotalFeatureImportanceChart"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Chart"],{size:{width:"100%",height:chartHeight}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Settings"],{rotation:90,theme:feature_importance_summary_theme,showLegend:showLegend}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Axis"],{id:"x-axis",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.exploration.featureImportanceXAxisTitle",{defaultMessage:"Feature importance average magnitude"}),position:external_kbnSharedDeps_ElasticCharts_["Position"].Bottom,tickFormat:tickFormatter}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["Axis"],{id:"y-axis",title:"",position:external_kbnSharedDeps_ElasticCharts_["Position"].Left}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticCharts_["BarSeries"],feature_importance_summary_extends({id:"magnitude",xScaleType:external_kbnSharedDeps_ElasticCharts_["ScaleType"].Ordinal,yScaleType:external_kbnSharedDeps_ElasticCharts_["ScaleType"].Linear,data:plotData},barSeriesSpec))))}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}))};const RegressionExploration=({jobId:jobId})=>external_kbnSharedDeps_React_default.a.createElement(ExplorationPageWrapper,{jobId:jobId,title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.regressionExploration.tableJobIdTitle",{defaultMessage:"Destination index for regression job ID {jobId}",values:{jobId:jobId}}),EvaluatePanel:evaluate_panel_EvaluatePanel,FeatureImportanceSummaryPanel:feature_importance_summary_FeatureImportanceSummaryPanel});var _classification_exploration=__webpack_require__(696);const ErrorCallout=({error:error})=>{let errorCallout=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.errorCallout.generalErrorTitle",{defaultMessage:"An error occurred loading the data."}),color:"danger",iconType:"cross"},external_kbnSharedDeps_React_default.a.createElement("p",null,error));if(typeof error==="string"&&error.includes("index_not_found")){errorCallout=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.errorCallout.evaluateErrorTitle",{defaultMessage:"An error occurred loading the data."}),color:"danger",iconType:"cross"},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.errorCallout.noIndexCalloutBody",{defaultMessage:"The query for the index returned no results. Please make sure the destination index exists and contains documents."})))}else if(typeof error==="string"&&error.includes("No documents found")){errorCallout=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.errorCallout.noDataCalloutTitle",{defaultMessage:"Empty index query result."}),color:"primary"},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.errorCallout.noDataCalloutBody",{defaultMessage:"The query for the index returned no results. Please make sure the job has completed and the index contains documents."})))}else if(typeof error==="string"&&error.includes("userProvidedQueryBuilder")){errorCallout=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.errorCallout.queryParsingErrorTitle",{defaultMessage:"Unable to parse query."}),color:"primary"},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.errorCallout.queryParsingErrorBody",{defaultMessage:"The query syntax is invalid and returned no results. Please check the query syntax and try again."})))}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,errorCallout)};const GRAY=Object(external_kbnSharedDeps_ElasticEui_["euiPaletteGray"])(1)[0];const BASELINE="baseline";const SIZE=300;function getColorRangeNominal(classificationClasses){const legendItems=[...classificationClasses,BASELINE].sort();const baselineIndex=legendItems.indexOf(BASELINE);const colorRangeNominal=Object(external_kbnSharedDeps_ElasticEui_["euiPaletteColorBlind"])({rotations:2}).slice(0,classificationClasses.length);colorRangeNominal.splice(baselineIndex,0,GRAY);return colorRangeNominal}const getRocCurveChartVegaLiteSpec=(classificationClasses,data,legendTitle)=>{data.push({tpr:0,fpr:0,threshold:1,class_name:BASELINE});data.push({tpr:1,fpr:1,threshold:1,class_name:BASELINE});const colorRangeNominal=getColorRangeNominal(classificationClasses);return{$schema:"https://vega.github.io/schema/vega-lite/v4.8.1.json",background:"transparent",padding:{left:45,top:0,right:0,bottom:0},config:{legend:{orient:"right"},view:{continuousHeight:SIZE,continuousWidth:SIZE}},data:{name:"roc-curve-data"},datasets:{"roc-curve-data":data},encoding:{color:{field:"class_name",type:vega_chart_common["a"].NOMINAL,scale:{range:colorRangeNominal},legend:{title:legendTitle}},size:{value:2},strokeDash:{condition:{test:`(datum.class_name === '${BASELINE}')`,value:[5,5]},value:[0]},x:{field:"fpr",sort:null,title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.rocChartSpec.xAxisTitle",{defaultMessage:"False Positive Rate (FPR)"}),type:"quantitative",axis:{tickColor:GRAY,labelColor:GRAY,domainColor:GRAY,titleColor:GRAY}},y:{field:"tpr",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.rocChartSpec.yAxisTitle",{defaultMessage:"True Positive Rate (TPR) (a.k.a Recall)"}),type:"quantitative",axis:{tickColor:GRAY,labelColor:GRAY,domainColor:GRAY,titleColor:GRAY}},tooltip:[{type:vega_chart_common["a"].NOMINAL,field:"class_name"},{type:vega_chart_common["a"].QUANTITATIVE,field:"fpr"},{type:vega_chart_common["a"].QUANTITATIVE,field:"tpr"}]},height:SIZE,width:SIZE,mark:"line"}};const COL_INITIAL_WIDTH=165;const ACTUAL_CLASS_ID="actual_class";const OTHER_CLASS_ID="other";const MAX_COLUMNS=6;function getColumnData(confusionMatrixData){const colData=[];const columns=[{id:ACTUAL_CLASS_ID,display:external_kbnSharedDeps_React_default.a.createElement("span",null),initialWidth:COL_INITIAL_WIDTH}];let showOther=false;confusionMatrixData.forEach(classData=>{const otherCount=classData.other_predicted_class_doc_count;if(otherCount>0){showOther=true}const col={actual_class:classData.actual_class,actual_class_doc_count:classData.actual_class_doc_count,other:otherCount};const predictedClasses=classData.predicted_classes||[];columns.push({id:classData.actual_class,initialWidth:COL_INITIAL_WIDTH});for(let i=0;i<predictedClasses.length;i++){const predictedClass=predictedClasses[i].predicted_class;const predictedClassCount=predictedClasses[i].count;col[predictedClass]=predictedClassCount}colData.push(col)});if(showOther){columns.push({id:OTHER_CLASS_ID,initialWidth:COL_INITIAL_WIDTH})}return{columns:columns,columnData:colData}}function getTrailingControlColumns(numColumns,setShowFullColumns){return[{id:"actions",width:60,headerCellRender:()=>external_kbnSharedDeps_React_default.a.createElement("span",null,`${numColumns} more`),rowCellRender:function RowCellRender(){const[isPopoverOpen,setIsPopoverOpen]=Object(external_kbnSharedDeps_React_["useState"])(false);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopover"],{isOpen:isPopoverOpen,anchorPosition:"upCenter",button:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.classificationExploration.showActions",{defaultMessage:"Show actions"}),iconType:"boxesHorizontal",color:"text",onClick:()=>setIsPopoverOpen(!isPopoverOpen)}),closePopover:()=>setIsPopoverOpen(false),ownFocus:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:()=>setShowFullColumns(true)},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s",grow:false,textAlign:"center"},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.classificationExploration.showAllColumns",{defaultMessage:"Show all columns"}))))}}]}function is_training_filter_isTrainingFilter(searchQuery,resultsField){let isTraining;const query=Object(analytics["F"])(searchQuery)&&(searchQuery.bool.should||searchQuery.bool.filter);if(query!==undefined&&query!==false){for(let i=0;i<query.length;i++){const clause=query[i];if(clause.match&&clause.match[`${resultsField}.is_training`]!==undefined){isTraining=clause.match[`${resultsField}.is_training`];break}else if(clause.bool&&(clause.bool.should!==undefined||clause.bool.filter!==undefined)){const innerQuery=clause.bool.should||clause.bool.filter;if(innerQuery!==undefined){for(let j=0;j<innerQuery.length;j++){const innerClause=innerQuery[j];if(innerClause.match&&innerClause.match[`${resultsField}.is_training`]!==undefined){isTraining=innerClause.match[`${resultsField}.is_training`];break}}}}}}return isTraining}const useRocCurve=(jobConfig,searchQuery,visibleColumns)=>{const classificationClasses=visibleColumns.filter(d=>d!==ACTUAL_CLASS_ID&&d!==OTHER_CLASS_ID);const[rocCurveData,setRocCurveData]=Object(external_kbnSharedDeps_React_["useState"])([]);const[isLoading,setIsLoading]=Object(external_kbnSharedDeps_React_["useState"])(false);const[error,setError]=Object(external_kbnSharedDeps_React_["useState"])(null);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{async function loadRocCurveData(){setIsLoading(true);const dependentVariable=Object(data_frame_analytics_common["w"])(jobConfig.analysis);const resultsField=jobConfig.dest.results_field;const newRocCurveData=[];let requiresKeyword=false;const errors=[];try{requiresKeyword=Object(common_fields["k"])(dependentVariable)}catch(e){console.error("Unable to load new field types",e)}for(let i=0;i<classificationClasses.length;i++){const rocCurveClassName=classificationClasses[i];const evalData=await Object(data_frame_analytics_common["F"])({isTraining:is_training_filter_isTrainingFilter(searchQuery,resultsField),index:jobConfig.dest.index,dependentVariable:dependentVariable,resultsField:resultsField,predictionFieldName:Object(data_frame_analytics_common["A"])(jobConfig.analysis),searchQuery:searchQuery,jobType:analytics["b"].CLASSIFICATION,requiresKeyword:requiresKeyword,rocCurveClassName:rocCurveClassName,includeMulticlassConfusionMatrix:false});if(evalData.success===true&&evalData.eval&&Object(analytics["B"])(evalData.eval)){var _evalData$eval,_evalData$eval$classi,_evalData$eval$classi2,_evalData$eval2,_evalData$eval2$class,_evalData$eval2$class2;const auc=((_evalData$eval=evalData.eval)===null||_evalData$eval===void 0?void 0:(_evalData$eval$classi=_evalData$eval.classification)===null||_evalData$eval$classi===void 0?void 0:(_evalData$eval$classi2=_evalData$eval$classi.auc_roc)===null||_evalData$eval$classi2===void 0?void 0:_evalData$eval$classi2.value)||0;const rocCurveDataForClass=(((_evalData$eval2=evalData.eval)===null||_evalData$eval2===void 0?void 0:(_evalData$eval2$class=_evalData$eval2.classification)===null||_evalData$eval2$class===void 0?void 0:(_evalData$eval2$class2=_evalData$eval2$class.auc_roc)===null||_evalData$eval2$class2===void 0?void 0:_evalData$eval2$class2.curve)||[]).map(d=>({class_name:`${rocCurveClassName} (AUC: ${Math.round(auc*1e5)/1e5})`,...d}));newRocCurveData.push(...rocCurveDataForClass)}else if(evalData.error!==null){errors.push(evalData.error)}}setError(errors.length>0?errors:null);setRocCurveData(newRocCurveData);setIsLoading(false)}loadRocCurveData()},[JSON.stringify([jobConfig,searchQuery,visibleColumns])]);return{rocCurveData:rocCurveData,classificationClasses:classificationClasses,error:error,isLoading:isLoading}};const useConfusionMatrix=(jobConfig,searchQuery)=>{const[confusionMatrixData,setConfusionMatrixData]=Object(external_kbnSharedDeps_React_["useState"])([]);const[isLoading,setIsLoading]=Object(external_kbnSharedDeps_React_["useState"])(false);const[docsCount,setDocsCount]=Object(external_kbnSharedDeps_React_["useState"])(null);const[error,setError]=Object(external_kbnSharedDeps_React_["useState"])(null);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{async function loadConfusionMatrixData(){setIsLoading(true);let requiresKeyword=false;const dependentVariable=Object(data_frame_analytics_common["w"])(jobConfig.analysis);const resultsField=jobConfig.dest.results_field;const isTraining=is_training_filter_isTrainingFilter(searchQuery,resultsField);try{requiresKeyword=Object(common_fields["k"])(dependentVariable)}catch(e){console.error("Unable to load new field types",e)}const evalData=await Object(data_frame_analytics_common["F"])({isTraining:isTraining,index:jobConfig.dest.index,dependentVariable:dependentVariable,resultsField:resultsField,predictionFieldName:Object(data_frame_analytics_common["A"])(jobConfig.analysis),searchQuery:searchQuery,jobType:analytics["b"].CLASSIFICATION,requiresKeyword:requiresKeyword});const docsCountResp=await Object(data_frame_analytics_common["E"])({isTraining:isTraining,searchQuery:searchQuery,resultsField:resultsField,destIndex:jobConfig.dest.index});if(evalData.success===true&&evalData.eval&&Object(analytics["B"])(evalData.eval)){var _evalData$eval,_evalData$eval$classi,_evalData$eval$classi2;const confusionMatrix=(_evalData$eval=evalData.eval)===null||_evalData$eval===void 0?void 0:(_evalData$eval$classi=_evalData$eval.classification)===null||_evalData$eval$classi===void 0?void 0:(_evalData$eval$classi2=_evalData$eval$classi.multiclass_confusion_matrix)===null||_evalData$eval$classi2===void 0?void 0:_evalData$eval$classi2.confusion_matrix;setError(null);setConfusionMatrixData(confusionMatrix||[]);setIsLoading(false)}else{setIsLoading(false);setConfusionMatrixData([]);setError(evalData.error)}if(docsCountResp.success===true){setDocsCount(docsCountResp.docsCount)}else{setDocsCount(null)}}loadConfusionMatrixData()},[JSON.stringify([jobConfig,searchQuery])]);return{confusionMatrixData:confusionMatrixData,docsCount:docsCount,error:error,isLoading:isLoading}};var SUBSET_TITLE;(function(SUBSET_TITLE){SUBSET_TITLE["TRAINING"]="training";SUBSET_TITLE["TESTING"]="testing";SUBSET_TITLE["ENTIRE"]="entire"})(SUBSET_TITLE||(SUBSET_TITLE={}));const entireDatasetHelpText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.classificationExploration.confusionMatrixEntireHelpText",{defaultMessage:"Normalized confusion matrix for entire dataset"});const testingDatasetHelpText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.classificationExploration.confusionMatrixTestingHelpText",{defaultMessage:"Normalized confusion matrix for testing dataset"});const trainingDatasetHelpText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.classificationExploration.confusionMatrixTrainingHelpText",{defaultMessage:"Normalized confusion matrix for training dataset"});function getHelpText(dataSubsetTitle){let helpText=entireDatasetHelpText;if(dataSubsetTitle===SUBSET_TITLE.TESTING){helpText=testingDatasetHelpText}else if(dataSubsetTitle===SUBSET_TITLE.TRAINING){helpText=trainingDatasetHelpText}return helpText}const classification_exploration_evaluate_panel_EvaluatePanel=({jobConfig:jobConfig,jobStatus:jobStatus,searchQuery:searchQuery})=>{const{services:{docLinks:docLinks}}=Object(contexts_kibana["b"])();const[columns,setColumns]=Object(external_kbnSharedDeps_React_["useState"])([]);const[columnsData,setColumnsData]=Object(external_kbnSharedDeps_React_["useState"])([]);const[showFullColumns,setShowFullColumns]=Object(external_kbnSharedDeps_React_["useState"])(false);const[popoverContents,setPopoverContents]=Object(external_kbnSharedDeps_React_["useState"])([]);const[dataSubsetTitle,setDataSubsetTitle]=Object(external_kbnSharedDeps_React_["useState"])(SUBSET_TITLE.ENTIRE);const[visibleColumns,setVisibleColumns]=Object(external_kbnSharedDeps_React_["useState"])(()=>columns.map(({id:id})=>id));const resultsField=jobConfig.dest.results_field;const isTraining=is_training_filter_isTrainingFilter(searchQuery,resultsField);const{confusionMatrixData:confusionMatrixData,docsCount:docsCount,error:errorConfusionMatrix,isLoading:isLoadingConfusionMatrix}=useConfusionMatrix(jobConfig,searchQuery);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(isTraining===undefined){setDataSubsetTitle(SUBSET_TITLE.ENTIRE)}else{setDataSubsetTitle(isTraining&&isTraining===true?SUBSET_TITLE.TRAINING:SUBSET_TITLE.TESTING)}},[isTraining]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(confusionMatrixData.length>0){const{columns:derivedColumns,columnData:columnData}=getColumnData(confusionMatrixData);setVisibleColumns(()=>derivedColumns.map(({id:id})=>id));setColumns(derivedColumns);setColumnsData(columnData);setPopoverContents({numeric:({cellContentsElement:cellContentsElement,children:children})=>{var _children$props,_children$props2;const rowIndex=children===null||children===void 0?void 0:(_children$props=children.props)===null||_children$props===void 0?void 0:_children$props.rowIndex;const colId=children===null||children===void 0?void 0:(_children$props2=children.props)===null||_children$props2===void 0?void 0:_children$props2.columnId;const gridItem=columnData[rowIndex];if(gridItem!==undefined&&colId!==ACTUAL_CLASS_ID){const count=gridItem[colId];return`${count} / ${gridItem.actual_class_doc_count} * 100 = ${cellContentsElement.textContent}`}return cellContentsElement.textContent}})}},[confusionMatrixData]);const{rocCurveData:rocCurveData,classificationClasses:classificationClasses,error:errorRocCurve,isLoading:isLoadingRocCurve}=useRocCurve(jobConfig,searchQuery,visibleColumns);const renderCellValue=({rowIndex:rowIndex,columnId:columnId,setCellProps:setCellProps})=>{const cellValue=columnsData[rowIndex][columnId];const actualCount=columnsData[rowIndex]&&columnsData[rowIndex].actual_class_doc_count;let accuracy="0%";if(columnId!==ACTUAL_CLASS_ID&&actualCount){accuracy=cellValue/actualCount;accuracy=Math.round(accuracy*100)/100;accuracy=`${Math.round(accuracy*100)}%`}Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(columnId!==ACTUAL_CLASS_ID){setCellProps({style:{backgroundColor:`rgba(0, 179, 164, ${accuracy})`}})}},[rowIndex,columnId,setCellProps]);return external_kbnSharedDeps_React_default.a.createElement("span",null,columnId===ACTUAL_CLASS_ID?cellValue:accuracy)};const docLink=docLinks.links.ml.classificationEvaluation;const showTrailingColumns=columnsData.length>MAX_COLUMNS;const extraColumns=columnsData.length-MAX_COLUMNS;const shownColumns=showTrailingColumns===true&&showFullColumns===false?columns.slice(0,MAX_COLUMNS+1):columns;const rowCount=showTrailingColumns===true&&showFullColumns===false?MAX_COLUMNS:columnsData.length;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(ExpandableSection,{urlStateKey:"evaluation",dataTestId:"ClassificationEvaluation",title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.classificationExploration.evaluateSectionTitle",defaultMessage:"Model evaluation"}),docsLink:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{target:"_blank",iconType:"help",iconSide:"left",color:"primary",href:docLink},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.classificationExploration.classificationDocsLink",{defaultMessage:"Classification evaluation docs "})),headerItems:!isLoadingConfusionMatrix?[...jobStatus!==undefined?[{id:"jobStatus",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.classificationExploration.evaluateJobStatusLabel",{defaultMessage:"Job status"}),value:jobStatus}]:[],...docsCount!==null?[{id:"docsEvaluated",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.classificationExploration.generalizationDocsCount",{defaultMessage:"{docsCount, plural, one {doc} other {docs}} evaluated",values:{docsCount:docsCount}}),value:docsCount}]:[]]:HEADER_ITEMS_LOADING,contentPadding:true,content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,!isLoadingConfusionMatrix?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,errorConfusionMatrix!==null&&external_kbnSharedDeps_React_default.a.createElement(ErrorCallout,{error:errorConfusionMatrix}),errorConfusionMatrix===null&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"none"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xxs"},external_kbnSharedDeps_React_default.a.createElement("span",null,getHelpText(dataSubsetTitle))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIconTip"],{anchorClassName:"mlDataFrameAnalyticsClassificationInfoTooltip",content:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.classificationExploration.confusionMatrixTooltip",{defaultMessage:"The multi-class confusion matrix contains the number of occurrences where the analysis classified data points correctly with their actual class as well as the number of occurrences where it misclassified them with another class"})}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement("div",{className:"mlDataFrameAnalyticsClassification__evaluateSectionContent"},external_kbnSharedDeps_React_default.a.createElement("div",{className:"mlDataFrameAnalyticsClassification__actualLabel"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",color:"subdued"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.classificationExploration.confusionMatrixActualLabel",defaultMessage:"Actual label"}))),external_kbnSharedDeps_React_default.a.createElement("div",{className:"mlDataFrameAnalyticsClassification__dataGridMinWidth"},columns.length>0&&columnsData.length>0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",color:"subdued"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.classificationExploration.confusionMatrixPredictedLabel",defaultMessage:"Predicted label"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDataGrid"],{"data-test-subj":"mlDFAnalyticsClassificationExplorationConfusionMatrix","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.classificationExploration.confusionMatrixLabel",{defaultMessage:"Classification confusion matrix"}),columns:shownColumns,columnVisibility:{visibleColumns:visibleColumns,setVisibleColumns:setVisibleColumns},rowCount:rowCount,renderCellValue:renderCellValue,inMemory:{level:"sorting"},toolbarVisibility:{showColumnSelector:true,showStyleSelector:false,showFullScreenSelector:false,showSortSelector:false},popoverContents:popoverContents,gridStyle:{border:"all",fontSize:"s",cellPadding:"s",stripes:false,rowHover:"none",header:"shade"},trailingControlColumns:showTrailingColumns===true&&showFullColumns===false?getTrailingControlColumns(extraColumns,setShowFullColumns):undefined})))))):null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"none"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xxs"},external_kbnSharedDeps_React_default.a.createElement("span",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.classificationExploration.evaluateSectionRocTitle",defaultMessage:"Receiver operating characteristic (ROC) curve"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIconTip"],{anchorClassName:"mlDataFrameAnalyticsClassificationInfoTooltip",content:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.classificationExploration.evaluateSectionRocInfoTooltip",{defaultMessage:"The receiver operating characteristic (ROC) curve is a plot that represents the performance of the classification process at different predicted probability thresholds."})}))),Array.isArray(errorRocCurve)&&external_kbnSharedDeps_React_default.a.createElement(ErrorCallout,{error:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,errorRocCurve.map(e=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,e,external_kbnSharedDeps_React_default.a.createElement("br",null))))}),!isLoadingRocCurve&&errorRocCurve===null&&rocCurveData.length>0&&external_kbnSharedDeps_React_default.a.createElement("div",{className:"mlDataFrameAnalyticsClassification__evaluateSectionContent","data-test-subj":"mlDFAnalyticsClassificationExplorationRocCurveChart"},external_kbnSharedDeps_React_default.a.createElement(VegaChart,{vegaSpec:getRocCurveChartVegaLiteSpec(classificationClasses,rocCurveData,Object(data_frame_analytics_common["w"])(jobConfig.analysis))})),isLoadingRocCurve&&external_kbnSharedDeps_React_default.a.createElement(VegaChartLoading,null))}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}))};const ClassificationExploration=({jobId:jobId})=>external_kbnSharedDeps_React_default.a.createElement("div",{className:"mlDataFrameAnalyticsClassification"},external_kbnSharedDeps_React_default.a.createElement(ExplorationPageWrapper,{jobId:jobId,title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.classificationExploration.tableJobIdTitle",{defaultMessage:"Destination index for classification job ID {jobId}",values:{jobId:jobId}}),EvaluatePanel:classification_exploration_evaluate_panel_EvaluatePanel,FeatureImportanceSummaryPanel:feature_importance_summary_FeatureImportanceSummaryPanel}));const analytics_exploration_page_Page=({jobId:jobId,analysisType:analysisType})=>{const{services:{docLinks:docLinks}}=Object(contexts_kibana["b"])();const helpLink=docLinks.links.ml.dataFrameAnalytics;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(navigation_menu["a"],{tabId:"data_frame_analytics"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPage"],{"data-test-subj":"mlPageDataFrameAnalyticsExploration"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageBody"],{style:{maxWidth:"calc(100% - 0px)"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageContentHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageContentHeaderSection"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],null,external_kbnSharedDeps_React_default.a.createElement("h1",null,jobId)))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageContentBody"],{style:{maxWidth:"calc(100% - 0px)"}},analysisType===data_frame_analytics["a"].OUTLIER_DETECTION&&external_kbnSharedDeps_React_default.a.createElement(OutlierExploration,{jobId:jobId}),analysisType===data_frame_analytics["a"].REGRESSION&&external_kbnSharedDeps_React_default.a.createElement(RegressionExploration,{jobId:jobId}),analysisType===data_frame_analytics["a"].CLASSIFICATION&&external_kbnSharedDeps_React_default.a.createElement(ClassificationExploration,{jobId:jobId})))),external_kbnSharedDeps_React_default.a.createElement(help_menu["a"],{docLink:helpLink}))};function analytics_job_exploration_extends(){analytics_job_exploration_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return analytics_job_exploration_extends.apply(this,arguments)}const analyticsJobExplorationRouteFactory=(navigateToPath,basePath)=>({path:"/data_frame_analytics/exploration",render:(props,deps)=>external_kbnSharedDeps_React_default.a.createElement(analytics_job_exploration_PageWrapper,analytics_job_exploration_extends({},props,{deps:deps})),breadcrumbs:[getBreadcrumbWithUrlForApp("ML_BREADCRUMB",navigateToPath,basePath),getBreadcrumbWithUrlForApp("DATA_FRAME_ANALYTICS_BREADCRUMB",navigateToPath,basePath),{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataFrameAnalyticsBreadcrumbs.dataFrameExplorationLabel",{defaultMessage:"Exploration"}),href:""}]});const analytics_job_exploration_PageWrapper=({location:location,deps:deps})=>{const{context:context}=useResolver(undefined,undefined,deps.config,basicResolvers(deps));const[globalState]=Object(url_state["c"])("_g");const urlGenerator=Object(contexts_kibana["d"])();const{services:{application:{navigateToUrl:navigateToUrl}}}=Object(contexts_kibana["b"])();const redirectToAnalyticsManagementPage=async()=>{const url=await urlGenerator.createUrl({page:ml_url_generator["b"].DATA_FRAME_ANALYTICS_JOBS_MANAGE});await navigateToUrl(url)};const jobId=globalState.ml.jobId;const analysisType=globalState.ml.analysisType;if(!analysisType){redirectToAnalyticsManagementPage()}return external_kbnSharedDeps_React_default.a.createElement(PageLoader,{context:context},external_kbnSharedDeps_React_default.a.createElement(analytics_exploration_page_Page,{jobId:jobId,analysisType:analysisType}))};var use_create_analytics_form=__webpack_require__(389);const Messages=({messages:messages})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,messages.map((requestMessage,i)=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],{key:i},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{"data-test-subj":`analyticsWizardCreationCallout_${i}`,title:requestMessage.message,color:requestMessage.error!==undefined?"danger":"primary",iconType:requestMessage.error!==undefined?"alert":"checkInCircleFilled",size:"s"},requestMessage.error!==undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCodeBlock"],{language:"json",fontSize:"s",paddingSize:"s",isCopyable:true},requestMessage.error)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}))));var use_create_analytics_form_state=__webpack_require__(118);const fetchExplainData=async formState=>{const jobConfig=Object(use_create_analytics_form_state["f"])(formState);let errorMessage="";let errorReason="";let success=true;let expectedMemory="";let fieldSelection=[];try{var _resp$memory_estimati;delete jobConfig.dest;delete jobConfig.model_memory_limit;const resp=await ml_api_service["ml"].dataFrameAnalytics.explainDataFrameAnalytics(jobConfig);expectedMemory=(_resp$memory_estimati=resp.memory_estimation)===null||_resp$memory_estimati===void 0?void 0:_resp$memory_estimati.expected_memory_without_disk;fieldSelection=resp.field_selection||[]}catch(error){const errObj=Object(util_errors["j"])(error);success=false;errorMessage=errObj.message;if(errObj.causedBy){errorReason=errObj.causedBy}}return{success:success,expectedMemory:expectedMemory,fieldSelection:fieldSelection,errorMessage:errorMessage,errorReason:errorReason}};const BackToListPanel=()=>{const analyticsManagementPageLink=Object(contexts_kibana["c"])({page:ml_url_generator["b"].DATA_FRAME_ANALYTICS_JOBS_MANAGE});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCard"],{className:"dfAnalyticsCreationWizard__card",icon:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{size:"xxl",type:"list"}),title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.analyticsListCardTitle",{defaultMessage:"Data Frame Analytics"}),description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.analyticsListCardDescription",{defaultMessage:"Return to the analytics management page."}),href:analyticsManagementPageLink,"data-test-subj":"analyticsWizardCardManagement"}))};const ViewResultsPanel=({jobId:jobId,analysisType:analysisType})=>{const analyticsExplorationPageLink=Object(contexts_kibana["c"])({page:ml_url_generator["b"].DATA_FRAME_ANALYTICS_EXPLORATION,pageState:{jobId:jobId,analysisType:analysisType}});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCard"],{className:"dfAnalyticsCreationWizard__card",icon:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{size:"xxl",type:"visTable"}),title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.viewResultsCardTitle",{defaultMessage:"View Results"}),description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.viewResultsCardDescription",{defaultMessage:"View results for the analytics job."}),href:analyticsExplorationPageLink,"data-test-subj":"analyticsWizardViewResultsCard"}))};const ProgressStats=({currentProgress:currentProgress,failedJobMessage:failedJobMessage})=>{if(currentProgress===undefined)return null;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),failedJobMessage!==undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{"data-test-subj":"analyticsWizardProgressCallout",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.analyticsProgressCalloutTitle",{defaultMessage:"Job failed"}),color:"danger",iconType:"alert",size:"s"},external_kbnSharedDeps_React_default.a.createElement("p",null,failedJobMessage)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"m"},external_kbnSharedDeps_React_default.a.createElement("strong",null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.analyticsProgressTitle",{defaultMessage:"Progress"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("strong",null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.analyticsProgressPhaseTitle",{defaultMessage:"Phase"})," ",currentProgress.currentPhase,"/",currentProgress.totalPhases))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{style:{width:"400px"},grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiProgress"],{value:currentProgress.progress,max:100,color:"primary",size:"l","data-test-subj":"mlAnalyticsCreationWizardProgress"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s"},`${currentProgress.progress}%`))))};const PROGRESS_REFRESH_INTERVAL_MS=1e3;const CreateStepFooter=({jobId:jobId,jobType:jobType,showProgress:showProgress})=>{const[initialized,setInitialized]=Object(external_kbnSharedDeps_React_["useState"])(false);const[failedJobMessage,setFailedJobMessage]=Object(external_kbnSharedDeps_React_["useState"])(undefined);const[jobFinished,setJobFinished]=Object(external_kbnSharedDeps_React_["useState"])(false);const[currentProgress,setCurrentProgress]=Object(external_kbnSharedDeps_React_["useState"])(undefined);const[showJobAssignWarning,setShowJobAssignWarning]=Object(external_kbnSharedDeps_React_["useState"])(false);const{services:{notifications:notifications}}=Object(contexts_kibana["b"])();Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setInitialized(true)},[]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const interval=setInterval(async()=>{try{const analyticsStats=await ml_api_service["ml"].dataFrameAnalytics.getDataFrameAnalyticsStats(jobId);const jobStats=Object(get_analytics["b"])(analyticsStats)?analyticsStats.data_frame_analytics[0]:undefined;setShowJobAssignWarning((jobStats===null||jobStats===void 0?void 0:jobStats.state)===analytics_list_common["b"].STARTING&&(jobStats===null||jobStats===void 0?void 0:jobStats.node)===undefined);if(jobStats!==undefined){const progressStats=Object(analytics_list_common["d"])(jobStats);if(jobStats.state===analytics_list_common["b"].FAILED){clearInterval(interval);setFailedJobMessage(jobStats.failure_reason||external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.analyticsProgressCalloutMessage",{defaultMessage:"Analytics job {jobId} has failed.",values:{jobId:jobId}}))}setCurrentProgress(progressStats);if(progressStats.currentPhase===progressStats.totalPhases&&progressStats.progress===100||jobStats.state===analytics_list_common["b"].STOPPED){clearInterval(interval);setJobFinished(progressStats.currentPhase===progressStats.totalPhases&&progressStats.progress===100)}}else{clearInterval(interval)}}catch(e){notifications.toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.analyticsProgressErrorMessage",{defaultMessage:"An error occurred getting progress stats for analytics job {jobId}",values:{jobId:jobId}}));clearInterval(interval)}},PROGRESS_REFRESH_INTERVAL_MS);return()=>clearInterval(interval)},[initialized]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,showJobAssignWarning&&external_kbnSharedDeps_React_default.a.createElement(jobs_awaiting_node_warning["b"],{jobType:"data-frame-analytics"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"column"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},showProgress&&external_kbnSharedDeps_React_default.a.createElement(ProgressStats,{currentProgress:currentProgress,failedJobMessage:failedJobMessage})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(BackToListPanel,null)),jobFinished===true&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(ViewResultsPanel,{jobId:jobId,analysisType:jobType}))))))};const CreateStep=({actions:actions,state:state,step:step})=>{const{createAnalyticsJob:createAnalyticsJob,startAnalyticsJob:startAnalyticsJob}=actions;const{isAdvancedEditorValidJson:isAdvancedEditorValidJson,isJobCreated:isJobCreated,isJobStarted:isJobStarted,isValid:isValid,requestMessages:requestMessages}=state;const{jobId:jobId,jobType:jobType}=state.form;const[checked,setChecked]=Object(external_kbnSharedDeps_React_["useState"])(true);const[creationTriggered,setCreationTriggered]=Object(external_kbnSharedDeps_React_["useState"])(false);const[showProgress,setShowProgress]=Object(external_kbnSharedDeps_React_["useState"])(false);if(step!==ANALYTICS_STEPS.CREATE)return null;const handleCreation=async()=>{setCreationTriggered(true);const creationSuccess=await createAnalyticsJob();if(creationSuccess===false){setCreationTriggered(false)}if(checked&&creationSuccess===true){setShowProgress(true);startAnalyticsJob()}};return external_kbnSharedDeps_React_default.a.createElement("div",{"data-test-subj":"mlAnalyticsCreateJobWizardCreateStep active"},!isJobCreated&&!isJobStarted&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.startCheckboxHelpText",{defaultMessage:"If unselected, job can be started later by returning to the jobs list."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCheckbox"],{"data-test-subj":"mlAnalyticsCreateJobWizardStartJobCheckbox",id:"dataframe-create-start-checkbox",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.wizardStartCheckbox",{defaultMessage:"Start immediately"}),checked:checked,onChange:e=>setChecked(e.target.checked)}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{className:"mlAnalyticsCreateWizard__footerButton",disabled:!isValid||!isAdvancedEditorValidJson,onClick:handleCreation,fill:true,isLoading:creationTriggered,"data-test-subj":"mlAnalyticsCreateJobWizardCreateButton"},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.wizardCreateButton",{defaultMessage:"Create"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(Messages,{messages:requestMessages}),isJobCreated===true&&external_kbnSharedDeps_React_default.a.createElement(CreateStepFooter,{jobId:jobId,jobType:jobType,showProgress:showProgress}))};function create_analytics_advanced_editor_extends(){create_analytics_advanced_editor_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return create_analytics_advanced_editor_extends.apply(this,arguments)}const xJsonMode=new shared_imports["a"];const CreateAnalyticsAdvancedEditor=props=>{const{actions:actions,state:state}=props;const{setAdvancedEditorRawString:setAdvancedEditorRawString,setFormState:setFormState}=actions;const{advancedEditorMessages:advancedEditorMessages,advancedEditorRawString:advancedEditorRawString,isJobCreated:isJobCreated}=state;const{createIndexPattern:createIndexPattern,destinationIndexPatternTitleExists:destinationIndexPatternTitleExists,jobId:jobId,jobIdEmpty:jobIdEmpty,jobIdExists:jobIdExists,jobIdValid:jobIdValid}=state.form;const forceInput=Object(external_kbnSharedDeps_React_["useRef"])(null);const{toasts:toasts}=Object(contexts_kibana["f"])();const onChange=str=>{setAdvancedEditorRawString(str)};const debouncedJobIdCheck=Object(external_kbnSharedDeps_React_["useMemo"])(()=>Object(external_kbnSharedDeps_Lodash_["debounce"])(async()=>{try{const{results:results}=await ml_api_service["ml"].dataFrameAnalytics.jobsExists([jobId],true);setFormState({jobIdExists:results[jobId]})}catch(e){toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.advancedEditor.errorCheckingJobIdExists",{defaultMessage:"The following error occurred checking if job id exists: {error}",values:{error:Object(util_errors["i"])(e)}}))}},400),[jobId]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(forceInput.current===null){return}const evt=document.createEvent("MouseEvents");evt.initEvent("mouseup",true,true);forceInput.current.dispatchEvent(evt)},[]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(jobIdValid===true){debouncedJobIdCheck()}else if(typeof jobId==="string"&&jobId.trim()===""&&jobIdExists===true){setFormState({jobIdExists:false})}return()=>{debouncedJobIdCheck.cancel()}},[jobId]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiForm"],{className:"mlDataFrameAnalyticsCreateForm"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.advancedEditor.jobIdLabel",{defaultMessage:"Analytics job ID"}),isInvalid:!jobIdEmpty&&!jobIdValid||jobIdExists,error:[...!jobIdEmpty&&!jobIdValid?[external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.advancedEditor.jobIdInvalidError",{defaultMessage:"Must contain lowercase alphanumeric characters (a-z and 0-9), hyphens, and underscores only and must start and end with alphanumeric characters."})]:[],...jobIdExists?[external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.advancedEditor.jobIdExistsError",{defaultMessage:"An analytics job with this ID already exists."})]:[]]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{inputRef:input=>{if(input){forceInput.current=input}},disabled:isJobCreated,placeholder:"analytics job ID",value:jobId,onChange:e=>setFormState({jobId:e.target.value}),"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.advancedEditor.jobIdInputAriaLabel",{defaultMessage:"Choose a unique analytics job ID."}),isInvalid:!jobIdEmpty&&!jobIdValid||jobIdExists})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.advancedEditor.configRequestBody",{defaultMessage:"Configuration request body"}),style:{maxWidth:"100%"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCodeEditor"],{isReadOnly:isJobCreated,mode:xJsonMode,width:"100%",value:advancedEditorRawString,onChange:onChange,setOptions:{fontSize:"12px"},theme:"textmate","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.advancedEditor.codeEditorAriaLabel",{defaultMessage:"Advanced analytics job editor"})})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),advancedEditorMessages.map((advancedEditorMessage,i)=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],{key:i},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:advancedEditorMessage.message!==""?advancedEditorMessage.message:advancedEditorMessage.error,color:advancedEditorMessage.error!==undefined?"danger":"primary",iconType:advancedEditorMessage.error!==undefined?"alert":"checkInCircleFilled",size:"s"},advancedEditorMessage.message!==""&&advancedEditorMessage.error!==undefined?external_kbnSharedDeps_React_default.a.createElement("p",null,advancedEditorMessage.error):null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null))),!isJobCreated&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{isInvalid:createIndexPattern&&destinationIndexPatternTitleExists,error:createIndexPattern&&destinationIndexPatternTitleExists&&[external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.indexPatternAlreadyExistsError",{defaultMessage:"An index pattern with this title already exists."})]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{disabled:isJobCreated,name:"mlDataFrameAnalyticsCreateIndexPattern",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.createIndexPatternLabel",{defaultMessage:"Create index pattern"}),checked:createIndexPattern===true,onChange:()=>setFormState({createIndexPattern:!createIndexPattern})}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement(CreateStep,create_analytics_advanced_editor_extends({},props,{step:ANALYTICS_STEPS.CREATE})))};const MAX_INCLUDES_LENGTH=5;const ConfigurationStepDetails=({setCurrentStep:setCurrentStep,state:state})=>{const mlContext=Object(ml["b"])();const{currentIndexPattern:currentIndexPattern}=mlContext;const{form:form,isJobCreated:isJobCreated}=state;const{dependentVariable:dependentVariable,includes:includes,jobConfigQueryString:jobConfigQueryString,jobType:jobType,trainingPercent:trainingPercent}=form;const isJobTypeWithDepVar=jobType===analytics["b"].REGRESSION||jobType===analytics["b"].CLASSIFICATION;const detailsFirstCol=[{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.sourceIndex",{defaultMessage:"Source index"}),description:currentIndexPattern.title||use_create_analytics_form_state["c"]},{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.Query",{defaultMessage:"Query"}),description:jobConfigQueryString||use_create_analytics_form_state["c"]}];const detailsSecondCol=[{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.jobType",{defaultMessage:"Job type"}),description:jobType}];const detailsThirdCol=[{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.includedFields",{defaultMessage:"Included fields"}),description:includes.length>MAX_INCLUDES_LENGTH?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.includedFieldsAndMoreDescription",{defaultMessage:"{includedFields} ... (and {extraCount} more)",values:{extraCount:includes.length-MAX_INCLUDES_LENGTH,includedFields:includes.slice(0,MAX_INCLUDES_LENGTH).join(", ")}}):includes.join(", ")}];if(isJobTypeWithDepVar){detailsSecondCol.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.trainingPercent",{defaultMessage:"Training percent"}),description:`${trainingPercent}`});detailsThirdCol.unshift({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.dependentVariable",{defaultMessage:"Dependent variable"}),description:dependentVariable})}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{style:{width:"70%"},justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{compressed:true,listItems:detailsFirstCol})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{compressed:true,listItems:detailsSecondCol})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{compressed:true,listItems:detailsThirdCol}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),!isJobCreated&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{iconType:"pencil",size:"s",onClick:()=>{setCurrentStep(ANALYTICS_STEPS.CONFIGURATION)}},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.editButtonText",{defaultMessage:"Edit"})))};var get_scatterplot_matrix_legend_type=__webpack_require__(223);const CATEGORICAL_TYPES=new Set(["ip","keyword"]);const shouldAddAsDepVarOption=(field,jobType)=>{if(field.id===types_fields["a"])return false;const isBasicNumerical=common_fields["a"].has(field.type);const isSupportedByClassification=isBasicNumerical||CATEGORICAL_TYPES.has(field.type)||field.type===data_public_["ES_FIELD_TYPES"].BOOLEAN;if(jobType===analytics["b"].REGRESSION){return isBasicNumerical||common_fields["b"].has(field.type)}if(jobType===analytics["b"].CLASSIFICATION)return isSupportedByClassification};const continueButtonText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.creation.continueButtonText",{defaultMessage:"Continue"});const ContinueButton=({isDisabled:isDisabled,onClick:onClick})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{"data-test-subj":"mlAnalyticsCreateJobWizardContinueButton",isDisabled:isDisabled,size:"s",onClick:onClick},continueButtonText)));const job_type_jobDetails={[data_frame_analytics["a"].OUTLIER_DETECTION]:{helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.outlierDetectionHelpText",{defaultMessage:"Outlier detection identifies unusual data points in the data set."}),icon:"outlierDetectionJob",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.outlierDetectionTitle",{defaultMessage:"Outlier detection"})},[data_frame_analytics["a"].REGRESSION]:{helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.regressionHelpText",{defaultMessage:"Regression predicts numerical values in the data set."}),icon:"regressionJob",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.regressionTitle",{defaultMessage:"Regression"})},[data_frame_analytics["a"].CLASSIFICATION]:{helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.classificationHelpText",{defaultMessage:"Classification predicts labels of data points in the data set."}),icon:"classificationJob",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.classificationTitle",{defaultMessage:"Classification"})}};const JobType=({type:type,setFormState:setFormState})=>{const[selectedCard,setSelectedCard]=Object(external_kbnSharedDeps_React_["useState"])({});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"m","data-test-subj":"mlAnalyticsCreateJobWizardJobTypeSelect"},Object.keys(job_type_jobDetails).map(jobType=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{key:jobType,grow:1},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCard"],{icon:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{size:"xl",type:job_type_jobDetails[jobType].icon}),title:job_type_jobDetails[jobType].title,description:job_type_jobDetails[jobType].helpText,"data-test-subj":`mlAnalyticsCreation-${jobType}-option${type===jobType?" selectedJobType":""}`,selectable:{onClick:()=>{if(selectedCard[jobType]===true){return}setFormState({previousJobType:type,jobType:jobType,includes:[],requiredFieldsError:undefined});setSelectedCard({[jobType]:!selectedCard[jobType]})},isSelected:selectedCard[jobType]===true||type===jobType}})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}))};const containsClassificationFieldsCb=({name:name,type:type})=>!field_types["d"].includes(name)&&name!==types_fields["a"]&&(common_fields["a"].has(type)||CATEGORICAL_TYPES.has(type)||type===data_public_["ES_FIELD_TYPES"].BOOLEAN);const containsRegressionFieldsCb=({name:name,type:type})=>!field_types["d"].includes(name)&&name!==types_fields["a"]&&(common_fields["a"].has(type)||common_fields["b"].has(type));const containsOutlierFieldsCb=({name:name,type:type})=>!field_types["d"].includes(name)&&name!==types_fields["a"]&&common_fields["a"].has(type);const callbacks={[analytics["b"].CLASSIFICATION]:containsClassificationFieldsCb,[analytics["b"].REGRESSION]:containsRegressionFieldsCb,[analytics["b"].OUTLIER_DETECTION]:containsOutlierFieldsCb};const supported_fields_message_messages={[analytics["b"].CLASSIFICATION]:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.create.sourceObjectClassificationHelpText",defaultMessage:"This index pattern does not contain any supported fields. Classification jobs require categorical, numeric, or boolean fields."}),[analytics["b"].REGRESSION]:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.create.sourceObjectRegressionHelpText",defaultMessage:"This index pattern does not contain any supported fields. Regression jobs require numeric fields."}),[analytics["b"].OUTLIER_DETECTION]:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.create.sourceObjectHelpText",defaultMessage:"This index pattern does not contain any numeric type fields. The analytics job may not be able to come up with any outliers."})};const SupportedFieldsMessage=({jobType:jobType})=>{const[sourceIndexContainsSupportedFields,setSourceIndexContainsSupportedFields]=Object(external_kbnSharedDeps_React_["useState"])(true);const[sourceIndexFieldsCheckFailed,setSourceIndexFieldsCheckFailed]=Object(external_kbnSharedDeps_React_["useState"])(false);const{fields:fields}=new_job_capabilities_service["c"];const validateFields=()=>{if(fields&&jobType!==undefined){try{const containsSupportedFields=fields.some(callbacks[jobType]);setSourceIndexContainsSupportedFields(containsSupportedFields);setSourceIndexFieldsCheckFailed(false)}catch(e){setSourceIndexFieldsCheckFailed(true)}}};Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(jobType!==undefined){setSourceIndexContainsSupportedFields(true);setSourceIndexFieldsCheckFailed(false);validateFields()}},[jobType]);if(sourceIndexContainsSupportedFields===true)return null;if(sourceIndexFieldsCheckFailed===true){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.create.sourceIndexFieldsCheckError",defaultMessage:"There was a problem checking for supported fields for job type. Please refresh the page and try again."}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}))}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",color:"danger"},jobType!==undefined&&supported_fields_message_messages[jobType]),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}))};var external_kbnSharedDeps_ElasticEuiLibServices_=__webpack_require__(47);var custom_selection_table=__webpack_require__(388);const minimumFieldsMessage=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.analysisFieldsTable.minimumFieldsMessage",{defaultMessage:"At least one field must be selected."});const analysis_fields_table_columns=[{id:"checkbox",isCheckbox:true,textOnly:false,width:"32px"},{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.analysisFieldsTable.fieldNameColumn",{defaultMessage:"Field name"}),id:"name",isSortable:true,alignment:external_kbnSharedDeps_ElasticEuiLibServices_["LEFT_ALIGNMENT"]},{id:"mapping_types",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.analyticsTable.mappingColumn",{defaultMessage:"Mapping"}),isSortable:false,alignment:external_kbnSharedDeps_ElasticEuiLibServices_["LEFT_ALIGNMENT"]},{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.analyticsTable.isIncludedColumn",{defaultMessage:"Is included"}),id:"is_included",alignment:external_kbnSharedDeps_ElasticEuiLibServices_["LEFT_ALIGNMENT"],isSortable:true,render:({is_included:is_included})=>is_included?"Yes":"No"},{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.analyticsTable.isRequiredColumn",{defaultMessage:"Is required"}),id:"is_required",alignment:external_kbnSharedDeps_ElasticEuiLibServices_["LEFT_ALIGNMENT"],isSortable:true,render:({is_required:is_required})=>is_required?"Yes":"No"},{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.analyticsTable.reasonColumn",{defaultMessage:"Reason"}),id:"reason",alignment:external_kbnSharedDeps_ElasticEuiLibServices_["LEFT_ALIGNMENT"],isSortable:false}];const checkboxDisabledCheck=item=>item.is_required===true||item.reason&&item.reason.includes("unsupported type");const AnalysisFieldsTable=({dependentVariable:dependentVariable,includes:includes,loadingItems:loadingItems,setFormState:setFormState,minimumFieldsRequiredMessage:minimumFieldsRequiredMessage,setMinimumFieldsRequiredMessage:setMinimumFieldsRequiredMessage,tableItems:tableItems,unsupportedFieldsError:unsupportedFieldsError,setUnsupportedFieldsError:setUnsupportedFieldsError})=>{const[sortableProperties,setSortableProperties]=Object(external_kbnSharedDeps_React_["useState"])();const[currentPaginationData,setCurrentPaginationData]=Object(external_kbnSharedDeps_React_["useState"])({pageIndex:0,itemsPerPage:5});Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(includes.length===0&&tableItems.length>0){const includedFields=[];tableItems.forEach(field=>{if(field.is_included===true){includedFields.push(field.name)}});setFormState({includes:includedFields})}else if(includes.length>0){setFormState({includes:includes})}setMinimumFieldsRequiredMessage(undefined)},[tableItems]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{let sortablePropertyItems=[];const defaultSortProperty="name";sortablePropertyItems=[{name:"name",getValue:item=>item.name.toLowerCase(),isAscending:true},{name:"is_included",getValue:item=>item.is_included,isAscending:true},{name:"is_required",getValue:item=>item.is_required,isAscending:true}];const sortableProps=new external_kbnSharedDeps_ElasticEuiLibServices_["SortableProperties"](sortablePropertyItems,defaultSortProperty);setSortableProperties(sortableProps)},[]);const filters=[{type:"field_value_toggle_group",field:"is_included",items:[{value:true,name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.isIncludedOption",{defaultMessage:"Is included"})},{value:false,name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.isNotIncludedOption",{defaultMessage:"Is not included"})}]}];return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{"data-test-subj":"mlAnalyticsCreateJobWizardIncludesTable",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.includedFieldsLabel",{defaultMessage:"Included fields"}),fullWidth:true,isInvalid:minimumFieldsRequiredMessage!==undefined||unsupportedFieldsError!==undefined,error:[...minimumFieldsRequiredMessage!==undefined?[minimumFieldsRequiredMessage]:[],...unsupportedFieldsError!==undefined?[external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.unsupportedFieldsError",{defaultMessage:"Invalid. {message}",values:{message:unsupportedFieldsError}})]:[]]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null)),tableItems.length>0&&minimumFieldsRequiredMessage===undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.includedFieldsCount",{defaultMessage:"{numFields, plural, one {# field} other {# fields}} included in the analysis",values:{numFields:includes.length}})),tableItems.length===0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.calloutTitle",{defaultMessage:"Analysis fields not available"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.create.calloutMessage",defaultMessage:"Additional data required to load analysis fields."})),tableItems.length>0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],{paddingSize:"m","data-test-subj":"mlAnalyticsCreateJobWizardIncludesSelect"},external_kbnSharedDeps_React_default.a.createElement(custom_selection_table["a"],{currentPage:currentPaginationData.pageIndex,"data-test-subj":"mlAnalyticsCreationAnalysisFieldsTable",checkboxDisabledCheck:checkboxDisabledCheck,columns:analysis_fields_table_columns,filters:filters,items:tableItems,itemsPerPage:currentPaginationData.itemsPerPage,onTableChange:selection=>{if(dependentVariable!==undefined&&dependentVariable!==""&&selection.length===0){selection=[dependentVariable]}if(selection.length===0){setMinimumFieldsRequiredMessage(minimumFieldsMessage);setUnsupportedFieldsError(undefined)}else{setMinimumFieldsRequiredMessage(undefined);setFormState({includes:selection})}},selectedIds:includes,setCurrentPaginationData:setCurrentPaginationData,singleSelection:false,sortableProperties:sortableProperties,tableItemId:"name"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null))};const useIndexData=(indexPattern,query,toastNotifications)=>{const indexPatternFields=Object(external_kbnSharedDeps_React_["useMemo"])(()=>Object(data_grid["l"])(indexPattern),[indexPattern]);const columns=[...indexPatternFields.map(id=>{const field=indexPattern.fields.getByName(id);const schema=Object(data_grid["i"])(field);return{id:id,schema:schema,isExpandable:schema!=="boolean"}})];const dataGrid=Object(data_grid["q"])(columns);const{pagination:pagination,resetPagination:resetPagination,setErrorMessage:setErrorMessage,setRowCount:setRowCount,setRowCountRelation:setRowCountRelation,setStatus:setStatus,setTableItems:setTableItems,sortingColumns:sortingColumns,tableItems:tableItems}=dataGrid;Object(external_kbnSharedDeps_React_["useEffect"])(()=>{resetPagination()},[JSON.stringify(query)]);const getIndexData=async function(){setErrorMessage("");setStatus(analytics["e"].LOADING);const sort=sortingColumns.reduce((s,column)=>{s[column.id]={order:column.direction};return s},{});const esSearchRequest={index:indexPattern.title,body:{query:query,from:pagination.pageIndex*pagination.pageSize,size:pagination.pageSize,fields:["*"],_source:false,...Object.keys(sort).length>0?{sort:sort}:{},...Object(data_grid_common["l"])(indexPatternFields,indexPattern)}};try{const resp=await ml_api_service["ml"].esSearch(esSearchRequest);const docs=resp.hits.hits.map(d=>Object(data_grid["m"])(d.fields));setRowCount(resp.hits.total.value);setRowCountRelation(resp.hits.total.relation);setTableItems(docs);setStatus(analytics["e"].LOADED)}catch(e){setErrorMessage(Object(util_errors["i"])(e));setStatus(analytics["e"].ERROR)}};Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(query!==undefined){getIndexData()}},[indexPattern.title,indexPatternFields,JSON.stringify([query,pagination,sortingColumns])]);const dataLoader=Object(external_kbnSharedDeps_React_["useMemo"])(()=>new data_loader_DataLoader(indexPattern,toastNotifications),[indexPattern]);const fetchColumnChartsData=async function(fieldHistogramsQuery){try{const columnChartsData=await dataLoader.loadFieldHistograms(columns.filter(cT=>dataGrid.visibleColumns.includes(cT.id)).map(cT=>({fieldName:cT.id,type:Object(data_grid["k"])(cT.schema)})),fieldHistogramsQuery);dataGrid.setColumnCharts(columnChartsData)}catch(e){Object(data_grid["p"])(e,toastNotifications)}};Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(dataGrid.chartsVisible&&query!==undefined){fetchColumnChartsData(query)}},[dataGrid.chartsVisible,indexPattern.title,JSON.stringify([query,dataGrid.visibleColumns])]);const renderCellValue=Object(data_grid["r"])(indexPattern,pagination,tableItems);return{...dataGrid,renderCellValue:renderCellValue}};function useSavedSearch(){const[savedSearchQuery,setSavedSearchQuery]=Object(external_kbnSharedDeps_React_["useState"])(undefined);const[savedSearchQueryStr,setSavedSearchQueryStr]=Object(external_kbnSharedDeps_React_["useState"])(undefined);const mlContext=Object(ml["b"])();const{currentSavedSearch:currentSavedSearch,currentIndexPattern:currentIndexPattern,kibanaConfig:kibanaConfig}=mlContext;const getQueryData=()=>{let qry;let qryString;if(currentSavedSearch!==null){const{query:query}=Object(index_utils["f"])(currentSavedSearch);const queryLanguage=query.language;qryString=query.query;if(queryLanguage===constants_search["c"].KUERY){const ast=data_public_["esKuery"].fromKueryExpression(qryString);qry=data_public_["esKuery"].toElasticsearchQuery(ast,currentIndexPattern)}else{qry=data_public_["esQuery"].luceneStringToDsl(qryString);data_public_["esQuery"].decorateQuery(qry,kibanaConfig.get("query:queryString:options"))}setSavedSearchQuery(qry);setSavedSearchQueryStr(qryString)}else{setSavedSearchQuery(null);setSavedSearchQueryStr(null)}};Object(external_kbnSharedDeps_React_["useEffect"])(()=>{getQueryData()},[]);return{savedSearchQuery:savedSearchQuery,savedSearchQueryStr:savedSearchQueryStr}}function getIndexDataQuery(savedSearchQuery,jobConfigQuery){if(savedSearchQuery===undefined){return}return savedSearchQuery!==null?savedSearchQuery:jobConfigQuery}const requiredFieldsErrorText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.createWizard.requiredFieldsErrorMessage",{defaultMessage:"At least one field must be included in the analysis in addition to the dependent variable."});const maxRuntimeFieldsDisplayCount=5;const ConfigurationStepForm=({actions:actions,state:state,setCurrentStep:setCurrentStep})=>{const mlContext=Object(ml["b"])();const{currentSavedSearch:currentSavedSearch,currentIndexPattern:currentIndexPattern}=mlContext;const{savedSearchQuery:savedSearchQuery,savedSearchQueryStr:savedSearchQueryStr}=useSavedSearch();const[loadingFieldOptions,setLoadingFieldOptions]=Object(external_kbnSharedDeps_React_["useState"])(false);const[fieldOptionsFetchFail,setFieldOptionsFetchFail]=Object(external_kbnSharedDeps_React_["useState"])(false);const[loadingDepVarOptions,setLoadingDepVarOptions]=Object(external_kbnSharedDeps_React_["useState"])(false);const[dependentVariableFetchFail,setDependentVariableFetchFail]=Object(external_kbnSharedDeps_React_["useState"])(false);const[dependentVariableOptions,setDependentVariableOptions]=Object(external_kbnSharedDeps_React_["useState"])([]);const[includesTableItems,setIncludesTableItems]=Object(external_kbnSharedDeps_React_["useState"])([]);const[fetchingExplainData,setFetchingExplainData]=Object(external_kbnSharedDeps_React_["useState"])(false);const[maxDistinctValuesError,setMaxDistinctValuesError]=Object(external_kbnSharedDeps_React_["useState"])();const[unsupportedFieldsError,setUnsupportedFieldsError]=Object(external_kbnSharedDeps_React_["useState"])();const[minimumFieldsRequiredMessage,setMinimumFieldsRequiredMessage]=Object(external_kbnSharedDeps_React_["useState"])();const{setEstimatedModelMemoryLimit:setEstimatedModelMemoryLimit,setFormState:setFormState}=actions;const{estimatedModelMemoryLimit:estimatedModelMemoryLimit,form:form,isJobCreated:isJobCreated,requestMessages:requestMessages}=state;const firstUpdate=Object(external_kbnSharedDeps_React_["useRef"])(true);const{dependentVariable:dependentVariable,includes:includes,jobConfigQuery:jobConfigQuery,jobConfigQueryString:jobConfigQueryString,jobType:jobType,modelMemoryLimit:modelMemoryLimit,previousJobType:previousJobType,requiredFieldsError:requiredFieldsError,sourceIndex:sourceIndex,trainingPercent:trainingPercent,useEstimatedMml:useEstimatedMml}=form;const[query,setQuery]=Object(external_kbnSharedDeps_React_["useState"])({query:jobConfigQueryString!==null&&jobConfigQueryString!==void 0?jobConfigQueryString:"",language:constants_search["c"].KUERY});const toastNotifications=Object(dependency_cache["j"])();const setJobConfigQuery=update=>{if(update.query){setFormState({jobConfigQuery:update.query,jobConfigQueryString:update.queryString})}setQuery({query:update.queryString,language:update.language})};const indexData=useIndexData(currentIndexPattern,getIndexDataQuery(savedSearchQuery,jobConfigQuery),toastNotifications);const indexPreviewProps={...indexData,dataTestSubj:"mlAnalyticsCreationDataGrid",toastNotifications:toastNotifications};const isJobTypeWithDepVar=jobType===analytics["b"].REGRESSION||jobType===analytics["b"].CLASSIFICATION;const dependentVariableEmpty=isJobTypeWithDepVar&&dependentVariable==="";const isStepInvalid=dependentVariableEmpty||jobType===undefined||maxDistinctValuesError!==undefined||minimumFieldsRequiredMessage!==undefined||requiredFieldsError!==undefined||unsupportedFieldsError!==undefined||fetchingExplainData;const loadDepVarOptions=async formState=>{setLoadingDepVarOptions(true);setMaxDistinctValuesError(undefined);try{if(currentIndexPattern!==undefined){const depVarOptions=[];let depVarUpdate=dependentVariable;const{fields:fields}=new_job_capabilities_service["c"];let resetDependentVariable=true;for(const field of fields){if(shouldAddAsDepVarOption(field,jobType)){depVarOptions.push({label:field.id});if(formState.dependentVariable===field.id){resetDependentVariable=false}}}if(resetDependentVariable){depVarUpdate=""}setDependentVariableOptions(depVarOptions);setLoadingDepVarOptions(false);setDependentVariableFetchFail(false);setFormState({dependentVariable:depVarUpdate})}}catch(e){setLoadingDepVarOptions(false);setDependentVariableFetchFail(true)}};const debouncedGetExplainData=Object(external_kbnSharedDeps_Lodash_["debounce"])(async()=>{setFetchingExplainData(true);const jobTypeChanged=previousJobType!==jobType;const shouldUpdateModelMemoryLimit=(!firstUpdate.current||!modelMemoryLimit)&&useEstimatedMml===true;const shouldUpdateEstimatedMml=!firstUpdate.current||!modelMemoryLimit||estimatedModelMemoryLimit==="";if(firstUpdate.current){firstUpdate.current=false}if(jobTypeChanged){setLoadingFieldOptions(true)}const{success:success,expectedMemory:expectedMemory,fieldSelection:fieldSelection,errorMessage:errorMessage}=await fetchExplainData(form);if(success){if(shouldUpdateEstimatedMml){setEstimatedModelMemoryLimit(expectedMemory)}const hasRequiredFields=fieldSelection.some(field=>field.is_included===true&&field.is_required===false);if(jobTypeChanged){setLoadingFieldOptions(false);setFieldOptionsFetchFail(false);setMaxDistinctValuesError(undefined);setUnsupportedFieldsError(undefined);setIncludesTableItems(fieldSelection?fieldSelection:[]);setFormState({...shouldUpdateModelMemoryLimit?{modelMemoryLimit:expectedMemory}:{},requiredFieldsError:!hasRequiredFields?requiredFieldsErrorText:undefined})}else{setFormState({...shouldUpdateModelMemoryLimit?{modelMemoryLimit:expectedMemory}:{},requiredFieldsError:!hasRequiredFields?requiredFieldsErrorText:undefined})}setFetchingExplainData(false)}else{let maxDistinctValuesErrorMessage;let unsupportedFieldsErrorMessage;if(jobType===analytics["b"].CLASSIFICATION&&(errorMessage.includes("must have at most")||errorMessage.includes("must have at least"))){maxDistinctValuesErrorMessage=errorMessage}else if(errorMessage.includes("status_exception")&&errorMessage.includes("unsupported type")){unsupportedFieldsErrorMessage=errorMessage}else if(errorMessage.includes("status_exception")&&errorMessage.includes("Unable to estimate memory usage as no documents")){toastNotifications.addWarning(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.allDocsMissingFieldsErrorMessage",{defaultMessage:`Unable to estimate memory usage. There are mapped fields for source index [{index}] that do not exist in any indexed documents. You will have to switch to the JSON editor for explicit field selection and include only fields that exist in indexed documents.`,values:{index:sourceIndex}}))}else{toastNotifications.addDanger({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.unableToFetchExplainDataMessage",{defaultMessage:"An error occurred fetching analysis fields data."}),text:errorMessage})}const fallbackModelMemoryLimit=jobType!==undefined?use_create_analytics_form_state["a"][jobType]:use_create_analytics_form_state["a"].outlier_detection;setEstimatedModelMemoryLimit(fallbackModelMemoryLimit);setLoadingFieldOptions(false);setFieldOptionsFetchFail(true);setMaxDistinctValuesError(maxDistinctValuesErrorMessage);setUnsupportedFieldsError(unsupportedFieldsErrorMessage);setFetchingExplainData(false);setFormState({...shouldUpdateModelMemoryLimit?{modelMemoryLimit:fallbackModelMemoryLimit}:{}})}},300);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setFormState({sourceIndex:currentIndexPattern.title})},[]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(typeof savedSearchQueryStr==="string"){setFormState({jobConfigQuery:savedSearchQuery,jobConfigQueryString:savedSearchQueryStr})}},[JSON.stringify(savedSearchQuery),savedSearchQueryStr]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(isJobTypeWithDepVar){loadDepVarOptions(form)}},[jobType]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const hasBasicRequiredFields=jobType!==undefined;const hasRequiredAnalysisFields=isJobTypeWithDepVar&&dependentVariable!==""||jobType===analytics["b"].OUTLIER_DETECTION;if(hasBasicRequiredFields&&hasRequiredAnalysisFields){debouncedGetExplainData()}return()=>{debouncedGetExplainData.cancel()}},[jobType,dependentVariable,trainingPercent,JSON.stringify(includes),jobConfigQueryString]);const unsupportedRuntimeFields=Object(external_kbnSharedDeps_React_["useMemo"])(()=>currentIndexPattern.fields.getAll().filter(f=>f.runtimeField).map(f=>`'${f.displayName}'`),[currentIndexPattern.fields]);const scatterplotMatrixProps=Object(external_kbnSharedDeps_React_["useMemo"])(()=>({color:isJobTypeWithDepVar?dependentVariable:undefined,fields:includesTableItems.filter(d=>d.feature_type==="numerical"&&d.is_included).map(d=>d.name),index:currentIndexPattern.title,legendType:Object(get_scatterplot_matrix_legend_type["a"])(jobType),searchQuery:jobConfigQuery}),[currentIndexPattern.title,dependentVariable,includesTableItems,isJobTypeWithDepVar,jobConfigQuery,jobType]);const showScatterplotMatrix=Object(external_kbnSharedDeps_React_["useMemo"])(()=>(jobType===analytics["b"].OUTLIER_DETECTION||isJobTypeWithDepVar&&!dependentVariableEmpty)&&scatterplotMatrixProps.fields.length>1,[dependentVariableEmpty,jobType,scatterplotMatrixProps.fields.length]);if(savedSearchQuery===undefined)return null;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(Messages,{messages:requestMessages}),external_kbnSharedDeps_React_default.a.createElement(SupportedFieldsMessage,{jobType:jobType}),external_kbnSharedDeps_React_default.a.createElement(JobType,{type:jobType,setFormState:setFormState}),savedSearchQuery===null&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.sourceQueryLabel",{defaultMessage:"Query"}),fullWidth:true},external_kbnSharedDeps_React_default.a.createElement(ExplorationQueryBar,{indexPattern:currentIndexPattern,setSearchQuery:setJobConfigQuery,query:query})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,savedSearchQuery!==null&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.savedSearchLabel",{defaultMessage:"Saved search"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBadge"],{color:"hollow"},savedSearchQuery!==null?currentSavedSearch===null||currentSavedSearch===void 0?void 0:currentSavedSearch.attributes.title:currentIndexPattern.title)),fullWidth:true},external_kbnSharedDeps_React_default.a.createElement(data_grid["a"],indexPreviewProps)),isJobTypeWithDepVar&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true,label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.dependentVariableLabel",{defaultMessage:"Dependent variable"}),helpText:dependentVariableOptions.length===0&&dependentVariableFetchFail===false&&currentIndexPattern&&external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.dependentVariableOptionsNoNumericalFields",{defaultMessage:"No numeric type fields were found for this index pattern."}),isInvalid:maxDistinctValuesError!==undefined,error:[...dependentVariableFetchFail===true?[external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.dependentVariableOptionsFetchError",{defaultMessage:"There was a problem fetching fields. Please refresh the page and try again."}))]:[],...fieldOptionsFetchFail===true&&maxDistinctValuesError!==undefined?[external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.dependentVariableMaxDistictValuesError",{defaultMessage:"Invalid. {message}",values:{message:maxDistinctValuesError}}))]:[]]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{fullWidth:true,"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.dependentVariableInputAriaLabel",{defaultMessage:"Enter field to be used as dependent variable."}),placeholder:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.dependentVariablePlaceholder",{defaultMessage:"dependent variable"}),isDisabled:isJobCreated,isLoading:loadingDepVarOptions,singleSelection:true,options:dependentVariableOptions,selectedOptions:dependentVariable?[{label:dependentVariable}]:[],onChange:selectedOptions=>setFormState({dependentVariable:selectedOptions[0].label||""}),isClearable:false,isInvalid:dependentVariable==="","data-test-subj":`mlAnalyticsCreateJobWizardDependentVariableSelect${loadingDepVarOptions?" loading":" loaded"}`}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true,isInvalid:requiredFieldsError!==undefined,error:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.requiredFieldsError",{defaultMessage:"Invalid. {message}",values:{message:requiredFieldsError}})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null)),Array.isArray(unsupportedRuntimeFields)&&unsupportedRuntimeFields.length>0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{size:"s",color:"warning"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.create.unsupportedRuntimeFieldsCallout",defaultMessage:"The runtime {runtimeFieldsCount, plural, one {field} other {fields}} {unsupportedRuntimeFields} {extraCountMsg} are not supported for analysis.",values:{runtimeFieldsCount:unsupportedRuntimeFields.length,extraCountMsg:unsupportedRuntimeFields.length-maxRuntimeFieldsDisplayCount>0?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.create.extraUnsupportedRuntimeFieldsMsg",defaultMessage:"and {count} more",values:{count:unsupportedRuntimeFields.length-maxRuntimeFieldsDisplayCount}}):"",unsupportedRuntimeFields:unsupportedRuntimeFields.slice(0,maxRuntimeFieldsDisplayCount).join(", ")}})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null)),external_kbnSharedDeps_React_default.a.createElement(AnalysisFieldsTable,{dependentVariable:dependentVariable,includes:includes,minimumFieldsRequiredMessage:minimumFieldsRequiredMessage,setMinimumFieldsRequiredMessage:setMinimumFieldsRequiredMessage,tableItems:includesTableItems,unsupportedFieldsError:unsupportedFieldsError,setUnsupportedFieldsError:setUnsupportedFieldsError,loadingItems:loadingFieldOptions,setFormState:setFormState}),showScatterplotMatrix&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{"data-test-subj":"mlAnalyticsCreateJobWizardScatterplotMatrixFormRow",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.scatterplotMatrixLabel",{defaultMessage:"Scatterplot matrix"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.scatterplotMatrixLabelHelpText",{defaultMessage:"Visualizes the relationships between pairs of selected included fields"}),fullWidth:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],{paddingSize:"m","data-test-subj":"mlAnalyticsCreateJobWizardScatterplotMatrixPanel"},external_kbnSharedDeps_React_default.a.createElement(ScatterplotMatrix,scatterplotMatrixProps)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null)),isJobTypeWithDepVar&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true,label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.trainingPercentLabel",{defaultMessage:"Training percent"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.trainingPercentHelpText",{defaultMessage:"Defines the percentage of eligible documents that will be used for training."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiRange"],{fullWidth:true,min:analytics["o"],max:analytics["n"],step:1,showLabels:true,showRange:true,showValue:true,value:trainingPercent,onChange:e=>setFormState({trainingPercent:+e.target.value}),"data-test-subj":"mlAnalyticsCreateJobWizardTrainingPercentSlider"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement(ContinueButton,{isDisabled:isStepInvalid,onClick:()=>{setCurrentStep(ANALYTICS_STEPS.ADVANCED)}}))};const ConfigurationStep=({actions:actions,state:state,setCurrentStep:setCurrentStep,step:step,stepActivated:stepActivated})=>{const showForm=step===ANALYTICS_STEPS.CONFIGURATION;const showDetails=step!==ANALYTICS_STEPS.CONFIGURATION&&stepActivated===true;const dataTestSubj=`mlAnalyticsCreateJobWizardConfigurationStep${showForm?" active":""}${showDetails?" summary":""}`;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiForm"],{className:"mlDataFrameAnalyticsCreateForm","data-test-subj":dataTestSubj},showForm&&external_kbnSharedDeps_React_default.a.createElement(ConfigurationStepForm,{actions:actions,state:state,setCurrentStep:setCurrentStep}),showDetails&&external_kbnSharedDeps_React_default.a.createElement(ConfigurationStepDetails,{setCurrentStep:setCurrentStep,state:state}))};const MAX_TREES_LIMIT=2e3;const HyperParameters=({actions:actions,state:state,advancedParamErrors:advancedParamErrors})=>{const{setFormState:setFormState}=actions;const{alpha:alpha,downsampleFactor:downsampleFactor,eta:eta,etaGrowthRatePerTree:etaGrowthRatePerTree,featureBagFraction:featureBagFraction,gamma:gamma,lambda:lambda,maxOptimizationRoundsPerHyperparameter:maxOptimizationRoundsPerHyperparameter,maxTrees:maxTrees,softTreeDepthLimit:softTreeDepthLimit,softTreeDepthTolerance:softTreeDepthTolerance}=state.form;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.lambdaLabel",{defaultMessage:"Lambda"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.lambdaHelpText",{defaultMessage:"A multiplier of the leaf weights in loss calculations. Must be a nonnegative value."}),isInvalid:advancedParamErrors[analytics["a"].LAMBDA]!==undefined,error:advancedParamErrors[analytics["a"].LAMBDA]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.lambdaInputAriaLabel",{defaultMessage:"A multiplier of leaf weights in loss calculations."}),"data-test-subj":"mlAnalyticsCreateJobFlyoutLambdaInput",onChange:e=>setFormState({lambda:e.target.value===""?undefined:+e.target.value}),step:.001,min:0,value:getNumberValue(lambda)}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.maxTreesLabel",{defaultMessage:"Max trees"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.maxTreesText",{defaultMessage:"The maximum number of decision trees in the forest."}),isInvalid:advancedParamErrors[analytics["a"].MAX_TREES]!==undefined,error:advancedParamErrors[analytics["a"].MAX_TREES]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.maxTreesInputAriaLabel",{defaultMessage:"The maximum number of decision trees in the forest."}),"data-test-subj":"mlAnalyticsCreateJobFlyoutMaxTreesInput",onChange:e=>setFormState({maxTrees:e.target.value===""?undefined:+e.target.value}),isInvalid:maxTrees!==undefined&&!Number.isInteger(maxTrees),step:1,min:1,max:MAX_TREES_LIMIT,value:getNumberValue(maxTrees)}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.gammaLabel",{defaultMessage:"Gamma"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.gammaText",{defaultMessage:"A multiplier of the tree size in loss calcuations. Must be nonnegative value."}),isInvalid:advancedParamErrors[analytics["a"].GAMMA]!==undefined,error:advancedParamErrors[analytics["a"].GAMMA]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.gammaInputAriaLabel",{defaultMessage:"A multiplier of the tree size in loss calculations."}),"data-test-subj":"mlAnalyticsCreateJobWizardGammaInput",onChange:e=>setFormState({gamma:e.target.value===""?undefined:+e.target.value}),step:.001,min:0,value:getNumberValue(gamma)}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.etaLabel",{defaultMessage:"Eta"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.etaText",{defaultMessage:"The shrinkage applied to the weights. Must be between 0.001 and 1."}),isInvalid:advancedParamErrors[analytics["a"].ETA]!==undefined,error:advancedParamErrors[analytics["a"].ETA]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.etaInputAriaLabel",{defaultMessage:"The shrinkage applied to the weights."}),"data-test-subj":"mlAnalyticsCreateJobWizardEtaInput",onChange:e=>setFormState({eta:e.target.value===""?undefined:+e.target.value}),step:.001,min:.001,max:1,value:getNumberValue(eta)}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.featureBagFractionLabel",{defaultMessage:"Feature bag fraction"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.featureBagFractionText",{defaultMessage:"The fraction of features used when selecting a random bag for each candidate split."}),isInvalid:advancedParamErrors[analytics["a"].FEATURE_BAG_FRACTION]!==undefined,error:advancedParamErrors[analytics["a"].FEATURE_BAG_FRACTION]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.featureBagFractionInputAriaLabel",{defaultMessage:"The fraction of features used when selecting a random bag for each candidate split"}),"data-test-subj":"mlAnalyticsCreateJobWizardFeatureBagFractionInput",onChange:e=>setFormState({featureBagFraction:e.target.value===""?undefined:+e.target.value}),isInvalid:featureBagFraction!==undefined&&(featureBagFraction>1||featureBagFraction<=0),step:.001,max:1,value:getNumberValue(featureBagFraction)}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.alphaLabel",{defaultMessage:"Alpha"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.alphaText",{defaultMessage:"A multiplier of the tree depth in loss calculations. Must be greater than or equal to 0."}),isInvalid:advancedParamErrors[analytics["a"].ALPHA]!==undefined,error:advancedParamErrors[analytics["a"].ALPHA]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.alphaInputAriaLabel",{defaultMessage:"A multiplier of the tree depth in loss calculations."}),"data-test-subj":"mlAnalyticsCreateJobWizardAlphaInput",onChange:e=>setFormState({alpha:e.target.value===""?undefined:+e.target.value}),step:.001,min:0,value:getNumberValue(alpha)}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.downsampleFactorLabel",{defaultMessage:"Downsample factor"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.downsampleFactorText",{defaultMessage:"The fraction of data used to compute derivatives of the loss function for tree training. Must be between 0 and 1."}),isInvalid:advancedParamErrors[analytics["a"].DOWNSAMPLE_FACTOR]!==undefined,error:advancedParamErrors[analytics["a"].DOWNSAMPLE_FACTOR]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.downsampleFactorInputAriaLabel",{defaultMessage:"The fraction of data used to compute derivatives of the loss function for tree training."}),"data-test-subj":"mlAnalyticsCreateJobWizardDownsampleFactorInput",onChange:e=>setFormState({downsampleFactor:e.target.value===""?undefined:+e.target.value}),step:.001,min:0,max:1,value:getNumberValue(downsampleFactor)}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.etaGrowthRatePerTreeLabel",{defaultMessage:"Eta growth rate per tree"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.etaGrowthRatePerTreeText",{defaultMessage:"The rate at which eta increases for each new tree that is added to the forest. Must be between 0.5 and 2."}),isInvalid:advancedParamErrors[analytics["a"].ETA_GROWTH_RATE_PER_TREE]!==undefined,error:advancedParamErrors[analytics["a"].ETA_GROWTH_RATE_PER_TREE]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.etaGrowthRatePerTreeInputAriaLabel",{defaultMessage:"The rate at which eta increases for each new tree that is added to the forest."}),"data-test-subj":"mlAnalyticsCreateJobWizardEtaGrowthRatePerTreeInput",onChange:e=>setFormState({etaGrowthRatePerTree:e.target.value===""?undefined:+e.target.value}),step:.001,min:.5,max:2,value:getNumberValue(etaGrowthRatePerTree)}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.maxOptimizationRoundsPerHyperparameterLabel",{defaultMessage:"Max optimization rounds per hyperparameter"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.maxOptimizationRoundsPerHyperparameterText",{defaultMessage:"The maximum number of optimization rounds for each undefined hyperparameter."}),isInvalid:advancedParamErrors[analytics["a"].MAX_OPTIMIZATION_ROUNDS_PER_HYPERPARAMETER]!==undefined,error:advancedParamErrors[analytics["a"].MAX_OPTIMIZATION_ROUNDS_PER_HYPERPARAMETER]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.maxOptimizationRoundsPerHyperparameterInputAriaLabel",{defaultMessage:"The maximum number of optimization rounds for each undefined hyperparameter. Must be an integer between 0 and 20."}),"data-test-subj":"mlAnalyticsCreateJobWizardMaxOptimizationRoundsPerHyperparameterInput",onChange:e=>setFormState({maxOptimizationRoundsPerHyperparameter:e.target.value===""?undefined:+e.target.value}),min:0,max:20,step:1,value:getNumberValue(maxOptimizationRoundsPerHyperparameter)}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.softTreeDepthLimitLabel",{defaultMessage:"Soft tree depth limit"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.softTreeDepthLimitText",{defaultMessage:"Decision trees that exceed this depth are penalized in loss calculations. Must be greater than or equal to 0. "}),isInvalid:advancedParamErrors[analytics["a"].SOFT_TREE_DEPTH_LIMIT]!==undefined,error:advancedParamErrors[analytics["a"].SOFT_TREE_DEPTH_LIMIT]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.softTreeDepthLimitInputAriaLabel",{defaultMessage:"Decision trees that exceed this depth are penalized in loss calculations."}),"data-test-subj":"mlAnalyticsCreateJobWizardSoftTreeDepthLimitInput",onChange:e=>setFormState({softTreeDepthLimit:e.target.value===""?undefined:+e.target.value}),step:.001,min:0,value:getNumberValue(softTreeDepthLimit)}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.softTreeDepthToleranceLabel",{defaultMessage:"Soft tree depth tolerance"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.softTreeDepthToleranceText",{defaultMessage:"Controls how quickly the loss increases when tree depths exceed soft limits. The smaller the value, the faster the loss increases. Must be greater than or equal to 0.01. "}),isInvalid:advancedParamErrors[analytics["a"].SOFT_TREE_DEPTH_TOLERANCE]!==undefined,error:advancedParamErrors[analytics["a"].SOFT_TREE_DEPTH_TOLERANCE]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.softTreeDepthToleranceInputAriaLabel",{defaultMessage:"Decision trees that exceed this depth are penalized in loss calculations."}),"data-test-subj":"mlAnalyticsCreateJobWizardSoftTreeDepthToleranceInput",onChange:e=>setFormState({softTreeDepthTolerance:e.target.value===""?undefined:+e.target.value}),step:.001,min:.01,value:getNumberValue(softTreeDepthTolerance)}))))};var reducer=__webpack_require__(394);const OutlierHyperParameters=({actions:actions,state:state,advancedParamErrors:advancedParamErrors})=>{const{setFormState:setFormState}=actions;const{method:method,nNeighbors:nNeighbors,outlierFraction:outlierFraction,standardizationEnabled:standardizationEnabled}=state.form;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.methodLabel",{defaultMessage:"Method"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.methodHelpText",{defaultMessage:"Sets the method that outlier detection uses. If not set, uses an ensemble of different methods and normalises and combines their individual outlier scores to obtain the overall outlier score. We recommend to use the ensemble method"}),isInvalid:advancedParamErrors[analytics["a"].METHOD]!==undefined,error:advancedParamErrors[analytics["a"].METHOD]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{options:Object.values(analytics["h"]).map(outlierMethod=>({value:outlierMethod,text:outlierMethod})),value:method,hasNoInitialSelection:true,onChange:e=>{setFormState({method:e.target.value})},"data-test-subj":"mlAnalyticsCreateJobWizardMethodInput"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.nNeighborsLabel",{defaultMessage:"N neighbors"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.nNeighborsHelpText",{defaultMessage:"The value for how many nearest neighbors each method of outlier detection will use to calculate its outlier score. When not set, different values will be used for different ensemble members. Must be a positive integer"}),isInvalid:advancedParamErrors[analytics["a"].N_NEIGHBORS]!==undefined,error:advancedParamErrors[analytics["a"].N_NEIGHBORS]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.nNeighborsInputAriaLabel",{defaultMessage:"The value for how many nearest neighbors each method of outlier detection will use to calculate its outlier score."}),"data-test-subj":"mlAnalyticsCreateJobWizardnNeighborsInput",onChange:e=>setFormState({nNeighbors:e.target.value===""?undefined:+e.target.value}),step:1,min:1,value:getNumberValue(nNeighbors)}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.outlierFractionLabel",{defaultMessage:"Outlier fraction"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.outlierFractionHelpText",{defaultMessage:"Sets the proportion of the data set that is assumed to be outlying prior to outlier detection."}),isInvalid:advancedParamErrors[analytics["a"].OUTLIER_FRACTION]!==undefined,error:advancedParamErrors[analytics["a"].OUTLIER_FRACTION]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.outlierFractionInputAriaLabel",{defaultMessage:"Sets the proportion of the data set that is assumed to be outlying prior to outlier detection."}),"data-test-subj":"mlAnalyticsCreateJobWizardoutlierFractionInput",onChange:e=>setFormState({outlierFraction:e.target.value===""?undefined:+e.target.value}),step:.001,min:0,max:1,value:getNumberValue(outlierFraction)}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.standardizationEnabledLabel",{defaultMessage:"Standardization enabled"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.standardizationEnabledHelpText",{defaultMessage:"If true, the following operation is performed on the columns before computing outlier scores: (x_i - mean(x_i)) / sd(x_i)."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.standardizationEnabledInputAriaLabel",{defaultMessage:"Sets standardization enabled setting."}),"data-test-subj":"mlAnalyticsCreateJobWizardStandardizationEnabledInput",options:[{value:"true",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.standardizationEnabledTrueValue",{defaultMessage:"True"})},{value:"false",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.standardizationEnabledFalseValue",{defaultMessage:"False"})}],value:standardizationEnabled,hasNoInitialSelection:true,onChange:e=>{setFormState({standardizationEnabled:e.target.value})}}))))};const defaultNumTopClassesOption={label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.allClassesLabel",{defaultMessage:"All classes"}),value:-1};const numClassesTypeMessage=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.create.numTopClassTypeWarning",defaultMessage:"Value must be an integer of -1 or greater, where -1 indicates all classes."});function getZeroClassesMessage(elasticUrl){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.create.zeroClassesMessage",defaultMessage:"To evaluate the {wikiLink}, select all classes or a value greater than the total number of categories.",values:{wikiLink:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{href:elasticUrl,target:"_blank",external:true},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.aucRocLabel",{defaultMessage:"AUC ROC"}))}})}function getTopClassesHelpText(currentNumTopClasses){if(currentNumTopClasses===-1){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.create.numTopClassesHelpText",defaultMessage:"The number of categories for which the predicted probabilities are reported."})," ",external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.create.allClassesMessage",defaultMessage:"If you have a large number of classes there could be a significant effect on the size of your destination index."}))}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.create.numTopClassesHelpText",defaultMessage:"The number of categories for which the predicted probabilities are reported."})}function getSelectedNumTomClassesOption(currentNumTopClasses){const option=[];if(currentNumTopClasses===-1){option.push(defaultNumTopClassesOption)}else if(currentNumTopClasses!==undefined){option.push({label:`${currentNumTopClasses}`})}return option}function isInvalidNumTopClasses(currentNumTopClasses){return currentNumTopClasses!==undefined&&(isNaN(currentNumTopClasses)||currentNumTopClasses<-1||currentNumTopClasses-Math.floor(currentNumTopClasses)!==0)}function getNumberValue(value){return value===undefined?"":+value}const AdvancedStepForm=({actions:actions,state:state,setCurrentStep:setCurrentStep})=>{var _numTopClassesSelecte;const[advancedParamErrors,setAdvancedParamErrors]=Object(external_kbnSharedDeps_React_["useState"])({});const[fetchingAdvancedParamErrors,setFetchingAdvancedParamErrors]=Object(external_kbnSharedDeps_React_["useState"])(false);const{services:{docLinks:docLinks}}=Object(contexts_kibana["b"])();const classAucRocDocLink=docLinks.links.ml.classificationAucRoc;const{setEstimatedModelMemoryLimit:setEstimatedModelMemoryLimit,setFormState:setFormState}=actions;const{form:form,isJobCreated:isJobCreated,estimatedModelMemoryLimit:estimatedModelMemoryLimit}=state;const{alpha:alpha,computeFeatureInfluence:computeFeatureInfluence,downsampleFactor:downsampleFactor,eta:eta,etaGrowthRatePerTree:etaGrowthRatePerTree,featureBagFraction:featureBagFraction,featureInfluenceThreshold:featureInfluenceThreshold,gamma:gamma,jobType:jobType,lambda:lambda,maxNumThreads:maxNumThreads,maxOptimizationRoundsPerHyperparameter:maxOptimizationRoundsPerHyperparameter,maxTrees:maxTrees,method:method,modelMemoryLimit:modelMemoryLimit,modelMemoryLimitValidationResult:modelMemoryLimitValidationResult,nNeighbors:nNeighbors,numTopClasses:numTopClasses,numTopFeatureImportanceValues:numTopFeatureImportanceValues,numTopFeatureImportanceValuesValid:numTopFeatureImportanceValuesValid,outlierFraction:outlierFraction,predictionFieldName:predictionFieldName,randomizeSeed:randomizeSeed,softTreeDepthLimit:softTreeDepthLimit,softTreeDepthTolerance:softTreeDepthTolerance,useEstimatedMml:useEstimatedMml}=form;const[numTopClassesOptions,setNumTopClassesOptions]=Object(external_kbnSharedDeps_React_["useState"])([defaultNumTopClassesOption]);const[numTopClassesSelectedOptions,setNumTopClassesSelectedOptions]=Object(external_kbnSharedDeps_React_["useState"])(getSelectedNumTomClassesOption(numTopClasses));const selectedNumTopClasses=numTopClassesSelectedOptions[0]&&((_numTopClassesSelecte=numTopClassesSelectedOptions[0].value)!==null&&_numTopClassesSelecte!==void 0?_numTopClassesSelecte:Number(numTopClassesSelectedOptions[0].label));const selectedNumTopClassesIsInvalid=isInvalidNumTopClasses(selectedNumTopClasses);const mmlErrors=Object(external_kbnSharedDeps_React_["useMemo"])(()=>Object(reducer["a"])(modelMemoryLimitValidationResult),[modelMemoryLimitValidationResult]);const isRegOrClassJob=jobType===analytics["b"].REGRESSION||jobType===analytics["b"].CLASSIFICATION;const mmlInvalid=modelMemoryLimitValidationResult!==null&&(modelMemoryLimitValidationResult.invalidUnits!==undefined||modelMemoryLimitValidationResult.required===true);const isStepInvalid=selectedNumTopClassesIsInvalid||mmlInvalid||Object.keys(advancedParamErrors).length>0||fetchingAdvancedParamErrors===true||maxNumThreads===0;Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setFetchingAdvancedParamErrors(true);(async function(){const{success:success,errorMessage:errorMessage,errorReason:errorReason,expectedMemory:expectedMemory}=await fetchExplainData(form);const paramErrors={};if(success){if(modelMemoryLimit!==expectedMemory){setEstimatedModelMemoryLimit(expectedMemory);if(useEstimatedMml===true){setFormState({modelMemoryLimit:expectedMemory})}}}else{Object.values(analytics["a"]).forEach(param=>{if(errorMessage.includes(`[${param}]`)){paramErrors[param]=errorMessage}else if(errorReason!==null&&errorReason!==void 0&&errorReason.includes(`[${param}]`)){paramErrors[param]=errorReason}})}setFetchingAdvancedParamErrors(false);setAdvancedParamErrors(paramErrors)})()},[alpha,downsampleFactor,eta,etaGrowthRatePerTree,featureBagFraction,featureInfluenceThreshold,gamma,lambda,maxNumThreads,maxOptimizationRoundsPerHyperparameter,maxTrees,method,nNeighbors,numTopClasses,numTopFeatureImportanceValues,outlierFraction,randomizeSeed,softTreeDepthLimit,softTreeDepthTolerance]);const outlierDetectionAdvancedConfig=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.computeFeatureInfluenceLabel",{defaultMessage:"Compute feature influence"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.computeFeatureInfluenceLabelHelpText",{defaultMessage:"Specifies whether the feature influence calculation is enabled. Defaults to true."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{"data-test-subj":"mlAnalyticsCreateJobWizardComputeFeatureInfluenceLabelInput",options:[{value:"true",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.computeFeatureInfluenceTrueValue",{defaultMessage:"True"})},{value:"false",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.computeFeatureInfluenceFalseValue",{defaultMessage:"False"})}],value:computeFeatureInfluence,hasNoInitialSelection:false,onChange:e=>{setFormState({computeFeatureInfluence:e.target.value})}}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.featureInfluenceThresholdLabel",{defaultMessage:"Feature influence threshold"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.featureInfluenceThresholdHelpText",{defaultMessage:"The minimum outlier score that a document needs to have in order to calculate its feature influence score. Value range: 0-1. Defaults to 0.1."}),isInvalid:advancedParamErrors[analytics["a"].FEATURE_INFLUENCE_THRESHOLD]!==undefined,error:advancedParamErrors[analytics["a"].FEATURE_INFLUENCE_THRESHOLD]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{onChange:e=>setFormState({featureInfluenceThreshold:e.target.value===""?undefined:+e.target.value}),"data-test-subj":"mlAnalyticsCreateJobWizardFeatureInfluenceThresholdInput",min:0,max:1,step:.001,value:getNumberValue(featureInfluenceThreshold)}))));const regAndClassAdvancedConfig=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.numTopFeatureImportanceValuesLabel",{defaultMessage:"Feature importance values"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.numTopFeatureImportanceValuesHelpText",{defaultMessage:"Specify the maximum number of feature importance values per document to return."}),isInvalid:numTopFeatureImportanceValuesValid===false,error:[...numTopFeatureImportanceValuesValid===false?[external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.numTopFeatureImportanceValuesErrorText",{defaultMessage:"Invalid maximum number of feature importance values."}))]:[]]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.numTopFeatureImportanceValuesInputAriaLabel",{defaultMessage:"Maximum number of feature importance values per document."}),"data-test-subj":"mlAnalyticsCreateJobFlyoutnumTopFeatureImportanceValuesInput",isInvalid:numTopFeatureImportanceValuesValid===false,min:analytics["g"],onChange:e=>setFormState({numTopFeatureImportanceValues:e.target.value===""?undefined:+e.target.value}),step:1,value:getNumberValue(numTopFeatureImportanceValues)}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.predictionFieldNameLabel",{defaultMessage:"Prediction field name"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.predictionFieldNameHelpText",{defaultMessage:"Defines the name of the prediction field in the results. Defaults to <dependent_variable>_prediction."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{disabled:isJobCreated,value:predictionFieldName,onChange:e=>setFormState({predictionFieldName:e.target.value}),"data-test-subj":"mlAnalyticsCreateJobWizardPredictionFieldNameInput"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.randomizeSeedLabel",{defaultMessage:"Randomize seed"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.randomizeSeedText",{defaultMessage:"The seed for the random generator used to pick training data."}),isInvalid:advancedParamErrors[analytics["a"].RANDOMIZE_SEED]!==undefined,error:advancedParamErrors[analytics["a"].RANDOMIZE_SEED]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.randomizeSeedInputAriaLabel",{defaultMessage:"The seed for the random generator used to pick training data."}),"data-test-subj":"mlAnalyticsCreateJobWizardRandomizeSeedInput",onChange:e=>setFormState({randomizeSeed:e.target.value===""?undefined:+e.target.value}),isInvalid:randomizeSeed!==undefined&&typeof randomizeSeed!=="number",value:getNumberValue(randomizeSeed),step:1}))));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h3",null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.advancedConfigSectionTitle",{defaultMessage:"Advanced configuration"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGrid"],{columns:3},jobType===analytics["b"].OUTLIER_DETECTION&&outlierDetectionAdvancedConfig,isRegOrClassJob&&regAndClassAdvancedConfig,jobType===analytics["b"].CLASSIFICATION&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.numTopClassesLabel",{defaultMessage:"Top classes"}),helpText:getTopClassesHelpText(selectedNumTopClasses),isInvalid:selectedNumTopClasses===0||selectedNumTopClassesIsInvalid,error:[...selectedNumTopClasses===0?[getZeroClassesMessage(classAucRocDocLink)]:[],...selectedNumTopClassesIsInvalid?[numClassesTypeMessage]:[]]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.numTopClassesInputAriaLabel",{defaultMessage:"The number of categories for which the predicted probabilities are reported"}),singleSelection:true,options:numTopClassesOptions,selectedOptions:numTopClassesSelectedOptions,onCreateOption:(input,flattenedOptions=[])=>{const normalizedInput=input.trim().toLowerCase();if(normalizedInput===""){return}const newOption={label:input};if(flattenedOptions.findIndex(option=>option.label.trim().toLowerCase()===normalizedInput)===-1){setNumTopClassesOptions([...numTopClassesOptions,newOption])}setNumTopClassesSelectedOptions([newOption])},onChange:selectedOptions=>{setNumTopClassesSelectedOptions(selectedOptions)},isClearable:true,isInvalid:selectedNumTopClasses!==undefined&&selectedNumTopClasses<-1,"data-test-subj":"mlAnalyticsCreateJobWizardnumTopClassesInput"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.modelMemoryLimitLabel",{defaultMessage:"Model memory limit"}),isInvalid:modelMemoryLimitValidationResult!==null,error:mmlErrors,helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.modelMemoryLimitHelpText",{defaultMessage:"The approximate maximum amount of memory resources that are permitted for analytical processing."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{placeholder:jobType!==undefined?use_create_analytics_form_state["a"][jobType]:use_create_analytics_form_state["a"].outlier_detection,disabled:isJobCreated||useEstimatedMml,value:useEstimatedMml?estimatedModelMemoryLimit:modelMemoryLimit||"",onChange:e=>setFormState({modelMemoryLimit:e.target.value}),isInvalid:modelMemoryLimitValidationResult!==null,"data-test-subj":"mlAnalyticsCreateJobWizardModelMemoryInput"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{disabled:isJobCreated,name:"mlDataFrameAnalyticsUseEstimatedMml",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.useEstimatedMmlLabel",{defaultMessage:"Use estimated model memory limit"}),checked:useEstimatedMml===true,onChange:()=>setFormState({useEstimatedMml:!useEstimatedMml}),"data-test-subj":"mlAnalyticsCreateJobWizardUseEstimatedMml"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.maxNumThreadsLabel",{defaultMessage:"Maximum number of threads"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.maxNumThreadsHelpText",{defaultMessage:"The maximum number of threads to be used by the analysis. The default value is 1"}),isInvalid:maxNumThreads===0,error:maxNumThreads===0&&external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.maxNumThreadsError",{defaultMessage:"The minimum value is 1."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.maxNumThreadsInputAriaLabel",{defaultMessage:"The maximum number of threads to be used by the analysis."}),"data-test-subj":"mlAnalyticsCreateJobWizardMaxNumThreadsInput",min:1,onChange:e=>setFormState({maxNumThreads:e.target.value===""?undefined:+e.target.value}),step:1,value:getNumberValue(maxNumThreads)})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiAccordion"],{id:"hyper-parameters",buttonContent:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h3",null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.hyperParametersSectionTitle",{defaultMessage:"Hyperparameters"}))),initialIsOpen:false,"data-test-subj":"mlAnalyticsCreateJobWizardHyperParametersSection"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGrid"],{columns:3},jobType===analytics["b"].OUTLIER_DETECTION&&external_kbnSharedDeps_React_default.a.createElement(OutlierHyperParameters,{actions:actions,state:state,advancedParamErrors:advancedParamErrors}),isRegOrClassJob&&external_kbnSharedDeps_React_default.a.createElement(HyperParameters,{actions:actions,state:state,advancedParamErrors:advancedParamErrors}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement(ContinueButton,{isDisabled:isStepInvalid,onClick:()=>{setFormState({numTopClasses:selectedNumTopClassesIsInvalid===false?selectedNumTopClasses:undefined});setCurrentStep(ANALYTICS_STEPS.DETAILS)}}))};function getStringValue(value){return typeof value==="number"?`${value}`:use_create_analytics_form_state["c"]}const AdvancedStepDetails=({setCurrentStep:setCurrentStep,state:state})=>{const{form:form,isJobCreated:isJobCreated}=state;const{computeFeatureInfluence:computeFeatureInfluence,dependentVariable:dependentVariable,eta:eta,featureBagFraction:featureBagFraction,featureInfluenceThreshold:featureInfluenceThreshold,gamma:gamma,jobType:jobType,lambda:lambda,method:method,maxNumThreads:maxNumThreads,maxTrees:maxTrees,modelMemoryLimit:modelMemoryLimit,nNeighbors:nNeighbors,numTopClasses:numTopClasses,numTopFeatureImportanceValues:numTopFeatureImportanceValues,outlierFraction:outlierFraction,predictionFieldName:predictionFieldName,randomizeSeed:randomizeSeed,standardizationEnabled:standardizationEnabled}=form;const isRegOrClassJob=jobType===analytics["b"].REGRESSION||jobType===analytics["b"].CLASSIFICATION;const advancedFirstCol=[];const advancedSecondCol=[];const advancedThirdCol=[];const hyperFirstCol=[];const hyperSecondCol=[];const hyperThirdCol=[];if(jobType===analytics["b"].OUTLIER_DETECTION){advancedFirstCol.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.computeFeatureInfluence",{defaultMessage:"Compute feature influence"}),description:computeFeatureInfluence});advancedSecondCol.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.featureInfluenceThreshold",{defaultMessage:"Feature influence threshold"}),description:getStringValue(featureInfluenceThreshold)});advancedThirdCol.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.modelMemoryLimit",{defaultMessage:"Model memory limit"}),description:`${modelMemoryLimit}`});hyperFirstCol.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.nNeighbors",{defaultMessage:"N neighbors"}),description:getStringValue(nNeighbors)},{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.outlierFraction",{defaultMessage:"Outlier fraction"}),description:getStringValue(outlierFraction)});hyperSecondCol.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.method",{defaultMessage:"Method"}),description:method!==undefined?method:use_create_analytics_form_state["c"]});hyperThirdCol.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.standardizationEnabled",{defaultMessage:"Standardization enabled"}),description:`${standardizationEnabled}`})}if(isRegOrClassJob){advancedFirstCol.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.numTopFeatureImportanceValues",{defaultMessage:"Top feature importance values"}),description:`${numTopFeatureImportanceValues}`});hyperFirstCol.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.lambdaFields",{defaultMessage:"Lambda"}),description:getStringValue(lambda)},{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.eta",{defaultMessage:"Eta"}),description:getStringValue(eta)});advancedSecondCol.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.predictionFieldName",{defaultMessage:"Prediction field name"}),description:predictionFieldName?predictionFieldName:`${dependentVariable}_prediction`},{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.randomizedSeed",{defaultMessage:"Randomized seed"}),description:getStringValue(randomizeSeed)});hyperSecondCol.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.maxTreesFields",{defaultMessage:"Max trees"}),description:getStringValue(maxTrees)},{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.featureBagFraction",{defaultMessage:"Feature bag fraction"}),description:getStringValue(featureBagFraction)});advancedThirdCol.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.modelMemoryLimit",{defaultMessage:"Model memory limit"}),description:`${modelMemoryLimit}`});hyperThirdCol.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.gamma",{defaultMessage:"Gamma"}),description:getStringValue(gamma)})}if(jobType===analytics["b"].CLASSIFICATION){advancedThirdCol.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.numTopClasses",{defaultMessage:"Top classes"}),description:numTopClasses===-1?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.allClasses",{defaultMessage:"All classes"}):getStringValue(numTopClasses)})}if(maxNumThreads!==undefined){advancedFirstCol.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.maxNumThreads",{defaultMessage:"Maximum number of threads"}),description:`${maxNumThreads}`})}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h3",null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.advancedConfigDetailsTitle",{defaultMessage:"Advanced configuration"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{style:{width:"70%"},justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{compressed:true,listItems:advancedFirstCol})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{compressed:true,listItems:advancedSecondCol})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{compressed:true,listItems:advancedThirdCol}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h3",null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.hyperParametersDetailsTitle",{defaultMessage:"Hyperparameters"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{style:{width:"70%"},justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{compressed:true,listItems:hyperFirstCol})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{compressed:true,listItems:hyperSecondCol})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{compressed:true,listItems:hyperThirdCol}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),!isJobCreated&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{iconType:"pencil",size:"s",onClick:()=>{setCurrentStep(ANALYTICS_STEPS.ADVANCED)}},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.advancedDetails.editButtonText",{defaultMessage:"Edit"})))};const AdvancedStep=({actions:actions,state:state,step:step,setCurrentStep:setCurrentStep,stepActivated:stepActivated})=>{const showForm=step===ANALYTICS_STEPS.ADVANCED;const showDetails=step!==ANALYTICS_STEPS.ADVANCED&&stepActivated===true;const dataTestSubj=`mlAnalyticsCreateJobWizardAdvancedStep${showForm?" active":""}${showDetails?" summary":""}`;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiForm"],{"data-test-subj":dataTestSubj},showForm&&external_kbnSharedDeps_React_default.a.createElement(AdvancedStepForm,{actions:actions,state:state,setCurrentStep:setCurrentStep}),showDetails&&external_kbnSharedDeps_React_default.a.createElement(AdvancedStepDetails,{setCurrentStep:setCurrentStep,state:state}))};const DetailsStepDetails=({setCurrentStep:setCurrentStep,state:state})=>{const{form:form,isJobCreated:isJobCreated}=state;const{description:description,jobId:jobId,destinationIndex:destinationIndex,resultsField:resultsField}=form;const detailsFirstCol=[{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.jobId",{defaultMessage:"Job ID"}),description:jobId}];if(resultsField!==undefined&&typeof resultsField==="string"&&resultsField.trim()!==""){detailsFirstCol.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.resultsField",{defaultMessage:"Results field"}),description:resultsField})}const detailsSecondCol=[{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.jobDescription",{defaultMessage:"Job description"}),description:description}];const detailsThirdCol=[{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.configDetails.destIndex",{defaultMessage:"Destination index"}),description:destinationIndex||""}];return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{style:{width:"70%"},justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{compressed:true,listItems:detailsFirstCol})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{style:{wordBreak:"break-word"},compressed:true,listItems:detailsSecondCol})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{compressed:true,listItems:detailsThirdCol}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),!isJobCreated&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{iconType:"pencil",size:"s",onClick:()=>{setCurrentStep(ANALYTICS_STEPS.DETAILS)}},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.detailsDetails.editButtonText",{defaultMessage:"Edit"})))};const DEFAULT_RESULTS_FIELD="ml";const indexNameExistsMessage=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.destinationIndexHelpText",{defaultMessage:"An index with this name already exists. Be aware that running this analytics job will modify this destination index."});const DetailsStepForm=({actions:actions,state:state,setCurrentStep:setCurrentStep})=>{const{services:{docLinks:docLinks,notifications:notifications}}=Object(contexts_kibana["b"])();const createIndexLink=docLinks.links.apis.createIndex;const{setFormState:setFormState}=actions;const{form:form,cloneJob:cloneJob,hasSwitchedToEditor:hasSwitchedToEditor,isJobCreated:isJobCreated}=state;const{createIndexPattern:createIndexPattern,description:description,destinationIndex:destinationIndex,destinationIndexNameEmpty:destinationIndexNameEmpty,destinationIndexNameExists:destinationIndexNameExists,destinationIndexNameValid:destinationIndexNameValid,destinationIndexPatternTitleExists:destinationIndexPatternTitleExists,jobId:jobId,jobIdEmpty:jobIdEmpty,jobIdExists:jobIdExists,jobIdInvalidMaxLength:jobIdInvalidMaxLength,jobIdValid:jobIdValid,resultsField:resultsField}=form;const[destIndexSameAsId,setDestIndexSameAsId]=Object(external_kbnSharedDeps_React_["useState"])(cloneJob===undefined&&hasSwitchedToEditor===false);const[useResultsFieldDefault,setUseResultsFieldDefault]=Object(external_kbnSharedDeps_React_["useState"])(cloneJob===undefined&&hasSwitchedToEditor===false&&resultsField===undefined||cloneJob!==undefined&&resultsField===DEFAULT_RESULTS_FIELD);const forceInput=Object(external_kbnSharedDeps_React_["useRef"])(null);const isStepInvalid=jobIdEmpty===true||jobIdExists===true||jobIdValid===false||destinationIndexNameEmpty===true||destinationIndexNameValid===false||destinationIndexPatternTitleExists===true&&createIndexPattern===true;const debouncedIndexCheck=Object(external_kbnSharedDeps_Lodash_["debounce"])(async()=>{try{const{exists:exists}=await ml_api_service["ml"].checkIndexExists({index:destinationIndex});setFormState({destinationIndexNameExists:exists})}catch(e){notifications.toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.errorCheckingIndexExists",{defaultMessage:"The following error occurred getting the existing index names: {error}",values:{error:Object(util_errors["i"])(e)}}))}},400);const debouncedJobIdCheck=Object(external_kbnSharedDeps_React_["useMemo"])(()=>Object(external_kbnSharedDeps_Lodash_["debounce"])(async()=>{try{const{results:results}=await ml_api_service["ml"].dataFrameAnalytics.jobsExists([jobId],true);setFormState({jobIdExists:results[jobId]})}catch(e){notifications.toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.errorCheckingJobIdExists",{defaultMessage:"The following error occurred checking if job id exists: {error}",values:{error:Object(util_errors["i"])(e)}}))}},400),[jobId]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(jobIdValid===true){debouncedJobIdCheck()}else if(typeof jobId==="string"&&jobId.trim()===""&&jobIdExists===true){setFormState({jobIdExists:false})}return()=>{debouncedJobIdCheck.cancel()}},[jobId]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(destinationIndexNameValid===true){debouncedIndexCheck()}else if(typeof destinationIndex==="string"&&destinationIndex.trim()===""&&destinationIndexNameExists===true){setFormState({destinationIndexNameExists:false})}return()=>{debouncedIndexCheck.cancel()}},[destinationIndex]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(destIndexSameAsId===true&&!jobIdEmpty&&jobIdValid){setFormState({destinationIndex:jobId})}else if(destIndexSameAsId===false&&hasSwitchedToEditor===false){setFormState({destinationIndex:""})}},[destIndexSameAsId,jobId]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true,label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.jobIdLabel",{defaultMessage:"Job ID"}),isInvalid:!jobIdEmpty&&!jobIdValid||jobIdExists||jobIdInvalidMaxLength,error:[...!jobIdEmpty&&!jobIdValid?[external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.jobIdInvalidError",{defaultMessage:"Must contain lowercase alphanumeric characters (a-z and 0-9), hyphens, and underscores only and must start and end with alphanumeric characters."})]:[],...jobIdExists?[external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.jobIdExistsError",{defaultMessage:"An analytics job with this ID already exists."})]:[],...jobIdInvalidMaxLength?[external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.jobIdInvalidMaxLengthErrorMessage",{defaultMessage:"Job ID must be no more than {maxLength, plural, one {# character} other {# characters}} long.",values:{maxLength:constants_validation["b"]}})]:[]]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{fullWidth:true,inputRef:input=>{if(input){forceInput.current=input}},disabled:isJobCreated,placeholder:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.jobIdPlaceholder",{defaultMessage:"Job ID"}),value:jobId,onChange:e=>setFormState({jobId:e.target.value}),"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.jobIdInputAriaLabel",{defaultMessage:"Choose a unique analytics job ID."}),isInvalid:!jobIdEmpty&&!jobIdValid||jobIdExists||jobIdEmpty,"data-test-subj":"mlAnalyticsCreateJobFlyoutJobIdInput"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true,label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.jobDescription.label",{defaultMessage:"Job description"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTextArea"],{fullWidth:true,value:description,placeholder:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.jobDescription.helpText",{defaultMessage:"Optional descriptive text"}),rows:2,onChange:e=>{const value=e.target.value;setFormState({description:value})},"data-test-subj":"mlDFAnalyticsJobCreationJobDescription"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true,helpText:destIndexSameAsId===true&&destinationIndexNameExists&&indexNameExistsMessage},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{disabled:isJobCreated,name:"mlDataFrameAnalyticsDestIndexSameAsId",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.DestIndexSameAsIdLabel",{defaultMessage:"Destination index same as job ID"}),checked:destIndexSameAsId===true,onChange:()=>setDestIndexSameAsId(!destIndexSameAsId),"data-test-subj":"mlAnalyticsCreateJobWizardDestIndexSameAsIdSwitch"})),destIndexSameAsId===false&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true,label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.destinationIndexLabel",{defaultMessage:"Destination index"}),isInvalid:destinationIndexNameEmpty||!destinationIndexNameEmpty&&!destinationIndexNameValid,helpText:destinationIndexNameExists&&indexNameExistsMessage,error:!destinationIndexNameEmpty&&!destinationIndexNameValid&&[external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.destinationIndexInvalidError",{defaultMessage:"Invalid destination index name."}),external_kbnSharedDeps_React_default.a.createElement("br",null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{href:createIndexLink,target:"_blank"},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.stepDetailsForm.destinationIndexInvalidErrorLink",{defaultMessage:"Learn more about index name limitations."})))]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{fullWidth:true,disabled:isJobCreated,placeholder:"destination index",value:destinationIndex,onChange:e=>setFormState({destinationIndex:e.target.value}),"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.destinationIndexInputAriaLabel",{defaultMessage:"Choose a unique destination index name."}),isInvalid:!destinationIndexNameEmpty&&!destinationIndexNameValid,"data-test-subj":"mlAnalyticsCreateJobFlyoutDestinationIndexInput"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{disabled:isJobCreated,name:"mlDataFrameAnalyticsUseResultsFieldDefault",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.UseResultsFieldDefaultLabel",{defaultMessage:'Use results field default value "{defaultValue}"',values:{defaultValue:DEFAULT_RESULTS_FIELD}}),checked:useResultsFieldDefault===true,onChange:()=>setUseResultsFieldDefault(!useResultsFieldDefault),"data-test-subj":"mlAnalyticsCreateJobWizardUseResultsFieldDefault"})),useResultsFieldDefault===false&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true,label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.resultsFieldLabel",{defaultMessage:"Results field"}),helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.resultsFieldHelpText",{defaultMessage:"Defines the name of the field in which to store the results of the analysis. Defaults to ml."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{disabled:isJobCreated,placeholder:"results field",value:resultsField,onChange:e=>setFormState({resultsField:e.target.value}),"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.resultsFieldInputAriaLabel",{defaultMessage:"The name of the field in which to store the results of the analysis."}),"data-test-subj":"mlAnalyticsCreateJobWizardResultsFieldInput"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true,isInvalid:createIndexPattern&&destinationIndexPatternTitleExists||!createIndexPattern,error:[...createIndexPattern&&destinationIndexPatternTitleExists?[external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.indexPatternExistsError",{defaultMessage:"An index pattern with this title already exists."})]:[],...!createIndexPattern?[external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",color:"warning"},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.shouldCreateIndexPatternMessage",{defaultMessage:"You may not be able to view job results if an index pattern is not created for the destination index."}))]:[]]},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{disabled:isJobCreated,name:"mlDataFrameAnalyticsCreateIndexPattern",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.createIndexPatternLabel",{defaultMessage:"Create index pattern"}),checked:createIndexPattern===true,onChange:()=>setFormState({createIndexPattern:!createIndexPattern}),"data-test-subj":"mlAnalyticsCreateJobWizardCreateIndexPatternSwitch"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement(ContinueButton,{isDisabled:isStepInvalid,onClick:()=>{setCurrentStep(ANALYTICS_STEPS.CREATE)}}))};const DetailsStep=({actions:actions,state:state,setCurrentStep:setCurrentStep,step:step,stepActivated:stepActivated})=>{const showForm=step===ANALYTICS_STEPS.DETAILS;const showDetails=step!==ANALYTICS_STEPS.DETAILS&&stepActivated===true;const dataTestSubj=`mlAnalyticsCreateJobWizardDetailsStep${showForm?" active":""}${showDetails?" summary":""}`;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiForm"],{className:"mlDataFrameAnalyticsCreateForm","data-test-subj":dataTestSubj},showForm&&external_kbnSharedDeps_React_default.a.createElement(DetailsStepForm,{actions:actions,state:state,setCurrentStep:setCurrentStep}),showDetails&&external_kbnSharedDeps_React_default.a.createElement(DetailsStepDetails,{setCurrentStep:setCurrentStep,state:state}))};function page_extends(){page_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return page_extends.apply(this,arguments)}let ANALYTICS_STEPS;(function(ANALYTICS_STEPS){ANALYTICS_STEPS[ANALYTICS_STEPS["CONFIGURATION"]=0]="CONFIGURATION";ANALYTICS_STEPS[ANALYTICS_STEPS["ADVANCED"]=1]="ADVANCED";ANALYTICS_STEPS[ANALYTICS_STEPS["DETAILS"]=2]="DETAILS";ANALYTICS_STEPS[ANALYTICS_STEPS["CREATE"]=3]="CREATE"})(ANALYTICS_STEPS||(ANALYTICS_STEPS={}));const analytics_creation_page_Page=({jobId:jobId})=>{const[currentStep,setCurrentStep]=Object(external_kbnSharedDeps_React_["useState"])(ANALYTICS_STEPS.CONFIGURATION);const[activatedSteps,setActivatedSteps]=Object(external_kbnSharedDeps_React_["useState"])([true,false,false,false]);const mlContext=Object(ml["b"])();const{currentIndexPattern:currentIndexPattern}=mlContext;const createAnalyticsForm=Object(use_create_analytics_form["b"])();const{state:state}=createAnalyticsForm;const{isAdvancedEditorEnabled:isAdvancedEditorEnabled,disableSwitchToForm:disableSwitchToForm}=state;const{jobType:jobType}=state.form;const{initiateWizard:initiateWizard,setJobClone:setJobClone,switchToAdvancedEditor:switchToAdvancedEditor,switchToForm:switchToForm}=createAnalyticsForm.actions;Object(external_kbnSharedDeps_React_["useEffect"])(()=>{initiateWizard();if(currentIndexPattern){(async function(){if(jobId!==undefined){const analyticsConfigs=await ml_api_service["ml"].dataFrameAnalytics.getDataFrameAnalytics(jobId,true);if(Array.isArray(analyticsConfigs.data_frame_analytics)&&analyticsConfigs.data_frame_analytics.length>0){const clonedJobConfig=analyticsConfigs.data_frame_analytics[0];await setJobClone(clonedJobConfig)}}})()}},[]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(activatedSteps[currentStep]===false){activatedSteps.splice(currentStep,1,true);setActivatedSteps(activatedSteps)}},[currentStep]);const analyticsWizardSteps=[{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.creation.configurationStepTitle",{defaultMessage:"Configuration"}),children:external_kbnSharedDeps_React_default.a.createElement(ConfigurationStep,page_extends({},createAnalyticsForm,{setCurrentStep:setCurrentStep,step:currentStep,stepActivated:activatedSteps[ANALYTICS_STEPS.CONFIGURATION]})),status:currentStep>=ANALYTICS_STEPS.CONFIGURATION?undefined:"incomplete"},{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.creation.advancedStepTitle",{defaultMessage:"Additional options"}),children:external_kbnSharedDeps_React_default.a.createElement(AdvancedStep,page_extends({},createAnalyticsForm,{setCurrentStep:setCurrentStep,step:currentStep,stepActivated:activatedSteps[ANALYTICS_STEPS.ADVANCED]})),status:currentStep>=ANALYTICS_STEPS.ADVANCED?undefined:"incomplete"},{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.creation.detailsStepTitle",{defaultMessage:"Job details"}),children:external_kbnSharedDeps_React_default.a.createElement(DetailsStep,page_extends({},createAnalyticsForm,{setCurrentStep:setCurrentStep,step:currentStep,stepActivated:activatedSteps[ANALYTICS_STEPS.DETAILS]})),status:currentStep>=ANALYTICS_STEPS.DETAILS?undefined:"incomplete"},{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.creation.createStepTitle",{defaultMessage:"Create"}),children:external_kbnSharedDeps_React_default.a.createElement(CreateStep,page_extends({},createAnalyticsForm,{step:currentStep})),status:currentStep>=ANALYTICS_STEPS.CREATE?undefined:"incomplete"}];return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPage"],{"data-test-subj":"mlAnalyticsCreationContainer"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageBody"],{restrictWidth:1200},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageContent"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"column",gutterSize:"none"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"m","data-test-subj":"mlDataFrameAnalyticsWizardHeaderTitle"},external_kbnSharedDeps_React_default.a.createElement("h1",null,jobId===undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.creationPageTitle",defaultMessage:"Create job"}),jobId!==undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.clone.creationPageTitle",defaultMessage:"Clone job from {jobId}",values:{jobId:jobId}})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.creationPageSourceIndexTitle",defaultMessage:"Source index pattern: {indexTitle}",values:{indexTitle:currentIndexPattern.title}}))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{helpText:disableSwitchToForm&&external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.jsonEditorDisabledSwitchText",{defaultMessage:"Configuration contains advanced fields not supported by the form. You cannot switch back to the form."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{disabled:jobType===undefined||disableSwitchToForm,label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.switchToJsonEditorSwitch",{defaultMessage:"Switch to json editor"}),checked:isAdvancedEditorEnabled,onChange:e=>{if(e.target.checked===true){switchToAdvancedEditor()}else{switchToForm()}},"data-test-subj":"mlAnalyticsCreateJobWizardAdvancedEditorSwitch"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),isAdvancedEditorEnabled===true&&external_kbnSharedDeps_React_default.a.createElement(CreateAnalyticsAdvancedEditor,createAnalyticsForm),isAdvancedEditorEnabled===false&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSteps"],{"data-test-subj":"mlAnalyticsCreateJobWizardSteps",steps:analyticsWizardSteps}))))};function analytics_job_creation_extends(){analytics_job_creation_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return analytics_job_creation_extends.apply(this,arguments)}const analyticsJobsCreationRouteFactory=(navigateToPath,basePath)=>({path:"/data_frame_analytics/new_job",render:(props,deps)=>external_kbnSharedDeps_React_default.a.createElement(analytics_job_creation_PageWrapper,analytics_job_creation_extends({},props,{deps:deps})),breadcrumbs:[getBreadcrumbWithUrlForApp("ML_BREADCRUMB",navigateToPath,basePath),{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataFrameAnalyticsBreadcrumbs.dataFrameManagementLabel",{defaultMessage:"Data Frame Analytics"}),onClick:breadcrumbOnClickFactory("/data_frame_analytics",navigateToPath)}]});const analytics_job_creation_PageWrapper=({location:location,deps:deps})=>{const{index:index,jobId:jobId,savedSearchId:savedSearchId}=Object(query_string["parse"])(location.search,{sort:false});const{context:context}=useResolver(index,savedSearchId,deps.config,{...basicResolvers(deps),jobCaps:()=>Object(new_job_capabilities_service["b"])(index,savedSearchId,deps.indexPatterns)});return external_kbnSharedDeps_React_default.a.createElement(PageLoader,{context:context},external_kbnSharedDeps_React_default.a.createElement(analytics_creation_page_Page,{jobId:jobId}))};function models_list_extends(){models_list_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return models_list_extends.apply(this,arguments)}const modelsListRouteFactory=(navigateToPath,basePath)=>({path:"/data_frame_analytics/models",render:(props,deps)=>external_kbnSharedDeps_React_default.a.createElement(models_list_PageWrapper,models_list_extends({},props,{deps:deps})),breadcrumbs:[getBreadcrumbWithUrlForApp("ML_BREADCRUMB",navigateToPath,basePath),getBreadcrumbWithUrlForApp("DATA_FRAME_ANALYTICS_BREADCRUMB",navigateToPath,basePath),{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataFrameAnalyticsBreadcrumbs.modelsListLabel",{defaultMessage:"Model Management"}),href:""}]});const models_list_PageWrapper=({location:location,deps:deps})=>{const{context:context}=useResolver(undefined,undefined,deps.config,basicResolvers(deps));return external_kbnSharedDeps_React_default.a.createElement(PageLoader,{context:context},external_kbnSharedDeps_React_default.a.createElement(analytics_management_page["a"],null))};function analytics_map_extends(){analytics_map_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return analytics_map_extends.apply(this,arguments)}const analyticsMapRouteFactory=(navigateToPath,basePath)=>({path:"/data_frame_analytics/map",render:(props,deps)=>external_kbnSharedDeps_React_default.a.createElement(analytics_map_PageWrapper,analytics_map_extends({},props,{deps:deps})),breadcrumbs:[getBreadcrumbWithUrlForApp("ML_BREADCRUMB",navigateToPath,basePath),getBreadcrumbWithUrlForApp("DATA_FRAME_ANALYTICS_BREADCRUMB",navigateToPath,basePath),{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataFrameAnalyticsBreadcrumbs.analyticsMapLabel",{defaultMessage:"Analytics Map"}),href:""}]});const analytics_map_PageWrapper=({deps:deps})=>{const{context:context}=useResolver(undefined,undefined,deps.config,basicResolvers(deps));return external_kbnSharedDeps_React_default.a.createElement(PageLoader,{context:context},external_kbnSharedDeps_React_default.a.createElement(analytics_management_page["a"],null))};var usePrevious=__webpack_require__(743);var usePrevious_default=__webpack_require__.n(usePrevious);var annotation_flyout=__webpack_require__(263);var annotations_table=__webpack_require__(270);var date_utils=__webpack_require__(67);var metric_change_description=__webpack_require__(218);function DescriptionCell({actual:actual,typical:typical}){const{iconType:iconType,message:message}=Object(metric_change_description["a"])(actual,typical);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"s",alignItems:"center"},iconType!==undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:iconType,size:"s"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs"},message)))}function DetectorCell({detectorDescription:detectorDescription,numberOfRules:numberOfRules}){let rulesIcon;if(numberOfRules!==undefined&&numberOfRules>0){rulesIcon=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.anomaliesTable.detectorCell.rulesConfiguredTooltip",defaultMessage:"rules have been configured for this detector"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:"controlsHorizontal",className:"detector-rules-icon"}))}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,detectorDescription,rulesIcon)}var entity_control=__webpack_require__(175);function getAddFilter({entityName:entityName,entityValue:entityValue,filter:filter}){if(filter!==undefined){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.anomaliesTable.entityCell.addFilterTooltip",defaultMessage:"Add filter"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{size:"s",className:"filter-button",onClick:()=>filter(entityName,entityValue,"+"),iconType:"plusInCircle","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.entityCell.addFilterAriaLabel",{defaultMessage:"Add filter"})}))}}function getRemoveFilter({entityName:entityName,entityValue:entityValue,filter:filter}){if(filter!==undefined){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.anomaliesTable.entityCell.removeFilterTooltip",defaultMessage:"Remove filter"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{size:"s",className:"filter-button",onClick:()=>filter(entityName,entityValue,"-"),iconType:"minusInCircle","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.entityCell.removeFilterAriaLabel",{defaultMessage:"Remove filter"})}))}}const EntityCell=({entityName:entityName,entityValue:entityValue,filter:filter,wrapText:wrapText=false})=>{let valueText=entityValue===""?external_kbnSharedDeps_React_default.a.createElement("i",null,entity_control["a"]):entityValue;if(entityName===field_types["b"]){valueText=`${field_types["b"]} ${valueText}`}const textStyle={maxWidth:"100%"};const textWrapperClass=wrapText?"field-value-long":"field-value-short";const shouldDisplayIcons=filter!==undefined&&entityName!==undefined&&entityValue!==undefined;if(wrapText===true){return external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement("span",{className:textWrapperClass},valueText),shouldDisplayIcons&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,getAddFilter({entityName:entityName,entityValue:entityValue,filter:filter}),getRemoveFilter({entityName:entityName,entityValue:entityValue,filter:filter})))}else{return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"row",alignItems:"center",gutterSize:"none"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:textStyle},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs",className:textWrapperClass},valueText)),shouldDisplayIcons&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"row",alignItems:"center",gutterSize:"none"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},getAddFilter({entityName:entityName,entityValue:entityValue,filter:filter})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},getRemoveFilter({entityName:entityName,entityValue:entityValue,filter:filter})))))}};class influencers_cell_InfluencersCell extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);this.state={showAll:false}}toggleAllInfluencers(){this.setState({showAll:!this.state.showAll})}renderInfluencers(influencers){const numberToDisplay=this.state.showAll===false?this.props.limit:influencers.length;const displayInfluencers=influencers.slice(0,numberToDisplay);const{influencerFilter:influencerFilter}=this.props;let othersCount=Math.max(influencers.length-numberToDisplay,0);if(othersCount===1){displayInfluencers.push(influencers[this.props.limit]);othersCount=0}const displayRows=displayInfluencers.map((influencer,index)=>external_kbnSharedDeps_React_default.a.createElement("div",{key:index},influencer.influencerFieldName,": ",influencer.influencerFieldValue,influencerFilter!==undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.anomaliesTable.influencersCell.addFilterTooltip",defaultMessage:"Add filter"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{size:"s",className:"filter-button",onClick:()=>influencerFilter(influencer.influencerFieldName,influencer.influencerFieldValue,"+"),iconType:"plusInCircle","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.influencersCell.addFilterAriaLabel",{defaultMessage:"Add filter"})})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.anomaliesTable.influencersCell.removeFilterTooltip",defaultMessage:"Remove filter"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{size:"s",className:"filter-button",onClick:()=>influencerFilter(influencer.influencerFieldName,influencer.influencerFieldValue,"-"),iconType:"minusInCircle","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.influencersCell.removeFilterAriaLabel",{defaultMessage:"Remove filter"})})))));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,displayRows,this.renderOthers(influencers.length,othersCount))}renderOthers(totalCount,othersCount){if(othersCount>0){return external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{onClick:()=>this.toggleAllInfluencers()},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.anomaliesTable.influencersCell.moreInfluencersLinkText",defaultMessage:"and {othersCount} more",values:{othersCount:othersCount}})))}else if(totalCount>this.props.limit+1){return external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{onClick:()=>this.toggleAllInfluencers()},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.anomaliesTable.influencersCell.showLessInfluencersLinkText",defaultMessage:"show less"})))}}render(){const recordInfluencers=this.props.influencers||[];const influencers=[];recordInfluencers.forEach(influencer=>{Object(external_kbnSharedDeps_Lodash_["each"])(influencer,(influencerFieldValue,influencerFieldName)=>{influencers.push({influencerFieldName:influencerFieldName,influencerFieldValue:influencerFieldValue})})});return external_kbnSharedDeps_React_default.a.createElement("div",null,this.renderInfluencers(influencers),this.renderOthers(influencers))}}var rison=__webpack_require__(179);var rison_default=__webpack_require__.n(rison);function getFieldTypeFromMapping(index,fieldName){return new Promise((resolve,reject)=>{if(index!==""){ml_api_service["ml"].getFieldCaps({index:index,fields:[fieldName]}).then(resp=>{let fieldType="";Object(external_kbnSharedDeps_Lodash_["each"])(resp.fields,field=>{Object(external_kbnSharedDeps_Lodash_["each"])(field,type=>{if(fieldType===""){fieldType=type.type}})});resolve(fieldType)}).catch(error=>{reject(error)})}else{reject()}})}var custom_url_utils=__webpack_require__(144);function links_menu_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class links_menu_LinksMenuUI extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);links_menu_defineProperty(this,"openCustomUrl",customUrl=>{const{anomaly:anomaly,interval:interval,isAggregatedData:isAggregatedData}=this.props;console.log("Anomalies Table - open customUrl for record:",anomaly);const record=Object(external_kbnSharedDeps_Lodash_["cloneDeep"])(anomaly.source);const timestamp=record.timestamp;const configuredUrlValue=customUrl.url_value;const timeRangeInterval=Object(parse_interval["a"])(customUrl.time_range);const basePath=this.props.kibana.services.http.basePath.get();if(configuredUrlValue.includes("$earliest$")){let earliestMoment=external_kbnSharedDeps_Moment_default()(timestamp);if(timeRangeInterval!==null){earliestMoment.subtract(timeRangeInterval)}else{earliestMoment=external_kbnSharedDeps_Moment_default()(timestamp).startOf(interval);if(interval==="hour"){earliestMoment.subtract(1,"h")}}record.earliest=earliestMoment.toISOString()}if(configuredUrlValue.includes("$latest$")){let latestMoment=external_kbnSharedDeps_Moment_default()(timestamp).add(record.bucket_span,"s");if(timeRangeInterval!==null){latestMoment.add(timeRangeInterval)}else{if(isAggregatedData===true){latestMoment=external_kbnSharedDeps_Moment_default()(timestamp).endOf(interval);if(interval==="hour"){latestMoment.add(1,"h")}}}record.latest=latestMoment.toISOString()}if((configuredUrlValue.includes("$mlcategoryterms$")||configuredUrlValue.includes("$mlcategoryregex$"))&&record.mlcategory!==undefined){const jobId=record.job_id;const categoryId=record.mlcategory[0];ml_api_service["ml"].results.getCategoryDefinition(jobId,categoryId).then(resp=>{const termsArray=resp.terms.split(" ").map(term=>`+${term}`);record.mlcategoryterms=termsArray.join(" ");record.mlcategoryregex=resp.regex;const urlPath=Object(string_utils["e"])(customUrl.url_value,record,true);Object(custom_url_utils["d"])(urlPath,customUrl,basePath)}).catch(resp=>{console.log("openCustomUrl(): error loading categoryDefinition:",resp);const{toasts:toasts}=this.props.kibana.services.notifications;toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.linksMenu.unableToOpenLinkErrorMessage",{defaultMessage:"Unable to open link as an error occurred loading details on category ID {categoryId}",values:{categoryId:categoryId}}))})}else{const urlPath=Object(custom_url_utils["a"])(customUrl,record);Object(custom_url_utils["d"])(urlPath,customUrl,basePath)}});links_menu_defineProperty(this,"viewSeries",async()=>{const{services:{share:{urlGenerators:{getUrlGenerator:getUrlGenerator}}}}=this.props.kibana;const mlUrlGenerator=getUrlGenerator(ml_url_generator["a"]);const record=this.props.anomaly.source;const bounds=this.props.bounds;const from=bounds.min.toISOString();const to=bounds.max.toISOString();const recordTime=external_kbnSharedDeps_Moment_default()(record.timestamp);const zoomFrom=recordTime.subtract(50*record.bucket_span,"s").toISOString();const zoomTo=recordTime.add(100*record.bucket_span,"s").toISOString();const entityCondition={};if(record.partition_field_value!==undefined){entityCondition[record.partition_field_name]=record.partition_field_value}if(record.over_field_value!==undefined){entityCondition[record.over_field_name]=record.over_field_value}if(record.by_field_value!==undefined){entityCondition[record.by_field_name]=record.by_field_value}const singleMetricViewerLink=await mlUrlGenerator.createUrl({excludeBasePath:false,page:ml_url_generator["b"].SINGLE_METRIC_VIEWER,pageState:{jobIds:[record.job_id],refreshInterval:{display:"Off",pause:true,value:0},timeRange:{from:from,to:to,mode:"absolute"},zoom:{from:zoomFrom,to:zoomTo},detectorIndex:record.detector_index,entities:entityCondition,query_string:{analyze_wildcard:true,query:"*"}}});window.open(singleMetricViewerLink,"_blank")});links_menu_defineProperty(this,"viewExamples",()=>{const categoryId=this.props.anomaly.entityValue;const record=this.props.anomaly.source;const job=job_service["a"].getJob(this.props.anomaly.jobId);if(job===undefined){console.log(`viewExamples(): no job found with ID: ${this.props.anomaly.jobId}`);const{toasts:toasts}=this.props.kibana.services.notifications;toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.linksMenu.unableToViewExamplesErrorMessage",{defaultMessage:"Unable to view examples as no details could be found for job ID {jobId}",values:{jobId:this.props.anomaly.jobId}}));return}const categorizationFieldName=job.analysis_config.categorization_field_name;const datafeedIndices=job.datafeed_config.indices;let i=0;findFieldType(datafeedIndices[i]);const error=()=>{console.log(`viewExamples(): error finding type of field ${categorizationFieldName} in indices:`,datafeedIndices);const{toasts:toasts}=this.props.kibana.services.notifications;toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.linksMenu.noMappingCouldBeFoundErrorMessage",{defaultMessage:"Unable to view examples of documents with mlcategory {categoryId} "+"as no mapping could be found for the categorization field {categorizationFieldName}",values:{categoryId:categoryId,categorizationFieldName:categorizationFieldName}}))};const createAndOpenUrl=(index,categorizationFieldType)=>{const indexPatternId=Object(index_utils["c"])(index)||index;ml_api_service["ml"].results.getCategoryDefinition(record.job_id,categoryId).then(resp=>{let query=null;if(categorizationFieldType===data_public_["ES_FIELD_TYPES"].KEYWORD){if(resp.regex){query={language:constants_search["c"].LUCENE,query:`${categorizationFieldName}:/${resp.regex}/`}}}else{if(resp.terms){const escapedTerms=escapeDoubleQuotes(resp.terms);query={language:constants_search["c"].KUERY,query:`${categorizationFieldName}:"`+escapedTerms.split(" ").join(`" and ${categorizationFieldName}:"`)+'"'}}}const recordTime=external_kbnSharedDeps_Moment_default()(record.timestamp);const from=recordTime.toISOString();const to=recordTime.add(record.bucket_span,"s").toISOString();const _g=rison_default.a.encode({refreshInterval:{display:"Off",pause:true,value:0},time:{from:from,to:to,mode:"absolute"}});const appStateProps={index:indexPatternId,filters:[]};if(query!==null){appStateProps.query=query}const _a=rison_default.a.encode(appStateProps);const{basePath:basePath}=this.props.kibana.services.http;let path=basePath.get();path+="/app/discover#/";path+="?_g="+_g;path+="&_a="+encodeURIComponent(_a);window.open(path,"_blank")}).catch(resp=>{console.log("viewExamples(): error loading categoryDefinition:",resp);const{toasts:toasts}=this.props.kibana.services.notifications;toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.linksMenu.loadingDetailsErrorMessage",{defaultMessage:"Unable to view examples as an error occurred loading details on category ID {categoryId}",values:{categoryId:categoryId}}))})};function findFieldType(index){getFieldTypeFromMapping(index,categorizationFieldName).then(resp=>{if(resp!==""){createAndOpenUrl(index,resp)}else{i++;if(i<datafeedIndices.length){findFieldType(datafeedIndices[i])}else{error()}}}).catch(()=>{error()})}});links_menu_defineProperty(this,"onButtonClick",()=>{this.setState(prevState=>({isPopoverOpen:!prevState.isPopoverOpen}))});links_menu_defineProperty(this,"closePopover",()=>{this.setState({isPopoverOpen:false})});this.state={isPopoverOpen:false,toasts:[]}}render(){const{anomaly:anomaly,showViewSeriesLink:showViewSeriesLink}=this.props;const canConfigureRules=Object(anomaly_utils["l"])(anomaly.source)&&Object(check_capabilities["e"])("canUpdateJob");const button=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{size:"s",color:"text",onClick:this.onButtonClick,iconType:"gear","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.linksMenu.selectActionAriaLabel",{defaultMessage:"Select action for anomaly at {time}",values:{time:Object(date_utils["c"])(anomaly.time)}}),"data-test-subj":"mlAnomaliesListRowActionsButton"});const items=[];if(anomaly.customUrls!==undefined){anomaly.customUrls.forEach((customUrl,index)=>{items.push(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiContextMenuItem"],{key:`custom_url_${index}`,icon:"popout",onClick:()=>{this.closePopover();this.openCustomUrl(customUrl)},"data-test-subj":`mlAnomaliesListRowActionCustomUrlButton_${index}`},customUrl.url_name))})}if(showViewSeriesLink===true&&anomaly.isTimeSeriesViewRecord===true){items.push(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiContextMenuItem"],{key:"view_series",icon:"visLine",onClick:()=>{this.closePopover();this.viewSeries()},"data-test-subj":"mlAnomaliesListRowActionViewSeriesButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.anomaliesTable.linksMenu.viewSeriesLabel",defaultMessage:"View series"})))}if(anomaly.entityName==="mlcategory"){items.push(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiContextMenuItem"],{key:"view_examples",icon:"popout",onClick:()=>{this.closePopover();this.viewExamples()},"data-test-subj":"mlAnomaliesListRowActionViewExamplesButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.anomaliesTable.linksMenu.viewExamplesLabel",defaultMessage:"View examples"})))}if(canConfigureRules){items.push(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiContextMenuItem"],{key:"create_rule",icon:"controlsHorizontal",onClick:()=>{this.closePopover();this.props.showRuleEditorFlyout(anomaly)},"data-test-subj":"mlAnomaliesListRowActionConfigureRulesButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.anomaliesTable.linksMenu.configureRulesLabel",defaultMessage:"Configure rules"})))}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopover"],{button:button,isOpen:this.state.isPopoverOpen,closePopover:this.closePopover,panelPaddingSize:"none",anchorPosition:"downLeft"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiContextMenuPanel"],{items:items,"data-test-subj":"mlAnomaliesListRowActionsMenu"}))}}const LinksMenu=Object(kibanaReact_public_["withKibana"])(links_menu_LinksMenuUI);var field_format_service=__webpack_require__(125);const INFLUENCERS_LIMIT=5;const ANOMALIES_TABLE_TABS={DETAILS:0,CATEGORY_EXAMPLES:1};const MAX_CHARS=500;var multi_bucket_impact=__webpack_require__(11);const SeverityCell=Object(external_kbnSharedDeps_React_["memo"])(({score:score,multiBucketImpact:multiBucketImpact})=>{const severity=Object(anomaly_utils["f"])(score);const color=Object(anomaly_utils["i"])(score);const isMultiBucket=multiBucketImpact>=multi_bucket_impact["a"].MEDIUM;return isMultiBucket?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"xs",alignItems:"center",responsive:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement("svg",{width:"16",height:"16",viewBox:"-2 -2 20 20",fill:color},external_kbnSharedDeps_React_default.a.createElement("path",{d:"M-6.708203932499369,-2.23606797749979H-2.23606797749979V-6.708203932499369H2.23606797749979V-2.23606797749979H6.708203932499369V2.23606797749979H2.23606797749979V6.708203932499369H-2.23606797749979V2.23606797749979H-6.708203932499369Z",transform:"translate(8,8)"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},severity)):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHealth"],{color:color},severity)});function renderTime(date,aggregationInterval){if(aggregationInterval==="hour"){return Object(date_utils["b"])(date)}else if(aggregationInterval==="second"){return Object(date_utils["c"])(date)}else{return Object(date_utils["a"])(date)}}function showLinksMenuForItem(item,showViewSeriesLink){const canConfigureRules=Object(anomaly_utils["l"])(item.source)&&Object(check_capabilities["e"])("canUpdateJob");return canConfigureRules||showViewSeriesLink&&item.isTimeSeriesViewRecord||item.entityName==="mlcategory"||item.customUrls!==undefined}function anomalies_table_columns_getColumns(items,jobIds,examplesByJobId,isAggregatedData,interval,bounds,showViewSeriesLink,showRuleEditorFlyout,itemIdToExpandedRowMap,toggleRow,filter,influencerFilter){const columns=[{name:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiScreenReaderOnly"],null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.anomaliesTable.showDetailsColumn.screenReaderDescription",defaultMessage:"This column contains clickable controls for showing more details on each anomaly"}))),render:item=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{onClick:()=>toggleRow(item),iconType:itemIdToExpandedRowMap[item.rowId]?"arrowDown":"arrowRight","aria-label":itemIdToExpandedRowMap[item.rowId]?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.hideDetailsAriaLabel",{defaultMessage:"Hide details"}):external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.showDetailsAriaLabel",{defaultMessage:"Show details"}),"data-row-id":item.rowId,"data-test-subj":"mlJobListRowDetailsToggle"})},{field:"time","data-test-subj":"mlAnomaliesListColumnTime",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.timeColumnName",{defaultMessage:"time"}),dataType:"date",scope:"row",render:date=>renderTime(date,interval),textOnly:true,sortable:true},{field:"severity","data-test-subj":"mlAnomaliesListColumnSeverity",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.severityColumnName",{defaultMessage:"severity"}),render:(score,item)=>external_kbnSharedDeps_React_default.a.createElement(SeverityCell,{score:score,multiBucketImpact:item.source.multi_bucket_impact}),sortable:true},{field:"detector","data-test-subj":"mlAnomaliesListColumnDetector",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.detectorColumnName",{defaultMessage:"detector"}),render:(detectorDescription,item)=>external_kbnSharedDeps_React_default.a.createElement(DetectorCell,{detectorDescription:detectorDescription,numberOfRules:item.rulesLength}),textOnly:true,sortable:true}];if(items.some(item=>item.entityValue!==undefined)){columns.push({field:"entityValue","data-test-subj":"mlAnomaliesListColumnFoundFor",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.entityValueColumnName",{defaultMessage:"found for"}),render:(entityValue,item)=>external_kbnSharedDeps_React_default.a.createElement(EntityCell,{entityName:item.entityName,entityValue:entityValue,filter:filter,wrapText:true}),textOnly:true,sortable:true})}if(items.some(item=>item.influencers!==undefined)){columns.push({field:"influencers","data-test-subj":"mlAnomaliesListColumnInfluencers",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.influencersColumnName",{defaultMessage:"influenced by"}),render:influencers=>external_kbnSharedDeps_React_default.a.createElement(influencers_cell_InfluencersCell,{limit:INFLUENCERS_LIMIT,influencers:influencers,influencerFilter:influencerFilter}),textOnly:true,sortable:true})}if(items.some(item=>item.actual!==undefined)){columns.push({field:"actualSort","data-test-subj":"mlAnomaliesListColumnActual",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.actualSortColumnName",{defaultMessage:"actual"}),render:(actual,item)=>{const fieldFormat=field_format_service["a"].getFieldFormat(item.jobId,item.source.detector_index);return Object(format_value["b"])(item.actual,item.source.function,fieldFormat,item.source)},sortable:true})}if(items.some(item=>item.typical!==undefined)){columns.push({field:"typicalSort","data-test-subj":"mlAnomaliesListColumnTypical",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.typicalSortColumnName",{defaultMessage:"typical"}),render:(typical,item)=>{const fieldFormat=field_format_service["a"].getFieldFormat(item.jobId,item.source.detector_index);return Object(format_value["b"])(item.typical,item.source.function,fieldFormat,item.source)},sortable:true});const nonTimeOfDayOrWeek=items.some(item=>{const summaryRecFunc=item.source.function;return summaryRecFunc!=="time_of_day"&&summaryRecFunc!=="time_of_week"});if(nonTimeOfDayOrWeek===true){columns.push({field:"metricDescriptionSort","data-test-subj":"mlAnomaliesListColumnDescription",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.metricDescriptionSortColumnName",{defaultMessage:"description"}),render:(metricDescriptionSort,item)=>external_kbnSharedDeps_React_default.a.createElement(DescriptionCell,{actual:item.actual,typical:item.typical}),textOnly:true,sortable:true})}}if(jobIds&&jobIds.length>1){columns.push({field:"jobId","data-test-subj":"mlAnomaliesListColumnJobID",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.jobIdColumnName",{defaultMessage:"job ID"}),sortable:true})}const showExamples=items.some(item=>item.entityName==="mlcategory");if(showExamples===true){columns.push({"data-test-subj":"mlAnomaliesListColumnCategoryExamples",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.categoryExamplesColumnName",{defaultMessage:"category examples"}),truncateText:true,render:item=>{const examples=Object(external_kbnSharedDeps_Lodash_["get"])(examplesByJobId,[item.jobId,item.entityValue],[]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{className:"mlAnomalyCategoryExamples__link",onClick:()=>toggleRow(item,ANOMALIES_TABLE_TABS.CATEGORY_EXAMPLES)},examples.map((example,i)=>external_kbnSharedDeps_React_default.a.createElement("span",{key:`example${i}`,className:"category-example"},example)))},width:"13%"})}const showLinks=items.some(item=>showLinksMenuForItem(item,showViewSeriesLink));if(showLinks===true){columns.push({"data-test-subj":"mlAnomaliesListColumnAction",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.actionsColumnName",{defaultMessage:"actions"}),render:item=>{if(showLinksMenuForItem(item,showViewSeriesLink)===true){return external_kbnSharedDeps_React_default.a.createElement(LinksMenu,{anomaly:item,bounds:bounds,showViewSeriesLink:showViewSeriesLink,isAggregatedData:isAggregatedData,interval:interval,showRuleEditorFlyout:showRuleEditorFlyout})}else{return null}}})}return columns}const TIME_FIELD_NAME="timestamp";function getFilterEntity(entityName,entityValue,filter){return external_kbnSharedDeps_React_default.a.createElement(EntityCell,{entityName:entityName,entityValue:entityValue,filter:filter})}function getDetailsItems(anomaly,examples,filter){const source=anomaly.source;let causes=[];const sourceCauses=source.causes||[];let singleCauseByFieldName=undefined;let singleCauseByFieldValue=undefined;if(sourceCauses.length===1){if(sourceCauses[0].by_field_name!==undefined){singleCauseByFieldName=sourceCauses[0].by_field_name;singleCauseByFieldValue=sourceCauses[0].by_field_value}}else{causes=sourceCauses.map(cause=>{const simplified=Object(external_kbnSharedDeps_Lodash_["pick"])(cause,"typical","actual","probability");simplified.entityName=cause.by_field_name?cause.by_field_name:cause.over_field_name;simplified.entityValue=cause.by_field_value?cause.by_field_value:cause.over_field_value;return simplified})}const items=[];if(source.partition_field_value!==undefined){items.push({title:source.partition_field_name,description:getFilterEntity(source.partition_field_name,source.partition_field_value,filter)})}if(source.by_field_value!==undefined){items.push({title:source.by_field_name,description:getFilterEntity(source.by_field_name,source.by_field_value,filter)})}if(singleCauseByFieldName!==undefined){items.push({title:singleCauseByFieldName,description:getFilterEntity(singleCauseByFieldName,singleCauseByFieldValue,filter)})}if(source.over_field_value!==undefined){items.push({title:source.over_field_name,description:getFilterEntity(source.over_field_name,source.over_field_value,filter)})}const anomalyTime=source[TIME_FIELD_NAME];let timeDesc=`${Object(date_utils["c"])(anomalyTime)}`;if(source.bucket_span!==undefined){const anomalyEndTime=anomalyTime+source.bucket_span*1e3;timeDesc=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.anomalyDetails.anomalyTimeRangeLabel",{defaultMessage:"{anomalyTime} to {anomalyEndTime}",values:{anomalyTime:Object(date_utils["c"])(anomalyTime),anomalyEndTime:Object(date_utils["c"])(anomalyEndTime)}})}items.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.anomalyDetails.timeTitle",{defaultMessage:"time"}),description:timeDesc});items.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.anomalyDetails.functionTitle",{defaultMessage:"function"}),description:source.function!==aggregation_types["b"].METRIC?source.function:source.function_description});if(source.field_name!==undefined){items.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.anomalyDetails.fieldNameTitle",{defaultMessage:"fieldName"}),description:source.field_name})}const functionDescription=source.function_description||"";if(anomaly.actual!==undefined&&Object(anomaly_utils["m"])(functionDescription)===true){items.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.anomalyDetails.actualTitle",{defaultMessage:"actual"}),description:Object(format_value["b"])(anomaly.actual,source.function,undefined,source)})}if(anomaly.typical!==undefined&&Object(anomaly_utils["n"])(functionDescription)===true){items.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.anomalyDetails.typicalTitle",{defaultMessage:"typical"}),description:Object(format_value["b"])(anomaly.typical,source.function,undefined,source)})}items.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.anomalyDetails.jobIdTitle",{defaultMessage:"job ID"}),description:anomaly.jobId});if(source.multi_bucket_impact!==undefined&&source.multi_bucket_impact>=multi_bucket_impact["a"].LOW){items.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.anomalyDetails.multiBucketImpactTitle",{defaultMessage:"multi-bucket impact"}),description:Object(anomaly_utils["g"])(source.multi_bucket_impact)})}items.push({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.anomalyDetails.probabilityTitle",{defaultMessage:"probability"}),description:source.probability});if(causes.length>1){causes.forEach((cause,index)=>{const title=index===0?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.anomalyDetails.causeValuesTitle",{defaultMessage:"{causeEntityName} values",values:{causeEntityName:cause.entityName}}):"";const description=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.anomalyDetails.causeValuesDescription",{defaultMessage:"{causeEntityValue} (actual {actualValue}, "+"typical {typicalValue}, probability {probabilityValue})",values:{causeEntityValue:cause.entityValue,actualValue:Object(format_value["b"])(cause.actual,source.function),typicalValue:Object(format_value["b"])(cause.typical,source.function),probabilityValue:cause.probability}});items.push({title:title,description:description})})}return items}function getInfluencersItems(anomalyInfluencers,influencerFilter,numToDisplay){const items=[];for(let i=0;i<numToDisplay;i++){Object.keys(anomalyInfluencers[i]).forEach(influencerFieldName=>{const value=anomalyInfluencers[i][influencerFieldName];items.push({title:influencerFieldName,description:getFilterEntity(influencerFieldName,value,influencerFilter)})})}return items}class anomaly_details_AnomalyDetails extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);this.state={showAllInfluencers:false};if(this.props.examples!==undefined&&this.props.examples.length>0){this.tabs=[{id:"Details",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.anomalyDetails.detailsTitle",{defaultMessage:"Details"}),content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement("div",{className:"ml-anomalies-table-details"},this.renderDescription(),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),this.renderDetails(),this.renderInfluencers()))},{id:"category-examples",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.anomalyDetails.categoryExamplesTitle",{defaultMessage:"Category examples"}),content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,this.renderCategoryExamples())}]}}toggleAllInfluencers(){this.setState({showAllInfluencers:!this.state.showAllInfluencers})}renderCategoryExamples(){const{examples:examples,definition:definition}=this.props;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"column",justifyContent:"center",gutterSize:"m",className:"mlAnomalyCategoryExamples"},definition!==undefined&&definition.terms&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{key:`example-terms`},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h4",{className:"mlAnomalyCategoryExamples__header"},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.anomalyDetails.termsTitle",{defaultMessage:"Terms"}))," ",external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIconTip"],{"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.anomalyDetails.termsDescriptionAriaLabel",{defaultMessage:"Description"}),type:"questionInCircle",color:"subdued",size:"s",content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.anomaliesTable.anomalyDetails.termsDescriptionTooltip",defaultMessage:"A space separated list of the common tokens that are matched in values of the category (may have been truncated to a max character limit of {maxChars})",values:{maxChars:MAX_CHARS}})})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs"},definition.terms)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xs"})),definition!==undefined&&definition.regex&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{key:`example-regex`},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h4",{className:"mlAnomalyCategoryExamples__header"},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.anomalyDetails.regexTitle",{defaultMessage:"Regex"}))," ",external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIconTip"],{"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.anomalyDetails.regexDescriptionAriaLabel",{defaultMessage:"Description"}),type:"questionInCircle",color:"subdued",size:"s",content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.anomaliesTable.anomalyDetails.regexDescriptionTooltip",defaultMessage:"The regular expression that is used to search for values that match the category (may have been truncated to a max character limit of {maxChars})",values:{maxChars:MAX_CHARS}})})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs"},definition.regex)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xs"})),examples.map((example,i)=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{key:`example${i}`},i===0&&definition!==undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h4",null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.anomalyDetails.examplesTitle",{defaultMessage:"Examples"}))),external_kbnSharedDeps_React_default.a.createElement("span",{className:"mlAnomalyCategoryExamples__item"},example))))}renderDescription(){const anomaly=this.props.anomaly;const source=anomaly.source;let anomalyDescription=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.anomalyDetails.anomalyInLabel",{defaultMessage:"{anomalySeverity} anomaly in {anomalyDetector}",values:{anomalySeverity:Object(anomaly_utils["h"])(anomaly.severity).label,anomalyDetector:anomaly.detector}});if(anomaly.entityName!==undefined){anomalyDescription+=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.anomalyDetails.foundForLabel",{defaultMessage:" found for {anomalyEntityName} {anomalyEntityValue}",values:{anomalyEntityName:anomaly.entityName,anomalyEntityValue:anomaly.entityValue}})}if(source.partition_field_name!==undefined&&source.partition_field_name!==anomaly.entityName){anomalyDescription+=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.anomalyDetails.detectedInLabel",{defaultMessage:" detected in {sourcePartitionFieldName} {sourcePartitionFieldValue}",values:{sourcePartitionFieldName:source.partition_field_name,sourcePartitionFieldValue:source.partition_field_value}})}let mvDescription=undefined;if(source.correlated_by_field_value!==undefined){mvDescription=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomaliesTable.anomalyDetails.multivariateDescription",{defaultMessage:"multivariate correlations found in {sourceByFieldName}; "+"{sourceByFieldValue} is considered anomalous given {sourceCorrelatedByFieldValue}",values:{sourceByFieldName:source.by_field_name,sourceByFieldValue:source.by_field_value,sourceCorrelatedByFieldValue:source.correlated_by_field_value}})}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h4",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.anomaliesTable.anomalyDetails.descriptionTitle",defaultMessage:"Description"})),anomalyDescription),mvDescription!==undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs"},mvDescription))}renderDetails(){const detailItems=getDetailsItems(this.props.anomaly,this.props.examples,this.props.filter);const isInterimResult=Object(external_kbnSharedDeps_Lodash_["get"])(this.props.anomaly,"source.is_interim",false);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs"},this.props.isAggregatedData===true?external_kbnSharedDeps_React_default.a.createElement("h4",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.anomaliesTable.anomalyDetails.detailsOnHighestSeverityAnomalyTitle",defaultMessage:"Details on highest severity anomaly"})):external_kbnSharedDeps_React_default.a.createElement("h4",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.anomaliesTable.anomalyDetails.anomalyDetailsTitle",defaultMessage:"Anomaly details"})),isInterimResult===true&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:"alert"}),external_kbnSharedDeps_React_default.a.createElement("span",{className:"interim-result"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.anomaliesTable.anomalyDetails.interimResultLabel",defaultMessage:"Interim result"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{type:"column",listItems:detailItems,className:"anomaly-description-list"}))}renderInfluencers(){const anomalyInfluencers=this.props.anomaly.influencers;let listItems=[];let othersCount=0;let numToDisplay=0;if(anomalyInfluencers!==undefined){numToDisplay=this.state.showAllInfluencers===true?anomalyInfluencers.length:Math.min(this.props.influencersLimit,anomalyInfluencers.length);othersCount=Math.max(anomalyInfluencers.length-numToDisplay,0);if(othersCount===1){numToDisplay++;othersCount=0}listItems=getInfluencersItems(anomalyInfluencers,this.props.influencerFilter,numToDisplay)}if(listItems.length>0){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h4",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.anomaliesTable.anomalyDetails.influencersTitle",defaultMessage:"Influencers"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{type:"column",listItems:listItems,className:"anomaly-description-list"}),othersCount>0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{onClick:()=>this.toggleAllInfluencers()},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.anomaliesTable.anomalyDetails.anomalyDescriptionListMoreLinkText",defaultMessage:"and {othersCount} more",values:{othersCount:othersCount}})),numToDisplay>this.props.influencersLimit+1&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{onClick:()=>this.toggleAllInfluencers()},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.anomaliesTable.anomalyDetails.anomalyDescriptionShowLessLinkText",defaultMessage:"show less"})))}}render(){const{tabIndex:tabIndex}=this.props;if(this.tabs!==undefined){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTabbedContent"],{tabs:this.tabs,size:"s",initialSelectedTab:this.tabs[tabIndex],onTabClick:()=>{}})}else{return external_kbnSharedDeps_React_default.a.createElement("div",{className:"ml-anomalies-table-details"},this.renderDescription(),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),this.renderDetails(),this.renderInfluencers())}}}var table_service=__webpack_require__(229);function DetectorDescriptionList({job:job,detector:detector,anomaly:anomaly}){const listItems=[{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.detectorDescriptionList.jobIdTitle",defaultMessage:"Job ID"}),description:job.job_id},{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.detectorDescriptionList.detectorTitle",defaultMessage:"Detector"}),description:detector.detector_description}];if(anomaly.actual!==undefined){const actual=Object(format_value["b"])(anomaly.actual,anomaly.source.function);const typical=Object(format_value["b"])(anomaly.typical,anomaly.source.function);listItems.push({title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.detectorDescriptionList.selectedAnomalyTitle",defaultMessage:"Selected anomaly"}),description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.detectorDescriptionList.selectedAnomalyDescription",defaultMessage:"actual {actual}, typical {typical}",values:{actual:actual,typical:typical}})})}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{className:"rule-detector-description-list",type:"column",listItems:listItems})}var detector_rule=__webpack_require__(24);function ActionsSection({actions:actions,onSkipResultChange:onSkipResultChange,onSkipModelUpdateChange:onSkipModelUpdateChange}){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.actionsSection.chooseActionsDescription",defaultMessage:"Choose the action(s) to take when the rule matches an anomaly."}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center",gutterSize:"s",responsive:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCheckbox"],{id:"skip_result_cb",label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.actionsSection.skipResultLabel",defaultMessage:"Skip result (recommended)"}),checked:actions.indexOf(detector_rule["a"].SKIP_RESULT)>-1,onChange:onSkipResultChange})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIconTip"],{content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.actionsSection.resultWillNotBeCreatedTooltip",defaultMessage:"The result will not be created."}),size:"s",position:"right"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center",gutterSize:"s",responsive:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCheckbox"],{id:"skip_model_update_cb",label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.actionsSection.skipModelUpdateLabel",defaultMessage:"Skip model update"}),checked:actions.indexOf(detector_rule["a"].SKIP_MODEL_UPDATE)>-1,onChange:onSkipModelUpdateChange})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIconTip"],{content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.actionsSection.valueWillNotBeUsedToUpdateModelTooltip",defaultMessage:"The value for that series will not be used to update the model."}),size:"s",position:"right"}))))}function getNewConditionDefaults(){return{applies_to:detector_rule["b"].ACTUAL,operator:detector_rule["e"].LESS_THAN,value:1}}function getNewRuleDefaults(){return{actions:[detector_rule["a"].SKIP_RESULT],conditions:[]}}function getScopeFieldDefaults(filterListIds){const defaults={filter_type:detector_rule["d"].INCLUDE,enabled:false};if(filterListIds!==undefined&&filterListIds.length>0){defaults.filter_id=filterListIds[0]}return defaults}function isValidRule(rule){let isValid=false;const actions=rule.actions;if(actions.length>0){const conditions=rule.conditions;if(conditions!==undefined&&conditions.length>0){isValid=true}else{const scope=rule.scope;if(scope!==undefined){isValid=Object.keys(scope).some(field=>scope[field].enabled===true)}}}return isValid}function saveJobRule(job,detectorIndex,ruleIndex,editedRule){const detector=job.analysis_config.detectors[detectorIndex];const clonedRule=Object(external_kbnSharedDeps_Lodash_["cloneDeep"])(editedRule);const scope=clonedRule.scope;if(scope!==undefined){Object.keys(scope).forEach(field=>{if(scope[field].enabled===false){delete scope[field]}else{delete scope[field].enabled}})}let rules=[];if(detector.custom_rules===undefined){rules=[clonedRule]}else{rules=Object(external_kbnSharedDeps_Lodash_["cloneDeep"])(detector.custom_rules);if(ruleIndex<rules.length){rules[ruleIndex]=clonedRule}else{rules.push(clonedRule)}}return updateJobRules(job,detectorIndex,rules)}function deleteJobRule(job,detectorIndex,ruleIndex){const detector=job.analysis_config.detectors[detectorIndex];let customRules=[];if(detector.custom_rules!==undefined&&ruleIndex<detector.custom_rules.length){customRules=Object(external_kbnSharedDeps_Lodash_["cloneDeep"])(detector.custom_rules);customRules.splice(ruleIndex,1);return updateJobRules(job,detectorIndex,customRules)}else{return Promise.reject(new Error(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.deleteJobRule.ruleNoLongerExistsErrorMessage",{defaultMessage:"Rule no longer exists for detector index {detectorIndex} in job {jobId}",values:{detectorIndex:detectorIndex,jobId:job.job_id}})))}}function updateJobRules(job,detectorIndex,rules){const jobId=job.job_id;const jobData={detectors:[{detector_index:detectorIndex,custom_rules:rules}]};let customSettings={};if(job.custom_settings!==undefined){customSettings={...job.custom_settings};Object(job_utils["r"])(customSettings);jobData.custom_settings=customSettings}return new Promise((resolve,reject)=>{ml_api_service["ml"].updateJob({jobId:jobId,job:jobData}).then(()=>{job_service["a"].refreshJob(jobId).then(()=>{resolve({success:true})}).catch(refreshResp=>{reject(refreshResp)})}).catch(resp=>{reject(resp)})})}function addItemToFilter(item,filterId){return new Promise((resolve,reject)=>{ml_api_service["ml"].filters.updateFilter(filterId,undefined,[item],undefined).then(updatedFilter=>{resolve(updatedFilter)}).catch(error=>{reject(error)})})}function buildRuleDescription(rule){const{actions:actions,conditions:conditions,scope:scope}=rule;let actionsText="";let conditionsText="";let filtersText="";actions.forEach((action,i)=>{if(i>0){actionsText+=" AND "}switch(action){case detector_rule["a"].SKIP_RESULT:actionsText+=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.ruleDescription.resultActionTypeText",{defaultMessage:"result",description:"Part of composite text: xpack.ml.ruleEditor.ruleDescription.[actionName]ActionTypeText +"+"xpack.ml.ruleEditor.ruleDescription.conditionsText + xpack.ml.ruleEditor.ruleDescription.filtersText"});break;case detector_rule["a"].SKIP_MODEL_UPDATE:actionsText+=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.ruleDescription.modelUpdateActionTypeText",{defaultMessage:"model update",description:"Part of composite text: xpack.ml.ruleEditor.ruleDescription.[actionName]ActionTypeText + "+"xpack.ml.ruleEditor.ruleDescription.conditionsText + xpack.ml.ruleEditor.ruleDescription.filtersText"});break}});if(conditions!==undefined){conditions.forEach((condition,i)=>{if(i>0){conditionsText+=" AND "}conditionsText+=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.ruleDescription.conditionsText",{defaultMessage:"{appliesTo} is {operator} {value}",values:{appliesTo:appliesToText(condition.applies_to),operator:operatorToText(condition.operator),value:condition.value},description:"Part of composite text: xpack.ml.ruleEditor.ruleDescription.[actionName]ActionTypeText + "+"xpack.ml.ruleEditor.ruleDescription.conditionsText + xpack.ml.ruleEditor.ruleDescription.filtersText"})})}if(scope!==undefined){if(conditions!==undefined&&conditions.length>0){filtersText+=" AND "}const fieldNames=Object.keys(scope);fieldNames.forEach((fieldName,i)=>{if(i>0){filtersText+=" AND "}const filter=scope[fieldName];filtersText+=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.ruleDescription.filtersText",{defaultMessage:"{fieldName} is {filterType} {filterId}",values:{fieldName:fieldName,filterType:filterTypeToText(filter.filter_type),filterId:filter.filter_id},description:"Part of composite text: xpack.ml.ruleEditor.ruleDescription.[actionName]ActionTypeText + "+"xpack.ml.ruleEditor.ruleDescription.conditionsText + xpack.ml.ruleEditor.ruleDescription.filtersText"})})}return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.ruleDescription",{defaultMessage:"skip {actions} when {conditions}{filters}",values:{actions:actionsText,conditions:conditionsText,filters:filtersText},description:"Composite text: xpack.ml.ruleEditor.ruleDescription.[actionName]ActionTypeText + "+"xpack.ml.ruleEditor.ruleDescription.conditionsText + xpack.ml.ruleEditor.ruleDescription.filtersText."+" (Example: skip model update when actual is less than 1 AND ip is in xxx)"})}function filterTypeToText(filterType){switch(filterType){case detector_rule["d"].INCLUDE:return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.includeFilterTypeText",{defaultMessage:"in"});case detector_rule["d"].EXCLUDE:return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.excludeFilterTypeText",{defaultMessage:"not in"});default:return filterType!==undefined?filterType:""}}function appliesToText(appliesTo){switch(appliesTo){case detector_rule["b"].ACTUAL:return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.actualAppliesTypeText",{defaultMessage:"actual"});case detector_rule["b"].TYPICAL:return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.typicalAppliesTypeText",{defaultMessage:"typical"});case detector_rule["b"].DIFF_FROM_TYPICAL:return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.diffFromTypicalAppliesTypeText",{defaultMessage:"diff from typical"});default:return appliesTo!==undefined?appliesTo:""}}function operatorToText(operator){switch(operator){case detector_rule["e"].LESS_THAN:return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.lessThanOperatorTypeText",{defaultMessage:"less than"});case detector_rule["e"].LESS_THAN_OR_EQUAL:return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.lessThanOrEqualToOperatorTypeText",{defaultMessage:"less than or equal to"});case detector_rule["e"].GREATER_THAN:return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.greaterThanOperatorTypeText",{defaultMessage:"greater than"});case detector_rule["e"].GREATER_THAN_OR_EQUAL:return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.greaterThanOrEqualToOperatorTypeText",{defaultMessage:"greater than or equal to"});default:return operator!==undefined?operator:""}}function getAppliesToValueFromAnomaly(anomaly,appliesTo){let actualValue;let typicalValue;const actual=anomaly.actual;if(actual!==undefined){actualValue=Array.isArray(actual)?actual[0]:actual}const typical=anomaly.typical;if(typical!==undefined){typicalValue=Array.isArray(typical)?typical[0]:typical}switch(appliesTo){case detector_rule["b"].ACTUAL:return actualValue;case detector_rule["b"].TYPICAL:return typicalValue;case detector_rule["b"].DIFF_FROM_TYPICAL:if(actual!==undefined&&typical!==undefined){return Math.abs(actualValue-typicalValue)}}return undefined}function condition_expression_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const POPOVER_STYLE={zIndex:"200"};class condition_expression_ConditionExpression extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);condition_expression_defineProperty(this,"openAppliesTo",()=>{this.setState({isAppliesToOpen:true,isOperatorValueOpen:false})});condition_expression_defineProperty(this,"closeAppliesTo",()=>{this.setState({isAppliesToOpen:false})});condition_expression_defineProperty(this,"openOperatorValue",()=>{this.setState({isAppliesToOpen:false,isOperatorValueOpen:true})});condition_expression_defineProperty(this,"closeOperatorValue",()=>{this.setState({isOperatorValueOpen:false})});condition_expression_defineProperty(this,"changeAppliesTo",event=>{const{index:index,operator:operator,value:value,updateCondition:updateCondition}=this.props;updateCondition(index,event.target.value,operator,value)});condition_expression_defineProperty(this,"changeOperator",event=>{const{index:index,appliesTo:appliesTo,value:value,updateCondition:updateCondition}=this.props;updateCondition(index,appliesTo,event.target.value,value)});condition_expression_defineProperty(this,"changeValue",event=>{const{index:index,appliesTo:appliesTo,operator:operator,updateCondition:updateCondition}=this.props;updateCondition(index,appliesTo,operator,+event.target.value)});this.state={isAppliesToOpen:false,isOperatorValueOpen:false}}renderAppliesToPopover(){return external_kbnSharedDeps_React_default.a.createElement("div",{style:POPOVER_STYLE},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopoverTitle"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.conditionExpression.appliesToPopoverTitle",defaultMessage:"When"})),external_kbnSharedDeps_React_default.a.createElement("div",{className:"euiExpression",style:{width:200}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{value:this.props.appliesTo,onChange:this.changeAppliesTo,options:[{value:detector_rule["b"].ACTUAL,text:appliesToText(detector_rule["b"].ACTUAL)},{value:detector_rule["b"].TYPICAL,text:appliesToText(detector_rule["b"].TYPICAL)},{value:detector_rule["b"].DIFF_FROM_TYPICAL,text:appliesToText(detector_rule["b"].DIFF_FROM_TYPICAL)}]})))}renderOperatorValuePopover(){return external_kbnSharedDeps_React_default.a.createElement("div",{style:POPOVER_STYLE},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopoverTitle"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.conditionExpression.operatorValuePopoverTitle",defaultMessage:"Is"})),external_kbnSharedDeps_React_default.a.createElement("div",{className:"euiExpression"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{style:{maxWidth:450}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:{width:250}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{value:this.props.operator,onChange:this.changeOperator,options:[{value:detector_rule["e"].LESS_THAN,text:operatorToText(detector_rule["e"].LESS_THAN)},{value:detector_rule["e"].LESS_THAN_OR_EQUAL,text:operatorToText(detector_rule["e"].LESS_THAN_OR_EQUAL)},{value:detector_rule["e"].GREATER_THAN,text:operatorToText(detector_rule["e"].GREATER_THAN)},{value:detector_rule["e"].GREATER_THAN_OR_EQUAL,text:operatorToText(detector_rule["e"].GREATER_THAN_OR_EQUAL)}]})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:{width:200}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{value:+this.props.value,onChange:this.changeValue})))))}render(){const{index:index,appliesTo:appliesTo,operator:operator,value:value,deleteCondition:deleteCondition}=this.props;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"m"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopover"],{id:"appliesToPopover",button:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiExpression"],{description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.conditionExpression.appliesToButtonLabel",defaultMessage:"when"}),value:appliesToText(appliesTo),isActive:this.state.isAppliesToOpen,onClick:this.openAppliesTo}),isOpen:this.state.isAppliesToOpen,closePopover:this.closeAppliesTo,panelPaddingSize:"none",ownFocus:true,anchorPosition:"downLeft"},this.renderAppliesToPopover())),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopover"],{id:"operatorValuePopover",button:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiExpression"],{description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.conditionExpression.operatorValueButtonLabel",defaultMessage:"is {operator}",values:{operator:operatorToText(operator)}}),value:`${value}`,isActive:this.state.isOperatorValueOpen,onClick:this.openOperatorValue}),isOpen:this.state.isOperatorValueOpen,closePopover:this.closeOperatorValue,panelPaddingSize:"none",ownFocus:true,withTitle:true,anchorPosition:"downLeft"},this.renderOperatorValuePopover())),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{size:"s",color:"danger",onClick:()=>deleteCondition(index),iconType:"trash","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.conditionExpression.deleteConditionButtonAriaLabel",{defaultMessage:"Delete condition"})})))}}function ConditionsSection({isEnabled:isEnabled,conditions:conditions,addCondition:addCondition,updateCondition:updateCondition,deleteCondition:deleteCondition}){if(isEnabled===false){return null}let expressions=[];if(conditions!==undefined){expressions=conditions.map((condition,index)=>external_kbnSharedDeps_React_default.a.createElement(condition_expression_ConditionExpression,{key:index,index:index,appliesTo:condition.applies_to,operator:condition.operator,value:condition.value,updateCondition:updateCondition,deleteCondition:deleteCondition}))}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,expressions,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:()=>addCondition()},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.conditionsSection.addNewConditionButtonLabel",defaultMessage:"Add new condition"})))}function scope_expression_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const scope_expression_POPOVER_STYLE={zIndex:"200"};function getFilterListOptions(filterListIds){return filterListIds.map(filterId=>({value:filterId,text:filterId}))}class scope_expression_ScopeExpression extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);scope_expression_defineProperty(this,"openFilterList",()=>{this.setState({isFilterListOpen:true})});scope_expression_defineProperty(this,"closeFilterList",()=>{this.setState({isFilterListOpen:false})});scope_expression_defineProperty(this,"onChangeFilterType",event=>{const{fieldName:fieldName,filterId:filterId,enabled:enabled,updateScope:updateScope}=this.props;updateScope(fieldName,filterId,event.target.value,enabled)});scope_expression_defineProperty(this,"onChangeFilterId",event=>{const{fieldName:fieldName,filterType:filterType,enabled:enabled,updateScope:updateScope}=this.props;updateScope(fieldName,event.target.value,filterType,enabled)});scope_expression_defineProperty(this,"onEnableChange",event=>{const{fieldName:fieldName,filterId:filterId,filterType:filterType,updateScope:updateScope}=this.props;updateScope(fieldName,filterId,filterType,event.target.checked)});this.state={isFilterListOpen:false}}renderFilterListPopover(){const{filterId:filterId,filterType:filterType,filterListIds:filterListIds}=this.props;return external_kbnSharedDeps_React_default.a.createElement("div",{style:scope_expression_POPOVER_STYLE},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopoverTitle"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.scopeExpression.scopeFilterTypePopoverTitle",defaultMessage:"Is"})),external_kbnSharedDeps_React_default.a.createElement("div",{className:"euiExpression"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{style:{maxWidth:450}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:{width:150}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{value:filterType,onChange:this.onChangeFilterType,options:[{value:detector_rule["d"].INCLUDE,text:filterTypeToText(detector_rule["d"].INCLUDE)},{value:detector_rule["d"].EXCLUDE,text:filterTypeToText(detector_rule["d"].EXCLUDE)}]})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:{width:300}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{value:filterId,onChange:this.onChangeFilterId,options:getFilterListOptions(filterListIds)})))))}render(){const{fieldName:fieldName,filterId:filterId,filterType:filterType,enabled:enabled,filterListIds:filterListIds}=this.props;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"m"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,className:"scope-field-checkbox"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCheckbox"],{id:`scope_cb_${fieldName}`,checked:enabled,onChange:this.onEnableChange})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiExpression"],{className:"scope-field-button",description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.scopeExpression.scopeFieldWhenLabel",defaultMessage:"when"}),value:fieldName,isActive:false,onClick:event=>event.preventDefault()})),filterListIds!==undefined&&filterListIds.length>0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopover"],{id:"operatorValuePopover",button:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiExpression"],{description:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.scopeExpression.scopeFilterTypeButtonLabel",defaultMessage:"is {filterType}",values:{filterType:filterTypeToText(filterType)}}),value:filterId||"",isActive:this.state.isFilterListOpen,onClick:this.openFilterList}),isOpen:this.state.isFilterListOpen,closePopover:this.closeFilterList,panelPaddingSize:"none",ownFocus:true,anchorPosition:"downLeft"},this.renderFilterListPopover())))}}function NoFilterListsCallOut(){const mlUrlGenerator=Object(contexts_kibana["d"])();const navigateToPath=Object(contexts_kibana["e"])();const redirectToFilterManagementPage=async()=>{const path=await mlUrlGenerator.createUrl({page:ml_url_generator["b"].FILTER_LISTS_MANAGE});await navigateToPath(path,true)};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.scopeSection.noFilterListsConfiguredTitle",defaultMessage:"No filter lists configured"}),iconType:"gear"},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.scopeSection.createFilterListsDescription",defaultMessage:"To configure scope, you must first use the {filterListsLink} settings page to create the list of values you want to include or exclude in the rule.",values:{filterListsLink:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{onClick:redirectToFilterManagementPage},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.scopeSection.createFilterListsDescription.filterListsLinkText",defaultMessage:"Filter Lists"}))}})))}function NoPermissionCallOut(){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.scopeSection.noPermissionToViewFilterListsTitle",defaultMessage:"You do not have permission to view filter lists"}),iconType:"gear"})}function ScopeSection({isEnabled:isEnabled,onEnabledChange:onEnabledChange,partitioningFieldNames:partitioningFieldNames,filterListIds:filterListIds,scope:scope,updateScope:updateScope}){const canGetFilters=Object(check_capabilities["e"])("canGetFilters");if(partitioningFieldNames===null||partitioningFieldNames.length===0){return null}let content;if(filterListIds.length>0){content=partitioningFieldNames.map((fieldName,index)=>{let filterValues;if(scope!==undefined&&scope[fieldName]!==undefined){filterValues=scope[fieldName]}else{filterValues=getScopeFieldDefaults(filterListIds)}return external_kbnSharedDeps_React_default.a.createElement(scope_expression_ScopeExpression,{key:index,fieldName:fieldName,filterId:filterValues.filter_id,filterType:filterValues.filter_type,enabled:filterValues.enabled,filterListIds:filterListIds,updateScope:updateScope})})}else if(canGetFilters===false){content=external_kbnSharedDeps_React_default.a.createElement(NoPermissionCallOut,null)}else{content=external_kbnSharedDeps_React_default.a.createElement(NoFilterListsCallOut,null)}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],null,external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.scopeSection.scopeTitle",defaultMessage:"Scope"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCheckbox"],{id:"enable_scope_checkbox",label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.scopeSection.addFilterListLabel",defaultMessage:"Add a filter list to limit where the rule applies."}),checked:isEnabled,onChange:onEnabledChange}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),isEnabled&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,content),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xxl"}))}function AddToFilterListLink({fieldValue:fieldValue,filterId:filterId,addItemToFilterList:addItemToFilterList}){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{onClick:()=>addItemToFilterList(fieldValue,filterId,true)},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.addValueToFilterListLinkText",defaultMessage:"Add {fieldValue} to {filterId}",values:{fieldValue:fieldValue,filterId:filterId}}))}function delete_rule_modal_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class delete_rule_modal_DeleteRuleModal extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);delete_rule_modal_defineProperty(this,"deleteRule",()=>{const{ruleIndex:ruleIndex,deleteRuleAtIndex:deleteRuleAtIndex}=this.props;deleteRuleAtIndex(ruleIndex);this.closeModal()});delete_rule_modal_defineProperty(this,"closeModal",()=>{this.setState({isModalVisible:false})});delete_rule_modal_defineProperty(this,"showModal",()=>{this.setState({isModalVisible:true})});this.state={isModalVisible:false}}render(){let modal;if(this.state.isModalVisible){modal=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiConfirmModal"],{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.deleteRuleModal.deleteRuleTitle",defaultMessage:"Delete rule?"}),onCancel:this.closeModal,onConfirm:this.deleteRule,buttonColor:"danger",cancelButtonText:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.deleteRuleModal.cancelButtonLabel",defaultMessage:"Cancel"}),confirmButtonText:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.deleteRuleModal.deleteButtonLabel",defaultMessage:"Delete"}),defaultFocusedButton:external_kbnSharedDeps_ElasticEui_["EUI_MODAL_CONFIRM_BUTTON"]})}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{color:"danger",onClick:()=>this.showModal()},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.deleteRuleModal.deleteRuleLinkText",defaultMessage:"Delete rule"})),modal)}}function edit_condition_link_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class edit_condition_link_EditConditionLink extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);edit_condition_link_defineProperty(this,"onChangeValue",event=>{const enteredValue=event.target.value;this.setState({value:enteredValue!==""?+enteredValue:""})});edit_condition_link_defineProperty(this,"onUpdateClick",()=>{const{conditionIndex:conditionIndex,updateConditionValue:updateConditionValue}=this.props;updateConditionValue(conditionIndex,this.state.value)});let value="";const anomaly=this.props.anomaly;const anomalyValue=getAppliesToValueFromAnomaly(anomaly,props.appliesTo);if(anomalyValue!==undefined){value=+Object(format_value["b"])(anomalyValue,anomaly.source.function)}this.state={value:value}}render(){const value=this.state.value;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center",gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.editConditionLink.updateRuleConditionFromText",defaultMessage:"Update rule condition from {conditionValue} to",values:{conditionValue:this.props.conditionValue}}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,className:"condition-edit-value-field"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{placeholder:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.editConditionLink.enterValuePlaceholder",{defaultMessage:"Enter value"}),compressed:true,value:value,onChange:this.onChangeValue,"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.editConditionLink.enterNumericValueForConditionAriaLabel",{defaultMessage:"Enter numeric value for condition"})})),value!==""&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{size:"s",onClick:()=>this.onUpdateClick()},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.editConditionLink.updateLinkText",defaultMessage:"Update"}))))}}function rule_action_panel_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class rule_action_panel_RuleActionPanel extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);rule_action_panel_defineProperty(this,"getEditRuleLink",()=>{const{ruleIndex:ruleIndex,setEditRuleIndex:setEditRuleIndex}=this.props;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{onClick:()=>setEditRuleIndex(ruleIndex)},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.ruleActionPanel.editRuleLinkText",defaultMessage:"Edit rule"}))});rule_action_panel_defineProperty(this,"getDeleteRuleLink",()=>{const{ruleIndex:ruleIndex,deleteRuleAtIndex:deleteRuleAtIndex}=this.props;return external_kbnSharedDeps_React_default.a.createElement(delete_rule_modal_DeleteRuleModal,{ruleIndex:ruleIndex,deleteRuleAtIndex:deleteRuleAtIndex})});rule_action_panel_defineProperty(this,"getQuickEditConditionLink",()=>{const conditions=this.rule.conditions;let link=null;if(this.rule.conditions!==undefined&&conditions.length===1){link=external_kbnSharedDeps_React_default.a.createElement(edit_condition_link_EditConditionLink,{conditionIndex:0,conditionValue:conditions[0].value,appliesTo:conditions[0].applies_to,anomaly:this.props.anomaly,updateConditionValue:this.updateConditionValue})}return link});rule_action_panel_defineProperty(this,"getQuickAddToFilterListLink",()=>{const{anomaly:anomaly,addItemToFilterList:addItemToFilterList}=this.props;const scope=this.rule.scope;const partitionFieldName=Object.keys(scope)[0];const partitionFieldValue=anomaly.source[partitionFieldName];const filterId=scope[partitionFieldName].filter_id;return external_kbnSharedDeps_React_default.a.createElement(AddToFilterListLink,{fieldValue:partitionFieldValue[0],filterId:filterId,addItemToFilterList:addItemToFilterList})});rule_action_panel_defineProperty(this,"updateConditionValue",(conditionIndex,value)=>{const{job:job,anomaly:anomaly,ruleIndex:ruleIndex,updateRuleAtIndex:updateRuleAtIndex}=this.props;const detector=job.analysis_config.detectors[anomaly.detectorIndex];const editedRule=Object(external_kbnSharedDeps_Lodash_["cloneDeep"])(detector.custom_rules[ruleIndex]);const conditions=editedRule.conditions;if(conditionIndex<conditions.length){conditions[conditionIndex].value=value}updateRuleAtIndex(ruleIndex,editedRule)});const{job:_job,anomaly:_anomaly,ruleIndex:_ruleIndex}=this.props;const _detector=_job.analysis_config.detectors[_anomaly.detectorIndex];const rules=_detector.custom_rules;if(rules!==undefined&&_ruleIndex<rules.length){this.rule=rules[_ruleIndex]}this.state={showAddToFilterListLink:false}}componentDidMount(){const scope=this.rule.scope;if(scope!==undefined&&Object.keys(scope).length===1){const partitionFieldName=Object.keys(scope)[0];const partitionFieldValue=this.props.anomaly.source[partitionFieldName];if(scope[partitionFieldName]!==undefined&&partitionFieldValue!==undefined&&partitionFieldValue.length===1&&partitionFieldValue[0].length>0){const filterId=scope[partitionFieldName].filter_id;ml_api_service["ml"].filters.filters({filterId:filterId}).then(filter=>{const filterItems=filter.items;if(filterItems.indexOf(partitionFieldValue[0])===-1){this.setState({showAddToFilterListLink:true})}}).catch(resp=>{console.log(`Error loading filter ${filterId}:`,resp)})}}}render(){if(this.rule===undefined){return null}const descriptionListItems=[{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.ruleActionPanel.ruleTitle",defaultMessage:"Rule"}),description:buildRuleDescription(this.rule,this.props.anomaly)},{title:"",description:this.getEditRuleLink()},{title:"",description:this.getDeleteRuleLink()}];const quickConditionLink=this.getQuickEditConditionLink();if(quickConditionLink!==null){descriptionListItems.splice(1,0,{title:"",description:quickConditionLink})}if(this.state.showAddToFilterListLink===true){const quickAddToFilterListLink=this.getQuickAddToFilterListLink();descriptionListItems.splice(descriptionListItems.length-2,0,{title:"",description:quickAddToFilterListLink})}descriptionListItems[1].title=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.ruleActionPanel.actionsTitle",defaultMessage:"Actions"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],{paddingSize:"m",className:"select-rule-action-panel"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDescriptionList"],{type:"column",listItems:descriptionListItems}))}}function SelectRuleAction({job:job,anomaly:anomaly,setEditRuleIndex:setEditRuleIndex,updateRuleAtIndex:updateRuleAtIndex,deleteRuleAtIndex:deleteRuleAtIndex,addItemToFilterList:addItemToFilterList}){const detectorIndex=anomaly.detectorIndex;const detector=job.analysis_config.detectors[detectorIndex];const rules=detector.custom_rules||[];let ruleActionPanels;if(rules.length>0){ruleActionPanels=rules.map((rule,index)=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,{key:`rule_panel_${index}_${rules.length}`},external_kbnSharedDeps_React_default.a.createElement(rule_action_panel_RuleActionPanel,{job:job,ruleIndex:index,anomaly:anomaly,setEditRuleIndex:setEditRuleIndex,updateRuleAtIndex:updateRuleAtIndex,deleteRuleAtIndex:deleteRuleAtIndex,addItemToFilterList:addItemToFilterList}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"})))}return external_kbnSharedDeps_React_default.a.createElement("div",{className:"select-rule-action"},rules.length>0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(DetectorDescriptionList,{job:job,detector:detector,anomaly:anomaly}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),ruleActionPanels,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{style:{display:"inline"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.selectRuleAction.orText",defaultMessage:"Or "}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{onClick:()=>setEditRuleIndex(rules.length)},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.selectRuleAction.createRuleLinkText",defaultMessage:"create a rule"})))}function rule_editor_flyout_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class rule_editor_flyout_RuleEditorFlyoutUI extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);rule_editor_flyout_defineProperty(this,"showFlyout",anomaly=>{let ruleIndex=-1;const job=job_service["a"].getJob(anomaly.jobId);if(job===undefined){const{toasts:toasts}=this.props.kibana.services.notifications;toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.ruleEditorFlyout.unableToConfigureRulesNotificationMesssage",{defaultMessage:"Unable to configure rules as an error occurred obtaining details for job ID {jobId}",values:{jobId:anomaly.jobId}}));this.setState({job:job,isFlyoutVisible:false});return}this.partitioningFieldNames=Object(job_utils["h"])(job,anomaly.detectorIndex);const detectorIndex=anomaly.detectorIndex;const detector=job.analysis_config.detectors[detectorIndex];if(detector.custom_rules===undefined){ruleIndex=0}let isConditionsEnabled=false;if(ruleIndex===0){isConditionsEnabled=this.partitioningFieldNames.length===0}this.setState({anomaly:anomaly,job:job,ruleIndex:ruleIndex,isConditionsEnabled:isConditionsEnabled,isScopeEnabled:false,isFlyoutVisible:true});if(this.partitioningFieldNames.length>0&&this.canGetFilters){ml_api_service["ml"].filters.filters().then(filters=>{const filterListIds=filters.map(filter=>filter.filter_id);this.setState({filterListIds:filterListIds})}).catch(resp=>{console.log("Error loading list of filters:",resp);const{toasts:toasts}=this.props.kibana.services.notifications;toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.ruleEditorFlyout.errorWithLoadingFilterListsNotificationMesssage",{defaultMessage:"Error loading the filter lists used in the rule scope"}))})}});rule_editor_flyout_defineProperty(this,"closeFlyout",()=>{this.setState({isFlyoutVisible:false})});rule_editor_flyout_defineProperty(this,"setEditRuleIndex",ruleIndex=>{const detectorIndex=this.state.anomaly.detectorIndex;const detector=this.state.job.analysis_config.detectors[detectorIndex];const rules=detector.custom_rules;const rule=rules===undefined||ruleIndex>=rules.length?getNewRuleDefaults():rules[ruleIndex];const isConditionsEnabled=this.partitioningFieldNames.length===0||rule.conditions!==undefined&&rule.conditions.length>0;const isScopeEnabled=rule.scope!==undefined&&Object.keys(rule.scope).length>0;if(isScopeEnabled===true){Object.keys(rule.scope).forEach(field=>{rule.scope[field].enabled=true})}this.setState({ruleIndex:ruleIndex,rule:rule,isConditionsEnabled:isConditionsEnabled,isScopeEnabled:isScopeEnabled})});rule_editor_flyout_defineProperty(this,"onSkipResultChange",e=>{const checked=e.target.checked;this.setState(prevState=>{const actions=[...prevState.rule.actions];const idx=actions.indexOf(detector_rule["a"].SKIP_RESULT);if(idx===-1&&checked){actions.push(detector_rule["a"].SKIP_RESULT)}else if(idx>-1&&!checked){actions.splice(idx,1)}return{rule:{...prevState.rule,actions:actions}}})});rule_editor_flyout_defineProperty(this,"onSkipModelUpdateChange",e=>{const checked=e.target.checked;this.setState(prevState=>{const actions=[...prevState.rule.actions];const idx=actions.indexOf(detector_rule["a"].SKIP_MODEL_UPDATE);if(idx===-1&&checked){actions.push(detector_rule["a"].SKIP_MODEL_UPDATE)}else if(idx>-1&&!checked){actions.splice(idx,1)}return{rule:{...prevState.rule,actions:actions}}})});rule_editor_flyout_defineProperty(this,"onConditionsEnabledChange",e=>{const isConditionsEnabled=e.target.checked;this.setState(prevState=>{let conditions;if(isConditionsEnabled===false){conditions=[]}else{conditions=[getNewConditionDefaults()]}return{rule:{...prevState.rule,conditions:conditions},isConditionsEnabled:isConditionsEnabled}})});rule_editor_flyout_defineProperty(this,"addCondition",()=>{this.setState(prevState=>{const conditions=[...prevState.rule.conditions];conditions.push(getNewConditionDefaults());return{rule:{...prevState.rule,conditions:conditions}}})});rule_editor_flyout_defineProperty(this,"updateCondition",(index,appliesTo,operator,value)=>{this.setState(prevState=>{const conditions=[...prevState.rule.conditions];if(index<conditions.length){conditions[index]={applies_to:appliesTo,operator:operator,value:value}}return{rule:{...prevState.rule,conditions:conditions}}})});rule_editor_flyout_defineProperty(this,"deleteCondition",index=>{this.setState(prevState=>{const conditions=[...prevState.rule.conditions];if(index<conditions.length){conditions.splice(index,1)}return{rule:{...prevState.rule,conditions:conditions}}})});rule_editor_flyout_defineProperty(this,"onScopeEnabledChange",e=>{const isScopeEnabled=e.target.checked;this.setState(prevState=>{const rule={...prevState.rule};if(isScopeEnabled===false){delete rule.scope}return{rule:rule,isScopeEnabled:isScopeEnabled}})});rule_editor_flyout_defineProperty(this,"updateScope",(fieldName,filterId,filterType,enabled)=>{this.setState(prevState=>{let scope={...prevState.rule.scope};if(scope===undefined){scope={}}scope[fieldName]={filter_id:filterId,filter_type:filterType,enabled:enabled};return{rule:{...prevState.rule,scope:scope}}})});rule_editor_flyout_defineProperty(this,"saveEdit",()=>{const{rule:rule,ruleIndex:ruleIndex}=this.state;this.updateRuleAtIndex(ruleIndex,rule)});rule_editor_flyout_defineProperty(this,"updateRuleAtIndex",(ruleIndex,editedRule)=>{const{toasts:toasts}=this.props.kibana.services.notifications;const{job:job,anomaly:anomaly}=this.state;const jobId=job.job_id;const detectorIndex=anomaly.detectorIndex;saveJobRule(job,detectorIndex,ruleIndex,editedRule).then(resp=>{if(resp.success){toasts.add({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.ruleEditorFlyout.changesToJobDetectorRulesSavedNotificationMessageTitle",{defaultMessage:"Changes to {jobId} detector rules saved",values:{jobId:jobId}}),color:"success",iconType:"check",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.ruleEditorFlyout.changesToJobDetectorRulesSavedNotificationMessageDescription",{defaultMessage:"Note that changes will take effect for new results only."})});this.closeFlyout()}else{toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.ruleEditorFlyout.errorWithSavingChangesToJobDetectorRulesNotificationMessage",{defaultMessage:"Error saving changes to {jobId} detector rules",values:{jobId:jobId}}))}}).catch(error=>{console.error(error);toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.ruleEditorFlyout.errorWithSavingChangesToJobDetectorRulesNotificationMessage",{defaultMessage:"Error saving changes to {jobId} detector rules",values:{jobId:jobId}}))})});rule_editor_flyout_defineProperty(this,"deleteRuleAtIndex",index=>{const{toasts:toasts}=this.props.kibana.services.notifications;const{job:job,anomaly:anomaly}=this.state;const jobId=job.job_id;const detectorIndex=anomaly.detectorIndex;deleteJobRule(job,detectorIndex,index).then(resp=>{if(resp.success){toasts.addSuccess(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.ruleEditorFlyout.ruleDeletedFromJobDetectorNotificationMessage",{defaultMessage:"Rule deleted from {jobId} detector",values:{jobId:jobId}}));const updatedJob=job_service["a"].getJob(anomaly.jobId);const updatedDetector=updatedJob.analysis_config.detectors[detectorIndex];const updatedRules=updatedDetector.custom_rules;if(!updatedRules){this.closeFlyout()}else{this.setState({job:{...updatedJob}})}}else{toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.ruleEditorFlyout.errorWithDeletingRuleFromJobDetectorNotificationMessage",{defaultMessage:"Error deleting rule from {jobId} detector",values:{jobId:jobId}}))}}).catch(error=>{console.error(error);let errorMessage=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.ruleEditorFlyout.errorWithDeletingRuleFromJobDetectorNotificationMessage",{defaultMessage:"Error deleting rule from {jobId} detector",values:{jobId:jobId}});if(error.error){errorMessage+=` : ${Object(util_errors["i"])(error.error)}`}toasts.addDanger(errorMessage)})});rule_editor_flyout_defineProperty(this,"addItemToFilterList",(item,filterId,closeFlyoutOnAdd)=>{const{toasts:toasts}=this.props.kibana.services.notifications;addItemToFilter(item,filterId).then(()=>{if(closeFlyoutOnAdd===true){toasts.add({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.ruleEditorFlyout.addedItemToFilterListNotificationMessageTitle",{defaultMessage:"Added {item} to {filterId}",values:{item:item,filterId:filterId}}),color:"success",iconType:"check",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.ruleEditorFlyout.addedItemToFilterListNotificationMessageDescription",{defaultMessage:"Note that changes will take effect for new results only."})});this.closeFlyout()}}).catch(error=>{console.log(`Error adding ${item} to filter ${filterId}:`,error);toasts.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.ruleEditorFlyout.errorWithAddingItemToFilterListNotificationMessage",{defaultMessage:"An error occurred adding {item} to filter {filterId}",values:{item:item,filterId:filterId}}))})});this.state={anomaly:{},job:{},ruleIndex:-1,rule:getNewRuleDefaults(),skipModelUpdate:false,isConditionsEnabled:false,isScopeEnabled:false,filterListIds:[],isFlyoutVisible:false};this.partitioningFieldNames=[];this.canGetFilters=Object(check_capabilities["e"])("canGetFilters")}componentDidMount(){if(typeof this.props.setShowFunction==="function"){this.props.setShowFunction(this.showFlyout)}}componentWillUnmount(){if(typeof this.props.unsetShowFunction==="function"){this.props.unsetShowFunction()}}render(){const docsUrl=this.props.kibana.services.docLinks.links.ml.customRules;const{isFlyoutVisible:isFlyoutVisible,job:job,anomaly:anomaly,ruleIndex:ruleIndex,rule:rule,filterListIds:filterListIds,isConditionsEnabled:isConditionsEnabled,isScopeEnabled:isScopeEnabled}=this.state;if(isFlyoutVisible===false){return null}let flyout;if(ruleIndex===-1){flyout=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyout"],{className:"ml-rule-editor-flyout",onClose:this.closeFlyout,"aria-labelledby":"flyoutTitle"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutHeader"],{hasBorder:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"m"},external_kbnSharedDeps_React_default.a.createElement("h1",{id:"flyoutTitle"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.ruleEditorFlyout.editRulesTitle",defaultMessage:"Edit rules"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutBody"],null,external_kbnSharedDeps_React_default.a.createElement(SelectRuleAction,{job:job,anomaly:anomaly,setEditRuleIndex:this.setEditRuleIndex,updateRuleAtIndex:this.updateRuleAtIndex,deleteRuleAtIndex:this.deleteRuleAtIndex,addItemToFilterList:this.addItemToFilterList})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutFooter"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{iconType:"cross",onClick:this.closeFlyout,flush:"left"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.ruleEditorFlyout.closeButtonLabel",defaultMessage:"Close"}))))))}else{const detectorIndex=anomaly.detectorIndex;const detector=job.analysis_config.detectors[detectorIndex];const rules=detector.custom_rules;const isCreate=rules===undefined||ruleIndex>=rules.length;const hasPartitioningFields=this.partitioningFieldNames&&this.partitioningFieldNames.length>0;const conditionSupported=detector_rule["c"].indexOf(anomaly.source.function)===-1;const conditionsText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.ruleEditor.ruleEditorFlyout.conditionsDescription",{defaultMessage:"Add numeric conditions for when the rule applies. Multiple conditions are combined using AND."});flyout=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyout"],{className:"ml-rule-editor-flyout",onClose:this.closeFlyout,"aria-labelledby":"flyoutTitle"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutHeader"],{hasBorder:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"m"},external_kbnSharedDeps_React_default.a.createElement("h1",{id:"flyoutTitle"},isCreate===true?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.ruleEditorFlyout.createRuleTitle",defaultMessage:"Create rule"}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.ruleEditorFlyout.editRuleTitle",defaultMessage:"Edit rule"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutBody"],null,external_kbnSharedDeps_React_default.a.createElement(DetectorDescriptionList,{job:job,detector:detector,anomaly:anomaly}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.ruleEditorFlyout.rulesDescription",defaultMessage:"Rules instruct anomaly detectors to change their behavior based on domain-specific knowledge that you provide. When you create a rule, you can specify conditions, scope, and actions. When the conditions of a rule are satisfied, its actions are triggered. {learnMoreLink}",values:{learnMoreLink:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{href:docsUrl,target:"_blank"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.ruleEditorFlyout.rulesDescription.learnMoreLinkText",defaultMessage:"Learn more"}))}}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],null,external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.ruleEditorFlyout.actionTitle",defaultMessage:"Action"}))),external_kbnSharedDeps_React_default.a.createElement(ActionsSection,{actions:rule.actions,onSkipResultChange:this.onSkipResultChange,onSkipModelUpdateChange:this.onSkipModelUpdateChange}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xl"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],null,external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.ruleEditorFlyout.conditionsTitle",defaultMessage:"Conditions"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),conditionSupported===true?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCheckbox"],{id:"enable_conditions_checkbox",className:"scope-enable-checkbox",label:conditionsText,checked:isConditionsEnabled,onChange:this.onConditionsEnabledChange,disabled:!conditionSupported||!hasPartitioningFields}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.ruleEditorFlyout.conditionsNotSupportedTitle",defaultMessage:"Conditions are not supported for detectors using the {functionName} function",values:{functionName:anomaly.source.function}}),iconType:"iInCircle"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(ConditionsSection,{isEnabled:isConditionsEnabled,conditions:rule.conditions,addCondition:this.addCondition,updateCondition:this.updateCondition,deleteCondition:this.deleteCondition}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xl"}),external_kbnSharedDeps_React_default.a.createElement(ScopeSection,{isEnabled:isScopeEnabled,onEnabledChange:this.onScopeEnabledChange,partitioningFieldNames:this.partitioningFieldNames,filterListIds:filterListIds,scope:rule.scope,updateScope:this.updateScope}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.ruleEditorFlyout.rerunJobTitle",defaultMessage:"Rerun job"}),color:"warning",iconType:"help"},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.ruleEditorFlyout.whenChangesTakeEffectDescription",defaultMessage:"Changes to rules take effect for new results only."})),external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.ruleEditorFlyout.howToApplyChangesToExistingResultsDescription",defaultMessage:"To apply these changes to existing results you must clone and rerun the job. Note rerunning the job may take some time and should only be done once you have completed all your changes to the rules for this job."})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutFooter"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{iconType:"cross",onClick:this.closeFlyout,flush:"left"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.ruleEditorFlyout.closeButtonLabel",defaultMessage:"Close"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:this.saveEdit,isDisabled:!isValidRule(rule),fill:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.ruleEditor.ruleEditorFlyout.saveButtonLabel",defaultMessage:"Save"}))))))}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,flyout)}}const RuleEditorFlyout=Object(kibanaReact_public_["withKibana"])(rule_editor_flyout_RuleEditorFlyoutUI);function anomalies_table_extends(){anomalies_table_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return anomalies_table_extends.apply(this,arguments)}function anomalies_table_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class anomalies_table_AnomaliesTableInternal extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);anomalies_table_defineProperty(this,"isShowingAggregatedData",()=>this.props.tableData.interval!=="second");anomalies_table_defineProperty(this,"toggleRow",async(item,tab=ANOMALIES_TABLE_TABS.DETAILS)=>{const itemIdToExpandedRowMap={...this.state.itemIdToExpandedRowMap};if(itemIdToExpandedRowMap[item.rowId]){delete itemIdToExpandedRowMap[item.rowId]}else{const examples=item.entityName==="mlcategory"?Object(external_kbnSharedDeps_Lodash_["get"])(this.props.tableData,["examplesByJobId",item.jobId,item.entityValue]):undefined;let definition=undefined;if(examples!==undefined){try{definition=await ml_api_service["ml"].results.getCategoryDefinition(item.jobId,item.source.mlcategory[0]);if(definition.terms&&definition.terms.length>MAX_CHARS){definition.terms=`${definition.terms.substring(0,MAX_CHARS)}...`}if(definition.regex&&definition.regex.length>MAX_CHARS){definition.terms=`${definition.regex.substring(0,MAX_CHARS)}...`}}catch(error){console.log("Error fetching category definition for row item.",error)}}itemIdToExpandedRowMap[item.rowId]=external_kbnSharedDeps_React_default.a.createElement(anomaly_details_AnomalyDetails,{tabIndex:tab,anomaly:item,examples:examples,definition:definition,isAggregatedData:this.isShowingAggregatedData(),filter:this.props.filter,influencerFilter:this.props.influencerFilter,influencersLimit:INFLUENCERS_LIMIT})}this.setState({itemIdToExpandedRowMap:itemIdToExpandedRowMap})});anomalies_table_defineProperty(this,"onMouseOverRow",record=>{if(this.mouseOverRecord!==undefined){if(this.mouseOverRecord.rowId!==record.rowId){table_service["a"].rowMouseleave$.next({record:this.mouseOverRecord});table_service["a"].rowMouseenter$.next({record:record})}}else{table_service["a"].rowMouseenter$.next({record:record})}this.mouseOverRecord=record});anomalies_table_defineProperty(this,"onMouseLeaveRow",()=>{if(this.mouseOverRecord!==undefined){table_service["a"].rowMouseleave$.next({record:this.mouseOverRecord});this.mouseOverRecord=undefined}});anomalies_table_defineProperty(this,"setShowRuleEditorFlyoutFunction",func=>{this.setState({showRuleEditorFlyout:func})});anomalies_table_defineProperty(this,"unsetShowRuleEditorFlyoutFunction",()=>{const showRuleEditorFlyout=()=>{};this.setState({showRuleEditorFlyout:showRuleEditorFlyout})});anomalies_table_defineProperty(this,"onTableChange",({page:page,sort:sort})=>{const{tableState:tableState,updateTableState:updateTableState}=this.props;const result={pageIndex:page&&page.index!==undefined?page.index:tableState.pageIndex,pageSize:page&&page.size!==undefined?page.size:tableState.pageSize,sortField:sort&&sort.field!==undefined?sort.field:tableState.sortField,sortDirection:sort&&sort.direction!==undefined?sort.direction:tableState.sortDirection};updateTableState(result)});this.state={itemIdToExpandedRowMap:{},showRuleEditorFlyout:()=>{}}}static getDerivedStateFromProps(nextProps,prevState){const itemIdToExpandedRowMap=prevState.itemIdToExpandedRowMap;const prevExpandedNotInData=Object.keys(itemIdToExpandedRowMap).find(rowId=>{const matching=nextProps.tableData.anomalies.find(anomaly=>anomaly.rowId===rowId);return matching===undefined});if(prevExpandedNotInData!==undefined){return{itemIdToExpandedRowMap:{}}}return null}render(){const{bounds:bounds,tableData:tableData,filter:filter,influencerFilter:influencerFilter,tableState:tableState}=this.props;if(tableData===undefined||tableData.anomalies===undefined||tableData.anomalies.length===0){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceAround"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement("h4",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.anomaliesTable.noMatchingAnomaliesFoundTitle",defaultMessage:"No matching anomalies found"})))))}const columns=anomalies_table_columns_getColumns(tableData.anomalies,tableData.jobIds,tableData.examplesByJobId,this.isShowingAggregatedData(),tableData.interval,bounds,tableData.showViewSeriesLink,this.state.showRuleEditorFlyout,this.state.itemIdToExpandedRowMap,this.toggleRow,filter,influencerFilter);const sorting={sort:{field:tableState.sortField,direction:tableState.sortDirection}};const getRowProps=item=>({onMouseOver:()=>this.onMouseOverRow(item),onMouseLeave:()=>this.onMouseLeaveRow(),"data-test-subj":`mlAnomaliesListRow row-${item.rowId}`});const pagination={pageIndex:tableState.pageIndex,pageSize:tableState.pageSize,totalItemCount:tableData.anomalies.length,pageSizeOptions:[10,25,100]};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(RuleEditorFlyout,{setShowFunction:this.setShowRuleEditorFlyoutFunction,unsetShowFunction:this.unsetShowRuleEditorFlyoutFunction}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiInMemoryTable"],{className:"ml-anomalies-table eui-textOverflowWrap",items:tableData.anomalies,columns:columns,pagination:pagination,sorting:sorting,itemId:"rowId",itemIdToExpandedRowMap:this.state.itemIdToExpandedRowMap,compressed:true,rowProps:getRowProps,"data-test-subj":"mlAnomaliesTable",onTableChange:this.onTableChange}))}}const getDefaultAnomaliesTableState=()=>({pageIndex:0,pageSize:25,sortField:"severity",sortDirection:"desc"});const AnomaliesTable=props=>{const[tableState,updateTableState]=Object(url_state["b"])("mlAnomaliesTable",getDefaultAnomaliesTableState());return external_kbnSharedDeps_React_default.a.createElement(anomalies_table_AnomaliesTableInternal,anomalies_table_extends({},props,{tableState:tableState,updateTableState:updateTableState}))};const MESSAGE_LEVEL={ERROR:"error",INFO:"info",SUCCESS:"success",WARNING:"warning"};function message_call_out_extends(){message_call_out_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return message_call_out_extends.apply(this,arguments)}function getCallOutAttributes(message,status){switch(status){case MESSAGE_LEVEL.ERROR:return{title:message,iconType:"cross",color:"danger"};case MESSAGE_LEVEL.WARNING:return{title:message,iconType:"alert",color:"warning"};case MESSAGE_LEVEL.SUCCESS:return{title:message,iconType:"check",color:"success"};case MESSAGE_LEVEL.INFO:return{title:message,iconType:"iInCircle",color:"primary"}}}function MessageCallOut({message:message,status:status,...rest}){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],message_call_out_extends({size:"s"},getCallOutAttributes(message,status),rest))}function forecasts_list_getColumns(viewForecast){return[{field:"forecast_create_timestamp",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.forecastsList.createdColumnName",{defaultMessage:"Created"}),dataType:"date",render:date=>Object(date_utils["c"])(date),sortable:true},{field:"forecast_start_timestamp",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.forecastsList.fromColumnName",{defaultMessage:"From"}),dataType:"date",render:date=>Object(date_utils["c"])(date),sortable:true},{field:"forecast_end_timestamp",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.forecastsList.toColumnName",{defaultMessage:"To"}),dataType:"date",render:date=>Object(date_utils["c"])(date),sortable:true},{name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.forecastsList.viewColumnName",{defaultMessage:"View"}),width:"60px",render:forecast=>{const viewForecastAriaLabel=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.forecastsList.viewForecastAriaLabel",{defaultMessage:"View forecast created at {createdDate}",values:{createdDate:Object(date_utils["c"])(forecast.forecast_create_timestamp)}});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{onClick:()=>viewForecast(forecast.forecast_id),iconType:"visLine","aria-label":viewForecastAriaLabel})}}]}function ForecastsList({forecasts:forecasts,viewForecast:viewForecast}){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement("h3",{"aria-describedby":"ml_aria_description_forecasting_modal_view_list",style:{display:"inline",paddingRight:"5px"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.timeSeriesExplorer.forecastsList.previousForecastsTitle",defaultMessage:"Previous forecasts"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{position:"right",content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.timeSeriesExplorer.forecastsList.listsOfFiveRecentlyRunForecastsTooltip",defaultMessage:"Lists a maximum of five of the most recently run forecasts."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:"questionInCircle",size:"s"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiInMemoryTable"],{items:forecasts,columns:forecasts_list_getColumns(viewForecast),pagination:false,"data-test-subj":"mlModalForecastTable"}))}ForecastsList.propType={forecasts:prop_types_default.a.array,viewForecast:prop_types_default.a.func.isRequired};const PROGRESS_STATES={UNSET:-1,WAITING:0,DONE:1,ERROR:-10};function ProgressIcon({state:state}){if(state===PROGRESS_STATES.WAITING){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLoadingSpinner"],{size:"m"})}else if(state===PROGRESS_STATES.DONE){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:"check",size:"m",color:"primary"})}else if(state===PROGRESS_STATES.ERROR){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:"cross",size:"m",color:"danger"})}}function ForecastProgress({forecastProgress:forecastProgress,jobOpeningState:jobOpeningState,jobClosingState:jobClosingState}){return external_kbnSharedDeps_React_default.a.createElement("div",null,jobOpeningState!==PROGRESS_STATES.UNSET&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"s",alignItems:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h3",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.timeSeriesExplorer.forecastingModal.openingJobTitle",defaultMessage:"Opening job…"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(ProgressIcon,{state:jobOpeningState}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"})),forecastProgress!==PROGRESS_STATES.UNSET&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"s",alignItems:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h3",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.timeSeriesExplorer.forecastingModal.runningForecastTitle",defaultMessage:"Running forecast…"})))),forecastProgress>=0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{position:"top",content:forecastProgress+"%"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiProgress"],{size:"l",value:forecastProgress,max:100}))),forecastProgress===PROGRESS_STATES.ERROR&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(ProgressIcon,{state:PROGRESS_STATES.ERROR}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"})),jobClosingState!==PROGRESS_STATES.UNSET&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"s",alignItems:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h3",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.timeSeriesExplorer.forecastingModal.closingJobTitle",defaultMessage:"Closing job…"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(ProgressIcon,{state:jobClosingState})))))}ForecastProgress.propType={forecastProgress:prop_types_default.a.number,jobOpeningState:prop_types_default.a.number,jobClosingState:prop_types_default.a.number};function getRunInputDisabledState(job,isForecastRequested){if(Object(check_ml_nodes["b"])()===false){return{isDisabled:true,isDisabledToolTipText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.runControls.noMLNodesAvailableTooltip",{defaultMessage:"There are no ML nodes available."})}}if(Object(check_capabilities["e"])("canForecastJob")===false){return{isDisabled:true,isDisabledToolTipText:Object(check_capabilities["f"])("canForecastJob")}}if(job.state!==states["c"].OPENED&&job.state!==states["c"].CLOSED){return{isDisabled:true,isDisabledToolTipText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.runControls.forecastsCanNotBeRunOnJobsTooltip",{defaultMessage:"Forecasts cannot be run on {jobState} jobs",values:{jobState:job.state}})}}return{isDisabled:isForecastRequested}}function RunControls({job:job,newForecastDuration:newForecastDuration,isNewForecastDurationValid:isNewForecastDurationValid,newForecastDurationErrors:newForecastDurationErrors,onNewForecastDurationChange:onNewForecastDurationChange,runForecast:runForecast,isForecastRequested:isForecastRequested,forecastProgress:forecastProgress,jobOpeningState:jobOpeningState,jobClosingState:jobClosingState}){const disabledState=getRunInputDisabledState(job,isForecastRequested);const durationInput=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{name:"forecastDuration",value:newForecastDuration,disabled:disabledState.isDisabled,isInvalid:!isNewForecastDurationValid,onChange:onNewForecastDurationChange,fullWidth:true});const runButton=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:runForecast,isDisabled:disabledState.isDisabled||!isNewForecastDurationValid,"data-test-subj":"mlModalForecastButtonRun"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.timeSeriesExplorer.runControls.runButtonLabel",defaultMessage:"Run"}));return external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement("h3",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.timeSeriesExplorer.runControls.runNewForecastTitle",defaultMessage:"Run a new forecast"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiForm"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.timeSeriesExplorer.runControls.durationLabel",defaultMessage:"Duration"}),fullWidth:true,isInvalid:!isNewForecastDurationValid,error:newForecastDurationErrors,helpText:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.timeSeriesExplorer.runControls.forecastMaximumLengthHelpText",defaultMessage:"Length of forecast, up to a maximum of {maximumForecastDurationDays} days. Use s for seconds, m for minutes, h for hours, d for days, w for weeks.",values:{maximumForecastDurationDays:FORECAST_DURATION_MAX_DAYS}})},disabledState.isDisabledToolTipText===undefined?durationInput:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{position:"right",content:disabledState.isDisabledToolTipText},durationInput))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{hasEmptyLabelSpace:true},disabledState.isDisabledToolTipText===undefined?runButton:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{position:"left",content:disabledState.isDisabledToolTipText},runButton))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),isForecastRequested===true&&external_kbnSharedDeps_React_default.a.createElement(ForecastProgress,{forecastProgress:forecastProgress,jobOpeningState:jobOpeningState,jobClosingState:jobClosingState}))}RunControls.propType={job:prop_types_default.a.object,newForecastDuration:prop_types_default.a.string,isNewForecastDurationValid:prop_types_default.a.bool,newForecastDurationErrors:prop_types_default.a.array,onNewForecastDurationChange:prop_types_default.a.func.isRequired,runForecast:prop_types_default.a.func.isRequired,isForecastRequested:prop_types_default.a.bool,forecastProgress:prop_types_default.a.number,jobOpeningState:prop_types_default.a.number,jobClosingState:prop_types_default.a.number};function modal_Modal(props){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModal"],{onClose:props.close,maxWidth:860,"data-test-subj":"mlModalForecast"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalHeaderTitle"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.timeSeriesExplorer.forecastingModal.forecastingTitle",defaultMessage:"Forecasting"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalBody"],null,props.messages.map((message,i)=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,{key:i},external_kbnSharedDeps_React_default.a.createElement(MessageCallOut,message),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}))),props.forecasts.length>0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(ForecastsList,{forecasts:props.forecasts,viewForecast:props.viewForecast}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null)),external_kbnSharedDeps_React_default.a.createElement(RunControls,props)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalFooter"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:props.close,size:"s","data-test-subj":"mlModalForecastButtonClose"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.timeSeriesExplorer.forecastingModal.closeButtonLabel",defaultMessage:"Close"}))))}modal_Modal.propType={job:prop_types_default.a.object,forecasts:prop_types_default.a.array,close:prop_types_default.a.func.isRequired,viewForecast:prop_types_default.a.func.isRequired,runForecast:prop_types_default.a.func.isRequired,newForecastDuration:prop_types_default.a.string,isNewForecastDurationValid:prop_types_default.a.bool,newForecastDurationErrors:prop_types_default.a.array,onNewForecastDurationChange:prop_types_default.a.func.isRequired,isForecastRequested:prop_types_default.a.bool,forecastProgress:prop_types_default.a.number,jobOpeningState:prop_types_default.a.number,jobClosingState:prop_types_default.a.number,messages:prop_types_default.a.array};var forecast_service=__webpack_require__(160);function forecasting_modal_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const FORECAST_DURATION_MAX_DAYS=3650;const FORECAST_JOB_MIN_VERSION="6.1.0";const FORECASTS_VIEW_MAX=5;const FORECAST_DURATION_MAX_MS=FORECAST_DURATION_MAX_DAYS*864e5;const WARN_NUM_PARTITIONS=100;const FORECAST_STATS_POLL_FREQUENCY=250;const WARN_NO_PROGRESS_MS=12e4;function forecasting_modal_getDefaultState(){return{isModalVisible:false,previousForecasts:[],isForecastRequested:false,forecastProgress:PROGRESS_STATES.UNSET,jobOpeningState:PROGRESS_STATES.UNSET,jobClosingState:PROGRESS_STATES.UNSET,newForecastDuration:"1d",isNewForecastDurationValid:true,newForecastDurationErrors:[],messages:[]}}class forecasting_modal_ForecastingModalUI extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);forecasting_modal_defineProperty(this,"addMessage",(message,status,clearFirst=false)=>{const msg={message:message,status:status};this.setState(prevState=>({messages:clearFirst?[msg]:[...prevState.messages,msg]}))});forecasting_modal_defineProperty(this,"viewForecast",forecastId=>{this.props.setForecastId(forecastId);this.closeModal()});forecasting_modal_defineProperty(this,"onNewForecastDurationChange",event=>{const newForecastDurationErrors=[];let isNewForecastDurationValid=true;const duration=Object(parse_interval["a"])(event.target.value);if(duration===null){isNewForecastDurationValid=false;newForecastDurationErrors.push(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.forecastingModal.invalidDurationFormatErrorMessage",{defaultMessage:"Invalid duration format"}))}else if(duration.asMilliseconds()>FORECAST_DURATION_MAX_MS){isNewForecastDurationValid=false;newForecastDurationErrors.push(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.forecastingModal.forecastDurationMustNotBeGreaterThanMaximumErrorMessage",{defaultMessage:"Forecast duration must not be greater than {maximumForecastDurationDays} days",values:{maximumForecastDurationDays:FORECAST_DURATION_MAX_DAYS}}))}else if(duration.asMilliseconds()===0){isNewForecastDurationValid=false;newForecastDurationErrors.push(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.forecastingModal.forecastDurationMustNotBeZeroErrorMessage",{defaultMessage:"Forecast duration must not be zero"}))}this.setState({newForecastDuration:event.target.value,isNewForecastDurationValid:isNewForecastDurationValid,newForecastDurationErrors:newForecastDurationErrors})});forecasting_modal_defineProperty(this,"checkJobStateAndRunForecast",()=>{this.setState({isForecastRequested:true,messages:[]});if(this.props.job.state===states["c"].CLOSED){this.openJobAndRunForecast()}else{this.runForecast(false)}});forecasting_modal_defineProperty(this,"openJobAndRunForecast",()=>{this.setState({jobOpeningState:PROGRESS_STATES.WAITING});job_service["a"].openJob(this.props.job.job_id).then(()=>{this.setState({jobOpeningState:PROGRESS_STATES.DONE});this.runForecast(true)}).catch(resp=>{console.log("Time series forecast modal - could not open job:",resp);this.addMessage(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.forecastingModal.errorWithOpeningJobBeforeRunningForecastErrorMessage",{defaultMessage:"Error opening job before running forecast"}),MESSAGE_LEVEL.ERROR);this.setState({jobOpeningState:PROGRESS_STATES.ERROR})})});forecasting_modal_defineProperty(this,"runForecastErrorHandler",(resp,closeJob)=>{this.setState({forecastProgress:PROGRESS_STATES.ERROR});console.log("Time series forecast modal - error running forecast:",resp);if(resp&&resp.message){this.addMessage(resp.message,MESSAGE_LEVEL.ERROR,true)}else{this.addMessage(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.forecastingModal.unexpectedResponseFromRunningForecastErrorMessage",{defaultMessage:"Unexpected response from running forecast. The request may have failed."}),MESSAGE_LEVEL.ERROR,true)}if(closeJob===true){this.setState({jobClosingState:PROGRESS_STATES.WAITING});job_service["a"].closeJob(this.props.job.job_id).then(()=>{this.setState({jobClosingState:PROGRESS_STATES.DONE})}).catch(response=>{console.log("Time series forecast modal - could not close job:",response);this.addMessage(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.forecastingModal.errorWithClosingJobErrorMessage",{defaultMessage:"Error closing job"}),MESSAGE_LEVEL.ERROR);this.setState({jobClosingState:PROGRESS_STATES.ERROR})})}});forecasting_modal_defineProperty(this,"runForecast",closeJobAfterRunning=>{this.setState({forecastProgress:0});const durationInSeconds=Object(parse_interval["a"])(this.state.newForecastDuration).asSeconds();forecast_service["a"].runForecast(this.props.job.job_id,`${durationInSeconds}s`).then(resp=>{if(resp.forecast_id!==undefined){this.waitForForecastResults(resp.forecast_id,closeJobAfterRunning)}else{this.runForecastErrorHandler(resp,closeJobAfterRunning)}}).catch(resp=>this.runForecastErrorHandler(resp,closeJobAfterRunning))});forecasting_modal_defineProperty(this,"waitForForecastResults",(forecastId,closeJobAfterRunning)=>{let previousProgress=0;let noProgressMs=0;this.forecastChecker=setInterval(()=>{forecast_service["a"].getForecastRequestStats(this.props.job,forecastId).then(resp=>{const progress=Object(external_kbnSharedDeps_Lodash_["get"])(resp,["stats","forecast_progress"],previousProgress);const status=Object(external_kbnSharedDeps_Lodash_["get"])(resp,["stats","forecast_status"]);if(progress>previousProgress){this.setState({forecastProgress:Math.round(100*progress)})}let messages=Object(external_kbnSharedDeps_Lodash_["get"])(resp,["stats","forecast_messages"],[]);messages=messages.map(message=>({message:message,status:MESSAGE_LEVEL.WARNING}));this.setState({messages:messages});if(status===states["b"].FINISHED){clearInterval(this.forecastChecker);if(closeJobAfterRunning===true){this.setState({jobClosingState:PROGRESS_STATES.WAITING});job_service["a"].closeJob(this.props.job.job_id).then(()=>{this.setState({jobClosingState:PROGRESS_STATES.DONE});this.props.setForecastId(forecastId);this.closeAfterRunningForecast()}).catch(response=>{console.log("Time series forecast modal - could not close job:",response);this.addMessage(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.forecastingModal.errorWithClosingJobAfterRunningForecastErrorMessage",{defaultMessage:"Error closing job after running forecast"}),MESSAGE_LEVEL.ERROR);this.setState({jobClosingState:PROGRESS_STATES.ERROR});this.props.setForecastId(forecastId)})}else{this.props.setForecastId(forecastId);this.closeAfterRunningForecast()}}else{if(progress===previousProgress){noProgressMs+=FORECAST_STATS_POLL_FREQUENCY;if(noProgressMs>WARN_NO_PROGRESS_MS){console.log(`Forecast request has not progressed for ${WARN_NO_PROGRESS_MS}ms. Cancelling check.`);this.addMessage(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.forecastingModal.noProgressReportedForNewForecastErrorMessage",{defaultMessage:"No progress reported for the new forecast for {WarnNoProgressMs}ms."+"An error may have occurred whilst running the forecast.",values:{WarnNoProgressMs:WARN_NO_PROGRESS_MS}}),MESSAGE_LEVEL.ERROR);this.props.setForecastId(forecastId);this.setState({forecastProgress:PROGRESS_STATES.ERROR});clearInterval(this.forecastChecker)}}else{if(progress>previousProgress){previousProgress=progress}noProgressMs=0}}}).catch(resp=>{console.log("Time series forecast modal - error loading stats of forecast from elasticsearch:",resp);this.addMessage(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.forecastingModal.errorWithLoadingStatsOfRunningForecastErrorMessage",{defaultMessage:"Error loading stats of running forecast."}),MESSAGE_LEVEL.ERROR);this.setState({forecastProgress:PROGRESS_STATES.ERROR});clearInterval(this.forecastChecker)})},FORECAST_STATS_POLL_FREQUENCY)});forecasting_modal_defineProperty(this,"openModal",()=>{const job=this.props.job;if(typeof job==="object"){const{timefilter:timefilter}=this.props.kibana.services.data.query.timefilter;const bounds=timefilter.getActiveBounds();const statusFinishedQuery={term:{forecast_status:states["b"].FINISHED}};forecast_service["a"].getForecastsSummary(job,statusFinishedQuery,bounds.min.valueOf(),FORECASTS_VIEW_MAX).then(resp=>{this.setState({previousForecasts:resp.forecasts})}).catch(resp=>{console.log("Time series forecast modal - error obtaining forecasts summary:",resp);this.addMessage(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.forecastingModal.errorWithObtainingListOfPreviousForecastsErrorMessage",{defaultMessage:"Error obtaining list of previous forecasts"}),MESSAGE_LEVEL.ERROR)});const entityFieldNames=this.props.entities.map(entity=>entity.fieldName);if(entityFieldNames.length>0){ml_api_service["ml"].getCardinalityOfFields({index:job.datafeed_config.indices,fieldNames:entityFieldNames,query:job.datafeed_config.query,timeFieldName:job.data_description.time_field,earliestMs:job.data_counts.earliest_record_timestamp,latestMs:job.data_counts.latest_record_timestamp}).then(results=>{let numPartitions=1;Object.values(results).forEach(cardinality=>{numPartitions=numPartitions*cardinality});if(numPartitions>WARN_NUM_PARTITIONS){this.addMessage(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.forecastingModal.dataContainsMorePartitionsMessage",{defaultMessage:"Note that this data contains more than {warnNumPartitions} "+"partitions so running a forecast may take a long time and consume a high amount of resource",values:{warnNumPartitions:WARN_NUM_PARTITIONS}}),MESSAGE_LEVEL.WARNING)}}).catch(resp=>{console.log("Time series forecast modal - error obtaining cardinality of fields:",resp)})}this.setState({isModalVisible:true})}});forecasting_modal_defineProperty(this,"closeAfterRunningForecast",()=>{if(this.state.messages.length===0){setTimeout(()=>{this.closeModal()},1e3)}});forecasting_modal_defineProperty(this,"closeModal",()=>{if(this.forecastChecker!==null){clearInterval(this.forecastChecker)}this.setState(forecasting_modal_getDefaultState())});this.state=forecasting_modal_getDefaultState();this.forecastChecker=null}render(){let isForecastingDisabled=false;let forecastingDisabledMessage=null;const{job:job}=this.props;if(job!==undefined){const detector=job.analysis_config.detectors[this.props.detectorIndex];const overFieldName=detector.over_field_name;if(overFieldName!==undefined){isForecastingDisabled=true;forecastingDisabledMessage=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.forecastingModal.forecastingNotAvailableForPopulationDetectorsMessage",{defaultMessage:"Forecasting is not available for population detectors with an over field"})}else if(Object(job_utils["j"])(job,FORECAST_JOB_MIN_VERSION)===false){isForecastingDisabled=true;forecastingDisabledMessage=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.forecastingModal.forecastingOnlyAvailableForJobsCreatedInSpecifiedVersionMessage",{defaultMessage:"Forecasting is only available for jobs created in version {minVersion} or later",values:{minVersion:FORECAST_JOB_MIN_VERSION}})}}const forecastButton=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:this.openModal,isDisabled:isForecastingDisabled,"data-test-subj":"mlSingleMetricViewerButtonForecast"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.timeSeriesExplorer.forecastingModal.forecastButtonLabel",defaultMessage:"Forecast"}));return external_kbnSharedDeps_React_default.a.createElement("div",null,isForecastingDisabled?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{position:"left",content:forecastingDisabledMessage},forecastButton):forecastButton,this.state.isModalVisible&&external_kbnSharedDeps_React_default.a.createElement(modal_Modal,{job:this.props.job,forecasts:this.state.previousForecasts,close:this.closeModal,viewForecast:this.viewForecast,runForecast:this.checkJobStateAndRunForecast,newForecastDuration:this.state.newForecastDuration,onNewForecastDurationChange:this.onNewForecastDurationChange,isNewForecastDurationValid:this.state.isNewForecastDurationValid,newForecastDurationErrors:this.state.newForecastDurationErrors,isForecastRequested:this.state.isForecastRequested,forecastProgress:this.state.forecastProgress,jobOpeningState:this.state.jobOpeningState,jobClosingState:this.state.jobClosingState,messages:this.state.messages}))}}const ForecastingModal=Object(kibanaReact_public_["withKibana"])(forecasting_modal_ForecastingModalUI);const loading_indicator_LoadingIndicator=({height:height,label:label})=>{height=height?+height:100;return external_kbnSharedDeps_React_default.a.createElement("div",{className:"ml-loading-indicator",style:{height:`${height}px`},"data-test-subj":"mlLoadingIndicator"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLoadingChart"],{size:"xl",mono:true}),label&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement("div",null,label)))};const OPTIONS=[{value:"auto",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.controls.selectInterval.autoLabel",{defaultMessage:"Auto"})},{value:"hour",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.controls.selectInterval.hourLabel",{defaultMessage:"1 hour"})},{value:"day",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.controls.selectInterval.dayLabel",{defaultMessage:"1 day"})},{value:"second",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.controls.selectInterval.showAllLabel",{defaultMessage:"Show all"})}];function optionValueToInterval(value){const option=OPTIONS.find(opt=>opt.value===value);let interval={display:OPTIONS[0].text,val:OPTIONS[0].value};if(option!==undefined){interval={display:option.text,val:option.value}}return interval}const TABLE_INTERVAL_DEFAULT=optionValueToInterval("auto");const useTableInterval=()=>Object(url_state["b"])("mlSelectInterval",TABLE_INTERVAL_DEFAULT);const SelectInterval=()=>{const[interval,setInterval]=useTableInterval();const onChange=e=>{setInterval(optionValueToInterval(e.target.value))};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{options:OPTIONS,className:"ml-select-interval",value:interval.val,onChange:onChange})};var select_severity=__webpack_require__(124);const TimeseriesexplorerNoChartData=({dataNotChartable:dataNotChartable,entities:entities})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiEmptyPrompt"],{iconType:"iInCircle",title:external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.noResultsFoundLabel",{defaultMessage:"No results found"})),body:dataNotChartable?external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.dataNotChartableDescription",{defaultMessage:`Model plot is not collected for the selected {entityCount, plural, one {entity} other {entities}}\nand the source data cannot be plotted for this detector.`,values:{entityCount:entities.length}})):external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.tryWideningTheTimeSelectionDescription",{defaultMessage:"Try widening the time selection or moving further back in time."}))});const AnomalyResultsViewSelector=({viewId:viewId})=>{const urlGenerator=Object(contexts_kibana["d"])();const navigateToPath=Object(contexts_kibana["e"])();const toggleButtonsIcons=Object(external_kbnSharedDeps_React_["useMemo"])(()=>[{id:"timeseriesexplorer",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomalyResultsViewSelector.singleMetricViewerLabel",{defaultMessage:"View results in the Single Metric Viewer"}),iconType:"visLine",value:ml_url_generator["b"].SINGLE_METRIC_VIEWER,"data-test-subj":"mlAnomalyResultsViewSelectorSingleMetricViewer"},{id:"explorer",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomalyResultsViewSelector.anomalyExplorerLabel",{defaultMessage:"View results in the Anomaly Explorer"}),iconType:"visTable",value:ml_url_generator["b"].ANOMALY_EXPLORER,"data-test-subj":"mlAnomalyResultsViewSelectorExplorer"}],[]);const[globalState]=Object(url_state["c"])("_g");const onChangeView=async newViewId=>{const url=await urlGenerator.createUrl({page:newViewId,pageState:{globalState:globalState}});await navigateToPath(url)};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonGroup"],{legend:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomalyResultsViewSelector.buttonGroupLegend",{defaultMessage:"Anomaly results view selector"}),name:"anomalyResultsViewSelector","data-test-subj":"mlAnomalyResultsViewSelector",options:toggleButtonsIcons,idSelected:viewId,onChange:newViewId=>onChangeView(newViewId),isIconOnly:true})};var job_selector=__webpack_require__(264);const TimeSeriesExplorerPage=({children:children,dateFormatTz:dateFormatTz,resizeRef:resizeRef})=>{const{services:{docLinks:docLinks}}=Object(contexts_kibana["b"])();const helpLink=docLinks.links.ml.anomalyDetection;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(navigation_menu["a"],{tabId:"anomaly_detection"}),external_kbnSharedDeps_React_default.a.createElement("div",{className:"ml-time-series-explorer",ref:resizeRef,"data-test-subj":"mlPageSingleMetricViewer"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPage"],{style:{background:"none"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageHeaderSection"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center",gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(AnomalyResultsViewSelector,{viewId:"timeseriesexplorer"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{className:"eui-textNoWrap"},external_kbnSharedDeps_React_default.a.createElement("h1",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.timeSeriesExplorer.pageTitle",defaultMessage:"Single Metric Viewer"})))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageHeaderSection"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center",gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(date_picker_wrapper["a"],null))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"none"}),external_kbnSharedDeps_React_default.a.createElement(job_selector["a"],{dateFormatTz:dateFormatTz,singleSelection:true,timeseriesOnly:true}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"none"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),children)),external_kbnSharedDeps_React_default.a.createElement(help_menu["a"],{docLink:helpLink})))};const APP_STATE_ACTION={CLEAR:"CLEAR",SET_DETECTOR_INDEX:"SET_DETECTOR_INDEX",SET_ENTITIES:"SET_ENTITIES",SET_FORECAST_ID:"SET_FORECAST_ID",SET_ZOOM:"SET_ZOOM",UNSET_ZOOM:"UNSET_ZOOM",SET_FUNCTION_DESCRIPTION:"SET_FUNCTION_DESCRIPTION"};const CHARTS_POINT_TARGET=500;const MAX_SCHEDULED_EVENTS=10;const timeseriesexplorer_constants_TIME_FIELD_NAME="timestamp";function buildConfigFromDetector(job,detectorIndex){const analysisConfig=job.analysis_config;const detector=analysisConfig.detectors[detectorIndex];const config={jobId:job.job_id,detectorIndex:detectorIndex,metricFunction:detector.function===aggregation_types["b"].LAT_LONG?aggregation_types["b"].LAT_LONG:Object(job_utils["q"])(detector.function),timeField:job.data_description.time_field,interval:job.analysis_config.bucket_span,datafeedConfig:job.datafeed_config,summaryCountFieldName:job.analysis_config.summary_count_field_name};if(detector.field_name!==undefined){config.metricFieldName=detector.field_name}const summaryCountFieldName=analysisConfig.summary_count_field_name;if(config.metricFunction===aggregation_types["a"].COUNT&&summaryCountFieldName!==undefined&&summaryCountFieldName!==field_types["a"]&&summaryCountFieldName!==field_types["e"]){let cardinalityField=undefined;const topAgg=Object(external_kbnSharedDeps_Lodash_["get"])(job.datafeed_config,"aggregations")||Object(external_kbnSharedDeps_Lodash_["get"])(job.datafeed_config,"aggs");if(topAgg!==undefined&&Object.values(topAgg).length>0){cardinalityField=Object(external_kbnSharedDeps_Lodash_["get"])(Object.values(topAgg)[0],["aggregations",summaryCountFieldName,aggregation_types["a"].CARDINALITY,"field"])||Object(external_kbnSharedDeps_Lodash_["get"])(Object.values(topAgg)[0],["aggs",summaryCountFieldName,aggregation_types["a"].CARDINALITY,"field"])}if((detector.function===aggregation_types["b"].NON_ZERO_COUNT||detector.function===aggregation_types["b"].LOW_NON_ZERO_COUNT||detector.function===aggregation_types["b"].HIGH_NON_ZERO_COUNT||detector.function===aggregation_types["b"].COUNT||detector.function===aggregation_types["b"].HIGH_COUNT||detector.function===aggregation_types["b"].LOW_COUNT)&&cardinalityField!==undefined){config.metricFunction=aggregation_types["a"].CARDINALITY;config.metricFieldName=undefined}else{config.metricFunction=aggregation_types["a"].SUM;config.metricFieldName=summaryCountFieldName}}return config}function timeseries_search_service_getMetricData(job,detectorIndex,entityFields,earliestMs,latestMs,intervalMs,esMetricFunction){if(Object(job_utils["l"])(job,detectorIndex)&&Object(job_utils["m"])(job,detectorIndex,entityFields)){const criteriaFields=[];const detector=job.analysis_config.detectors[detectorIndex];if(detector.partition_field_name!==undefined){const partitionEntity=Object(external_kbnSharedDeps_Lodash_["find"])(entityFields,{fieldName:detector.partition_field_name});if(partitionEntity!==undefined){criteriaFields.push({fieldName:"partition_field_name",fieldValue:partitionEntity.fieldName},{fieldName:"partition_field_value",fieldValue:partitionEntity.fieldValue})}}if(detector.over_field_name!==undefined){const overEntity=Object(external_kbnSharedDeps_Lodash_["find"])(entityFields,{fieldName:detector.over_field_name});if(overEntity!==undefined){criteriaFields.push({fieldName:"over_field_name",fieldValue:overEntity.fieldName},{fieldName:"over_field_value",fieldValue:overEntity.fieldValue})}}if(detector.by_field_name!==undefined){const byEntity=Object(external_kbnSharedDeps_Lodash_["find"])(entityFields,{fieldName:detector.by_field_name});if(byEntity!==undefined){criteriaFields.push({fieldName:"by_field_name",fieldValue:byEntity.fieldName},{fieldName:"by_field_value",fieldValue:byEntity.fieldValue})}}return results_service["mlResultsService"].getModelPlotOutput(job.job_id,detectorIndex,criteriaFields,earliestMs,latestMs,intervalMs)}else{const obj={success:true,results:{}};const chartConfig=buildConfigFromDetector(job,detectorIndex);return results_service["mlResultsService"].getMetricData(chartConfig.datafeedConfig.indices,entityFields,chartConfig.datafeedConfig.query,esMetricFunction!==null&&esMetricFunction!==void 0?esMetricFunction:chartConfig.metricFunction,chartConfig.metricFieldName,chartConfig.summaryCountFieldName,chartConfig.timeField,earliestMs,latestMs,intervalMs,chartConfig===null||chartConfig===void 0?void 0:chartConfig.datafeedConfig).pipe(Object(external_kbnSharedDeps_RxjsOperators_["map"])(resp=>{Object(external_kbnSharedDeps_Lodash_["each"])(resp.results,(value,time)=>{obj.results[time]={actual:value}});return obj}))}}function getChartDetails(job,detectorIndex,entityFields,earliestMs,latestMs){return new Promise((resolve,reject)=>{const obj={success:true,results:{functionLabel:"",entityData:{entities:[]}}};const chartConfig=buildConfigFromDetector(job,detectorIndex);let functionLabel=chartConfig.metricFunction;if(chartConfig.metricFieldName!==undefined){functionLabel+=" ";functionLabel+=chartConfig.metricFieldName}obj.results.functionLabel=functionLabel;const blankEntityFields=Object(external_kbnSharedDeps_Lodash_["filter"])(entityFields,entity=>entity.fieldValue===null);if(blankEntityFields.length===0){obj.results.entityData.count=1;obj.results.entityData.entities=entityFields;resolve(obj)}else{const entityFieldNames=blankEntityFields.map(f=>f.fieldName);ml_api_service["ml"].getCardinalityOfFields({index:chartConfig.datafeedConfig.indices,fieldNames:entityFieldNames,query:chartConfig.datafeedConfig.query,timeFieldName:chartConfig.timeField,earliestMs:earliestMs,latestMs:latestMs}).then(results=>{Object(external_kbnSharedDeps_Lodash_["each"])(blankEntityFields,field=>{obj.results.entityData.entities.push({fieldName:field.fieldName,cardinality:Object(external_kbnSharedDeps_Lodash_["get"])(results,field.fieldName,0)})});resolve(obj)}).catch(resp=>{reject(resp)})}})}const mlTimeSeriesSearchService={getMetricData:timeseries_search_service_getMetricData,getChartDetails:getChartDetails};function createTimeSeriesJobData(jobs){const singleTimeSeriesJobs=jobs.filter(job_utils["p"]);return singleTimeSeriesJobs.map(job=>{const bucketSpan=Object(parse_interval["a"])(job.analysis_config.bucket_span);return{id:job.job_id,selected:false,bucketSpanSeconds:bucketSpan.asSeconds()}})}function processMetricPlotResults(metricPlotData,modelPlotEnabled){const metricPlotChartData=[];if(modelPlotEnabled===true){Object(external_kbnSharedDeps_Lodash_["each"])(metricPlotData,(dataForTime,time)=>{metricPlotChartData.push({date:new Date(+time),lower:dataForTime.modelLower,value:dataForTime.actual,upper:dataForTime.modelUpper})})}else{Object(external_kbnSharedDeps_Lodash_["each"])(metricPlotData,(dataForTime,time)=>{metricPlotChartData.push({date:new Date(+time),value:dataForTime.actual})})}return metricPlotChartData}function processForecastResults(forecastData){const forecastPlotChartData=[];Object(external_kbnSharedDeps_Lodash_["each"])(forecastData,(dataForTime,time)=>{forecastPlotChartData.push({date:new Date(+time),isForecast:true,lower:dataForTime.forecastLower,value:dataForTime.prediction,upper:dataForTime.forecastUpper})});return forecastPlotChartData}function processRecordScoreResults(scoreData){const bucketScoreData=[];Object(external_kbnSharedDeps_Lodash_["each"])(scoreData,(dataForTime,time)=>{bucketScoreData.push({date:new Date(+time),score:dataForTime.score})});return bucketScoreData}function processDataForFocusAnomalies(chartData,anomalyRecords,aggregationInterval,modelPlotEnabled,functionDescription){const timesToAddPointsFor=[];const intervalMs=aggregationInterval.asMilliseconds();let lastChartDataPointTime=undefined;if(chartData!==undefined&&chartData.length>0){lastChartDataPointTime=chartData[chartData.length-1].date.getTime()}anomalyRecords.forEach(record=>{const recordTime=record[timeseriesexplorer_constants_TIME_FIELD_NAME];const chartPoint=findChartPointForAnomalyTime(chartData,recordTime,aggregationInterval);if(chartPoint===undefined){const timeToAdd=Math.floor(recordTime/intervalMs)*intervalMs;if(timesToAddPointsFor.indexOf(timeToAdd)===-1&&timeToAdd!==lastChartDataPointTime){timesToAddPointsFor.push(timeToAdd)}}});timesToAddPointsFor.sort((a,b)=>a-b);timesToAddPointsFor.forEach(time=>{const pointToAdd={date:new Date(time),value:null};if(modelPlotEnabled===true){pointToAdd.upper=null;pointToAdd.lower=null}chartData.push(pointToAdd)});anomalyRecords.forEach(record=>{const recordTime=record[timeseriesexplorer_constants_TIME_FIELD_NAME];if(record.function===aggregation_types["b"].METRIC&&record.function_description!==functionDescription)return;const chartPoint=findChartPointForAnomalyTime(chartData,recordTime,aggregationInterval);if(chartPoint!==undefined){const recordScore=record.record_score;const pointScore=chartPoint.anomalyScore;if(pointScore===undefined||pointScore<recordScore){chartPoint.anomalyScore=recordScore;chartPoint.function=record.function;if(record.actual!==undefined){if(chartPoint.value===null){chartPoint.value=record.actual}if(record.function===aggregation_types["b"].METRIC){chartPoint.value=Array.isArray(record.actual)?record.actual[0]:record.actual}chartPoint.actual=record.actual;chartPoint.typical=record.typical}else{const causes=Object(external_kbnSharedDeps_Lodash_["get"])(record,"causes",[]);if(causes.length>0){chartPoint.byFieldName=record.by_field_name;chartPoint.numberOfCauses=causes.length;if(causes.length===1){const cause=record.causes[0];chartPoint.actual=cause.actual;chartPoint.typical=cause.typical;if(chartPoint.value===null){chartPoint.value=cause.actual}}}}if(record.multi_bucket_impact!==undefined){chartPoint.multiBucketImpact=record.multi_bucket_impact}}}});return chartData}function processScheduledEventsForChart(chartData,scheduledEvents){if(scheduledEvents!==undefined){Object(external_kbnSharedDeps_Lodash_["each"])(scheduledEvents,(events,time)=>{const chartPoint=findNearestChartPointToTime(chartData,time);if(chartPoint!==undefined){chartPoint.scheduledEvents=events}})}return chartData}function findNearestChartPointToTime(chartData,time){let chartPoint;if(chartData===undefined){return chartPoint}for(let i=0;i<chartData.length;i++){if(chartData[i].date.getTime()===time){chartPoint=chartData[i];break}}if(chartPoint===undefined){let foundItem;for(let i=0;i<chartData.length;i++){const itemTime=chartData[i].date.getTime();if(itemTime>time){const item=chartData[i];const previousItem=chartData[i-1];const diff1=Math.abs(time-previousItem.date.getTime());const diff2=Math.abs(time-itemTime);if(previousItem===undefined||diff1>diff2){foundItem=item}else{foundItem=previousItem}break}}chartPoint=foundItem}return chartPoint}function findChartPointForAnomalyTime(chartData,anomalyTime,aggregationInterval){let chartPoint;if(chartData===undefined){return chartPoint}for(let i=0;i<chartData.length;i++){if(chartData[i].date.getTime()===anomalyTime){chartPoint=chartData[i];break}}if(chartPoint===undefined){let foundItem;const intervalMs=aggregationInterval.asMilliseconds();for(let i=0;i<chartData.length;i++){const itemTime=chartData[i].date.getTime();if(anomalyTime-itemTime<intervalMs){foundItem=chartData[i];break}}chartPoint=foundItem}return chartPoint}function calculateAggregationInterval(bounds,bucketsTarget,jobs,selectedJob){const barTarget=bucketsTarget!==undefined?bucketsTarget:100;const maxBars=Math.floor(1.1*barTarget);const buckets=Object(time_buckets["c"])();buckets.setInterval("auto");buckets.setBounds(bounds);buckets.setBarTarget(Math.floor(barTarget));buckets.setMaxBars(maxBars);const bucketSpanSeconds=Object(external_kbnSharedDeps_Lodash_["find"])(jobs,{id:selectedJob.job_id}).bucketSpanSeconds;let aggInterval=buckets.getIntervalToNearestMultiple(bucketSpanSeconds);const secs=aggInterval.asSeconds();if(secs<bucketSpanSeconds){buckets.setInterval(bucketSpanSeconds+"s");aggInterval=buckets.getInterval()}return aggInterval}function calculateDefaultFocusRange(autoZoomDuration,contextAggregationInterval,contextChartData,contextForecastData){const isForecastData=contextForecastData!==undefined&&contextForecastData.length>0;const combinedData=isForecastData===false?contextChartData:contextChartData.concat(contextForecastData);const earliestDataDate=combinedData[0].date;const latestDataDate=combinedData[combinedData.length-1].date;let rangeEarliestMs;let rangeLatestMs;if(isForecastData===true){const earliestForecastDataDate=contextForecastData[0].date;const latestForecastDataDate=contextForecastData[contextForecastData.length-1].date;rangeLatestMs=Math.min(earliestForecastDataDate.getTime()+autoZoomDuration/2,latestForecastDataDate.getTime());rangeEarliestMs=Math.max(rangeLatestMs-autoZoomDuration,earliestDataDate.getTime())}else{rangeLatestMs=latestDataDate.getTime()+contextAggregationInterval.asMilliseconds();rangeEarliestMs=Math.max(earliestDataDate.getTime(),rangeLatestMs-autoZoomDuration)}return[new Date(rangeEarliestMs),new Date(rangeLatestMs)]}function calculateInitialFocusRange(zoomState,contextAggregationInterval,bounds){if(zoomState!==undefined){const zoomFrom=external_kbnSharedDeps_MomentTimezone_default()(zoomState.from,"YYYY-MM-DDTHH:mm:ss.SSSZ",true);const zoomTo=external_kbnSharedDeps_MomentTimezone_default()(zoomState.to,"YYYY-MM-DDTHH:mm:ss.SSSZ",true);const searchBounds=Object(time_buckets["b"])(bounds,contextAggregationInterval,true);const earliest=searchBounds.min;const latest=searchBounds.max;if(zoomFrom.isValid()&&zoomTo.isValid&&zoomTo.isAfter(zoomFrom)&&zoomFrom.isBetween(earliest,latest,null,"[]")&&zoomTo.isBetween(earliest,latest,null,"[]")){return[zoomFrom.toDate(),zoomTo.toDate()]}}return undefined}function getAutoZoomDuration(jobs,selectedJob){const bucketSpanSeconds=Object(external_kbnSharedDeps_Lodash_["find"])(jobs,{id:selectedJob.job_id}).bucketSpanSeconds;let autoZoomDuration=bucketSpanSeconds*1e3*(CHARTS_POINT_TARGET-1);const maxBars=Math.floor(1.1*CHARTS_POINT_TARGET);const buckets=Object(time_buckets["c"])();buckets.setInterval("auto");buckets.setBarTarget(Math.floor(CHARTS_POINT_TARGET));buckets.setMaxBars(maxBars);const nowMs=(new Date).getTime();const max=external_kbnSharedDeps_MomentTimezone_default()(nowMs);const min=external_kbnSharedDeps_MomentTimezone_default()(nowMs-autoZoomDuration);buckets.setBounds({min:min,max:max});const calculatedInterval=buckets.getIntervalToNearestMultiple(bucketSpanSeconds);const calculatedIntervalSecs=calculatedInterval.asSeconds();if(calculatedIntervalSecs!==bucketSpanSeconds){autoZoomDuration=autoZoomDuration*(bucketSpanSeconds/calculatedIntervalSecs)}return autoZoomDuration}function getFocusData(criteriaFields,detectorIndex,focusAggregationInterval,forecastId,modelPlotEnabled,nonBlankEntities,searchBounds,selectedJob,functionDescription){const esFunctionToPlotIfMetric=functionDescription!==undefined?anomaly_utils["b"].toES(functionDescription):functionDescription;return Object(external_kbnSharedDeps_Rxjs_["forkJoin"])([mlTimeSeriesSearchService.getMetricData(selectedJob,detectorIndex,nonBlankEntities,searchBounds.min.valueOf(),searchBounds.max.valueOf(),focusAggregationInterval.asMilliseconds(),esFunctionToPlotIfMetric),results_service["mlResultsService"].getRecordsForCriteria([selectedJob.job_id],criteriaFields,0,searchBounds.min.valueOf(),searchBounds.max.valueOf(),constants_search["b"],functionDescription),results_service["mlResultsService"].getScheduledEventsByBucket([selectedJob.job_id],searchBounds.min.valueOf(),searchBounds.max.valueOf(),focusAggregationInterval.asMilliseconds(),1,MAX_SCHEDULED_EVENTS),ml_api_service["ml"].annotations.getAnnotations$({jobIds:[selectedJob.job_id],earliestMs:searchBounds.min.valueOf(),latestMs:searchBounds.max.valueOf(),maxAnnotations:constants_search["a"],fields:[{field:"event",missing:constants_annotations["b"]}],detectorIndex:detectorIndex,entities:nonBlankEntities}).pipe(Object(external_kbnSharedDeps_RxjsOperators_["catchError"])(resp=>Object(external_kbnSharedDeps_Rxjs_["of"])({annotations:{},aggregations:{},error:Object(util_errors["i"])(resp),success:false}))),forecastId!==undefined?(()=>{let aggType;const detector=selectedJob.analysis_config.detectors[detectorIndex];const esAgg=Object(job_utils["q"])(detector.function);if(!modelPlotEnabled&&(esAgg==="sum"||esAgg==="count")){aggType={avg:"sum",max:"sum",min:"sum"}}return forecast_service["a"].getForecastData(selectedJob,detectorIndex,forecastId,nonBlankEntities,searchBounds.min.valueOf(),searchBounds.max.valueOf(),focusAggregationInterval.asMilliseconds(),aggType)})():Object(external_kbnSharedDeps_Rxjs_["of"])(null)]).pipe(Object(external_kbnSharedDeps_RxjsOperators_["map"])(([metricData,recordsForCriteria,scheduledEventsByBucket,annotations,forecastData])=>{const anomalyRecords=recordsForCriteria.records.sort((a,b)=>a[timeseriesexplorer_constants_TIME_FIELD_NAME]-b[timeseriesexplorer_constants_TIME_FIELD_NAME]).reverse();const scheduledEvents=scheduledEventsByBucket.events[selectedJob.job_id];let focusChartData=processMetricPlotResults(metricData.results,modelPlotEnabled);focusChartData=processDataForFocusAnomalies(focusChartData,anomalyRecords,focusAggregationInterval,modelPlotEnabled,functionDescription);focusChartData=processScheduledEventsForChart(focusChartData,scheduledEvents);const refreshFocusData={scheduledEvents:scheduledEvents,anomalyRecords:anomalyRecords,focusChartData:focusChartData};if(annotations){if(annotations.error!==undefined){refreshFocusData.focusAnnotationError=annotations.error;refreshFocusData.focusAnnotationData=[];refreshFocusData.focusAggregations={}}else{var _annotations$annotati;refreshFocusData.focusAnnotationData=((_annotations$annotati=annotations.annotations[selectedJob.job_id])!==null&&_annotations$annotati!==void 0?_annotations$annotati:[]).sort((a,b)=>a.timestamp-b.timestamp).map((d,i)=>{d.key=(i+1).toString();return d});refreshFocusData.focusAggregations=annotations.aggregations}}if(forecastData){refreshFocusData.focusForecastData=processForecastResults(forecastData.results);refreshFocusData.showForecastCheckbox=refreshFocusData.focusForecastData.length>0}return refreshFocusData}))}var job_select_service_utils=__webpack_require__(250);function validateJobSelection(jobsWithTimeRange,selectedJobIds,setGlobalState,toastNotifications){const jobs=createTimeSeriesJobData(job_service["a"].jobs);const timeSeriesJobIds=jobs.map(j=>j.id);const invalidIds=Object(external_kbnSharedDeps_Lodash_["difference"])(selectedJobIds,timeSeriesJobIds);const validSelectedJobIds=Object(external_kbnSharedDeps_Lodash_["without"])(selectedJobIds,...invalidIds);if(invalidIds.length===1){const selectedJobId=invalidIds[0];const selectedJob=jobsWithTimeRange.find(j=>j.id===selectedJobId);if(selectedJob!==undefined&&selectedJob.isNotSingleMetricViewerJobMessage!==undefined){const warningText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.canNotViewRequestedJobsWarningWithReasonMessage",{defaultMessage:`You can't view {selectedJobId} in this dashboard because {reason}.`,values:{selectedJobId:selectedJobId,reason:selectedJob.isNotSingleMetricViewerJobMessage}});toastNotifications.addWarning({title:warningText,"data-test-subj":"mlTimeSeriesExplorerDisabledJobReasonWarningToast"})}}if(invalidIds.length>1){let warningText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.canNotViewRequestedJobsWarningMessage",{defaultMessage:`You can't view requested {invalidIdsCount, plural, one {job} other {jobs}} {invalidIds} in this dashboard`,values:{invalidIdsCount:invalidIds.length,invalidIds:invalidIds.join(", ")}});if(validSelectedJobIds.length===0&&timeSeriesJobIds.length>0){warningText+=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.autoSelectingFirstJobText",{defaultMessage:", auto selecting first job"})}toastNotifications.addWarning(warningText)}if(validSelectedJobIds.length>1){toastNotifications.addWarning(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.youCanViewOneJobAtTimeWarningMessage",{defaultMessage:"You can only view one job at a time in this dashboard"}));setGlobalState("ml",{jobIds:[validSelectedJobIds[0]]});return true}else if(invalidIds.length>0&&validSelectedJobIds.length>0){setGlobalState("ml",{jobIds:[validSelectedJobIds[0]]});return true}else if(validSelectedJobIds.length===1){return validSelectedJobIds[0]}else if(validSelectedJobIds.length===0&&jobs.length>0){const jobIds=[jobs[0].id];const time=Object(job_select_service_utils["b"])(jobsWithTimeRange,jobIds);setGlobalState({...{ml:{jobIds:jobIds}},...time!==undefined?{time:time}:{}});return true}else{return false}}function getControlsForDetector(selectedDetectorIndex,selectedEntities,selectedJobId){const selectedJob=job_service["a"].getJob(selectedJobId);const entities=[];if(selectedJob===undefined){return entities}const detectorIndex=selectedDetectorIndex;const detector=selectedJob.analysis_config.detectors[detectorIndex];const entitiesState=selectedEntities;const partitionFieldName=detector===null||detector===void 0?void 0:detector.partition_field_name;const overFieldName=detector===null||detector===void 0?void 0:detector.over_field_name;const byFieldName=detector===null||detector===void 0?void 0:detector.by_field_name;if(partitionFieldName!==undefined){var _entitiesState$partit;const partitionFieldValue=(_entitiesState$partit=entitiesState===null||entitiesState===void 0?void 0:entitiesState[partitionFieldName])!==null&&_entitiesState$partit!==void 0?_entitiesState$partit:null;entities.push({fieldType:"partition_field",fieldName:partitionFieldName,fieldValue:partitionFieldValue})}if(overFieldName!==undefined){var _entitiesState$overFi;const overFieldValue=(_entitiesState$overFi=entitiesState===null||entitiesState===void 0?void 0:entitiesState[overFieldName])!==null&&_entitiesState$overFi!==void 0?_entitiesState$overFi:null;entities.push({fieldType:"over_field",fieldName:overFieldName,fieldValue:overFieldValue})}if(byFieldName!==undefined&&overFieldName===undefined){var _entitiesState$byFiel;const byFieldValue=(_entitiesState$byFiel=entitiesState===null||entitiesState===void 0?void 0:entitiesState[byFieldName])!==null&&_entitiesState$byFiel!==void 0?_entitiesState$byFiel:null;entities.push({fieldType:"by_field",fieldName:byFieldName,fieldValue:byFieldValue})}return entities}const ML_ENTITY_FIELDS_CONFIG="ml.singleMetricViewer.partitionFields";function useStorage(key,initValue){var _storage$get;const{services:{storage:storage}}=Object(contexts_kibana["b"])();const[val,setVal]=Object(external_kbnSharedDeps_React_["useState"])((_storage$get=storage.get(key))!==null&&_storage$get!==void 0?_storage$get:initValue);const setStorage=Object(external_kbnSharedDeps_React_["useCallback"])(value=>{try{storage.set(key,value);setVal(value)}catch(e){throw new Error("Unable to update storage with provided value")}},[]);return[val,setStorage]}function getViewableDetectors(selectedJob){const jobDetectors=selectedJob.analysis_config.detectors;const viewableDetectors=[];jobDetectors.forEach((dtr,index)=>{if(Object(job_utils["o"])(selectedJob,index)){viewableDetectors.push({index:index,detector_description:dtr.detector_description,function:dtr.function})}});return viewableDetectors}const getCriteriaFields=(detectorIndex,entities)=>{const nonBlankEntities=entities.filter(entity=>entity.fieldValue!==null);return[{fieldName:"detector_index",fieldValue:detectorIndex},...nonBlankEntities]};function isMetricDetector(selectedJob,selectedDetectorIndex){const detectors=getViewableDetectors(selectedJob);if(Array.isArray(detectors)&&detectors.length>=selectedDetectorIndex){const detector=selectedJob.analysis_config.detectors[selectedDetectorIndex];if((detector===null||detector===void 0?void 0:detector.function)===aggregation_types["b"].METRIC){return true}}return false}const getFunctionDescription=async({selectedDetectorIndex:selectedDetectorIndex,selectedEntities:selectedEntities,selectedJobId:selectedJobId,selectedJob:selectedJob},toastNotificationService)=>{if(!isMetricDetector(selectedJob,selectedDetectorIndex))return;const entityControls=getControlsForDetector(selectedDetectorIndex,selectedEntities,selectedJobId);const criteriaFields=getCriteriaFields(selectedDetectorIndex,entityControls);try{const resp=await results_service["mlResultsService"].getRecordsForCriteria([selectedJob.job_id],criteriaFields,0,null,null,1).toPromise();if(Array.isArray(resp===null||resp===void 0?void 0:resp.records)&&resp.records.length===1){const highestScoringAnomaly=resp.records[0];return highestScoringAnomaly===null||highestScoringAnomaly===void 0?void 0:highestScoringAnomaly.function_description}return aggregation_types["a"].AVG}catch(error){toastNotificationService.displayErrorToast(error,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.highestAnomalyScoreErrorToastTitle",{defaultMessage:"An error occurred getting record with the highest anomaly score"}))}};const plotByFunctionOptions=[{value:"mean",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.plotByAvgOptionLabel",{defaultMessage:"mean"})},{value:"min",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.plotByMinOptionLabel",{defaultMessage:"min"})},{value:"max",text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.plotByMaxOptionLabel",{defaultMessage:"max"})}];const PlotByFunctionControls=({functionDescription:functionDescription,setFunctionDescription:setFunctionDescription,selectedDetectorIndex:selectedDetectorIndex,selectedJobId:selectedJobId,selectedEntities:selectedEntities,entityControlsCount:entityControlsCount})=>{const toastNotificationService=Object(toast_notification_service["c"])();const getFunctionDescriptionToPlot=Object(external_kbnSharedDeps_React_["useCallback"])(async(_selectedDetectorIndex,_selectedEntities,_selectedJobId,_selectedJob)=>{const functionToPlot=await getFunctionDescription({selectedDetectorIndex:_selectedDetectorIndex,selectedEntities:_selectedEntities,selectedJobId:_selectedJobId,selectedJob:_selectedJob},toastNotificationService);setFunctionDescription(functionToPlot)},[setFunctionDescription,toastNotificationService]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(functionDescription!==undefined){return}const selectedJob=job_service["a"].getJob(selectedJobId);const validEntities=entityControlsCount===0||entityControlsCount>0&&selectedEntities!==undefined;if(validEntities&&functionDescription===undefined&&isMetricDetector(selectedJob,selectedDetectorIndex)){const detector=selectedJob.analysis_config.detectors[selectedDetectorIndex];if((detector===null||detector===void 0?void 0:detector.function)===aggregation_types["b"].METRIC){getFunctionDescriptionToPlot(selectedDetectorIndex,selectedEntities,selectedJobId,selectedJob)}}},[setFunctionDescription,selectedDetectorIndex,selectedEntities,selectedJobId,functionDescription,entityControlsCount]);if(functionDescription===undefined)return null;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.metricPlotByOption",{defaultMessage:"Function"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{options:plotByFunctionOptions,value:functionDescription,onChange:e=>setFunctionDescription(e.target.value),"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.metricPlotByOptionLabel",{defaultMessage:"Pick function to plot by (min, max, or average) if metric function"})})))};function getEntityControlOptions(fieldValues){if(!Array.isArray(fieldValues)){return[]}return fieldValues.map(value=>({label:value.value===""?entity_control["a"]:value.value,value:value}))}const getDefaultFieldConfig=(fieldTypes,isAnomalousOnly,applyTimeRange)=>fieldTypes.reduce((acc,f)=>{acc[f]={applyTimeRange:applyTimeRange,anomalousOnly:isAnomalousOnly,sort:{by:"anomaly_score",order:"desc"}};return acc},{});const SeriesControls=({bounds:bounds,selectedDetectorIndex:selectedDetectorIndex,selectedJobId:selectedJobId,appStateHandler:appStateHandler,children:children,selectedEntities:selectedEntities,functionDescription:functionDescription,setFunctionDescription:setFunctionDescription})=>{var _selectedJob$model_pl;const{services:{mlServices:{mlApiServices:{results:mlResultsService}}}}=Object(contexts_kibana["b"])();const selectedJob=Object(external_kbnSharedDeps_React_["useMemo"])(()=>job_service["a"].getJob(selectedJobId),[selectedJobId]);const isModelPlotEnabled=!!((_selectedJob$model_pl=selectedJob.model_plot_config)!==null&&_selectedJob$model_pl!==void 0&&_selectedJob$model_pl.enabled);const[entitiesLoading,setEntitiesLoading]=Object(external_kbnSharedDeps_React_["useState"])(false);const[entityValues,setEntityValues]=Object(external_kbnSharedDeps_React_["useState"])({});const detectors=Object(external_kbnSharedDeps_React_["useMemo"])(()=>getViewableDetectors(selectedJob),[selectedJob]);const entityControls=Object(external_kbnSharedDeps_React_["useMemo"])(()=>getControlsForDetector(selectedDetectorIndex,selectedEntities,selectedJobId),[selectedDetectorIndex,selectedEntities,selectedJobId]);const[storageFieldsConfig,setStorageFieldsConfig]=useStorage(ML_ENTITY_FIELDS_CONFIG);const resultFieldsConfig=Object(external_kbnSharedDeps_React_["useMemo"])(()=>({...getDefaultFieldConfig(entityControls.map(v=>v.fieldType),!storageFieldsConfig?true:Object.values(storageFieldsConfig).some(v=>!!(v!==null&&v!==void 0&&v.anomalousOnly)),!storageFieldsConfig?true:Object.values(storageFieldsConfig).some(v=>!!(v!==null&&v!==void 0&&v.applyTimeRange))),...!storageFieldsConfig?{}:storageFieldsConfig}),[entityControls,storageFieldsConfig]);const loadEntityValues=async(searchTerm={})=>{setEntitiesLoading(true);const detectorIndex=selectedDetectorIndex;const fieldsConfig=resultFieldsConfig?Object.fromEntries(Object.entries(resultFieldsConfig).filter(([k])=>entityControls.some(v=>v.fieldType===k))):undefined;const{partition_field:partitionField,over_field:overField,by_field:byField}=await mlResultsService.fetchPartitionFieldsValues(selectedJob.job_id,searchTerm,[{fieldName:"detector_index",fieldValue:detectorIndex}],bounds.min.valueOf(),bounds.max.valueOf(),fieldsConfig).toPromise();const entityValuesUpdate={};entityControls.forEach(entity=>{let fieldValues;if((partitionField===null||partitionField===void 0?void 0:partitionField.name)===entity.fieldName){fieldValues=partitionField.values}if((overField===null||overField===void 0?void 0:overField.name)===entity.fieldName){fieldValues=overField.values}if((byField===null||byField===void 0?void 0:byField.name)===entity.fieldName){fieldValues=byField.values}entityValuesUpdate[entity.fieldName]=fieldValues});setEntitiesLoading(false);setEntityValues(entityValuesUpdate)};Object(external_kbnSharedDeps_React_["useEffect"])(()=>{loadEntityValues()},[selectedJobId,selectedDetectorIndex,JSON.stringify(selectedEntities),resultFieldsConfig]);const entityFieldSearchChanged=Object(external_kbnSharedDeps_Lodash_["debounce"])(async(entity,queryTerm)=>{await loadEntityValues({[entity.fieldType]:queryTerm})},500);const entityFieldValueChanged=(entity,fieldValue)=>{const resultEntities={...entityControls.reduce((appStateEntities,appStateEntity)=>{appStateEntities[appStateEntity.fieldName]=appStateEntity.fieldValue;return appStateEntities},{}),[entity.fieldName]:fieldValue};appStateHandler(APP_STATE_ACTION.SET_ENTITIES,resultEntities)};const detectorIndexChangeHandler=Object(external_kbnSharedDeps_React_["useCallback"])(e=>{const id=e.target.value;if(id!==undefined){appStateHandler(APP_STATE_ACTION.SET_DETECTOR_INDEX,+id)}},[appStateHandler]);const detectorSelectOptions=detectors.map(d=>({value:d.index,text:d.detector_description}));const onFieldConfigChange=Object(external_kbnSharedDeps_React_["useCallback"])((fieldType,config)=>{var _resultFieldsConfig$f,_resultFieldsConfig$f2;const updatedFieldConfig={...resultFieldsConfig[fieldType]?resultFieldsConfig[fieldType]:{},...config};const updatedResultConfig={...resultFieldsConfig};if(((_resultFieldsConfig$f=resultFieldsConfig[fieldType])===null||_resultFieldsConfig$f===void 0?void 0:_resultFieldsConfig$f.anomalousOnly)!==updatedFieldConfig.anomalousOnly){for(const c in updatedResultConfig){if(updatedResultConfig.hasOwnProperty(c)){updatedResultConfig[c].anomalousOnly=updatedFieldConfig.anomalousOnly}}}if(((_resultFieldsConfig$f2=resultFieldsConfig[fieldType])===null||_resultFieldsConfig$f2===void 0?void 0:_resultFieldsConfig$f2.applyTimeRange)!==updatedFieldConfig.applyTimeRange){for(const c in updatedResultConfig){if(updatedResultConfig.hasOwnProperty(c)){updatedResultConfig[c].applyTimeRange=updatedFieldConfig.applyTimeRange}}}setStorageFieldsConfig({...updatedResultConfig,[fieldType]:updatedFieldConfig})},[resultFieldsConfig,setStorageFieldsConfig]);let hasEmptyFieldValues=false;return external_kbnSharedDeps_React_default.a.createElement("div",{"data-test-subj":"mlSingleMetricViewerSeriesControls"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.timeSeriesExplorer.detectorLabel",defaultMessage:"Detector"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{onChange:detectorIndexChangeHandler,value:selectedDetectorIndex,options:detectorSelectOptions,"data-test-subj":"mlSingleMetricViewerDetectorSelect"}))),entityControls.map(entity=>{const entityKey=`${entity.fieldName}`;const forceSelection=!hasEmptyFieldValues&&entity.fieldValue===null;hasEmptyFieldValues=!hasEmptyFieldValues&&forceSelection;return external_kbnSharedDeps_React_default.a.createElement(entity_control["b"],{entity:entity,entityFieldValueChanged:entityFieldValueChanged,isLoading:entitiesLoading,onSearchChange:entityFieldSearchChanged,config:resultFieldsConfig[entity.fieldType],onConfigChange:onFieldConfigChange,forceSelection:forceSelection,key:entityKey,options:getEntityControlOptions(entityValues[entity.fieldName]),isModelPlotEnabled:isModelPlotEnabled})}),external_kbnSharedDeps_React_default.a.createElement(PlotByFunctionControls,{selectedJobId:selectedJobId,selectedDetectorIndex:selectedDetectorIndex,selectedEntities:selectedEntities,functionDescription:functionDescription,setFunctionDescription:setFunctionDescription,entityControlsCount:entityControls.length}),children))};var chart_tooltip_service=__webpack_require__(251);var chart_tooltip=__webpack_require__(252);var d3=__webpack_require__(100);var d3_default=__webpack_require__.n(d3);const chart_utils_LINE_CHART_ANOMALY_RADIUS=7;const MULTI_BUCKET_SYMBOL_SIZE=100;const SCHEDULED_EVENT_SYMBOL_HEIGHT=5;const ANNOTATION_SYMBOL_HEIGHT=10;const MAX_LABEL_WIDTH=100;function chart_utils_chartLimits(data=[]){const domain=d3_default.a.extent(data,d=>{let metricValue=d.value;if(metricValue===null&&d.anomalyScore!==undefined&&d.actual!==undefined){metricValue=Array.isArray(d.actual)?d.actual[0]:d.actual}return metricValue});const limits={max:domain[1],min:domain[0]};if(limits.max===limits.min){limits.max=d3_default.a.max(data,d=>{if(d.typical){return Math.max(d.value,d.typical)}else{return d.value}});limits.min=d3_default.a.min(data,d=>{if(d.typical){return Math.min(d.value,d.typical)}else{return d.value}})}if(limits.max===limits.min){const padding=limits.max*.05;limits.max+=padding;limits.min-=padding}return limits}function chartExtendedLimits(data=[],functionDescription){let _min=Infinity;let _max=-Infinity;data.forEach(d=>{let metricValue=d.value;const actualValue=Array.isArray(d.actual)?d.actual[0]:d.actual;const typicalValue=Array.isArray(d.typical)?d.typical[0]:d.typical;if(metricValue===null&&d.anomalyScore!==undefined&&d.actual!==undefined){metricValue=actualValue}if(d.anomalyScore!==undefined&&actualValue!==undefined){_min=Math.min(_min,metricValue,actualValue,typicalValue);_max=Math.max(_max,metricValue,actualValue,typicalValue)}else{_min=Math.min(_min,metricValue);_max=Math.max(_max,metricValue)}});const limits={max:_max,min:_min};if(limits.max===limits.min){const padding=limits.max*.05;limits.max+=padding;limits.min-=padding}if(functionDescription==="count"&&limits.min<0){limits.min=0}return limits}function drawLineChartDots(data,lineChartGroup,lineChartValuesLine,radius=1.5){const dotsData=data.reduce((p,c,i)=>{const previous=data[i-1];const next=data[i+1];if((typeof previous==="undefined"||previous&&previous.value===null)&&c.value!==null&&(typeof next==="undefined"||next&&next.value===null)){p.push(c)}return p},[]);const dotGroup=lineChartGroup.select(".values-dots").empty()?lineChartGroup.append("g").classed("values-dots",true):lineChartGroup.select(".values-dots");const dots=dotGroup.selectAll("circle").data(dotsData);dots.enter().append("circle").attr("r",radius);dots.attr("cx",lineChartValuesLine.x()).attr("cy",lineChartValuesLine.y());dots.exit().remove()}function filterAxisLabels(selection,chartWidth){if(selection===undefined||selection.selectAll===undefined){throw new Error("Missing selection parameter")}selection.selectAll(".tick text").text((function(){const parent=d3_default.a.select(this.parentNode);const labelWidth=parent.node().getBBox().width;const labelXPos=d3_default.a.transform(parent.attr("transform")).translate[0];const minThreshold=labelXPos-labelWidth/2;const maxThreshold=labelXPos+labelWidth/2;if(minThreshold>=0&&maxThreshold<=chartWidth){return this.textContent}else{parent.remove()}}))}const EVENT_DISTRIBUTION_ENABLED=true;const POPULATION_DISTRIBUTION_ENABLED=true;function getChartType(config){let chartType=explorer_constants["b"].SINGLE_METRIC;if(config.functionDescription==="lat_long"||config.mapData!==undefined){return explorer_constants["b"].GEO_MAP}if(EVENT_DISTRIBUTION_ENABLED&&config.functionDescription==="rare"&&config.entityFields.some(f=>f.fieldType==="over")===false){chartType=explorer_constants["b"].EVENT_DISTRIBUTION}else if(POPULATION_DISTRIBUTION_ENABLED&&config.functionDescription!=="rare"&&config.entityFields.some(f=>f.fieldType==="over")&&config.metricFunction!==null){chartType=explorer_constants["b"].POPULATION_DISTRIBUTION}if(chartType===explorer_constants["b"].EVENT_DISTRIBUTION||chartType===explorer_constants["b"].POPULATION_DISTRIBUTION){if(config.datafeedConfig!==undefined&&config.datafeedConfig.script_fields!==undefined){const scriptFields=Object.keys(config.datafeedConfig.script_fields);const checkFields=config.entityFields.map(entity=>entity.fieldName);if(config.metricFieldName){checkFields.push(config.metricFieldName)}const usesScriptFields=checkFields.find(fieldName=>scriptFields.includes(fieldName))!==undefined;if(usesScriptFields===true){chartType=explorer_constants["b"].SINGLE_METRIC}}}return chartType}async function getExploreSeriesLink(mlUrlGenerator,series){const timefilter=Object(dependency_cache["i"])();const bounds=timefilter.getActiveBounds();const from=bounds.min.toISOString();const to=bounds.max.toISOString();const zoomFrom=external_kbnSharedDeps_Moment_default()(series.plotEarliest).toISOString();const zoomTo=external_kbnSharedDeps_Moment_default()(series.plotLatest).toISOString();let entityCondition;if(series.entityFields.length>0){entityCondition={};series.entityFields.forEach(entity=>{entityCondition[entity.fieldName]=entity.fieldValue})}const url=await mlUrlGenerator.createUrl({page:ml_url_generator["b"].SINGLE_METRIC_VIEWER,pageState:{jobIds:[series.jobId],refreshInterval:{display:"Off",pause:true,value:0},timeRange:{from:from,to:to,mode:"absolute"},zoom:{from:zoomFrom,to:zoomTo},detectorIndex:series.detectorIndex,entities:entityCondition,query:{query_string:{analyze_wildcard:true,query:"*"}}},excludeBasePath:true});return url}function showMultiBucketAnomalyMarker(point){return point.multiBucketImpact!==undefined&&point.multiBucketImpact>=multi_bucket_impact["a"].MEDIUM}function showMultiBucketAnomalyTooltip(point){return point.multiBucketImpact!==undefined&&point.multiBucketImpact>=multi_bucket_impact["a"].LOW}function numTicks(axisWidth){return axisWidth/MAX_LABEL_WIDTH}function numTicksForDateFormat(axisWidth,dateFormat){const tickWidth=Object(string_utils["a"])(external_kbnSharedDeps_Moment_default()().format(dateFormat),false);return axisWidth/(1.75*tickWidth)}const TICK_DIRECTION={NEXT:"next",PREVIOUS:"previous"};function getTickValues(startTimeMs,tickInterval,earliest,latest){if(tickInterval<=0){throw Error("tickInterval must be larger than 0.")}const tickValues=[startTimeMs];function addTicks(ts,operator){let newTick;let addAnotherTick;switch(operator){case TICK_DIRECTION.PREVIOUS:newTick=ts-tickInterval;addAnotherTick=newTick>=earliest;break;case TICK_DIRECTION.NEXT:newTick=ts+tickInterval;addAnotherTick=newTick<=latest;break}if(addAnotherTick){tickValues.push(newTick);addTicks(newTick,operator)}}addTicks(startTimeMs,TICK_DIRECTION.PREVIOUS);addTicks(startTimeMs,TICK_DIRECTION.NEXT);tickValues.sort();return tickValues}const LABEL_WRAP_THRESHOLD=60;function isLabelLengthAboveThreshold({detectorLabel:detectorLabel,entityFields:entityFields}){const labelLength=detectorLabel.length+entityFields.map(d=>`${d.fieldName} ${d.fieldValue}`).join(" ").length;return labelLength>LABEL_WRAP_THRESHOLD}function getXTransform(t){const regexResult=/translate\(\s*([^\s,)]+)([ ,]([^\s,)]+))?\)/.exec(t);if(Array.isArray(regexResult)&&regexResult.length>=2){return Number(regexResult[1])}return NaN}function removeLabelOverlap(axis,startTimeMs,tickInterval,width){axis.selectAll("g.tick").select("line").classed("ml-tick-emphasis",true);function getNeighborTickFactory(operator){return function(ts){switch(operator){case TICK_DIRECTION.PREVIOUS:return ts-tickInterval;case TICK_DIRECTION.NEXT:return ts+tickInterval}}}function getTickDataFactory(operator){const getNeighborTick=getNeighborTickFactory(operator);const fn=function(ts){const filteredTicks=axis.selectAll(".tick").filter(d=>d===ts);if(filteredTicks.length===0||filteredTicks[0].length===0){return false}const tick=d3_default.a.selectAll(filteredTicks[0]);const textNode=tick.select("text").node();if(textNode===null){return fn(getNeighborTick(ts))}const tickWidth=textNode.getBBox().width;const padding=15;const xTransform=getXTransform(tick.attr("transform"));const xMinOffset=xTransform-(tickWidth/2+padding);const xMaxOffset=xTransform+(tickWidth/2+padding);return{tick:tick,ts:ts,xMinOffset:xMinOffset,xMaxOffset:xMaxOffset}};return fn}function checkTicks(ts,operator){const getTickData=getTickDataFactory(operator);const currentTickData=getTickData(ts);if(currentTickData===false){return}const getNeighborTick=getNeighborTickFactory(operator);const newTickData=getTickData(getNeighborTick(ts));if(newTickData!==false){if(newTickData.xMinOffset<0||newTickData.xMaxOffset>width||newTickData.xMaxOffset>currentTickData.xMinOffset&&operator===TICK_DIRECTION.PREVIOUS||newTickData.xMinOffset<currentTickData.xMaxOffset&&operator===TICK_DIRECTION.NEXT){newTickData.tick.select("text").remove();newTickData.tick.select("line").classed("ml-tick-emphasis",false);checkTicks(currentTickData.ts,operator)}else{checkTicks(newTickData.ts,operator)}}}checkTicks(startTimeMs,TICK_DIRECTION.PREVIOUS);checkTicks(startTimeMs,TICK_DIRECTION.NEXT)}function ContextChartMask(contextGroup,data,drawBounds,swimlaneHeight){this.contextGroup=contextGroup;this.data=data;this.drawBounds=drawBounds;this.swimlaneHeight=swimlaneHeight;this.mask=this.contextGroup.append("g").attr("class","mask");this.leftGroup=this.mask.append("g").attr("class","left-mask");this.rightGroup=this.mask.append("g").attr("class","right-mask");this.leftPolygon=this.leftGroup.append("polygon");this.rightPolygon=this.rightGroup.append("polygon");if(this.drawBounds===true){this.leftGroup.append("path").attr("class","left area bounds");this.rightGroup.append("path").attr("class","right area bounds")}this.leftGroup.append("path").attr("class","left values-line");this.rightGroup.append("path").attr("class","right values-line");this._x=null;this._y=null}ContextChartMask.prototype.style=function(prop,val){this.leftGroup.style(prop,val);this.rightGroup.style(prop,val);return this};ContextChartMask.prototype.x=function(f){if(f==null){return this._x}this._x=f;return this};ContextChartMask.prototype.y=function(f){if(f==null){return this._y}this._y=f;return this};ContextChartMask.prototype.redraw=function(){const yDomain=this._y.domain();const minY=yDomain[0];const maxY=yDomain[1];const xDomain=this._x.domain();const minX=xDomain[0];const maxX=xDomain[1];const that=this;const leftData=this.data.filter((function(d){return d.date<that.from}));const rightData=this.data.filter((function(d){return d.date>that.to}));if(this.drawBounds===true){const boundedArea=d3_default.a.svg.area().x((function(d){return that._x(d.date)||1})).y0((function(d){return that._y(Math.min(maxY,Math.max(d.lower,minY)))})).y1((function(d){return that._y(Math.max(minY,Math.min(d.upper,maxY)))})).defined(d=>d.lower!==null&&d.upper!==null);this.leftGroup.select(".left.area.bounds").attr("d",boundedArea(leftData));this.rightGroup.select(".right.area.bounds").attr("d",boundedArea(rightData))}const valuesLine=d3_default.a.svg.line().x((function(d){return that._x(d.date)})).y((function(d){return that._y(d.value)})).defined(d=>d.value!==null);this.leftGroup.select(".left.values-line").attr("d",valuesLine(leftData));drawLineChartDots(leftData,this.leftGroup,valuesLine,1);this.rightGroup.select(".right.values-line").attr("d",valuesLine(rightData));drawLineChartDots(rightData,this.rightGroup,valuesLine,1);const leftPoly={l:this._x(minX),t:this._y(minY)+this.swimlaneHeight,r:this._x(this.from),b:0};const rightPoly={l:this._x(this.to),t:this._y(minY)+this.swimlaneHeight,r:this._x(maxX),b:0};this.leftPolygon.attr("points",""+leftPoly.l+","+leftPoly.t+"  "+leftPoly.r+","+leftPoly.t+"  "+leftPoly.r+","+leftPoly.b+"  "+leftPoly.l+","+leftPoly.b);this.rightPolygon.attr("points",""+rightPoly.l+","+rightPoly.t+"  "+rightPoly.r+","+rightPoly.t+"  "+rightPoly.r+","+rightPoly.b+"  "+rightPoly.l+","+rightPoly.b);return this};ContextChartMask.prototype.reveal=function(extent){this.from=extent[0];this.to=extent[1];this.redraw();return this};const ANNOTATION_MASK_ID="mlAnnotationMask";function getAnnotationBrush(){const{annotationUpdatesService:annotationUpdatesService}=this.props;const focusXScale=this.focusXScale;const annotateBrush=d3_default.a.svg.brush().x(focusXScale).on("brushend",brushend.bind(this));function brushend(){const{selectedJob:selectedJob}=this.props;const extent=annotateBrush.extent();const timestamp=extent[0].getTime();const endTimestamp=extent[1].getTime();if(timestamp===endTimestamp){annotationUpdatesService.setValue(null);return}const annotation={timestamp:timestamp,end_timestamp:endTimestamp,annotation:"",job_id:selectedJob.job_id,type:constants_annotations["d"].ANNOTATION};annotationUpdatesService.setValue(annotation)}return annotateBrush}function getAnnotationLevels(focusAnnotationData){const levels={};focusAnnotationData.forEach((d,i)=>{if(d.key!==undefined){const longerAnnotations=focusAnnotationData.filter((d2,i2)=>i2<i);levels[d.key]=longerAnnotations.reduce((level,d2)=>{if(d.end_timestamp===undefined||d2.end_timestamp===undefined||d2.key===undefined){return level}if(d2.timestamp<d.timestamp&&d2.end_timestamp<d.timestamp||d2.timestamp>d.end_timestamp&&d2.end_timestamp>d.end_timestamp){return level}return levels[d2.key]+1},0)}});return levels}const ANNOTATION_DEFAULT_LEVEL=1;const ANNOTATION_LEVEL_HEIGHT=28;const ANNOTATION_UPPER_RECT_MARGIN=0;const ANNOTATION_UPPER_TEXT_MARGIN=-7;const ANNOTATION_MIN_WIDTH=2;const ANNOTATION_RECT_BORDER_RADIUS=2;const ANNOTATION_TEXT_VERTICAL_OFFSET=26;const ANNOTATION_TEXT_RECT_VERTICAL_OFFSET=12;const ANNOTATION_TEXT_RECT_WIDTH=24;const ANNOTATION_TEXT_RECT_HEIGHT=20;function renderAnnotations(focusChart,focusAnnotationData,focusZoomPanelHeight,focusChartHeight,focusXScale,showAnnotations,showFocusChartTooltip,hideFocusChartTooltip,annotationUpdatesService){const upperRectMargin=ANNOTATION_UPPER_RECT_MARGIN;const upperTextMargin=ANNOTATION_UPPER_TEXT_MARGIN;const durations={};focusAnnotationData.forEach(d=>{if(d.key!==undefined){const duration=(d.end_timestamp||0)-d.timestamp;durations[d.key]=duration}});focusAnnotationData.sort((a,b)=>{if(a.key===undefined||b.key===undefined){return 0}return durations[b.key]-durations[a.key]});const levelHeight=ANNOTATION_LEVEL_HEIGHT;const levels=getAnnotationLevels(focusAnnotationData);const annotations=focusChart.select(".mlAnnotations").selectAll("g.mlAnnotation").data(focusAnnotationData||[],d=>d._id||"");annotations.enter().append("g").classed("mlAnnotation",true);const rects=annotations.selectAll(".mlAnnotationRect").data(d=>[d]);rects.enter().append("rect").attr("rx",ANNOTATION_RECT_BORDER_RADIUS).attr("ry",ANNOTATION_RECT_BORDER_RADIUS).classed("mlAnnotationRect",true).attr("mask",`url(#${ANNOTATION_MASK_ID})`).on("mouseover",(function(d){showFocusChartTooltip(d,this)})).on("mouseout",()=>hideFocusChartTooltip()).on("click",d=>{annotationUpdatesService.setValue(null);annotationUpdatesService.setValue(d)});rects.attr("x",d=>{const date=external_kbnSharedDeps_Moment_default()(d.timestamp);return focusXScale(date)}).attr("y",d=>{const level=d.key!==undefined?levels[d.key]:ANNOTATION_DEFAULT_LEVEL;return focusZoomPanelHeight+1+upperRectMargin+level*levelHeight}).attr("height",d=>{const level=d.key!==undefined?levels[d.key]:ANNOTATION_DEFAULT_LEVEL;return focusChartHeight-2-upperRectMargin-level*levelHeight}).attr("width",d=>{const s=focusXScale(external_kbnSharedDeps_Moment_default()(d.timestamp))+1;const e=typeof d.end_timestamp!=="undefined"?focusXScale(external_kbnSharedDeps_Moment_default()(d.end_timestamp))-1:s+ANNOTATION_MIN_WIDTH;const width=Math.max(ANNOTATION_MIN_WIDTH,e-s);return width});rects.exit().remove();const textRects=annotations.selectAll(".mlAnnotationTextRect").data(d=>[d]);const texts=annotations.selectAll(".mlAnnotationText").data(d=>[d]);textRects.enter().append("rect").classed("mlAnnotationTextRect",true).attr("width",ANNOTATION_TEXT_RECT_WIDTH).attr("height",ANNOTATION_TEXT_RECT_HEIGHT).attr("rx",ANNOTATION_RECT_BORDER_RADIUS).attr("ry",ANNOTATION_RECT_BORDER_RADIUS);texts.enter().append("text").classed("mlAnnotationText",true);function labelXOffset(ts){const earliestMs=focusXScale.domain()[0];const latestMs=focusXScale.domain()[1];const date=external_kbnSharedDeps_Moment_default()(ts);const minX=Math.max(focusXScale(earliestMs),focusXScale(date));const maxOffset=32;return Math.min(focusXScale(latestMs)-maxOffset,minX)}texts.attr("x",d=>{const leftInnerOffset=17;return labelXOffset(d.timestamp)+leftInnerOffset}).attr("y",d=>{const level=d.key!==undefined?levels[d.key]:ANNOTATION_DEFAULT_LEVEL;return focusZoomPanelHeight+upperTextMargin+ANNOTATION_TEXT_VERTICAL_OFFSET+level*levelHeight}).text(d=>d.key);textRects.attr("x",d=>{const leftInnerOffset=5;return labelXOffset(d.timestamp)+leftInnerOffset}).attr("y",d=>{const level=d.key!==undefined?levels[d.key]:ANNOTATION_DEFAULT_LEVEL;return focusZoomPanelHeight+upperTextMargin+ANNOTATION_TEXT_RECT_VERTICAL_OFFSET+level*levelHeight});textRects.exit().remove();texts.exit().remove();annotations.classed("mlAnnotationHidden",!showAnnotations);annotations.exit().remove()}function getAnnotationWidth(annotation,focusXScale){const start=focusXScale(annotation.timestamp)+1;const end=typeof annotation.end_timestamp!=="undefined"?focusXScale(annotation.end_timestamp)-1:start+ANNOTATION_MIN_WIDTH;const width=Math.max(ANNOTATION_MIN_WIDTH,end-start);return width}function highlightFocusChartAnnotation(annotation){const annotations=d3_default.a.selectAll(".mlAnnotation");annotations.each((function(d){const element=d3_default.a.select(this);if(d._id===annotation._id){element.selectAll(".mlAnnotationRect").classed("mlAnnotationRect-isHighlight",true)}else{element.selectAll(".mlAnnotationTextRect").classed("mlAnnotationTextRect-isBlur",true);element.selectAll(".mlAnnotationText").classed("mlAnnotationText-isBlur",true);element.selectAll(".mlAnnotationRect").classed("mlAnnotationRect-isBlur",true)}}))}function unhighlightFocusChartAnnotation(){const annotations=d3_default.a.selectAll(".mlAnnotation");annotations.each((function(){const element=d3_default.a.select(this);element.selectAll(".mlAnnotationTextRect").classed("mlAnnotationTextRect-isBlur",false);element.selectAll(".mlAnnotationRect").classed("mlAnnotationRect-isHighlight",false).classed("mlAnnotationRect-isBlur",false);element.selectAll(".mlAnnotationText").classed("mlAnnotationText-isBlur",false)}))}function timeseries_chart_extends(){timeseries_chart_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return timeseries_chart_extends.apply(this,arguments)}function timeseries_chart_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const timeseries_chart_focusZoomPanelHeight=25;const timeseries_chart_focusChartHeight=310;const focusHeight=timeseries_chart_focusZoomPanelHeight+timeseries_chart_focusChartHeight;const contextChartHeight=60;const contextChartLineTopMargin=3;const chartSpacing=25;const swimlaneHeight=30;const ctxAnnotationMargin=2;const annotationHeight=ANNOTATION_SYMBOL_HEIGHT+ctxAnnotationMargin*2;const timeseries_chart_margin={top:10,right:10,bottom:15,left:40};const ZOOM_INTERVAL_OPTIONS=[{duration:external_kbnSharedDeps_Moment_default.a.duration(1,"h"),label:"1h"},{duration:external_kbnSharedDeps_Moment_default.a.duration(12,"h"),label:"12h"},{duration:external_kbnSharedDeps_Moment_default.a.duration(1,"d"),label:"1d"},{duration:external_kbnSharedDeps_Moment_default.a.duration(1,"w"),label:"1w"},{duration:external_kbnSharedDeps_Moment_default.a.duration(2,"w"),label:"2w"},{duration:external_kbnSharedDeps_Moment_default.a.duration(1,"M"),label:"1M"}];const anomalyColorScale=d3_default.a.scale.threshold().domain([3,25,50,75,100]).range(["#d2e9f7","#8bc8fb","#ffdd00","#ff7e00","#fe5050"]);const anomalyGrayScale=d3_default.a.scale.threshold().domain([3,25,50,75,100]).range(["#dce7ed","#b0c5d6","#b1a34e","#b17f4e","#c88686"]);function getSvgHeight(showAnnotations){const adjustedAnnotationHeight=showAnnotations?annotationHeight:0;return focusHeight+contextChartHeight+swimlaneHeight+adjustedAnnotationHeight+chartSpacing+timeseries_chart_margin.top+timeseries_chart_margin.bottom}class timeseries_chart_TimeseriesChartIntl extends external_kbnSharedDeps_React_["Component"]{constructor(...args){super(...args);timeseries_chart_defineProperty(this,"rowMouseenterSubscriber",null);timeseries_chart_defineProperty(this,"rowMouseleaveSubscriber",null);timeseries_chart_defineProperty(this,"contextChartInitialized",false);timeseries_chart_defineProperty(this,"drawContextBrush",contextGroup=>{const{contextChartSelected:contextChartSelected}=this.props;const brush=this.brush;const contextXScale=this.contextXScale;const mask=this.mask;brush.x(contextXScale).on("brush",brushing).on("brushend",brushed);contextGroup.append("g").attr("class","x brush").call(brush).selectAll("rect").attr("y",-1).attr("height",contextChartHeight+swimlaneHeight+1);contextGroup.selectAll(".w rect").attr("x",-10).attr("width",10);contextGroup.selectAll(".e rect").attr("x",0).attr("width",10);const handleBrushExtent=brush.extent();const topBorder=contextGroup.append("rect").attr("class","top-border").attr("y",-2).attr("height",contextChartLineTopMargin);const leftHandle=contextGroup.append("foreignObject").attr("width",10).attr("height",90).attr("class","brush-handle").attr("x",contextXScale(handleBrushExtent[0])-10).html(`\n        <div class="brush-handle-inner brush-handle-inner-left" style="padding-top: 27px">\n          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="6" height="9">\n            <polygon points="5,0 5,8 0,4" />\n          </svg>\n        </div>`);const rightHandle=contextGroup.append("foreignObject").attr("width",10).attr("height",90).attr("class","brush-handle").attr("x",contextXScale(handleBrushExtent[1])+0).html(`\n        <div class="brush-handle-inner brush-handle-inner-right" style="padding-top: 27px">\n          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="6" height="9">\n            <polygon points="0,0 0,8 5,4" />\n          </svg>\n        </div>`);function brushing(){const brushExtent=brush.extent();mask.reveal(brushExtent);leftHandle.attr("x",contextXScale(brushExtent[0])-10);rightHandle.attr("x",contextXScale(brushExtent[1])+0);topBorder.attr("x",contextXScale(brushExtent[0])+1);const topBorderWidth=Math.max(0,contextXScale(brushExtent[1])-contextXScale(brushExtent[0])-2);topBorder.attr("width",topBorderWidth);const isEmpty=brush.empty();d3_default.a.selectAll(".brush-handle").style("visibility",isEmpty?"hidden":"visible")}brushing();const that=this;function brushed(){const isEmpty=brush.empty();const selectedBounds=isEmpty?contextXScale.domain():brush.extent();const selectionMin=selectedBounds[0].getTime();const selectionMax=selectedBounds[1].getTime();if(that.selectedBounds!==undefined&&that.selectedBounds.min.valueOf()===selectionMin&&that.selectedBounds.max.valueOf()===selectionMax){return}contextGroup.selectAll(".swimlane-cell").style("fill",d=>{const cellMs=d.date.getTime();if(cellMs<selectionMin||cellMs>selectionMax){return anomalyGrayScale(d.score)}else{return anomalyColorScale(d.score)}});that.selectedBounds={min:external_kbnSharedDeps_Moment_default()(selectionMin),max:external_kbnSharedDeps_Moment_default()(selectionMax)};contextChartSelected({from:selectedBounds[0],to:selectedBounds[1]})}});timeseries_chart_defineProperty(this,"drawSwimlane",(swlGroup,swlWidth,swlHeight)=>{const{contextAggregationInterval:contextAggregationInterval,swimlaneData:swimlaneData}=this.props;const data=swimlaneData;if(typeof data==="undefined"){return}const xAxisDomain=this.calculateContextXAxisDomain();const x=d3_default.a.time.scale().range([0,swlWidth]).domain(xAxisDomain);const y=d3_default.a.scale.linear().range([swlHeight,0]).domain([0,swlHeight]);const xAxis=d3_default.a.svg.axis().scale(x).orient("bottom").innerTickSize(-swlHeight).outerTickSize(0);const yAxis=d3_default.a.svg.axis().scale(y).orient("left").tickValues(y.domain()).innerTickSize(-swlWidth).outerTickSize(0);const axes=swlGroup.append("g");axes.append("g").attr("class","x axis").attr("transform","translate(0,"+swlHeight+")").call(xAxis);axes.append("g").attr("class","y axis").call(yAxis);const earliest=xAxisDomain[0].getTime();const latest=xAxisDomain[1].getTime();const swimlaneAggMs=contextAggregationInterval.asMilliseconds();let cellWidth=swlWidth/((latest-earliest)/swimlaneAggMs);if(cellWidth<1){cellWidth=1}const cells=swlGroup.append("g").attr("class","swimlane-cells").selectAll("rect").data(data);cells.enter().append("rect").attr("x",d=>x(d.date)).attr("y",0).attr("rx",0).attr("ry",0).attr("class",d=>d.score>0?"swimlane-cell":"swimlane-cell-hidden").attr("width",cellWidth).attr("height",swlHeight).style("fill",d=>anomalyColorScale(d.score))});timeseries_chart_defineProperty(this,"calculateContextXAxisDomain",()=>{const{bounds:bounds,contextAggregationInterval:contextAggregationInterval,swimlaneData:swimlaneData}=this.props;let earliest=bounds.min.valueOf();if(swimlaneData!==undefined&&swimlaneData.length>0){earliest=Math.min(swimlaneData[0].date.getTime(),bounds.min.valueOf())}const contextAggMs=contextAggregationInterval.asMilliseconds();const earliestMs=Math.floor(earliest/contextAggMs)*contextAggMs;const latestMs=Math.ceil(bounds.max.valueOf()/contextAggMs)*contextAggMs;return[new Date(earliestMs),new Date(latestMs)]});timeseries_chart_defineProperty(this,"setContextBrushExtent",(from,to)=>{const brush=this.brush;const brushExtent=brush.extent();const newExtent=[from,to];brush.extent(newExtent);brush(d3_default.a.select(".brush"));if(newExtent[0].getTime()!==brushExtent[0].getTime()||newExtent[1].getTime()!==brushExtent[1].getTime()){brush.event(d3_default.a.select(".brush"))}})}componentWillUnmount(){const element=d3_default.a.select(this.rootNode);element.html("");if(this.rowMouseenterSubscriber!==null){this.rowMouseenterSubscriber.unsubscribe()}if(this.rowMouseleaveSubscriber!==null){this.rowMouseleaveSubscriber.unsubscribe()}}componentDidMount(){const{svgWidth:svgWidth}=this.props;this.vizWidth=svgWidth-timeseries_chart_margin.left-timeseries_chart_margin.right;const vizWidth=this.vizWidth;this.focusXScale=d3_default.a.time.scale().range([0,vizWidth]);this.focusYScale=d3_default.a.scale.linear().range([focusHeight,timeseries_chart_focusZoomPanelHeight]);const focusXScale=this.focusXScale;const focusYScale=this.focusYScale;this.focusXAxis=d3_default.a.svg.axis().scale(focusXScale).orient("bottom").innerTickSize(-timeseries_chart_focusChartHeight).outerTickSize(0).tickPadding(10);this.focusYAxis=d3_default.a.svg.axis().scale(focusYScale).orient("left").innerTickSize(-vizWidth).outerTickSize(0).tickPadding(10);this.focusValuesLine=d3_default.a.svg.line().x((function(d){return focusXScale(d.date)})).y((function(d){return focusYScale(d.value)})).defined(d=>d.value!==null);this.focusBoundedArea=d3_default.a.svg.area().x((function(d){return focusXScale(d.date)||1})).y0((function(d){return focusYScale(d.upper)})).y1((function(d){return focusYScale(d.lower)})).defined(d=>d.lower!==null&&d.upper!==null);this.contextXScale=d3_default.a.time.scale().range([0,vizWidth]);this.contextYScale=d3_default.a.scale.linear().range([contextChartHeight,contextChartLineTopMargin]);this.fieldFormat=undefined;this.annotateBrush=getAnnotationBrush.call(this);this.brush=d3_default.a.svg.brush();this.mask=undefined;const highlightFocusChartAnomaly=this.highlightFocusChartAnomaly.bind(this);const boundHighlightFocusChartAnnotation=highlightFocusChartAnnotation.bind(this);function tableRecordMousenterListener({record:record,type:type="anomaly"}){if(type==="anomaly"){highlightFocusChartAnomaly(record)}else if(type==="annotation"){boundHighlightFocusChartAnnotation(record)}}const unhighlightFocusChartAnomaly=this.unhighlightFocusChartAnomaly.bind(this);const boundUnhighlightFocusChartAnnotation=unhighlightFocusChartAnnotation.bind(this);function tableRecordMouseleaveListener({record:record,type:type="anomaly"}){if(type==="anomaly"){unhighlightFocusChartAnomaly(record)}else{boundUnhighlightFocusChartAnnotation(record)}}this.rowMouseenterSubscriber=table_service["a"].rowMouseenter$.subscribe(tableRecordMousenterListener);this.rowMouseleaveSubscriber=table_service["a"].rowMouseleave$.subscribe(tableRecordMouseleaveListener);this.renderChart();this.drawContextChartSelection();this.renderFocusChart()}componentDidUpdate(prevProps){if(this.props.renderFocusChartOnly===false||prevProps.svgWidth!==this.props.svgWidth||prevProps.showAnnotations!==this.props.showAnnotations||prevProps.annotationData!==this.props.annotationData){this.renderChart();this.drawContextChartSelection()}this.renderFocusChart();if(this.props.annotation===null){const chartElement=d3_default.a.select(this.rootNode);chartElement.select("g.mlAnnotationBrush").call(this.annotateBrush.extent([0,0]))}}renderChart(){const{contextChartData:contextChartData,contextForecastData:contextForecastData,detectorIndex:detectorIndex,modelPlotEnabled:modelPlotEnabled,selectedJob:selectedJob,svgWidth:svgWidth,showAnnotations:showAnnotations}=this.props;const createFocusChart=this.createFocusChart.bind(this);const drawContextElements=this.drawContextElements.bind(this);const focusXScale=this.focusXScale;const focusYAxis=this.focusYAxis;const focusYScale=this.focusYScale;const svgHeight=getSvgHeight(showAnnotations);const chartElement=d3_default.a.select(this.rootNode);chartElement.selectAll("*").remove();if(typeof selectedJob!=="undefined"){this.fieldFormat=field_format_service["a"].getFieldFormat(selectedJob.job_id,detectorIndex)}else{return}if(contextChartData===undefined){return}const fieldFormat=this.fieldFormat;const svg=chartElement.append("svg").attr("width",svgWidth).attr("height",svgHeight);let contextDataMin;let contextDataMax;if(modelPlotEnabled===true||contextForecastData!==undefined&&contextForecastData.length>0){const combinedData=contextForecastData===undefined?contextChartData:contextChartData.concat(contextForecastData);contextDataMin=d3_default.a.min(combinedData,d=>Math.min(d.value,d.lower));contextDataMax=d3_default.a.max(combinedData,d=>Math.max(d.value,d.upper))}else{contextDataMin=d3_default.a.min(contextChartData,d=>d.value);contextDataMax=d3_default.a.max(contextChartData,d=>d.value)}const ceiledMax=contextDataMax>0?Math.pow(10,Math.ceil(Math.log10(Math.abs(contextDataMax)))):contextDataMax;const flooredMin=contextDataMin>=0?contextDataMin:-1*Math.pow(10,Math.ceil(Math.log10(Math.abs(contextDataMin))));focusYScale.domain([flooredMin,ceiledMax]);let maxYAxisLabelWidth=0;const tempLabelText=svg.append("g").attr("class","temp-axis-label tick");tempLabelText.selectAll("text.temp.axis").data(focusYScale.ticks()).enter().append("text").text(d=>{if(fieldFormat!==undefined){return fieldFormat.convert(d,"text")}else{return focusYScale.tickFormat()(d)}}).each((function(){maxYAxisLabelWidth=Math.max(this.getBBox().width+focusYAxis.tickPadding(),maxYAxisLabelWidth)})).remove();d3_default.a.select(".temp-axis-label").remove();timeseries_chart_margin.left=Math.max(maxYAxisLabelWidth,40);this.vizWidth=Math.max(svgWidth-timeseries_chart_margin.left-timeseries_chart_margin.right,0);focusXScale.range([0,this.vizWidth]);focusYAxis.innerTickSize(-this.vizWidth);const focus=svg.append("g").attr("class","focus-chart").attr("transform","translate("+timeseries_chart_margin.left+","+timeseries_chart_margin.top+")");const context=svg.append("g").attr("class","context-chart").attr("transform","translate("+timeseries_chart_margin.left+","+(focusHeight+timeseries_chart_margin.top+chartSpacing)+")");const annotationsMask=svg.append("defs").append("mask").attr("id",ANNOTATION_MASK_ID);annotationsMask.append("rect").attr("x",0).attr("y",0).attr("width",this.vizWidth).attr("height",focusHeight).style("fill","white");createFocusChart(focus,this.vizWidth,focusHeight);drawContextElements(context,this.vizWidth,contextChartHeight,swimlaneHeight,annotationHeight)}drawContextChartSelection(){const{contextChartData:contextChartData,contextForecastData:contextForecastData,zoomFrom:zoomFrom,zoomTo:zoomTo}=this.props;if(contextChartData===undefined){return}let focusLoadFrom;let focusLoadTo;const contextXMin=this.contextXScale.domain()[0].getTime();const contextXMax=this.contextXScale.domain()[1].getTime();let combinedData=contextChartData;if(contextForecastData!==undefined){combinedData=combinedData.concat(contextForecastData)}if(zoomFrom){focusLoadFrom=zoomFrom.getTime()}else{focusLoadFrom=Object(external_kbnSharedDeps_Lodash_["reduce"])(combinedData,(memo,point)=>Math.min(memo,point.date.getTime()),new Date(2099,12,31).getTime())}focusLoadFrom=Math.max(focusLoadFrom,contextXMin);if(zoomTo){focusLoadTo=zoomTo.getTime()}else{focusLoadTo=Object(external_kbnSharedDeps_Lodash_["reduce"])(combinedData,(memo,point)=>Math.max(memo,point.date.getTime()),0)}focusLoadTo=Math.min(focusLoadTo,contextXMax);if(focusLoadFrom!==contextXMin||focusLoadTo!==contextXMax){this.setContextBrushExtent(new Date(focusLoadFrom),new Date(focusLoadTo));const newSelectedBounds={min:external_kbnSharedDeps_Moment_default()(new Date(focusLoadFrom)),max:external_kbnSharedDeps_Moment_default()(focusLoadFrom)};this.selectedBounds=newSelectedBounds}else{const contextXScaleDomain=this.contextXScale.domain();const newSelectedBounds={min:external_kbnSharedDeps_Moment_default()(new Date(contextXScaleDomain[0])),max:external_kbnSharedDeps_Moment_default()(contextXScaleDomain[1])};if(!Object(external_kbnSharedDeps_Lodash_["isEqual"])(newSelectedBounds,this.selectedBounds)){this.selectedBounds=newSelectedBounds;this.setContextBrushExtent(new Date(contextXScaleDomain[0]),new Date(contextXScaleDomain[1]))}}}createFocusChart(fcsGroup,fcsWidth,fcsHeight){const{contextForecastData:contextForecastData}=this.props;const zoomGroup=fcsGroup.append("g").attr("class","focus-zoom");zoomGroup.append("rect").attr("x",0).attr("y",0).attr("width",fcsWidth).attr("height",timeseries_chart_focusZoomPanelHeight).attr("class","chart-border");this.createZoomInfoElements(zoomGroup,fcsWidth);const annotateBrush=this.annotateBrush.bind(this);let brushX=0;let brushWidth=0;if(this.props.annotation!==null){brushX=this.focusXScale(this.props.annotation.timestamp);brushWidth=getAnnotationWidth(this.props.annotation,this.focusXScale)}fcsGroup.append("g").attr("class","mlAnnotationBrush").call(annotateBrush).selectAll("rect").attr("x",brushX).attr("y",timeseries_chart_focusZoomPanelHeight).attr("width",brushWidth).attr("height",timeseries_chart_focusChartHeight);fcsGroup.append("g").classed("mlAnnotations",true);fcsGroup.append("rect").attr("x",0).attr("y",timeseries_chart_focusZoomPanelHeight).attr("width",fcsWidth).attr("height",timeseries_chart_focusChartHeight).attr("class","chart-border");const xAxisBg=fcsGroup.append("g").attr("class","x-axis-background");xAxisBg.append("rect").attr("x",0).attr("y",fcsHeight).attr("width",fcsWidth).attr("height",chartSpacing);xAxisBg.append("line").attr("x1",0).attr("y1",fcsHeight).attr("x2",0).attr("y2",fcsHeight+chartSpacing);xAxisBg.append("line").attr("x1",fcsWidth).attr("y1",fcsHeight).attr("x2",fcsWidth).attr("y2",fcsHeight+chartSpacing);xAxisBg.append("line").attr("x1",0).attr("y1",fcsHeight+chartSpacing).attr("x2",fcsWidth).attr("y2",fcsHeight+chartSpacing);const axes=fcsGroup.append("g");axes.append("g").attr("class","x axis").attr("transform","translate(0,"+fcsHeight+")");axes.append("g").attr("class","y axis");fcsGroup.append("path").attr("class","area bounds");fcsGroup.append("path").attr("class","values-line");fcsGroup.append("g").attr("class","focus-chart-markers");if(contextForecastData){fcsGroup.append("path").attr("class","area forecast");fcsGroup.append("path").attr("class","values-line forecast");fcsGroup.append("g").attr("class","focus-chart-markers forecast")}fcsGroup.append("rect").attr("x",0).attr("y",0).attr("width",fcsWidth).attr("height",fcsHeight+24).attr("class","chart-border chart-border-highlight")}renderFocusChart(){const{focusAggregationInterval:focusAggregationInterval,focusAnnotationData:focusAnnotationDataOriginalPropValue,focusChartData:focusChartData,focusForecastData:focusForecastData,modelPlotEnabled:modelPlotEnabled,selectedJob:selectedJob,showAnnotations:showAnnotations,showForecast:showForecast,showModelBounds:showModelBounds,zoomFromFocusLoaded:zoomFromFocusLoaded,zoomToFocusLoaded:zoomToFocusLoaded}=this.props;const focusAnnotationData=Array.isArray(focusAnnotationDataOriginalPropValue)?focusAnnotationDataOriginalPropValue:[];if(focusChartData===undefined){return}const data=focusChartData;const contextYScale=this.contextYScale;const showFocusChartTooltip=this.showFocusChartTooltip.bind(this);const hideFocusChartTooltip=this.props.tooltipService.hide.bind(this.props.tooltipService);const focusChart=d3_default.a.select(".focus-chart");const focusAggInt=focusAggregationInterval.expression;const bucketSpan=selectedJob.analysis_config.bucket_span;const chartElement=d3_default.a.select(this.rootNode);chartElement.select(".zoom-aggregation-interval").text(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.zoomAggregationIntervalLabel",{defaultMessage:"(aggregation interval: {focusAggInt}, bucket span: {bucketSpan})",values:{focusAggInt:focusAggInt,bucketSpan:bucketSpan}}));if(zoomFromFocusLoaded===undefined||zoomToFocusLoaded===undefined){return}const bounds={min:external_kbnSharedDeps_Moment_default()(zoomFromFocusLoaded.getTime()),max:external_kbnSharedDeps_Moment_default()(zoomToFocusLoaded.getTime())};const aggMs=focusAggregationInterval.asMilliseconds();const earliest=external_kbnSharedDeps_Moment_default()(Math.floor(bounds.min.valueOf()/aggMs)*aggMs);const latest=external_kbnSharedDeps_Moment_default()(Math.ceil(bounds.max.valueOf()/aggMs)*aggMs);this.focusXScale.domain([earliest.toDate(),latest.toDate()]);if(focusChartData.length>0||focusForecastData!==undefined&&focusForecastData.length>0){if(this.fieldFormat!==undefined){this.focusYAxis.tickFormat(d=>this.fieldFormat.convert(d,"text"))}else{this.focusYAxis.tickFormat(null)}let yMin=0;let yMax=0;let combinedData=data;if(focusForecastData!==undefined&&focusForecastData.length>0){combinedData=data.concat(focusForecastData)}yMin=d3_default.a.min(combinedData,d=>{let metricValue=d.value;if(metricValue===null&&d.anomalyScore!==undefined&&d.actual!==undefined){metricValue=Array.isArray(d.actual)?d.actual[0]:d.actual}if(d.lower!==undefined){if(metricValue!==null&&metricValue!==undefined){return Math.min(metricValue,d.lower)}else{return d.lower}}return metricValue});yMax=d3_default.a.max(combinedData,d=>{let metricValue=d.value;if(metricValue===null&&d.anomalyScore!==undefined&&d.actual!==undefined){metricValue=Array.isArray(d.actual)?d.actual[0]:d.actual}return d.upper!==undefined?Math.max(metricValue,d.upper):metricValue});if(yMax===yMin){if(this.contextYScale.domain()[0]!==contextYScale.domain()[1]&&yMin>=contextYScale.domain()[0]&&yMax<=contextYScale.domain()[1]){yMin=contextYScale.domain()[0];yMax=contextYScale.domain()[1]}else{yMin-=yMin*.05;yMax+=yMax*.05}}if(showAnnotations&&focusAnnotationData&&focusAnnotationData.length>0){const levels=getAnnotationLevels(focusAnnotationData);const maxLevel=d3_default.a.max(Object.keys(levels).map(key=>levels[key]));yMax+=Math.abs(yMax-yMin)*((maxLevel+1)/5)}this.focusYScale.domain([yMin,yMax])}else{this.focusYScale.domain([0,10]);this.focusYAxis.tickFormat("")}const timeBuckets=Object(time_buckets["c"])();timeBuckets.setInterval("auto");timeBuckets.setBounds(bounds);const xAxisTickFormat=timeBuckets.getScaledDateFormat();focusChart.select(".x.axis").call(this.focusXAxis.ticks(numTicksForDateFormat(this.vizWidth),xAxisTickFormat).tickFormat(d=>external_kbnSharedDeps_Moment_default()(d).format(xAxisTickFormat)));focusChart.select(".y.axis").call(this.focusYAxis);filterAxisLabels(focusChart.select(".x.axis"),this.vizWidth);if(modelPlotEnabled===true){focusChart.select(".area.bounds").attr("d",this.focusBoundedArea(data)).classed("hidden",!showModelBounds)}renderAnnotations(focusChart,focusAnnotationData,timeseries_chart_focusZoomPanelHeight,timeseries_chart_focusChartHeight,this.focusXScale,showAnnotations,showFocusChartTooltip,hideFocusChartTooltip,this.props.annotationUpdatesService);focusChart.select(".mlAnnotationBrush").style("display",showAnnotations?null:"none");focusChart.select(".values-line").attr("d",this.focusValuesLine(data));drawLineChartDots(data,focusChart,this.focusValuesLine);const dots=d3_default.a.select(".focus-chart-markers").selectAll(".metric-value").data(data.filter(d=>(d.value!==null||typeof d.anomalyScore==="number")&&!showMultiBucketAnomalyMarker(d)));dots.exit().remove();dots.enter().append("circle").attr("r",chart_utils_LINE_CHART_ANOMALY_RADIUS).on("mouseover",(function(d){showFocusChartTooltip(d,this)})).on("mouseout",()=>this.props.tooltipService.hide());dots.attr("cx",d=>this.focusXScale(d.date)).attr("cy",d=>this.focusYScale(d.value)).attr("class",d=>{let markerClass="metric-value";if(d.anomalyScore!==undefined){markerClass+=` anomaly-marker ${Object(anomaly_utils["k"])(d.anomalyScore).id}`}return markerClass});const multiBucketMarkers=d3_default.a.select(".focus-chart-markers").selectAll(".multi-bucket").data(data.filter(d=>d.anomalyScore!==null&&showMultiBucketAnomalyMarker(d)===true));multiBucketMarkers.exit().remove();multiBucketMarkers.enter().append("path").attr("d",d3_default.a.svg.symbol().size(MULTI_BUCKET_SYMBOL_SIZE).type("cross")).on("mouseover",(function(d){showFocusChartTooltip(d,this)})).on("mouseout",()=>this.props.tooltipService.hide());multiBucketMarkers.attr("transform",d=>`translate(${this.focusXScale(d.date)}, ${this.focusYScale(d.value)})`).attr("class",d=>`anomaly-marker multi-bucket ${Object(anomaly_utils["k"])(d.anomalyScore).id}`);const scheduledEventMarkers=d3_default.a.select(".focus-chart-markers").selectAll(".scheduled-event-marker").data(data.filter(d=>d.scheduledEvents!==undefined));scheduledEventMarkers.exit().remove();scheduledEventMarkers.enter().append("rect").attr("width",chart_utils_LINE_CHART_ANOMALY_RADIUS*2).attr("height",SCHEDULED_EVENT_SYMBOL_HEIGHT).attr("class","scheduled-event-marker").attr("rx",1).attr("ry",1);scheduledEventMarkers.attr("x",d=>this.focusXScale(d.date)-chart_utils_LINE_CHART_ANOMALY_RADIUS).attr("y",d=>this.focusYScale(d.value)-3);if(focusForecastData!==undefined){focusChart.select(".area.forecast").attr("d",this.focusBoundedArea(focusForecastData)).classed("hidden",!showForecast);focusChart.select(".values-line.forecast").attr("d",this.focusValuesLine(focusForecastData)).classed("hidden",!showForecast);const forecastDots=d3_default.a.select(".focus-chart-markers.forecast").selectAll(".metric-value").data(focusForecastData);forecastDots.exit().remove();forecastDots.enter().append("circle").attr("r",chart_utils_LINE_CHART_ANOMALY_RADIUS).on("mouseover",(function(d){showFocusChartTooltip(d,this)})).on("mouseout",()=>this.props.tooltipService.hide());forecastDots.attr("cx",d=>this.focusXScale(d.date)).attr("cy",d=>this.focusYScale(d.value)).attr("class","metric-value").classed("hidden",!showForecast)}}createZoomInfoElements(zoomGroup,fcsWidth){const{autoZoomDuration:autoZoomDuration,bounds:bounds,modelPlotEnabled:modelPlotEnabled}=this.props;const setZoomInterval=this.setZoomInterval.bind(this);const boundsSecs=bounds.max.unix()-bounds.min.unix();const minSecs=10/this.vizWidth*boundsSecs;let xPos=10;const zoomLabel=zoomGroup.append("text").attr("x",xPos).attr("y",17).attr("class","zoom-info-text").text(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.zoomLabel",{defaultMessage:"Zoom:"}));const zoomOptions=[{durationMs:autoZoomDuration,label:"auto"}];Object(external_kbnSharedDeps_Lodash_["each"])(ZOOM_INTERVAL_OPTIONS,option=>{if(option.duration.asSeconds()>minSecs&&option.duration.asSeconds()<boundsSecs){zoomOptions.push({durationMs:option.duration.asMilliseconds(),label:option.label})}});xPos+=zoomLabel.node().getBBox().width+4;Object(external_kbnSharedDeps_Lodash_["each"])(zoomOptions,option=>{const text=zoomGroup.append("a").attr("data-ms",option.durationMs).attr("href","").append("text").attr("x",xPos).attr("y",17).attr("class","zoom-info-text").text(option.label);xPos+=text.node().getBBox().width+4});zoomGroup.append("text").attr("x",xPos+6).attr("y",17).attr("class","zoom-info-text zoom-aggregation-interval").text(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.zoomGroupAggregationIntervalLabel",{defaultMessage:"(aggregation interval: , bucket span: )"}));if(modelPlotEnabled===false){const modelPlotLabel=zoomGroup.append("text").attr("x",300).attr("y",17).attr("class","zoom-info-text").text(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.modelBoundsNotAvailableLabel",{defaultMessage:"Model bounds are not available"}));modelPlotLabel.attr("x",fcsWidth-(modelPlotLabel.node().getBBox().width+10))}const chartElement=d3_default.a.select(this.rootNode);chartElement.selectAll(".focus-zoom a").on("click",(function(){d3_default.a.event.preventDefault();setZoomInterval(d3_default.a.select(this).attr("data-ms"))}))}drawContextElements(cxtGroup,cxtWidth,cxtChartHeight,swlHeight){const{bounds:bounds,contextChartData:contextChartData,contextForecastData:contextForecastData,modelPlotEnabled:modelPlotEnabled,annotationData:annotationData,showAnnotations:showAnnotations}=this.props;const data=contextChartData;const showFocusChartTooltip=this.showFocusChartTooltip.bind(this);const hideFocusChartTooltip=this.props.tooltipService.hide.bind(this.props.tooltipService);this.contextXScale=d3_default.a.time.scale().range([0,cxtWidth]).domain(this.calculateContextXAxisDomain());const combinedData=contextForecastData===undefined?data:data.concat(contextForecastData);const valuesRange={min:Number.MAX_VALUE,max:Number.MIN_VALUE};Object(external_kbnSharedDeps_Lodash_["each"])(combinedData,item=>{valuesRange.min=Math.min(item.value,valuesRange.min);valuesRange.max=Math.max(item.value,valuesRange.max)});let dataMin=valuesRange.min;let dataMax=valuesRange.max;const chartLimits={min:dataMin,max:dataMax};if(modelPlotEnabled===true||contextForecastData!==undefined&&contextForecastData.length>0){const boundsRange={min:Number.MAX_VALUE,max:Number.MIN_VALUE};Object(external_kbnSharedDeps_Lodash_["each"])(combinedData,item=>{boundsRange.min=Math.min(item.lower,boundsRange.min);boundsRange.max=Math.max(item.upper,boundsRange.max)});dataMin=Math.min(dataMin,boundsRange.min);dataMax=Math.max(dataMax,boundsRange.max);if(valuesRange.max-valuesRange.min<.5*(dataMax-dataMin)){if(valuesRange.min>dataMin){chartLimits.min=valuesRange.min-.5*(valuesRange.max-valuesRange.min)}if(valuesRange.max<dataMax){chartLimits.max=valuesRange.max+.5*(valuesRange.max-valuesRange.min)}}}this.contextYScale=d3_default.a.scale.linear().range([cxtChartHeight,contextChartLineTopMargin]).domain([chartLimits.min,chartLimits.max]);const borders=cxtGroup.append("g").attr("class","axis");const brushChartHeight=showAnnotations?cxtChartHeight+swlHeight+annotationHeight:cxtChartHeight+swlHeight;borders.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",brushChartHeight);borders.append("line").attr("x1",cxtWidth).attr("y1",0).attr("x2",cxtWidth).attr("y2",brushChartHeight);borders.append("line").attr("x1",0).attr("y1",brushChartHeight).attr("x2",cxtWidth).attr("y2",brushChartHeight);const timeBuckets=Object(time_buckets["c"])();timeBuckets.setInterval("auto");timeBuckets.setBounds(bounds);const xAxisTickFormat=timeBuckets.getScaledDateFormat();const xAxis=d3_default.a.svg.axis().scale(this.contextXScale).orient("top").innerTickSize(-cxtChartHeight).outerTickSize(0).tickPadding(0).ticks(numTicksForDateFormat(cxtWidth,xAxisTickFormat)).tickFormat(d=>external_kbnSharedDeps_Moment_default()(d).format(xAxisTickFormat));cxtGroup.datum(data);const contextBoundsArea=d3_default.a.svg.area().x(d=>this.contextXScale(d.date)).y0(d=>this.contextYScale(Math.min(chartLimits.max,Math.max(d.lower,chartLimits.min)))).y1(d=>this.contextYScale(Math.max(chartLimits.min,Math.min(d.upper,chartLimits.max)))).defined(d=>d.lower!==null&&d.upper!==null);if(modelPlotEnabled===true){cxtGroup.append("path").datum(data).attr("class","area context").attr("d",contextBoundsArea)}const contextValuesLine=d3_default.a.svg.line().x(d=>this.contextXScale(d.date)).y(d=>this.contextYScale(d.value)).defined(d=>d.value!==null);cxtGroup.append("path").datum(data).attr("class","values-line").attr("d",contextValuesLine);drawLineChartDots(data,cxtGroup,contextValuesLine,1);cxtGroup.append("g").classed("mlContextAnnotations",true);const[contextXRangeStart,contextXRangeEnd]=this.contextXScale.range();const ctxAnnotations=cxtGroup.select(".mlContextAnnotations").selectAll("g.mlContextAnnotation").data(showAnnotations&&annotationData?annotationData:[],d=>d._id||"");ctxAnnotations.enter().append("g").classed("mlContextAnnotation",true);const ctxAnnotationRects=ctxAnnotations.selectAll(".mlContextAnnotationRect").data(d=>[d]);ctxAnnotationRects.enter().append("rect").attr("rx",ctxAnnotationMargin).attr("ry",ctxAnnotationMargin).on("mouseover",(function(d){showFocusChartTooltip(d,this)})).on("mouseout",()=>hideFocusChartTooltip()).classed("mlContextAnnotationRect",true);ctxAnnotationRects.attr("x",d=>{const date=external_kbnSharedDeps_Moment_default()(d.timestamp);let xPos=this.contextXScale(date);if(xPos-ANNOTATION_SYMBOL_HEIGHT<=contextXRangeStart){xPos=0}if(xPos+ANNOTATION_SYMBOL_HEIGHT>=contextXRangeEnd){xPos=contextXRangeEnd-ANNOTATION_SYMBOL_HEIGHT}return xPos}).attr("y",cxtChartHeight+swlHeight+2).attr("height",ANNOTATION_SYMBOL_HEIGHT).attr("width",d=>{const start=this.contextXScale(external_kbnSharedDeps_Moment_default()(d.timestamp))+1;const end=typeof d.end_timestamp!=="undefined"?this.contextXScale(external_kbnSharedDeps_Moment_default()(d.end_timestamp))-1:start+ANNOTATION_MIN_WIDTH;const width=Math.max(ANNOTATION_MIN_WIDTH,end-start);return width});ctxAnnotations.classed("mlAnnotationHidden",!showAnnotations);ctxAnnotationRects.exit().remove();if(contextForecastData!==undefined){cxtGroup.append("path").datum(contextForecastData).attr("class","area forecast").attr("d",contextBoundsArea);cxtGroup.append("path").datum(contextForecastData).attr("class","values-line forecast").attr("d",contextValuesLine)}const swimlane=cxtGroup.append("g").attr("class","swimlane").attr("transform","translate(0,"+cxtChartHeight+")");this.drawSwimlane(swimlane,cxtWidth,swlHeight);this.mask=new ContextChartMask(cxtGroup,contextChartData,modelPlotEnabled,swlHeight).x(this.contextXScale).y(this.contextYScale);cxtGroup.append("g").attr("class","x axis context-chart-axis").call(xAxis);cxtGroup.selectAll(".x.context-chart-axis text").attr("dy",cxtChartHeight-5);filterAxisLabels(cxtGroup.selectAll(".x.context-chart-axis"),cxtWidth);this.drawContextBrush(cxtGroup)}setZoomInterval(ms){const{bounds:bounds,zoomTo:zoomTo}=this.props;const minBoundsMs=bounds.min.valueOf();const maxBoundsMs=bounds.max.valueOf();const millis=+ms;let to=zoomTo.getTime();let from=to-millis;if(from<minBoundsMs){from=minBoundsMs;to=Math.min(minBoundsMs+millis,maxBoundsMs)}this.setContextBrushExtent(new Date(from),new Date(to))}showFocusChartTooltip(marker,circle){const{modelPlotEnabled:modelPlotEnabled}=this.props;const fieldFormat=this.fieldFormat;const seriesKey="single_metric_viewer";const formattedDate=Object(date_utils["c"])(marker.date);const tooltipData=[{label:formattedDate}];if(marker.anomalyScore!==undefined){const score=parseInt(marker.anomalyScore);tooltipData.push({label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.anomalyScoreLabel",{defaultMessage:"anomaly score"}),value:Object(anomaly_utils["f"])(score),color:anomalyColorScale(score),seriesIdentifier:{key:seriesKey},valueAccessor:"anomaly_score"});if(showMultiBucketAnomalyTooltip(marker)===true){tooltipData.push({label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.multiBucketImpactLabel",{defaultMessage:"multi-bucket impact"}),value:Object(anomaly_utils["g"])(marker.multiBucketImpact),seriesIdentifier:{key:seriesKey},valueAccessor:"multi_bucket_impact"})}if(marker.metricFunction){tooltipData.push({label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.metricActualPlotFunctionLabel",{defaultMessage:"function"}),value:marker.metricFunction,seriesIdentifier:{key:seriesKey},valueAccessor:"metric_function"})}if(modelPlotEnabled===false){if(marker.actual!==undefined&&marker.function!=="rare"){tooltipData.push({label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.actualLabel",{defaultMessage:"actual"}),value:Object(format_value["b"])(marker.actual,marker.function,fieldFormat),seriesIdentifier:{key:seriesKey},valueAccessor:"actual"});tooltipData.push({label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.typicalLabel",{defaultMessage:"typical"}),value:Object(format_value["b"])(marker.typical,marker.function,fieldFormat),seriesIdentifier:{key:seriesKey},valueAccessor:"typical"})}else{tooltipData.push({label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.valueLabel",{defaultMessage:"value"}),value:Object(format_value["b"])(marker.value,marker.function,fieldFormat),seriesIdentifier:{key:seriesKey},valueAccessor:"value"});if(marker.byFieldName!==undefined&&marker.numberOfCauses!==undefined){const numberOfCauses=marker.numberOfCauses;const byFieldName=Object(string_utils["d"])(marker.byFieldName);tooltipData.push({label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.moreThanOneUnusualByFieldValuesLabel",{defaultMessage:"{numberOfCauses}{plusSign} unusual {byFieldName} values",values:{numberOfCauses:numberOfCauses,byFieldName:byFieldName,plusSign:numberOfCauses<10?"":"+"}}),seriesIdentifier:{key:seriesKey},valueAccessor:"numberOfCauses"})}}}else{tooltipData.push({label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.modelPlotEnabled.actualLabel",{defaultMessage:"actual"}),value:Object(format_value["b"])(marker.actual,marker.function,fieldFormat),seriesIdentifier:{key:seriesKey},valueAccessor:"actual"});tooltipData.push({label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.modelPlotEnabled.upperBoundsLabel",{defaultMessage:"upper bounds"}),value:Object(format_value["b"])(marker.upper,marker.function,fieldFormat),seriesIdentifier:{key:seriesKey},valueAccessor:"upper_bounds"});tooltipData.push({label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.modelPlotEnabled.lowerBoundsLabel",{defaultMessage:"lower bounds"}),value:Object(format_value["b"])(marker.lower,marker.function,fieldFormat),seriesIdentifier:{key:seriesKey},valueAccessor:"lower_bounds"})}}else{if(Object(external_kbnSharedDeps_Lodash_["get"])(marker,"isForecast",false)===true){tooltipData.push({label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.withoutAnomalyScore.predictionLabel",{defaultMessage:"prediction"}),value:Object(format_value["b"])(marker.value,marker.function,fieldFormat),seriesIdentifier:{key:seriesKey},valueAccessor:"prediction"})}else{tooltipData.push({label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.withoutAnomalyScore.valueLabel",{defaultMessage:"value"}),value:Object(format_value["b"])(marker.value,marker.function,fieldFormat),seriesIdentifier:{key:seriesKey},valueAccessor:"value"})}if(modelPlotEnabled===true){tooltipData.push({label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.withoutAnomalyScoreAndModelPlotEnabled.upperBoundsLabel",{defaultMessage:"upper bounds"}),value:Object(format_value["b"])(marker.upper,marker.function,fieldFormat),seriesIdentifier:{key:seriesKey},valueAccessor:"upper_bounds"});tooltipData.push({label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.withoutAnomalyScoreAndModelPlotEnabled.lowerBoundsLabel",{defaultMessage:"lower bounds"}),value:Object(format_value["b"])(marker.lower,marker.function,fieldFormat),seriesIdentifier:{key:seriesKey},valueAccessor:"lower_bounds"})}}if(marker.scheduledEvents!==undefined){marker.scheduledEvents.forEach((scheduledEvent,i)=>{tooltipData.push({label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.scheduledEventsLabel",{defaultMessage:"scheduled event{counter}",values:{counter:marker.scheduledEvents.length>1?` #${i+1}`:""}}),value:scheduledEvent,seriesIdentifier:{key:seriesKey},valueAccessor:`scheduled_events_${i+1}`})})}if(marker.annotation!==undefined){tooltipData.length=0;tooltipData.push({label:marker.annotation});let timespan=external_kbnSharedDeps_Moment_default()(marker.timestamp).format("MMMM Do YYYY, HH:mm");if(typeof marker.end_timestamp!=="undefined"){timespan+=` - ${external_kbnSharedDeps_Moment_default()(marker.end_timestamp).format("MMMM Do YYYY, HH:mm")}`}tooltipData.push({label:timespan,seriesIdentifier:{key:seriesKey},valueAccessor:"timespan"})}let xOffset=chart_utils_LINE_CHART_ANOMALY_RADIUS*2;if(circle.tagName.toLowerCase()==="rect"){const x=Number(circle.getAttribute("x"));if(x<0){xOffset=Math.abs(x)}}this.props.tooltipService.show(tooltipData,circle,{x:xOffset,y:0})}highlightFocusChartAnomaly(record){const{focusChartData:focusChartData,focusAggregationInterval:focusAggregationInterval}=this.props;const focusXScale=this.focusXScale;const focusYScale=this.focusYScale;const showFocusChartTooltip=this.showFocusChartTooltip.bind(this);const anomalyTime=record.source.timestamp;const markerToSelect=findChartPointForAnomalyTime(focusChartData,anomalyTime,focusAggregationInterval);if(markerToSelect!==undefined){const selectedMarker=d3_default.a.select(".focus-chart-markers").selectAll(".focus-chart-highlighted-marker").data([markerToSelect]);if(showMultiBucketAnomalyMarker(markerToSelect)===true){selectedMarker.enter().append("path").attr("d",d3_default.a.svg.symbol().size(MULTI_BUCKET_SYMBOL_SIZE).type("cross")).attr("transform",d=>`translate(${focusXScale(d.date)}, ${focusYScale(d.value)})`).attr("class",d=>`anomaly-marker multi-bucket ${Object(anomaly_utils["k"])(d.anomalyScore).id} highlighted`)}else{selectedMarker.enter().append("circle").attr("r",chart_utils_LINE_CHART_ANOMALY_RADIUS).attr("cx",d=>focusXScale(d.date)).attr("cy",d=>focusYScale(d.value)).attr("class",d=>`anomaly-marker metric-value ${Object(anomaly_utils["k"])(d.anomalyScore).id} highlighted`)}const chartElement=d3_default.a.select(this.rootNode);const anomalyMarker=chartElement.selectAll(".focus-chart-markers .anomaly-marker.highlighted");if(anomalyMarker.length){showFocusChartTooltip(markerToSelect,anomalyMarker[0][0])}}}unhighlightFocusChartAnomaly(){d3_default.a.select(".focus-chart-markers").selectAll(".anomaly-marker.highlighted").remove();this.props.tooltipService.hide()}shouldComponentUpdate(){return true}setRef(componentNode){this.rootNode=componentNode}render(){return external_kbnSharedDeps_React_default.a.createElement("div",{className:"ml-timeseries-chart-react",ref:this.setRef.bind(this)})}}const TimeseriesChart=props=>{const annotationUpdatesService=Object(external_kbnSharedDeps_React_["useContext"])(ml_annotation_updates_context["a"]);const annotationProp=useObservable_default()(annotationUpdatesService.isAnnotationInitialized$());if(annotationProp===undefined){return null}return external_kbnSharedDeps_React_default.a.createElement(timeseries_chart_TimeseriesChartIntl,timeseries_chart_extends({annotation:annotationProp},props,{annotationUpdatesService:annotationUpdatesService}))};function timeseries_chart_with_tooltip_extends(){timeseries_chart_with_tooltip_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return timeseries_chart_with_tooltip_extends.apply(this,arguments)}const TimeSeriesChartWithTooltips=({bounds:bounds,detectorIndex:detectorIndex,renderFocusChartOnly:renderFocusChartOnly,selectedJob:selectedJob,selectedEntities:selectedEntities,showAnnotations:showAnnotations,showForecast:showForecast,showModelBounds:showModelBounds,chartProps:chartProps,lastRefresh:lastRefresh,contextAggregationInterval:contextAggregationInterval})=>{const{toasts:toastNotifications}=Object(contexts_kibana["f"])();const{services:{mlServices:{mlApiServices:mlApiServices}}}=Object(contexts_kibana["b"])();const annotationUpdatesService=Object(external_kbnSharedDeps_React_["useContext"])(ml_annotation_updates_context["a"]);const[annotationData,setAnnotationData]=Object(external_kbnSharedDeps_React_["useState"])([]);const showAnnotationErrorToastNotification=Object(external_kbnSharedDeps_React_["useCallback"])(error=>{toastNotifications.addDanger({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.mlSingleMetricViewerChart.annotationsErrorTitle",{defaultMessage:"An error occurred fetching annotations"}),...error?{text:Object(util_errors["i"])(error)}:{}})},[]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{let unmounted=false;const entities=getControlsForDetector(detectorIndex,selectedEntities,selectedJob.job_id);const nonBlankEntities=Array.isArray(entities)?entities.filter(entity=>entity.fieldValue!==null):undefined;const searchBounds=Object(time_buckets["b"])(bounds,contextAggregationInterval,false);const loadAnnotations=async jobId=>{try{const resp=await mlApiServices.annotations.getAnnotations({jobIds:[jobId],earliestMs:searchBounds.min.valueOf(),latestMs:searchBounds.max.valueOf(),maxAnnotations:constants_search["a"],fields:[{field:"event",missing:constants_annotations["b"]}],detectorIndex:detectorIndex,entities:nonBlankEntities});if(!unmounted){if(Array.isArray(resp.annotations[jobId])){setAnnotationData(resp.annotations[jobId])}}}catch(error){showAnnotationErrorToastNotification(error)}};loadAnnotations(selectedJob.job_id);return()=>{unmounted=true}},[selectedJob.job_id,detectorIndex,lastRefresh,selectedEntities,bounds,contextAggregationInterval]);return external_kbnSharedDeps_React_default.a.createElement("div",{className:"ml-timeseries-chart","data-test-subj":"mlSingleMetricViewerChart"},external_kbnSharedDeps_React_default.a.createElement(chart_tooltip["b"],null,tooltipService=>external_kbnSharedDeps_React_default.a.createElement(TimeseriesChart,timeseries_chart_with_tooltip_extends({},chartProps,{annotationUpdatesService:annotationUpdatesService,annotationData:annotationData,bounds:bounds,detectorIndex:detectorIndex,renderFocusChartOnly:renderFocusChartOnly,selectedJob:selectedJob,showAnnotations:showAnnotations,showForecast:showForecast,showModelBounds:showModelBounds,tooltipService:tooltipService}))))};function timeseriesexplorer_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const allValuesLabel=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.allPartitionValuesLabel",{defaultMessage:"all"});function getTimeseriesexplorerDefaultState(){return{chartDetails:undefined,contextAggregationInterval:undefined,contextChartData:undefined,contextForecastData:undefined,dataNotChartable:false,entitiesLoading:false,entityValues:{},focusAnnotationData:[],focusAggregations:{},focusAggregationInterval:{},focusChartData:undefined,focusForecastData:undefined,fullRefresh:true,hasResults:false,loadCounter:0,loading:false,modelPlotEnabled:false,showAnnotations:true,showAnnotationsCheckbox:true,showForecast:true,showForecastCheckbox:false,showModelBounds:true,showModelBoundsCheckbox:false,svgWidth:0,tableData:undefined,zoomFrom:undefined,zoomTo:undefined,zoomFromFocusLoaded:undefined,zoomToFocusLoaded:undefined}}const containerPadding=34;class timeseriesexplorer_TimeSeriesExplorer extends external_kbnSharedDeps_React_default.a.Component{constructor(...args){super(...args);timeseriesexplorer_defineProperty(this,"state",getTimeseriesexplorerDefaultState());timeseriesexplorer_defineProperty(this,"subscriptions",new external_kbnSharedDeps_Rxjs_["Subscription"]);timeseriesexplorer_defineProperty(this,"resizeRef",Object(external_kbnSharedDeps_React_["createRef"])());timeseriesexplorer_defineProperty(this,"resizeChecker",undefined);timeseriesexplorer_defineProperty(this,"resizeHandler",()=>{this.setState({svgWidth:this.resizeRef.current!==null?this.resizeRef.current.offsetWidth-containerPadding:0})});timeseriesexplorer_defineProperty(this,"unmounted",false);timeseriesexplorer_defineProperty(this,"contextChart$",new external_kbnSharedDeps_Rxjs_["Subject"]);timeseriesexplorer_defineProperty(this,"getFieldNamesWithEmptyValues",()=>{const latestEntityControls=this.getControlsForDetector();return latestEntityControls.filter(({fieldValue:fieldValue})=>fieldValue===null).map(({fieldName:fieldName})=>fieldName)});timeseriesexplorer_defineProperty(this,"arePartitioningFieldsProvided",()=>{const fieldNamesWithEmptyValues=this.getFieldNamesWithEmptyValues();return fieldNamesWithEmptyValues.length===0});timeseriesexplorer_defineProperty(this,"toggleShowAnnotationsHandler",()=>{this.setState(prevState=>({showAnnotations:!prevState.showAnnotations}))});timeseriesexplorer_defineProperty(this,"toggleShowForecastHandler",()=>{this.setState(prevState=>({showForecast:!prevState.showForecast}))});timeseriesexplorer_defineProperty(this,"toggleShowModelBoundsHandler",()=>{this.setState({showModelBounds:!this.state.showModelBounds})});timeseriesexplorer_defineProperty(this,"setFunctionDescription",selectedFuction=>{this.props.appStateHandler(APP_STATE_ACTION.SET_FUNCTION_DESCRIPTION,selectedFuction)});timeseriesexplorer_defineProperty(this,"previousChartProps",{});timeseriesexplorer_defineProperty(this,"previousShowAnnotations",undefined);timeseriesexplorer_defineProperty(this,"previousShowForecast",undefined);timeseriesexplorer_defineProperty(this,"previousShowModelBounds",undefined);timeseriesexplorer_defineProperty(this,"tableFilter",(field,value,operator)=>{const entities=this.getControlsForDetector();const entity=entities.find(({fieldName:fieldName})=>fieldName===field);if(entity===undefined){return}const{appStateHandler:appStateHandler}=this.props;let resultValue="";if(operator==="+"&&entity.fieldValue!==value){resultValue=value}else if(operator==="-"&&entity.fieldValue===value){resultValue=null}else{return}const resultEntities={...entities.reduce((appStateEntities,appStateEntity)=>{appStateEntities[appStateEntity.fieldName]=appStateEntity.fieldValue;return appStateEntities},{}),[entity.fieldName]:resultValue};appStateHandler(APP_STATE_ACTION.SET_ENTITIES,resultEntities)});timeseriesexplorer_defineProperty(this,"contextChartSelectedInitCallDone",false);timeseriesexplorer_defineProperty(this,"contextChartSelected",selection=>{const zoomState={from:selection.from.toISOString(),to:selection.to.toISOString()};if(Object(external_kbnSharedDeps_Lodash_["isEqual"])(this.props.zoom,zoomState)&&this.state.focusChartData!==undefined&&this.props.previousRefresh===this.props.lastRefresh){return}this.contextChart$.next(selection);this.props.appStateHandler(APP_STATE_ACTION.SET_ZOOM,zoomState)});timeseriesexplorer_defineProperty(this,"loadAnomaliesTableData",(earliestMs,latestMs)=>{const{dateFormatTz:dateFormatTz,selectedDetectorIndex:selectedDetectorIndex,selectedJobId:selectedJobId,tableInterval:tableInterval,tableSeverity:tableSeverity,functionDescription:functionDescription}=this.props;const selectedJob=job_service["a"].getJob(selectedJobId);const entityControls=this.getControlsForDetector();return ml_api_service["ml"].results.getAnomaliesTableData([selectedJob.job_id],this.getCriteriaFields(selectedDetectorIndex,entityControls),[],tableInterval,tableSeverity,earliestMs,latestMs,dateFormatTz,constants_search["b"],undefined,undefined,functionDescription).pipe(Object(external_kbnSharedDeps_RxjsOperators_["map"])(resp=>{const anomalies=resp.anomalies;const detectorsByJob=job_service["a"].detectorsByJob;anomalies.forEach(anomaly=>{const jobId=anomaly.jobId;const detector=Object(external_kbnSharedDeps_Lodash_["get"])(detectorsByJob,[jobId,anomaly.detectorIndex]);anomaly.detector=Object(external_kbnSharedDeps_Lodash_["get"])(detector,["detector_description"],anomaly.source.function_description);const customRules=detector.custom_rules;if(customRules!==undefined){anomaly.rulesLength=customRules.length}if(Object(external_kbnSharedDeps_Lodash_["has"])(job_service["a"].customUrlsByJob,jobId)){anomaly.customUrls=job_service["a"].customUrlsByJob[jobId]}});return{tableData:{anomalies:anomalies,interval:resp.interval,examplesByJobId:resp.examplesByJobId,showViewSeriesLink:false}}}))});timeseriesexplorer_defineProperty(this,"setForecastId",forecastId=>{this.props.appStateHandler(APP_STATE_ACTION.SET_FORECAST_ID,forecastId)});timeseriesexplorer_defineProperty(this,"loadSingleMetricData",(fullRefresh=true)=>{const{autoZoomDuration:autoZoomDuration,bounds:bounds,selectedDetectorIndex:selectedDetectorIndex,selectedForecastId:selectedForecastId,selectedJobId:selectedJobId,zoom:zoom,functionDescription:functionDescription}=this.props;const{loadCounter:currentLoadCounter}=this.state;const currentSelectedJob=job_service["a"].getJob(selectedJobId);if(currentSelectedJob===undefined){return}if(isMetricDetector(currentSelectedJob,selectedDetectorIndex)&&functionDescription===undefined){return}const functionToPlotByIfMetric=anomaly_utils["b"].toES(functionDescription);this.contextChartSelectedInitCallDone=false;const entityControls=this.getControlsForDetector();this.setState({fullRefresh:fullRefresh,loadCounter:currentLoadCounter+1,loading:true,...fullRefresh?{chartDetails:undefined,contextChartData:undefined,contextForecastData:undefined,focusChartData:undefined,focusForecastData:undefined,modelPlotEnabled:Object(job_utils["l"])(currentSelectedJob,selectedDetectorIndex)&&Object(job_utils["m"])(currentSelectedJob,selectedDetectorIndex,entityControls),hasResults:false,dataNotChartable:false}:{}},()=>{const{loadCounter:loadCounter,modelPlotEnabled:modelPlotEnabled}=this.state;const jobs=createTimeSeriesJobData(job_service["a"].jobs);const selectedJob=job_service["a"].getJob(selectedJobId);const detectorIndex=selectedDetectorIndex;let awaitingCount=3;const stateUpdate={};const finish=counterVar=>{awaitingCount--;if(awaitingCount===0&&counterVar===loadCounter){stateUpdate.hasResults=Array.isArray(stateUpdate.contextChartData)&&stateUpdate.contextChartData.length>0||Array.isArray(stateUpdate.contextForecastData)&&stateUpdate.contextForecastData.length>0;stateUpdate.loading=false;if(stateUpdate.contextChartData.length&&this.arePartitioningFieldsProvided()===true){let focusRange=calculateInitialFocusRange(zoom,stateUpdate.contextAggregationInterval,bounds);if(focusRange===undefined||this.previousSelectedForecastId!==this.props.selectedForecastId){focusRange=calculateDefaultFocusRange(autoZoomDuration,stateUpdate.contextAggregationInterval,stateUpdate.contextChartData,stateUpdate.contextForecastData);this.previousSelectedForecastId=this.props.selectedForecastId}this.contextChartSelected({from:focusRange[0],to:focusRange[1]})}this.setState(stateUpdate)}};const nonBlankEntities=entityControls.filter(entity=>entity.fieldValue!==null);if(modelPlotEnabled===false&&Object(job_utils["n"])(selectedJob,detectorIndex)===false&&nonBlankEntities.length>0){stateUpdate.hasResults=false;stateUpdate.loading=false;stateUpdate.dataNotChartable=true;this.setState(stateUpdate);return}stateUpdate.contextAggregationInterval=calculateAggregationInterval(bounds,CHARTS_POINT_TARGET,jobs,selectedJob);const searchBounds=Object(time_buckets["b"])(bounds,stateUpdate.contextAggregationInterval,false);const counter=loadCounter;mlTimeSeriesSearchService.getMetricData(selectedJob,detectorIndex,nonBlankEntities,searchBounds.min.valueOf(),searchBounds.max.valueOf(),stateUpdate.contextAggregationInterval.asMilliseconds(),functionToPlotByIfMetric).toPromise().then(resp=>{const fullRangeChartData=processMetricPlotResults(resp.results,modelPlotEnabled);stateUpdate.contextChartData=fullRangeChartData;finish(counter)}).catch(resp=>{console.log("Time series explorer - error getting metric data from elasticsearch:",resp)});results_service["mlResultsService"].getRecordMaxScoreByTime(selectedJob.job_id,this.getCriteriaFields(detectorIndex,entityControls),searchBounds.min.valueOf(),searchBounds.max.valueOf(),stateUpdate.contextAggregationInterval.asMilliseconds(),functionToPlotByIfMetric).then(resp=>{const fullRangeRecordScoreData=processRecordScoreResults(resp.results);stateUpdate.swimlaneData=fullRangeRecordScoreData;finish(counter)}).catch(resp=>{console.log("Time series explorer - error getting bucket anomaly scores from elasticsearch:",resp)});mlTimeSeriesSearchService.getChartDetails(selectedJob,detectorIndex,entityControls,searchBounds.min.valueOf(),searchBounds.max.valueOf()).then(resp=>{stateUpdate.chartDetails=resp.results;finish(counter)}).catch(resp=>{console.log("Time series explorer - error getting entity counts from elasticsearch:",resp)});if(selectedForecastId!==undefined){awaitingCount++;let aggType=undefined;const detector=selectedJob.analysis_config.detectors[detectorIndex];const esAgg=Object(job_utils["q"])(detector.function);if(modelPlotEnabled===false&&(esAgg==="sum"||esAgg==="count")){aggType={avg:"sum",max:"sum",min:"sum"}}forecast_service["a"].getForecastData(selectedJob,detectorIndex,selectedForecastId,nonBlankEntities,searchBounds.min.valueOf(),searchBounds.max.valueOf(),stateUpdate.contextAggregationInterval.asMilliseconds(),aggType).toPromise().then(resp=>{stateUpdate.contextForecastData=processForecastResults(resp.results);finish(counter)}).catch(resp=>{console.log(`Time series explorer - error loading data for forecast ID ${selectedForecastId}`,resp)})}})});timeseriesexplorer_defineProperty(this,"getControlsForDetector",()=>{const{selectedDetectorIndex:selectedDetectorIndex,selectedEntities:selectedEntities,selectedJobId:selectedJobId}=this.props;return getControlsForDetector(selectedDetectorIndex,selectedEntities,selectedJobId)})}getFocusAggregationInterval(selection){const{selectedJobId:selectedJobId}=this.props;const jobs=createTimeSeriesJobData(job_service["a"].jobs);const selectedJob=job_service["a"].getJob(selectedJobId);const bounds={min:external_kbnSharedDeps_MomentTimezone_default()(selection.from),max:external_kbnSharedDeps_MomentTimezone_default()(selection.to)};return calculateAggregationInterval(bounds,CHARTS_POINT_TARGET,jobs,selectedJob)}getFocusData(selection){const{selectedJobId:selectedJobId,selectedForecastId:selectedForecastId,selectedDetectorIndex:selectedDetectorIndex,functionDescription:functionDescription}=this.props;const{modelPlotEnabled:modelPlotEnabled}=this.state;const selectedJob=job_service["a"].getJob(selectedJobId);if(isMetricDetector(selectedJob,selectedDetectorIndex)&&functionDescription===undefined){return}const entityControls=this.getControlsForDetector();const bounds={min:external_kbnSharedDeps_MomentTimezone_default()(selection.from),max:external_kbnSharedDeps_MomentTimezone_default()(selection.to)};const focusAggregationInterval=this.getFocusAggregationInterval(selection);const searchBounds=Object(time_buckets["b"])(bounds,focusAggregationInterval,false);return getFocusData(this.getCriteriaFields(selectedDetectorIndex,entityControls),selectedDetectorIndex,focusAggregationInterval,selectedForecastId,modelPlotEnabled,entityControls.filter(entity=>entity.fieldValue!==null),searchBounds,selectedJob,functionDescription,timeseriesexplorer_constants_TIME_FIELD_NAME)}getCriteriaFields(detectorIndex,entities){const nonBlankEntities=entities.filter(entity=>entity.fieldValue!==null);return[{fieldName:"detector_index",fieldValue:detectorIndex},...nonBlankEntities]}loadForJobId(jobId){const{appStateHandler:appStateHandler,selectedDetectorIndex:selectedDetectorIndex}=this.props;const selectedJob=job_service["a"].getJob(jobId);if(selectedJob===undefined){return}const detectors=getViewableDetectors(selectedJob);const appStateDtrIdx=selectedDetectorIndex;let detectorIndex=appStateDtrIdx!==undefined?appStateDtrIdx:detectors[0].index;if(Object(external_kbnSharedDeps_Lodash_["find"])(detectors,{index:detectorIndex})===undefined){const warningText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.requestedDetectorIndexNotValidWarningMessage",{defaultMessage:"Requested detector index {detectorIndex} is not valid for job {jobId}",values:{detectorIndex:detectorIndex,jobId:selectedJob.job_id}});const toastNotifications=Object(dependency_cache["j"])();toastNotifications.addWarning(warningText);detectorIndex=detectors[0].index}const detectorId=detectorIndex;if(detectorId!==selectedDetectorIndex){appStateHandler(APP_STATE_ACTION.SET_DETECTOR_INDEX,detectorId)}field_format_service["a"].populateFormats([jobId]).catch(err=>{console.log("Error populating field formats:",err)})}componentDidMount(){const{invalidTimeRangeError:invalidTimeRangeError}=this.props;if(invalidTimeRangeError){const toastNotifications=Object(dependency_cache["j"])();toastNotifications.addWarning(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.invalidTimeRangeInUrlCallout",{defaultMessage:"The time filter was changed to the full range for this job due to an invalid default time filter. Check the advanced settings for {field}.",values:{field:constants_settings["a"]}}))}this.resizeChecker=new public_["ResizeChecker"](this.resizeRef.current);this.resizeChecker.on("resize",()=>{this.resizeHandler()});this.resizeHandler();this.subscriptions.add(this.contextChart$.pipe(Object(external_kbnSharedDeps_RxjsOperators_["tap"])(selection=>{this.setState({zoomFrom:selection.from,zoomTo:selection.to})}),Object(external_kbnSharedDeps_RxjsOperators_["debounceTime"])(500),Object(external_kbnSharedDeps_RxjsOperators_["tap"])(selection=>{const{contextChartData:contextChartData,contextForecastData:contextForecastData,focusChartData:focusChartData,zoomFromFocusLoaded:zoomFromFocusLoaded,zoomToFocusLoaded:zoomToFocusLoaded}=this.state;if((contextChartData===undefined||contextChartData.length===0)&&(contextForecastData===undefined||contextForecastData.length===0)){return}if(this.contextChartSelectedInitCallDone===false&&focusChartData===undefined||zoomFromFocusLoaded.getTime()!==selection.from.getTime()||zoomToFocusLoaded.getTime()!==selection.to.getTime()){this.contextChartSelectedInitCallDone=true;this.setState({loading:true,fullRefresh:false})}}),Object(external_kbnSharedDeps_RxjsOperators_["switchMap"])(selection=>{const{selectedJobId:selectedJobId}=this.props;const jobs=createTimeSeriesJobData(job_service["a"].jobs);const selectedJob=job_service["a"].getJob(selectedJobId);const bounds={min:external_kbnSharedDeps_MomentTimezone_default()(selection.from),max:external_kbnSharedDeps_MomentTimezone_default()(selection.to)};const focusAggregationInterval=calculateAggregationInterval(bounds,CHARTS_POINT_TARGET,jobs,selectedJob);const searchBounds=Object(time_buckets["b"])(bounds,focusAggregationInterval,false);return Object(external_kbnSharedDeps_Rxjs_["forkJoin"])([this.getFocusData(selection),this.loadAnomaliesTableData(searchBounds.min.valueOf(),searchBounds.max.valueOf())])}),Object(external_kbnSharedDeps_RxjsOperators_["withLatestFrom"])(this.contextChart$)).subscribe(([[refreshFocusData,tableData],selection])=>{const{modelPlotEnabled:modelPlotEnabled}=this.state;this.setState({focusAggregationInterval:this.getFocusAggregationInterval({from:selection.from,to:selection.to}),loading:false,showModelBoundsCheckbox:modelPlotEnabled&&refreshFocusData.focusChartData.length>0,zoomFromFocusLoaded:selection.from,zoomToFocusLoaded:selection.to,...refreshFocusData,...tableData})}));this.componentDidUpdate()}componentDidUpdate(previousProps){if(previousProps===undefined||previousProps.selectedJobId!==this.props.selectedJobId){this.contextChartSelectedInitCallDone=false;this.setState({fullRefresh:false,loading:true},()=>{this.loadForJobId(this.props.selectedJobId)})}if(previousProps===undefined||previousProps.selectedForecastId!==this.props.selectedForecastId){if(this.props.selectedForecastId!==undefined){this.setState({showForecast:true});if(previousProps!==undefined){this.previousSelectedForecastId=previousProps.selectedForecastId}}}if(previousProps===undefined||!Object(external_kbnSharedDeps_Lodash_["isEqual"])(previousProps.bounds,this.props.bounds)||!Object(external_kbnSharedDeps_Lodash_["isEqual"])(previousProps.lastRefresh,this.props.lastRefresh)||!Object(external_kbnSharedDeps_Lodash_["isEqual"])(previousProps.selectedDetectorIndex,this.props.selectedDetectorIndex)||!Object(external_kbnSharedDeps_Lodash_["isEqual"])(previousProps.selectedEntities,this.props.selectedEntities)||previousProps.selectedForecastId!==this.props.selectedForecastId||previousProps.selectedJobId!==this.props.selectedJobId||previousProps.functionDescription!==this.props.functionDescription){const fullRefresh=previousProps===undefined||!Object(external_kbnSharedDeps_Lodash_["isEqual"])(previousProps.bounds,this.props.bounds)||!Object(external_kbnSharedDeps_Lodash_["isEqual"])(previousProps.selectedDetectorIndex,this.props.selectedDetectorIndex)||!Object(external_kbnSharedDeps_Lodash_["isEqual"])(previousProps.selectedEntities,this.props.selectedEntities)||previousProps.selectedForecastId!==this.props.selectedForecastId||previousProps.selectedJobId!==this.props.selectedJobId||previousProps.functionDescription!==this.props.functionDescription;this.loadSingleMetricData(fullRefresh)}if(previousProps===undefined){return}const tableControlsListener=()=>{const{zoomFrom:zoomFrom,zoomTo:zoomTo}=this.state;if(zoomFrom!==undefined&&zoomTo!==undefined){this.loadAnomaliesTableData(zoomFrom.getTime(),zoomTo.getTime()).subscribe(res=>this.setState(res))}};if(previousProps.tableInterval!==this.props.tableInterval||previousProps.tableSeverity!==this.props.tableSeverity){tableControlsListener()}}componentWillUnmount(){this.subscriptions.unsubscribe();this.resizeChecker.destroy();this.unmounted=true}render(){const{autoZoomDuration:autoZoomDuration,bounds:bounds,dateFormatTz:dateFormatTz,lastRefresh:lastRefresh,selectedDetectorIndex:selectedDetectorIndex,selectedJobId:selectedJobId}=this.props;const{chartDetails:chartDetails,contextAggregationInterval:contextAggregationInterval,contextChartData:contextChartData,contextForecastData:contextForecastData,dataNotChartable:dataNotChartable,focusAggregationInterval:focusAggregationInterval,focusAnnotationError:focusAnnotationError,focusAnnotationData:focusAnnotationData,focusAggregations:focusAggregations,focusChartData:focusChartData,focusForecastData:focusForecastData,fullRefresh:fullRefresh,hasResults:hasResults,loading:loading,modelPlotEnabled:modelPlotEnabled,showAnnotations:showAnnotations,showAnnotationsCheckbox:showAnnotationsCheckbox,showForecast:showForecast,showForecastCheckbox:showForecastCheckbox,showModelBounds:showModelBounds,showModelBoundsCheckbox:showModelBoundsCheckbox,svgWidth:svgWidth,swimlaneData:swimlaneData,tableData:tableData,zoomFrom:zoomFrom,zoomTo:zoomTo,zoomFromFocusLoaded:zoomFromFocusLoaded,zoomToFocusLoaded:zoomToFocusLoaded}=this.state;const chartProps={modelPlotEnabled:modelPlotEnabled,contextChartData:contextChartData,contextChartSelected:this.contextChartSelected,contextForecastData:contextForecastData,contextAggregationInterval:contextAggregationInterval,swimlaneData:swimlaneData,focusAnnotationData:focusAnnotationData,focusChartData:focusChartData,focusForecastData:focusForecastData,focusAggregationInterval:focusAggregationInterval,svgWidth:svgWidth,zoomFrom:zoomFrom,zoomTo:zoomTo,zoomFromFocusLoaded:zoomFromFocusLoaded,zoomToFocusLoaded:zoomToFocusLoaded,autoZoomDuration:autoZoomDuration};const jobs=createTimeSeriesJobData(job_service["a"].jobs);if(selectedDetectorIndex===undefined||job_service["a"].getJob(selectedJobId)===undefined){return external_kbnSharedDeps_React_default.a.createElement(TimeSeriesExplorerPage,{dateFormatTz:dateFormatTz,resizeRef:this.resizeRef})}const selectedJob=job_service["a"].getJob(selectedJobId);const entityControls=this.getControlsForDetector();const fieldNamesWithEmptyValues=this.getFieldNamesWithEmptyValues();const arePartitioningFieldsProvided=this.arePartitioningFieldsProvided();const detectors=getViewableDetectors(selectedJob);let renderFocusChartOnly=true;if(Object(external_kbnSharedDeps_Lodash_["isEqual"])(this.previousChartProps.focusForecastData,chartProps.focusForecastData)&&Object(external_kbnSharedDeps_Lodash_["isEqual"])(this.previousChartProps.focusChartData,chartProps.focusChartData)&&Object(external_kbnSharedDeps_Lodash_["isEqual"])(this.previousChartProps.focusAnnotationData,chartProps.focusAnnotationData)&&this.previousShowForecast===showForecast&&this.previousShowModelBounds===showModelBounds&&this.props.previousRefresh===lastRefresh){renderFocusChartOnly=false}this.previousChartProps=chartProps;this.previousShowForecast=showForecast;this.previousShowModelBounds=showModelBounds;return external_kbnSharedDeps_React_default.a.createElement(TimeSeriesExplorerPage,{dateFormatTz:dateFormatTz,resizeRef:this.resizeRef},fieldNamesWithEmptyValues.length>0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.timeSeriesExplorer.singleMetricRequiredMessage",defaultMessage:"To view a single metric, select {missingValuesCount, plural, one {a value for {fieldName1}} other {values for {fieldName1} and {fieldName2}}}.",values:{missingValuesCount:fieldNamesWithEmptyValues.length,fieldName1:fieldNamesWithEmptyValues[0],fieldName2:fieldNamesWithEmptyValues[1]}}),iconType:"help",size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"})),external_kbnSharedDeps_React_default.a.createElement(SeriesControls,{selectedJobId:selectedJobId,appStateHandler:this.props.appStateHandler,selectedDetectorIndex:selectedDetectorIndex,selectedEntities:this.props.selectedEntities,bounds:bounds,functionDescription:this.props.functionDescription,setFunctionDescription:this.setFunctionDescription},arePartitioningFieldsProvided&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{style:{textAlign:"right"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{hasEmptyLabelSpace:true,style:{maxWidth:"100%"}},external_kbnSharedDeps_React_default.a.createElement(ForecastingModal,{job:selectedJob,detectorIndex:selectedDetectorIndex,entities:entityControls,setForecastId:this.setForecastId,className:"forecast-controls"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),fullRefresh&&loading===true&&external_kbnSharedDeps_React_default.a.createElement(loading_indicator_LoadingIndicator,{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.loadingLabel",{defaultMessage:"Loading"})}),arePartitioningFieldsProvided&&jobs.length>0&&(fullRefresh===false||loading===false)&&hasResults===false&&external_kbnSharedDeps_React_default.a.createElement(TimeseriesexplorerNoChartData,{dataNotChartable:dataNotChartable,entities:entityControls}),arePartitioningFieldsProvided&&jobs.length>0&&(fullRefresh===false||loading===false)&&hasResults===true&&external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement("div",{className:"results-container"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{className:"panel-title"},external_kbnSharedDeps_React_default.a.createElement("h2",{style:{display:"inline"}},external_kbnSharedDeps_React_default.a.createElement("span",null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.singleTimeSeriesAnalysisTitle",{defaultMessage:"Single time series analysis of {functionLabel}",values:{functionLabel:chartDetails.functionLabel}}))," ",chartDetails.entityData.count===1&&external_kbnSharedDeps_React_default.a.createElement("span",{className:"entity-count-text"},chartDetails.entityData.entities.length>0&&"(",chartDetails.entityData.entities.map(entity=>`${entity.fieldName}: ${entity.fieldValue}`).join(", "),chartDetails.entityData.entities.length>0&&")"),chartDetails.entityData.count!==1&&external_kbnSharedDeps_React_default.a.createElement("span",{className:"entity-count-text"},chartDetails.entityData.entities.map((countData,i)=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],{key:countData.fieldName},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.countDataInChartDetailsDescription",{defaultMessage:"{openBrace}{cardinalityValue} distinct {fieldName} {cardinality, plural, one {} other { values}}{closeBrace}",values:{openBrace:i===0?"(":"",closeBrace:i===chartDetails.entityData.entities.length-1?")":"",cardinalityValue:countData.cardinality===0?allValuesLabel:countData.cardinality,cardinality:countData.cardinality,fieldName:countData.fieldName}}),i!==chartDetails.entityData.entities.length-1?", ":""))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{style:{float:"right"}},showModelBoundsCheckbox&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCheckbox"],{id:"toggleModelBoundsCheckbox",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.showModelBoundsLabel",{defaultMessage:"show model bounds"}),checked:showModelBounds,onChange:this.toggleShowModelBoundsHandler})),showAnnotationsCheckbox&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCheckbox"],{id:"toggleAnnotationsCheckbox",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.annotationsLabel",{defaultMessage:"annotations"}),checked:showAnnotations,onChange:this.toggleShowAnnotationsHandler})),showForecastCheckbox&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCheckbox"],{id:"toggleShowForecastCheckbox",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.showForecastLabel",{defaultMessage:"show forecast"}),checked:showForecast,onChange:this.toggleShowForecastHandler}))),external_kbnSharedDeps_React_default.a.createElement(TimeSeriesChartWithTooltips,{chartProps:chartProps,contextAggregationInterval:contextAggregationInterval,bounds:bounds,detectorIndex:selectedDetectorIndex,renderFocusChartOnly:renderFocusChartOnly,selectedJob:selectedJob,selectedEntities:this.props.selectedEntities,showAnnotations:showAnnotations,showForecast:showForecast,showModelBounds:showModelBounds,lastRefresh:lastRefresh}),focusAnnotationError!==undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{className:"panel-title","data-test-subj":"mlAnomalyExplorerAnnotations error"},external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.timeSeriesExplorer.annotationsErrorTitle",defaultMessage:"Annotations"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.annotationsErrorCallOutTitle",{defaultMessage:"An error occurred loading annotations:"}),color:"danger",iconType:"alert"},external_kbnSharedDeps_React_default.a.createElement("p",null,focusAnnotationError))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"})),focusAnnotationData&&focusAnnotationData.length>0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiAccordion"],{id:"EuiAccordion-blah",buttonContent:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{className:"panel-title"},external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.timeSeriesExplorer.annotationsTitle",defaultMessage:"Annotations {badge}",values:{badge:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBadge"],{color:"hollow"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.annotationsTitleTotalCount",defaultMessage:"Total: {count}",values:{count:focusAnnotationData.length}}))}}))),"data-test-subj":"mlAnomalyExplorerAnnotations loaded"},external_kbnSharedDeps_React_default.a.createElement(annotations_table["a"],{chartDetails:chartDetails,detectorIndex:selectedDetectorIndex,detectors:detectors,jobIds:[this.props.selectedJobId],annotations:focusAnnotationData,aggregations:focusAggregations,isSingleMetricViewerLinkVisible:false,isNumberBadgeVisible:true}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"})),external_kbnSharedDeps_React_default.a.createElement(annotation_flyout["a"],{chartDetails:chartDetails,detectorIndex:selectedDetectorIndex,detectors:detectors}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{className:"panel-title"},external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.timeSeriesExplorer.anomaliesTitle",defaultMessage:"Anomalies"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"row",gutterSize:"l",responsive:true,className:"ml-anomalies-controls"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:{width:"170px"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.severityThresholdLabel",{defaultMessage:"Severity threshold"})},external_kbnSharedDeps_React_default.a.createElement(select_severity["b"],null))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:{width:"170px"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.intervalLabel",{defaultMessage:"Interval"})},external_kbnSharedDeps_React_default.a.createElement(SelectInterval,null)))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}))),arePartitioningFieldsProvided&&jobs.length>0&&hasResults===true&&external_kbnSharedDeps_React_default.a.createElement(AnomaliesTable,{bounds:bounds,tableData:tableData,filter:this.tableFilter}))}}const TimeseriesexplorerNoJobsFound=()=>{const mlUrlGenerator=Object(contexts_kibana["d"])();const navigateToPath=Object(contexts_kibana["e"])();const redirectToJobsManagementPage=async()=>{const path=await mlUrlGenerator.createUrl({page:ml_url_generator["b"].ANOMALY_DETECTION_JOBS_MANAGE});await navigateToPath(path,true)};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiEmptyPrompt"],{"data-test-subj":"mlNoSingleMetricJobsFound",iconType:"alert",title:external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.timeSeriesExplorer.noSingleMetricJobsFoundLabel",defaultMessage:"No single metric jobs found"})),actions:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{color:"primary",fill:true,onClick:redirectToJobsManagementPage},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.timeSeriesExplorer.createNewSingleMetricJobLinkText",defaultMessage:"Create new single metric job"}))})};const useRefresh=()=>{const timefilter=Object(contexts_kibana["g"])();const refresh$=Object(external_kbnSharedDeps_React_["useMemo"])(()=>Object(external_kbnSharedDeps_Rxjs_["merge"])(timefilter_refresh_service["a"],timefilter.getTimeUpdate$().pipe(Object(external_kbnSharedDeps_RxjsOperators_["map"])(()=>{const{from:from,to:to}=timefilter.getTime();return{lastRefresh:Date.now(),timeRange:{start:from,end:to}}})),annotations_service["b"].pipe(Object(external_kbnSharedDeps_RxjsOperators_["map"])(d=>({lastRefresh:d})))),[]);return useObservable_default()(refresh$)};function useTimeSeriesExplorerUrlState(){return Object(url_state["b"])(ml_url_generator["b"].SINGLE_METRIC_VIEWER)}function timeseriesexplorer_extends(){timeseriesexplorer_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return timeseriesexplorer_extends.apply(this,arguments)}const timeSeriesExplorerRouteFactory=(navigateToPath,basePath)=>({path:"/timeseriesexplorer",render:(props,deps)=>external_kbnSharedDeps_React_default.a.createElement(timeseriesexplorer_PageWrapper,timeseriesexplorer_extends({},props,{deps:deps})),breadcrumbs:[getBreadcrumbWithUrlForApp("ML_BREADCRUMB",navigateToPath,basePath),getBreadcrumbWithUrlForApp("ANOMALY_DETECTION_BREADCRUMB",navigateToPath,basePath),{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomalyDetection.singleMetricViewerLabel",{defaultMessage:"Single Metric Viewer"}),href:""}]});const timeseriesexplorer_PageWrapper=({deps:deps})=>{const{context:context,results:results}=useResolver(undefined,undefined,deps.config,{...basicResolvers(deps),jobs:job_service["a"].loadJobsWrapper,jobsWithTimeRange:()=>ml_api_service["ml"].jobs.jobsWithTimerange(getDateFormatTz())});const annotationUpdatesService=Object(external_kbnSharedDeps_React_["useMemo"])(()=>new annotations_service["a"],[]);return external_kbnSharedDeps_React_default.a.createElement(PageLoader,{context:context},external_kbnSharedDeps_React_default.a.createElement(ml_annotation_updates_context["a"].Provider,{value:annotationUpdatesService},external_kbnSharedDeps_React_default.a.createElement(TimeSeriesExplorerUrlStateManager,{config:deps.config,jobsWithTimeRange:results.jobsWithTimeRange.jobs})))};const TimeSeriesExplorerUrlStateManager=({config:config,jobsWithTimeRange:jobsWithTimeRange})=>{var _globalState$time,_globalState$time2,_globalState$ml,_timeSeriesExplorerUr,_timeSeriesExplorerUr2,_timeSeriesExplorerUr3,_timeSeriesExplorerUr4,_timeSeriesExplorerUr5,_timeSeriesExplorerUr6,_bounds$min,_bounds$max,_timeSeriesExplorerUr8;const{toasts:toasts}=Object(contexts_kibana["f"])();const toastNotificationService=Object(toast_notification_service["c"])();const[timeSeriesExplorerUrlState,setTimeSeriesExplorerUrlState]=useTimeSeriesExplorerUrlState();const[globalState,setGlobalState]=Object(url_state["c"])("_g");const[lastRefresh,setLastRefresh]=Object(external_kbnSharedDeps_React_["useState"])(0);const previousRefresh=usePrevious_default()(lastRefresh);const[selectedJobId,setSelectedJobId]=Object(external_kbnSharedDeps_React_["useState"])();const timefilter=Object(contexts_kibana["g"])({timeRangeSelector:true,autoRefreshSelector:true});const[invalidTimeRangeError,setInValidTimeRangeError]=Object(external_kbnSharedDeps_React_["useState"])(false);const refresh=useRefresh();Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(refresh!==undefined&&refresh.lastRefresh!==lastRefresh){setLastRefresh(refresh===null||refresh===void 0?void 0:refresh.lastRefresh);if(refresh.timeRange!==undefined){const{start:start,end:end}=refresh.timeRange;setGlobalState("time",{from:start,to:end})}}},[refresh===null||refresh===void 0?void 0:refresh.lastRefresh,lastRefresh,setGlobalState]);const[bounds,setBounds]=Object(external_kbnSharedDeps_React_["useState"])(undefined);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if((globalState===null||globalState===void 0?void 0:globalState.time)!==undefined){if(globalState.time.mode==="invalid"){setInValidTimeRangeError(true)}timefilter.setTime({from:globalState.time.from,to:globalState.time.to});const timefilterBounds=timefilter.getBounds();if((timefilterBounds===null||timefilterBounds===void 0?void 0:timefilterBounds.min)!==undefined&&(timefilterBounds===null||timefilterBounds===void 0?void 0:timefilterBounds.max)!==undefined){setBounds(timefilter.getBounds())}}},[globalState===null||globalState===void 0?void 0:(_globalState$time=globalState.time)===null||_globalState$time===void 0?void 0:_globalState$time.from,globalState===null||globalState===void 0?void 0:(_globalState$time2=globalState.time)===null||_globalState$time2===void 0?void 0:_globalState$time2.to]);const selectedJobIds=globalState===null||globalState===void 0?void 0:(_globalState$ml=globalState.ml)===null||_globalState$ml===void 0?void 0:_globalState$ml.jobIds;if(Array.isArray(selectedJobIds)){selectedJobIds.sort()}const previousSelectedJobIds=usePrevious_default()(selectedJobIds);const isJobChange=!Object(external_kbnSharedDeps_Lodash_["isEqual"])(previousSelectedJobIds,selectedJobIds);const selectedDetectorIndex=isJobChange?0:(_timeSeriesExplorerUr=timeSeriesExplorerUrlState===null||timeSeriesExplorerUrlState===void 0?void 0:(_timeSeriesExplorerUr2=timeSeriesExplorerUrlState.mlTimeSeriesExplorer)===null||_timeSeriesExplorerUr2===void 0?void 0:_timeSeriesExplorerUr2.detectorIndex)!==null&&_timeSeriesExplorerUr!==void 0?_timeSeriesExplorerUr:0;const selectedEntities=isJobChange?undefined:timeSeriesExplorerUrlState===null||timeSeriesExplorerUrlState===void 0?void 0:(_timeSeriesExplorerUr3=timeSeriesExplorerUrlState.mlTimeSeriesExplorer)===null||_timeSeriesExplorerUr3===void 0?void 0:_timeSeriesExplorerUr3.entities;const selectedForecastId=isJobChange?undefined:timeSeriesExplorerUrlState===null||timeSeriesExplorerUrlState===void 0?void 0:(_timeSeriesExplorerUr4=timeSeriesExplorerUrlState.mlTimeSeriesExplorer)===null||_timeSeriesExplorerUr4===void 0?void 0:_timeSeriesExplorerUr4.forecastId;const selectedFunctionDescription=isJobChange?undefined:timeSeriesExplorerUrlState===null||timeSeriesExplorerUrlState===void 0?void 0:(_timeSeriesExplorerUr5=timeSeriesExplorerUrlState.mlTimeSeriesExplorer)===null||_timeSeriesExplorerUr5===void 0?void 0:_timeSeriesExplorerUr5.functionDescription;const zoom=isJobChange?undefined:timeSeriesExplorerUrlState===null||timeSeriesExplorerUrlState===void 0?void 0:(_timeSeriesExplorerUr6=timeSeriesExplorerUrlState.mlTimeSeriesExplorer)===null||_timeSeriesExplorerUr6===void 0?void 0:_timeSeriesExplorerUr6.zoom;const selectedJob=selectedJobId!==undefined?job_service["a"].getJob(selectedJobId):undefined;const timeSeriesJobs=createTimeSeriesJobData(job_service["a"].jobs);let autoZoomDuration;if(selectedJobId!==undefined&&selectedJob!==undefined){autoZoomDuration=getAutoZoomDuration(timeSeriesJobs,selectedJob)}const appStateHandler=Object(external_kbnSharedDeps_React_["useCallback"])((action,payload)=>{var _timeSeriesExplorerUr7;const isInitUpdate=(timeSeriesExplorerUrlState===null||timeSeriesExplorerUrlState===void 0?void 0:(_timeSeriesExplorerUr7=timeSeriesExplorerUrlState.mlTimeSeriesExplorer)===null||_timeSeriesExplorerUr7===void 0?void 0:_timeSeriesExplorerUr7.zoom)===undefined;const mlTimeSeriesExplorer=(timeSeriesExplorerUrlState===null||timeSeriesExplorerUrlState===void 0?void 0:timeSeriesExplorerUrlState.mlTimeSeriesExplorer)!==undefined?{...timeSeriesExplorerUrlState.mlTimeSeriesExplorer}:{};switch(action){case APP_STATE_ACTION.CLEAR:delete mlTimeSeriesExplorer.detectorIndex;delete mlTimeSeriesExplorer.entities;delete mlTimeSeriesExplorer.forecastId;delete mlTimeSeriesExplorer.zoom;delete mlTimeSeriesExplorer.functionDescription;break;case APP_STATE_ACTION.SET_DETECTOR_INDEX:mlTimeSeriesExplorer.detectorIndex=payload;delete mlTimeSeriesExplorer.functionDescription;break;case APP_STATE_ACTION.SET_ENTITIES:mlTimeSeriesExplorer.entities=payload;delete mlTimeSeriesExplorer.functionDescription;break;case APP_STATE_ACTION.SET_FORECAST_ID:mlTimeSeriesExplorer.forecastId=payload;delete mlTimeSeriesExplorer.zoom;break;case APP_STATE_ACTION.SET_ZOOM:mlTimeSeriesExplorer.zoom=payload;break;case APP_STATE_ACTION.UNSET_ZOOM:delete mlTimeSeriesExplorer.zoom;break;case APP_STATE_ACTION.SET_FUNCTION_DESCRIPTION:mlTimeSeriesExplorer.functionDescription=payload;break}setTimeSeriesExplorerUrlState({mlTimeSeriesExplorer:mlTimeSeriesExplorer},isInitUpdate)},[JSON.stringify(timeSeriesExplorerUrlState===null||timeSeriesExplorerUrlState===void 0?void 0:timeSeriesExplorerUrlState.mlTimeSeriesExplorer),setTimeSeriesExplorerUrlState]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(selectedJobIds!==undefined&&previousSelectedJobIds!==undefined){setLastRefresh(Date.now());appStateHandler(APP_STATE_ACTION.CLEAR)}const validatedJobId=validateJobSelection(jobsWithTimeRange,selectedJobIds,setGlobalState,toasts);if(typeof validatedJobId==="string"){setSelectedJobId(validatedJobId)}},[JSON.stringify(selectedJobIds)]);const boundsMinMs=bounds===null||bounds===void 0?void 0:(_bounds$min=bounds.min)===null||_bounds$min===void 0?void 0:_bounds$min.valueOf();const boundsMaxMs=bounds===null||bounds===void 0?void 0:(_bounds$max=bounds.max)===null||_bounds$max===void 0?void 0:_bounds$max.valueOf();const[selectedForecastIdProp,setSelectedForecastIdProp]=Object(external_kbnSharedDeps_React_["useState"])(timeSeriesExplorerUrlState===null||timeSeriesExplorerUrlState===void 0?void 0:(_timeSeriesExplorerUr8=timeSeriesExplorerUrlState.mlTimeSeriesExplorer)===null||_timeSeriesExplorerUr8===void 0?void 0:_timeSeriesExplorerUr8.forecastId);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(autoZoomDuration!==undefined&&boundsMinMs!==undefined&&boundsMaxMs!==undefined&&selectedJob!==undefined&&selectedForecastId!==undefined){if(selectedForecastIdProp!==selectedForecastId){setSelectedForecastIdProp(undefined)}forecast_service["a"].getForecastDateRange(selectedJob,selectedForecastId).then(resp=>{if(autoZoomDuration===undefined){return}const earliest=external_kbnSharedDeps_Moment_default()(resp.earliest||boundsMinMs);const latest=external_kbnSharedDeps_Moment_default()(resp.latest||boundsMaxMs);if(earliest.isBefore(external_kbnSharedDeps_Moment_default()(boundsMinMs))||latest.isAfter(external_kbnSharedDeps_Moment_default()(boundsMaxMs))){const earliestMs=Math.min(earliest.valueOf(),boundsMinMs);const latestMs=Math.max(latest.valueOf(),boundsMaxMs);setGlobalState("time",{from:external_kbnSharedDeps_Moment_default()(earliestMs).toISOString(),to:external_kbnSharedDeps_Moment_default()(latestMs).toISOString()})}setSelectedForecastIdProp(selectedForecastId)}).catch(resp=>{console.error("Time series explorer - error loading time range of forecast from elasticsearch:",resp)})}},[selectedForecastId]);const[tableInterval]=useTableInterval();const[tableSeverity]=Object(select_severity["c"])();const tzConfig=config.get("dateFormat:tz");const dateFormatTz=tzConfig!=="Browser"?tzConfig:external_kbnSharedDeps_Moment_default.a.tz.guess();if(timeSeriesJobs.length===0){return external_kbnSharedDeps_React_default.a.createElement(TimeSeriesExplorerPage,{dateFormatTz:dateFormatTz},external_kbnSharedDeps_React_default.a.createElement(TimeseriesexplorerNoJobsFound,null))}if(selectedJobId===undefined||autoZoomDuration===undefined||bounds===undefined){return null}const zoomProp=typeof selectedForecastId==="string"&&selectedForecastIdProp===undefined?undefined:zoom;return external_kbnSharedDeps_React_default.a.createElement(timeseriesexplorer_TimeSeriesExplorer,{toastNotificationService:toastNotificationService,appStateHandler:appStateHandler,autoZoomDuration:autoZoomDuration,bounds:bounds,dateFormatTz:dateFormatTz,lastRefresh:lastRefresh,previousRefresh:previousRefresh,selectedJobId:selectedJobId,selectedDetectorIndex:selectedDetectorIndex,selectedEntities:selectedEntities,selectedForecastId:selectedForecastIdProp,tableInterval:tableInterval.val,tableSeverity:tableSeverity.val,timefilter:timefilter,zoom:zoomProp,invalidTimeRangeError:invalidTimeRangeError,functionDescription:selectedFunctionDescription})};const ExplorerNoInfluencersFound=({viewBySwimlaneFieldName:viewBySwimlaneFieldName,showFilterMessage:showFilterMessage=false})=>showFilterMessage===false?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.noInfluencersFoundTitle",defaultMessage:"No {viewBySwimlaneFieldName} influencers found",values:{viewBySwimlaneFieldName:viewBySwimlaneFieldName}}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.noInfluencersFoundTitleFilterMessage",defaultMessage:"No {viewBySwimlaneFieldName} influencers found for specified filter",values:{viewBySwimlaneFieldName:viewBySwimlaneFieldName}});const ExplorerNoJobsFound=()=>{const ADJobsManagementUrl=Object(use_create_url["b"])({page:ml_url_generator["b"].ANOMALY_DETECTION_JOBS_MANAGE,excludeBasePath:true});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiEmptyPrompt"],{iconType:"alert",title:external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.noJobsFoundLabel",defaultMessage:"No jobs found"})),actions:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ReactRouterDom_["Link"],{to:ADJobsManagementUrl},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{color:"primary",fill:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.createNewJobLinkText",defaultMessage:"Create job"}))),"data-test-subj":"mlNoJobsFound"})};const ExplorerNoResultsFound=({hasResults:hasResults,selectedJobsRunning:selectedJobsRunning})=>{const resultsHaveNoAnomalies=hasResults===true;const noResults=hasResults===false;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiEmptyPrompt"],{iconType:"iInCircle",title:external_kbnSharedDeps_React_default.a.createElement("h2",null,resultsHaveNoAnomalies&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.noAnomaliesFoundLabel",defaultMessage:"No anomalies found"}),noResults&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.noResultsFoundLabel",defaultMessage:"No results found"})),body:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,selectedJobsRunning&&noResults&&external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.selectedJobsRunningLabel",defaultMessage:"One or more selected jobs are still running and results may not be available yet."})),!selectedJobsRunning&&external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.tryWideningTimeSelectionLabel",defaultMessage:"Try widening the time selection or moving further back in time"})))})};function abbreviateWholeNumber(value,maxDigits=3){if(Math.abs(value)<Math.pow(10,maxDigits)){return value}else{return external_kbnSharedDeps_ElasticNumeral_default()(value).format("0a")}}function getTooltipContent(maxScoreLabel,totalScoreLabel){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.influencersList.maxAnomalyScoreTooltipDescription",defaultMessage:"Maximum anomaly score: {maxScoreLabel}",values:{maxScoreLabel:maxScoreLabel}})),external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.influencersList.totalAnomalyScoreTooltipDescription",defaultMessage:"Total anomaly score: {totalScoreLabel}",values:{totalScoreLabel:totalScoreLabel}})))}const Influencer=({influencerFieldName:influencerFieldName,influencerFilter:influencerFilter,valueData:valueData})=>{const maxScore=Math.floor(valueData.maxAnomalyScore);const maxScoreLabel=Object(anomaly_utils["f"])(valueData.maxAnomalyScore);const severity=Object(anomaly_utils["h"])(maxScore);const totalScore=Math.floor(valueData.sumAnomalyScore);const totalScoreLabel=Object(anomaly_utils["f"])(valueData.sumAnomalyScore);const barScore=maxScore!==0?maxScore:1;const barStyle={width:`${barScore}%`};const tooltipContent=getTooltipContent(maxScoreLabel,totalScoreLabel);return external_kbnSharedDeps_React_default.a.createElement("div",{"data-test-subj":`mlInfluencerEntry field-${influencerFieldName}`},external_kbnSharedDeps_React_default.a.createElement("div",{className:"field-label","data-test-subj":"mlInfluencerEntryFieldLabel"},external_kbnSharedDeps_React_default.a.createElement(EntityCell,{entityName:influencerFieldName,entityValue:valueData.influencerFieldValue,filter:influencerFilter})),external_kbnSharedDeps_React_default.a.createElement("div",{className:`progress ${severity.id}`},external_kbnSharedDeps_React_default.a.createElement("div",{className:"progress-bar-holder"},external_kbnSharedDeps_React_default.a.createElement("div",{className:"progress-bar",style:barStyle})),external_kbnSharedDeps_React_default.a.createElement("div",{className:"score-label"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{position:"right",className:"ml-influencers-list-tooltip",title:`${influencerFieldName}: ${valueData.influencerFieldValue}`,content:tooltipContent},external_kbnSharedDeps_React_default.a.createElement("span",null,maxScoreLabel)))),external_kbnSharedDeps_React_default.a.createElement("div",{className:"total-score-label"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{position:"right",className:"ml-influencers-list-tooltip",title:`${influencerFieldName}: ${valueData.influencerFieldValue}`,content:tooltipContent},external_kbnSharedDeps_React_default.a.createElement("span",null,totalScore>0?abbreviateWholeNumber(totalScore,4):totalScoreLabel))))};const InfluencersByName=({influencerFieldName:influencerFieldName,influencerFilter:influencerFilter,fieldValues:fieldValues})=>{const influencerValues=fieldValues.map(valueData=>external_kbnSharedDeps_React_default.a.createElement(Influencer,{key:valueData.influencerFieldValue,influencerFieldName:influencerFieldName,influencerFilter:influencerFilter,valueData:valueData}));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,{key:influencerFieldName},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs","data-test-subj":`mlInfluencerFieldName ${influencerFieldName}`},external_kbnSharedDeps_React_default.a.createElement("h3",null,influencerFieldName)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xs"}),influencerValues)};const InfluencersList=({influencers:influencers,influencerFilter:influencerFilter})=>{if(influencers===undefined||Object.keys(influencers).length===0){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceAround",className:"ml-influencers-list"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"xxl"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs",className:"influencer-title"},external_kbnSharedDeps_React_default.a.createElement("h3",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.influencersList.noInfluencersFoundTitle",defaultMessage:"No influencers found"})))))}const influencersByName=Object.keys(influencers).map(influencerFieldName=>external_kbnSharedDeps_React_default.a.createElement(InfluencersByName,{key:influencerFieldName,influencerFieldName:influencerFieldName,influencerFilter:influencerFilter,fieldValues:influencers[influencerFieldName]}));return external_kbnSharedDeps_React_default.a.createElement("div",{className:"ml-influencers-list"},influencersByName)};function jobSelectionActionCreator(selectedJobIds){return Object(external_kbnSharedDeps_Rxjs_["from"])(field_format_service["a"].populateFormats(selectedJobIds)).pipe(Object(external_kbnSharedDeps_RxjsOperators_["map"])(resp=>{if(resp.err){console.log("Error populating field formats:",resp.err);return null}const jobs=createJobs(job_service["a"].jobs).map(job=>{job.selected=selectedJobIds.some(id=>job.id===id);return job});const selectedJobs=jobs.filter(job=>job.selected);return{type:explorer_constants["c"].JOB_SELECTION_CHANGE,payload:{loading:false,selectedJobs:selectedJobs}}}))}function buildConfig(record){const job=job_service["a"].getJob(record.job_id);const detectorIndex=record.detector_index;const config=buildConfigFromDetector(job,detectorIndex);config.functionDescription=record.function_description;config.bucketSpanSeconds=Object(parse_interval["a"])(job.analysis_config.bucket_span).asSeconds();config.detectorLabel=record.function;if(job_service["a"].detectorsByJob[record.job_id]!==undefined&&detectorIndex<job_service["a"].detectorsByJob[record.job_id].length){config.detectorLabel=job_service["a"].detectorsByJob[record.job_id][detectorIndex].detector_description}else{if(record.field_name!==undefined){config.detectorLabel+=` ${config.fieldName}`}}if(record.field_name!==undefined){config.fieldName=record.field_name;config.metricFieldName=record.field_name}config.entityFields=Object(anomaly_utils["c"])(record);if(record.function===aggregation_types["b"].METRIC){config.metricFunction=Object(job_utils["q"])(record.function_description)}let functionLabel=config.metricFunction;if(config.metricFieldName!==undefined){functionLabel+=` ${config.metricFieldName}`}config.infoTooltip={jobId:record.job_id,aggregationInterval:config.interval,chartFunction:functionLabel,entityFields:config.entityFields.map(f=>({fieldName:f.fieldName,fieldValue:f.fieldValue}))};return config}var swimlane_container=__webpack_require__(154);function getDefaultChartsData(){return{chartsPerRow:1,errorMessages:undefined,seriesToPlot:[],tooManyBuckets:false,timeFieldName:"timestamp"}}const CHART_MAX_POINTS=500;const ANOMALIES_MAX_RESULTS=500;const explorer_charts_container_service_MAX_SCHEDULED_EVENTS=10;const ML_TIME_FIELD_NAME="timestamp";const USE_OVERALL_CHART_LIMITS=false;const MAX_CHARTS_PER_ROW=4;const anomalyDataChange=function(chartsContainerWidth,anomalyRecords,selectedEarliestMs,selectedLatestMs,severity=0){const data=getDefaultChartsData();const containerWith=chartsContainerWidth+swimlane_container["a"];const filteredRecords=anomalyRecords.filter(record=>Number(record.record_score)>=severity);const[allSeriesRecords,errorMessages]=processRecordsForDisplay(filteredRecords);let chartsPerRow=Math.min(Math.max(Math.floor(containerWith/550),1),MAX_CHARTS_PER_ROW);if(allSeriesRecords.length===1){chartsPerRow=1}data.chartsPerRow=chartsPerRow;const maxSeriesToPlot=Math.max(chartsPerRow*2,6);const recordsToPlot=allSeriesRecords.slice(0,maxSeriesToPlot);const hasGeoData=recordsToPlot.find(record=>(record.function_description||recordsToPlot.function)===aggregation_types["b"].LAT_LONG);const seriesConfigs=recordsToPlot.map(buildConfig);const seriesConfigsNoGeoData=[];data.seriesToPlot=seriesConfigs.map(config=>({...config,loading:true,chartData:null}));const mapData=[];if(hasGeoData!==undefined){for(let i=0;i<seriesConfigs.length;i++){const config=seriesConfigs[i];let records;if(config.detectorLabel.includes(aggregation_types["b"].LAT_LONG)){if(config.entityFields.length){records=[recordsToPlot.find(record=>{const entityFieldName=config.entityFields[0].fieldName;const entityFieldValue=config.entityFields[0].fieldValue;return(record[entityFieldName]&&record[entityFieldName][0])===entityFieldValue})]}else{records=recordsToPlot}mapData.push({...config,loading:false,mapData:records})}else{seriesConfigsNoGeoData.push(config)}}}data.tooManyBuckets=false;const chartWidth=Math.floor(containerWith/chartsPerRow);const{chartRange:chartRange,tooManyBuckets:tooManyBuckets}=calculateChartRange(seriesConfigs,selectedEarliestMs,selectedLatestMs,chartWidth,recordsToPlot,data.timeFieldName);data.tooManyBuckets=tooManyBuckets;data.errorMessages=errorMessages;explorerService.setCharts({...data});if(seriesConfigs.length===0){return data}function getMetricData(config,range){const{jobId:jobId,detectorIndex:detectorIndex,entityFields:entityFields,bucketSpanSeconds:bucketSpanSeconds}=config;const job=job_service["a"].getJob(jobId);const useSourceData=Object(job_utils["n"])(job,detectorIndex);if(useSourceData===true){const datafeedQuery=Object(external_kbnSharedDeps_Lodash_["get"])(config,"datafeedConfig.query",null);return results_service["mlResultsService"].getMetricData(config.datafeedConfig.indices,entityFields,datafeedQuery,config.metricFunction,config.metricFieldName,config.summaryCountFieldName,config.timeField,range.min,range.max,bucketSpanSeconds*1e3,config.datafeedConfig).toPromise()}else{const criteriaFields=[];const detector=job.analysis_config.detectors[detectorIndex];if(detector.partition_field_name!==undefined){const partitionEntity=Object(external_kbnSharedDeps_Lodash_["find"])(entityFields,{fieldName:detector.partition_field_name});if(partitionEntity!==undefined){criteriaFields.push({fieldName:"partition_field_name",fieldValue:partitionEntity.fieldName},{fieldName:"partition_field_value",fieldValue:partitionEntity.fieldValue})}}if(detector.over_field_name!==undefined){const overEntity=Object(external_kbnSharedDeps_Lodash_["find"])(entityFields,{fieldName:detector.over_field_name});if(overEntity!==undefined){criteriaFields.push({fieldName:"over_field_name",fieldValue:overEntity.fieldName},{fieldName:"over_field_value",fieldValue:overEntity.fieldValue})}}if(detector.by_field_name!==undefined){const byEntity=Object(external_kbnSharedDeps_Lodash_["find"])(entityFields,{fieldName:detector.by_field_name});if(byEntity!==undefined){criteriaFields.push({fieldName:"by_field_name",fieldValue:byEntity.fieldName},{fieldName:"by_field_value",fieldValue:byEntity.fieldValue})}}return new Promise((resolve,reject)=>{const obj={success:true,results:{}};return results_service["mlResultsService"].getModelPlotOutput(jobId,detectorIndex,criteriaFields,range.min,range.max,bucketSpanSeconds*1e3).toPromise().then(resp=>{const results=resp.results;Object.keys(results).forEach(time=>{obj.results[time]=results[time].actual});resolve(obj)}).catch(resp=>{reject(resp)})})}}function getRecordsForCriteria(config,range){let criteria=[];criteria.push({fieldName:"detector_index",fieldValue:config.detectorIndex});criteria=criteria.concat(config.entityFields);return results_service["mlResultsService"].getRecordsForCriteria([config.jobId],criteria,0,range.min,range.max,ANOMALIES_MAX_RESULTS).toPromise()}function getScheduledEvents(config,range){return results_service["mlResultsService"].getScheduledEventsByBucket([config.jobId],range.min,range.max,config.bucketSpanSeconds*1e3,1,explorer_charts_container_service_MAX_SCHEDULED_EVENTS).toPromise()}function getEventDistribution(config,range){const chartType=getChartType(config);let splitField;let filterField=null;if(chartType===explorer_constants["b"].EVENT_DISTRIBUTION){splitField=config.entityFields.find(f=>f.fieldType==="by");filterField=config.entityFields.find(f=>f.fieldType==="partition")}else if(chartType===explorer_constants["b"].POPULATION_DISTRIBUTION){splitField=config.entityFields.find(f=>f.fieldType==="over");filterField=config.entityFields.find(f=>f.fieldType==="partition")}const datafeedQuery=Object(external_kbnSharedDeps_Lodash_["get"])(config,"datafeedConfig.query",null);return results_service["mlResultsService"].getEventDistributionData(config.datafeedConfig.indices,splitField,filterField,datafeedQuery,config.metricFunction,config.metricFieldName,config.timeField,range.min,range.max,config.bucketSpanSeconds*1e3)}const seriesPromises=[];const seriesCongifsForPromises=hasGeoData?seriesConfigsNoGeoData:seriesConfigs;seriesCongifsForPromises.forEach(seriesConfig=>{seriesPromises.push(Promise.all([getMetricData(seriesConfig,chartRange),getRecordsForCriteria(seriesConfig,chartRange),getScheduledEvents(seriesConfig,chartRange),getEventDistribution(seriesConfig,chartRange)]))});function processChartData(response,seriesIndex){const metricData=response[0].results;const records=response[1].records;const jobId=seriesCongifsForPromises[seriesIndex].jobId;const scheduledEvents=response[2].events[jobId];const eventDistribution=response[3];const chartType=getChartType(seriesCongifsForPromises[seriesIndex]);records.sort((recordA,recordB)=>recordA[ML_TIME_FIELD_NAME]-recordB[ML_TIME_FIELD_NAME]);let chartData=[];if(metricData!==undefined){if(eventDistribution.length>0&&records.length>0){const filterField=records[0].by_field_value||records[0].over_field_value;chartData=eventDistribution.filter(d=>d.entity!==filterField);Object(external_kbnSharedDeps_Lodash_["map"])(metricData,(value,time)=>{if(chartType===explorer_constants["b"].EVENT_DISTRIBUTION&&value>0||chartType!==explorer_constants["b"].EVENT_DISTRIBUTION&&value!==null){chartData.push({date:+time,value:value,entity:filterField})}})}else{chartData=Object(external_kbnSharedDeps_Lodash_["map"])(metricData,(value,time)=>({date:+time,value:value}))}}const chartDataForPointSearch=getChartDataForPointSearch(chartData,records[0],chartType);Object(external_kbnSharedDeps_Lodash_["each"])(records,record=>{const recordTime=record[ML_TIME_FIELD_NAME];let chartPoint=findChartPointForTime(chartDataForPointSearch,recordTime);if(chartPoint===undefined){chartPoint={date:new Date(recordTime),value:null};chartData.push(chartPoint)}chartPoint.anomalyScore=record.record_score;if(record.actual!==undefined){chartPoint.actual=record.actual;chartPoint.typical=record.typical}else{const causes=Object(external_kbnSharedDeps_Lodash_["get"])(record,"causes",[]);if(causes.length>0){chartPoint.byFieldName=record.by_field_name;chartPoint.numberOfCauses=causes.length;if(causes.length===1){const cause=record.causes[0];chartPoint.actual=cause.actual;chartPoint.typical=cause.typical}}}if(record.multi_bucket_impact!==undefined){chartPoint.multiBucketImpact=record.multi_bucket_impact}});if(scheduledEvents!==undefined){Object(external_kbnSharedDeps_Lodash_["each"])(scheduledEvents,(events,time)=>{const chartPoint=findChartPointForTime(chartDataForPointSearch,Number(time));if(chartPoint!==undefined){chartPoint.scheduledEvents=events}})}return chartData}function getChartDataForPointSearch(chartData,record,chartType){if(chartType===explorer_constants["b"].EVENT_DISTRIBUTION||chartType===explorer_constants["b"].POPULATION_DISTRIBUTION){return chartData.filter(d=>d.entity===(record&&(record.by_field_value||record.over_field_value)))}return chartData}function findChartPointForTime(chartData,time){return chartData.find(point=>point.date===time)}Promise.all(seriesPromises).then(response=>{const processedData=response.map(processChartData);const allDataPoints=Object(external_kbnSharedDeps_Lodash_["reduce"])(processedData,(datapoints,series)=>{Object(external_kbnSharedDeps_Lodash_["each"])(series,d=>datapoints.push(d));return datapoints},[]);const overallChartLimits=chart_utils_chartLimits(allDataPoints);data.seriesToPlot=response.map((d,i)=>({...seriesCongifsForPromises[i],loading:false,chartData:processedData[i],plotEarliest:chartRange.min,plotLatest:chartRange.max,selectedEarliest:selectedEarliestMs,selectedLatest:selectedLatestMs,chartLimits:USE_OVERALL_CHART_LIMITS?overallChartLimits:chart_utils_chartLimits(processedData[i])}));if(mapData.length){data.seriesToPlot.push(...mapData)}explorerService.setCharts({...data})}).catch(error=>{console.error(error)})};function processRecordsForDisplay(anomalyRecords){if(anomalyRecords.length===0){return[[],undefined]}const aggregatedData={};const jobsErrorMessage={};Object(external_kbnSharedDeps_Lodash_["each"])(anomalyRecords,record=>{const job=job_service["a"].getJob(record.job_id);if(jobsErrorMessage[record.job_id]!==undefined){return}let isChartable=Object(job_utils["n"])(job,record.detector_index)||Object(job_utils["k"])(job,record.detector_index);if(isChartable===false){if(Object(job_utils["l"])(job,record.detector_index)){const entityFields=Object(anomaly_utils["c"])(record);if(Object(job_utils["m"])(job,record.detector_index,entityFields)){isChartable=true}else{isChartable=false;jobsErrorMessage[record.job_id]=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesJob.sourceDataNotChartableWithDisabledModelPlotMessage",{defaultMessage:"source data is not viewable for this detector and model plot is disabled"})}}else{jobsErrorMessage[record.job_id]=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesJob.sourceDataModelPlotNotChartableMessage",{defaultMessage:"both source data and model plot are not chartable for this detector"})}}if(isChartable===false){return}const jobId=record.job_id;if(aggregatedData[jobId]===undefined){aggregatedData[jobId]={}}const detectorsForJob=aggregatedData[jobId];const detectorIndex=record.detector_index;if(detectorsForJob[detectorIndex]===undefined){detectorsForJob[detectorIndex]={}}const firstFieldName=record.partition_field_name||record.by_field_name||record.over_field_name;const firstFieldValue=record.partition_field_value||record.by_field_value||record.over_field_value;if(firstFieldName!==undefined){const groupsForDetector=detectorsForJob[detectorIndex];if(groupsForDetector[firstFieldName]===undefined){groupsForDetector[firstFieldName]={}}const valuesForGroup=groupsForDetector[firstFieldName];if(valuesForGroup[firstFieldValue]===undefined){valuesForGroup[firstFieldValue]={}}const dataForGroupValue=valuesForGroup[firstFieldValue];let isSecondSplit=false;if(record.partition_field_name!==undefined){const splitFieldName=record.over_field_name||record.by_field_name;if(splitFieldName!==undefined){isSecondSplit=true}}if(isSecondSplit===false){if(dataForGroupValue.maxScoreRecord===undefined){dataForGroupValue.maxScore=record.record_score;dataForGroupValue.maxScoreRecord=record}else{if(record.record_score>dataForGroupValue.maxScore){dataForGroupValue.maxScore=record.record_score;dataForGroupValue.maxScoreRecord=record}}}else{const secondFieldName=record.over_field_name||record.by_field_name;const secondFieldValue=record.over_field_value||record.by_field_value;if(dataForGroupValue[secondFieldName]===undefined){dataForGroupValue[secondFieldName]={}}const splitsForGroup=dataForGroupValue[secondFieldName];if(splitsForGroup[secondFieldValue]===undefined){splitsForGroup[secondFieldValue]={}}const dataForSplitValue=splitsForGroup[secondFieldValue];if(dataForSplitValue.maxScoreRecord===undefined){dataForSplitValue.maxScore=record.record_score;dataForSplitValue.maxScoreRecord=record}else{if(record.record_score>dataForSplitValue.maxScore){dataForSplitValue.maxScore=record.record_score;dataForSplitValue.maxScoreRecord=record}}}}else{const dataForDetector=detectorsForJob[detectorIndex];if(dataForDetector.maxScoreRecord===undefined){dataForDetector.maxScore=record.record_score;dataForDetector.maxScoreRecord=record}else{if(record.record_score>dataForDetector.maxScore){dataForDetector.maxScore=record.record_score;dataForDetector.maxScoreRecord=record}}}});const errorMessages={};Object.keys(jobsErrorMessage).forEach(jobId=>{const msg=jobsErrorMessage[jobId];if(errorMessages[msg]===undefined){errorMessages[msg]=new Set([jobId])}else{errorMessages[msg].add(jobId)}});let recordsForSeries=[];Object(external_kbnSharedDeps_Lodash_["each"])(aggregatedData,detectorsForJob=>{Object(external_kbnSharedDeps_Lodash_["each"])(detectorsForJob,groupsForDetector=>{if(groupsForDetector.errorMessage!==undefined){recordsForSeries.push(groupsForDetector.errorMessage)}else{if(groupsForDetector.maxScoreRecord!==undefined){recordsForSeries.push(groupsForDetector.maxScoreRecord)}else{Object(external_kbnSharedDeps_Lodash_["each"])(groupsForDetector,valuesForGroup=>{Object(external_kbnSharedDeps_Lodash_["each"])(valuesForGroup,dataForGroupValue=>{if(dataForGroupValue.maxScoreRecord!==undefined){recordsForSeries.push(dataForGroupValue.maxScoreRecord)}else{Object(external_kbnSharedDeps_Lodash_["each"])(dataForGroupValue,splitsForGroup=>{Object(external_kbnSharedDeps_Lodash_["each"])(splitsForGroup,dataForSplitValue=>{recordsForSeries.push(dataForSplitValue.maxScoreRecord)})})}})})}}})});recordsForSeries=Object(external_kbnSharedDeps_Lodash_["sortBy"])(recordsForSeries,"record_score").reverse();return[recordsForSeries,errorMessages]}function calculateChartRange(seriesConfigs,selectedEarliestMs,selectedLatestMs,chartWidth,recordsToPlot,timeFieldName){let tooManyBuckets=false;const midpointMs=Math.ceil((selectedEarliestMs+selectedLatestMs)/2);const minBucketSpanMs=Math.min.apply(null,Object(external_kbnSharedDeps_Lodash_["map"])(seriesConfigs,"bucketSpanSeconds"))*1e3;const maxBucketSpanMs=Math.max.apply(null,Object(external_kbnSharedDeps_Lodash_["map"])(seriesConfigs,"bucketSpanSeconds"))*1e3;const pointsToPlotFullSelection=Math.ceil((selectedLatestMs-selectedEarliestMs)/minBucketSpanMs);const optimumPointSpacing=5;const optimumNumPoints=chartWidth/optimumPointSpacing;const plotPoints=Math.max(optimumNumPoints,pointsToPlotFullSelection);const halfPoints=Math.ceil(plotPoints/2);const timefilter=Object(dependency_cache["i"])();const bounds=timefilter.getActiveBounds();const boundsMin=bounds.min.valueOf();let chartRange={min:Math.max(midpointMs-halfPoints*minBucketSpanMs,boundsMin),max:Math.min(midpointMs+halfPoints*minBucketSpanMs,bounds.max.valueOf())};if(plotPoints>CHART_MAX_POINTS){const maxTimeSpan=minBucketSpanMs*CHART_MAX_POINTS;let minMs=recordsToPlot[0][timeFieldName];let maxMs=recordsToPlot[0][timeFieldName];Object(external_kbnSharedDeps_Lodash_["each"])(recordsToPlot,record=>{const diffMs=maxMs-minMs;if(diffMs<maxTimeSpan){const recordTime=record[timeFieldName];if(recordTime<minMs){if(maxMs-recordTime<=maxTimeSpan){minMs=recordTime}}if(recordTime>maxMs){if(recordTime-minMs<=maxTimeSpan){maxMs=recordTime}}}});if(maxMs-minMs<maxTimeSpan){const diff=maxTimeSpan-(maxMs-minMs);if(minMs-.5*diff<=selectedEarliestMs){minMs=Math.max(selectedEarliestMs,minMs-.5*diff);maxMs=minMs+maxTimeSpan}else{maxMs=Math.min(selectedLatestMs,maxMs+.5*diff);minMs=maxMs-maxTimeSpan}}chartRange={min:minMs,max:maxMs}}chartRange.min=Math.floor(chartRange.min/maxBucketSpanMs)*maxBucketSpanMs;if(chartRange.min<boundsMin){chartRange.min=chartRange.min+maxBucketSpanMs}if((chartRange.min>selectedEarliestMs||chartRange.max<selectedLatestMs)&&chartRange.max-chartRange.min<selectedLatestMs-selectedEarliestMs){tooManyBuckets=true}return{chartRange:chartRange,tooManyBuckets:tooManyBuckets}}var anomaly_timeline_service=__webpack_require__(371);const memoizeIsEqual=(newArgs,lastArgs)=>Object(external_kbnSharedDeps_Lodash_["isEqual"])(newArgs,lastArgs);const wrapWithLastRefreshArg=(func,context=null)=>function(lastRefresh,...args){return func.apply(context,args)};const memoize=(func,context)=>memoize_one_cjs_default()(wrapWithLastRefreshArg(func,context),memoizeIsEqual);const memoizedAnomalyDataChange=memoize(anomalyDataChange);const memoizedLoadAnnotationsTableData=memoize(loadAnnotationsTableData);const memoizedLoadDataForCharts=memoize(loadDataForCharts);const memoizedLoadFilteredTopInfluencers=memoize(loadFilteredTopInfluencers);const memoizedLoadTopInfluencers=memoize(loadTopInfluencers);const memoizedLoadAnomaliesTableData=memoize(loadAnomaliesTableData);const isLoadExplorerDataConfig=arg=>arg!==undefined&&arg.selectedJobs!==undefined&&arg.selectedJobs!==null&&arg.viewBySwimlaneFieldName!==undefined;const loadExplorerDataProvider=(anomalyTimelineService,timefilter)=>{const memoizedLoadOverallData=memoize(anomalyTimelineService.loadOverallData,anomalyTimelineService);const memoizedLoadViewBySwimlane=memoize(anomalyTimelineService.loadViewBySwimlane,anomalyTimelineService);return config=>{if(!isLoadExplorerDataConfig(config)){return Object(external_kbnSharedDeps_Rxjs_["of"])({})}const{lastRefresh:lastRefresh,influencersFilterQuery:influencersFilterQuery,noInfluencersConfigured:noInfluencersConfigured,selectedCells:selectedCells,selectedJobs:selectedJobs,swimlaneBucketInterval:swimlaneBucketInterval,swimlaneLimit:swimlaneLimit,tableInterval:tableInterval,tableSeverity:tableSeverity,viewBySwimlaneFieldName:viewBySwimlaneFieldName,swimlaneContainerWidth:swimlaneContainerWidth,viewByFromPage:viewByFromPage,viewByPerPage:viewByPerPage}=config;const selectionInfluencers=getSelectionInfluencers(selectedCells,viewBySwimlaneFieldName);const jobIds=getSelectionJobIds(selectedCells,selectedJobs);const bounds=timefilter.getBounds();const timerange=getSelectionTimeRange(selectedCells,swimlaneBucketInterval.asSeconds(),bounds);const dateFormatTz=getDateFormatTz();return Object(external_kbnSharedDeps_Rxjs_["forkJoin"])({annotationsData:memoizedLoadAnnotationsTableData(lastRefresh,selectedCells,selectedJobs,swimlaneBucketInterval.asSeconds(),bounds),anomalyChartRecords:memoizedLoadDataForCharts(lastRefresh,jobIds,timerange.earliestMs,timerange.latestMs,selectionInfluencers,selectedCells,influencersFilterQuery),influencers:selectionInfluencers.length===0?memoizedLoadTopInfluencers(lastRefresh,jobIds,timerange.earliestMs,timerange.latestMs,[],noInfluencersConfigured,influencersFilterQuery):Promise.resolve({}),overallState:memoizedLoadOverallData(lastRefresh,selectedJobs,swimlaneContainerWidth),tableData:memoizedLoadAnomaliesTableData(lastRefresh,selectedCells,selectedJobs,dateFormatTz,swimlaneBucketInterval.asSeconds(),bounds,viewBySwimlaneFieldName,tableInterval,tableSeverity,influencersFilterQuery),topFieldValues:selectedCells!==undefined&&selectedCells.showTopFieldValues===true?anomalyTimelineService.loadViewByTopFieldValuesForSelectedTime(timerange.earliestMs,timerange.latestMs,selectedJobs,viewBySwimlaneFieldName,swimlaneLimit,viewByPerPage,viewByFromPage,swimlaneContainerWidth):Promise.resolve([])}).pipe(Object(external_kbnSharedDeps_RxjsOperators_["tap"])(explorerService.setViewBySwimlaneLoading),Object(external_kbnSharedDeps_RxjsOperators_["tap"])(({anomalyChartRecords:anomalyChartRecords})=>{if(selectedCells!==undefined&&Array.isArray(anomalyChartRecords)){memoizedAnomalyDataChange(lastRefresh,swimlaneContainerWidth,anomalyChartRecords,timerange.earliestMs,timerange.latestMs,tableSeverity)}else{memoizedAnomalyDataChange(lastRefresh,swimlaneContainerWidth,[],timerange.earliestMs,timerange.latestMs,tableSeverity)}}),Object(external_kbnSharedDeps_RxjsOperators_["mergeMap"])(({anomalyChartRecords:anomalyChartRecords,influencers:influencers,overallState:overallState,topFieldValues:topFieldValues})=>Object(external_kbnSharedDeps_Rxjs_["forkJoin"])({influencers:(selectionInfluencers.length>0||influencersFilterQuery!==undefined)&&anomalyChartRecords!==undefined&&anomalyChartRecords.length>0?memoizedLoadFilteredTopInfluencers(lastRefresh,jobIds,timerange.earliestMs,timerange.latestMs,anomalyChartRecords,selectionInfluencers,noInfluencersConfigured,influencersFilterQuery):Promise.resolve(influencers),viewBySwimlaneState:memoizedLoadViewBySwimlane(lastRefresh,topFieldValues,{earliest:overallState.earliest,latest:overallState.latest},selectedJobs,viewBySwimlaneFieldName,explorer_constants["a"],viewByPerPage,viewByFromPage,swimlaneContainerWidth,influencersFilterQuery)}),({annotationsData:annotationsData,overallState:overallState,tableData:tableData},{influencers:influencers,viewBySwimlaneState:viewBySwimlaneState})=>({annotations:annotationsData,influencers:influencers,loading:false,viewBySwimlaneDataLoading:false,overallSwimlaneData:overallState,viewBySwimlaneData:viewBySwimlaneState,tableData:tableData,swimlaneLimit:Object(swimlane_container["c"])(viewBySwimlaneState)?viewBySwimlaneState.cardinality:undefined})))}};const useExplorerData=()=>{const timefilter=Object(contexts_kibana["g"])();const{services:{mlServices:{mlApiServices:mlApiServices},uiSettings:uiSettings}}=Object(contexts_kibana["b"])();const loadExplorerData=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{const anomalyTimelineService=new anomaly_timeline_service["AnomalyTimelineService"](timefilter,uiSettings,Object(results_service["mlResultsServiceProvider"])(mlApiServices));return loadExplorerDataProvider(anomalyTimelineService,timefilter)},[]);const loadExplorerData$=Object(external_kbnSharedDeps_React_["useMemo"])(()=>new external_kbnSharedDeps_Rxjs_["Subject"],[]);const explorerData$=Object(external_kbnSharedDeps_React_["useMemo"])(()=>loadExplorerData$.pipe(Object(external_kbnSharedDeps_RxjsOperators_["switchMap"])(loadExplorerData)),[]);const explorerData=useObservable_default()(explorerData$);const update=Object(external_kbnSharedDeps_React_["useCallback"])(c=>{loadExplorerData$.next(c)},[]);return[explorerData,update]};const ML_ANNOTATIONS_INDEX_ALIAS_READ=".ml-annotations-read";const ML_ANNOTATIONS_INDEX_ALIAS_WRITE=".ml-annotations-write";const ML_ANNOTATIONS_INDEX_PATTERN=".ml-annotations-6";const ML_RESULTS_INDEX_PATTERN=".ml-anomalies-*";const ML_NOTIFICATION_INDEX_PATTERN=".ml-notifications*";function getIndexPattern(selectedJobs){return{title:ML_RESULTS_INDEX_PATTERN,fields:getInfluencers(selectedJobs).map(influencer=>({name:influencer,type:"string",aggregatable:true,searchable:true}))}}const checkSelectedCells=state=>{const{filterActive:filterActive,loading:loading,selectedCells:selectedCells,viewBySwimlaneData:viewBySwimlaneData,viewBySwimlaneDataLoading:viewBySwimlaneDataLoading}=state;if(loading||viewBySwimlaneDataLoading){return{}}let clearSelection=false;if(selectedCells!==undefined&&selectedCells!==null&&selectedCells.type===explorer_constants["h"].VIEW_BY&&viewBySwimlaneData!==undefined&&viewBySwimlaneData.points!==undefined&&viewBySwimlaneData.points.length>0){clearSelection=filterActive===false&&!selectedCells.lanes.some(lane=>viewBySwimlaneData.points.some(point=>point.laneLabel===lane&&point.time>=selectedCells.times[0]&&point.time<=selectedCells.times[1]))}if(clearSelection===true){return{...getClearedSelectedAnomaliesState()}}return{}};function clearInfluencerFilterSettings(state){return{...state,filterActive:false,filteredFields:[],influencersFilterQuery:undefined,isAndOperator:false,maskAll:false,queryString:"",tableQueryString:"",...getClearedSelectedAnomaliesState(),viewByFromPage:1}}const jobSelectionChange=(state,payload)=>{const{selectedJobs:selectedJobs}=payload;const stateUpdate={...state,noInfluencersConfigured:getInfluencers(selectedJobs).length===0,overallSwimlaneData:getDefaultSwimlaneData(),selectedJobs:selectedJobs,viewByFromPage:!state.selectedJobs||Object(external_kbnSharedDeps_Lodash_["isEqual"])(state.selectedJobs,selectedJobs)?state.viewByFromPage:1};if(stateUpdate.noInfluencersConfigured===true){const noFilterState={filterActive:false,filteredFields:[],influencersFilterQuery:undefined,maskAll:false,queryString:"",tableQueryString:""};Object.assign(stateUpdate,noFilterState)}else{stateUpdate.indexPattern=getIndexPattern(selectedJobs)}stateUpdate.loading=true;return stateUpdate};function setInfluencerFilterSettings(state,payload){const{filterQuery:influencersFilterQuery,isAndOperator:isAndOperator,filteredFields:filteredFields,queryString:queryString,tableQueryString:tableQueryString}=payload;const{selectedCells:selectedCells,viewBySwimlaneOptions:viewBySwimlaneOptions}=state;let selectedViewByFieldName=state.viewBySwimlaneFieldName;const filteredViewBySwimlaneOptions=viewBySwimlaneOptions.filter(d=>filteredFields.includes(d));if(isAndOperator&&selectedCells===undefined){selectedViewByFieldName=explorer_constants["j"]}else{for(let i=0;i<filteredFields.length;i++){if(filteredViewBySwimlaneOptions.includes(filteredFields[i])&&(selectedCells===undefined||selectedCells&&selectedCells.type==="overall")){selectedViewByFieldName=filteredFields[i];break}}}return{...state,filterActive:true,filteredFields:filteredFields,influencersFilterQuery:influencersFilterQuery,isAndOperator:isAndOperator,queryString:queryString,tableQueryString:tableQueryString,maskAll:selectedViewByFieldName===explorer_constants["j"]||filteredFields.includes(selectedViewByFieldName)===false,viewBySwimlaneFieldName:selectedViewByFieldName,viewBySwimlaneOptions:filteredViewBySwimlaneOptions,viewByFromPage:1}}const setKqlQueryBarPlaceholder=state=>{const{influencers:influencers,noInfluencersConfigured:noInfluencersConfigured}=state;if(influencers!==undefined&&!noInfluencersConfigured){for(const influencerName in influencers){if(influencers[influencerName][0]&&influencers[influencerName][0].influencerFieldValue){return{filterPlaceHolder:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.kueryBar.filterPlaceholder",{defaultMessage:"Filter by influencer fields… ({queryExample})",values:{queryExample:`${influencerName} : ${influencers[influencerName][0].influencerFieldValue}`}})}}}}return{}};const useSelectedCells=(appState,setAppState,bucketIntervalInSeconds)=>{var _timeBounds$min,_timeBounds$max;const timeFilter=Object(contexts_kibana["g"])();const timeBounds=timeFilter.getBounds();const selectedCells=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{var _appState$mlExplorerS,_appState$mlExplorerS2,_appState$mlExplorerS3;if(!(appState!==null&&appState!==void 0&&(_appState$mlExplorerS=appState.mlExplorerSwimlane)!==null&&_appState$mlExplorerS!==void 0&&_appState$mlExplorerS.selectedType)){return}let times=(_appState$mlExplorerS2=appState.mlExplorerSwimlane.selectedTimes)!==null&&_appState$mlExplorerS2!==void 0?_appState$mlExplorerS2:appState.mlExplorerSwimlane.selectedTime;if(typeof times==="number"){times=[times,times+bucketIntervalInSeconds]}let lanes=(_appState$mlExplorerS3=appState.mlExplorerSwimlane.selectedLanes)!==null&&_appState$mlExplorerS3!==void 0?_appState$mlExplorerS3:appState.mlExplorerSwimlane.selectedLane;if(typeof lanes==="string"){lanes=[lanes]}return{type:appState.mlExplorerSwimlane.selectedType,lanes:lanes,times:times,showTopFieldValues:appState.mlExplorerSwimlane.showTopFieldValues,viewByFieldName:appState.mlExplorerSwimlane.viewByFieldName}},[JSON.stringify(appState===null||appState===void 0?void 0:appState.mlExplorerSwimlane),bucketIntervalInSeconds]);const setSelectedCells=Object(external_kbnSharedDeps_React_["useCallback"])(swimlaneSelectedCells=>{const mlExplorerSwimlane={...appState.mlExplorerSwimlane};if(swimlaneSelectedCells!==undefined){swimlaneSelectedCells.showTopFieldValues=false;const currentSwimlaneType=selectedCells===null||selectedCells===void 0?void 0:selectedCells.type;const currentShowTopFieldValues=selectedCells===null||selectedCells===void 0?void 0:selectedCells.showTopFieldValues;const newSwimlaneType=swimlaneSelectedCells===null||swimlaneSelectedCells===void 0?void 0:swimlaneSelectedCells.type;if(currentSwimlaneType===explorer_constants["h"].OVERALL&&newSwimlaneType===explorer_constants["h"].VIEW_BY||newSwimlaneType===explorer_constants["h"].OVERALL||currentShowTopFieldValues===true){swimlaneSelectedCells.showTopFieldValues=true}mlExplorerSwimlane.selectedType=swimlaneSelectedCells.type;mlExplorerSwimlane.selectedLanes=swimlaneSelectedCells.lanes;mlExplorerSwimlane.selectedTimes=swimlaneSelectedCells.times;mlExplorerSwimlane.showTopFieldValues=swimlaneSelectedCells.showTopFieldValues;setAppState({mlExplorerSwimlane:mlExplorerSwimlane})}else{delete mlExplorerSwimlane.selectedType;delete mlExplorerSwimlane.selectedLanes;delete mlExplorerSwimlane.selectedTimes;delete mlExplorerSwimlane.showTopFieldValues;setAppState({mlExplorerSwimlane:mlExplorerSwimlane})}},[appState===null||appState===void 0?void 0:appState.mlExplorerSwimlane,selectedCells,setAppState]);Object(external_kbnSharedDeps_React_["useEffect"])((function adjustSwimLaneTimeSelection(){if((selectedCells===null||selectedCells===void 0?void 0:selectedCells.times)===undefined||bucketIntervalInSeconds===undefined)return;const[selectedFrom,selectedTo]=selectedCells.times;const rangeFrom=timeBounds.min.unix()-bucketIntervalInSeconds;const rangeTo=timeBounds.max.unix()+bucketIntervalInSeconds;const resultFrom=Math.max(selectedFrom,rangeFrom);const resultTo=Math.min(selectedTo,rangeTo);const isSelectionOutOfRange=rangeFrom>resultTo||rangeTo<resultFrom;if(isSelectionOutOfRange){setSelectedCells();return}if(selectedFrom===resultFrom&&selectedTo===resultTo){return}if(resultFrom!==rangeFrom||resultTo!==rangeTo){setSelectedCells({...selectedCells,times:[resultFrom,resultTo]})}}),[(_timeBounds$min=timeBounds.min)===null||_timeBounds$min===void 0?void 0:_timeBounds$min.unix(),(_timeBounds$max=timeBounds.max)===null||_timeBounds$max===void 0?void 0:_timeBounds$max.unix(),selectedCells,bucketIntervalInSeconds]);return[selectedCells,setSelectedCells]};function getTimeBoundsFromSelection(selectedCells){if((selectedCells===null||selectedCells===void 0?void 0:selectedCells.times)===undefined){return}return{earliestMs:selectedCells.times[0]*1e3,latestMs:selectedCells.times[1]*1e3-1}}const explorerReducer=(state,nextAction)=>{const{type:type,payload:payload}=nextAction;let nextState;switch(type){case explorer_constants["c"].CLEAR_INFLUENCER_FILTER_SETTINGS:nextState=clearInfluencerFilterSettings(state);break;case explorer_constants["c"].CLEAR_JOBS:nextState={...state,...getClearedSelectedAnomaliesState(),loading:false,viewByFromPage:1,selectedJobs:[]};break;case explorer_constants["c"].JOB_SELECTION_CHANGE:nextState=jobSelectionChange(state,payload);break;case explorer_constants["c"].SET_CHARTS:nextState={...state,chartsData:{...getDefaultChartsData(),chartsPerRow:payload.chartsPerRow,seriesToPlot:payload.seriesToPlot,tooManyBuckets:!!payload.tooManyBuckets,errorMessages:payload.errorMessages}};break;case explorer_constants["c"].SET_INFLUENCER_FILTER_SETTINGS:nextState=setInfluencerFilterSettings(state,payload);break;case explorer_constants["c"].SET_SELECTED_CELLS:const selectedCells=payload;nextState={...state,selectedCells:selectedCells};break;case explorer_constants["c"].SET_EXPLORER_DATA:case explorer_constants["c"].SET_FILTER_DATA:nextState={...state,...payload};break;case explorer_constants["c"].SET_SWIMLANE_CONTAINER_WIDTH:nextState={...state,swimlaneContainerWidth:payload};break;case explorer_constants["c"].SET_VIEW_BY_SWIMLANE_FIELD_NAME:const{filteredFields:filteredFields,influencersFilterQuery:influencersFilterQuery}=state;const viewBySwimlaneFieldName=payload;let maskAll=false;if(influencersFilterQuery!==undefined){maskAll=viewBySwimlaneFieldName===explorer_constants["j"]||filteredFields.includes(viewBySwimlaneFieldName)===false}nextState={...state,...getClearedSelectedAnomaliesState(),maskAll:maskAll,viewBySwimlaneFieldName:viewBySwimlaneFieldName,viewBySwimlaneData:getDefaultSwimlaneData(),viewByFromPage:1,viewBySwimlaneDataLoading:true};break;case explorer_constants["c"].SET_VIEW_BY_SWIMLANE_LOADING:const{annotationsData:annotationsData,overallState:overallState,tableData:tableData}=payload;nextState={...state,annotations:annotationsData,overallSwimlaneData:overallState,tableData:tableData,viewBySwimlaneData:{...getDefaultSwimlaneData()},viewBySwimlaneDataLoading:true};break;case explorer_constants["c"].SET_VIEW_BY_FROM_PAGE:nextState={...state,viewByFromPage:payload};break;case explorer_constants["c"].SET_VIEW_BY_PER_PAGE:nextState={...state,viewByFromPage:1,viewByPerPage:payload};break;default:nextState=state}if(nextState.selectedJobs===null){return nextState}const swimlaneBucketInterval=getSwimlaneBucketInterval(nextState.selectedJobs,nextState.swimlaneContainerWidth);const{viewBySwimlaneFieldName:viewBySwimlaneFieldName,viewBySwimlaneOptions:viewBySwimlaneOptions}=getViewBySwimlaneOptions({currentViewBySwimlaneFieldName:nextState.viewBySwimlaneFieldName,filterActive:nextState.filterActive,filteredFields:nextState.filteredFields,isAndOperator:nextState.isAndOperator,selectedJobs:nextState.selectedJobs,selectedCells:nextState.selectedCells});const{selectedCells:selectedCells}=nextState;const timeRange=getTimeBoundsFromSelection(selectedCells);return{...nextState,swimlaneBucketInterval:swimlaneBucketInterval,viewByLoadedForTimeFormatted:timeRange?Object(date_utils["b"])(timeRange.earliestMs):null,viewBySwimlaneFieldName:viewBySwimlaneFieldName,viewBySwimlaneOptions:viewBySwimlaneOptions,...checkSelectedCells(nextState),...setKqlQueryBarPlaceholder(nextState)}};function getDefaultIndexPattern(){return{title:ML_RESULTS_INDEX_PATTERN,fields:[]}}function getExplorerDefaultState(){return{annotations:{error:undefined,annotationsData:[],aggregations:{}},chartsData:getDefaultChartsData(),fieldFormatsLoading:false,filterActive:false,filteredFields:[],filterPlaceHolder:undefined,indexPattern:getDefaultIndexPattern(),influencersFilterQuery:undefined,influencers:{},isAndOperator:false,loading:true,maskAll:false,noInfluencersConfigured:true,overallSwimlaneData:getDefaultSwimlaneData(),queryString:"",selectedCells:undefined,selectedJobs:null,swimlaneBucketInterval:undefined,swimlaneContainerWidth:0,tableData:{anomalies:[],examplesByJobId:[""],interval:0,jobIds:[],showViewSeriesLink:false},tableQueryString:"",viewByLoadedForTimeFormatted:null,viewBySwimlaneData:getDefaultSwimlaneData(),viewBySwimlaneDataLoading:false,viewBySwimlaneFieldName:undefined,viewBySwimlaneOptions:[],viewByPerPage:explorer_constants["i"],viewByFromPage:1,swimlaneLimit:undefined}}const ALLOW_CELL_RANGE_SELECTION=true;const explorerAction$=new external_kbnSharedDeps_Rxjs_["Subject"];const explorerFilteredAction$=explorerAction$.pipe(Object(external_kbnSharedDeps_RxjsOperators_["flatMap"])(action=>Object(external_kbnSharedDeps_Rxjs_["isObservable"])(action)?action:Object(external_kbnSharedDeps_Rxjs_["from"])([action])),Object(external_kbnSharedDeps_RxjsOperators_["distinctUntilChanged"])(external_kbnSharedDeps_Lodash_["isEqual"]));const explorerState$=explorerFilteredAction$.pipe(Object(external_kbnSharedDeps_RxjsOperators_["scan"])(explorerReducer,getExplorerDefaultState()),Object(external_kbnSharedDeps_RxjsOperators_["shareReplay"])(1));const explorerAppState$=explorerState$.pipe(Object(external_kbnSharedDeps_RxjsOperators_["map"])(state=>{const appState={mlExplorerFilter:{},mlExplorerSwimlane:{}};if(state.selectedCells!==undefined){const swimlaneSelectedCells=state.selectedCells;appState.mlExplorerSwimlane.selectedType=swimlaneSelectedCells.type;appState.mlExplorerSwimlane.selectedLanes=swimlaneSelectedCells.lanes;appState.mlExplorerSwimlane.selectedTimes=swimlaneSelectedCells.times;appState.mlExplorerSwimlane.showTopFieldValues=swimlaneSelectedCells.showTopFieldValues}if(state.viewBySwimlaneFieldName!==undefined){appState.mlExplorerSwimlane.viewByFieldName=state.viewBySwimlaneFieldName}if(state.viewByFromPage!==undefined){appState.mlExplorerSwimlane.viewByFromPage=state.viewByFromPage}if(state.viewByPerPage!==undefined){appState.mlExplorerSwimlane.viewByPerPage=state.viewByPerPage}if(state.filterActive){appState.mlExplorerFilter.influencersFilterQuery=state.influencersFilterQuery;appState.mlExplorerFilter.filterActive=state.filterActive;appState.mlExplorerFilter.filteredFields=state.filteredFields;appState.mlExplorerFilter.queryString=state.queryString}return appState}),Object(external_kbnSharedDeps_RxjsOperators_["distinctUntilChanged"])(external_kbnSharedDeps_Lodash_["isEqual"]));const setExplorerDataActionCreator=payload=>({type:explorer_constants["c"].SET_EXPLORER_DATA,payload:payload});const setFilterDataActionCreator=payload=>({type:explorer_constants["c"].SET_FILTER_DATA,payload:payload});const explorerService={appState$:explorerAppState$,state$:explorerState$,clearInfluencerFilterSettings:()=>{explorerAction$.next({type:explorer_constants["c"].CLEAR_INFLUENCER_FILTER_SETTINGS})},clearJobs:()=>{explorerAction$.next({type:explorer_constants["c"].CLEAR_JOBS})},updateJobSelection:selectedJobIds=>{explorerAction$.next(jobSelectionActionCreator(selectedJobIds))},setCharts:payload=>{explorerAction$.next({type:explorer_constants["c"].SET_CHARTS,payload:payload})},setInfluencerFilterSettings:payload=>{explorerAction$.next({type:explorer_constants["c"].SET_INFLUENCER_FILTER_SETTINGS,payload:payload})},setSelectedCells:payload=>{explorerAction$.next({type:explorer_constants["c"].SET_SELECTED_CELLS,payload:payload})},setExplorerData:payload=>{explorerAction$.next(setExplorerDataActionCreator(payload))},setFilterData:payload=>{explorerAction$.next(setFilterDataActionCreator(payload))},setSwimlaneContainerWidth:payload=>{explorerAction$.next({type:explorer_constants["c"].SET_SWIMLANE_CONTAINER_WIDTH,payload:payload})},setViewBySwimlaneFieldName:payload=>{explorerAction$.next({type:explorer_constants["c"].SET_VIEW_BY_SWIMLANE_FIELD_NAME,payload:payload})},setViewBySwimlaneLoading:payload=>{explorerAction$.next({type:explorer_constants["c"].SET_VIEW_BY_SWIMLANE_LOADING,payload:payload})},setViewByFromPage:payload=>{explorerAction$.next({type:explorer_constants["c"].SET_VIEW_BY_FROM_PAGE,payload:payload})},setViewByPerPage:payload=>{explorerAction$.next({type:explorer_constants["c"].SET_VIEW_BY_PER_PAGE,payload:payload})}};function useExplorerUrlState(){const[legacyExplorerState]=Object(url_state["b"])("mlExplorerSwimlane");return Object(url_state["b"])(ml_url_generator["b"].ANOMALY_EXPLORER,{mlExplorerSwimlane:legacyExplorerState,mlExplorerFilter:{}})}const SHOW_CHARTS_DEFAULT=true;const useShowCharts=()=>{var _explorerUrlState$mlS;const[explorerUrlState,setExplorerUrlState]=useExplorerUrlState();const showCharts=(_explorerUrlState$mlS=explorerUrlState===null||explorerUrlState===void 0?void 0:explorerUrlState.mlShowCharts)!==null&&_explorerUrlState$mlS!==void 0?_explorerUrlState$mlS:SHOW_CHARTS_DEFAULT;const setShowCharts=Object(external_kbnSharedDeps_React_["useCallback"])(v=>{setExplorerUrlState({mlShowCharts:v})},[setExplorerUrlState]);return[showCharts,setShowCharts]};const CheckboxShowCharts=()=>{const[showCharts,setShowCharts]=useShowCharts();const onChange=e=>{setShowCharts(e.target.checked)};const id=Object(external_kbnSharedDeps_React_["useMemo"])(()=>Object(external_kbnSharedDeps_ElasticEui_["htmlIdGenerator"])()(),[]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCheckbox"],{id:id,label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.controls.checkboxShowCharts.showChartsCheckboxLabel",defaultMessage:"Show charts"}),checked:showCharts,onChange:onChange})};const DEFAULT_QUERY_LANG=constants_search["c"].KUERY;function getKqlQueryValues({inputString:inputString,queryLanguage:queryLanguage,indexPattern:indexPattern}){var _influencersFilterQue;let influencersFilterQuery={};const filteredFields=[];const ast=data_public_["esKuery"].fromKueryExpression(inputString);const isAndOperator=ast&&ast.function==="and";if(ast&&Array.isArray(ast.arguments)){ast.arguments.forEach(arg=>{if(arg.arguments!==undefined){arg.arguments.forEach(nestedArg=>{if(typeof nestedArg.value==="string"){filteredFields.push(nestedArg.value)}})}else if(typeof arg.value==="string"){filteredFields.push(arg.value)}})}if(queryLanguage===constants_search["c"].KUERY){influencersFilterQuery=data_public_["esKuery"].toElasticsearchQuery(data_public_["esKuery"].fromKueryExpression(inputString),indexPattern)}else if(queryLanguage===constants_search["c"].LUCENE){influencersFilterQuery=data_public_["esQuery"].luceneStringToDsl(inputString)}const clearSettings=((_influencersFilterQue=influencersFilterQuery)===null||_influencersFilterQue===void 0?void 0:_influencersFilterQue.match_all)&&Object.keys(influencersFilterQuery.match_all).length===0;return{clearSettings:clearSettings,settings:{filterQuery:influencersFilterQuery,queryString:inputString,tableQueryString:inputString,isAndOperator:isAndOperator,filteredFields:filteredFields}}}function getInitSearchInputState({filterActive:filterActive,queryString:queryString}){if(queryString!==undefined&&filterActive===true){return{language:constants_search["c"].KUERY,query:queryString}}else{return{query:"",language:DEFAULT_QUERY_LANG}}}const ExplorerQueryBar=({filterActive:filterActive,filterIconTriggeredQuery:filterIconTriggeredQuery,filterPlaceHolder:filterPlaceHolder,indexPattern:indexPattern,queryString:queryString,updateLanguage:updateLanguage})=>{const[searchInput,setSearchInput]=Object(external_kbnSharedDeps_React_["useState"])(getInitSearchInputState({filterActive:filterActive,queryString:queryString}));const[errorMessage,setErrorMessage]=Object(external_kbnSharedDeps_React_["useState"])(undefined);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(filterIconTriggeredQuery!==undefined){setSearchInput({language:searchInput.language,query:filterIconTriggeredQuery})}},[filterIconTriggeredQuery]);const searchChangeHandler=query=>{if(searchInput.language!==query.language){updateLanguage(query.language)}setSearchInput(query)};const applyInfluencersFilterQuery=query=>{try{const{clearSettings:clearSettings,settings:settings}=getKqlQueryValues({inputString:query.query,queryLanguage:query.language,indexPattern:indexPattern});if(clearSettings===true){explorerService.clearInfluencerFilterSettings()}else{explorerService.setInfluencerFilterSettings(settings)}}catch(e){console.log("Invalid query syntax in search bar",e);setErrorMessage({query:query.query,message:e.message})}};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiInputPopover"],{style:{maxWidth:"100%"},closePopover:()=>setErrorMessage(undefined),input:external_kbnSharedDeps_React_default.a.createElement(data_public_["QueryStringInput"],{bubbleSubmitEvent:false,query:searchInput,indexPatterns:[indexPattern],onChange:searchChangeHandler,onSubmit:applyInfluencersFilterQuery,placeholder:filterPlaceHolder,disableAutoFocus:true,dataTestSubj:"explorerQueryInput",languageSwitcherPopoverAnchorPosition:"rightDown"}),isOpen:(errorMessage===null||errorMessage===void 0?void 0:errorMessage.query)===searchInput.query&&(errorMessage===null||errorMessage===void 0?void 0:errorMessage.message)!==""},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCode"],null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.invalidKuerySyntaxErrorMessageQueryBar",{defaultMessage:"Invalid query"}),": ",errorMessage===null||errorMessage===void 0?void 0:errorMessage.message.split("\n")[0]))};var anomaly_swimlane_embeddable=__webpack_require__(266);var dashboard_public_=__webpack_require__(49);function dashboardServiceProvider(savedObjectClient,kibanaVersion,dashboardUrlGenerator){const generateId=Object(external_kbnSharedDeps_ElasticEui_["htmlIdGenerator"])();const DEFAULT_PANEL_WIDTH=24;const DEFAULT_PANEL_HEIGHT=15;return{async fetchDashboards(query){return await savedObjectClient.find({type:"dashboard",perPage:1e3,search:query?`${query}*`:"",searchFields:["title^3","description"]})},getLastPanel(panels){return panels.length>0?panels.reduce((prev,current)=>prev.gridData.y>=current.gridData.y?prev.gridData.y===current.gridData.y?prev.gridData.x>current.gridData.x?prev:current:prev:current):null},async attachPanels(dashboardId,dashboardAttributes,panelsData){const panels=JSON.parse(dashboardAttributes.panelsJSON);const version=kibanaVersion;const rowWidth=DEFAULT_PANEL_WIDTH*2;for(const panelData of panelsData){const panelIndex=generateId();const lastPanel=this.getLastPanel(panels);const xOffset=lastPanel?lastPanel.gridData.w+lastPanel.gridData.x:0;const availableRowSpace=rowWidth-xOffset;const xPosition=availableRowSpace-DEFAULT_PANEL_WIDTH>=0?xOffset:0;panels.push({panelIndex:panelIndex,embeddableConfig:panelData.embeddableConfig,title:panelData.title,type:panelData.type,version:version,gridData:{h:DEFAULT_PANEL_HEIGHT,i:panelIndex,w:DEFAULT_PANEL_WIDTH,x:xPosition,y:lastPanel?xPosition>0?lastPanel.gridData.y:lastPanel.gridData.y+lastPanel.gridData.h:0}})}await savedObjectClient.update("dashboard",dashboardId,{...dashboardAttributes,panelsJSON:JSON.stringify(panels)})},async getDashboardEditUrl(dashboardId){return await dashboardUrlGenerator.createUrl({dashboardId:dashboardId,useHash:false,viewMode:embeddable_public_["ViewMode"].EDIT})}}}function useDashboardService(){const{services:{savedObjects:{client:savedObjectClient},kibanaVersion:kibanaVersion,share:{urlGenerators:urlGenerators}}}=Object(contexts_kibana["b"])();return Object(external_kbnSharedDeps_React_["useMemo"])(()=>dashboardServiceProvider(savedObjectClient,kibanaVersion,urlGenerators.getUrlGenerator(dashboard_public_["DASHBOARD_APP_URL_GENERATOR"])),[savedObjectClient,kibanaVersion])}var embeddables=__webpack_require__(89);function getDefaultEmbeddablepaPanelConfig(jobIds){return{type:embeddables["ANOMALY_SWIMLANE_EMBEDDABLE_TYPE"],title:Object(anomaly_swimlane_embeddable["getDefaultPanelTitle"])(jobIds)}}const AddToDashboardControl=({onClose:onClose,jobIds:jobIds,viewBy:viewBy})=>{const{notifications:{toasts:toasts},services:{application:{navigateToUrl:navigateToUrl}}}=Object(contexts_kibana["b"])();Object(external_kbnSharedDeps_React_["useEffect"])(()=>{fetchDashboards();return()=>{fetchDashboards.cancel()}},[]);const dashboardService=useDashboardService();const[isLoading,setIsLoading]=Object(external_kbnSharedDeps_React_["useState"])(false);const[selectedSwimlanes,setSelectedSwimlanes]=Object(external_kbnSharedDeps_React_["useState"])({[explorer_constants["h"].OVERALL]:true,[explorer_constants["h"].VIEW_BY]:false});const[dashboardItems,setDashboardItems]=Object(external_kbnSharedDeps_React_["useState"])([]);const[selectedItems,setSelectedItems]=Object(external_kbnSharedDeps_React_["useState"])([]);const fetchDashboards=Object(external_kbnSharedDeps_React_["useCallback"])(Object(external_kbnSharedDeps_Lodash_["debounce"])(async query=>{try{const response=await dashboardService.fetchDashboards(query);const items=response.savedObjects.map(savedObject=>({id:savedObject.id,title:savedObject.attributes.title,description:savedObject.attributes.description,attributes:savedObject.attributes}));setDashboardItems(items)}catch(e){toasts.danger({body:e})}setIsLoading(false)},500),[]);const search=Object(external_kbnSharedDeps_React_["useMemo"])(()=>({onChange:({queryText:queryText})=>{setIsLoading(true);fetchDashboards(queryText)},box:{incremental:true,"data-test-subj":"mlDashboardsSearchBox"}}),[]);const addSwimlaneToDashboardCallback=Object(external_kbnSharedDeps_React_["useCallback"])(async()=>{const swimlanes=Object.entries(selectedSwimlanes).filter(([,isSelected])=>isSelected).map(([swimlaneType])=>swimlaneType);for(const selectedDashboard of selectedItems){const panelsData=swimlanes.map(swimlaneType=>{const config=getDefaultEmbeddablepaPanelConfig(jobIds);if(swimlaneType===explorer_constants["h"].VIEW_BY){return{...config,embeddableConfig:{jobIds:jobIds,swimlaneType:swimlaneType,viewBy:viewBy}}}return{...config,embeddableConfig:{jobIds:jobIds,swimlaneType:swimlaneType}}});try{await dashboardService.attachPanels(selectedDashboard.id,selectedDashboard.attributes,panelsData);toasts.success({title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.dashboardsTable.savedSuccessfullyTitle",defaultMessage:'Dashboard "{dashboardTitle}" updated successfully',values:{dashboardTitle:selectedDashboard.title}}),toastLifeTimeMs:3e3})}catch(e){toasts.danger({body:e})}}},[selectedSwimlanes,selectedItems]);const columns=[{field:"title",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.dashboardsTable.titleColumnHeader",{defaultMessage:"Title"}),sortable:true,truncateText:true},{field:"description",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.dashboardsTable.descriptionColumnHeader",{defaultMessage:"Description"}),truncateText:true}];const swimlaneTypeOptions=[{id:explorer_constants["h"].OVERALL,label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.overallLabel",{defaultMessage:"Overall"})},{id:explorer_constants["h"].VIEW_BY,label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.viewByFieldLabel",{defaultMessage:"View by {viewByField}",values:{viewByField:viewBy}})}];const selection={onSelectionChange:setSelectedItems};const noSwimlaneSelected=Object.values(selectedSwimlanes).every(isSelected=>!isSelected);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModal"],{onClose:onClose.bind(null,undefined),"data-test-subj":"mlAddToDashboardModal"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalHeaderTitle"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.dashboardsTitle",defaultMessage:"Add swim lanes to dashboards"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.addToDashboard.selectSwimlanesLabel",defaultMessage:"Select swim lane view:"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCheckboxGroup"],{options:swimlaneTypeOptions,idToSelectedMap:selectedSwimlanes,onChange:optionId=>{const newSelection={...selectedSwimlanes,[optionId]:!selectedSwimlanes[optionId]};setSelectedSwimlanes(newSelection)},"data-test-subj":"mlAddToDashboardSwimlaneTypeSelector"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true,label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.addToDashboard.selectDashboardsLabel",defaultMessage:"Select dashboards:"}),"data-test-subj":"mlDashboardSelectionContainer"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiInMemoryTable"],{itemId:"id",isSelectable:true,selection:selection,items:dashboardItems,loading:isLoading,columns:columns,search:search,pagination:true,sorting:true,"data-test-subj":"mlDashboardSelectionTable"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalFooter"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:onClose.bind(null,undefined)},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.addToDashboard.cancelButtonLabel",defaultMessage:"Cancel"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{disabled:noSwimlaneSelected||selectedItems.length!==1,onClick:async()=>{onClose(async()=>{const selectedDashboardId=selectedItems[0].id;await addSwimlaneToDashboardCallback();await navigateToUrl(await dashboardService.getDashboardEditUrl(selectedDashboardId))})},"data-test-subj":"mlAddAndEditDashboardButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.dashboardsTable.addAndEditDashboardLabel",defaultMessage:"Add and edit dashboard"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{fill:true,onClick:onClose.bind(null,addSwimlaneToDashboardCallback),disabled:noSwimlaneSelected||selectedItems.length===0,"data-test-subj":"mlAddToDashboardsButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.dashboardsTable.addToDashboardLabel",defaultMessage:"Add to dashboards"}))))};const hasMatchingPoints=({filteredFields:filteredFields=[],swimlaneData:swimlaneData})=>{const wildCardField=filteredFields.find(field=>/\@kuery-wildcard\@$/.test(field));const substring=wildCardField!==undefined?wildCardField.replace(/\@kuery-wildcard\@$/,""):null;return substring!==null&&swimlaneData.points.some(point=>point.laneLabel.includes(substring))};const NoOverallData=()=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.anomalySwimLane.noOverallDataMessage",defaultMessage:"No anomalies found in the overall bucket results for this time range"});function mapSwimlaneOptionsToEuiOptions(options){return options.map(option=>({value:option,text:option}))}const AnomalyTimeline=external_kbnSharedDeps_React_default.a.memo(({explorerState:explorerState,setSelectedCells:setSelectedCells})=>{var _capabilities$dashboa,_capabilities$dashboa2,_selectedJobs$length;const{services:{uiSettings:uiSettings,application:{capabilities:capabilities}}}=Object(contexts_kibana["b"])();const[isMenuOpen,setIsMenuOpen]=Object(external_kbnSharedDeps_React_["useState"])(false);const[isAddDashboardsActive,setIsAddDashboardActive]=Object(external_kbnSharedDeps_React_["useState"])(false);const canEditDashboards=(_capabilities$dashboa=(_capabilities$dashboa2=capabilities.dashboard)===null||_capabilities$dashboa2===void 0?void 0:_capabilities$dashboa2.createNew)!==null&&_capabilities$dashboa!==void 0?_capabilities$dashboa:false;const timeBuckets=Object(external_kbnSharedDeps_React_["useMemo"])(()=>new time_buckets["a"]({"histogram:maxBars":uiSettings.get(common_["UI_SETTINGS"].HISTOGRAM_MAX_BARS),"histogram:barTarget":uiSettings.get(common_["UI_SETTINGS"].HISTOGRAM_BAR_TARGET),dateFormat:uiSettings.get("dateFormat"),"dateFormat:scaled":uiSettings.get("dateFormat:scaled")}),[uiSettings]);const{filterActive:filterActive,filteredFields:filteredFields,maskAll:maskAll,overallSwimlaneData:overallSwimlaneData,selectedCells:selectedCells,viewByLoadedForTimeFormatted:viewByLoadedForTimeFormatted,viewBySwimlaneData:viewBySwimlaneData,viewBySwimlaneDataLoading:viewBySwimlaneDataLoading,viewBySwimlaneFieldName:viewBySwimlaneFieldName,viewBySwimlaneOptions:viewBySwimlaneOptions,selectedJobs:selectedJobs,viewByFromPage:viewByFromPage,viewByPerPage:viewByPerPage,swimlaneLimit:swimlaneLimit,loading:loading}=explorerState;const menuItems=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{const items=[];if(canEditDashboards){items.push(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiContextMenuItem"],{key:"addToDashboard",onClick:setIsAddDashboardActive.bind(null,true),"data-test-subj":"mlAnomalyTimelinePanelAddToDashboardButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.addToDashboardLabel",defaultMessage:"Add to dashboard"})))}return items},[canEditDashboards]);const overallCellSelection=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{if(!selectedCells)return;if(selectedCells.type===explorer_constants["h"].OVERALL)return selectedCells;return{type:explorer_constants["h"].OVERALL,lanes:[explorer_constants["g"]],times:selectedCells.times}},[selectedCells]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],{paddingSize:"m"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"row",gutterSize:"m",responsive:false,alignItems:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{className:"panel-title"},external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.anomalyTimelineTitle",defaultMessage:"Anomaly timeline"})))),viewBySwimlaneOptions.length>0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement("span",{className:"eui-textNoWrap"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.viewByLabel",defaultMessage:"View by"})),display:"columnCompressed"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{compressed:true,id:"selectViewBy",options:mapSwimlaneOptionsToEuiOptions(viewBySwimlaneOptions),value:viewBySwimlaneFieldName,onChange:e=>explorerService.setViewBySwimlaneFieldName(e.target.value)}))),selectedCells?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{size:"xs",onClick:setSelectedCells.bind(null,undefined)},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.clearSelectionLabel",defaultMessage:"Clear selection"}))):null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:{alignSelf:"center"}},external_kbnSharedDeps_React_default.a.createElement("div",{className:"panel-sub-title"},viewByLoadedForTimeFormatted&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.sortedByMaxAnomalyScoreForTimeFormattedLabel",defaultMessage:"(Sorted by max anomaly score for {viewByLoadedForTimeFormatted})",values:{viewByLoadedForTimeFormatted:viewByLoadedForTimeFormatted}}),viewByLoadedForTimeFormatted===undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.sortedByMaxAnomalyScoreLabel",defaultMessage:"(Sorted by max anomaly score)"}),filterActive===true&&viewBySwimlaneFieldName===explorer_constants["j"]&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.jobScoreAcrossAllInfluencersLabel",defaultMessage:"(Job score across all influencers)"})))),menuItems.length>0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:{marginLeft:"auto",alignSelf:"baseline"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopover"],{button:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{size:"s","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.swimlaneActions",{defaultMessage:"Actions"}),color:"subdued",iconType:"boxesHorizontal",onClick:setIsMenuOpen.bind(null,!isMenuOpen),"data-test-subj":"mlAnomalyTimelinePanelMenu"}),isOpen:isMenuOpen,closePopover:setIsMenuOpen.bind(null,false),panelPaddingSize:"none",anchorPosition:"downLeft"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiContextMenuPanel"],{items:menuItems})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(swimlane_container["b"],{id:"overall","data-test-subj":"mlAnomalyExplorerSwimlaneOverall",filterActive:filterActive,maskAll:maskAll,timeBuckets:timeBuckets,swimlaneData:overallSwimlaneData,swimlaneType:explorer_constants["h"].OVERALL,selection:overallCellSelection,onCellsSelection:setSelectedCells,onResize:explorerService.setSwimlaneContainerWidth,isLoading:loading,noDataWarning:external_kbnSharedDeps_React_default.a.createElement(NoOverallData,null),showTimeline:false}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),viewBySwimlaneOptions.length>0&&external_kbnSharedDeps_React_default.a.createElement(swimlane_container["b"],{id:"view_by","data-test-subj":"mlAnomalyExplorerSwimlaneViewBy",filterActive:filterActive,maskAll:maskAll&&!hasMatchingPoints({filteredFields:filteredFields,swimlaneData:viewBySwimlaneData}),timeBuckets:timeBuckets,swimlaneData:viewBySwimlaneData,swimlaneType:explorer_constants["h"].VIEW_BY,selection:selectedCells,onCellsSelection:setSelectedCells,onResize:explorerService.setSwimlaneContainerWidth,fromPage:viewByFromPage,perPage:viewByPerPage,swimlaneLimit:swimlaneLimit,onPaginationChange:({perPage:perPageUpdate,fromPage:fromPageUpdate})=>{if(perPageUpdate){explorerService.setViewByPerPage(perPageUpdate)}if(fromPageUpdate){explorerService.setViewByFromPage(fromPageUpdate)}},isLoading:loading||viewBySwimlaneDataLoading,noDataWarning:typeof viewBySwimlaneFieldName==="string"?viewBySwimlaneFieldName===explorer_constants["j"]?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.noResultForSelectedJobsMessage",defaultMessage:"No results found for selected {jobsCount, plural, one {job} other {jobs}}",values:{jobsCount:(_selectedJobs$length=selectedJobs===null||selectedJobs===void 0?void 0:selectedJobs.length)!==null&&_selectedJobs$length!==void 0?_selectedJobs$length:1}}):external_kbnSharedDeps_React_default.a.createElement(ExplorerNoInfluencersFound,{viewBySwimlaneFieldName:viewBySwimlaneFieldName,showFilterMessage:filterActive===true}):null})),isAddDashboardsActive&&selectedJobs&&external_kbnSharedDeps_React_default.a.createElement(AddToDashboardControl,{onClose:async callback=>{setIsAddDashboardActive(false);if(callback){await callback()}},jobIds:selectedJobs.map(({id:id})=>id),viewBy:viewBySwimlaneFieldName}))},(prevProps,nextProps)=>Object(external_kbnSharedDeps_Lodash_["isEqual"])(prevProps.explorerState,nextProps.explorerState));var external_kbnSharedDeps_Jquery_=__webpack_require__(55);var external_kbnSharedDeps_Jquery_default=__webpack_require__.n(external_kbnSharedDeps_Jquery_);const CONTENT_WRAPPER_HEIGHT=215;const Y_AXIS_LABEL_THRESHOLD=10;class explorer_chart_distribution_ExplorerChartDistribution extends external_kbnSharedDeps_React_default.a.Component{componentDidMount(){this.renderChart()}componentDidUpdate(){this.renderChart()}renderChart(){const{tooManyBuckets:tooManyBuckets,tooltipService:tooltipService}=this.props;const element=this.rootNode;const config=this.props.seriesConfig;const severity=this.props.severity;if(typeof config==="undefined"||Array.isArray(config.chartData)===false){return}const fieldFormat=field_format_service["a"].getFieldFormat(config.jobId,config.detectorIndex);let vizWidth=0;const chartHeight=170;const LINE_CHART_ANOMALY_RADIUS=7;const SCHEDULED_EVENT_MARKER_HEIGHT=5;const chartType=getChartType(config);const margin={top:10,right:0,bottom:30,left:0};if(chartType===explorer_constants["b"].POPULATION_DISTRIBUTION){margin.left=60}let lineChartXScale=null;let lineChartYScale=null;let lineChartGroup;let lineChartValuesLine=null;const CHART_Y_ATTRIBUTE=chartType===explorer_constants["b"].EVENT_DISTRIBUTION?"entity":"value";let highlight=config.chartData.find(d=>d.anomalyScore!==undefined);highlight=highlight&&highlight.entity;const filteredChartData=init(config);drawRareChart(filteredChartData);function init({chartData:chartData,functionDescription:functionDescription}){const $el=external_kbnSharedDeps_Jquery_default()(".ml-explorer-chart");const chartElement=d3_default.a.select(element).select(".content-wrapper");chartElement.select("svg").remove();const svgWidth=$el.width();const svgHeight=chartHeight+margin.top+margin.bottom;const svg=chartElement.append("svg").classed("ml-explorer-chart-svg",true).attr("width",svgWidth).attr("height",svgHeight);const categoryLimit=30;const scaleCategories=d3_default.a.nest().key(d=>d.entity).entries(chartData).sort((a,b)=>b.values.length-a.values.length).filter((d,i)=>{if(chartType===explorer_constants["b"].EVENT_DISTRIBUTION){return i<categoryLimit||d.key===highlight}return true}).map(d=>d.key);chartData=chartData.filter(d=>scaleCategories.includes(d.entity));if(chartType===explorer_constants["b"].POPULATION_DISTRIBUTION){const focusData=chartData.filter(d=>d.entity===highlight);const{min:yScaleDomainMin,max:yScaleDomainMax}=chartExtendedLimits(focusData,functionDescription);chartData=chartData.filter(d=>d.value<=yScaleDomainMax);lineChartYScale=d3_default.a.scale.linear().range([chartHeight,0]).domain([yScaleDomainMin<0?yScaleDomainMin:0,yScaleDomainMax]).nice()}else if(chartType===explorer_constants["b"].EVENT_DISTRIBUTION){const rowMargin=5;lineChartYScale=d3_default.a.scale.ordinal().rangePoints([rowMargin,chartHeight-rowMargin]).domain(scaleCategories)}else{throw`chartType '${chartType}' not supported`}const yAxis=d3_default.a.svg.axis().scale(lineChartYScale).orient("left").innerTickSize(0).outerTickSize(0).tickPadding(10);let maxYAxisLabelWidth=0;const tempLabelText=svg.append("g").attr("class","temp-axis-label tick");const tempLabelTextData=chartType===explorer_constants["b"].POPULATION_DISTRIBUTION?lineChartYScale.ticks():scaleCategories;tempLabelText.selectAll("text.temp.axis").data(tempLabelTextData).enter().append("text").text(d=>{if(fieldFormat!==undefined){return fieldFormat.convert(d,"text")}else{if(chartType===explorer_constants["b"].POPULATION_DISTRIBUTION){return lineChartYScale.tickFormat()(d)}return d}}).each((function(){maxYAxisLabelWidth=Math.max(this.getBBox().width+yAxis.tickPadding(),maxYAxisLabelWidth)})).remove();d3_default.a.select(".temp-axis-label").remove();if(chartType===explorer_constants["b"].POPULATION_DISTRIBUTION||chartType===explorer_constants["b"].EVENT_DISTRIBUTION&&scaleCategories.length<=Y_AXIS_LABEL_THRESHOLD){margin.left=Math.max(maxYAxisLabelWidth,40)}vizWidth=svgWidth-margin.left-margin.right;lineChartXScale=d3_default.a.time.scale().range([0,vizWidth]).domain([config.plotEarliest,config.plotLatest]);lineChartValuesLine=d3_default.a.svg.line().x(d=>lineChartXScale(d.date)).y(d=>lineChartYScale(d[CHART_Y_ATTRIBUTE])).defined(d=>d.value!==null);lineChartGroup=svg.append("g").attr("class","line-chart").attr("transform","translate("+margin.left+","+margin.top+")");return chartData}function drawRareChart(data){lineChartGroup.append("rect").attr("x",0).attr("y",0).attr("height",chartHeight).attr("width",vizWidth).style("stroke","#cccccc").style("fill","none").style("stroke-width",1);drawRareChartAxes();drawRareChartHighlightedSpan();drawRareChartDots(data,lineChartGroup,lineChartValuesLine);drawRareChartMarkers(data)}function drawRareChartAxes(){const timeBuckets=Object(time_buckets["c"])();const bounds={min:external_kbnSharedDeps_Moment_default()(config.plotEarliest),max:external_kbnSharedDeps_Moment_default()(config.plotLatest)};timeBuckets.setBounds(bounds);timeBuckets.setInterval("auto");const xAxisTickFormat=timeBuckets.getScaledDateFormat();const tickValuesStart=Math.max(config.selectedEarliest,config.plotEarliest);const interval=config.selectedLatest-config.selectedEarliest+1;const tickValues=getTickValues(tickValuesStart,interval,config.plotEarliest,config.plotLatest);const xAxis=d3_default.a.svg.axis().scale(lineChartXScale).orient("bottom").innerTickSize(-chartHeight).outerTickSize(0).tickPadding(10).tickFormat(d=>external_kbnSharedDeps_Moment_default()(d).format(xAxisTickFormat));if(tooManyBuckets===false){xAxis.tickValues(tickValues)}else{xAxis.ticks(numTicksForDateFormat(vizWidth,xAxisTickFormat))}const yAxis=d3_default.a.svg.axis().scale(lineChartYScale).orient("left").innerTickSize(0).outerTickSize(0).tickPadding(10);if(fieldFormat!==undefined){yAxis.tickFormat(d=>fieldFormat.convert(d,"text"))}const axes=lineChartGroup.append("g");const gAxis=axes.append("g").attr("class","x axis").attr("transform","translate(0,"+chartHeight+")").call(xAxis);axes.append("g").attr("class","y axis").call(yAxis);if(chartType===explorer_constants["b"].EVENT_DISTRIBUTION){axes.select(".y").selectAll("text").each((function(d){d3_default.a.select(this).classed("ml-explorer-chart-axis-emphasis",d===highlight)}))}if(tooManyBuckets===false){removeLabelOverlap(gAxis,tickValuesStart,interval,vizWidth)}}function drawRareChartDots(dotsData,rareChartGroup,rareChartValuesLine,radius=1.5){const dotGroup=rareChartGroup.select(".values-dots").empty()?rareChartGroup.append("g").classed("values-dots",true):rareChartGroup.select(".values-dots");const dots=dotGroup.selectAll("circle").data(dotsData);dots.enter().append("circle").classed("values-dots-circle",true).classed("values-dots-circle-blur",d=>d.entity!==highlight).attr("r",d=>d.entity===highlight?radius*1.5:radius);dots.attr("cx",rareChartValuesLine.x()).attr("cy",rareChartValuesLine.y());dots.exit().remove()}function drawRareChartHighlightedSpan(){const rectStart=Math.max(config.selectedEarliest,config.plotEarliest);const rectEnd=Math.min(config.selectedLatest,config.plotLatest);const rectWidth=lineChartXScale(rectEnd)-lineChartXScale(rectStart);lineChartGroup.append("rect").attr("class","selected-interval").attr("x",lineChartXScale(new Date(rectStart))+2).attr("y",2).attr("rx",3).attr("ry",3).attr("width",rectWidth-4).attr("height",chartHeight-4)}function drawRareChartMarkers(data){const dots=lineChartGroup.append("g").attr("class","chart-markers").selectAll(".metric-value").data(data.filter(d=>d.value!==null));dots.exit().remove();dots.enter().append("circle").attr("r",LINE_CHART_ANOMALY_RADIUS).on("mouseover",(function(d){showLineChartTooltip(d,this)})).on("mouseout",()=>tooltipService.hide());dots.attr("cx",d=>lineChartXScale(d.date)).attr("cy",d=>lineChartYScale(d[CHART_Y_ATTRIBUTE])).attr("class",d=>{let markerClass="metric-value";if(d.anomalyScore!==undefined&&Number(d.anomalyScore)>=severity){markerClass+=" anomaly-marker ";markerClass+=Object(anomaly_utils["k"])(d.anomalyScore).id}return markerClass});const scheduledEventMarkers=lineChartGroup.select(".chart-markers").selectAll(".scheduled-event-marker").data(data.filter(d=>d.scheduledEvents!==undefined));scheduledEventMarkers.exit().remove();scheduledEventMarkers.enter().append("rect").attr("width",LINE_CHART_ANOMALY_RADIUS*2).attr("height",SCHEDULED_EVENT_MARKER_HEIGHT).attr("class","scheduled-event-marker").attr("rx",1).attr("ry",1);scheduledEventMarkers.attr("x",d=>lineChartXScale(d.date)-LINE_CHART_ANOMALY_RADIUS).attr("y",d=>lineChartYScale(d[CHART_Y_ATTRIBUTE])-SCHEDULED_EVENT_MARKER_HEIGHT/2)}function showLineChartTooltip(marker,circle){const formattedDate=Object(date_utils["b"])(marker.date);const tooltipData=[{label:formattedDate}];const seriesKey=config.detectorLabel;if(marker.entity!==undefined){tooltipData.push({label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.distributionChart.entityLabel",{defaultMessage:"entity"}),value:marker.entity,seriesIdentifier:{key:seriesKey},valueAccessor:"entity"})}if(marker.anomalyScore!==undefined){const score=parseInt(marker.anomalyScore);const displayScore=Object(anomaly_utils["f"])(score);tooltipData.push({label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.distributionChart.anomalyScoreLabel",{defaultMessage:"anomaly score"}),value:displayScore,color:Object(anomaly_utils["i"])(score),seriesIdentifier:{key:seriesKey},valueAccessor:"anomaly_score"});if(chartType!==explorer_constants["b"].EVENT_DISTRIBUTION){tooltipData.push({label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.distributionChart.valueLabel",{defaultMessage:"value"}),value:Object(format_value["b"])(marker.value,config.functionDescription,fieldFormat),seriesIdentifier:{key:seriesKey},valueAccessor:"value"});if(typeof marker.numberOfCauses==="undefined"||marker.numberOfCauses===1){tooltipData.push({label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.distributionChart.typicalLabel",{defaultMessage:"typical"}),value:Object(format_value["b"])(marker.typical,config.functionDescription,fieldFormat),seriesIdentifier:{key:seriesKey},valueAccessor:"typical"})}if(typeof marker.byFieldName!=="undefined"&&marker.numberOfCauses!==undefined){tooltipData.push({label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.distributionChart.unusualByFieldValuesLabel",{defaultMessage:"{ numberOfCauses, plural, one {# unusual {byFieldName} value} other {#{plusSign} unusual {byFieldName} values}}",values:{numberOfCauses:marker.numberOfCauses,byFieldName:marker.byFieldName,plusSign:marker.numberOfCauses<10?"":"+"}}),seriesIdentifier:{key:seriesKey},valueAccessor:"numberOfCauses"})}}}else if(chartType!==explorer_constants["b"].EVENT_DISTRIBUTION){tooltipData.push({label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.distributionChart.valueWithoutAnomalyScoreLabel",{defaultMessage:"value"}),value:Object(format_value["b"])(marker.value,config.functionDescription,fieldFormat),seriesIdentifier:{key:seriesKey},valueAccessor:"value"})}if(marker.scheduledEvents!==undefined){marker.scheduledEvents.forEach((scheduledEvent,i)=>{tooltipData.push({label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.timeSeriesExplorer.timeSeriesChart.scheduledEventsLabel",{defaultMessage:"scheduled event{counter}",values:{counter:marker.scheduledEvents.length>1?` #${i+1}`:""}}),value:scheduledEvent,seriesIdentifier:{key:seriesKey},valueAccessor:`scheduled_events_${i+1}`})})}tooltipService.show(tooltipData,circle,{x:LINE_CHART_ANOMALY_RADIUS*3,y:LINE_CHART_ANOMALY_RADIUS*2})}}shouldComponentUpdate(){return true}setRef(componentNode){this.rootNode=componentNode}render(){const{seriesConfig:seriesConfig}=this.props;if(typeof seriesConfig==="undefined"){return null}const isLoading=seriesConfig.loading;return external_kbnSharedDeps_React_default.a.createElement("div",{className:"ml-explorer-chart",ref:this.setRef.bind(this)},isLoading&&external_kbnSharedDeps_React_default.a.createElement(loading_indicator_LoadingIndicator,{height:CONTENT_WRAPPER_HEIGHT}),!isLoading&&external_kbnSharedDeps_React_default.a.createElement("div",{className:"content-wrapper"}))}}const explorer_chart_single_metric_CONTENT_WRAPPER_HEIGHT=215;const CONTENT_WRAPPER_CLASS="ml-explorer-chart-content-wrapper";class explorer_chart_single_metric_ExplorerChartSingleMetric extends external_kbnSharedDeps_React_default.a.Component{componentDidMount(){this.renderChart()}componentDidUpdate(){this.renderChart()}renderChart(){const{tooManyBuckets:tooManyBuckets,tooltipService:tooltipService}=this.props;const element=this.rootNode;const config=this.props.seriesConfig;const severity=this.props.severity;if(typeof config==="undefined"||Array.isArray(config.chartData)===false){return}const fieldFormat=field_format_service["a"].getFieldFormat(config.jobId,config.detectorIndex);let vizWidth=0;const chartHeight=170;const margin={top:10,right:0,bottom:30,left:60};let lineChartXScale=null;let lineChartYScale=null;let lineChartGroup;let lineChartValuesLine=null;init(config.chartLimits);drawLineChart(config.chartData);function init(chartLimits){const $el=external_kbnSharedDeps_Jquery_default()(".ml-explorer-chart");const chartElement=d3_default.a.select(element).select(`.${CONTENT_WRAPPER_CLASS}`);chartElement.select("svg").remove();const svgWidth=$el.width();const svgHeight=chartHeight+margin.top+margin.bottom;const svg=chartElement.append("svg").classed("ml-explorer-chart-svg",true).attr("width",svgWidth).attr("height",svgHeight);lineChartYScale=d3_default.a.scale.linear().range([chartHeight,0]).domain([chartLimits.min,chartLimits.max]).nice();const yAxis=d3_default.a.svg.axis().scale(lineChartYScale).orient("left").innerTickSize(0).outerTickSize(0).tickPadding(10);let maxYAxisLabelWidth=0;const tempLabelText=svg.append("g").attr("class","temp-axis-label tick");tempLabelText.selectAll("text.temp.axis").data(lineChartYScale.ticks()).enter().append("text").text(d=>{if(fieldFormat!==undefined){return fieldFormat.convert(d,"text")}else{return lineChartYScale.tickFormat()(d)}}).each((function(){maxYAxisLabelWidth=Math.max(this.getBBox().width+yAxis.tickPadding(),maxYAxisLabelWidth)})).remove();d3_default.a.select(".temp-axis-label").remove();margin.left=Math.max(maxYAxisLabelWidth,40);vizWidth=svgWidth-margin.left-margin.right;lineChartXScale=d3_default.a.time.scale().range([0,vizWidth]).domain([config.plotEarliest,config.plotLatest]);lineChartValuesLine=d3_default.a.svg.line().x(d=>lineChartXScale(d.date)).y(d=>lineChartYScale(d.value)).defined(d=>d.value!==null);lineChartGroup=svg.append("g").attr("class","line-chart").attr("transform","translate("+margin.left+","+margin.top+")")}function drawLineChart(data){lineChartGroup.append("rect").attr("x",0).attr("y",0).attr("height",chartHeight).attr("width",vizWidth).style("stroke","#cccccc").style("fill","none").style("stroke-width",1);drawLineChartAxes();drawLineChartHighlightedSpan();drawLineChartPaths(data);drawLineChartDots(data,lineChartGroup,lineChartValuesLine);drawLineChartMarkers(data)}function drawLineChartAxes(){const timeBuckets=Object(time_buckets["c"])();const bounds={min:external_kbnSharedDeps_Moment_default()(config.plotEarliest),max:external_kbnSharedDeps_Moment_default()(config.plotLatest)};timeBuckets.setBounds(bounds);timeBuckets.setInterval("auto");const xAxisTickFormat=timeBuckets.getScaledDateFormat();const tickValuesStart=Math.max(config.selectedEarliest,config.plotEarliest);const interval=config.selectedLatest-config.selectedEarliest+1;const tickValues=getTickValues(tickValuesStart,interval,config.plotEarliest,config.plotLatest);const xAxis=d3_default.a.svg.axis().scale(lineChartXScale).orient("bottom").innerTickSize(-chartHeight).outerTickSize(0).tickPadding(10).tickFormat(d=>external_kbnSharedDeps_Moment_default()(d).format(xAxisTickFormat));if(tooManyBuckets===false){xAxis.tickValues(tickValues)}else{xAxis.ticks(numTicksForDateFormat(vizWidth,xAxisTickFormat))}const yAxis=d3_default.a.svg.axis().scale(lineChartYScale).orient("left").innerTickSize(0).outerTickSize(0).tickPadding(10);if(fieldFormat!==undefined){yAxis.tickFormat(d=>fieldFormat.convert(d,"text"))}const axes=lineChartGroup.append("g");const gAxis=axes.append("g").attr("class","x axis").attr("transform","translate(0,"+chartHeight+")").call(xAxis);axes.append("g").attr("class","y axis").call(yAxis);if(tooManyBuckets===false){removeLabelOverlap(gAxis,tickValuesStart,interval,vizWidth)}}function drawLineChartHighlightedSpan(){const rectStart=Math.max(config.selectedEarliest,config.plotEarliest);const rectEnd=Math.min(config.selectedLatest,config.plotLatest);const rectWidth=lineChartXScale(rectEnd)-lineChartXScale(rectStart);lineChartGroup.append("rect").attr("class","selected-interval").attr("x",lineChartXScale(new Date(rectStart))+2).attr("y",2).attr("rx",3).attr("ry",3).attr("width",rectWidth-4).attr("height",chartHeight-4)}function drawLineChartPaths(data){lineChartGroup.append("path").attr("class","values-line").attr("d",lineChartValuesLine(data))}function drawLineChartMarkers(data){const dots=lineChartGroup.append("g").attr("class","chart-markers").selectAll(".metric-value").data(data.filter(d=>(d.value!==null||typeof d.anomalyScore==="number")&&!showMultiBucketAnomalyMarker(d)));dots.exit().remove();dots.enter().append("circle").attr("r",chart_utils_LINE_CHART_ANOMALY_RADIUS).on("mouseover",(function(d){showLineChartTooltip(d,this)})).on("mouseout",()=>tooltipService.hide());const isAnomalyVisible=d=>d.anomalyScore!==undefined&&Number(d.anomalyScore)>=severity;dots.attr("cx",d=>lineChartXScale(d.date)).attr("cy",d=>lineChartYScale(d.value)).attr("class",d=>{let markerClass="metric-value";if(isAnomalyVisible(d)){markerClass+=` anomaly-marker ${Object(anomaly_utils["k"])(d.anomalyScore).id}`}return markerClass});const multiBucketMarkers=lineChartGroup.select(".chart-markers").selectAll(".multi-bucket").data(data.filter(d=>isAnomalyVisible(d)&&showMultiBucketAnomalyMarker(d)===true));multiBucketMarkers.exit().remove();multiBucketMarkers.enter().append("path").attr("d",d3_default.a.svg.symbol().size(MULTI_BUCKET_SYMBOL_SIZE).type("cross")).attr("transform",d=>`translate(${lineChartXScale(d.date)}, ${lineChartYScale(d.value)})`).attr("class",d=>`anomaly-marker multi-bucket ${Object(anomaly_utils["k"])(d.anomalyScore).id}`).on("mouseover",(function(d){showLineChartTooltip(d,this)})).on("mouseout",()=>tooltipService.hide());const scheduledEventMarkers=lineChartGroup.select(".chart-markers").selectAll(".scheduled-event-marker").data(data.filter(d=>d.scheduledEvents!==undefined));scheduledEventMarkers.exit().remove();scheduledEventMarkers.enter().append("rect").attr("width",chart_utils_LINE_CHART_ANOMALY_RADIUS*2).attr("height",SCHEDULED_EVENT_SYMBOL_HEIGHT).attr("class","scheduled-event-marker").attr("rx",1).attr("ry",1);scheduledEventMarkers.attr("x",d=>lineChartXScale(d.date)-chart_utils_LINE_CHART_ANOMALY_RADIUS).attr("y",d=>lineChartYScale(d.value)-SCHEDULED_EVENT_SYMBOL_HEIGHT/2)}function showLineChartTooltip(marker,circle){const formattedDate=Object(date_utils["b"])(marker.date);const tooltipData=[{label:formattedDate}];const seriesKey=config.detectorLabel;if(marker.anomalyScore!==undefined){const score=parseInt(marker.anomalyScore);tooltipData.push({label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.singleMetricChart.anomalyScoreLabel",{defaultMessage:"anomaly score"}),value:Object(anomaly_utils["f"])(score),color:Object(anomaly_utils["i"])(score),seriesIdentifier:{key:seriesKey},valueAccessor:"anomaly_score"});if(showMultiBucketAnomalyTooltip(marker)===true){tooltipData.push({label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.singleMetricChart.multiBucketImpactLabel",{defaultMessage:"multi-bucket impact"}),value:Object(anomaly_utils["g"])(marker.multiBucketImpact),seriesIdentifier:{key:seriesKey},valueAccessor:"multi_bucket_impact"})}if(marker.actual!==undefined&&config.functionDescription!=="rare"){tooltipData.push({label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.singleMetricChart.actualLabel",{defaultMessage:"actual"}),value:Object(format_value["b"])(marker.actual,config.functionDescription,fieldFormat),seriesIdentifier:{key:seriesKey},valueAccessor:"actual"});tooltipData.push({label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.singleMetricChart.typicalLabel",{defaultMessage:"typical"}),value:Object(format_value["b"])(marker.typical,config.functionDescription,fieldFormat),seriesIdentifier:{key:seriesKey},valueAccessor:"typical"})}else{tooltipData.push({label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.singleMetricChart.valueLabel",{defaultMessage:"value"}),value:Object(format_value["b"])(marker.value,config.functionDescription,fieldFormat),seriesIdentifier:{key:seriesKey},valueAccessor:"value"});if(marker.byFieldName!==undefined&&marker.numberOfCauses!==undefined){tooltipData.push({label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.distributionChart.unusualByFieldValuesLabel",{defaultMessage:"{ numberOfCauses, plural, one {# unusual {byFieldName} value} other {#{plusSign} unusual {byFieldName} values}}",values:{numberOfCauses:marker.numberOfCauses,byFieldName:marker.byFieldName,plusSign:marker.numberOfCauses<10?"":"+"}}),seriesIdentifier:{key:seriesKey},valueAccessor:"numberOfCauses"})}}}else{tooltipData.push({label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.singleMetricChart.valueWithoutAnomalyScoreLabel",{defaultMessage:"value"}),value:Object(format_value["b"])(marker.value,config.functionDescription,fieldFormat),seriesIdentifier:{key:seriesKey},valueAccessor:"value"})}if(marker.scheduledEvents!==undefined){tooltipData.push({label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.singleMetricChart.scheduledEventsLabel",{defaultMessage:"Scheduled events"}),value:marker.scheduledEvents,seriesIdentifier:{key:seriesKey},valueAccessor:"scheduledEvents"})}tooltipService.show(tooltipData,circle,{x:chart_utils_LINE_CHART_ANOMALY_RADIUS*3,y:chart_utils_LINE_CHART_ANOMALY_RADIUS*2})}}shouldComponentUpdate(){return true}setRef(componentNode){this.rootNode=componentNode}render(){const{seriesConfig:seriesConfig}=this.props;if(typeof seriesConfig==="undefined"){return null}const isLoading=seriesConfig.loading;return external_kbnSharedDeps_React_default.a.createElement("div",{className:"ml-explorer-chart",ref:this.setRef.bind(this)},isLoading&&external_kbnSharedDeps_React_default.a.createElement(loading_indicator_LoadingIndicator,{height:explorer_chart_single_metric_CONTENT_WRAPPER_HEIGHT}),!isLoading&&external_kbnSharedDeps_React_default.a.createElement("div",{className:CONTENT_WRAPPER_CLASS}))}}const FEATURE="Feature";const POINT="Point";const SEVERITY_COLOR_RAMP=[{stop:common["ANOMALY_THRESHOLD"].LOW,color:common["SEVERITY_COLORS"].WARNING},{stop:common["ANOMALY_THRESHOLD"].MINOR,color:common["SEVERITY_COLORS"].MINOR},{stop:common["ANOMALY_THRESHOLD"].MAJOR,color:common["SEVERITY_COLORS"].MAJOR},{stop:common["ANOMALY_THRESHOLD"].CRITICAL,color:common["SEVERITY_COLORS"].CRITICAL}];function getAnomalyFeatures(anomalies,type){const anomalyFeatures=[];for(let i=0;i<anomalies.length;i++){var _anomaly$causes$;const anomaly=anomalies[i];const geoResults=anomaly.geo_results||(anomaly===null||anomaly===void 0?void 0:anomaly.causes)&&(anomaly===null||anomaly===void 0?void 0:(_anomaly$causes$=anomaly.causes[0])===null||_anomaly$causes$===void 0?void 0:_anomaly$causes$.geo_results);const coordinateStr=geoResults&&geoResults[type];if(coordinateStr!==undefined){const coordinates=coordinateStr.split(",").map(point=>Number(point)).reverse();anomalyFeatures.push({type:FEATURE,geometry:{type:POINT,coordinates:coordinates},properties:{record_score:Math.floor(anomaly.record_score),[type]:coordinates.map(point=>point.toFixed(2))}})}}return anomalyFeatures}const getMLAnomaliesTypicalLayer=anomalies=>({id:"anomalies_typical_layer",label:"Typical",sourceDescriptor:{id:"b7486535-171b-4d3b-bb2e-33c1a0a2854e",type:"GEOJSON_FILE",__featureCollection:{features:getAnomalyFeatures(anomalies,"typical_point"),type:"FeatureCollection"}},visible:true,style:{type:"VECTOR",properties:{fillColor:{type:"STATIC",options:{color:"#98A2B2"}},lineColor:{type:"STATIC",options:{color:"#fff"}},lineWidth:{type:"STATIC",options:{size:2}},iconSize:{type:"STATIC",options:{size:6}}}},type:"VECTOR"});const getMLAnomaliesActualLayer=anomalies=>({id:"anomalies_actual_layer",label:"Actual",sourceDescriptor:{id:"b7486535-171b-4d3b-bb2e-33c1a0a2854d",type:"GEOJSON_FILE",__fields:[{name:"record_score",type:"number"}],__featureCollection:{features:getAnomalyFeatures(anomalies,"actual_point"),type:"FeatureCollection"}},visible:true,style:{type:"VECTOR",properties:{fillColor:{type:constants_["STYLE_TYPE"].DYNAMIC,options:{customColorRamp:SEVERITY_COLOR_RAMP,field:{name:"record_score",origin:constants_["FIELD_ORIGIN"].SOURCE},useCustomColorRamp:true}},lineColor:{type:"STATIC",options:{color:"#fff"}},lineWidth:{type:"STATIC",options:{size:2}},iconSize:{type:"STATIC",options:{size:6}}}},type:"VECTOR"});function EmbeddedMapComponentWrapper({seriesConfig:seriesConfig}){const[layerList,setLayerList]=Object(external_kbnSharedDeps_React_["useState"])([]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(seriesConfig.mapData&&seriesConfig.mapData.length>0){setLayerList([getMLAnomaliesActualLayer(seriesConfig.mapData),getMLAnomaliesTypicalLayer(seriesConfig.mapData)])}},[seriesConfig]);return external_kbnSharedDeps_React_default.a.createElement("div",{"data-test-subj":"xpack.ml.explorer.embeddedMap",style:{width:"100%",height:300}},external_kbnSharedDeps_React_default.a.createElement(MlEmbeddedMapComponent,{layerList:layerList}))}var _explorer_chart_label=__webpack_require__(753);function ExplorerChartLabelBadge({entity:entity}){return external_kbnSharedDeps_React_default.a.createElement("span",{className:"ml-explorer-chart-label-badge"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBadge"],{color:"hollow",className:"ml-reset-font-weight"},entity.fieldName," ",external_kbnSharedDeps_React_default.a.createElement("strong",null,entity.fieldValue)))}var _explorer_chart_tooltip=__webpack_require__(762);const CHART_DESCRIPTION={[explorer_constants["b"].EVENT_DISTRIBUTION]:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.charts.infoTooltip.chartEventDistributionDescription",{defaultMessage:"The gray dots depict the approximate distribution of occurrences over time for a sample of {byFieldValuesParam} with"+" more frequent event types at the top and rarer ones at the bottom.",values:{byFieldValuesParam:"by_field_values"}}),[explorer_constants["b"].POPULATION_DISTRIBUTION]:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.charts.infoTooltip.chartPopulationDistributionDescription",{defaultMessage:"The gray dots depict the approximate distribution of values over time for a sample of {overFieldValuesParam}.",values:{overFieldValuesParam:"over_field_values"}})};function TooltipDefinitionList({toolTipData:toolTipData}){return external_kbnSharedDeps_React_default.a.createElement("dl",{className:"mlDescriptionList"},toolTipData.map(({title:title,description:description})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,{key:`${title} ${description}`},external_kbnSharedDeps_React_default.a.createElement("dt",{className:"mlDescriptionList__title"},title),external_kbnSharedDeps_React_default.a.createElement("dd",{className:"mlDescriptionList__description"},description))))}const ExplorerChartInfoTooltip=({jobId:jobId,aggregationInterval:aggregationInterval,chartFunction:chartFunction,chartType:chartType,entityFields:entityFields=[]})=>{const chartDescription=CHART_DESCRIPTION[chartType];const toolTipData=[{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.charts.infoTooltip.jobIdTitle",{defaultMessage:"job ID"}),description:jobId},{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.charts.infoTooltip.aggregationIntervalTitle",{defaultMessage:"aggregation interval"}),description:aggregationInterval},{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.charts.infoTooltip.chartFunctionTitle",{defaultMessage:"chart function"}),description:chartFunction}];entityFields.forEach(entityField=>{toolTipData.push({title:entityField.fieldName,description:entityField.fieldValue})});return external_kbnSharedDeps_React_default.a.createElement("div",{className:"ml-explorer-chart-info-tooltip"},external_kbnSharedDeps_React_default.a.createElement(TooltipDefinitionList,{toolTipData:toolTipData}),chartDescription&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement("div",{className:"ml-explorer-chart-description"},chartDescription)))};function ExplorerChartLabel({detectorLabel:detectorLabel,entityFields:entityFields,infoTooltip:infoTooltip,wrapLabel:wrapLabel=false}){const labelSeparator=wrapLabel===true||entityFields.length===0||detectorLabel.length===0?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null," "):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null," – ");const entityFieldBadges=entityFields.map(entity=>external_kbnSharedDeps_React_default.a.createElement(ExplorerChartLabelBadge,{entity:entity,key:`${entity.fieldName} ${entity.fieldValue}`}));const infoIcon=external_kbnSharedDeps_React_default.a.createElement("span",{className:"ml-explorer-chart-info-icon"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIconTip"],{className:"ml-explorer-chart-eui-icon-tip",content:external_kbnSharedDeps_React_default.a.createElement(ExplorerChartInfoTooltip,infoTooltip),position:"top",size:"s"}));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement("span",{className:"ml-explorer-chart-label"},external_kbnSharedDeps_React_default.a.createElement("span",{className:"ml-explorer-chart-label-detector"},detectorLabel,labelSeparator),wrapLabel&&infoIcon,!wrapLabel&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,entityFieldBadges," ",infoIcon)),wrapLabel&&external_kbnSharedDeps_React_default.a.createElement("span",{className:"ml-explorer-chart-label-badges"},entityFieldBadges))}const ExplorerChartsErrorCallOuts=({errorMessagesByType:errorMessagesByType})=>{if(!errorMessagesByType||Object.keys(errorMessagesByType).length===0)return null;const content=Object.keys(errorMessagesByType).map(errorType=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{color:"warning",size:"s",key:errorType},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorerCharts.errorCallOutMessage",defaultMessage:"You can't view anomaly charts for {jobs} because {reason}.",values:{jobs:[...errorMessagesByType[errorType]].join(", "),reason:errorType}})));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,content,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}))};const textTooManyBuckets=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.charts.tooManyBucketsDescription",{defaultMessage:"This selection contains too many buckets to be displayed. You should shorten the time range of the view or narrow the selection in the timeline."});const textViewButton=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.charts.openInSingleMetricViewerButtonLabel",{defaultMessage:"Open in Single Metric Viewer"});const mapsPluginMessage=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.charts.mapsPluginMissingMessage",{defaultMessage:"maps or embeddable start plugin not found"});function getChartId(series){const{jobId:jobId,detectorLabel:detectorLabel,entityFields:entityFields}=series;const entities=entityFields.map(ef=>`${ef.fieldName}/${ef.fieldValue}`).join(",");const id=`${jobId}_${detectorLabel}_${entities}`;return id}function ExplorerChartContainer({series:series,severity:severity,tooManyBuckets:tooManyBuckets,wrapLabel:wrapLabel,mlUrlGenerator:mlUrlGenerator,basePath:basePath}){const[explorerSeriesLink,setExplorerSeriesLink]=Object(external_kbnSharedDeps_React_["useState"])();Object(external_kbnSharedDeps_React_["useEffect"])(()=>{let isCancelled=false;const generateLink=async()=>{if(!isCancelled&&series.functionDescription!==aggregation_types["b"].LAT_LONG){const singleMetricViewerLink=await getExploreSeriesLink(mlUrlGenerator,series);setExplorerSeriesLink(singleMetricViewerLink)}};generateLink();return()=>{isCancelled=true}},[mlUrlGenerator,series]);const addToRecentlyAccessed=Object(external_kbnSharedDeps_React_["useCallback"])(()=>{Object(recently_accessed["a"])("timeseriesexplorer",series.jobId,explorerSeriesLink)},[explorerSeriesLink]);const{detectorLabel:detectorLabel,entityFields:entityFields}=series;const chartType=getChartType(series);let DetectorLabel=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,detectorLabel);if(chartType===explorer_constants["b"].EVENT_DISTRIBUTION){const byField=series.entityFields.find(d=>d.fieldType==="by");if(typeof byField!=="undefined"){DetectorLabel=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.charts.detectorLabel",defaultMessage:'{detectorLabel}{br}y-axis event distribution split by "{fieldName}"',values:{detectorLabel:detectorLabel,br:external_kbnSharedDeps_React_default.a.createElement("br",null),fieldName:byField.fieldName}}));wrapLabel=true}}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(ExplorerChartLabel,{detectorLabel:DetectorLabel,entityFields:entityFields,infoTooltip:{...series.infoTooltip,chartType:chartType},wrapLabel:wrapLabel})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement("div",{className:"ml-explorer-chart-icons"},tooManyBuckets&&external_kbnSharedDeps_React_default.a.createElement("span",{className:"ml-explorer-chart-icon"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIconTip"],{content:textTooManyBuckets,position:"top",size:"s",type:"alert",color:"warning"})),explorerSeriesLink&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{position:"top",content:textViewButton},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{iconSide:"right",iconType:"visLine",size:"xs",href:`${basePath}/app/ml${explorerSeriesLink}`,onClick:addToRecentlyAccessed},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.charts.viewLabel",defaultMessage:"View"})))))),(()=>{if(chartType===explorer_constants["b"].GEO_MAP){return external_kbnSharedDeps_React_default.a.createElement(chart_tooltip["b"],null,tooltipService=>external_kbnSharedDeps_React_default.a.createElement(EmbeddedMapComponentWrapper,{seriesConfig:series,tooltipService:tooltipService}))}if(chartType===explorer_constants["b"].EVENT_DISTRIBUTION||chartType===explorer_constants["b"].POPULATION_DISTRIBUTION){return external_kbnSharedDeps_React_default.a.createElement(chart_tooltip["b"],null,tooltipService=>external_kbnSharedDeps_React_default.a.createElement(explorer_chart_distribution_ExplorerChartDistribution,{tooManyBuckets:tooManyBuckets,seriesConfig:series,severity:severity,tooltipService:tooltipService}))}if(chartType===explorer_constants["b"].SINGLE_METRIC){return external_kbnSharedDeps_React_default.a.createElement(chart_tooltip["b"],null,tooltipService=>external_kbnSharedDeps_React_default.a.createElement(explorer_chart_single_metric_ExplorerChartSingleMetric,{tooManyBuckets:tooManyBuckets,seriesConfig:series,severity:severity,tooltipService:tooltipService}))}})())}const ExplorerChartsContainerUI=({chartsPerRow:chartsPerRow,seriesToPlot:seriesToPlot,severity:severity,tooManyBuckets:tooManyBuckets,kibana:kibana,errorMessages:errorMessages})=>{const{services:{http:{basePath:basePath},share:{urlGenerators:{getUrlGenerator:getUrlGenerator}},embeddable:embeddablePlugin,maps:mapsPlugin}}=kibana;let seriesToPlotFiltered;if(!embeddablePlugin||!mapsPlugin){seriesToPlotFiltered=[];seriesToPlot.forEach(series=>{if(series.functionDescription==="lat_long"){if(errorMessages[mapsPluginMessage]===undefined){errorMessages[mapsPluginMessage]=new Set([series.jobId])}else{errorMessages[mapsPluginMessage].add(series.jobId)}}else{seriesToPlotFiltered.push(series)}})}const seriesToUse=seriesToPlotFiltered!==undefined?seriesToPlotFiltered:seriesToPlot;const mlUrlGenerator=Object(external_kbnSharedDeps_React_["useMemo"])(()=>getUrlGenerator(ml_url_generator["a"]),[getUrlGenerator]);const chartsWidth=chartsPerRow===1?"calc(100% - 20px)":"auto";const chartsColumns=chartsPerRow===1?0:chartsPerRow;const wrapLabel=seriesToUse.some(series=>isLabelLengthAboveThreshold(series));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(ExplorerChartsErrorCallOuts,{errorMessagesByType:errorMessages}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGrid"],{columns:chartsColumns},seriesToUse.length>0&&seriesToUse.map(series=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{key:getChartId(series),className:"ml-explorer-chart-container",style:{minWidth:chartsWidth}},external_kbnSharedDeps_React_default.a.createElement(ExplorerChartContainer,{series:series,severity:severity,tooManyBuckets:tooManyBuckets,wrapLabel:wrapLabel,mlUrlGenerator:mlUrlGenerator,basePath:basePath.get()})))))};const ExplorerChartsContainer=Object(kibanaReact_public_["withKibana"])(ExplorerChartsContainerUI);function explorer_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const ExplorerPage=({children:children,jobSelectorProps:jobSelectorProps,noInfluencersConfigured:noInfluencersConfigured,influencers:influencers,filterActive:filterActive,filterPlaceHolder:filterPlaceHolder,indexPattern:indexPattern,queryString:queryString,filterIconTriggeredQuery:filterIconTriggeredQuery,updateLanguage:updateLanguage})=>external_kbnSharedDeps_React_default.a.createElement("div",{"data-test-subj":"mlPageAnomalyExplorer"},external_kbnSharedDeps_React_default.a.createElement(navigation_menu["a"],{tabId:"anomaly_detection"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPage"],{style:{background:"none"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageHeaderSection"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center",gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(AnomalyResultsViewSelector,{viewId:"explorer"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{className:"eui-textNoWrap"},external_kbnSharedDeps_React_default.a.createElement("h1",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.pageTitle",defaultMessage:"Anomaly Explorer"})))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageHeaderSection"],{style:{width:"100%"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center",justifyContent:"flexEnd",gutterSize:"s"},noInfluencersConfigured===false&&influencers!==undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement("div",{className:"mlAnomalyExplorer__filterBar"},external_kbnSharedDeps_React_default.a.createElement(ExplorerQueryBar,{filterActive:filterActive,filterPlaceHolder:filterPlaceHolder,indexPattern:indexPattern,queryString:queryString,filterIconTriggeredQuery:filterIconTriggeredQuery,updateLanguage:updateLanguage}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(date_picker_wrapper["a"],null))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"none"}),external_kbnSharedDeps_React_default.a.createElement(job_selector["a"],jobSelectorProps),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"none"}),children)));class explorer_Explorer extends external_kbnSharedDeps_React_default.a.Component{constructor(...args){super(...args);explorer_defineProperty(this,"state",{filterIconTriggeredQuery:undefined,language:DEFAULT_QUERY_LANG});explorer_defineProperty(this,"htmlIdGen",Object(external_kbnSharedDeps_ElasticEui_["htmlIdGenerator"])());explorer_defineProperty(this,"applyFilter",(fieldName,fieldValue,action)=>{const{filterActive:filterActive,indexPattern:indexPattern,queryString:queryString}=this.props.explorerState;let newQueryString="";const operator="and ";const sanitizedFieldName=escapeParens(fieldName);const sanitizedFieldValue=escapeDoubleQuotes(fieldValue);if(action===explorer_constants["d"].ADD){const queryPattern=getQueryPattern(fieldName,fieldValue);if(queryString.match(queryPattern)!==null){return}newQueryString=`${queryString?`${queryString} ${operator}`:""}${sanitizedFieldName}:"${sanitizedFieldValue}"`}else if(action===explorer_constants["d"].REMOVE){if(filterActive===false){return}else{newQueryString=removeFilterFromQueryString(queryString,sanitizedFieldName,sanitizedFieldValue)}}this.setState({filterIconTriggeredQuery:`${newQueryString}`});try{const{clearSettings:clearSettings,settings:settings}=getKqlQueryValues({inputString:`${newQueryString}`,queryLanguage:this.state.language,indexPattern:indexPattern});if(clearSettings===true){explorerService.clearInfluencerFilterSettings()}else{explorerService.setInfluencerFilterSettings(settings)}}catch(e){console.log("Invalid query syntax from table",e);const toastNotifications=Object(dependency_cache["j"])();toastNotifications.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.invalidKuerySyntaxErrorMessageFromTable",{defaultMessage:"Invalid syntax in query bar. The input must be valid Kibana Query Language (KQL)"}))}});explorer_defineProperty(this,"updateLanguage",language=>this.setState({language:language}))}componentDidMount(){const{invalidTimeRangeError:invalidTimeRangeError}=this.props;if(invalidTimeRangeError){const toastNotifications=Object(dependency_cache["j"])();toastNotifications.addWarning(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.invalidTimeRangeInUrlCallout",{defaultMessage:"The time filter was changed to the full range due to an invalid default time filter. Check the advanced settings for {field}.",values:{field:constants_settings["a"]}}))}}render(){var _tableData$anomalies;const{showCharts:showCharts,severity:severity,stoppedPartitions:stoppedPartitions,selectedJobsRunning:selectedJobsRunning}=this.props;const{annotations:annotations,chartsData:chartsData,filterActive:filterActive,filterPlaceHolder:filterPlaceHolder,indexPattern:indexPattern,influencers:influencers,loading:loading,noInfluencersConfigured:noInfluencersConfigured,overallSwimlaneData:overallSwimlaneData,queryString:queryString,selectedCells:selectedCells,selectedJobs:selectedJobs,tableData:tableData}=this.props.explorerState;const{annotationsData:annotationsData,aggregations:aggregations,error:annotationsError}=annotations;const jobSelectorProps={dateFormatTz:getDateFormatTz()};const noJobsFound=selectedJobs===null||selectedJobs.length===0;const hasResults=overallSwimlaneData.points&&overallSwimlaneData.points.length>0;const hasResultsWithAnomalies=hasResults&&overallSwimlaneData.points.some(v=>v.value>0)||((_tableData$anomalies=tableData.anomalies)===null||_tableData$anomalies===void 0?void 0:_tableData$anomalies.length)>0;if(noJobsFound&&!loading){return external_kbnSharedDeps_React_default.a.createElement(ExplorerPage,{jobSelectorProps:jobSelectorProps},external_kbnSharedDeps_React_default.a.createElement(ExplorerNoJobsFound,null))}if(hasResultsWithAnomalies===false&&!loading){return external_kbnSharedDeps_React_default.a.createElement(ExplorerPage,{jobSelectorProps:jobSelectorProps},external_kbnSharedDeps_React_default.a.createElement(ExplorerNoResultsFound,{hasResults:hasResults,selectedJobsRunning:selectedJobsRunning}))}const mainColumnWidthClassName=noInfluencersConfigured===true?"col-xs-12":"col-xs-10";const mainColumnClasses=`column ${mainColumnWidthClassName}`;const timefilter=Object(dependency_cache["i"])();const bounds=timefilter.getActiveBounds();const selectedJobIds=Array.isArray(selectedJobs)?selectedJobs.map(job=>job.id):[];return external_kbnSharedDeps_React_default.a.createElement(ExplorerPage,{jobSelectorProps:jobSelectorProps,noInfluencersConfigured:noInfluencersConfigured,influencers:influencers,filterActive:filterActive,filterPlaceHolder:filterPlaceHolder,filterIconTriggeredQuery:this.state.filterIconTriggeredQuery,indexPattern:indexPattern,queryString:queryString,updateLanguage:this.updateLanguage},external_kbnSharedDeps_React_default.a.createElement("div",{className:"results-container"},noInfluencersConfigured&&external_kbnSharedDeps_React_default.a.createElement("div",{className:"no-influencers-warning"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIconTip"],{content:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.noConfiguredInfluencersTooltip",{defaultMessage:"The Top Influencers list is hidden because no influencers have been configured for the selected jobs."}),position:"right",type:"iInCircle"})),noInfluencersConfigured===false&&external_kbnSharedDeps_React_default.a.createElement("div",{className:"column col-xs-2","data-test-subj":"mlAnomalyExplorerInfluencerList"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{className:"panel-title"},external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.topInfuencersTitle",defaultMessage:"Top influencers"}))),loading?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLoadingContent"],{lines:10}):external_kbnSharedDeps_React_default.a.createElement(InfluencersList,{influencers:influencers,influencerFilter:this.applyFilter})),external_kbnSharedDeps_React_default.a.createElement("div",{className:mainColumnClasses},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),stoppedPartitions&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{size:"s",title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.stoppedPartitionsExistCallout",defaultMessage:"There may be fewer results than there could have been because stop_on_warn is turned on. Both categorization and subsequent anomaly detection have stopped for some partitions in {jobsWithStoppedPartitions, plural, one {job} other {jobs}} [{stoppedPartitions}] where the categorization status has changed to warn.",values:{jobsWithStoppedPartitions:stoppedPartitions.length,stoppedPartitions:stoppedPartitions.join(", ")}})}),external_kbnSharedDeps_React_default.a.createElement(AnomalyTimeline,{explorerState:this.props.explorerState,setSelectedCells:this.props.setSelectedCells}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),annotationsError!==undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{className:"panel-title","data-test-subj":"mlAnomalyExplorerAnnotationsPanel error"},external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.annotationsErrorTitle",defaultMessage:"Annotations"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.annotationsErrorCallOutTitle",{defaultMessage:"An error occurred loading annotations:"}),color:"danger",iconType:"alert"},external_kbnSharedDeps_React_default.a.createElement("p",null,annotationsError))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"})),annotationsData.length>0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],{"data-test-subj":"mlAnomalyExplorerAnnotationsPanel loaded"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiAccordion"],{id:this.htmlIdGen(),buttonContent:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{className:"panel-title"},external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.annotationsTitle",defaultMessage:"Annotations {badge}",values:{badge:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBadge"],{color:"hollow"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.annotationsTitleTotalCount",defaultMessage:"Total: {count}",values:{count:annotationsData.length}}))}})))},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(annotations_table["a"],{jobIds:selectedJobIds,annotations:annotationsData,aggregations:aggregations,drillDown:true,numberBadge:false})))),external_kbnSharedDeps_React_default.a.createElement(annotation_flyout["a"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"})),loading===false&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{className:"panel-title"},external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.explorer.anomaliesTitle",defaultMessage:"Anomalies"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"row",gutterSize:"l",responsive:true,className:"ml-anomalies-controls"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:{width:"170px"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.severityThresholdLabel",{defaultMessage:"Severity threshold"})},external_kbnSharedDeps_React_default.a.createElement(select_severity["b"],null))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:{width:"170px"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.explorer.intervalLabel",{defaultMessage:"Interval"})},external_kbnSharedDeps_React_default.a.createElement(SelectInterval,null))),chartsData.seriesToPlot.length>0&&selectedCells!==undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:{alignSelf:"center"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:"​"},external_kbnSharedDeps_React_default.a.createElement(CheckboxShowCharts,null)))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement("div",{className:"euiText explorer-charts"},showCharts&&external_kbnSharedDeps_React_default.a.createElement(ExplorerChartsContainer,{...chartsData,severity:severity})),external_kbnSharedDeps_React_default.a.createElement(AnomaliesTable,{bounds:bounds,tableData:tableData,influencerFilter:this.applyFilter})))))}}function getInvalidJobIds(jobs,ids){return ids.filter(id=>{const jobExists=jobs.some(job=>job.job_id===id);return jobExists===false&&id!=="*"})}const useJobSelection=jobs=>{var _globalState$ml2,_globalState$ml4;const[globalState,setGlobalState]=Object(url_state["c"])("_g");const{toasts:toastNotifications}=Object(contexts_kibana["f"])();const tmpIds=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{var _globalState$ml;const ids=(globalState===null||globalState===void 0?void 0:(_globalState$ml=globalState.ml)===null||_globalState$ml===void 0?void 0:_globalState$ml.jobIds)||[];return(typeof ids==="string"?[ids]:ids).map(id=>String(id))},[globalState===null||globalState===void 0?void 0:(_globalState$ml2=globalState.ml)===null||_globalState$ml2===void 0?void 0:_globalState$ml2.jobIds]);const invalidIds=Object(external_kbnSharedDeps_React_["useMemo"])(()=>getInvalidJobIds(jobs,tmpIds),[tmpIds]);const validIds=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{const res=Object(external_kbnSharedDeps_Lodash_["difference"])(tmpIds,invalidIds);res.sort();return res},[tmpIds,invalidIds]);const jobSelection=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{var _globalState$ml$group,_globalState$ml3;const selectedGroups=(_globalState$ml$group=globalState===null||globalState===void 0?void 0:(_globalState$ml3=globalState.ml)===null||_globalState$ml3===void 0?void 0:_globalState$ml3.groups)!==null&&_globalState$ml$group!==void 0?_globalState$ml$group:[];return{jobIds:validIds,selectedGroups:selectedGroups}},[validIds,globalState===null||globalState===void 0?void 0:(_globalState$ml4=globalState.ml)===null||_globalState$ml4===void 0?void 0:_globalState$ml4.groups]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(invalidIds.length>0){toastNotifications.addWarning(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobSelect.requestedJobsDoesNotExistWarningMessage",{defaultMessage:`Requested\n{invalidIdsLength, plural, one {job {invalidIds} does not exist} other {jobs {invalidIds} do not exist}}`,values:{invalidIdsLength:invalidIds.length,invalidIds:invalidIds.join()}}))}},[invalidIds]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(validIds.length===0&&jobs.length>0){toastNotifications.addWarning(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobSelect.noJobsSelectedWarningMessage",{defaultMessage:"No jobs selected, auto selecting first job"}));const mlGlobalState=(globalState===null||globalState===void 0?void 0:globalState.ml)||{};mlGlobalState.jobIds=[jobs[0].job_id];const time=Object(job_select_service_utils["b"])(jobs,mlGlobalState.jobIds);setGlobalState({...{ml:mlGlobalState},...time!==undefined?{time:time}:{}})}},[jobs,validIds,setGlobalState,globalState===null||globalState===void 0?void 0:globalState.ml]);return jobSelection};var constants_anomalies=__webpack_require__(1);function explorer_extends(){explorer_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return explorer_extends.apply(this,arguments)}const explorerRouteFactory=(navigateToPath,basePath)=>({path:"/explorer",render:(props,deps)=>external_kbnSharedDeps_React_default.a.createElement(explorer_PageWrapper,explorer_extends({},props,{deps:deps})),breadcrumbs:[getBreadcrumbWithUrlForApp("ML_BREADCRUMB",navigateToPath,basePath),getBreadcrumbWithUrlForApp("ANOMALY_DETECTION_BREADCRUMB",navigateToPath,basePath),{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.anomalyDetection.anomalyExplorerLabel",{defaultMessage:"Anomaly Explorer"}),href:""}]});const explorer_PageWrapper=({deps:deps})=>{const{context:context,results:results}=useResolver(undefined,undefined,deps.config,{...basicResolvers(deps),jobs:job_service["a"].loadJobsWrapper,jobsWithTimeRange:()=>ml_api_service["ml"].jobs.jobsWithTimerange(getDateFormatTz())});const annotationUpdatesService=Object(external_kbnSharedDeps_React_["useMemo"])(()=>new annotations_service["a"],[]);return external_kbnSharedDeps_React_default.a.createElement(PageLoader,{context:context},external_kbnSharedDeps_React_default.a.createElement(ml_annotation_updates_context["a"].Provider,{value:annotationUpdatesService},external_kbnSharedDeps_React_default.a.createElement(ExplorerUrlStateManager,{jobsWithTimeRange:results.jobsWithTimeRange.jobs})))};const ExplorerUrlStateManager=({jobsWithTimeRange:jobsWithTimeRange})=>{var _globalState$time,_globalState$time2,_explorerState$swimla;const[explorerUrlState,setExplorerUrlState]=useExplorerUrlState();const[globalState,setGlobalState]=Object(url_state["c"])("_g");const[lastRefresh,setLastRefresh]=Object(external_kbnSharedDeps_React_["useState"])(0);const[stoppedPartitions,setStoppedPartitions]=Object(external_kbnSharedDeps_React_["useState"])();const[invalidTimeRangeError,setInValidTimeRangeError]=Object(external_kbnSharedDeps_React_["useState"])(false);const timefilter=Object(contexts_kibana["g"])({timeRangeSelector:true,autoRefreshSelector:true});const{jobIds:jobIds}=useJobSelection(jobsWithTimeRange);const selectedJobsRunning=jobsWithTimeRange.some(job=>jobIds.includes(job.id)&&job.isRunning===true);const explorerAppState=useObservable_default()(explorerService.appState$);const explorerState=useObservable_default()(explorerService.state$);const refresh=useRefresh();Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(refresh!==undefined&&lastRefresh!==refresh.lastRefresh){setLastRefresh(refresh===null||refresh===void 0?void 0:refresh.lastRefresh);if(refresh.timeRange!==undefined){const{start:start,end:end}=refresh.timeRange;setGlobalState("time",{from:start,to:end})}}},[refresh===null||refresh===void 0?void 0:refresh.lastRefresh,lastRefresh,setLastRefresh,setGlobalState]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if((globalState===null||globalState===void 0?void 0:globalState.time)!==undefined){if(globalState.time.mode==="invalid"){setInValidTimeRangeError(true)}timefilter.setTime({from:globalState.time.from,to:globalState.time.to})}},[globalState===null||globalState===void 0?void 0:(_globalState$time=globalState.time)===null||_globalState$time===void 0?void 0:_globalState$time.from,globalState===null||globalState===void 0?void 0:(_globalState$time2=globalState.time)===null||_globalState$time2===void 0?void 0:_globalState$time2.to]);const getJobsWithStoppedPartitions=Object(external_kbnSharedDeps_React_["useCallback"])(async selectedJobIds=>{try{const fetchedStoppedPartitions=await ml_api_service["ml"].results.getCategoryStoppedPartitions(selectedJobIds,constants_anomalies["d"]);if(fetchedStoppedPartitions&&Array.isArray(fetchedStoppedPartitions.jobs)&&fetchedStoppedPartitions.jobs.length>0){setStoppedPartitions(fetchedStoppedPartitions.jobs)}else{setStoppedPartitions(undefined)}}catch(error){console.error(error)}},[]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(jobIds.length>0){explorerService.updateJobSelection(jobIds);getJobsWithStoppedPartitions(jobIds)}else{explorerService.clearJobs()}},[JSON.stringify(jobIds)]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{var _explorerUrlState$mlE;const filterData=explorerUrlState===null||explorerUrlState===void 0?void 0:explorerUrlState.mlExplorerFilter;if(filterData!==undefined){explorerService.setFilterData(filterData)}const{viewByFieldName:viewByFieldName,viewByFromPage:viewByFromPage,viewByPerPage:viewByPerPage}=(_explorerUrlState$mlE=explorerUrlState===null||explorerUrlState===void 0?void 0:explorerUrlState.mlExplorerSwimlane)!==null&&_explorerUrlState$mlE!==void 0?_explorerUrlState$mlE:{};if(viewByFieldName!==undefined){explorerService.setViewBySwimlaneFieldName(viewByFieldName)}if(viewByPerPage!==undefined){explorerService.setViewByPerPage(viewByPerPage)}if(viewByFromPage!==undefined){explorerService.setViewByFromPage(viewByFromPage)}},[]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{var _explorerUrlState$mlE2,_explorerAppState$mlE;const replaceState=(explorerUrlState===null||explorerUrlState===void 0?void 0:(_explorerUrlState$mlE2=explorerUrlState.mlExplorerSwimlane)===null||_explorerUrlState$mlE2===void 0?void 0:_explorerUrlState$mlE2.viewByFieldName)===undefined;if((explorerAppState===null||explorerAppState===void 0?void 0:(_explorerAppState$mlE=explorerAppState.mlExplorerSwimlane)===null||_explorerAppState$mlE===void 0?void 0:_explorerAppState$mlE.viewByFieldName)!==undefined){setExplorerUrlState(explorerAppState,replaceState)}},[explorerAppState]);const[explorerData,loadExplorerData]=useExplorerData();Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(explorerData!==undefined&&Object.keys(explorerData).length>0){explorerService.setExplorerData(explorerData)}},[explorerData]);const[showCharts]=useShowCharts();const[tableInterval]=useTableInterval();const[tableSeverity]=Object(select_severity["c"])();const[selectedCells,setSelectedCells]=useSelectedCells(explorerUrlState,setExplorerUrlState,explorerState===null||explorerState===void 0?void 0:(_explorerState$swimla=explorerState.swimlaneBucketInterval)===null||_explorerState$swimla===void 0?void 0:_explorerState$swimla.asSeconds());Object(external_kbnSharedDeps_React_["useEffect"])(()=>{explorerService.setSelectedCells(selectedCells)},[JSON.stringify(selectedCells)]);const loadExplorerDataConfig=explorerState!==undefined?{lastRefresh:lastRefresh,influencersFilterQuery:explorerState.influencersFilterQuery,noInfluencersConfigured:explorerState.noInfluencersConfigured,selectedCells:selectedCells,selectedJobs:explorerState.selectedJobs,swimlaneBucketInterval:explorerState.swimlaneBucketInterval,tableInterval:tableInterval.val,tableSeverity:tableSeverity.val,viewBySwimlaneFieldName:explorerState.viewBySwimlaneFieldName,swimlaneContainerWidth:explorerState.swimlaneContainerWidth,viewByPerPage:explorerState.viewByPerPage,viewByFromPage:explorerState.viewByFromPage}:undefined;Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const swimlaneLimit=Object(swimlane_container["c"])(explorerState===null||explorerState===void 0?void 0:explorerState.viewBySwimlaneData)&&!(selectedCells!==null&&selectedCells!==void 0&&selectedCells.showTopFieldValues)?explorerState===null||explorerState===void 0?void 0:explorerState.viewBySwimlaneData.cardinality:undefined;if(explorerState&&explorerState.swimlaneContainerWidth>0){loadExplorerData({...loadExplorerDataConfig,swimlaneLimit:swimlaneLimit})}},[JSON.stringify(loadExplorerDataConfig),selectedCells===null||selectedCells===void 0?void 0:selectedCells.showTopFieldValues]);if(explorerState===undefined||refresh===undefined||showCharts===undefined){return null}return external_kbnSharedDeps_React_default.a.createElement("div",{className:"ml-explorer"},external_kbnSharedDeps_React_default.a.createElement(explorer_Explorer,{explorerState:explorerState,setSelectedCells:setSelectedCells,showCharts:showCharts,severity:tableSeverity.val,stoppedPartitions:stoppedPartitions,invalidTimeRangeError:invalidTimeRangeError,selectedJobsRunning:selectedJobsRunning}))};const access_denied_page_Page=()=>{const{services:{docLinks:docLinks}}=Object(contexts_kibana["b"])();const helpLink=docLinks.links.ml.guide;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(navigation_menu["a"],{tabId:"access-denied"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPage"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageContentHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageContentHeaderSection"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],null,external_kbnSharedDeps_React_default.a.createElement("h1",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.management.jobsList.accessDeniedTitle",defaultMessage:"Access denied"}))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageContentBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.accessDenied.label",{defaultMessage:"Insufficient permissions"}),color:"danger",iconType:"cross"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.accessDenied.description",defaultMessage:"You don’t have permission to access the ML plugin"}))))))),external_kbnSharedDeps_React_default.a.createElement(help_menu["a"],{docLink:helpLink}))};function access_denied_extends(){access_denied_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return access_denied_extends.apply(this,arguments)}const access_denied_breadcrumbs=[{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.accessDeniedLabel",{defaultMessage:"Access denied"}),href:""}];const accessDeniedRouteFactory=()=>({path:"/access-denied",render:(props,deps)=>external_kbnSharedDeps_React_default.a.createElement(access_denied_PageWrapper,access_denied_extends({},props,{deps:deps})),breadcrumbs:access_denied_breadcrumbs});const access_denied_PageWrapper=({deps:deps})=>{const{context:context}=useResolver(undefined,undefined,deps.config,{});return external_kbnSharedDeps_React_default.a.createElement(PageLoader,{context:context},external_kbnSharedDeps_React_default.a.createElement(access_denied_page_Page,null))};const PageLoader=({context:context,children:children})=>context===null?null:external_kbnSharedDeps_React_default.a.createElement(ml["a"].Provider,{value:context},children);const LegacyHashUrlRedirect=({children:children})=>{const history=Object(external_kbnSharedDeps_ReactRouterDom_["useHistory"])();const location=Object(external_kbnSharedDeps_ReactRouterDom_["useLocation"])();Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(location.hash.startsWith("#/")){history.push(location.hash.replace("#",""))}},[location.hash]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,children)};const MlRoutes=({pageDeps:pageDeps})=>{const navigateToPath=Object(contexts_kibana["e"])();const{services:{http:{basePath:basePath}}}=Object(contexts_kibana["b"])();return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,Object.entries(routes_namespaceObject).map(([name,routeFactory])=>{const route=routeFactory(navigateToPath,basePath.get());return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ReactRouterDom_["Route"],{key:name,path:route.path,exact:true,render:props=>{window.setTimeout(()=>{pageDeps.setBreadcrumbs(route.breadcrumbs)});return route.render(props,pageDeps)}})}))};const MlRouter=({pageDeps:pageDeps})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ReactRouterDom_["Router"],{history:pageDeps.history},external_kbnSharedDeps_React_default.a.createElement(LegacyHashUrlRedirect,null,external_kbnSharedDeps_React_default.a.createElement(url_state["a"],null,external_kbnSharedDeps_React_default.a.createElement("div",{className:"ml-app","data-test-subj":"mlApp"},external_kbnSharedDeps_React_default.a.createElement(MlRoutes,{pageDeps:pageDeps})))));var http_service=__webpack_require__(99);const localStorage=new public_["Storage"](window.localStorage);function getMlGlobalServices(httpStart){const httpService=new http_service["a"](httpStart);return{httpService:httpService,mlApiServices:Object(ml_api_service["mlApiServicesProvider"])(httpService)}}const App=({coreStart:coreStart,deps:deps,appMountParams:appMountParams})=>{const redirectToMlAccessDeniedPage=async()=>{const accessDeniedPageUrl=await deps.share.urlGenerators.getUrlGenerator(ml_url_generator["a"]).createUrl({page:ml_url_generator["b"].ACCESS_DENIED});await coreStart.application.navigateToUrl(accessDeniedPageUrl)};const pageDeps={history:appMountParams.history,indexPatterns:deps.data.indexPatterns,config:coreStart.uiSettings,setBreadcrumbs:coreStart.chrome.setBreadcrumbs,redirectToMlAccessDeniedPage:redirectToMlAccessDeniedPage};const services={appName:"ML",kibanaVersion:deps.kibanaVersion,share:deps.share,data:deps.data,security:deps.security,licenseManagement:deps.licenseManagement,lens:deps.lens,storage:localStorage,embeddable:deps.embeddable,maps:deps.maps,triggersActionsUi:deps.triggersActionsUi,...coreStart};const I18nContext=coreStart.i18n.Context;return external_kbnSharedDeps_React_default.a.createElement(kibanaReact_public_["RedirectAppLinks"],{application:coreStart.application},external_kbnSharedDeps_React_default.a.createElement(I18nContext,null,external_kbnSharedDeps_React_default.a.createElement(kibanaReact_public_["KibanaContextProvider"],{services:{...services,mlServices:getMlGlobalServices(coreStart.http)}},external_kbnSharedDeps_React_default.a.createElement(MlRouter,{pageDeps:pageDeps}))))};const renderApp=(coreStart,deps,appMountParams)=>{Object(dependency_cache["l"])({indexPatterns:deps.data.indexPatterns,timefilter:deps.data.query.timefilter,fieldFormats:deps.data.fieldFormats,autocomplete:deps.data.autocomplete,config:coreStart.uiSettings,chrome:coreStart.chrome,docLinks:coreStart.docLinks,toastNotifications:coreStart.notifications.toasts,overlays:coreStart.overlays,recentlyAccessed:coreStart.chrome.recentlyAccessed,basePath:coreStart.http.basePath,savedObjectsClient:coreStart.savedObjects.client,application:coreStart.application,http:coreStart.http,security:deps.security,urlGenerators:deps.share.urlGenerators,maps:deps.maps});appMountParams.onAppLeave(actions=>actions.default());const mlLicense=Object(license["e"])(deps.licensing,[()=>external_kbnSharedDeps_ReactDom_default.a.render(external_kbnSharedDeps_React_default.a.createElement(App,{coreStart:coreStart,deps:deps,appMountParams:appMountParams}),appMountParams.element)]);return()=>{mlLicense.unsubscribe();Object(dependency_cache["a"])();external_kbnSharedDeps_ReactDom_default.a.unmountComponentAtNode(appMountParams.element)}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return jobs_list_view_JobsListView}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(34);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(33);var external_kbnSharedDeps_Lodash_=__webpack_require__(5);var ml_api_service=__webpack_require__(59);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);var job_service=__webpack_require__(65);var toast_notification_service=__webpack_require__(72);var dependency_cache=__webpack_require__(18);var string_utils=__webpack_require__(84);var states=__webpack_require__(101);var parse_interval=__webpack_require__(22);var calendar_service=__webpack_require__(289);var object_utils=__webpack_require__(127);function loadFullJob(jobId){return new Promise((resolve,reject)=>{ml_api_service["ml"].jobs.jobs([jobId]).then(jobs=>{if(jobs.length){resolve(jobs[0])}else{throw new Error(`Could not find job ${jobId}`)}}).catch(error=>{reject(error)})})}function loadJobForCloning(jobId){return new Promise((resolve,reject)=>{ml_api_service["ml"].jobs.jobForCloning(jobId).then(resp=>{if(resp){resolve(resp)}else{throw new Error(`Could not find job ${jobId}`)}}).catch(error=>{reject(error)})})}function isStartable(jobs){return jobs.some(j=>j.datafeedState===states["a"].STOPPED&&j.jobState!==states["c"].CLOSING)}function isStoppable(jobs){return jobs.some(j=>j.datafeedState===states["a"].STARTED||j.datafeedState===states["a"].STARTING)}function isClosable(jobs){return jobs.some(j=>j.datafeedState===states["a"].STOPPED&&j.jobState!==states["c"].CLOSED&&j.jobState!==states["c"].CLOSING)}function forceStartDatafeeds(jobs,start,end,finish=(()=>{})){const datafeedIds=jobs.filter(j=>j.hasDatafeed).map(j=>j.datafeedId);job_service["a"].forceStartDatafeeds(datafeedIds,start,end).then(resp=>{showResults(resp,states["a"].STARTED);finish()}).catch(error=>{const toastNotifications=Object(dependency_cache["j"])();toastNotifications.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.startJobErrorMessage",{defaultMessage:"Jobs failed to start"}),error);finish()})}function stopDatafeeds(jobs,finish=(()=>{})){const datafeedIds=jobs.filter(j=>j.hasDatafeed).map(j=>j.datafeedId);job_service["a"].stopDatafeeds(datafeedIds).then(resp=>{showResults(resp,states["a"].STOPPED);finish()}).catch(error=>{const toastNotifications=Object(dependency_cache["j"])();toastNotifications.addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.stopJobErrorMessage",{defaultMessage:"Jobs failed to stop"}),error);finish()})}function showResults(resp,action){const successes=[];const failures=[];for(const d in resp){if(resp[d][action]===true||resp[d][action]===false&&resp[d].error.statusCode===409&&action===states["a"].STARTED){successes.push(d)}else{failures.push({id:d,result:resp[d]})}}let actionText="";let actionTextPT="";if(action===states["a"].STARTED){actionText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.startActionStatusText",{defaultMessage:"start"});actionTextPT=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.startedActionStatusText",{defaultMessage:"started"})}else if(action===states["a"].STOPPED){actionText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.stopActionStatusText",{defaultMessage:"stop"});actionTextPT=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.stoppedActionStatusText",{defaultMessage:"stopped"})}else if(action===states["a"].DELETED){actionText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.deleteActionStatusText",{defaultMessage:"delete"});actionTextPT=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.deletedActionStatusText",{defaultMessage:"deleted"})}else if(action===states["c"].CLOSED){actionText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.closeActionStatusText",{defaultMessage:"close"});actionTextPT=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.closedActionStatusText",{defaultMessage:"closed"})}const toastNotifications=Object(dependency_cache["j"])();toastNotifications.addSuccess(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.actionExecuteSuccessfullyNotificationMessage",{defaultMessage:"{successesJobsCount, plural, one{{successJob}} other{# jobs}} {actionTextPT} successfully",values:{successesJobsCount:successes.length,successJob:successes[0],actionTextPT:actionTextPT}}));if(failures.length>0){failures.forEach(f=>{const toastNotificationService=Object(toast_notification_service["b"])(toastNotifications);toastNotificationService.displayErrorToast(f.result.error,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.actionFailedNotificationMessage",{defaultMessage:"{failureId} failed to {actionText}",values:{failureId:f.id,actionText:actionText}}))})}}async function cloneJob(jobId){try{var _originalJob$custom_s;const[{job:cloneableJob,datafeed:datafeed},originalJob]=await Promise.all([loadJobForCloning(jobId),loadFullJob(jobId,false)]);if(cloneableJob!==undefined&&(originalJob===null||originalJob===void 0?void 0:(_originalJob$custom_s=originalJob.custom_settings)===null||_originalJob$custom_s===void 0?void 0:_originalJob$custom_s.created_by)!==undefined){var _originalJob$custom_s2;job_service["a"].tempJobCloningObjects.createdBy=originalJob===null||originalJob===void 0?void 0:(_originalJob$custom_s2=originalJob.custom_settings)===null||_originalJob$custom_s2===void 0?void 0:_originalJob$custom_s2.created_by;job_service["a"].tempJobCloningObjects.job=cloneableJob;if(originalJob.data_counts.earliest_record_timestamp!==undefined&&originalJob.data_counts.latest_record_timestamp!==undefined&&originalJob.data_counts.latest_bucket_timestamp!==undefined){let start=originalJob.data_counts.earliest_record_timestamp;let end=originalJob.data_counts.latest_record_timestamp;if(originalJob.datafeed_config.aggregations!==undefined){const bucketSpanMs=Object(parse_interval["a"])(originalJob.analysis_config.bucket_span).asMilliseconds();start=Math.floor(originalJob.data_counts.earliest_record_timestamp/bucketSpanMs)*bucketSpanMs;end=originalJob.data_counts.latest_bucket_timestamp+bucketSpanMs*2-1}job_service["a"].tempJobCloningObjects.start=start;job_service["a"].tempJobCloningObjects.end=end}}else{job_service["a"].tempJobCloningObjects.job=cloneableJob;job_service["a"].tempJobCloningObjects.createdBy=undefined}if(datafeed!==undefined){job_service["a"].tempJobCloningObjects.datafeed=datafeed}if(originalJob.calendars){job_service["a"].tempJobCloningObjects.calendars=await calendar_service["a"].fetchCalendarsByIds(originalJob.calendars)}window.location.href="#/jobs/new_job"}catch(error){Object(toast_notification_service["a"])().displayErrorToast(error,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.cloneJobErrorMessage",{defaultMessage:"Could not clone {jobId}. Job could not be found",values:{jobId:jobId}}))}}function closeJobs(jobs,finish=(()=>{})){const jobIds=jobs.map(j=>j.id);job_service["a"].closeJobs(jobIds).then(resp=>{showResults(resp,states["c"].CLOSED);finish()}).catch(error=>{Object(toast_notification_service["a"])().displayErrorToast(error,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.closeJobErrorMessage",{defaultMessage:"Jobs failed to close"}));finish()})}function deleteJobs(jobs,finish=(()=>{})){const jobIds=jobs.map(j=>j.id);job_service["a"].deleteJobs(jobIds).then(resp=>{showResults(resp,states["c"].DELETED);finish()}).catch(error=>{Object(toast_notification_service["a"])().displayErrorToast(error,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.deleteJobErrorMessage",{defaultMessage:"Jobs failed to delete"}));finish()})}function filterJobs(jobs,clauses){if(clauses.length===0){return jobs}const matches=jobs.reduce((p,c)=>{p[c.id]={job:c,count:0};return p},{});clauses.forEach(c=>{const bool=c.match==="must";let js=[];if(c.type==="term"){if(bool===true){js=jobs.filter(job=>Object(string_utils["f"])(job.id,c.value)===bool||Object(string_utils["f"])(job.description,c.value)===bool||Object(string_utils["f"])(job.memory_status,c.value)===bool)}else{js=jobs.filter(job=>Object(string_utils["f"])(job.id,c.value)===bool&&Object(string_utils["f"])(job.description,c.value)===bool&&Object(string_utils["f"])(job.memory_status,c.value)===bool)}}else{if(Array.isArray(c.value)){if(c.field==="id"){js=jobs.filter(job=>c.value.indexOf(jobProperty(job,c.field))>=0)}else{js=jobs.filter(job=>jobProperty(job,c.field).some(g=>c.value.indexOf(g)>=0))}}else{js=jobs.filter(job=>jobProperty(job,c.field)===c.value)}}js.forEach(j=>matches[j.id].count++)});const filteredJobs=[];Object(external_kbnSharedDeps_Lodash_["each"])(matches,m=>{if(m.count>=clauses.length){filteredJobs.push(m.job)}});return filteredJobs}function checkForAutoStartDatafeed(){const job=job_service["a"].tempJobCloningObjects.job;const datafeed=job_service["a"].tempJobCloningObjects.datafeed;if(job!==undefined){job_service["a"].tempJobCloningObjects.job=undefined;job_service["a"].tempJobCloningObjects.datafeed=undefined;job_service["a"].tempJobCloningObjects.createdBy=undefined;const hasDatafeed=Object(object_utils["a"])(datafeed);const datafeedId=hasDatafeed?datafeed.datafeed_id:"";return{id:job.job_id,hasDatafeed:hasDatafeed,latestTimestampSortValue:0,datafeedId:datafeedId}}}function jobProperty(job,prop){const propMap={job_state:"jobState",datafeed_state:"datafeedState",groups:"groups",id:"id"};return job[propMap[prop]]}var external_kbnSharedDeps_Moment_=__webpack_require__(12);var external_kbnSharedDeps_Moment_default=__webpack_require__.n(external_kbnSharedDeps_Moment_);var check_capabilities=__webpack_require__(63);var check_ml_nodes=__webpack_require__(80);var index_utils=__webpack_require__(78);function actionsMenuContent(showEditJobFlyout,showDeleteJobModal,showStartDatafeedModal,refreshJobs,showCreateAlertFlyout){const canCreateJob=Object(check_capabilities["e"])("canCreateJob")&&Object(check_ml_nodes["e"])();const canUpdateJob=Object(check_capabilities["e"])("canUpdateJob");const canDeleteJob=Object(check_capabilities["e"])("canDeleteJob");const canUpdateDatafeed=Object(check_capabilities["e"])("canUpdateDatafeed");const canStartStopDatafeed=Object(check_capabilities["e"])("canStartStopDatafeed")&&Object(check_ml_nodes["e"])();const canCloseJob=Object(check_capabilities["e"])("canCloseJob")&&Object(check_ml_nodes["e"])();const canCreateMlAlerts=Object(check_capabilities["e"])("canCreateMlAlerts");return[{name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.managementActions.startDatafeedLabel",{defaultMessage:"Start datafeed"}),description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.managementActions.startDatafeedDescription",{defaultMessage:"Start datafeed"}),icon:"play",enabled:item=>item.deleting!==true&&canStartStopDatafeed,available:item=>isStartable([item]),onClick:item=>{showStartDatafeedModal([item]);closeMenu()},"data-test-subj":"mlActionButtonStartDatafeed"},{name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.managementActions.stopDatafeedLabel",{defaultMessage:"Stop datafeed"}),description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.managementActions.stopDatafeedDescription",{defaultMessage:"Stop datafeed"}),icon:"stop",enabled:item=>item.deleting!==true&&canStartStopDatafeed,available:item=>isStoppable([item]),onClick:item=>{stopDatafeeds([item],refreshJobs);closeMenu(true)},"data-test-subj":"mlActionButtonStopDatafeed"},{name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.managementActions.createAlertLabel",{defaultMessage:"Create alert"}),description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.managementActions.createAlertLabel",{defaultMessage:"Create alert"}),icon:"bell",enabled:item=>item.deleting!==true,available:()=>canCreateMlAlerts,onClick:item=>{showCreateAlertFlyout([item.id]);closeMenu(true)},"data-test-subj":"mlActionButtonCreateAlert"},{name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.managementActions.closeJobLabel",{defaultMessage:"Close job"}),description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.managementActions.closeJobDescription",{defaultMessage:"Close job"}),icon:"cross",enabled:item=>item.deleting!==true&&canCloseJob,available:item=>isClosable([item]),onClick:item=>{closeJobs([item],refreshJobs);closeMenu(true)},"data-test-subj":"mlActionButtonCloseJob"},{name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.managementActions.cloneJobLabel",{defaultMessage:"Clone job"}),description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.managementActions.cloneJobDescription",{defaultMessage:"Clone job"}),icon:"copy",enabled:item=>item.deleting!==true&&canCreateJob,onClick:item=>{const indexPatternNames=Object(index_utils["d"])();const indexPatternTitle=item.datafeedIndices.join(",");const jobIndicesAvailable=indexPatternNames.includes(indexPatternTitle);if(!jobIndicesAvailable){Object(dependency_cache["j"])().addDanger(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.managementActions.noSourceIndexPatternForClone",{defaultMessage:"Unable to clone the anomaly detection job {jobId}. No index pattern exists for index {indexPatternTitle}.",values:{jobId:item.id,indexPatternTitle:indexPatternTitle}}))}else{cloneJob(item.id)}closeMenu(true)},"data-test-subj":"mlActionButtonCloneJob"},{name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.managementActions.editJobLabel",{defaultMessage:"Edit job"}),description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.managementActions.editJobDescription",{defaultMessage:"Edit job"}),icon:"pencil",enabled:item=>item.deleting!==true&&canUpdateJob&&canUpdateDatafeed,onClick:item=>{showEditJobFlyout(item);closeMenu()},"data-test-subj":"mlActionButtonEditJob"},{name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.managementActions.deleteJobLabel",{defaultMessage:"Delete job"}),description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.managementActions.deleteJobDescription",{defaultMessage:"Delete job"}),icon:"trash",color:"danger",enabled:()=>canDeleteJob,onClick:item=>{showDeleteJobModal([item]);closeMenu()},"data-test-subj":"mlActionButtonDeleteJob"}]}function closeMenu(now=false){if(now){document.querySelector(".euiTable").click()}else{window.setTimeout(()=>{const modalBody=document.querySelector(".euiModalBody");if(modalBody){modalBody.click()}else{document.querySelector(".euiTable").click()}},500)}}var use_create_ad_links=__webpack_require__(228);function ResultLinks({jobs:jobs}){const openJobsInSingleMetricViewerText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.resultActions.openJobsInSingleMetricViewerText",{defaultMessage:"Open {jobsCount, plural, one {{jobId}} other {# jobs}} in Single Metric Viewer",values:{jobsCount:jobs.length,jobId:jobs[0].id}});const openJobsInAnomalyExplorerText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.resultActions.openJobsInAnomalyExplorerText",{defaultMessage:"Open {jobsCount, plural, one {{jobId}} other {# jobs}} in Anomaly Explorer",values:{jobsCount:jobs.length,jobId:jobs[0].id}});const singleMetricVisible=jobs.length<2;const singleMetricEnabled=jobs.length===1&&jobs[0].isSingleMetricViewerJob;const singleMetricDisabledMessage=jobs.length===1&&jobs[0].isNotSingleMetricViewerJobMessage;const singleMetricDisabledMessageText=singleMetricDisabledMessage!==undefined?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.resultActions.singleMetricDisabledMessageText",{defaultMessage:"Disabled because {reason}.",values:{reason:singleMetricDisabledMessage}}):undefined;const jobActionsDisabled=jobs.length===1&&jobs[0].deleting===true;const{createLinkWithUserDefaults:createLinkWithUserDefaults}=Object(use_create_ad_links["a"])();const timeSeriesExplorerLink=Object(external_kbnSharedDeps_React_["useMemo"])(()=>createLinkWithUserDefaults("timeseriesexplorer",jobs),[jobs]);const anomalyExplorerLink=Object(external_kbnSharedDeps_React_["useMemo"])(()=>createLinkWithUserDefaults("explorer",jobs),[jobs]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,singleMetricVisible&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{position:"bottom",content:singleMetricDisabledMessageText!==null&&singleMetricDisabledMessageText!==void 0?singleMetricDisabledMessageText:openJobsInSingleMetricViewerText},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{href:timeSeriesExplorerLink,iconType:"visLine","aria-label":openJobsInSingleMetricViewerText,className:"results-button",isDisabled:singleMetricEnabled===false||jobActionsDisabled===true,"data-test-subj":"mlOpenJobsInSingleMetricViewerButton"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{position:"bottom",content:openJobsInAnomalyExplorerText},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{href:anomalyExplorerLink,iconType:"visTable","aria-label":openJobsInAnomalyExplorerText,className:"results-button",isDisabled:jobActionsDisabled===true,"data-test-subj":"mlOpenJobsInAnomalyExplorerButton"})),external_kbnSharedDeps_React_default.a.createElement("div",{className:"actions-border"}))}var group_color_utils=__webpack_require__(142);const JobGroup=({name:name})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBadge"],{key:`${name}-id`,"data-test-subj":"mlJobGroup",color:Object(group_color_utils["a"])(name)},name);var kibana=__webpack_require__(58);var ml_url_generator=__webpack_require__(0);function isGroupIdLink(props){return props.groupId!==undefined}const AnomalyDetectionJobIdLink=props=>{const mlUrlGenerator=Object(kibana["d"])();const[href,setHref]=Object(external_kbnSharedDeps_React_["useState"])("");Object(external_kbnSharedDeps_React_["useEffect"])(()=>{let isCancelled=false;const generateLink=async()=>{const pageState={};if(isGroupIdLink(props)){pageState.groupIds=[props.groupId]}else{pageState.jobId=props.id}const url=await mlUrlGenerator.createUrl({page:ml_url_generator["b"].ANOMALY_DETECTION_JOBS_MANAGE,pageState:pageState});if(!isCancelled){setHref(url)}};generateLink();return()=>{isCancelled=true}},[props,mlUrlGenerator]);if(isGroupIdLink(props)){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{style:{marginLeft:"4px"},key:props.groupId,href:href},external_kbnSharedDeps_React_default.a.createElement(JobGroup,{name:props.groupId}))}else{return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{key:props.id,href:href},props.id)}};function JobDescription({job:job,isManagementTable:isManagementTable}){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement("div",{className:"job-description"},job.description,"  ",job.groups.map(group=>{if(isManagementTable===true){return external_kbnSharedDeps_React_default.a.createElement(AnomalyDetectionJobIdLink,{key:group,groupId:group})}return external_kbnSharedDeps_React_default.a.createElement(JobGroup,{key:group,name:group})})))}var job_message_icon=__webpack_require__(391);var job_spaces_list=__webpack_require__(390);var time_format=__webpack_require__(116);function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const PAGE_SIZE_OPTIONS=[10,25,50];class jobs_list_JobsList extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);_defineProperty(this,"onTableChange",({page:page={},sort:sort={}})=>{const{index:pageIndex,size:pageSize}=page;const{field:sortField,direction:sortDirection}=sort;this.props.onJobsViewStateUpdate({pageIndex:pageIndex,pageSize:pageSize,sortField:sortField,sortDirection:sortDirection})});_defineProperty(this,"toggleRow",item=>{this.props.toggleRow(item.id)});this.state={jobsSummaryList:props.jobsSummaryList,itemIdToExpandedRowMap:{}}}static getDerivedStateFromProps(props){const itemIdToExpandedRowMap=props.itemIdToExpandedRowMap;const jobsSummaryList=props.jobsSummaryList;return{itemIdToExpandedRowMap:itemIdToExpandedRowMap,jobsSummaryList:jobsSummaryList}}getJobIdLink(id){if(this.props.isMlEnabledInSpace===false){return id}return external_kbnSharedDeps_React_default.a.createElement(AnomalyDetectionJobIdLink,{key:id,id:id})}getPageOfJobs(index,size,sortField,sortDirection){let list=this.state.jobsSummaryList;list=Object(external_kbnSharedDeps_Lodash_["sortBy"])(this.state.jobsSummaryList,item=>item[sortField]);list=sortDirection==="asc"?list:list.reverse();const listLength=list.length;let pageStart=index*size;if(pageStart>=listLength&&listLength!==0){pageStart=Math.floor((listLength-1)/size)*size;setTimeout(()=>{this.props.onJobsViewStateUpdate({pageIndex:pageStart/size})},0)}return{pageOfItems:list.slice(pageStart,pageStart+size),totalItemCount:listLength}}render(){const{loading:loading,isManagementTable:isManagementTable,spacesApi:spacesApi}=this.props;const selectionControls={selectable:job=>job.deleting!==true,selectableMessage:(selectable,rowItem)=>selectable===false?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.cannotSelectRowForJobMessage",{defaultMessage:"Cannot select job ID {jobId}",values:{jobId:rowItem.id}}):external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.selectRowForJobMessage",{defaultMessage:"Select the row for job ID {jobId}",values:{jobId:rowItem.id}}),onSelectionChange:this.props.selectJobChange};const columns=[{name:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiScreenReaderOnly"],null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.showDetailsColumn.screenReaderDescription",defaultMessage:"This column contains clickable controls for showing more details on each job"}))),render:item=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{onClick:()=>this.toggleRow(item),isDisabled:item.deleting===true,iconType:this.state.itemIdToExpandedRowMap[item.id]?"arrowDown":"arrowRight","aria-label":this.state.itemIdToExpandedRowMap[item.id]?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.collapseJobDetailsAriaLabel",{defaultMessage:"Hide details for {itemId}",values:{itemId:item.id}}):external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.expandJobDetailsAriaLabel",{defaultMessage:"Show details for {itemId}",values:{itemId:item.id}}),"data-row-id":item.id,"data-test-subj":"mlJobListRowDetailsToggle"}),width:"3%"},{field:"id","data-test-subj":"mlJobListColumnId",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.idLabel",{defaultMessage:"ID"}),sortable:true,truncateText:false,width:"20%",scope:"row",render:isManagementTable?id=>this.getJobIdLink(id):undefined},{field:"auditMessage",name:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiScreenReaderOnly"],null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.auditMessageColumn.screenReaderDescription",defaultMessage:"This column display icons when there are errors or warnings for the job in the past 24 hours"}))),render:item=>external_kbnSharedDeps_React_default.a.createElement(job_message_icon["a"],{message:item,showTooltip:true})},{name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.descriptionLabel",{defaultMessage:"Description"}),sortable:true,field:"description","data-test-subj":"mlJobListColumnDescription",render:(description,item)=>external_kbnSharedDeps_React_default.a.createElement(JobDescription,{job:item,isManagementTable:isManagementTable}),textOnly:true,width:"20%"},{field:"processed_record_count","data-test-subj":"mlJobListColumnRecordCount",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.processedRecordsLabel",{defaultMessage:"Processed records"}),sortable:true,truncateText:false,dataType:"number",render:count=>Object(string_utils["g"])(count),width:"10%"},{field:"memory_status","data-test-subj":"mlJobListColumnMemoryStatus",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.memoryStatusLabel",{defaultMessage:"Memory status"}),sortable:true,truncateText:false,width:"5%"},{field:"jobState","data-test-subj":"mlJobListColumnJobState",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobStateLabel",{defaultMessage:"Job state"}),sortable:true,truncateText:false,width:"8%"},{field:"datafeedState","data-test-subj":"mlJobListColumnDatafeedState",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.datafeedStateLabel",{defaultMessage:"Datafeed state"}),sortable:true,truncateText:false,width:"8%"},{name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.actionsLabel",{defaultMessage:"Actions"}),render:item=>external_kbnSharedDeps_React_default.a.createElement(ResultLinks,{jobs:[item]})}];if(isManagementTable===true){if(spacesApi){columns.splice(columns.length-1,0,{name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.spacesLabel",{defaultMessage:"Spaces"}),render:item=>external_kbnSharedDeps_React_default.a.createElement(job_spaces_list["a"],{spacesApi:spacesApi,spaceIds:item.spaceIds,jobId:item.id,jobType:"anomaly-detector",refresh:this.props.refreshJobs})})}if(this.props.isMlEnabledInSpace===false){columns.pop()}}else{columns.splice(columns.length-1,0,{name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.latestTimestampLabel",{defaultMessage:"Latest timestamp"}),truncateText:false,field:"latestTimestampSortValue","data-test-subj":"mlJobListColumnLatestTimestamp",sortable:true,render:(time,item)=>external_kbnSharedDeps_React_default.a.createElement("span",{className:"euiTableCellContent__text"},item.latestTimestampMs===undefined?"":external_kbnSharedDeps_Moment_default()(item.latestTimestampMs).format(time_format["a"])),textOnly:true,width:"15%"});columns.push({name:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiScreenReaderOnly"],null,external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.jobActionsColumn.screenReaderDescription",defaultMessage:"This column contains extra actions in a menu that can be performed on each job"}))),actions:actionsMenuContent(this.props.showEditJobFlyout,this.props.showDeleteJobModal,this.props.showStartDatafeedModal,this.props.refreshJobs,this.props.showCreateAlertFlyout)})}const{pageIndex:pageIndex,pageSize:pageSize,sortField:sortField,sortDirection:sortDirection}=this.props.jobsViewState;const{pageOfItems:pageOfItems,totalItemCount:totalItemCount}=this.getPageOfJobs(pageIndex,pageSize,sortField,sortDirection);const pagination={pageIndex:pageIndex,pageSize:pageSize,totalItemCount:totalItemCount,pageSizeOptions:PAGE_SIZE_OPTIONS};const sorting={sort:{field:sortField,direction:sortDirection}};const selectedJobsClass=this.props.selectedJobsCount?"jobs-selected":"";return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBasicTable"],{"data-test-subj":loading?"mlJobListTable loading":"mlJobListTable loaded",loading:loading===true,noItemsMessage:loading?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.loadingJobsLabel",{defaultMessage:"Loading jobs…"}):external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.noJobsFoundLabel",{defaultMessage:"No jobs found"}),itemId:"id",className:`jobs-list-table ${selectedJobsClass}`,items:pageOfItems,columns:columns,pagination:pagination,onChange:this.onTableChange,selection:isManagementTable?undefined:selectionControls,itemIdToExpandedRowMap:this.state.itemIdToExpandedRowMap,isExpandable:true,sorting:sorting,hasActions:true,rowProps:item=>({"data-test-subj":`mlJobListRow row-${item.id}`})})}}jobs_list_JobsList.defaultProps={isManagementTable:false,isMlEnabledInSpace:true,loading:false};var external_kbnSharedDeps_ElasticNumeral_=__webpack_require__(42);var external_kbnSharedDeps_ElasticNumeral_default=__webpack_require__.n(external_kbnSharedDeps_ElasticNumeral_);var round_to_decimal_place=__webpack_require__(143);var date_utils=__webpack_require__(67);const DATA_FORMAT="0.0 b";function formatData(txt){return external_kbnSharedDeps_ElasticNumeral_default()(txt).format(DATA_FORMAT)}function formatValues(obj){if(!obj){return["",""]}const[key,value]=obj;switch(key){case"finished_time":case"create_time":case"log_time":case"timestamp":case"earliest_record_timestamp":case"latest_record_timestamp":case"last_data_time":case"latest_empty_bucket_timestamp":case"latest_sparse_bucket_timestamp":case"latest_bucket_timestamp":return[key,Object(date_utils["d"])(value)];case"established_model_memory":case"input_bytes":case"model_bytes":case"model_bytes_exceeded":case"model_bytes_memory_limit":case"peak_model_bytes":return[key,formatData(value)];case"processed_record_count":case"processed_field_count":case"input_field_count":case"invalid_date_count":case"missing_field_count":case"out_of_order_timestamp_count":case"empty_bucket_count":case"sparse_bucket_count":case"bucket_count":case"input_record_count":case"total_by_field_count":case"total_over_field_count":case"total_partition_field_count":case"bucket_allocation_failures_count":case"search_count":return[key,Object(string_utils["g"])(value)];case"average_search_time_per_bucket_ms":case"exponential_average_search_time_per_hour_ms":case"total_bucket_processing_time_ms":case"minimum_bucket_processing_time_ms":case"maximum_bucket_processing_time_ms":case"average_bucket_processing_time_ms":case"exponential_average_bucket_processing_time_ms":case"exponential_average_bucket_processing_time_per_hour_ms":return[key,typeof value==="number"?Object(round_to_decimal_place["a"])(value,3).toLocaleString():value];default:return[key,value]}}function filterObjects(obj,allowArrays,allowObjects){return Object.keys(obj).filter(k=>allowObjects||typeof obj[k]!=="object"||allowArrays&&Array.isArray(obj[k])).map(k=>{let item=obj[k];if(Array.isArray(item)){item=item.join(", ")}else if(typeof obj[k]==="object"){item=JSON.stringify(item)}return[k,item]})}function extractJobDetails(job,basePath){if(Object.keys(job).length===0){return{}}const general={id:"general",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.generalTitle",{defaultMessage:"General"}),position:"left",items:filterObjects(job,true).map(formatValues)};const customUrl={id:"customUrl",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.customUrlsTitle",{defaultMessage:"Custom URLs"}),position:"right",items:[]};if(job.custom_settings&&job.custom_settings.custom_urls){customUrl.items.push(...job.custom_settings.custom_urls.map(cu=>[cu.url_name,cu.url_value,cu.time_range]))}const node={id:"node",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.nodeTitle",{defaultMessage:"Node"}),position:"right",items:[]};if(job.node){node.items.push(["name",job.node.name])}const calendars={id:"calendars",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.calendarsTitle",{defaultMessage:"Calendars"}),position:"right",items:[]};if(job.calendars){calendars.items=job.calendars.map(c=>["",external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{href:basePath.prepend(`/app/ml/settings/calendars_list/edit_calendar/${c}?_g=()`)},c)]);const i=general.items.findIndex(item=>item[0]==="calendars");if(i>=0){general.items.splice(i,1)}}const detectors={id:"detectors",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.detectorsTitle",{defaultMessage:"Detectors"}),position:"left",items:[]};if(job.analysis_config&&job.analysis_config.detectors){detectors.items.push(...job.analysis_config.detectors.map(d=>{const stringifiedDtr=Object(string_utils["b"])(d);return[stringifiedDtr,stringifiedDtr!==d.detector_description?d.detector_description:""]}))}const influencers={id:"influencers",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.influencersTitle",{defaultMessage:"Influencers"}),position:"left",items:job.analysis_config.influencers.map(i=>["",i])};const analysisConfig={id:"analysisConfig",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.analysisConfigTitle",{defaultMessage:"Analysis config"}),position:"left",items:filterObjects(job.analysis_config)};const analysisLimits={id:"analysisLimits",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.analysisLimitsTitle",{defaultMessage:"Analysis limits"}),position:"left",items:filterObjects(job.analysis_limits)};const dataDescription={id:"dataDescription",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.dataDescriptionTitle",{defaultMessage:"Data description"}),position:"right",items:filterObjects(job.data_description)};const datafeed={id:"datafeed",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.datafeedTitle",{defaultMessage:"Datafeed"}),position:"left",items:filterObjects(job.datafeed_config||{},true,true)};if(job.node){datafeed.items.push(["node",JSON.stringify(job.node)])}if(job.datafeed_config&&job.datafeed_config.timing_stats){const i=datafeed.items.findIndex(item=>item[0]==="timing_stats");if(i>=0){datafeed.items.splice(i,1)}}const counts={id:"counts",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.countsTitle",{defaultMessage:"Counts"}),position:"left",items:filterObjects(job.data_counts).map(formatValues)};const modelSizeStats={id:"modelSizeStats",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.modelSizeStatsTitle",{defaultMessage:"Model size stats"}),position:"right",items:filterObjects(job.model_size_stats).map(formatValues)};const jobTimingStats={id:"jobTimingStats",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.jobTimingStatsTitle",{defaultMessage:"Job timing stats"}),position:"left",items:filterObjects(job.timing_stats).map(formatValues)};const datafeedTimingStats={id:"datafeedTimingStats",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.datafeedTimingStatsTitle",{defaultMessage:"Timing stats"}),position:"right",items:job.datafeed_config&&job.datafeed_config.timing_stats?filterObjects(job.datafeed_config.timing_stats).filter(o=>o[0]!=="total_search_time_ms").map(formatValues):[]};return{general:general,customUrl:customUrl,node:node,calendars:calendars,detectors:detectors,influencers:influencers,analysisConfig:analysisConfig,analysisLimits:analysisLimits,dataDescription:dataDescription,datafeed:datafeed,counts:counts,modelSizeStats:modelSizeStats,jobTimingStats:jobTimingStats,datafeedTimingStats:datafeedTimingStats}}var ml_job_editor=__webpack_require__(115);function JsonPane({job:job}){const json=JSON.stringify(job,null,2);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(ml_job_editor["a"],{value:json,readOnly:true,mode:ml_job_editor["b"].XJSON}))}var job_utils=__webpack_require__(64);class datafeed_preview_tab_DatafeedPreviewPane extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);this.state={previewJson:"",loading:true,canPreviewDatafeed:true}}renderContent(){const{previewJson:previewJson,loading:loading,canPreviewDatafeed:canPreviewDatafeed}=this.state;if(canPreviewDatafeed===false){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.jobDetails.noPermissionToViewDatafeedPreviewTitle",defaultMessage:"You do not have permission to view the datafeed preview"}),color:"warning",iconType:"alert"},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.jobDetails.pleaseContactYourAdministratorLabel",defaultMessage:"Please contact your administrator"})))}else if(loading===true){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLoadingSpinner"],{size:"xl"})}else{return external_kbnSharedDeps_React_default.a.createElement(ml_job_editor["a"],{value:previewJson,readOnly:true})}}componentDidMount(){const canPreviewDatafeed=Object(check_capabilities["e"])("canPreviewDatafeed")&&this.props.job.datafeed_config!==undefined;this.setState({canPreviewDatafeed:canPreviewDatafeed});updateDatafeedPreview(this.props.job,canPreviewDatafeed).then(previewJson=>{this.setState({previewJson:previewJson,loading:false})}).catch(error=>{console.log("Datafeed preview could not be loaded",error);this.setState({loading:false})})}render(){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),this.renderContent())}}function updateDatafeedPreview(job,canPreviewDatafeed){return new Promise((resolve,reject)=>{if(canPreviewDatafeed){job_service["a"].getDatafeedPreview(job.datafeed_config.datafeed_id).then(resp=>{if(Array.isArray(resp)){resolve(JSON.stringify(resp.slice(0,job_utils["a"]),null,2))}else{resolve("");console.log("Datafeed preview could not be loaded",resp)}}).catch(error=>{reject(error)})}})}var annotations_table=__webpack_require__(270);var annotation_flyout=__webpack_require__(263);const EditModelSnapshotFlyout=({snapshot:snapshot,job:job,closeFlyout:closeFlyout})=>{const{toasts:toasts}=Object(kibana["f"])();const[description,setDescription]=Object(external_kbnSharedDeps_React_["useState"])(snapshot.description);const[retain,setRetain]=Object(external_kbnSharedDeps_React_["useState"])(snapshot.retain);const[deleteModalVisible,setDeleteModalVisible]=Object(external_kbnSharedDeps_React_["useState"])(false);const[isCurrentSnapshot,setIsCurrentSnapshot]=Object(external_kbnSharedDeps_React_["useState"])(snapshot.snapshot_id===job.model_snapshot_id);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setIsCurrentSnapshot(snapshot.snapshot_id===job.model_snapshot_id)},[snapshot]);const updateSnapshot=Object(external_kbnSharedDeps_React_["useCallback"])(async()=>{try{await ml_api_service["ml"].updateModelSnapshot(snapshot.job_id,snapshot.snapshot_id,{description:description,retain:retain});closeWithReload()}catch(error){toasts.addError(new Error(error.body.message),{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.editModelSnapshotFlyout.saveErrorTitle",{defaultMessage:"Model snapshot update failed"})})}},[retain,description,snapshot]);const deleteSnapshot=Object(external_kbnSharedDeps_React_["useCallback"])(async()=>{try{await ml_api_service["ml"].deleteModelSnapshot(snapshot.job_id,snapshot.snapshot_id);hideDeleteModal();closeWithReload()}catch(error){toasts.addError(new Error(error.body.message),{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.editModelSnapshotFlyout.deleteErrorTitle",{defaultMessage:"Model snapshot deletion failed"})})}},[snapshot]);function closeWithReload(){closeFlyout(true)}function closeWithoutReload(){closeFlyout(false)}function showDeleteModal(){setDeleteModalVisible(true)}function hideDeleteModal(){setDeleteModalVisible(false)}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyout"],{onClose:closeWithoutReload,hideCloseButton:true,size:"m"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h5",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.editModelSnapshotFlyout.title",defaultMessage:"Edit snapshot {ssId}",values:{ssId:snapshot.snapshot_id}}))),isCurrentSnapshot&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{size:"s",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.editModelSnapshotFlyout.calloutTitle",{defaultMessage:"Current snapshot"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.editModelSnapshotFlyout.calloutText",defaultMessage:"This is the current snapshot being used by job {jobId} and so cannot be deleted.",values:{jobId:job.job_id}}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.editModelSnapshotFlyout.descriptionTitle",{defaultMessage:"Description"}),fullWidth:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTextArea"],{fullWidth:true,value:description,onChange:e=>setDescription(e.target.value)})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.editModelSnapshotFlyout.retainSwitchLabel",{defaultMessage:"Retain snapshot during automatic snapshot cleanup process"}),checked:retain,onChange:e=>setRetain(e.target.checked)})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutFooter"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{iconType:"cross",onClick:closeWithoutReload,flush:"left"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.editModelSnapshotFlyout.closeButton",defaultMessage:"Close"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:true}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:showDeleteModal,color:"danger",disabled:isCurrentSnapshot===true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.editModelSnapshotFlyout.useDefaultButton",defaultMessage:"Delete"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:updateSnapshot,fill:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.editModelSnapshotFlyout.saveButton",defaultMessage:"Save"})))))),deleteModalVisible&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiConfirmModal"],{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.editModelSnapshotFlyout.deleteTitle",{defaultMessage:"Delete snapshot?"}),onCancel:hideDeleteModal,onConfirm:deleteSnapshot,cancelButtonText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.editModelSnapshotFlyout.cancelButton",{defaultMessage:"Cancel"}),confirmButtonText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.editModelSnapshotFlyout.deleteButton",{defaultMessage:"Delete"}),buttonColor:"danger",defaultFocusedButton:"confirm"}))};var anomaly_utils=__webpack_require__(6);function chartLoaderProvider(mlResultsService){async function loadEventRateForJob(job,bucketSpanMs,bars){const intervalMs=Math.max(Math.floor((job.data_counts.latest_record_timestamp-job.data_counts.earliest_record_timestamp)/bars),bucketSpanMs);const resp=await mlResultsService.getEventRateData(job.datafeed_config.indices.join(),job.datafeed_config.query,job.data_description.time_field,job.data_counts.earliest_record_timestamp,job.data_counts.latest_record_timestamp,intervalMs);if(resp.error!==undefined){throw resp.error}const events=Object.entries(resp.results).map(([time,value])=>({time:+time,value:value}));if(events.length){events.push({time:events[events.length-1].time+intervalMs,value:0})}return events}async function loadAnomalyDataForJob(job,bucketSpanMs,bars){const intervalMs=Math.max(Math.floor((job.data_counts.latest_record_timestamp-job.data_counts.earliest_record_timestamp)/bars),bucketSpanMs);const resp=await mlResultsService.getScoresByBucket([job.job_id],job.data_counts.earliest_record_timestamp,job.data_counts.latest_record_timestamp,intervalMs,1);const results=resp.results[job.job_id];if(results===undefined){return[]}const anomalies={};anomalies[0]=Object.entries(results).map(([time,value])=>({time:+time,value:value,severity:Object(anomaly_utils["j"])(value)}));return anomalies}return{loadEventRateForJob:loadEventRateForJob,loadAnomalyDataForJob:loadAnomalyDataForJob}}var results_service=__webpack_require__(114);var event_rate_chart=__webpack_require__(215);var color_range_legend=__webpack_require__(139);const CreateCalendar=({calendarEvents:calendarEvents,setCalendarEvents:setCalendarEvents,minSelectableTimeStamp:minSelectableTimeStamp,maxSelectableTimeStamp:maxSelectableTimeStamp,eventRateData:eventRateData,anomalies:anomalies,chartReady:chartReady})=>{const maxSelectableTimeMoment=external_kbnSharedDeps_Moment_default()(maxSelectableTimeStamp);const minSelectableTimeMoment=external_kbnSharedDeps_Moment_default()(minSelectableTimeStamp);const{euiTheme:euiTheme}=Object(color_range_legend["e"])();const onBrushEnd=Object(external_kbnSharedDeps_React_["useCallback"])(({x:x})=>{if(x&&x.length===2){const end=x[1]<minSelectableTimeStamp?null:x[1];if(end!==null){const start=x[0]<minSelectableTimeStamp?minSelectableTimeStamp:x[0];setCalendarEvents([...calendarEvents,{start:external_kbnSharedDeps_Moment_default()(start),end:external_kbnSharedDeps_Moment_default()(end),description:createDefaultEventDescription(calendarEvents.length+1)}])}}},[calendarEvents]);const setStartDate=Object(external_kbnSharedDeps_React_["useCallback"])((start,index)=>{const event=calendarEvents[index];if(event===undefined){setCalendarEvents([...calendarEvents,{start:start,end:null,description:createDefaultEventDescription(index)}])}else{event.start=start;setCalendarEvents([...calendarEvents])}},[calendarEvents]);const setEndDate=Object(external_kbnSharedDeps_React_["useCallback"])((end,index)=>{const event=calendarEvents[index];if(event===undefined){setCalendarEvents([...calendarEvents,{start:null,end:end,description:createDefaultEventDescription(index)}])}else{event.end=end;setCalendarEvents([...calendarEvents])}},[calendarEvents]);const setDescription=Object(external_kbnSharedDeps_React_["useCallback"])((description,index)=>{const event=calendarEvents[index];if(event!==undefined){event.description=description;setCalendarEvents([...calendarEvents])}},[calendarEvents]);const removeCalendarEvent=Object(external_kbnSharedDeps_React_["useCallback"])(index=>{if(calendarEvents[index]!==undefined){const ce=[...calendarEvents];ce.splice(index,1);setCalendarEvents(ce)}},[calendarEvents]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}),external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.revertModelSnapshotFlyout.createCalendar.title",defaultMessage:"Select time range for calendar event."})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(Chart,{eventRateData:eventRateData,anomalies:anomalies,loading:chartReady===false,overlayRanges:calendarEvents.filter(filterIncompleteEvents).map(c=>({start:c.start.valueOf(),end:c.end.valueOf()})),onBrushEnd:onBrushEnd,overlayColor:euiTheme.euiColorPrimary}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),calendarEvents.map((c,i)=>{var _c$end,_c$start;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],{key:i},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPanel"],{paddingSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.revertModelSnapshotFlyout.createCalendar.fromLabel",{defaultMessage:"From"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDatePicker"],{showTimeSelect:true,selected:c.start,minDate:minSelectableTimeMoment,maxDate:(_c$end=c.end)!==null&&_c$end!==void 0?_c$end:maxSelectableTimeMoment,onChange:d=>setStartDate(d,i)}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.revertModelSnapshotFlyout.createCalendar.toLabel",{defaultMessage:"To"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDatePicker"],{showTimeSelect:true,selected:c.end,minDate:(_c$start=c.start)!==null&&_c$start!==void 0?_c$start:minSelectableTimeMoment,maxDate:maxSelectableTimeMoment,onChange:d=>setEndDate(d,i)})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true,label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.revertModelSnapshotFlyout.createCalendar.descriptionLabel",{defaultMessage:"Description"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{fullWidth:true,value:c.description,onChange:e=>setDescription(e.target.value,i)}))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,style:{borderLeft:`1px solid ${euiTheme.euiColorLightShade}`,marginRight:"0px"}}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{style:{margin:"auto"},color:"danger",onClick:()=>removeCalendarEvent(i),iconType:"trash","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.revertModelSnapshotFlyout.createCalendar.deleteLabel",{defaultMessage:"Delete event"})})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}))}))};const Chart=Object(external_kbnSharedDeps_React_["memo"])(({eventRateData:eventRateData,anomalies:anomalies,loading:loading,onBrushEnd:onBrushEnd,overlayRanges:overlayRanges,overlayColor:overlayColor})=>external_kbnSharedDeps_React_default.a.createElement(event_rate_chart["a"],{eventRateChartData:eventRateData,anomalyData:anomalies,loading:loading,height:"100px",width:"100%",fadeChart:true,overlayRanges:overlayRanges.map(c=>({start:c.start,end:c.end,color:overlayColor,showMarker:false})),onBrushEnd:onBrushEnd}),(prev,next)=>prev.overlayRanges.length===next.overlayRanges.length&&JSON.stringify(prev.overlayRanges)===JSON.stringify(next.overlayRanges));function filterIncompleteEvents(event){return event.start!==null&&event.end!==null}function createDefaultEventDescription(index){return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.revertModelSnapshotFlyout.createCalendar.defaultEventDescription",{defaultMessage:"Auto created event {index}",values:{index:index}})}const RevertModelSnapshotFlyout=({snapshot:snapshot,snapshots:snapshots,job:job,closeFlyout:closeFlyout,refresh:refresh})=>{const{toasts:toasts}=Object(kibana["f"])();const{loadAnomalyDataForJob:loadAnomalyDataForJob,loadEventRateForJob:loadEventRateForJob}=Object(external_kbnSharedDeps_React_["useMemo"])(()=>chartLoaderProvider(results_service["mlResultsService"]),[]);const[currentSnapshot,setCurrentSnapshot]=Object(external_kbnSharedDeps_React_["useState"])(snapshot);const[revertModalVisible,setRevertModalVisible]=Object(external_kbnSharedDeps_React_["useState"])(false);const[replay,setReplay]=Object(external_kbnSharedDeps_React_["useState"])(false);const[runInRealTime,setRunInRealTime]=Object(external_kbnSharedDeps_React_["useState"])(false);const[createCalendar,setCreateCalendar]=Object(external_kbnSharedDeps_React_["useState"])(false);const[calendarEvents,setCalendarEvents]=Object(external_kbnSharedDeps_React_["useState"])([]);const[calendarEventsValid,setCalendarEventsValid]=Object(external_kbnSharedDeps_React_["useState"])(true);const[eventRateData,setEventRateData]=Object(external_kbnSharedDeps_React_["useState"])([]);const[anomalies,setAnomalies]=Object(external_kbnSharedDeps_React_["useState"])([]);const[chartReady,setChartReady]=Object(external_kbnSharedDeps_React_["useState"])(false);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{createChartData()},[currentSnapshot]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const invalid=calendarEvents.some(c=>c.description===""||c.end===null||c.start===null);setCalendarEventsValid(invalid===false);const calMap=new Map(calendarEvents.map(c=>{var _c$start,_c$end;return[`${(_c$start=c.start)===null||_c$start===void 0?void 0:_c$start.valueOf()}${(_c$end=c.end)===null||_c$end===void 0?void 0:_c$end.valueOf()}`,c]}));const dedupedCalendarEvents=[...calMap.values()];if(dedupedCalendarEvents.length<calendarEvents.length){setCalendarEvents(dedupedCalendarEvents)}},[calendarEvents]);const createChartData=Object(external_kbnSharedDeps_React_["useCallback"])(async()=>{const bucketSpanMs=Object(parse_interval["a"])(job.analysis_config.bucket_span).asMilliseconds();const eventRate=await loadEventRateForJob(job,bucketSpanMs,100);const anomalyData=await loadAnomalyDataForJob(job,bucketSpanMs,100);setEventRateData(eventRate);if(anomalyData[0]!==undefined){setAnomalies(anomalyData[0])}setChartReady(true)},[job]);function showRevertModal(){setRevertModalVisible(true)}function hideRevertModal(){setRevertModalVisible(false)}async function applyRevert(){const end=replay&&runInRealTime===false?job.data_counts.latest_record_timestamp:undefined;try{const events=replay&&createCalendar?calendarEvents.filter(revert_model_snapshot_flyout_filterIncompleteEvents).map(c=>({start:c.start.valueOf(),end:c.end.valueOf(),description:c.description})):undefined;ml_api_service["ml"].jobs.revertModelSnapshot(job.job_id,currentSnapshot.snapshot_id,replay,end,events).then(()=>{toasts.addSuccess(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.revertModelSnapshotFlyout.revertSuccessTitle",{defaultMessage:"Model snapshot revert successful"}));refresh()});hideRevertModal();closeFlyout()}catch(error){toasts.addError(new Error(error.body.message),{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.revertModelSnapshotFlyout.revertErrorTitle",{defaultMessage:"Model snapshot revert failed"})})}}function onSnapshotChange(ssId){const ss=snapshots.find(s=>s.snapshot_id===ssId);if(ss!==undefined){setCurrentSnapshot(ss)}}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyout"],{onClose:closeFlyout,hideCloseButton:true,size:"m"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutHeader"],{hasBorder:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("h5",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.revertModelSnapshotFlyout.title",defaultMessage:"Revert to model snapshot {ssId}",values:{ssId:currentSnapshot.snapshot_id}}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"s"},external_kbnSharedDeps_React_default.a.createElement("p",null,currentSnapshot.description))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutBody"],null,false&&false,external_kbnSharedDeps_React_default.a.createElement(event_rate_chart["a"],{eventRateChartData:eventRateData,anomalyData:anomalies,loading:chartReady===false,height:"100px",width:"100%",fadeChart:true,overlayRanges:[{start:currentSnapshot.latest_record_time_stamp,end:job.data_counts.latest_record_timestamp,color:"#ff0000"}]}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.revertModelSnapshotFlyout.warningCallout.title",{defaultMessage:"Anomaly data will be deleted"}),color:"warning",iconType:"alert"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.revertModelSnapshotFlyout.warningCallout.contents",defaultMessage:"All anomaly detection results after {date} will be deleted.",values:{date:Object(date_utils["d"])(currentSnapshot.latest_record_time_stamp)}})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"xl"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true,helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.revertModelSnapshotFlyout.replaySwitchHelp",{defaultMessage:"Reopen job and replay analysis after the revert has been applied."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{id:"replaySwitch",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.revertModelSnapshotFlyout.replaySwitchLabel",{defaultMessage:"Replay analysis"}),checked:replay,onChange:e=>setReplay(e.target.checked)})),replay&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true,helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.revertModelSnapshotFlyout.realTimeSwitchHelp",{defaultMessage:"Job will continue to run until manually stopped. All new data added to the index will be analyzed."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{id:"realTimeSwitch",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.revertModelSnapshotFlyout.realTimeSwitchLabel",{defaultMessage:"Run job in real time"}),checked:runInRealTime,onChange:e=>setRunInRealTime(e.target.checked)})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true,helpText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.revertModelSnapshotFlyout.createCalendarSwitchHelp",{defaultMessage:"Create a new calendar and event to skip over a period of time when analyzing the data."})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{id:"createCalendarSwitch",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.revertModelSnapshotFlyout.createCalendarSwitchLabel",{defaultMessage:"Create calendar to skip a range of time"}),checked:createCalendar,onChange:e=>setCreateCalendar(e.target.checked)})),createCalendar&&external_kbnSharedDeps_React_default.a.createElement(CreateCalendar,{calendarEvents:calendarEvents,setCalendarEvents:setCalendarEvents,minSelectableTimeStamp:snapshot.latest_record_time_stamp,maxSelectableTimeStamp:job.data_counts.latest_record_timestamp,eventRateData:eventRateData,anomalies:anomalies,chartReady:chartReady}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutFooter"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{iconType:"cross",onClick:closeFlyout,flush:"left"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.revertModelSnapshotFlyout.closeButton",defaultMessage:"Close"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:true}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:showRevertModal,disabled:createCalendar===true&&calendarEventsValid===false,fill:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.revertModelSnapshotFlyout.saveButton",defaultMessage:"Apply"})))))),revertModalVisible&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiConfirmModal"],{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.revertModelSnapshotFlyout.deleteTitle",{defaultMessage:"Apply snapshot revert"}),onCancel:hideRevertModal,onConfirm:applyRevert,cancelButtonText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.revertModelSnapshotFlyout.cancelButton",{defaultMessage:"Cancel"}),confirmButtonText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.newJob.wizard.revertModelSnapshotFlyout.deleteButton",{defaultMessage:"Apply"}),buttonColor:"danger",defaultFocusedButton:"confirm"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.newJob.wizard.revertModelSnapshotFlyout.modalBody",defaultMessage:"The snapshot revert will be carried out in the background and may take some time."})))};function revert_model_snapshot_flyout_filterIncompleteEvents(event){return event.start!==null&&event.end!==null}const CloseJobConfirm=({combinedJobState:combinedJobState,hideCloseJobModalVisible:hideCloseJobModalVisible,forceCloseJob:forceCloseJob})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiConfirmModal"],{title:combinedJobState===COMBINED_JOB_STATE.OPEN_AND_RUNNING?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.modelSnapshotTable.closeJobConfirm.stopAndClose.title",{defaultMessage:"Stop datafeed and close job?"}):external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.modelSnapshotTable.closeJobConfirm.close.title",{defaultMessage:"Close job?"}),onCancel:hideCloseJobModalVisible,onConfirm:forceCloseJob,cancelButtonText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.modelSnapshotTable.closeJobConfirm.cancelButton",{defaultMessage:"Cancel"}),confirmButtonText:combinedJobState===COMBINED_JOB_STATE.OPEN_AND_RUNNING?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.modelSnapshotTable.closeJobConfirm.stopAndClose.button",{defaultMessage:"Force stop and close"}):external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.modelSnapshotTable.closeJobConfirm.close.button",{defaultMessage:"Force close"}),defaultFocusedButton:"confirm"},external_kbnSharedDeps_React_default.a.createElement("p",null,combinedJobState===COMBINED_JOB_STATE.OPEN_AND_RUNNING&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.modelSnapshotTable.closeJobConfirm.contentOpenAndRunning",defaultMessage:"Job is currently open and running."}),combinedJobState===COMBINED_JOB_STATE.OPEN_AND_STOPPED&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.modelSnapshotTable.closeJobConfirm.contentOpen",defaultMessage:"Job is currently open."}),external_kbnSharedDeps_React_default.a.createElement("br",null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.modelSnapshotTable.closeJobConfirm.content",defaultMessage:"Snapshot revert can only happen on jobs which are closed."})));let COMBINED_JOB_STATE;(function(COMBINED_JOB_STATE){COMBINED_JOB_STATE[COMBINED_JOB_STATE["OPEN_AND_RUNNING"]=0]="OPEN_AND_RUNNING";COMBINED_JOB_STATE[COMBINED_JOB_STATE["OPEN_AND_STOPPED"]=1]="OPEN_AND_STOPPED";COMBINED_JOB_STATE[COMBINED_JOB_STATE["CLOSED"]=2]="CLOSED";COMBINED_JOB_STATE[COMBINED_JOB_STATE["UNKNOWN"]=3]="UNKNOWN"})(COMBINED_JOB_STATE||(COMBINED_JOB_STATE={}));const ModelSnapshotTable=({job:job,refreshJobList:refreshJobList})=>{const canCreateJob=Object(check_capabilities["e"])("canCreateJob");const canStartStopDatafeed=Object(check_capabilities["e"])("canStartStopDatafeed");const[snapshots,setSnapshots]=Object(external_kbnSharedDeps_React_["useState"])([]);const[snapshotsLoaded,setSnapshotsLoaded]=Object(external_kbnSharedDeps_React_["useState"])(false);const[editSnapshot,setEditSnapshot]=Object(external_kbnSharedDeps_React_["useState"])(null);const[revertSnapshot,setRevertSnapshot]=Object(external_kbnSharedDeps_React_["useState"])(null);const[closeJobModalVisible,setCloseJobModalVisible]=Object(external_kbnSharedDeps_React_["useState"])(null);const[combinedJobState,setCombinedJobState]=Object(external_kbnSharedDeps_React_["useState"])(null);const isMounted=Object(external_kbnSharedDeps_React_["useRef"])(true);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{loadModelSnapshots();return()=>{isMounted.current=false}},[]);async function loadModelSnapshots(){if(isMounted.current===false){return}const{model_snapshots:ms}=await ml_api_service["ml"].getModelSnapshots(job.job_id);setSnapshots(ms);setSnapshotsLoaded(true)}const checkJobIsClosed=Object(external_kbnSharedDeps_React_["useCallback"])(async snapshot=>{const state=await getCombinedJobState(job.job_id);if(state===COMBINED_JOB_STATE.UNKNOWN){console.error(`Error retrieving state for job ${job.job_id}`);return}setCombinedJobState(state);if(state===COMBINED_JOB_STATE.CLOSED){setRevertSnapshot(snapshot)}else{setCloseJobModalVisible(snapshot)}},[job]);function hideCloseJobModalVisible(){setCombinedJobState(null);setCloseJobModalVisible(null)}const forceCloseJob=Object(external_kbnSharedDeps_React_["useCallback"])(async()=>{await ml_api_service["ml"].jobs.forceStopAndCloseJob(job.job_id);if(closeJobModalVisible!==null){const state=await getCombinedJobState(job.job_id);if(state===COMBINED_JOB_STATE.CLOSED){setRevertSnapshot(closeJobModalVisible)}}hideCloseJobModalVisible()},[job,closeJobModalVisible]);const closeEditFlyout=Object(external_kbnSharedDeps_React_["useCallback"])(reload=>{setEditSnapshot(null);if(reload){loadModelSnapshots()}},[]);const closeRevertFlyout=Object(external_kbnSharedDeps_React_["useCallback"])(()=>{setRevertSnapshot(null)},[]);const refresh=Object(external_kbnSharedDeps_React_["useCallback"])(()=>{loadModelSnapshots();setTimeout(refreshJobList,500)},[]);const columns=[{field:"snapshot_id",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.modelSnapshotTable.id",{defaultMessage:"ID"}),sortable:true},{field:"description",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.modelSnapshotTable.description",{defaultMessage:"Description"}),sortable:true},{field:"timestamp",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.modelSnapshotTable.time",{defaultMessage:"Date created"}),dataType:"date",render:date_utils["d"],sortable:true},{field:"latest_record_time_stamp",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.modelSnapshotTable.latestTimestamp",{defaultMessage:"Latest timestamp"}),dataType:"date",render:date_utils["d"],sortable:true},{field:"retain",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.modelSnapshotTable.retain",{defaultMessage:"Retain"}),width:"100px",sortable:true},{field:"",width:"100px",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.modelSnapshotTable.actions",{defaultMessage:"Actions"}),actions:[{name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.modelSnapshotTable.actions.revert.name",{defaultMessage:"Revert"}),description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.modelSnapshotTable.actions.revert.description",{defaultMessage:"Revert to this snapshot"}),enabled:()=>canCreateJob&&canStartStopDatafeed,type:"icon",icon:"crosshairs",onClick:checkJobIsClosed},{name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.modelSnapshotTable.actions.edit.name",{defaultMessage:"Edit"}),description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.modelSnapshotTable.actions.edit.description",{defaultMessage:"Edit this snapshot"}),enabled:()=>canCreateJob,type:"icon",icon:"pencil",onClick:setEditSnapshot}]}];if(snapshotsLoaded===false){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceAround"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLoadingSpinner"],{size:"l"}))))}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiInMemoryTable"],{className:"eui-textOverflowWrap",compressed:true,items:snapshots,columns:columns,pagination:{pageSizeOptions:[5,10,25]},sorting:{sort:{field:"timestamp",direction:"asc"}}}),editSnapshot!==null&&external_kbnSharedDeps_React_default.a.createElement(EditModelSnapshotFlyout,{snapshot:editSnapshot,job:job,closeFlyout:closeEditFlyout}),revertSnapshot!==null&&external_kbnSharedDeps_React_default.a.createElement(RevertModelSnapshotFlyout,{snapshot:revertSnapshot,snapshots:snapshots,job:job,closeFlyout:closeRevertFlyout,refresh:refresh}),closeJobModalVisible!==null&&combinedJobState!==null&&external_kbnSharedDeps_React_default.a.createElement(CloseJobConfirm,{combinedJobState:combinedJobState,hideCloseJobModalVisible:hideCloseJobModalVisible,forceCloseJob:forceCloseJob}))};async function getCombinedJobState(jobId){const jobs=await ml_api_service["ml"].jobs.jobs([jobId]);if(jobs.length!==1){return COMBINED_JOB_STATE.UNKNOWN}if(jobs[0].state!==states["c"].CLOSED){if(jobs[0].datafeed_config.state!==states["a"].STOPPED){return COMBINED_JOB_STATE.OPEN_AND_RUNNING}return COMBINED_JOB_STATE.OPEN_AND_STOPPED}return COMBINED_JOB_STATE.CLOSED}var external_kbnSharedDeps_ElasticEuiLibServicesFormat_=__webpack_require__(51);var recently_accessed=__webpack_require__(185);var forecast_service=__webpack_require__(160);var public_=__webpack_require__(36);var app=__webpack_require__(4);const MAX_FORECASTS=500;class forecasts_table_ForecastsTableUI extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);this.state={isLoading:props.job.data_counts.processed_record_count!==0,forecasts:[]}}componentDidMount(){const dataCounts=this.props.job.data_counts;if(dataCounts.processed_record_count>0){forecast_service["a"].getForecastsSummary(this.props.job,null,dataCounts.earliest_record_timestamp,MAX_FORECASTS).then(resp=>{this.setState({isLoading:false,forecasts:resp.forecasts})}).catch(resp=>{console.log("Error loading list of forecasts for jobs list:",resp);this.setState({isLoading:false,errorMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.forecastsTable.loadingErrorMessage",{defaultMessage:"Error loading the list of forecasts run on this job"}),forecasts:[]})})}}async openSingleMetricView(forecast){const{services:{application:{navigateToApp:navigateToApp},share:{urlGenerators:{getUrlGenerator:getUrlGenerator}}}}=this.props.kibana;const dataCounts=this.props.job.data_counts;const jobEarliest=dataCounts.earliest_record_timestamp;const resultLatest=Object(job_utils["g"])(dataCounts.latest_record_timestamp,dataCounts.latest_bucket_timestamp);const from=new Date(dataCounts.earliest_record_timestamp).toISOString();const to=forecast!==undefined?new Date(forecast.forecast_end_timestamp).toISOString():new Date(resultLatest).toISOString();let mlTimeSeriesExplorer={};if(forecast!==undefined){const forecastDurationMs=forecast.forecast_end_timestamp-forecast.forecast_start_timestamp;const zoomFrom=Math.max(forecast.forecast_start_timestamp-forecastDurationMs,jobEarliest);mlTimeSeriesExplorer={forecastId:forecast.forecast_id,zoom:{from:new Date(zoomFrom).toISOString(),to:new Date(forecast.forecast_end_timestamp).toISOString()}}}const mlUrlGenerator=getUrlGenerator(ml_url_generator["a"]);const singleMetricViewerForecastLink=await mlUrlGenerator.createUrl({page:ml_url_generator["b"].SINGLE_METRIC_VIEWER,pageState:{timeRange:{from:from,to:to,mode:"absolute"},refreshInterval:{display:"Off",pause:true,value:0},jobIds:[this.props.job.job_id],query:{query_string:{analyze_wildcard:true,query:"*"}},...mlTimeSeriesExplorer},excludeBasePath:true});Object(recently_accessed["a"])("timeseriesexplorer",this.props.job.job_id,singleMetricViewerForecastLink);await navigateToApp(app["d"],{path:singleMetricViewerForecastLink})}render(){if(this.state.isLoading===true){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceAround"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLoadingSpinner"],{size:"l"})))}if(this.state.errorMessage!==undefined){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:this.state.errorMessage,color:"danger",iconType:"cross"})}const forecasts=this.state.forecasts;if(forecasts.length===0){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.jobDetails.forecastsTable.noForecastsTitle",defaultMessage:"No forecasts have been run for this job"}),iconType:"iInCircle",role:"alert"},Object(job_utils["p"])(this.props.job)&&external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.jobDetails.forecastsTable.noForecastsDescription",defaultMessage:"To run a forecast, open the {singleMetricViewerLink}",values:{singleMetricViewerLink:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{onClick:()=>this.openSingleMetricView()},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.jobDetails.forecastsTable.noForecastsDescription.linkText",defaultMessage:"Single Metric Viewer"}))}})))}const columns=[{field:"forecast_create_timestamp",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.forecastsTable.createdLabel",{defaultMessage:"Created"}),dataType:"date",render:date_utils["d"],textOnly:true,sortable:true,scope:"row"},{field:"forecast_start_timestamp",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.forecastsTable.fromLabel",{defaultMessage:"From"}),dataType:"date",render:date_utils["d"],textOnly:true,sortable:true},{field:"forecast_end_timestamp",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.forecastsTable.toLabel",{defaultMessage:"To"}),dataType:"date",render:date_utils["d"],textOnly:true,sortable:true},{field:"forecast_status",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.forecastsTable.statusLabel",{defaultMessage:"Status"}),sortable:true},{field:"forecast_memory_bytes",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.forecastsTable.memorySizeLabel",{defaultMessage:"Memory size"}),render:bytes=>Object(external_kbnSharedDeps_ElasticEuiLibServicesFormat_["formatNumber"])(bytes,"0b"),sortable:true},{field:"processing_time_ms",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.forecastsTable.processingTimeLabel",{defaultMessage:"Processing time"}),render:ms=>external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.forecastsTable.msTimeUnitLabel",{defaultMessage:"{ms} ms",values:{ms:ms}}),sortable:true},{field:"forecast_expiry_timestamp",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.forecastsTable.expiresLabel",{defaultMessage:"Expires"}),render:date_utils["d"],textOnly:true,sortable:true},{field:"forecast_messages",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.forecastsTable.messagesLabel",{defaultMessage:"Messages"}),sortable:false,render:messages=>external_kbnSharedDeps_React_default.a.createElement("div",null,messages.map((message,index)=>external_kbnSharedDeps_React_default.a.createElement("p",{key:index},message))),textOnly:true},{name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.forecastsTable.viewLabel",{defaultMessage:"View"}),width:"60px",render:forecast=>{const viewForecastAriaLabel=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.forecastsTable.viewAriaLabel",{defaultMessage:"View forecast created at {createdDate}",values:{createdDate:Object(date_utils["d"])(forecast.forecast_create_timestamp)}});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{onClick:()=>this.openSingleMetricView(forecast),isDisabled:forecast.forecast_status!==states["b"].FINISHED,iconType:"visLine","aria-label":viewForecastAriaLabel})}}];return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiInMemoryTable"],{compressed:true,items:forecasts,columns:columns,pagination:{pageSizeOptions:[5,10,25]},sorting:true})}}const ForecastsTable=Object(public_["withKibana"])(forecasts_table_ForecastsTableUI);function SectionItem({item:item}){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTableRow"],null,item[0]!==""&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTableRowCell"],null,external_kbnSharedDeps_React_default.a.createElement("span",{className:"job-item header"},item[0])),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTableRowCell"],null,external_kbnSharedDeps_React_default.a.createElement("span",{className:"job-item"},item[1])))}function Section({section:section}){if(section.items.length===0){return external_kbnSharedDeps_React_default.a.createElement("div",null)}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("h4",null,section.title)),external_kbnSharedDeps_React_default.a.createElement("div",{className:"job-section","data-test-subj":`mlJobRowDetailsSection-${section.id}`},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTable"],{compressed:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTableBody"],null,section.items.map((item,i)=>external_kbnSharedDeps_React_default.a.createElement(SectionItem,{item:item,key:i}))))))}class job_details_pane_JobDetailsPane extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);this.state={}}static getDerivedStateFromProps(props){const{sections:sections,time:time}=props;return{sections:sections,time:time}}render(){const{sections:sections,time:time}=this.state;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement("div",{className:"row",time:time,"data-test-subj":this.props["data-test-subj"]},external_kbnSharedDeps_React_default.a.createElement("div",{className:"col-md-6"},sections.filter(s=>s.position==="left").map((s,i)=>external_kbnSharedDeps_React_default.a.createElement(Section,{section:s,key:i}))),external_kbnSharedDeps_React_default.a.createElement("div",{className:"col-md-6"},sections.filter(s=>s.position==="right").map((s,i)=>external_kbnSharedDeps_React_default.a.createElement(Section,{section:s,key:i})))))}}var job_messages=__webpack_require__(392);var errors=__webpack_require__(20);const JobMessagesPane=({jobId:jobId})=>{const[messages,setMessages]=Object(external_kbnSharedDeps_React_["useState"])([]);const[isLoading,setIsLoading]=Object(external_kbnSharedDeps_React_["useState"])(false);const[errorMessage,setErrorMessage]=Object(external_kbnSharedDeps_React_["useState"])("");const toastNotificationService=Object(toast_notification_service["c"])();const fetchMessages=async()=>{setIsLoading(true);try{setMessages(await ml_api_service["ml"].jobs.jobAuditMessages(jobId));setIsLoading(false)}catch(error){setIsLoading(false);toastNotificationService.displayErrorToast(error,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobService.jobAuditMessagesErrorTitle",{defaultMessage:"Error loading job messages"}));setErrorMessage(Object(errors["i"])(error))}};const refreshMessage=Object(external_kbnSharedDeps_React_["useCallback"])(fetchMessages,[jobId]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{fetchMessages()},[]);return external_kbnSharedDeps_React_default.a.createElement(job_messages["a"],{refreshMessage:refreshMessage,messages:messages,loading:isLoading,error:errorMessage})};class job_details_JobDetailsUI extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);this.state={};if(this.props.addYourself){this.props.addYourself(props.jobId,j=>this.updateJob(j))}}componentWillUnmount(){this.props.removeYourself(this.props.jobId)}updateJob(job){this.setState({job:job})}render(){const{job:job}=this.state;const{services:{http:{basePath:basePath}}}=this.props.kibana;if(job===undefined){return external_kbnSharedDeps_React_default.a.createElement("div",{className:"job-loading-spinner","data-test-subj":"mlJobDetails loading"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLoadingSpinner"],{size:"l"}))}else{const{general:general,customUrl:customUrl,node:node,calendars:calendars,detectors:detectors,influencers:influencers,analysisConfig:analysisConfig,analysisLimits:analysisLimits,dataDescription:dataDescription,datafeed:datafeed,counts:counts,modelSizeStats:modelSizeStats,jobTimingStats:jobTimingStats,datafeedTimingStats:datafeedTimingStats}=extractJobDetails(job,basePath);const{showFullDetails:showFullDetails,refreshJobList:refreshJobList}=this.props;const tabs=[{id:"job-settings","data-test-subj":"mlJobListTab-job-settings",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.tabs.jobSettingsLabel",{defaultMessage:"Job settings"}),content:external_kbnSharedDeps_React_default.a.createElement(job_details_pane_JobDetailsPane,{"data-test-subj":"mlJobDetails-job-settings",sections:[general,customUrl,node,calendars]}),time:job.open_time},{id:"job-config","data-test-subj":"mlJobListTab-job-config",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.tabs.jobConfigLabel",{defaultMessage:"Job config"}),content:external_kbnSharedDeps_React_default.a.createElement(job_details_pane_JobDetailsPane,{"data-test-subj":"mlJobDetails-job-config",sections:[detectors,influencers,analysisConfig,analysisLimits,dataDescription]})},{id:"counts","data-test-subj":"mlJobListTab-counts",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.tabs.countsLabel",{defaultMessage:"Counts"}),content:external_kbnSharedDeps_React_default.a.createElement(job_details_pane_JobDetailsPane,{"data-test-subj":"mlJobDetails-counts",sections:[counts,modelSizeStats,jobTimingStats]})},{id:"json","data-test-subj":"mlJobListTab-json",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.tabs.jsonLabel",{defaultMessage:"JSON"}),content:external_kbnSharedDeps_React_default.a.createElement(JsonPane,{job:job})},{id:"job-messages","data-test-subj":"mlJobListTab-job-messages",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.tabs.jobMessagesLabel",{defaultMessage:"Job messages"}),content:external_kbnSharedDeps_React_default.a.createElement(JobMessagesPane,{jobId:job.job_id})}];if(showFullDetails&&datafeed.items.length){tabs.splice(2,0,{id:"datafeed","data-test-subj":"mlJobListTab-datafeed",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.tabs.datafeedLabel",{defaultMessage:"Datafeed"}),content:external_kbnSharedDeps_React_default.a.createElement(job_details_pane_JobDetailsPane,{"data-test-subj":"mlJobDetails-datafeed",sections:[datafeed,datafeedTimingStats]})});tabs.push({id:"datafeed-preview","data-test-subj":"mlJobListTab-datafeed-preview",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.tabs.datafeedPreviewLabel",{defaultMessage:"Datafeed preview"}),content:external_kbnSharedDeps_React_default.a.createElement(datafeed_preview_tab_DatafeedPreviewPane,{job:job})},{id:"forecasts","data-test-subj":"mlJobListTab-forecasts",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.tabs.forecastsLabel",{defaultMessage:"Forecasts"}),content:external_kbnSharedDeps_React_default.a.createElement(ForecastsTable,{job:job})})}if(showFullDetails){tabs.push({id:"annotations","data-test-subj":"mlJobListTab-annotations",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.tabs.annotationsLabel",{defaultMessage:"Annotations"}),content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(annotations_table["a"],{jobs:[job],drillDown:true}),external_kbnSharedDeps_React_default.a.createElement(annotation_flyout["a"],null))});tabs.push({id:"modelSnapshots","data-test-subj":"mlJobListTab-modelSnapshots",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobDetails.tabs.modelSnapshotsLabel",{defaultMessage:"Model snapshots"}),content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(ModelSnapshotTable,{job:job,refreshJobList:refreshJobList}))})}return external_kbnSharedDeps_React_default.a.createElement("div",{className:"tab-contents","data-test-subj":`mlJobListRowDetails details-${job.job_id}`},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTabbedContent"],{tabs:tabs,initialSelectedTab:tabs[0],onTabClick:()=>{}}))}}}const job_details_JobDetails=Object(public_["withKibana"])(job_details_JobDetailsUI);const JobFilterBar=({queryText:queryText,setFilters:setFilters})=>{const[error,setError]=Object(external_kbnSharedDeps_React_["useState"])(null);const{services:{mlServices:{mlApiServices:mlApiServices}}}=Object(kibana["b"])();const loadGroups=Object(external_kbnSharedDeps_React_["useCallback"])(async()=>{try{const response=await mlApiServices.jobs.groups();return response.map(g=>({value:g.id,view:external_kbnSharedDeps_React_default.a.createElement("div",{className:"group-item"},external_kbnSharedDeps_React_default.a.createElement(JobGroup,{name:g.id})," ",external_kbnSharedDeps_React_default.a.createElement("span",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.jobFilterBar.jobGroupTitle",defaultMessage:"({jobsCount, plural, one {# job} other {# jobs}})",values:{jobsCount:g.jobIds.length}})))}))}catch(e){return[]}},[]);const queryInstance=Object(external_kbnSharedDeps_React_["useMemo"])(()=>external_kbnSharedDeps_ElasticEui_["EuiSearchBar"].Query.parse(queryText!==null&&queryText!==void 0?queryText:""),[queryText]);const onChange=({query:query,error:queryError})=>{if(error){setError(queryError)}else{setFilters(query);setError(null)}};Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setFilters(queryInstance)},[queryText]);const filters=Object(external_kbnSharedDeps_React_["useMemo"])(()=>[{type:"field_value_toggle_group",field:"job_state",items:[{value:"opened",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobFilterBar.openedLabel",{defaultMessage:"Opened"})},{value:"closed",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobFilterBar.closedLabel",{defaultMessage:"Closed"})},{value:"failed",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobFilterBar.failedLabel",{defaultMessage:"Failed"})}]},{type:"field_value_toggle_group",field:"datafeed_state",items:[{value:"started",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobFilterBar.startedLabel",{defaultMessage:"Started"})},{value:"stopped",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobFilterBar.stoppedLabel",{defaultMessage:"Stopped"})}]},{type:"field_value_selection",field:"groups",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobFilterBar.groupLabel",{defaultMessage:"Group"}),multiSelect:"or",cache:1e4,options:()=>loadGroups()}],[]);const errorText=Object(external_kbnSharedDeps_React_["useMemo"])(()=>{if(error===null)return"";return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.jobFilterBar.invalidSearchErrorMessage",{defaultMessage:"Invalid search: {errorMessage}",values:{errorMessage:error.message}})},[error]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"column"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{"data-test-subj":"mlJobListSearchBar",grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSearchBar"],{box:{incremental:true},query:queryInstance,filters:filters,onChange:onChange,className:"mlJobFilterBar"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true,isInvalid:error!==null,error:errorText,style:{maxHeight:0}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null))))};function job_details_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class tabs_job_details_JobDetails extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);job_details_defineProperty(this,"onDescriptionChange",e=>{this.setJobDetails({jobDescription:e.target.value})});job_details_defineProperty(this,"onMmlChange",e=>{this.setJobDetails({jobModelMemoryLimit:e.target.value})});job_details_defineProperty(this,"onModelSnapshotRetentionDaysChange",e=>{const jobModelSnapshotRetentionDays=Math.floor(+e.target.value);this.setJobDetails({jobModelSnapshotRetentionDays:jobModelSnapshotRetentionDays,...this.state.dailyModelSnapshotRetentionAfterDays>jobModelSnapshotRetentionDays?{jobDailyModelSnapshotRetentionAfterDays:jobModelSnapshotRetentionDays}:{}})});job_details_defineProperty(this,"onDailyModelSnapshotRetentionAfterDaysChange",e=>{const jobDailyModelSnapshotRetentionAfterDays=Math.floor(+e.target.value);if(jobDailyModelSnapshotRetentionAfterDays<=this.state.modelSnapshotRetentionDays){this.setJobDetails({jobDailyModelSnapshotRetentionAfterDays:jobDailyModelSnapshotRetentionAfterDays})}});job_details_defineProperty(this,"onGroupsChange",selectedGroups=>{this.setJobDetails({jobGroups:selectedGroups.map(g=>g.label)})});job_details_defineProperty(this,"onCreateGroup",(input,flattenedOptions)=>{const normalizedSearchValue=input.trim().toLowerCase();if(!normalizedSearchValue){return}const newGroup={label:input};const groups=this.state.groups;if(flattenedOptions.findIndex(option=>option.label.trim().toLowerCase()===normalizedSearchValue)===-1){groups.push(newGroup)}const selectedGroups=this.state.selectedGroups.concat(newGroup);this.setState({groups:groups},()=>this.onGroupsChange(selectedGroups))});this.state={description:"",groups:[],selectedGroups:[],mml:"",mmlValidationError:"",groupsValidationError:"",modelSnapshotRetentionDays:1,dailyModelSnapshotRetentionAfterDays:1};this.setJobDetails=props.setJobDetails}componentDidMount(){ml_api_service["ml"].jobs.groups().then(resp=>{const groups=resp.map(g=>({label:g.id,color:Object(group_color_utils["a"])(g.id)}));this.setState({groups:groups})}).catch(error=>{console.error("Could not load groups",error)})}static getDerivedStateFromProps(props){const selectedGroups=props.jobGroups!==undefined?props.jobGroups.map(g=>({label:g,color:Object(group_color_utils["a"])(g)})):[];return{description:props.jobDescription,selectedGroups:selectedGroups,mml:props.jobModelMemoryLimit,mmlValidationError:props.jobModelMemoryLimitValidationError,groupsValidationError:props.jobGroupsValidationError,modelSnapshotRetentionDays:props.jobModelSnapshotRetentionDays,dailyModelSnapshotRetentionAfterDays:props.jobDailyModelSnapshotRetentionAfterDays}}render(){const{description:description,selectedGroups:selectedGroups,mml:mml,groups:groups,mmlValidationError:mmlValidationError,groupsValidationError:groupsValidationError,modelSnapshotRetentionDays:modelSnapshotRetentionDays,dailyModelSnapshotRetentionAfterDays:dailyModelSnapshotRetentionAfterDays}=this.state;const{datafeedRunning:datafeedRunning}=this.props;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiForm"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.editJobFlyout.jobDetails.jobDescriptionLabel",defaultMessage:"Job description"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{value:description,onChange:this.onDescriptionChange})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.editJobFlyout.jobDetails.jobGroupsLabel",defaultMessage:"Job groups"}),isInvalid:groupsValidationError!=="",error:groupsValidationError},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiComboBox"],{placeholder:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.editJobFlyout.jobDetails.jobGroupsPlaceholder",{defaultMessage:"Select or create groups"}),options:groups,selectedOptions:selectedGroups,onChange:this.onGroupsChange,onCreateOption:this.onCreateGroup,isClearable:true,isInvalid:groupsValidationError!=="",error:groupsValidationError})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.editJobFlyout.jobDetails.modelMemoryLimitLabel",defaultMessage:"Model memory limit"}),helpText:datafeedRunning?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.editJobFlyout.jobDetails.modelMemoryLimitLabelHelp",defaultMessage:"Model memory limit cannot be edited while the datafeed is running."}):null,isInvalid:mmlValidationError!=="",error:mmlValidationError},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{value:mml,onChange:this.onMmlChange,isInvalid:mmlValidationError!=="",error:mmlValidationError,disabled:datafeedRunning})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.editJobFlyout.jobDetails.modelSnapshotRetentionDaysLabel",defaultMessage:"Model snapshot retention days"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{min:0,value:modelSnapshotRetentionDays,onChange:this.onModelSnapshotRetentionDaysChange})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.editJobFlyout.jobDetails.dailyModelSnapshotRetentionAfterDaysLabel",defaultMessage:"Daily model snapshot retention after days"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{min:0,max:modelSnapshotRetentionDays,value:dailyModelSnapshotRetentionAfterDays,onChange:this.onDailyModelSnapshotRetentionAfterDaysChange}))))}}function detectors_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class detectors_Detectors extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);detectors_defineProperty(this,"onDescriptionChange",(e,i)=>{const jobDetectorDescriptions=this.state.detectorDescriptions;jobDetectorDescriptions[i]=e.target.value;this.setDetectorDescriptions({jobDetectorDescriptions:jobDetectorDescriptions})});this.detectors=job_service["a"].getJobGroups().map(g=>({label:g.id}));this.state={detectors:[],detectorDescriptions:[]};this.setDetectorDescriptions=props.setDetectorDescriptions}static getDerivedStateFromProps(props){return{detectors:props.jobDetectors,detectorDescriptions:props.jobDetectorDescriptions}}render(){const{detectors:detectors,detectorDescriptions:detectorDescriptions}=this.state;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiForm"],null,detectorDescriptions.map((d,i)=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:Object(string_utils["b"])(detectors[i]),key:i},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{value:d,onChange:e=>this.onDescriptionChange(e,i)})))))}}var ml_server_info=__webpack_require__(83);function datafeed_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function getDefaults(bucketSpan,jobDefaults){const bucketSpanSeconds=bucketSpan!==undefined?Object(parse_interval["a"])(bucketSpan).asSeconds():"";return{queryDelay:"60s",frequency:Object(job_utils["f"])(bucketSpanSeconds)+"s",scrollSize:jobDefaults.datafeeds.scroll_size}}class datafeed_Datafeed extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);datafeed_defineProperty(this,"onQueryChange",query=>{this.setDatafeed({datafeedQuery:query})});datafeed_defineProperty(this,"onQueryDelayChange",e=>{this.setDatafeed({datafeedQueryDelay:e.target.value})});datafeed_defineProperty(this,"onFrequencyChange",e=>{this.setDatafeed({datafeedFrequency:e.target.value})});datafeed_defineProperty(this,"onScrollSizeChange",e=>{this.setDatafeed({datafeedScrollSize:+e.target.value})});this.state={query:"",queryDelay:"",frequency:"",scrollSize:"",defaults:{queryDelay:"",frequency:"",scrollSize:0},jobDefaults:Object(ml_server_info["b"])()};this.setDatafeed=props.setDatafeed}static getDerivedStateFromProps(props,state){return{query:props.datafeedQuery,queryDelay:props.datafeedQueryDelay,frequency:props.datafeedFrequency,scrollSize:props.datafeedScrollSize,defaults:getDefaults(props.jobBucketSpan,state.jobDefaults)}}render(){const{query:query,queryDelay:queryDelay,frequency:frequency,scrollSize:scrollSize,defaults:defaults}=this.state;const{datafeedRunning:datafeedRunning}=this.props;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),datafeedRunning&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{color:"warning"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.editJobFlyout.datafeed.readOnlyCalloutText",defaultMessage:"Datafeed settings cannot be edited while the datafeed is running. Please stop the job if you wish to edit these settings."})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"l"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiForm"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.editJobFlyout.datafeed.queryLabel",defaultMessage:"Query"}),style:{maxWidth:"inherit"}},external_kbnSharedDeps_React_default.a.createElement(ml_job_editor["a"],{mode:ml_job_editor["b"].XJSON,value:query,onChange:this.onQueryChange,height:"200px",readOnly:datafeedRunning})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.editJobFlyout.datafeed.queryDelayLabel",defaultMessage:"Query delay"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{value:queryDelay,placeholder:defaults.queryDelay,onChange:this.onQueryDelayChange,disabled:datafeedRunning})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.editJobFlyout.datafeed.frequencyLabel",defaultMessage:"Frequency"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{value:frequency,placeholder:defaults.frequency,onChange:this.onFrequencyChange,disabled:datafeedRunning})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.editJobFlyout.datafeed.scrollSizeLabel",defaultMessage:"Scroll size"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{value:scrollSize,placeholder:defaults.scrollSize,onChange:this.onScrollSizeChange,disabled:datafeedRunning}))))}}var custom_urls=__webpack_require__(262);var edit_utils=__webpack_require__(298);var util=__webpack_require__(187);var custom_url_utils=__webpack_require__(144);function validateModelMemoryLimit(mml){const limits=Object(ml_server_info["c"])();const tempJob={analysis_limits:{model_memory_limit:mml}};let validationResults=Object(job_utils["w"])(mml);let{valid:valid}=validationResults;if(valid){validationResults=Object(job_utils["v"])(tempJob,limits);valid=validationResults.valid}const modelMemoryLimit={valid:valid,message:""};Object(util["b"])(validationResults,{modelMemoryLimit:modelMemoryLimit});return modelMemoryLimit}function validateGroupNames(groups){const tempJob={groups:groups};const validationResults=Object(job_utils["u"])(tempJob);const{valid:valid}=validationResults;const groupIds={valid:valid,message:""};Object(util["b"])(validationResults,{groupIds:groupIds});return groupIds}function isValidCustomUrls(customUrls){if(customUrls===undefined||customUrls.length===0){return true}const isInvalidItem=customUrls.some((customUrl,index)=>{const label=customUrl.url_name;const otherUrls=[...customUrls];otherUrls.splice(index,1);let itemValid=Object(custom_url_utils["b"])(label,otherUrls);if(itemValid===true){const timeRange=customUrl.time_range;itemValid=Object(custom_url_utils["c"])(timeRange)}return!itemValid});return!isInvalidItem}var shared_imports=__webpack_require__(159);function edit_job_flyout_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class edit_job_flyout_EditJobFlyoutUI extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);edit_job_flyout_defineProperty(this,"_initialJobFormState",null);edit_job_flyout_defineProperty(this,"closeFlyout",(isConfirmed=false)=>{if(this.containsUnsavedChanges()&&!isConfirmed){this.setState({isConfirmationModalVisible:true});return}this.setState({isConfirmationModalVisible:false});this.setState({isFlyoutVisible:false})});edit_job_flyout_defineProperty(this,"showFlyout",jobLite=>{const hasDatafeed=jobLite.hasDatafeed;loadFullJob(jobLite.id).then(job=>{this.extractJob(job,hasDatafeed);this.setState({job:job,isFlyoutVisible:true})}).catch(error=>{console.error(error)})});edit_job_flyout_defineProperty(this,"setJobDetails",jobDetails=>{let{jobModelMemoryLimitValidationError:jobModelMemoryLimitValidationError,jobGroupsValidationError:jobGroupsValidationError}=this.state;if(jobDetails.jobModelMemoryLimit!==undefined){jobModelMemoryLimitValidationError=validateModelMemoryLimit(jobDetails.jobModelMemoryLimit).message}if(jobDetails.jobGroups!==undefined){jobGroupsValidationError=validateGroupNames(jobDetails.jobGroups).message;if(jobGroupsValidationError===""){ml_api_service["ml"].jobs.jobsExist(jobDetails.jobGroups,true).then(resp=>{const groups=Object.values(resp);const valid=groups.some(g=>g.exists===true&&g.isGroup===false)===false;if(valid===false){this.setState({jobGroupsValidationError:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.editJobFlyout.groupsAndJobsHasSameIdErrorMessage",{defaultMessage:"A job with this ID already exists. Groups and jobs cannot use the same ID."}),isValidJobDetails:false})}})}}const isValidJobDetails=jobModelMemoryLimitValidationError===""&&jobGroupsValidationError==="";this.setState({...jobDetails,jobModelMemoryLimitValidationError:jobModelMemoryLimitValidationError,jobGroupsValidationError:jobGroupsValidationError,isValidJobDetails:isValidJobDetails})});edit_job_flyout_defineProperty(this,"setDetectorDescriptions",jobDetectorDescriptions=>{this.setState({...jobDetectorDescriptions})});edit_job_flyout_defineProperty(this,"setDatafeed",datafeed=>{this.setState({...datafeed})});edit_job_flyout_defineProperty(this,"setCustomUrls",jobCustomUrls=>{const isValidJobCustomUrls=isValidCustomUrls(jobCustomUrls);this.setState({jobCustomUrls:jobCustomUrls,isValidJobCustomUrls:isValidJobCustomUrls})});edit_job_flyout_defineProperty(this,"save",()=>{const newJobData={description:this.state.jobDescription,groups:this.state.jobGroups,mml:this.state.jobModelMemoryLimit,modelSnapshotRetentionDays:this.state.jobModelSnapshotRetentionDays,dailyModelSnapshotRetentionAfterDays:this.state.jobDailyModelSnapshotRetentionAfterDays,detectorDescriptions:this.state.jobDetectorDescriptions,datafeedQuery:Object(shared_imports["b"])(this.state.datafeedQuery),datafeedQueryDelay:this.state.datafeedQueryDelay,datafeedFrequency:this.state.datafeedFrequency,datafeedScrollSize:this.state.datafeedScrollSize,customUrls:this.state.jobCustomUrls};const{toasts:toasts}=this.props.kibana.services.notifications;const toastNotificationService=Object(toast_notification_service["b"])(toasts);Object(edit_utils["c"])(this.state.job,newJobData).then(()=>{toasts.addSuccess(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.editJobFlyout.changesSavedNotificationMessage",{defaultMessage:"Changes to {jobId} saved",values:{jobId:this.state.job.job_id}}));this.refreshJobs();this.closeFlyout(true)}).catch(error=>{console.error(error);toastNotificationService.displayErrorToast(error,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.editJobFlyout.changesNotSavedNotificationMessage",{defaultMessage:"Could not save changes to {jobId}",values:{jobId:this.state.job.job_id}}))})});this.state={job:{},hasDatafeed:false,datafeedRunning:false,isFlyoutVisible:false,isConfirmationModalVisible:false,jobDescription:"",jobGroups:[],jobModelMemoryLimit:"",jobModelSnapshotRetentionDays:10,jobDailyModelSnapshotRetentionAfterDays:10,jobDetectors:[],jobDetectorDescriptions:[],jobCustomUrls:[],datafeedQuery:"",datafeedQueryDelay:"",datafeedFrequency:"",datafeedScrollSize:"",jobModelMemoryLimitValidationError:"",jobGroupsValidationError:"",isValidJobDetails:true,isValidJobCustomUrls:true};this.refreshJobs=this.props.refreshJobs}componentDidMount(){if(typeof this.props.setShowFunction==="function"){this.props.setShowFunction(this.showFlyout)}}componentWillUnmount(){if(typeof this.props.unsetShowFunction==="function"){this.props.unsetShowFunction()}}containsUnsavedChanges(){return!Object(external_kbnSharedDeps_Lodash_["isEqual"])(this._initialJobFormState,Object(external_kbnSharedDeps_Lodash_["pick"])(this.state,["jobDescription","jobGroups","jobModelMemoryLimit","jobModelSnapshotRetentionDays","jobDailyModelSnapshotRetentionAfterDays","jobCustomUrls","jobDetectors","jobDetectorDescriptions","jobBucketSpan","datafeedQuery","datafeedQueryDelay","datafeedFrequency","datafeedScrollSize"]))}extractInitialJobFormState(job,hasDatafeed){const mml=job.analysis_limits&&job.analysis_limits.model_memory_limit?job.analysis_limits.model_memory_limit:"";const modelSnapshotRetentionDays=job.model_snapshot_retention_days!==undefined?job.model_snapshot_retention_days:10;const dailyModelSnapshotRetentionAfterDays=job.daily_model_snapshot_retention_after_days!==undefined?job.daily_model_snapshot_retention_after_days:modelSnapshotRetentionDays;const detectors=job.analysis_config&&job.analysis_config.detectors?[...job.analysis_config.detectors]:[];const bucketSpan=job.analysis_config?job.analysis_config.bucket_span:"";const datafeedConfig={...job.datafeed_config};const frequency=datafeedConfig.frequency!==undefined?datafeedConfig.frequency:"";const customUrls=job.custom_settings&&job.custom_settings.custom_urls?[...job.custom_settings.custom_urls]:[];this._initialJobFormState=Object.freeze({jobDescription:job.description,jobGroups:job.groups!==undefined?job.groups:[],jobModelMemoryLimit:mml,jobModelSnapshotRetentionDays:modelSnapshotRetentionDays,jobDailyModelSnapshotRetentionAfterDays:dailyModelSnapshotRetentionAfterDays,jobDetectors:detectors,jobDetectorDescriptions:detectors.map(d=>d.detector_description),jobBucketSpan:bucketSpan,jobCustomUrls:customUrls,datafeedQuery:hasDatafeed?JSON.stringify(datafeedConfig.query,null,2):"",datafeedQueryDelay:hasDatafeed?datafeedConfig.query_delay:"",datafeedFrequency:hasDatafeed?frequency:"",datafeedScrollSize:hasDatafeed?+datafeedConfig.scroll_size:null})}extractJob(job,hasDatafeed){this.extractInitialJobFormState(job,hasDatafeed);const datafeedRunning=hasDatafeed&&job.datafeed_config.state!==states["a"].STOPPED;this.setState({job:job,hasDatafeed:hasDatafeed,datafeedRunning:datafeedRunning,jobModelMemoryLimitValidationError:"",jobGroupsValidationError:"",...Object(external_kbnSharedDeps_Lodash_["cloneDeep"])(this._initialJobFormState)})}render(){let flyout;let confirmationModal;if(this.state.isFlyoutVisible){const{job:job,jobDescription:jobDescription,jobGroups:jobGroups,jobModelMemoryLimit:jobModelMemoryLimit,jobModelSnapshotRetentionDays:jobModelSnapshotRetentionDays,jobDailyModelSnapshotRetentionAfterDays:jobDailyModelSnapshotRetentionAfterDays,jobDetectors:jobDetectors,jobDetectorDescriptions:jobDetectorDescriptions,jobBucketSpan:jobBucketSpan,jobCustomUrls:jobCustomUrls,datafeedQuery:datafeedQuery,datafeedQueryDelay:datafeedQueryDelay,datafeedFrequency:datafeedFrequency,datafeedScrollSize:datafeedScrollSize,jobGroupsValidationError:jobGroupsValidationError,jobModelMemoryLimitValidationError:jobModelMemoryLimitValidationError,isValidJobDetails:isValidJobDetails,isValidJobCustomUrls:isValidJobCustomUrls,datafeedRunning:datafeedRunning}=this.state;const tabs=[{id:"job-details",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.editJobFlyout.jobDetailsTitle",{defaultMessage:"Job details"}),content:external_kbnSharedDeps_React_default.a.createElement(tabs_job_details_JobDetails,{datafeedRunning:datafeedRunning,jobDescription:jobDescription,jobGroups:jobGroups,jobModelMemoryLimit:jobModelMemoryLimit,jobModelSnapshotRetentionDays:jobModelSnapshotRetentionDays,jobDailyModelSnapshotRetentionAfterDays:jobDailyModelSnapshotRetentionAfterDays,setJobDetails:this.setJobDetails,jobGroupsValidationError:jobGroupsValidationError,jobModelMemoryLimitValidationError:jobModelMemoryLimitValidationError})},{id:"detectors",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.editJobFlyout.detectorsTitle",{defaultMessage:"Detectors"}),content:external_kbnSharedDeps_React_default.a.createElement(detectors_Detectors,{jobDetectors:jobDetectors,jobDetectorDescriptions:jobDetectorDescriptions,setDetectorDescriptions:this.setDetectorDescriptions})},{id:"datafeed",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.editJobFlyout.datafeedTitle",{defaultMessage:"Datafeed"}),content:external_kbnSharedDeps_React_default.a.createElement(datafeed_Datafeed,{datafeedQuery:datafeedQuery,datafeedQueryDelay:datafeedQueryDelay,datafeedFrequency:datafeedFrequency,datafeedScrollSize:datafeedScrollSize,jobBucketSpan:jobBucketSpan,setDatafeed:this.setDatafeed,datafeedRunning:datafeedRunning})},{id:"custom-urls",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.editJobFlyout.customUrlsTitle",{defaultMessage:"Custom URLs"}),content:external_kbnSharedDeps_React_default.a.createElement(custom_urls["a"],{job:job,jobCustomUrls:jobCustomUrls,setCustomUrls:this.setCustomUrls})}];flyout=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyout"],{onClose:()=>{this.closeFlyout()},size:"m"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],null,external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.editJobFlyout.pageTitle",defaultMessage:"Edit {jobId}",values:{jobId:job.job_id}})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTabbedContent"],{tabs:tabs,initialSelectedTab:tabs[0],onTabClick:()=>{}})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutFooter"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{iconType:"cross",onClick:()=>{this.closeFlyout()},flush:"left"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.editJobFlyout.closeButtonLabel",defaultMessage:"Close"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:this.save,fill:true,isDisabled:isValidJobDetails===false||isValidJobCustomUrls===false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.editJobFlyout.saveButtonLabel",defaultMessage:"Save"}))))))}if(this.state.isConfirmationModalVisible){confirmationModal=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiConfirmModal"],{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.editJobFlyout.unsavedChangesDialogTitle",defaultMessage:"Save changes before leaving?"}),onCancel:()=>this.closeFlyout(true),onConfirm:()=>this.save(),cancelButtonText:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.editJobFlyout.leaveAnywayButtonLabel",defaultMessage:"Leave anyway"}),confirmButtonText:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.editJobFlyout.saveChangesButtonLabel",defaultMessage:"Save changes"}),defaultFocusedButton:"confirm"},external_kbnSharedDeps_React_default.a.createElement("p",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.editJobFlyout.unsavedChangesDialogMessage",defaultMessage:"If you don't save, your changes will be lost."})))}{return external_kbnSharedDeps_React_default.a.createElement("div",null,flyout,confirmationModal)}}}const EditJobFlyout=Object(public_["withKibana"])(edit_job_flyout_EditJobFlyoutUI);var jobs_list=__webpack_require__(181);var delete_job_check_modal=__webpack_require__(271);const DeleteJobModal=({setShowFunction:setShowFunction,unsetShowFunction:unsetShowFunction,refreshJobs:refreshJobs})=>{const[deleting,setDeleting]=Object(external_kbnSharedDeps_React_["useState"])(false);const[modalVisible,setModalVisible]=Object(external_kbnSharedDeps_React_["useState"])(false);const[jobIds,setJobIds]=Object(external_kbnSharedDeps_React_["useState"])([]);const[canDelete,setCanDelete]=Object(external_kbnSharedDeps_React_["useState"])(false);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(typeof setShowFunction==="function"){setShowFunction(showModal)}return()=>{if(typeof unsetShowFunction==="function"){unsetShowFunction()}}},[]);function showModal(jobs){setJobIds(jobs.map(({id:id})=>id));setModalVisible(true);setDeleting(false)}function closeModal(){setModalVisible(false);setCanDelete(false)}function deleteJob(){setDeleting(true);deleteJobs(jobIds.map(id=>({id:id})));setTimeout(()=>{closeModal();refreshJobs()},jobs_list["b"])}if(modalVisible===false||jobIds.length===0){return null}if(canDelete){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModal"],{"data-test-subj":"mlDeleteJobConfirmModal",onClose:closeModal},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalHeaderTitle"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.deleteJobModal.deleteJobsTitle",defaultMessage:"Delete {jobsCount, plural, one {{jobId}} other {# jobs}}?",values:{jobsCount:jobIds.length,jobId:jobIds[0]}}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalBody"],null,external_kbnSharedDeps_React_default.a.createElement("p",null,deleting===true?external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.deleteJobModal.deletingJobsStatusLabel",defaultMessage:"Deleting jobs"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement("div",{style:{textAlign:"center"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLoadingSpinner"],{size:"l"}))):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.deleteJobModal.deleteMultipleJobsDescription",defaultMessage:"Deleting {jobsCount, plural, one {a job} other {multiple jobs}} can be time consuming. {jobsCount, plural, one {It} other {They}} will be deleted in the background and may not disappear from the jobs list instantly.",values:{jobsCount:jobIds.length}})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalFooter"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:closeModal,disabled:deleting},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.deleteJobModal.cancelButtonLabel",defaultMessage:"Cancel"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:deleteJob,fill:true,disabled:deleting,color:"danger","data-test-subj":"mlDeleteJobConfirmModalButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.deleteJobModal.deleteButtonLabel",defaultMessage:"Delete"})))))}else{return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(delete_job_check_modal["a"],{jobIds:jobIds,jobType:"anomaly-detector",canDeleteCallback:()=>{setCanDelete(true)},onCloseCallback:closeModal,refreshJobsCallback:refreshJobs}))}};var _time_range_selector=__webpack_require__(446);function time_range_selector_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class time_range_selector_TimeRangeSelector extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);time_range_selector_defineProperty(this,"setStartTab",tab=>{this.setState({startTab:tab});switch(tab){case 0:this.setStartTime(undefined);break;case 1:this.setStartTime(this.now);break;default:break}});time_range_selector_defineProperty(this,"setEndTab",tab=>{this.setState({endTab:tab});switch(tab){case 0:this.setEndTime(undefined);break;case 1:this.setEndTime(this.now);break;default:break}});time_range_selector_defineProperty(this,"setStartTime",time=>{this.props.setStartTime(time)});time_range_selector_defineProperty(this,"setEndTime",time=>{this.props.setEndTime(time)});this.state={startTab:0,endTab:1};this.latestTimestamp=this.props.startTime;this.now=this.props.now}getTabItems(){const datePickerTimes={start:external_kbnSharedDeps_Moment_default.a.isMoment(this.props.startTime)?this.props.startTime:this.latestTimestamp,end:external_kbnSharedDeps_Moment_default.a.isMoment(this.props.endTime)?this.props.endTime:this.now};const formattedLatestStartTime=this.latestTimestamp.format(time_format["a"]);const showContinueLabels=this.latestTimestamp.valueOf()>0;const startLabels=showContinueLabels===true?[external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.startDatafeedModal.continueFromStartTimeLabel",defaultMessage:"Continue from {formattedLatestStartTime}",values:{formattedLatestStartTime:formattedLatestStartTime}}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.startDatafeedModal.continueFromNowLabel",defaultMessage:"Continue from now"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.startDatafeedModal.continueFromSpecifiedTimeLabel",defaultMessage:"Continue from specified time"})]:[external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.startDatafeedModal.startAtBeginningOfDataLabel",defaultMessage:"Start at beginning of data"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.startDatafeedModal.startFromNowLabel",defaultMessage:"Start from now"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.startDatafeedModal.specifyStartTimeLabel",defaultMessage:"Specify start time"})];const startItems=[{index:0,label:startLabels[0]},{index:1,label:startLabels[1]},{index:2,label:startLabels[2],body:external_kbnSharedDeps_React_default.a.createElement(DatePickerWithInput,{date:datePickerTimes.start,onChange:this.setStartTime,maxDate:datePickerTimes.end,setIsValid:this.props.setTimeRangeValid,tab:this.state.startTab})}];const endItems=[{index:0,label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.startDatafeedModal.noEndTimeLabel",defaultMessage:"No end time (Real-time search)"})},{index:1,label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.startDatafeedModal.specifyEndTimeLabel",defaultMessage:"Specify end time"}),body:external_kbnSharedDeps_React_default.a.createElement(DatePickerWithInput,{date:datePickerTimes.end,onChange:this.setEndTime,minDate:datePickerTimes.start,setIsValid:this.props.setTimeRangeValid,tab:this.state.endTab})}];return{startItems:startItems,endItems:endItems}}render(){const{startItems:startItems,endItems:endItems}=this.getTabItems();return external_kbnSharedDeps_React_default.a.createElement("div",{className:"time-range-selector"},external_kbnSharedDeps_React_default.a.createElement("div",{className:"time-range-section-container"},external_kbnSharedDeps_React_default.a.createElement(TabStack,{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.startDatafeedModal.searchStartTimeTitle",defaultMessage:"Search start time"}),items:startItems,switchState:this.state.startTab,switchFunc:this.setStartTab}),external_kbnSharedDeps_React_default.a.createElement(TabStack,{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.startDatafeedModal.searchEndTimeTitle",defaultMessage:"Search end time"}),items:endItems,switchState:this.state.endTab,switchFunc:this.setEndTab})))}}function TabStack({title:title,items:items,switchState:switchState,switchFunc:switchFunc}){return external_kbnSharedDeps_React_default.a.createElement("div",{className:"time-range-section"},external_kbnSharedDeps_React_default.a.createElement("div",{className:"time-range-section-title"},title),external_kbnSharedDeps_React_default.a.createElement("ul",{className:"tab-stack"},items.map((item,i)=>{let className="";if(switchState===item.index){className+="active "}if(item.body!==undefined){className+="has-body "}return external_kbnSharedDeps_React_default.a.createElement("li",{key:i,className:className},external_kbnSharedDeps_React_default.a.createElement("a",{onClick:()=>switchFunc(item.index),onKeyUp:()=>{}},item.label),item.body!==undefined&&external_kbnSharedDeps_React_default.a.createElement("div",{className:"body"},item.body))})))}const DatePickerWithInput=({date:date,onChange:onChange,minDate:minDate,setIsValid:setIsValid,tab:tab})=>{const[dateString,setDateString]=Object(external_kbnSharedDeps_React_["useState"])(date.format(time_format["a"]));const[currentTab,setCurrentTab]=Object(external_kbnSharedDeps_React_["useState"])(tab);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(currentTab!==tab){setDateString(date.format(time_format["a"]));setCurrentTab(tab)}},[tab]);function onTextChange(e){const val=e.target.value;setDateString(val);const newDate=external_kbnSharedDeps_Moment_default()(val);if(newDate.isValid()){setIsValid(true);onChange(newDate)}else{setIsValid(false)}}function onCalendarChange(newDate){setDateString(newDate.format(time_format["a"]));setIsValid(true);onChange(newDate)}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{value:dateString,onChange:onTextChange,placeholder:time_format["a"],"aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate('xpack.ml.jobsList.startDatafeedModal.enterDateText"',{defaultMessage:"Enter date"})}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiDatePicker"],{selected:date,onChange:onCalendarChange,minDate:minDate,inline:true,showTimeSelect:true}))};function start_datafeed_modal_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class start_datafeed_modal_StartDatafeedModal extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);start_datafeed_modal_defineProperty(this,"setStartTime",time=>{this.setState({startTime:time})});start_datafeed_modal_defineProperty(this,"setEndTime",time=>{this.setState({endTime:time})});start_datafeed_modal_defineProperty(this,"setCreateAlert",e=>{this.setState({createAlert:e.target.checked})});start_datafeed_modal_defineProperty(this,"closeModal",()=>{this.setState({isModalVisible:false})});start_datafeed_modal_defineProperty(this,"setTimeRangeValid",timeRangeValid=>{this.setState({timeRangeValid:timeRangeValid})});start_datafeed_modal_defineProperty(this,"showModal",(jobs,showCreateAlertFlyout)=>{const startTime=undefined;const now=external_kbnSharedDeps_Moment_default()();const endTime=now;const initialSpecifiedStartTime=getLowestLatestTime(jobs);const allowCreateAlert=jobs.length>0;this.setState({jobs:jobs,isModalVisible:true,startTime:startTime,endTime:endTime,initialSpecifiedStartTime:initialSpecifiedStartTime,showCreateAlertFlyout:showCreateAlertFlyout,allowCreateAlert:allowCreateAlert,createAlert:false,now:now})});start_datafeed_modal_defineProperty(this,"save",()=>{const{jobs:jobs}=this.state;const start=external_kbnSharedDeps_Moment_default.a.isMoment(this.state.startTime)?this.state.startTime.valueOf():this.state.startTime;const end=external_kbnSharedDeps_Moment_default.a.isMoment(this.state.endTime)?this.state.endTime.valueOf():this.state.endTime;forceStartDatafeeds(jobs,start,end,()=>{if(this.state.createAlert&&jobs.length>0){this.getShowCreateAlertFlyoutFunction()(jobs.map(job=>job.id))}this.refreshJobs()});this.closeModal()});const _now=external_kbnSharedDeps_Moment_default()();this.state={jobs:this.props.jobs,isModalVisible:false,startTime:_now,endTime:_now,createAlert:false,allowCreateAlert:false,initialSpecifiedStartTime:_now,now:_now,timeRangeValid:true};this.initialSpecifiedStartTime=_now;this.refreshJobs=this.props.refreshJobs;this.getShowCreateAlertFlyoutFunction=this.props.getShowCreateAlertFlyoutFunction}componentDidMount(){if(typeof this.props.setShowFunction==="function"){this.props.setShowFunction(this.showModal)}}componentWillUnmount(){if(typeof this.props.unsetShowFunction==="function"){this.props.unsetShowFunction()}}render(){const{jobs:jobs,initialSpecifiedStartTime:initialSpecifiedStartTime,startTime:startTime,endTime:endTime,createAlert:createAlert,now:now,timeRangeValid:timeRangeValid}=this.state;const startableJobs=jobs!==undefined?jobs.filter(j=>j.hasDatafeed):[];const startDisabled=timeRangeValid===false||startTime!==undefined&&startTime===endTime;let modal;if(this.state.isModalVisible){modal=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModal"],{onClose:this.closeModal,style:{width:"850px"},maxWidth:false,"data-test-subj":"mlStartDatafeedModal"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalHeaderTitle"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.startDatafeedModal.startJobsTitle",defaultMessage:"Start {jobsCount, plural, one {{jobId}} other {# jobs}}",values:{jobsCount:startableJobs.length,jobId:startableJobs[0].id}}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalBody"],null,external_kbnSharedDeps_React_default.a.createElement(time_range_selector_TimeRangeSelector,{startTime:startTime===undefined?initialSpecifiedStartTime:startTime,endTime:endTime,setStartTime:this.setStartTime,setEndTime:this.setEndTime,now:now,setTimeRangeValid:this.setTimeRangeValid}),this.state.endTime===undefined&&external_kbnSharedDeps_React_default.a.createElement("div",{className:"create-watch"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCheckbox"],{id:"createAlert",label:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.startDatafeedModal.createAlertDescription",defaultMessage:"Create alert after datafeed has started"}),checked:createAlert,onChange:this.setCreateAlert}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalFooter"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:this.closeModal,"data-test-subj":"mlStartDatafeedModalCancelButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.startDatafeedModal.cancelButtonLabel",defaultMessage:"Cancel"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:this.save,isDisabled:startDisabled,fill:true,"data-test-subj":"mlStartDatafeedModalStartButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.startDatafeedModal.startButtonLabel",defaultMessage:"Start"}))))}return external_kbnSharedDeps_React_default.a.createElement("div",null,modal)}}function getLowestLatestTime(jobs){const times=jobs.map(j=>j.earliestStartTimestampMs||0);return external_kbnSharedDeps_Moment_default()(Math.min(...times))}function actions_menu_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class actions_menu_MultiJobActionsMenuUI extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);actions_menu_defineProperty(this,"onButtonClick",()=>{this.setState(prevState=>({isOpen:!prevState.isOpen}))});actions_menu_defineProperty(this,"closePopover",()=>{this.setState({isOpen:false})});this.state={isOpen:false};this.canDeleteJob=Object(check_capabilities["e"])("canDeleteJob");this.canStartStopDatafeed=Object(check_capabilities["e"])("canStartStopDatafeed")&&Object(check_ml_nodes["e"])();this.canCloseJob=Object(check_capabilities["e"])("canCloseJob")&&Object(check_ml_nodes["e"])();this.canCreateMlAlerts=Object(check_capabilities["e"])("canCreateMlAlerts")}render(){const anyJobsDeleting=this.props.jobs.some(j=>j.deleting);const button=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{size:"s",onClick:this.onButtonClick,iconType:"gear","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.multiJobActionsMenu.managementActionsAriaLabel",{defaultMessage:"Management actions"}),color:"text",disabled:anyJobsDeleting||this.canDeleteJob===false&&this.canStartStopDatafeed===false,"data-test-subj":"mlADJobListMultiSelectManagementActionsButton"});const items=[external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiContextMenuItem"],{key:"delete",icon:"trash",disabled:this.canDeleteJob===false,onClick:()=>{this.props.showDeleteJobModal(this.props.jobs);this.closePopover()},"data-test-subj":"mlADJobListMultiSelectDeleteJobActionButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.multiJobsActions.deleteJobsLabel",defaultMessage:"Delete {jobsCount, plural, one {job} other {jobs}}",values:{jobsCount:this.props.jobs.length}}))];if(isClosable(this.props.jobs)){items.push(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiContextMenuItem"],{key:"close job",icon:"cross",disabled:this.canCloseJob===false,onClick:()=>{closeJobs(this.props.jobs);this.closePopover()},"data-test-subj":"mlADJobListMultiSelectCloseJobActionButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.multiJobsActions.closeJobsLabel",defaultMessage:"Close {jobsCount, plural, one {job} other {jobs}}",values:{jobsCount:this.props.jobs.length}})))}if(isStoppable(this.props.jobs)){items.push(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiContextMenuItem"],{key:"stop datafeed",icon:"stop",disabled:this.canStartStopDatafeed===false,onClick:()=>{stopDatafeeds(this.props.jobs,this.props.refreshJobs);this.closePopover()},"data-test-subj":"mlADJobListMultiSelectStopDatafeedActionButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.multiJobsActions.stopDatafeedsLabel",defaultMessage:"Stop {jobsCount, plural, one {datafeed} other {datafeeds}}",values:{jobsCount:this.props.jobs.length}})))}if(isStartable(this.props.jobs)){items.push(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiContextMenuItem"],{key:"start datafeed",icon:"play",disabled:this.canStartStopDatafeed===false,onClick:()=>{this.props.showStartDatafeedModal(this.props.jobs);this.closePopover()},"data-test-subj":"mlADJobListMultiSelectStartDatafeedActionButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.multiJobsActions.startDatafeedsLabel",defaultMessage:"Start {jobsCount, plural, one {datafeed} other {datafeeds}}",values:{jobsCount:this.props.jobs.length}})))}if(this.canCreateMlAlerts){items.push(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiContextMenuItem"],{key:"create alert",icon:"bell",disabled:false,onClick:()=>{this.props.showCreateAlertFlyout(this.props.jobs.map(({id:id})=>id));this.closePopover()},"data-test-subj":"mlADJobListMultiSelectCreateAlertActionButton"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.multiJobsActions.createAlertsLabel",defaultMessage:"Create alert"})))}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopover"],{button:button,isOpen:this.state.isOpen,closePopover:this.closePopover,panelPaddingSize:"none",anchorPosition:"downCenter"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiContextMenuPanel"],{items:items.reverse()}))}}const MultiJobActionsMenu=actions_menu_MultiJobActionsMenuUI;function group_list_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function Check({group:group,selectedGroups:selectedGroups}){if(selectedGroups[group.id]!==undefined){if(selectedGroups[group.id].partial){return external_kbnSharedDeps_React_default.a.createElement("div",{className:"check selected"},external_kbnSharedDeps_React_default.a.createElement("span",null,"—"))}else{return external_kbnSharedDeps_React_default.a.createElement("div",{className:"check selected"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:"check"}))}}else{return external_kbnSharedDeps_React_default.a.createElement("div",{className:"check"})}}class group_list_GroupList extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);group_list_defineProperty(this,"selectGroup",group=>{this.props.selectGroup(group)});group_list_defineProperty(this,"moveUp",(event,index)=>{event.preventDefault();if(index<0){return}else if(index>0){this.selectItems[index-1].focus()}});group_list_defineProperty(this,"moveDown",(event,index)=>{event.preventDefault();if(index<this.selectItems.length-1){this.selectItems[index+1].focus()}});group_list_defineProperty(this,"handleKeyDown",(event,group,index)=>{switch(event.key){case external_kbnSharedDeps_ElasticEui_["keys"].ENTER:this.selectGroup(group);break;case external_kbnSharedDeps_ElasticEui_["keys"].SPACE:this.selectGroup(group);break;case external_kbnSharedDeps_ElasticEui_["keys"].ARROW_DOWN:this.moveDown(event,index);break;case external_kbnSharedDeps_ElasticEui_["keys"].ARROW_UP:this.moveUp(event,index);break}});group_list_defineProperty(this,"setRef",(ref,index)=>{this.selectItems[index]=ref});this.state={groups:[]};this.selectItems=[]}render(){const{selectedGroups:selectedGroups,groups:groups}=this.props;return external_kbnSharedDeps_React_default.a.createElement("div",{className:"group-list"},groups.map((g,index)=>external_kbnSharedDeps_React_default.a.createElement("div",{tabIndex:"0",onKeyDown:event=>this.handleKeyDown(event,g,index),key:g.id,className:"group-item",onClick:()=>this.selectGroup(g),ref:ref=>this.setRef(ref,index)},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(JobGroup,{name:g.id})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(Check,{group:g,selectedGroups:selectedGroups}))))))}}function new_group_input_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class new_group_input_NewGroupInput extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);new_group_input_defineProperty(this,"changeTempNewGroup",e=>{const tempNewGroupName=e.target.value;let groupsValidationError="";if(tempNewGroupName===""){groupsValidationError=""}else if(this.props.allJobIds.includes(tempNewGroupName)){groupsValidationError=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.multiJobActions.groupSelector.groupsAndJobsCanNotUseSameIdErrorMessage",{defaultMessage:"A job with this ID already exists. Groups and jobs cannot use the same ID."})}else{groupsValidationError=validateGroupNames([tempNewGroupName]).message}this.setState({tempNewGroupName:tempNewGroupName,groupsValidationError:groupsValidationError})});new_group_input_defineProperty(this,"newGroupKeyPress",e=>{if(e.key===external_kbnSharedDeps_ElasticEui_["keys"].ENTER&&this.state.groupsValidationError===""&&this.state.tempNewGroupName!==""){this.addNewGroup()}});new_group_input_defineProperty(this,"addNewGroup",()=>{this.props.addNewGroup(this.state.tempNewGroupName);this.setState({tempNewGroupName:""})});this.state={tempNewGroupName:"",groupsValidationError:""}}render(){const{tempNewGroupName:tempNewGroupName,groupsValidationError:groupsValidationError}=this.state;return external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"s",alignItems:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{display:"rowCompressed",isInvalid:groupsValidationError!=="",error:groupsValidationError,className:"new-group-input"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldText"],{compressed:true,placeholder:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.multiJobActions.groupSelector.addNewGroupPlaceholder",{defaultMessage:"Add new group"}),value:tempNewGroupName,onChange:this.changeTempNewGroup,onKeyDown:this.newGroupKeyPress,isInvalid:groupsValidationError!=="",error:groupsValidationError}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{className:"new-group-input"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{onClick:this.addNewGroup,iconType:"plusInCircle","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.multiJobActions.groupSelector.addButtonAriaLabel",{defaultMessage:"Add"}),disabled:tempNewGroupName===""||groupsValidationError!==""})))))}}function group_selector_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function createSelectedGroups(jobs,groups){const jobIds=jobs.map(j=>j.id);const groupCounts={};jobs.forEach(j=>{j.groups.forEach(g=>{if(groupCounts[g]===undefined){groupCounts[g]=0}groupCounts[g]++})});const selectedGroups=groups.reduce((p,c)=>{if(c.jobIds.some(j=>jobIds.includes(j))){p[c.id]={partial:groupCounts[c.id]!==jobIds.length}}return p},{});return selectedGroups}class group_selector_GroupSelector extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);group_selector_defineProperty(this,"togglePopover",()=>{if(this.state.isPopoverOpen){this.closePopover()}else{ml_api_service["ml"].jobs.groups().then(groups=>{const selectedGroups=createSelectedGroups(this.props.jobs,groups);this.setState({isPopoverOpen:true,edited:false,selectedGroups:selectedGroups,groups:groups})}).catch(error=>{console.error(error)})}});group_selector_defineProperty(this,"closePopover",()=>{this.setState({edited:false,isPopoverOpen:false})});group_selector_defineProperty(this,"selectGroup",group=>{const newSelectedGroups=Object(external_kbnSharedDeps_Lodash_["cloneDeep"])(this.state.selectedGroups);if(newSelectedGroups[group.id]===undefined){newSelectedGroups[group.id]={partial:false}}else if(newSelectedGroups[group.id].partial===true){newSelectedGroups[group.id].partial=false}else{delete newSelectedGroups[group.id]}this.setState({selectedGroups:newSelectedGroups,edited:true})});group_selector_defineProperty(this,"applyChanges",()=>{const{selectedGroups:selectedGroups}=this.state;const{jobs:jobs}=this.props;const newJobs=jobs.map(j=>({id:j.id,oldGroups:j.groups,newGroups:[]}));for(const gId in selectedGroups){if(selectedGroups.hasOwnProperty(gId)){const group=selectedGroups[gId];newJobs.forEach(j=>{if(group.partial===false||group.partial===true&&j.oldGroups.includes(gId)){j.newGroups.push(gId)}})}}const tempJobs=newJobs.map(j=>({job_id:j.id,groups:j.newGroups}));ml_api_service["ml"].jobs.updateGroups(tempJobs).then(resp=>{let success=true;for(const jobId in resp){if(resp.hasOwnProperty(jobId)){if(resp[jobId].success===false){Object(toast_notification_service["a"])().displayErrorToast(resp[jobId].error);success=false}}}if(success){this.refreshJobs();this.closePopover()}else{console.error(resp)}}).catch(error=>{Object(toast_notification_service["a"])().displayErrorToast(error);console.error(error)})});group_selector_defineProperty(this,"addNewGroup",id=>{const newGroup={id:id,calendarIds:[],jobIds:[]};const groups=this.state.groups;if(groups.some(g=>g.id===newGroup.id)===false){groups.push(newGroup)}this.setState({groups:groups})});this.state={isPopoverOpen:false,groups:[],selectedGroups:{},edited:false};this.refreshJobs=this.props.refreshJobs;this.canUpdateJob=Object(check_capabilities["e"])("canUpdateJob")}static getDerivedStateFromProps(props,state){if(state.edited===false){const selectedGroups=createSelectedGroups(props.jobs,state.groups);return{selectedGroups:selectedGroups}}else{return{}}}render(){const{groups:groups,selectedGroups:selectedGroups,edited:edited}=this.state;const button=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{position:"bottom",content:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.multiJobActions.groupSelector.editJobGroupsButtonTooltip",defaultMessage:"Edit job groups"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{iconType:"indexEdit","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.multiJobActions.groupSelector.editJobGroupsButtonAriaLabel",{defaultMessage:"Edit job groups"}),onClick:()=>this.togglePopover(),disabled:this.canUpdateJob===false,"data-test-subj":"mlADJobListMultiSelectEditJobGroupsButton"}));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopover"],{id:"trapFocus",ownFocus:true,button:button,isOpen:this.state.isPopoverOpen,closePopover:()=>this.closePopover()},external_kbnSharedDeps_React_default.a.createElement("div",{className:"group-selector"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPopoverTitle"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.multiJobActions.groupSelector.applyGroupsToJobTitle",defaultMessage:"Apply groups to {jobsCount, plural, one {job} other {jobs}}",values:{jobsCount:this.props.jobs.length}})),external_kbnSharedDeps_React_default.a.createElement(group_list_GroupList,{groups:groups,selectedGroups:selectedGroups,selectGroup:this.selectGroup}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"xs"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(new_group_input_NewGroupInput,{addNewGroup:this.addNewGroup,allJobIds:this.props.allJobIds}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiHorizontalRule"],{margin:"m"}),external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{size:"s",onClick:this.applyChanges,isDisabled:edited===false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.multiJobActions.groupSelector.applyButtonLabel",defaultMessage:"Apply"})))))))}}class multi_job_actions_MultiJobActions extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);this.state={}}render(){const jobsSelected=this.props.selectedJobs.length>0;return external_kbnSharedDeps_React_default.a.createElement("div",{className:`multi-select-actions${jobsSelected?"":"-no-display"}`,"data-test-subj":`mlADJobListMultiSelectActionsArea ${jobsSelected?"active":"inactive"}`},jobsSelected&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"s",style:{display:"inline"}},external_kbnSharedDeps_React_default.a.createElement("h3",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.multiJobsActions.jobsSelectedLabel",defaultMessage:"{selectedJobsCount, plural, one {# job} other {# jobs}}   selected",values:{selectedJobsCount:this.props.selectedJobs.length}}))),external_kbnSharedDeps_React_default.a.createElement("div",{className:"actions-border-large"}),external_kbnSharedDeps_React_default.a.createElement(ResultLinks,{jobs:this.props.selectedJobs}),external_kbnSharedDeps_React_default.a.createElement(group_selector_GroupSelector,{jobs:this.props.selectedJobs,allJobIds:this.props.allJobIds,refreshJobs:this.props.refreshJobs}),external_kbnSharedDeps_React_default.a.createElement(MultiJobActionsMenu,{jobs:this.props.selectedJobs,showStartDatafeedModal:this.props.showStartDatafeedModal,showDeleteJobModal:this.props.showDeleteJobModal,refreshJobs:this.props.refreshJobs,showCreateAlertFlyout:this.props.showCreateAlertFlyout})))}}var use_create_url=__webpack_require__(87);function NewJobButton(){const buttonEnabled=Object(check_capabilities["e"])("canCreateJob")&&Object(check_ml_nodes["e"])();const newJob=Object(use_create_url["a"])(ml_url_generator["b"].ANOMALY_DETECTION_CREATE_JOB_SELECT_INDEX);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{"data-test-subj":"mlCreateNewJobButton",onClick:newJob,size:"s",disabled:buttonEnabled===false,fill:true,iconType:"plusInCircle"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.createNewJobButtonLabel",defaultMessage:"Create job"}))}var stats_bar=__webpack_require__(173);function createJobStats(jobsSummaryList){const jobStats={activeNodes:{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.statsBar.activeMLNodesLabel",{defaultMessage:"Active ML nodes"}),value:0,show:true},total:{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.statsBar.totalJobsLabel",{defaultMessage:"Total jobs"}),value:0,show:true},open:{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.statsBar.openJobsLabel",{defaultMessage:"Open jobs"}),value:0,show:true},closed:{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.statsBar.closedJobsLabel",{defaultMessage:"Closed jobs"}),value:0,show:true},failed:{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.statsBar.failedJobsLabel",{defaultMessage:"Failed jobs"}),value:0,show:false},activeDatafeeds:{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobsList.statsBar.activeDatafeedsLabel",{defaultMessage:"Active datafeeds"}),value:0,show:true}};if(jobsSummaryList===undefined){return jobStats}const mlNodes={};let failedJobs=0;jobsSummaryList.forEach(job=>{if(job.jobState===states["c"].OPENED){jobStats.open.value++}else if(job.jobState===states["c"].CLOSED){jobStats.closed.value++}else if(job.jobState===states["c"].FAILED){failedJobs++}if(job.hasDatafeed&&job.datafeedState===states["a"].STARTED){jobStats.activeDatafeeds.value++}if(job.nodeName!==undefined){mlNodes[job.nodeName]={}}});jobStats.total.value=jobsSummaryList.length;if(failedJobs){jobStats.failed.value=failedJobs;jobStats.failed.show=true}else{jobStats.failed.show=false}jobStats.activeNodes.value=Object.keys(mlNodes).length;return jobStats}const JobStatsBar=({jobsSummaryList:jobsSummaryList})=>{const jobStats=createJobStats(jobsSummaryList);return external_kbnSharedDeps_React_default.a.createElement(stats_bar["a"],{stats:jobStats,dataTestSub:"mlJobStatsBar"})};var node_available_warning=__webpack_require__(267);var jobs_awaiting_node_warning=__webpack_require__(153);var saved_objects_warning=__webpack_require__(268);var date_picker_wrapper=__webpack_require__(174);var upgrade=__webpack_require__(269);const RefreshJobsListButton=({onRefreshClick:onRefreshClick,isRefreshing:isRefreshing})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{"data-test-subj":`mlRefreshJobListButton${isRefreshing?" loading":" loaded"}`,onClick:onRefreshClick,isLoading:isRefreshing},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.refreshButtonLabel",defaultMessage:"Refresh"}));var ml_alerting_flyout=__webpack_require__(299);function jobs_list_view_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}let deletingJobsRefreshTimeout=null;class jobs_list_view_JobsListView extends external_kbnSharedDeps_React_["Component"]{constructor(props){super(props);jobs_list_view_defineProperty(this,"toggleRow",jobId=>{if(this.state.itemIdToExpandedRowMap[jobId]){const itemIdToExpandedRowMap={...this.state.itemIdToExpandedRowMap};delete itemIdToExpandedRowMap[jobId];this.setState({itemIdToExpandedRowMap:itemIdToExpandedRowMap})}else{let itemIdToExpandedRowMap={...this.state.itemIdToExpandedRowMap};if(this.state.fullJobsList[jobId]!==undefined){itemIdToExpandedRowMap[jobId]=external_kbnSharedDeps_React_default.a.createElement(job_details_JobDetails,{jobId:jobId,job:this.state.fullJobsList[jobId],addYourself:this.addUpdateFunction,removeYourself:this.removeUpdateFunction,showFullDetails:this.props.isManagementTable!==true,refreshJobList:this.onRefreshClick})}else{itemIdToExpandedRowMap[jobId]=external_kbnSharedDeps_React_default.a.createElement(job_details_JobDetails,{jobId:jobId,addYourself:this.addUpdateFunction,removeYourself:this.removeUpdateFunction,showFullDetails:this.props.isManagementTable!==true,refreshJobList:this.onRefreshClick})}this.setState({itemIdToExpandedRowMap:itemIdToExpandedRowMap},()=>{loadFullJob(jobId).then(job=>{const fullJobsList={...this.state.fullJobsList};fullJobsList[jobId]=job;this.setState({fullJobsList:fullJobsList},()=>{itemIdToExpandedRowMap={...this.state.itemIdToExpandedRowMap};if(itemIdToExpandedRowMap[jobId]!==undefined){itemIdToExpandedRowMap[jobId]=external_kbnSharedDeps_React_default.a.createElement(job_details_JobDetails,{jobId:jobId,job:job,addYourself:this.addUpdateFunction,removeYourself:this.removeUpdateFunction,showFullDetails:this.props.isManagementTable!==true,refreshJobList:this.onRefreshClick})}this.setState({itemIdToExpandedRowMap:itemIdToExpandedRowMap},()=>{this.updateFunctions[jobId](job)})})}).catch(error=>{console.error(error)})})}});jobs_list_view_defineProperty(this,"addUpdateFunction",(id,f)=>{this.updateFunctions[id]=f});jobs_list_view_defineProperty(this,"removeUpdateFunction",id=>{delete this.updateFunctions[id]});jobs_list_view_defineProperty(this,"setShowEditJobFlyoutFunction",func=>{this.showEditJobFlyout=func});jobs_list_view_defineProperty(this,"unsetShowEditJobFlyoutFunction",()=>{this.showEditJobFlyout=()=>{}});jobs_list_view_defineProperty(this,"setShowDeleteJobModalFunction",func=>{this.showDeleteJobModal=func});jobs_list_view_defineProperty(this,"unsetShowDeleteJobModalFunction",()=>{this.showDeleteJobModal=()=>{}});jobs_list_view_defineProperty(this,"setShowStartDatafeedModalFunction",func=>{this.showStartDatafeedModal=func});jobs_list_view_defineProperty(this,"unsetShowStartDatafeedModalFunction",()=>{this.showStartDatafeedModal=()=>{}});jobs_list_view_defineProperty(this,"setShowCreateAlertFlyoutFunction",func=>{this.showCreateAlertFlyout=func});jobs_list_view_defineProperty(this,"unsetShowCreateAlertFlyoutFunction",()=>{this.showCreateAlertFlyout=()=>{}});jobs_list_view_defineProperty(this,"getShowCreateAlertFlyoutFunction",()=>this.showCreateAlertFlyout);jobs_list_view_defineProperty(this,"selectJobChange",selectedJobs=>{this.setState({selectedJobs:selectedJobs})});jobs_list_view_defineProperty(this,"setFilters",query=>{const filterClauses=query&&query.ast&&query.ast.clauses||[];const filteredJobsSummaryList=filterJobs(this.state.jobsSummaryList,filterClauses);this.props.onJobsViewStateUpdate({queryText:query===null||query===void 0?void 0:query.text},this._isFiltersSet===false);this._isFiltersSet=true;this.setState({filteredJobsSummaryList:filteredJobsSummaryList,filterClauses:filterClauses},()=>{this.refreshSelectedJobs()})});jobs_list_view_defineProperty(this,"onRefreshClick",()=>{this.setState({isRefreshing:true});this.refreshJobSummaryList(true)});jobs_list_view_defineProperty(this,"isDoneRefreshing",()=>{this.setState({isRefreshing:false})});this.state={isRefreshing:false,loading:null,jobsSummaryList:[],filteredJobsSummaryList:[],fullJobsList:{},selectedJobs:[],itemIdToExpandedRowMap:{},filterClauses:[],deletingJobIds:[],jobsAwaitingNodeCount:0};this.updateFunctions={};this.showEditJobFlyout=()=>{};this.showDeleteJobModal=()=>{};this.showStartDatafeedModal=()=>{};this.showCreateAlertFlyout=()=>{};this._isMounted=false;this._isFiltersSet=false}componentDidMount(){this._isMounted=true;this.refreshJobSummaryList(true);if(this.props.isManagementTable!==true){this.openAutoStartDatafeedModal()}}componentDidUpdate(prevProps){if(prevProps.lastRefresh!==this.props.lastRefresh){this.refreshJobSummaryList()}}componentWillUnmount(){if(this.props.isManagementTable===undefined){deletingJobsRefreshTimeout=null}this._isMounted=false}openAutoStartDatafeedModal(){const job=checkForAutoStartDatafeed();if(job!==undefined){this.showStartDatafeedModal([job])}}refreshSelectedJobs(){const selectedJobsIds=this.state.selectedJobs.map(j=>j.id);const filteredJobIds=this.state.filteredJobsSummaryList.map(j=>j.id);const selectedJobs=this.state.jobsSummaryList.filter(j=>selectedJobsIds.find(id=>id===j.id)).filter(j=>filteredJobIds.find(id=>id===j.id));this.setState({selectedJobs:selectedJobs})}async refreshJobSummaryList(forceRefresh=false){if(this._isMounted&&(forceRefresh===true||this.props.blockRefresh!==true)){if(this.state.loading===null){this.setState({loading:true})}const expandedJobsIds=Object.keys(this.state.itemIdToExpandedRowMap);try{let jobsSpaces={};if(this.props.spacesApi&&this.props.isManagementTable){const allSpaces=await ml_api_service["ml"].savedObjects.jobsSpaces();jobsSpaces=allSpaces["anomaly-detector"]}let jobsAwaitingNodeCount=0;const jobs=await ml_api_service["ml"].jobs.jobsSummary(expandedJobsIds);const fullJobsList={};const jobsSummaryList=jobs.map(job=>{if(job.fullJob!==undefined){fullJobsList[job.id]=job.fullJob;delete job.fullJob}job.latestTimestampSortValue=job.latestTimestampMs||0;job.spaceIds=this.props.spacesApi&&this.props.isManagementTable&&jobsSpaces&&jobsSpaces[job.id]!==undefined?jobsSpaces[job.id]:[];if(job.awaitingNodeAssignment===true){jobsAwaitingNodeCount++}return job});const filteredJobsSummaryList=filterJobs(jobsSummaryList,this.state.filterClauses);this.setState({jobsSummaryList:jobsSummaryList,filteredJobsSummaryList:filteredJobsSummaryList,fullJobsList:fullJobsList,loading:false,jobsAwaitingNodeCount:jobsAwaitingNodeCount},()=>{this.refreshSelectedJobs()});Object.keys(this.updateFunctions).forEach(j=>{this.updateFunctions[j](fullJobsList[j])});jobs.forEach(job=>{if(job.deleting&&this.state.itemIdToExpandedRowMap[job.id]){this.toggleRow(job.id)}});this.isDoneRefreshing();if(jobsSummaryList.some(j=>j.deleting===true)){this.checkDeletingJobTasks(forceRefresh)}}catch(error){console.error(error);this.setState({loading:false})}}}async checkDeletingJobTasks(forceRefresh=false){if(this._isMounted===false){return}const{jobIds:taskJobIds}=await ml_api_service["ml"].jobs.deletingJobTasks();const taskListHasChanged=Object(external_kbnSharedDeps_Lodash_["isEqual"])(taskJobIds.sort(),this.state.deletingJobIds.sort())===false;this.setState({deletingJobIds:taskJobIds});if(taskListHasChanged||forceRefresh){this.refreshJobSummaryList()}if(taskJobIds.length>0&&deletingJobsRefreshTimeout===null){deletingJobsRefreshTimeout=setTimeout(()=>{deletingJobsRefreshTimeout=null;this.checkDeletingJobTasks()},jobs_list["b"])}}renderManagementJobsListComponents(){const{isRefreshing:isRefreshing,loading:loading,itemIdToExpandedRowMap:itemIdToExpandedRowMap,jobsSummaryList:jobsSummaryList,filteredJobsSummaryList:filteredJobsSummaryList,fullJobsList:fullJobsList,selectedJobs:selectedJobs}=this.state;return external_kbnSharedDeps_React_default.a.createElement("div",{className:"job-management","data-test-subj":"ml-jobs-list"},external_kbnSharedDeps_React_default.a.createElement(node_available_warning["a"],null),external_kbnSharedDeps_React_default.a.createElement(upgrade["a"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(JobStatsBar,{jobsSummaryList:jobsSummaryList})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center",gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(RefreshJobsListButton,{onRefreshClick:this.onRefreshClick,isRefreshing:isRefreshing}))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement("div",{className:"managementJobsList"},external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement(JobFilterBar,{setFilters:this.setFilters,queryText:this.props.jobsViewState.queryText})),external_kbnSharedDeps_React_default.a.createElement(jobs_list_JobsList,{jobsSummaryList:filteredJobsSummaryList,fullJobsList:fullJobsList,itemIdToExpandedRowMap:itemIdToExpandedRowMap,toggleRow:this.toggleRow,selectJobChange:this.selectJobChange,selectedJobsCount:selectedJobs.length,loading:loading,isManagementTable:true,isMlEnabledInSpace:this.props.isMlEnabledInSpace,spacesApi:this.props.spacesApi,jobsViewState:this.props.jobsViewState,onJobsViewStateUpdate:this.props.onJobsViewStateUpdate,refreshJobs:()=>this.refreshJobSummaryList(true)})))}renderJobsListComponents(){const{isRefreshing:isRefreshing,loading:loading,jobsSummaryList:jobsSummaryList,jobsAwaitingNodeCount:jobsAwaitingNodeCount}=this.state;const jobIds=jobsSummaryList.map(j=>j.id);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPage"],{"data-test-subj":"ml-jobs-list"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageBody"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageHeaderSection"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],null,external_kbnSharedDeps_React_default.a.createElement("h1",null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobsList.title",defaultMessage:"Anomaly detection jobs"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageHeaderSection"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center",gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(RefreshJobsListButton,{onRefreshClick:this.onRefreshClick,isRefreshing:isRefreshing})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(date_picker_wrapper["a"],null))))),external_kbnSharedDeps_React_default.a.createElement(node_available_warning["a"],null),external_kbnSharedDeps_React_default.a.createElement(jobs_awaiting_node_warning["a"],{jobCount:jobsAwaitingNodeCount}),external_kbnSharedDeps_React_default.a.createElement(saved_objects_warning["a"],{jobType:"anomaly-detector"}),external_kbnSharedDeps_React_default.a.createElement(upgrade["a"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiPageContent"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(JobStatsBar,{jobsSummaryList:jobsSummaryList})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(NewJobButton,null))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement("div",null,external_kbnSharedDeps_React_default.a.createElement("div",{className:"actions-bar"},external_kbnSharedDeps_React_default.a.createElement(multi_job_actions_MultiJobActions,{selectedJobs:this.state.selectedJobs,allJobIds:jobIds,showStartDatafeedModal:this.showStartDatafeedModal,showDeleteJobModal:this.showDeleteJobModal,showCreateAlertFlyout:this.showCreateAlertFlyout,refreshJobs:()=>this.refreshJobSummaryList(true)}),external_kbnSharedDeps_React_default.a.createElement(JobFilterBar,{setFilters:this.setFilters,queryText:this.props.jobsViewState.queryText})),external_kbnSharedDeps_React_default.a.createElement(jobs_list_JobsList,{jobsSummaryList:this.state.filteredJobsSummaryList,fullJobsList:this.state.fullJobsList,itemIdToExpandedRowMap:this.state.itemIdToExpandedRowMap,toggleRow:this.toggleRow,selectJobChange:this.selectJobChange,showEditJobFlyout:this.showEditJobFlyout,showDeleteJobModal:this.showDeleteJobModal,showStartDatafeedModal:this.showStartDatafeedModal,refreshJobs:()=>this.refreshJobSummaryList(true),jobsViewState:this.props.jobsViewState,onJobsViewStateUpdate:this.props.onJobsViewStateUpdate,selectedJobsCount:this.state.selectedJobs.length,showCreateAlertFlyout:this.showCreateAlertFlyout,loading:loading}),external_kbnSharedDeps_React_default.a.createElement(EditJobFlyout,{setShowFunction:this.setShowEditJobFlyoutFunction,unsetShowFunction:this.unsetShowEditJobFlyoutFunction,refreshJobs:()=>this.refreshJobSummaryList(true),allJobIds:jobIds}),external_kbnSharedDeps_React_default.a.createElement(DeleteJobModal,{setShowFunction:this.setShowDeleteJobModalFunction,unsetShowFunction:this.unsetShowDeleteJobModalFunction,refreshJobs:()=>this.refreshJobSummaryList(true)}),external_kbnSharedDeps_React_default.a.createElement(start_datafeed_modal_StartDatafeedModal,{setShowFunction:this.setShowStartDatafeedModalFunction,unsetShowFunction:this.unsetShowDeleteJobModalFunction,getShowCreateAlertFlyoutFunction:this.getShowCreateAlertFlyoutFunction,refreshJobs:()=>this.refreshJobSummaryList(true)}),external_kbnSharedDeps_React_default.a.createElement(ml_alerting_flyout["a"],{setShowFunction:this.setShowCreateAlertFlyoutFunction,unsetShowFunction:this.unsetShowCreateAlertFlyoutFunction})))))}render(){const{isManagementTable:isManagementTable}=this.props;return external_kbnSharedDeps_React_default.a.createElement("div",null,!isManagementTable?this.renderJobsListComponents():this.renderManagementJobsListComponents())}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return DataFrameAnalyticsList}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(33);var data_frame_analytics=__webpack_require__(74);var common=__webpack_require__(66);var check_capabilities=__webpack_require__(63);var analytics_list_common=__webpack_require__(88);var analytics_service=__webpack_require__(172);var use_columns=__webpack_require__(260);var expanded_row=__webpack_require__(384);var stats_bar=__webpack_require__(173);const CreateAnalyticsButton=({isDisabled:isDisabled,setIsSourceIndexModalVisible:setIsSourceIndexModalVisible})=>{const handleClick=()=>{setIsSourceIndexModalVisible(true)};const button=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{disabled:isDisabled,fill:true,onClick:handleClick,iconType:"plusInCircle",size:"s","data-test-subj":"mlAnalyticsButtonCreate"},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.createDataFrameAnalyticsButton",{defaultMessage:"Create job"}));if(isDisabled){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{position:"top",content:Object(check_capabilities["f"])("canCreateDataFrameAnalytics")},button)}return button};var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(34);var public_=__webpack_require__(52);var kibana=__webpack_require__(58);var object_utils=__webpack_require__(219);var index_utils=__webpack_require__(78);const fixedPageSize=8;const SourceSelection=({onClose:onClose})=>{const{services:{savedObjects:savedObjects,uiSettings:uiSettings}}=Object(kibana["b"])();const navigateToPath=Object(kibana["e"])();const[isCcsCallOut,setIsCcsCallOut]=Object(external_kbnSharedDeps_React_["useState"])(false);const[ccsCallOutBodyText,setCcsCallOutBodyText]=Object(external_kbnSharedDeps_React_["useState"])();const onSearchSelected=async(id,type,fullName,savedObject)=>{let indexPatternTitle="";if(type==="index-pattern"){indexPatternTitle=Object(object_utils["a"])(savedObject,"attributes.title")}else if(type==="search"){var _indexPatternAndSaved,_indexPatternAndSaved2;const indexPatternAndSavedSearch=await Object(index_utils["a"])(id);indexPatternTitle=(_indexPatternAndSaved=(_indexPatternAndSaved2=indexPatternAndSavedSearch.indexPattern)===null||_indexPatternAndSaved2===void 0?void 0:_indexPatternAndSaved2.title)!==null&&_indexPatternAndSaved!==void 0?_indexPatternAndSaved:""}if(indexPatternTitle.includes(":")){setIsCcsCallOut(true);if(type==="search"){setCcsCallOutBodyText(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataFrame.analytics.create.searchSelection.CcsErrorCallOutBody",{defaultMessage:`The saved search '{savedSearchTitle}' uses the index pattern '{indexPatternTitle}'.`,values:{savedSearchTitle:Object(object_utils["a"])(savedObject,"attributes.title"),indexPatternTitle:indexPatternTitle}}))}else{setCcsCallOutBodyText(undefined)}return}await navigateToPath(`/data_frame_analytics/new_job?${type==="index-pattern"?"index":"savedSearchId"}=${encodeURIComponent(id)}`)};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModal"],{className:"dataFrameAnalyticsCreateSearchDialog",onClose:onClose,"data-test-subj":"analyticsCreateSourceIndexModal"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalHeader"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalHeaderTitle"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.create.newAnalyticsTitle",defaultMessage:"New analytics job"})," ","/"," ",external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analytics.create.chooseSourceTitle",defaultMessage:"Choose a source index pattern"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiModalBody"],null,isCcsCallOut&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{"data-test-subj":"analyticsCreateSourceIndexModalCcsErrorCallOut",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataFrame.analytics.create.searchSelection.CcsErrorCallOutTitle",{defaultMessage:"Index patterns using cross-cluster search are not supported."}),color:"danger"},typeof ccsCallOutBodyText==="string"&&external_kbnSharedDeps_React_default.a.createElement("p",null,ccsCallOutBodyText)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"})),external_kbnSharedDeps_React_default.a.createElement(public_["SavedObjectFinderUi"],{key:"searchSavedObjectFinder",onChoose:onSearchSelected,showFilter:true,noItemsMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataFrame.analytics.create.searchSelection.notFoundLabel",{defaultMessage:"No matching indices or saved searches found."}),savedObjectMetaData:[{type:"search",getIconForSavedObject:()=>"search",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataFrame.analytics.create.searchSelection.savedObjectType.search",{defaultMessage:"Saved search"})},{type:"index-pattern",getIconForSavedObject:()=>"indexPatternApp",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataFrame.analytics.create.searchSelection.savedObjectType.indexPattern",{defaultMessage:"Index pattern"})}],fixedPageSize:fixedPageSize,uiSettings:uiSettings,savedObjects:savedObjects})))};var string_utils=__webpack_require__(84);function filterAnalytics(items,clauses){if(clauses.length===0){return items}const matches=items.reduce((p,c)=>{p[c.id]={job:c,count:0};return p},{});clauses.forEach(c=>{const bool=c.match==="must";let js=[];if(c.type==="term"){if(bool===true){js=items.filter(item=>{var _item$stats,_item$stats$memory_us;return Object(string_utils["f"])(item.id,c.value)===bool||Object(string_utils["f"])(item.config.description,c.value)===bool||Object(string_utils["f"])((_item$stats=item.stats)===null||_item$stats===void 0?void 0:(_item$stats$memory_us=_item$stats.memory_usage)===null||_item$stats$memory_us===void 0?void 0:_item$stats$memory_us.status,c.value)===bool})}else{js=items.filter(item=>{var _item$stats2,_item$stats2$memory_u;return Object(string_utils["f"])(item.id,c.value)===bool&&Object(string_utils["f"])(item.config.description,c.value)===bool&&Object(string_utils["f"])((_item$stats2=item.stats)===null||_item$stats2===void 0?void 0:(_item$stats2$memory_u=_item$stats2.memory_usage)===null||_item$stats2$memory_u===void 0?void 0:_item$stats2$memory_u.status,c.value)===bool})}}else{if(Array.isArray(c.value)){js=items.filter(item=>c.value.includes(item[c.field]))}else{js=items.filter(item=>item[c.field]===c.value)}}js.forEach(j=>matches[j.id].count++)});const filtered=Object.values(matches).filter(m=>(m&&m.count)>=clauses.length).map(m=>m.job);return filtered}const AnalyticsEmptyPrompt=({disabled:disabled,isManagementTable:isManagementTable,onCreateFirstJobClick:onCreateFirstJobClick})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiEmptyPrompt"],{iconType:"createAdvancedJob",title:external_kbnSharedDeps_React_default.a.createElement("h2",null,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataFrame.analyticsList.emptyPromptTitle",{defaultMessage:"Create your first data frame analytics job"})),actions:!isManagementTable?[external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:onCreateFirstJobClick,isDisabled:disabled,color:"primary",iconType:"plusInCircle",fill:true,"data-test-subj":"mlAnalyticsCreateFirstButton"},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataFrame.analyticsList.emptyPromptButtonText",{defaultMessage:"Create job"}))]:[],"data-test-subj":"mlNoDataFrameAnalyticsFound"});var use_table_settings=__webpack_require__(300);var refresh_analytics_list_button=__webpack_require__(387);var jobs_awaiting_node_warning=__webpack_require__(153);const filters=[{type:"field_value_selection",field:"job_type",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.typeFilter",{defaultMessage:"Type"}),multiSelect:"or",options:Object.values(data_frame_analytics["a"]).map(val=>({value:val,name:val,view:Object(use_columns["a"])(val)}))},{type:"field_value_selection",field:"state",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.statusFilter",{defaultMessage:"Status"}),multiSelect:"or",options:Object.values(analytics_list_common["b"]).map(val=>({value:val,name:val,view:Object(use_columns["b"])(val)}))}];function getItemIdToExpandedRowMap(itemIds,dataFrameAnalytics){return itemIds.reduce((m,analyticsId)=>{const item=dataFrameAnalytics.find(analytics=>analytics.config.id===analyticsId);if(item!==undefined){m[analyticsId]=external_kbnSharedDeps_React_default.a.createElement(expanded_row["a"],{item:item})}return m},{})}const DataFrameAnalyticsList=({isManagementTable:isManagementTable=false,isMlEnabledInSpace:isMlEnabledInSpace=true,spacesApi:spacesApi,blockRefresh:blockRefresh=false,pageState:pageState,updatePageState:updatePageState})=>{var _pageState$queryText;const searchQueryText=(_pageState$queryText=pageState.queryText)!==null&&_pageState$queryText!==void 0?_pageState$queryText:"";const setSearchQueryText=Object(external_kbnSharedDeps_React_["useCallback"])(value=>{updatePageState({queryText:value})},[updatePageState]);const[isInitialized,setIsInitialized]=Object(external_kbnSharedDeps_React_["useState"])(false);const[isSourceIndexModalVisible,setIsSourceIndexModalVisible]=Object(external_kbnSharedDeps_React_["useState"])(false);const[isLoading,setIsLoading]=Object(external_kbnSharedDeps_React_["useState"])(false);const[filteredAnalytics,setFilteredAnalytics]=Object(external_kbnSharedDeps_React_["useState"])([]);const[searchError,setSearchError]=Object(external_kbnSharedDeps_React_["useState"])();const[analytics,setAnalytics]=Object(external_kbnSharedDeps_React_["useState"])([]);const[analyticsStats,setAnalyticsStats]=Object(external_kbnSharedDeps_React_["useState"])(undefined);const[expandedRowItemIds,setExpandedRowItemIds]=Object(external_kbnSharedDeps_React_["useState"])([]);const[errorMessage,setErrorMessage]=Object(external_kbnSharedDeps_React_["useState"])(undefined);const[jobsAwaitingNodeCount,setJobsAwaitingNodeCount]=Object(external_kbnSharedDeps_React_["useState"])(0);const disabled=!Object(check_capabilities["e"])("canCreateDataFrameAnalytics")||!Object(check_capabilities["e"])("canStartStopDataFrameAnalytics");const getAnalytics=Object(analytics_service["d"])(setAnalytics,setAnalyticsStats,setErrorMessage,setIsInitialized,setJobsAwaitingNodeCount,blockRefresh,isManagementTable);const updateFilteredItems=Object(external_kbnSharedDeps_React_["useCallback"])(queryClauses=>{if(queryClauses.length){const filtered=filterAnalytics(analytics,queryClauses);setFilteredAnalytics(filtered)}else{setFilteredAnalytics(analytics)}},[analytics]);const filterList=()=>{if(searchQueryText!==""){const query=external_kbnSharedDeps_ElasticEui_["EuiSearchBar"].Query.parse(searchQueryText);let clauses=[];if(query&&query.ast!==undefined&&query.ast.clauses!==undefined){clauses=query.ast.clauses}updateFilteredItems(clauses)}else{updateFilteredItems([])}};Object(external_kbnSharedDeps_React_["useEffect"])(()=>{filterList()},[searchQueryText]);const getAnalyticsCallback=Object(external_kbnSharedDeps_React_["useCallback"])(()=>getAnalytics(true),[]);const{refresh:refresh}=Object(common["I"])({isLoading:setIsLoading,onRefresh:getAnalyticsCallback},isManagementTable);const{columns:columns,modals:modals}=Object(use_columns["d"])(expandedRowItemIds,setExpandedRowItemIds,isManagementTable,isMlEnabledInSpace,spacesApi,refresh);const{onTableChange:onTableChange,pagination:pagination,sorting:sorting}=Object(use_table_settings["a"])(filteredAnalytics,pageState,updatePageState);const handleSearchOnChange=search=>{if(search.error!==null){setSearchError(search.error.message);return}setSearchError(undefined);setSearchQueryText(search.queryText)};if(!isInitialized){return null}if(typeof errorMessage!=="undefined"){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataFrame.analyticsList.errorPromptTitle",{defaultMessage:"An error occurred getting the data frame analytics list."}),color:"danger",iconType:"alert"},external_kbnSharedDeps_React_default.a.createElement("pre",null,JSON.stringify(errorMessage)))}if(analytics.length===0){return external_kbnSharedDeps_React_default.a.createElement("div",{"data-test-subj":"mlAnalyticsJobList"},external_kbnSharedDeps_React_default.a.createElement(AnalyticsEmptyPrompt,{isManagementTable:isManagementTable,disabled:disabled,onCreateFirstJobClick:()=>setIsSourceIndexModalVisible(true)}),isSourceIndexModalVisible===true&&external_kbnSharedDeps_React_default.a.createElement(SourceSelection,{onClose:()=>setIsSourceIndexModalVisible(false)}))}const itemIdToExpandedRowMap=getItemIdToExpandedRowMap(expandedRowItemIds,analytics);const stats=analyticsStats&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(stats_bar["a"],{stats:analyticsStats,dataTestSub:"mlAnalyticsStatsBar"}));const managementStats=external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween"},stats,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(refresh_analytics_list_button["a"],null))));const search={query:searchQueryText,onChange:handleSearchOnChange,box:{incremental:true},filters:filters};return external_kbnSharedDeps_React_default.a.createElement("div",{"data-test-subj":"mlAnalyticsJobList"},modals,!isManagementTable&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(jobs_awaiting_node_warning["a"],{jobCount:jobsAwaitingNodeCount}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{justifyContent:"spaceBetween"},!isManagementTable&&stats,isManagementTable&&managementStats,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center",gutterSize:"s"},!isManagementTable&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(CreateAnalyticsButton,{isDisabled:disabled,setIsSourceIndexModalVisible:setIsSourceIndexModalVisible}))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement("div",{"data-test-subj":"mlAnalyticsTableContainer"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiInMemoryTable"],{allowNeutralSort:false,columns:columns,hasActions:false,isExpandable:true,itemIdToExpandedRowMap:itemIdToExpandedRowMap,isSelectable:false,items:analytics,itemId:analytics_list_common["c"].id,loading:isLoading,onTableChange:onTableChange,pagination:pagination,sorting:sorting,search:search,"data-test-subj":isLoading?"mlAnalyticsTable loading":"mlAnalyticsTable loaded",rowProps:item=>({"data-test-subj":`mlAnalyticsTableRow row-${item.id}`}),error:searchError})),isSourceIndexModalVisible===true&&external_kbnSharedDeps_React_default.a.createElement(SourceSelection,{onClose:()=>setIsSourceIndexModalVisible(false)}))}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return BADGE_LIMIT}));__webpack_require__.d(__webpack_exports__,"b",(function(){return JobSelectorFlyoutContent}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(33);var job_selector_badge=__webpack_require__(214);const NewSelectionIdBadges=({limit:limit,maps:maps,newSelection:newSelection,onDeleteClick:onDeleteClick,onLinkClick:onLinkClick,showAllBadges:showAllBadges})=>{const badges=[];for(let i=0;i<newSelection.length;i++){if(i>=limit&&showAllBadges===false){break}badges.push(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,key:newSelection[i]},external_kbnSharedDeps_React_default.a.createElement(job_selector_badge["a"],{id:newSelection[i],icon:true,isGroup:maps.groupsMap[newSelection[i]]!==undefined,removeId:onDeleteClick})))}if(showAllBadges===false&&newSelection.length>limit){badges.push(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{key:"more-badges-link",onClick:onLinkClick},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{grow:false,size:"xs"},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobSelector.showFlyoutBadges",{defaultMessage:`And {overFlow} more`,values:{overFlow:newSelection.length-limit}}))))}else if(showAllBadges===true&&newSelection.length>limit){badges.push(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLink"],{key:"hide-badges-link",onClick:onLinkClick},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{grow:false,size:"xs"},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobSelector.hideFlyoutBadges",{defaultMessage:"Hide"}))))}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,badges)};var custom_selection_table=__webpack_require__(388);function TimeRangeBar({isRunning:isRunning,timerange:timerange,ganttBarWidth:ganttBarWidth}){const style={width:timerange.widthPx,marginLeft:timerange.fromPx};const className=`mlJobSelector__ganttBar${isRunning?" mlJobSelector__ganttBarRunning":""}`;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{position:"top",content:timerange.label},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement("div",{className:"mlJobSelector__ganttBarBackEdge"},external_kbnSharedDeps_React_default.a.createElement("div",{className:"mlJobSelector__ganttBarDashed",style:{width:`${ganttBarWidth}px`}})),external_kbnSharedDeps_React_default.a.createElement("div",{style:style,className:className})))}var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(34);var external_kbnSharedDeps_ElasticEuiLibServices_=__webpack_require__(47);var kibana=__webpack_require__(58);var ml_url_generator=__webpack_require__(0);var app=__webpack_require__(4);const JOB_FILTER_FIELDS=["job_id","groups"];const GROUP_FILTER_FIELDS=["id"];function JobSelectorTable({ganttBarWidth:ganttBarWidth,groupsList:groupsList,jobs:jobs,onSelection:onSelection,selectedIds:selectedIds,singleSelection:singleSelection,timeseriesOnly:timeseriesOnly,withTimeRangeSelector:withTimeRangeSelector}){const[sortableProperties,setSortableProperties]=Object(external_kbnSharedDeps_React_["useState"])();const[currentTab,setCurrentTab]=Object(external_kbnSharedDeps_React_["useState"])("Jobs");const{services:{application:{navigateToApp:navigateToApp}}}=Object(kibana["b"])();Object(external_kbnSharedDeps_React_["useEffect"])(()=>{let sortablePropertyItems=[];let defaultSortProperty="job_id";if(currentTab==="Jobs"||singleSelection){sortablePropertyItems=[{name:"job_id",getValue:item=>item.job_id.toLowerCase(),isAscending:true},{name:"groups",getValue:item=>item.groups&&item.groups[0]?item.groups[0].toLowerCase():"",isAscending:true}]}else if(currentTab==="Groups"){defaultSortProperty="id";sortablePropertyItems=[{name:"id",getValue:item=>item.id.toLowerCase(),isAscending:true}]}const sortableProps=new external_kbnSharedDeps_ElasticEuiLibServices_["SortableProperties"](sortablePropertyItems,defaultSortProperty);setSortableProperties(sortableProps)},[jobs,currentTab]);const tabs=[{id:"Jobs",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobSelector.jobsTab",{defaultMessage:"Jobs"}),content:renderJobsTable()},{id:"Groups",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobSelector.groupsTab",{defaultMessage:"Groups"}),content:renderGroupsTable()}];function getGroupOptions(){return groupsList.map(g=>({value:g.id,view:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{gutterSize:"s"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{key:g.id,grow:false},external_kbnSharedDeps_React_default.a.createElement(job_selector_badge["a"],{id:g.id,isGroup:true})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobSelector.filterBar.jobGroupTitle",{defaultMessage:`({jobsCount, plural, one {# job} other {# jobs}})`,values:{jobsCount:g.jobIds.length}}))))}))}function renderJobsTable(){const columns=[{id:"checkbox",isCheckbox:true,textOnly:false,width:"32px"},{label:"job ID",id:"job_id",isSortable:true,alignment:external_kbnSharedDeps_ElasticEuiLibServices_["LEFT_ALIGNMENT"]},{id:"groups",label:"groups",isSortable:true,alignment:external_kbnSharedDeps_ElasticEuiLibServices_["LEFT_ALIGNMENT"],render:({groups:groups=[]})=>groups.map(group=>external_kbnSharedDeps_React_default.a.createElement(job_selector_badge["a"],{key:`${group}-key`,id:group,isGroup:true}))}];if(withTimeRangeSelector){columns.push({label:"time range",id:"timerange",alignment:external_kbnSharedDeps_ElasticEuiLibServices_["LEFT_ALIGNMENT"],render:({timeRange:timeRange={},isRunning:isRunning})=>external_kbnSharedDeps_React_default.a.createElement(TimeRangeBar,{timerange:timeRange,isRunning:isRunning,ganttBarWidth:ganttBarWidth})})}const filters=[{type:"field_value_selection",field:"groups",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobSelector.filterBar.groupLabel",{defaultMessage:"Group"}),loadingMessage:"Loading...",noOptionsMessage:"No groups found.",multiSelect:"or",cache:1e4,options:getGroupOptions()}];return external_kbnSharedDeps_React_default.a.createElement(custom_selection_table["a"],{columns:columns,filters:filters,filterDefaultFields:!singleSelection?JOB_FILTER_FIELDS:undefined,items:jobs,onTableChange:selectionFromTable=>onSelection({selectionFromTable:selectionFromTable}),radioDisabledCheck:item=>timeseriesOnly&&item.isSingleMetricViewerJob===false,selectedIds:selectedIds,singleSelection:singleSelection,sortableProperties:sortableProperties,timeseriesOnly:timeseriesOnly})}function renderGroupsTable(){const groupColumns=[{id:"checkbox",isCheckbox:true,textOnly:false,width:"32px"},{label:"group ID",id:"id",isSortable:true,alignment:external_kbnSharedDeps_ElasticEuiLibServices_["LEFT_ALIGNMENT"],render:({id:id})=>external_kbnSharedDeps_React_default.a.createElement(job_selector_badge["a"],{id:id,isGroup:true})},{id:"jobs in group",label:"jobs in group",isSortable:false,alignment:external_kbnSharedDeps_ElasticEuiLibServices_["CENTER_ALIGNMENT"],render:({jobIds:jobIds=[]})=>jobIds.length}];if(withTimeRangeSelector){groupColumns.push({label:"time range",id:"timerange",alignment:external_kbnSharedDeps_ElasticEuiLibServices_["LEFT_ALIGNMENT"],render:({timeRange:timeRange={}})=>external_kbnSharedDeps_React_default.a.createElement(TimeRangeBar,{timerange:timeRange,ganttBarWidth:ganttBarWidth})})}return external_kbnSharedDeps_React_default.a.createElement(custom_selection_table["a"],{columns:groupColumns,filterDefaultFields:!singleSelection?GROUP_FILTER_FIELDS:undefined,items:groupsList,onTableChange:selectionFromTable=>onSelection({selectionFromTable:selectionFromTable}),selectedIds:selectedIds,sortableProperties:sortableProperties})}function renderTabs(){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTabbedContent"],{size:"s",tabs:tabs,initialSelectedTab:tabs[0],onTabClick:tab=>{setCurrentTab(tab.id)}})}const navigateToWizard=async()=>{await navigateToApp(app["d"],{path:ml_url_generator["b"].ANOMALY_DETECTION_CREATE_JOB})};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,jobs.length===0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCallOut"],{title:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobSelector.noJobsFoundTitle",defaultMessage:"No anomaly detection jobs found"}),iconType:"iInCircle"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{textAlign:"center"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{color:"primary",onClick:navigateToWizard},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.jobSelector.createJobButtonLabel",defaultMessage:"Create job"})))),jobs.length!==0&&singleSelection===true&&renderJobsTable(),jobs.length!==0&&!singleSelection&&renderTabs())}var job_select_service_utils=__webpack_require__(250);const BADGE_LIMIT=10;const DEFAULT_GANTT_BAR_WIDTH=299;const JobSelectorFlyoutContent=({dateFormatTz:dateFormatTz,selectedIds:selectedIds=[],singleSelection:singleSelection,timeseriesOnly:timeseriesOnly,onJobsFetched:onJobsFetched,onSelectionConfirmed:onSelectionConfirmed,onFlyoutClose:onFlyoutClose,maps:maps,withTimeRangeSelector:withTimeRangeSelector=true})=>{const{services:{notifications:notifications,mlServices:{mlApiServices:mlApiServices}}}=Object(kibana["b"])();const[newSelection,setNewSelection]=Object(external_kbnSharedDeps_React_["useState"])(selectedIds);const[isLoading,setIsLoading]=Object(external_kbnSharedDeps_React_["useState"])(true);const[showAllBadges,setShowAllBadges]=Object(external_kbnSharedDeps_React_["useState"])(false);const[applyTimeRange,setApplyTimeRange]=Object(external_kbnSharedDeps_React_["useState"])(true);const[jobs,setJobs]=Object(external_kbnSharedDeps_React_["useState"])([]);const[groups,setGroups]=Object(external_kbnSharedDeps_React_["useState"])([]);const[ganttBarWidth,setGanttBarWidth]=Object(external_kbnSharedDeps_React_["useState"])(DEFAULT_GANTT_BAR_WIDTH);const[jobGroupsMaps,setJobGroupsMaps]=Object(external_kbnSharedDeps_React_["useState"])(maps);const flyoutEl=Object(external_kbnSharedDeps_React_["useRef"])(null);const applySelection=Object(external_kbnSharedDeps_React_["useCallback"])(()=>{const allNewSelection=[];const groupSelection=[];newSelection.forEach(id=>{if(jobGroupsMaps.groupsMap[id]!==undefined){allNewSelection.push(...jobGroupsMaps.groupsMap[id]);groupSelection.push({groupId:id,jobIds:jobGroupsMaps.groupsMap[id]})}else{allNewSelection.push(id)}});const allNewSelectionUnique=Array.from(new Set(allNewSelection));const time=applyTimeRange?Object(job_select_service_utils["b"])(jobs,allNewSelectionUnique):undefined;onSelectionConfirmed({newSelection:allNewSelectionUnique,jobIds:allNewSelectionUnique,groups:groupSelection,time:time})},[onSelectionConfirmed,newSelection,jobGroupsMaps,applyTimeRange]);function removeId(id){setNewSelection(newSelection.filter(item=>item!==id))}function toggleTimerangeSwitch(){setApplyTimeRange(!applyTimeRange)}function clearSelection(){setNewSelection([])}function handleNewSelection({selectionFromTable:selectionFromTable}){setNewSelection(selectionFromTable)}const handleResize=Object(external_kbnSharedDeps_React_["useCallback"])(()=>{if(jobs.length===0||!flyoutEl.current)return;const tableHeaderCols=flyoutEl.current.querySelectorAll("table thead th");const derivedWidth=tableHeaderCols[tableHeaderCols.length-1].offsetWidth-16;const normalizedJobs=Object(job_select_service_utils["c"])(jobs,dateFormatTz,derivedWidth);setJobs(normalizedJobs);const{groups:updatedGroups}=Object(job_select_service_utils["a"])(normalizedJobs);setGroups(updatedGroups);setGanttBarWidth(derivedWidth)},[dateFormatTz,jobs]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{fetchJobs()},[]);async function fetchJobs(){try{const resp=await mlApiServices.jobs.jobsWithTimerange(dateFormatTz);const normalizedJobs=Object(job_select_service_utils["c"])(resp.jobs,dateFormatTz,DEFAULT_GANTT_BAR_WIDTH);const{groups:groupsWithTimerange,groupsMap:groupsMap}=Object(job_select_service_utils["a"])(normalizedJobs);setJobs(normalizedJobs);setGroups(groupsWithTimerange);setJobGroupsMaps({groupsMap:groupsMap,jobsMap:resp.jobsMap});if(onJobsFetched){onJobsFetched({groupsMap:groupsMap,jobsMap:resp.jobsMap})}}catch(e){console.error("Error fetching jobs with time range",e);const{toasts:toasts}=notifications;toasts.addDanger({title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobSelector.jobFetchErrorMessage",{defaultMessage:"An error occurred fetching jobs. Refresh and try again."})})}setIsLoading(false)}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutHeader"],{hasBorder:true},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"m"},external_kbnSharedDeps_React_default.a.createElement("h2",{id:"flyoutTitle"},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobSelector.flyoutTitle",{defaultMessage:"Job selection"})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutBody"],{className:"mlJobSelectorFlyoutBody"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiResizeObserver"],{onResize:handleResize},resizeRef=>external_kbnSharedDeps_React_default.a.createElement("div",{ref:e=>{flyoutEl.current=e;resizeRef(e)}},isLoading?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiProgress"],{size:"xs",color:"accent"}):external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"column",responsive:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{wrap:true,responsive:false,gutterSize:"xs",alignItems:"center"},external_kbnSharedDeps_React_default.a.createElement(NewSelectionIdBadges,{limit:BADGE_LIMIT,maps:jobGroupsMaps,newSelection:newSelection,onDeleteClick:removeId,onLinkClick:()=>setShowAllBadges(!showAllBadges),showAllBadges:showAllBadges}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"row",justifyContent:"spaceBetween",responsive:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},!singleSelection&&newSelection.length>0&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:clearSelection,size:"xs","data-test-subj":"mlFlyoutJobSelectorButtonClearSelection"},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobSelector.clearAllFlyoutButton",{defaultMessage:"Clear all"}))),withTimeRangeSelector&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobSelector.applyTimerangeSwitchLabel",{defaultMessage:"Apply time range"}),checked:applyTimeRange,onChange:toggleTimerangeSwitch,"data-test-subj":"mlFlyoutJobSelectorSwitchApplyTimeRange"}))))),external_kbnSharedDeps_React_default.a.createElement(JobSelectorTable,{jobs:jobs,ganttBarWidth:ganttBarWidth,groupsList:groups,onSelection:handleNewSelection,selectedIds:newSelection,singleSelection:singleSelection,timeseriesOnly:timeseriesOnly,withTimeRangeSelector:withTimeRangeSelector}))))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlyoutFooter"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButton"],{onClick:applySelection,fill:true,isDisabled:newSelection.length===0,"data-test-subj":"mlFlyoutJobSelectorButtonApply"},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobSelector.applyFlyoutButton",{defaultMessage:"Apply"}))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{iconType:"cross",onClick:onFlyoutClose,"data-test-subj":"mlFlyoutJobSelectorButtonClose"},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobSelector.closeFlyoutButton",{defaultMessage:"Close"}))))))}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return ExpandedRow}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_MomentTimezone_=__webpack_require__(43);var external_kbnSharedDeps_MomentTimezone_default=__webpack_require__.n(external_kbnSharedDeps_MomentTimezone_);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(33);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);var date_utils=__webpack_require__(67);var expanded_row_details_pane=__webpack_require__(467);const Section=({section:section})=>{if(section.items.length===0){return null}const columns=[{field:"title",name:"",render:v=>external_kbnSharedDeps_React_default.a.createElement("strong",null,v)},{field:"description",name:"",render:v=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,v)}];return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTitle"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("span",null,section.title)),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiBasicTable"],{compressed:true,items:section.items,columns:columns,tableCaption:section.title,tableLayout:"auto",className:"mlExpandedRowDetailsSection"}))};const ExpandedRowDetailsPane=({sections:sections})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{className:"mlExpandedRowDetails"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{style:{width:"50%"}},sections.filter(s=>s.position==="left").map(s=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],{key:s.title},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(Section,{section:s})))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{style:{width:"50%"}},sections.filter(s=>s.position==="right").map(s=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],{key:s.title},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(Section,{section:s})))));const ExpandedRowJsonPane=({json:json})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCodeEditor"],{value:JSON.stringify(json,null,2),readOnly:true,mode:"json",style:{width:"100%"},theme:"textmate"})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false}," "));const ProgressBar=({progress:progress})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{alignItems:"center",gutterSize:"xs"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{style:{width:"100px"},grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiProgress"],{value:progress,max:100,color:"primary",size:"m"},progress,"%")),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{style:{width:"35px"},grow:false},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs"},`${progress}%`)));var common=__webpack_require__(66);var use_columns=__webpack_require__(260);var analytics_list_common=__webpack_require__(88);var analytics=__webpack_require__(62);var expanded_row_messages_pane=__webpack_require__(476);var ml_api_service=__webpack_require__(59);var job_messages=__webpack_require__(392);var toast_notification_service=__webpack_require__(72);const ExpandedRowMessagesPane=({analyticsId:analyticsId})=>{const[messages,setMessages]=Object(external_kbnSharedDeps_React_["useState"])([]);const[isLoading,setIsLoading]=Object(external_kbnSharedDeps_React_["useState"])(false);const[errorMessage,setErrorMessage]=Object(external_kbnSharedDeps_React_["useState"])("");const toastNotificationService=Object(toast_notification_service["c"])();const getMessages=Object(external_kbnSharedDeps_React_["useCallback"])(async()=>{try{setIsLoading(true);const messagesResp=await ml_api_service["ml"].dataFrameAnalytics.getAnalyticsAuditMessages(analyticsId);setIsLoading(false);setMessages(messagesResp)}catch(error){setIsLoading(false);toastNotificationService.displayErrorToast(error,external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dfAnalyticsList.analyticsDetails.messagesPane.errorToastMessageTitle",{defaultMessage:"Error loading job messages"}));setErrorMessage(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dfAnalyticsList.analyticsDetails.messagesPane.errorMessage",{defaultMessage:"Messages could not be loaded"}))}},[]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{getMessages()},[]);Object(common["I"])({onRefresh:getMessages});return external_kbnSharedDeps_React_default.a.createElement("div",{className:"mlExpandedRowJobMessages"},external_kbnSharedDeps_React_default.a.createElement(job_messages["a"],{messages:messages,loading:isLoading,error:errorMessage,refreshMessage:getMessages}))};function getItemDescription(value){if(typeof value==="object"){return JSON.stringify(value)}return value.toString()}const LoadedStat=({isLoading:isLoading,evalData:evalData,resultProperty:resultProperty})=>external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,isLoading===false&&evalData.error!==null&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:"alert",size:"s"}),isLoading===true&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiLoadingSpinner"],{size:"s"}),isLoading===false&&evalData.error===null&&evalData[resultProperty]);const defaultEval={mse:"",msle:"",huber:"",rSquared:"",error:null};const ExpandedRow=({item:item})=>{var _item$config,_item$config$dest,_item$config2;const[trainingEval,setTrainingEval]=Object(external_kbnSharedDeps_React_["useState"])(defaultEval);const[generalizationEval,setGeneralizationEval]=Object(external_kbnSharedDeps_React_["useState"])(defaultEval);const[isLoadingTraining,setIsLoadingTraining]=Object(external_kbnSharedDeps_React_["useState"])(false);const[isLoadingGeneralization,setIsLoadingGeneralization]=Object(external_kbnSharedDeps_React_["useState"])(false);const index=item===null||item===void 0?void 0:(_item$config=item.config)===null||_item$config===void 0?void 0:(_item$config$dest=_item$config.dest)===null||_item$config$dest===void 0?void 0:_item$config$dest.index;const dependentVariable=Object(common["w"])(item.config.analysis);const predictionFieldName=Object(common["A"])(item.config.analysis);const resultsField=item.config.dest.results_field;const jobIsCompleted=Object(analytics_list_common["e"])(item.stats);const isRegressionJob=Object(analytics["D"])(item.config.analysis);const analysisType=Object(analytics["r"])(item.config.analysis);const loadData=async()=>{setIsLoadingGeneralization(true);setIsLoadingTraining(true);const genErrorEval=await Object(common["F"])({isTraining:false,index:index,dependentVariable:dependentVariable,resultsField:resultsField,predictionFieldName:predictionFieldName,jobType:analytics["b"].REGRESSION});if(genErrorEval.success===true&&genErrorEval.eval&&Object(analytics["E"])(genErrorEval.eval)){const{mse:mse,msle:msle,huber:huber,r_squared:r_squared}=Object(common["C"])(genErrorEval.eval);setGeneralizationEval({mse:mse,msle:msle,huber:huber,rSquared:r_squared,error:null});setIsLoadingGeneralization(false)}else{setIsLoadingGeneralization(false);setGeneralizationEval({mse:"",msle:"",huber:"",rSquared:"",error:genErrorEval.error})}const trainingErrorEval=await Object(common["F"])({isTraining:true,index:index,dependentVariable:dependentVariable,resultsField:resultsField,predictionFieldName:predictionFieldName,jobType:analytics["b"].REGRESSION});if(trainingErrorEval.success===true&&trainingErrorEval.eval&&Object(analytics["E"])(trainingErrorEval.eval)){const{mse:mse,msle:msle,huber:huber,r_squared:r_squared}=Object(common["C"])(trainingErrorEval.eval);setTrainingEval({mse:mse,msle:msle,huber:huber,rSquared:r_squared,error:null});setIsLoadingTraining(false)}else{setIsLoadingTraining(false);setTrainingEval({mse:"",msle:"",huber:"",rSquared:"",error:genErrorEval.error})}};Object(external_kbnSharedDeps_React_["useEffect"])(()=>{if(jobIsCompleted&&isRegressionJob){loadData()}},[jobIsCompleted]);const stateValues={...item.stats};const analysisStatsValues=stateValues.analysis_stats?stateValues.analysis_stats[`${analysisType}_stats`]:undefined;if((_item$config2=item.config)!==null&&_item$config2!==void 0&&_item$config2.description){stateValues.description=item.config.description}delete stateValues.progress;const stateItems=Object.entries(stateValues).map(([stateKey,stateValue])=>{const title=stateKey.toString();if(title==="state"){return{title:title,description:Object(use_columns["b"])(getItemDescription(stateValue))}}else if(title!=="analysis_stats"){return{title:title,description:getItemDescription(stateValue)}}}).filter(stateItem=>stateItem!==undefined);const state={title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.expandedRow.tabs.jobSettings.state",{defaultMessage:"State"}),items:stateItems,position:"left"};const{currentPhase:currentPhase,totalPhases:totalPhases}=Object(analytics_list_common["d"])(item.stats);const progress={title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.expandedRow.tabs.jobSettings.progress",{defaultMessage:"Progress"}),items:[{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.expandedRow.tabs.jobSettings.phase",{defaultMessage:"Phase"}),description:`${currentPhase}/${totalPhases}`},...item.stats.progress.map(s=>({title:s.phase,description:external_kbnSharedDeps_React_default.a.createElement(ProgressBar,{progress:s.progress_percent})}))],position:"right"};const stats={title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.expandedRow.tabs.jobSettings.stats",{defaultMessage:"Stats"}),items:[{title:"create_time",description:Object(date_utils["c"])(external_kbnSharedDeps_MomentTimezone_default()(item.config.create_time).unix()*1e3)},{title:"model_memory_limit",description:item.config.model_memory_limit},{title:"version",description:item.config.version}],position:"left"};const analysisStats=analysisStatsValues?{title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.expandedRow.tabs.jobSettings.analysisStats",{defaultMessage:"Analysis stats"}),items:[{title:"timestamp",description:Object(date_utils["c"])(external_kbnSharedDeps_MomentTimezone_default()(analysisStatsValues.timestamp).unix()*1e3)},{title:"timing_stats",description:getItemDescription(analysisStatsValues.timing_stats)},...Object.entries(analysisStatsValues.parameters||analysisStatsValues.hyperparameters||{}).map(([stateKey,stateValue])=>{const title=stateKey.toString();return{title:title,description:getItemDescription(stateValue)}})],position:"right"}:undefined;if(jobIsCompleted&&isRegressionJob){stats.items.push({title:"generalization mean squared error",description:external_kbnSharedDeps_React_default.a.createElement(LoadedStat,{isLoading:isLoadingGeneralization,evalData:generalizationEval,resultProperty:analytics["j"].MSE})},{title:"generalization mean squared logarithmic error",description:external_kbnSharedDeps_React_default.a.createElement(LoadedStat,{isLoading:isLoadingGeneralization,evalData:generalizationEval,resultProperty:analytics["j"].MSLE})},{title:"generalization r squared",description:external_kbnSharedDeps_React_default.a.createElement(LoadedStat,{isLoading:isLoadingGeneralization,evalData:generalizationEval,resultProperty:analytics["j"].R_SQUARED})},{title:"generalization pseudo huber loss function",description:external_kbnSharedDeps_React_default.a.createElement(LoadedStat,{isLoading:isLoadingTraining,evalData:generalizationEval,resultProperty:analytics["j"].HUBER})},{title:"training mean squared error",description:external_kbnSharedDeps_React_default.a.createElement(LoadedStat,{isLoading:isLoadingTraining,evalData:trainingEval,resultProperty:analytics["j"].MSE})},{title:"training mean squared logarithmic error",description:external_kbnSharedDeps_React_default.a.createElement(LoadedStat,{isLoading:isLoadingTraining,evalData:trainingEval,resultProperty:analytics["j"].MSLE})},{title:"training r squared",description:external_kbnSharedDeps_React_default.a.createElement(LoadedStat,{isLoading:isLoadingTraining,evalData:trainingEval,resultProperty:analytics["j"].R_SQUARED})},{title:"training pseudo huber loss function",description:external_kbnSharedDeps_React_default.a.createElement(LoadedStat,{isLoading:isLoadingTraining,evalData:trainingEval,resultProperty:analytics["j"].HUBER})})}const detailsSections=[state,progress];const statsSections=[stats];if(analysisStats!==undefined){statsSections.push(analysisStats)}const tabs=[{id:"ml-analytics-job-details",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.expandedRow.tabs.jobSettingsLabel",{defaultMessage:"Job details"}),content:external_kbnSharedDeps_React_default.a.createElement(ExpandedRowDetailsPane,{sections:detailsSections})},{id:"ml-analytics-job-stats",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.analyticsDetails.tabs.analyticsStatsLabel",{defaultMessage:"Job stats"}),content:external_kbnSharedDeps_React_default.a.createElement(ExpandedRowDetailsPane,{sections:statsSections})},{id:"ml-analytics-job-json",name:"JSON",content:external_kbnSharedDeps_React_default.a.createElement(ExpandedRowJsonPane,{json:item.config})},{id:"ml-analytics-job-messages",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.analyticsDetails.tabs.analyticsMessagesLabel",{defaultMessage:"Job messages"}),content:external_kbnSharedDeps_React_default.a.createElement(ExpandedRowMessagesPane,{analyticsId:item.id})}];return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTabbedContent"],{size:"s",tabs:tabs,initialSelectedTab:tabs[0],onTabClick:()=>{},expand:false,style:{width:"100%"}})}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"b",(function(){return results_loader_ResultsLoader}));__webpack_require__.d(__webpack_exports__,"a",(function(){return categorization_examples_loader_CategorizationExamplesLoader}));var external_kbnSharedDeps_Rxjs_=__webpack_require__(19);var job_creator=__webpack_require__(93);var results_service=__webpack_require__(114);var anomaly_utils=__webpack_require__(6);var parse_interval=__webpack_require__(22);var external_kbnSharedDeps_Lodash_=__webpack_require__(5);var string_utils=__webpack_require__(84);var ml_api_service=__webpack_require__(59);function getScoresByRecord(jobId,earliestMs,latestMs,intervalMs,firstSplitField){return new Promise((resolve,reject)=>{const obj={success:true,results:{},totalResults:0};let jobIdFilterStr="job_id: "+jobId;if(firstSplitField&&firstSplitField.value!==undefined){jobIdFilterStr+=` AND ${Object(string_utils["c"])(firstSplitField.name)}:`;jobIdFilterStr+=`"${String(firstSplitField.value).replace(/\\/g,"\\\\")}"`}ml_api_service["ml"].results.anomalySearch({size:0,body:{query:{bool:{filter:[{query_string:{query:"result_type:record"}},{bool:{must:[{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}},{query_string:{query:jobIdFilterStr}}]}}]}},aggs:{detector_index:{terms:{field:"detector_index",order:{recordScore:"desc"}},aggs:{recordScore:{max:{field:"record_score"}},byTime:{date_histogram:{field:"timestamp",fixed_interval:`${intervalMs}ms`,min_doc_count:1,extended_bounds:{min:earliestMs,max:latestMs}},aggs:{recordScore:{max:{field:"record_score"}}}}}}}}},[jobId]).then(resp=>{const detectorsByIndex=Object(external_kbnSharedDeps_Lodash_["get"])(resp,["aggregations","detector_index","buckets"],[]);detectorsByIndex.forEach(dtr=>{const dtrResults=[];const dtrIndex=+dtr.key;const buckets=Object(external_kbnSharedDeps_Lodash_["get"])(dtr,["byTime","buckets"],[]);for(let j=0;j<buckets.length;j++){const bkt=buckets[j];const time=bkt.key;dtrResults.push({time:time,value:Object(external_kbnSharedDeps_Lodash_["get"])(bkt,["recordScore","value"])})}obj.results[dtrIndex]=dtrResults});resolve(obj)}).catch(resp=>{reject(resp)})})}var new_job=__webpack_require__(68);var aggregation_types=__webpack_require__(79);function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}const emptyModelItem={time:0,actual:0,modelUpper:0,modelLower:0};const LAST_UPDATE_DELAY_MS=500;class results_loader_ResultsLoader{constructor(jobCreator,chartInterval,chartLoader){_defineProperty(this,"_results$",void 0);_defineProperty(this,"_resultsSearchRunning",false);_defineProperty(this,"_jobCreator",void 0);_defineProperty(this,"_chartInterval",void 0);_defineProperty(this,"_lastModelTimeStamp",0);_defineProperty(this,"_lastResultsTimeout",null);_defineProperty(this,"_chartLoader",void 0);_defineProperty(this,"_results",{progress:0,model:[],anomalies:[]});_defineProperty(this,"_detectorSplitFieldFilters",null);_defineProperty(this,"_splitFieldFiltersLoaded",false);_defineProperty(this,"progressSubscriber",async progress=>{if(this._resultsSearchRunning===false&&(progress-this._results.progress>5||progress===100)){if(this._splitFieldFiltersLoaded===false){this._splitFieldFiltersLoaded=true;await this._populateDetectorSplitFieldFilters()}this._updateData(progress,false);if(progress===100){clearTimeout(this._lastResultsTimeout);this._lastResultsTimeout=setTimeout(()=>{this._updateData(progress,true)},LAST_UPDATE_DELAY_MS)}}});this._jobCreator=jobCreator;this._chartInterval=chartInterval;this._results$=new external_kbnSharedDeps_Rxjs_["BehaviorSubject"](this._results);this._chartLoader=chartLoader;jobCreator.subscribeToProgress(this.progressSubscriber)}async _updateData(progress,fullRefresh){this._resultsSearchRunning=true;if(fullRefresh===true){this._clearResults()}this._results.progress=progress;const getAnomalyData=this._jobCreator.type===new_job["f"].SINGLE_METRIC?()=>this._loadJobAnomalyData(0):()=>this._loadDetectorsAnomalyData();const[model,anomalies]=await Promise.all([this._loadModelData(0),getAnomalyData()]);this._results.model=model;this._results.anomalies=anomalies;this._resultsSearchRunning=false;this._results$.next(this._results)}get results$(){return this._results$}subscribeToResults(func){return this._results$.subscribe(func)}get progress(){return this._results.progress}_clearResults(){this._results.model={};this._results.anomalies={};this._results.progress=0;this._lastModelTimeStamp=0}async _loadModelData(dtrIndex){if(this._jobCreator.modelPlot===false){return[]}const agg=this._jobCreator.getAggregation(dtrIndex);if(agg===null){return{[dtrIndex]:[emptyModelItem]}}const resp=await results_service["mlResultsService"].getModelPlotOutput(this._jobCreator.jobId,dtrIndex,[],this._lastModelTimeStamp,this._jobCreator.end,this._chartInterval.getInterval().asMilliseconds(),agg.mlModelPlotAgg).toPromise();return this._createModel(resp,dtrIndex)}_createModel({results:results},dtrIndex){if(this._results.model[dtrIndex]===undefined){this._results.model[dtrIndex]=[]}const dslName=this._jobCreator.aggregations[dtrIndex].dslName;const isCountAgg=dslName===aggregation_types["a"].COUNT||dslName===aggregation_types["a"].CARDINALITY;const modelScale=isCountAgg?this._calculateModelScale():1;const model=Object.entries(results).map(([time,{actual:actual,modelLower:modelLower,modelUpper:modelUpper}])=>({time:+time,actual:actual,modelUpper:(modelUpper===null?0:modelUpper)*modelScale,modelLower:(modelLower===null?0:modelLower)*modelScale}));if(model.length>10){this._lastModelTimeStamp=model[model.length-5].time;for(let i=0;i<5;i++){this._results.model[dtrIndex].pop()}}return{[dtrIndex]:this._results.model[dtrIndex].concat(model)}}async _loadJobAnomalyData(dtrIndex){const resp=await results_service["mlResultsService"].getScoresByBucket([this._jobCreator.jobId],this._jobCreator.start,this._jobCreator.end,this._chartInterval.getInterval().asMilliseconds(),1);const results=resp.results[this._jobCreator.jobId];if(results===undefined){return[]}const anomalies={};anomalies[0]=Object.entries(results).map(([time,value])=>({time:+time,value:value,severity:Object(anomaly_utils["j"])(value)}));return anomalies}async _loadDetectorsAnomalyData(){const resp=await getScoresByRecord(this._jobCreator.jobId,this._jobCreator.start,this._jobCreator.end,this._chartInterval.getInterval().asMilliseconds(),this._detectorSplitFieldFilters);const anomalies={};Object.entries(resp.results).forEach(([dtrIdx,results])=>{anomalies[+dtrIdx]=results.map(r=>({...r,severity:Object(anomaly_utils["j"])(r.value)}))});return anomalies}async _populateDetectorSplitFieldFilters(){if(Object(job_creator["c"])(this._jobCreator)){if(this._jobCreator.splitField!==null){const fieldValues=await this._chartLoader.loadFieldExampleValues(this._jobCreator.splitField,this._jobCreator.runtimeMappings);if(fieldValues.length>0){this._detectorSplitFieldFilters={name:this._jobCreator.splitField.name,value:fieldValues[0]}}return}}this._detectorSplitFieldFilters=null}_calculateModelScale(){const duration=Object(parse_interval["a"])(this._jobCreator.bucketSpan);const bucketSpanMs=duration!==null?duration.asMilliseconds():0;const chartIntervalMs=this._chartInterval.getInterval().asMilliseconds();return chartIntervalMs/bucketSpanMs}}var categorization_job=__webpack_require__(155);function categorization_examples_loader_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}class categorization_examples_loader_CategorizationExamplesLoader{constructor(jobCreator,indexPattern,query){categorization_examples_loader_defineProperty(this,"_jobCreator",void 0);categorization_examples_loader_defineProperty(this,"_indexPatternTitle","");categorization_examples_loader_defineProperty(this,"_timeFieldName","");categorization_examples_loader_defineProperty(this,"_query",{});this._jobCreator=jobCreator;this._indexPatternTitle=indexPattern.title;this._query=query;if(typeof indexPattern.timeFieldName==="string"){this._timeFieldName=indexPattern.timeFieldName}}async loadExamples(){var _this$_jobCreator$run;const analyzer=this._jobCreator.categorizationAnalyzer;const categorizationFieldName=this._jobCreator.categorizationFieldName;if(categorizationFieldName===null){return{examples:[],sampleSize:0,overallValidStatus:categorization_job["a"].INVALID,validationChecks:[]}}const resp=await ml_api_service["ml"].jobs.categorizationFieldExamples(this._indexPatternTitle,this._query,categorization_job["b"],categorizationFieldName,this._timeFieldName,this._jobCreator.start,this._jobCreator.end,analyzer,(_this$_jobCreator$run=this._jobCreator.runtimeMappings)!==null&&_this$_jobCreator$run!==void 0?_this$_jobCreator$run:undefined);return resp}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return DeleteActionModal}));__webpack_require__.d(__webpack_exports__,"b",(function(){return useDeleteAction}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(33);var check_capabilities=__webpack_require__(63);var common=__webpack_require__(88);const deleteActionNameText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.deleteActionNameText",{defaultMessage:"Delete"});const DeleteActionName=({isDisabled:isDisabled,item:item})=>{if(isDisabled){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{position:"top",content:Object(common["g"])(item.stats.state)?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.deleteActionDisabledToolTipContent",{defaultMessage:"Stop the data frame analytics job in order to delete it."}):Object(check_capabilities["f"])("canStartStopDataFrameAnalytics")},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,deleteActionNameText))}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,deleteActionNameText)};const DeleteActionModal=({closeModal:closeModal,deleteAndCloseModal:deleteAndCloseModal,deleteTargetIndex:deleteTargetIndex,deleteIndexPattern:deleteIndexPattern,indexPatternExists:indexPatternExists,isLoading:isLoading,item:item,toggleDeleteIndex:toggleDeleteIndex,toggleDeleteIndexPattern:toggleDeleteIndexPattern,userCanDeleteIndex:userCanDeleteIndex})=>{if(item===undefined){return null}const indexName=item.config.dest.index;return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiConfirmModal"],{"data-test-subj":"mlAnalyticsJobDeleteModal",title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.deleteModalTitle",{defaultMessage:"Delete {analyticsId}?",values:{analyticsId:item.config.id}}),onCancel:closeModal,onConfirm:deleteAndCloseModal,cancelButtonText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.deleteModalCancelButton",{defaultMessage:"Cancel"}),confirmButtonText:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.deleteModalDeleteButton",{defaultMessage:"Delete"}),defaultFocusedButton:external_kbnSharedDeps_ElasticEui_["EUI_MODAL_CONFIRM_BUTTON"],buttonColor:"danger",confirmButtonDisabled:isLoading},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"column",gutterSize:"none"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,userCanDeleteIndex&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{"data-test-subj":"mlAnalyticsJobDeleteIndexSwitch",style:{paddingBottom:10},label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.deleteDestinationIndexTitle",{defaultMessage:"Delete destination index {indexName}",values:{indexName:indexName}}),checked:deleteTargetIndex,onChange:toggleDeleteIndex})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],null,userCanDeleteIndex&&indexPatternExists&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSwitch"],{"data-test-subj":"mlAnalyticsJobDeleteIndexPatternSwitch",label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.deleteTargetIndexPatternTitle",{defaultMessage:"Delete index pattern {indexPattern}",values:{indexPattern:indexName}}),checked:deleteIndexPattern,onChange:toggleDeleteIndexPattern}))))};var errors=__webpack_require__(20);var kibana=__webpack_require__(58);var toast_notification_service=__webpack_require__(72);var analytics_service=__webpack_require__(172);const DF_ANALYTICS_JOB_TYPE="data-frame-analytics";const useDeleteAction=canDeleteDataFrameAnalytics=>{var _item$config$dest$ind;const[item,setItem]=Object(external_kbnSharedDeps_React_["useState"])();const[isModalVisible,setModalVisible]=Object(external_kbnSharedDeps_React_["useState"])(false);const[isDeleteJobCheckModalVisible,setDeleteJobCheckModalVisible]=Object(external_kbnSharedDeps_React_["useState"])(false);const[deleteItem,setDeleteItem]=Object(external_kbnSharedDeps_React_["useState"])(false);const[deleteTargetIndex,setDeleteTargetIndex]=Object(external_kbnSharedDeps_React_["useState"])(true);const[deleteIndexPattern,setDeleteIndexPattern]=Object(external_kbnSharedDeps_React_["useState"])(true);const[userCanDeleteIndex,setUserCanDeleteIndex]=Object(external_kbnSharedDeps_React_["useState"])(false);const[indexPatternExists,setIndexPatternExists]=Object(external_kbnSharedDeps_React_["useState"])(false);const[isLoading,setIsLoading]=Object(external_kbnSharedDeps_React_["useState"])(false);const{savedObjects:savedObjects}=Object(kibana["b"])().services;const savedObjectsClient=savedObjects.client;const indexName=(_item$config$dest$ind=item===null||item===void 0?void 0:item.config.dest.index)!==null&&_item$config$dest$ind!==void 0?_item$config$dest$ind:"";const toastNotificationService=Object(toast_notification_service["c"])();const checkIndexPatternExists=async()=>{try{const response=await savedObjectsClient.find({type:"index-pattern",perPage:10,search:`"${indexName}"`,searchFields:["title"],fields:["title"]});const ip=response.savedObjects.find(obj=>obj.attributes.title.toLowerCase()===indexName.toLowerCase());if(ip!==undefined){setIndexPatternExists(true)}else{setIndexPatternExists(false)}setIsLoading(false)}catch(e){const error=Object(errors["i"])(e);setIsLoading(false);toastNotificationService.displayDangerToast(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.errorWithCheckingIfIndexPatternExistsNotificationErrorMessage",{defaultMessage:"An error occurred checking if index pattern {indexPattern} exists: {error}",values:{indexPattern:indexName,error:error}}))}};const checkUserIndexPermission=()=>{try{const userCanDelete=Object(analytics_service["a"])(indexName,toastNotificationService);if(userCanDelete){setUserCanDeleteIndex(true)}}catch(e){const error=Object(errors["i"])(e);setIsLoading(false);toastNotificationService.displayDangerToast(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analyticsList.errorWithCheckingIfUserCanDeleteIndexNotificationErrorMessage",{defaultMessage:"An error occurred checking if user can delete {destinationIndex}: {error}",values:{destinationIndex:indexName,error:error}}))}};Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setIsLoading(true);checkIndexPatternExists();checkUserIndexPermission()},[isModalVisible]);const closeModal=()=>setModalVisible(false);const closeDeleteJobCheckModal=()=>setDeleteJobCheckModalVisible(false);const deleteAndCloseModal=()=>{setDeleteItem(true);setModalVisible(false);if(item!==undefined){if(userCanDeleteIndex&&deleteTargetIndex||userCanDeleteIndex&&deleteIndexPattern){Object(analytics_service["c"])(item.config,item.stats,deleteTargetIndex,indexPatternExists&&deleteIndexPattern,toastNotificationService)}else{Object(analytics_service["b"])(item.config,item.stats,toastNotificationService)}}};const toggleDeleteIndex=()=>setDeleteTargetIndex(!deleteTargetIndex);const toggleDeleteIndexPattern=()=>setDeleteIndexPattern(!deleteIndexPattern);const openModal=newItem=>{setItem(newItem);setModalVisible(true)};const openDeleteJobCheckModal=newItem=>{setItem(newItem);setDeleteJobCheckModalVisible(true)};const action=Object(external_kbnSharedDeps_React_["useMemo"])(()=>({name:i=>external_kbnSharedDeps_React_default.a.createElement(DeleteActionName,{isDisabled:Object(common["g"])(i.stats.state)||!canDeleteDataFrameAnalytics,item:i}),enabled:i=>!Object(common["g"])(i.stats.state)&&canDeleteDataFrameAnalytics,description:deleteActionNameText,icon:"trash",type:"icon",onClick:i=>openDeleteJobCheckModal(i),"data-test-subj":"mlAnalyticsJobDeleteButton"}),[]);return{action:action,closeDeleteJobCheckModal:closeDeleteJobCheckModal,closeModal:closeModal,deleteAndCloseModal:deleteAndCloseModal,deleteTargetIndex:deleteTargetIndex,deleteIndexPattern:deleteIndexPattern,deleteItem:deleteItem,indexPatternExists:indexPatternExists,isDeleteJobCheckModalVisible:isDeleteJobCheckModalVisible,isModalVisible:isModalVisible,isLoading:isLoading,item:item,jobType:DF_ANALYTICS_JOB_TYPE,openModal:openModal,openDeleteJobCheckModal:openDeleteJobCheckModal,toggleDeleteIndex:toggleDeleteIndex,toggleDeleteIndexPattern:toggleDeleteIndexPattern,userCanDeleteIndex:userCanDeleteIndex}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return RefreshAnalyticsListButton}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(33);var external_kbnSharedDeps_KbnI18nReact_=__webpack_require__(34);var common=__webpack_require__(66);const RefreshAnalyticsListButton=()=>{const[isLoading,setIsLoading]=Object(external_kbnSharedDeps_React_["useState"])(false);const{refresh:refresh}=Object(common["I"])({isLoading:setIsLoading});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{"data-test-subj":`mlAnalyticsRefreshListButton${isLoading?" loading":" loaded"}`,onClick:refresh,isLoading:isLoading},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_KbnI18nReact_["FormattedMessage"],{id:"xpack.ml.dataframe.analyticsList.refreshButtonLabel",defaultMessage:"Refresh"}))}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return CustomSelectionTable}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(33);var external_kbnSharedDeps_ElasticEuiLibServices_=__webpack_require__(47);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);const ITEMS_PER_PAGE=20;function getError(error){if(error!==null){return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobSelector.filterBar.invalidSearchErrorMessage",{defaultMessage:`Invalid search: {errorMessage}`,values:{errorMessage:error.message}})}return""}function CustomSelectionTable({checkboxDisabledCheck:checkboxDisabledCheck,columns:columns,currentPage:currentPage=0,filterDefaultFields:filterDefaultFields,filters:filters,items:items,itemsPerPage:itemsPerPage=ITEMS_PER_PAGE,onTableChange:onTableChange,radioDisabledCheck:radioDisabledCheck,selectedIds:selectedIds,setCurrentPaginationData:setCurrentPaginationData,singleSelection:singleSelection,sortableProperties:sortableProperties,tableItemId:tableItemId="id"}){const[itemIdToSelectedMap,setItemIdToSelectedMap]=Object(external_kbnSharedDeps_React_["useState"])(getCurrentlySelectedItemIdsMap());const[currentItems,setCurrentItems]=Object(external_kbnSharedDeps_React_["useState"])(items);const[lastSelected,setLastSelected]=Object(external_kbnSharedDeps_React_["useState"])(selectedIds);const[sortedColumn,setSortedColumn]=Object(external_kbnSharedDeps_React_["useState"])("");const[pager,setPager]=Object(external_kbnSharedDeps_React_["useState"])();const[pagerSettings,setPagerSettings]=Object(external_kbnSharedDeps_React_["useState"])({itemsPerPage:itemsPerPage,firstItemIndex:0,lastItemIndex:1});const[query,setQuery]=Object(external_kbnSharedDeps_React_["useState"])(external_kbnSharedDeps_ElasticEui_["EuiSearchBar"].Query.MATCH_ALL);const[error,setError]=Object(external_kbnSharedDeps_React_["useState"])(null);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setCurrentItems(items);handleQueryChange({query:query})},[items]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{setItemIdToSelectedMap(getCurrentlySelectedItemIdsMap())},[selectedIds]);Object(external_kbnSharedDeps_React_["useEffect"])(()=>{const tablePager=new external_kbnSharedDeps_ElasticEuiLibServices_["Pager"](currentItems.length,itemsPerPage,currentPage);setPagerSettings({itemsPerPage:itemsPerPage,firstItemIndex:tablePager.getFirstItemIndex(),lastItemIndex:tablePager.getLastItemIndex()});setPager(tablePager)},[currentItems]);function getCurrentlySelectedItemIdsMap(){const selectedIdsMap={all:false};selectedIds.forEach(id=>{selectedIdsMap[id]=true});return selectedIdsMap}function handleSingleSelectionTableChange(itemId){onTableChange([itemId])}function handleTableChange({isSelected:isSelected,itemId:itemId}){const selectedMapIds=Object.getOwnPropertyNames(itemIdToSelectedMap);const currentItemIds=currentItems.map(item=>item[tableItemId]);let currentSelected=selectedMapIds.filter(id=>itemIdToSelectedMap[id]===true&&id!==itemId);if(itemId!=="all"){if(isSelected===true){currentSelected.push(itemId)}}else{if(isSelected===false){currentSelected=currentSelected.filter(id=>currentItemIds.includes(id)===false)}else{currentSelected=[...currentSelected,...currentItemIds];currentSelected=[...new Set(currentSelected)]}}if(setCurrentPaginationData){setCurrentPaginationData({pageIndex:pager.getCurrentPageIndex(),itemsPerPage:pagerSettings.itemsPerPage})}onTableChange(currentSelected)}function handleChangeItemsPerPage(numItemsPerPage){pager.setItemsPerPage(numItemsPerPage);setPagerSettings({...pagerSettings,itemsPerPage:numItemsPerPage,firstItemIndex:pager.getFirstItemIndex(),lastItemIndex:pager.getLastItemIndex()})}function handlePageChange(pageIndex){pager.goToPageIndex(pageIndex);setPagerSettings({...pagerSettings,firstItemIndex:pager.getFirstItemIndex(),lastItemIndex:pager.getLastItemIndex()})}function handleQueryChange({query:incomingQuery,error:newError}){if(newError){setError(newError)}else{const queriedItems=external_kbnSharedDeps_ElasticEui_["EuiSearchBar"].Query.execute(incomingQuery,items,{defaultFields:filterDefaultFields});setError(null);setCurrentItems(queriedItems);setQuery(incomingQuery)}}function isItemSelected(itemId){return itemIdToSelectedMap[itemId]===true}function areAllItemsSelected(){const indexOfUnselectedItem=currentItems.findIndex(item=>!isItemSelected(item[tableItemId]));return indexOfUnselectedItem===-1}const selectAllCheckboxId=Object(external_kbnSharedDeps_React_["useMemo"])(()=>Object(external_kbnSharedDeps_ElasticEui_["htmlIdGenerator"])()(),[]);function renderSelectAll(mobile){const selectAll=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobSelector.customTable.selectAllCheckboxLabel",{defaultMessage:"Select all"});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCheckbox"],{id:`${mobile?`mobile-`:""}${selectAllCheckboxId}`,label:mobile?selectAll:null,checked:areAllItemsSelected(),onChange:toggleAll,type:mobile?null:"inList"})}function toggleItem(itemId){if(singleSelection){const lastId=lastSelected[0];setItemIdToSelectedMap({...itemIdToSelectedMap,[lastId]:false,[itemId]:true});handleSingleSelectionTableChange(itemId);setLastSelected([itemId])}else{const isSelected=!isItemSelected(itemId);setItemIdToSelectedMap({...itemIdToSelectedMap,[itemId]:isSelected});handleTableChange({isSelected:isSelected,itemId:itemId})}}function toggleAll(){const allSelected=areAllItemsSelected()||itemIdToSelectedMap.all===true;const newItemIdToSelectedMap={};currentItems.forEach(item=>newItemIdToSelectedMap[item[tableItemId]]=!allSelected);setItemIdToSelectedMap(newItemIdToSelectedMap);handleTableChange({isSelected:!allSelected,itemId:"all"})}function onSort(prop){sortableProperties.sortOn(prop);const sortedItems=sortableProperties.sortItems(currentItems);setCurrentItems(sortedItems);setSortedColumn(prop)}function renderHeaderCells(){const headers=[];columns.forEach((column,columnIndex)=>{if(column.isCheckbox&&!singleSelection){headers.push(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTableHeaderCellCheckbox"],{key:column.id,width:column.width},renderSelectAll()))}else{headers.push(external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTableHeaderCell"],{key:column.id,align:columns[columnIndex].alignment,width:column.width,onSort:column.isSortable?()=>onSort(column.id):undefined,isSorted:sortedColumn===column.id,isSortAscending:sortableProperties?sortableProperties.isAscendingByName(column.id):true,mobileOptions:column.mobileOptions},column.label))}});return headers.length?headers:null}function renderRows(){const renderRow=item=>{const cells=columns.map(column=>{const cell=item[column.id];let child;if(column.isCheckbox){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTableRowCellCheckbox"],{key:column.id},!singleSelection&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiCheckbox"],{disabled:checkboxDisabledCheck!==undefined?checkboxDisabledCheck(item):undefined,id:`${item[tableItemId]}-checkbox`,"data-test-subj":`${item[tableItemId]}-checkbox`,checked:isItemSelected(item[tableItemId]),onChange:()=>toggleItem(item[tableItemId]),type:"inList"}),singleSelection&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiRadio"],{id:item[tableItemId],"data-test-subj":`${item[tableItemId]}-radio-button`,checked:isItemSelected(item[tableItemId]),onChange:()=>toggleItem(item[tableItemId]),disabled:radioDisabledCheck!==undefined?radioDisabledCheck(item):undefined}))}if(column.render){child=column.render(item)}else{child=cell}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTableRowCell"],{key:column.id,align:column.alignment,truncateText:cell&&cell.truncateText,textOnly:cell?cell.textOnly:true,mobileOptions:{header:column.label,...column.mobileOptions}},child)});return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTableRow"],{key:item[tableItemId],isSelected:isItemSelected(item[tableItemId]),isSelectable:true,hasActions:true,"data-test-subj":"mlCustomSelectionTableRow"},cells)};const rows=[];for(let itemIndex=pagerSettings.firstItemIndex;itemIndex<=pagerSettings.lastItemIndex;itemIndex++){const item=currentItems[itemIndex];if(item===undefined){break}rows.push(renderRow(item))}return rows}return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{direction:"column"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false,"data-test-subj":"mlCustomSelectionTableSearchBar"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSearchBar"],{defaultQuery:query,box:{incremental:true,placeholder:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobSelector.customTable.searchBarPlaceholder",{defaultMessage:"Search..."})},filters:filters,onChange:handleQueryChange}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{fullWidth:true,isInvalid:error!==null,error:getError(error),style:{maxHeight:"0px"}},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null)))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTableHeaderMobile"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],{responsive:false,justifyContent:"spaceBetween",alignItems:"baseline"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:false},renderSelectAll(true)))),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTable"],{"data-test-subj":"mlCustomSelectionTable"},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTableHeader"],null,renderHeaderCells()),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTableBody"],null,renderRows())),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"m"}),pager!==undefined&&external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTablePagination"],{activePage:pager.getCurrentPageIndex(),itemsPerPage:pagerSettings.itemsPerPage,itemsPerPageOptions:[5,10,20,50],pageCount:pager.getTotalPages(),onChangeItemsPerPage:handleChangeItemsPerPage,onChangePage:pageIndex=>handlePageChange(pageIndex)}))}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return use_create_analytics_form_state["b"]}));__webpack_require__.d(__webpack_exports__,"b",(function(){return useCreateAnalyticsForm}));var use_create_analytics_form_state=__webpack_require__(118);var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);var errors=__webpack_require__(20);var ml_api_service=__webpack_require__(59);var ml=__webpack_require__(86);var public_=__webpack_require__(35);var common=__webpack_require__(66);var action_clone=__webpack_require__(393);var use_create_analytics_form_actions=__webpack_require__(304);var reducer=__webpack_require__(394);const useCreateAnalyticsForm=()=>{const mlContext=Object(ml["b"])();const[state,dispatch]=Object(external_kbnSharedDeps_React_["useReducer"])(reducer["b"],Object(use_create_analytics_form_state["e"])());const{refresh:refresh}=Object(common["I"])();const{form:form,jobConfig:jobConfig,isAdvancedEditorEnabled:isAdvancedEditorEnabled}=state;const{createIndexPattern:createIndexPattern,jobId:jobId}=form;let{destinationIndex:destinationIndex}=form;const addRequestMessage=requestMessage=>dispatch({type:use_create_analytics_form_actions["a"].ADD_REQUEST_MESSAGE,requestMessage:requestMessage});const closeModal=()=>dispatch({type:use_create_analytics_form_actions["a"].CLOSE_MODAL});const resetAdvancedEditorMessages=()=>dispatch({type:use_create_analytics_form_actions["a"].RESET_ADVANCED_EDITOR_MESSAGES});const setAdvancedEditorRawString=advancedEditorRawString=>dispatch({type:use_create_analytics_form_actions["a"].SET_ADVANCED_EDITOR_RAW_STRING,advancedEditorRawString:advancedEditorRawString});const setIndexPatternTitles=payload=>dispatch({type:use_create_analytics_form_actions["a"].SET_INDEX_PATTERN_TITLES,payload:payload});const setIsJobCreated=isJobCreated=>dispatch({type:use_create_analytics_form_actions["a"].SET_IS_JOB_CREATED,isJobCreated:isJobCreated});const setIsJobStarted=isJobStarted=>{dispatch({type:use_create_analytics_form_actions["a"].SET_IS_JOB_STARTED,isJobStarted:isJobStarted})};const resetRequestMessages=()=>dispatch({type:use_create_analytics_form_actions["a"].RESET_REQUEST_MESSAGES});const resetForm=()=>dispatch({type:use_create_analytics_form_actions["a"].RESET_FORM});const createAnalyticsJob=async()=>{resetRequestMessages();const analyticsJobConfig=isAdvancedEditorEnabled?jobConfig:Object(use_create_analytics_form_state["f"])(form);if(isAdvancedEditorEnabled){destinationIndex=analyticsJobConfig.dest.index}try{await ml_api_service["ml"].dataFrameAnalytics.createDataFrameAnalytics(jobId,analyticsJobConfig);addRequestMessage({message:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.stepCreateForm.createDataFrameAnalyticsSuccessMessage",{defaultMessage:"Request to create data frame analytics {jobId} acknowledged.",values:{jobId:jobId}})});setIsJobCreated(true);if(createIndexPattern){createKibanaIndexPattern()}refresh();return true}catch(e){addRequestMessage({error:Object(errors["i"])(e),message:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.errorCreatingDataFrameAnalyticsJob",{defaultMessage:"An error occurred creating the data frame analytics job:"})});return false}};const createKibanaIndexPattern=async()=>{const indexPatternName=destinationIndex;try{await mlContext.indexPatterns.createAndSave({title:indexPatternName},false,true);addRequestMessage({message:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.createIndexPatternSuccessMessage",{defaultMessage:"Kibana index pattern {indexPatternName} created.",values:{indexPatternName:indexPatternName}})})}catch(e){if(e instanceof public_["DuplicateIndexPatternError"]){addRequestMessage({error:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.duplicateIndexPatternErrorMessageError",{defaultMessage:"The index pattern {indexPatternName} already exists.",values:{indexPatternName:indexPatternName}}),message:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.duplicateIndexPatternErrorMessage",{defaultMessage:"An error occurred creating the Kibana index pattern:"})})}else{addRequestMessage({error:Object(errors["i"])(e),message:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.createIndexPatternErrorMessage",{defaultMessage:"An error occurred creating the Kibana index pattern:"})})}}};const prepareFormValidation=async()=>{try{const indexPatternsMap={};const savedObjects=await mlContext.indexPatterns.getCache()||[];savedObjects.forEach(obj=>{var _obj$attributes;const title=obj===null||obj===void 0?void 0:(_obj$attributes=obj.attributes)===null||_obj$attributes===void 0?void 0:_obj$attributes.title;if(title!==undefined){const id=(obj===null||obj===void 0?void 0:obj.id)||"";indexPatternsMap[title]={label:title,value:id}}});setIndexPatternTitles({indexPatternsMap:indexPatternsMap})}catch(e){addRequestMessage({error:Object(errors["i"])(e),message:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.errorGettingIndexPatternTitles",{defaultMessage:"An error occurred getting the existing index pattern titles:"})})}};const initiateWizard=async()=>{await mlContext.indexPatterns.clearCache();await prepareFormValidation()};const startAnalyticsJob=async()=>{try{const response=await ml_api_service["ml"].dataFrameAnalytics.startDataFrameAnalytics(jobId);if(response.acknowledged!==true){throw new Error(response)}addRequestMessage({message:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.startDataFrameAnalyticsSuccessMessage",{defaultMessage:"Request to start data frame analytics {jobId} acknowledged.",values:{jobId:jobId}})});setIsJobStarted(true);refresh()}catch(e){addRequestMessage({error:Object(errors["i"])(e),message:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.errorStartingDataFrameAnalyticsJob",{defaultMessage:"An error occurred starting the data frame analytics job:"})})}};const setJobConfig=payload=>{dispatch({type:use_create_analytics_form_actions["a"].SET_JOB_CONFIG,payload:payload})};const setFormState=payload=>{dispatch({type:use_create_analytics_form_actions["a"].SET_FORM_STATE,payload:payload})};const switchToAdvancedEditor=()=>{dispatch({type:use_create_analytics_form_actions["a"].SWITCH_TO_ADVANCED_EDITOR})};const switchToForm=()=>{dispatch({type:use_create_analytics_form_actions["a"].SWITCH_TO_FORM})};const setEstimatedModelMemoryLimit=value=>{dispatch({type:use_create_analytics_form_actions["a"].SET_ESTIMATED_MODEL_MEMORY_LIMIT,value:value})};const setJobClone=async cloneJob=>{resetForm();const config=Object(action_clone["a"])(cloneJob);if(Object(action_clone["b"])(config)){setFormState(Object(use_create_analytics_form_state["d"])(config));switchToAdvancedEditor()}else{setFormState(Object(use_create_analytics_form_state["d"])(config));setEstimatedModelMemoryLimit(config.model_memory_limit)}dispatch({type:use_create_analytics_form_actions["a"].SET_JOB_CLONE,cloneJob:cloneJob})};const actions={closeModal:closeModal,createAnalyticsJob:createAnalyticsJob,initiateWizard:initiateWizard,resetAdvancedEditorMessages:resetAdvancedEditorMessages,setAdvancedEditorRawString:setAdvancedEditorRawString,setFormState:setFormState,setJobConfig:setJobConfig,startAnalyticsJob:startAnalyticsJob,switchToAdvancedEditor:switchToAdvancedEditor,switchToForm:switchToForm,setEstimatedModelMemoryLimit:setEstimatedModelMemoryLimit,setJobClone:setJobClone};return{state:state,actions:actions}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return JobSpacesList}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(33);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);var saved_objects=__webpack_require__(274);var ml_api_service=__webpack_require__(59);var toast_notification_service=__webpack_require__(72);const ALL_SPACES_ID="*";const objectNoun=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.management.jobsSpacesList.objectNoun",{defaultMessage:"job"});const JobSpacesList=({spacesApi:spacesApi,spaceIds:spaceIds,jobId:jobId,jobType:jobType,refresh:refresh})=>{const{displayErrorToast:displayErrorToast}=Object(toast_notification_service["c"])();const[showFlyout,setShowFlyout]=Object(external_kbnSharedDeps_React_["useState"])(false);async function changeSpacesHandler(spacesToAdd,spacesToRemove){if(spacesToAdd.length){const resp=await ml_api_service["ml"].savedObjects.assignJobToSpace(jobType,[jobId],spacesToAdd);handleApplySpaces(resp)}if(spacesToRemove.length&&!spacesToAdd.includes(ALL_SPACES_ID)){const resp=await ml_api_service["ml"].savedObjects.removeJobFromSpace(jobType,[jobId],spacesToRemove);handleApplySpaces(resp)}onClose()}function onClose(){setShowFlyout(false);refresh()}function handleApplySpaces(resp){Object.entries(resp).forEach(([id,{success:success,error:error}])=>{if(success===false){const title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.management.jobsSpacesList.updateSpaces.error",{defaultMessage:"Error updating {id}",values:{id:id}});displayErrorToast(error,title)}})}const{SpaceList:SpaceList,ShareToSpaceFlyout:ShareToSpaceFlyout}=spacesApi.ui.components;const shareToSpaceFlyoutProps={savedObjectTarget:{type:saved_objects["a"],id:jobId,namespaces:spaceIds,title:jobId,noun:objectNoun},behaviorContext:"outside-space",changeSpacesHandler:changeSpacesHandler,onClose:onClose};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonEmpty"],{onClick:()=>setShowFlyout(true),style:{height:"auto"}},external_kbnSharedDeps_React_default.a.createElement(SpaceList,{namespaces:spaceIds,displayLimit:0,behaviorContext:"outside-space"})),showFlyout&&external_kbnSharedDeps_React_default.a.createElement(ShareToSpaceFlyout,shareToSpaceFlyoutProps))}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return JobIcon}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(33);const[INFO,WARNING,ERROR]=["info","warning","error"];const JobIcon=({message:message,showTooltip:showTooltip=false})=>{if(message===undefined){return external_kbnSharedDeps_React_default.a.createElement("span",null)}let color="primary";let icon="alert";if(message.level===INFO){icon="iInCircle"}else if(message.level===WARNING){color="warning"}else if(message.level===ERROR){color="danger"}if(showTooltip){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{position:"bottom",content:message.text},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:icon,color:color}))}else{return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiIcon"],{type:icon,color:color})}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return JobMessages}));var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var external_kbnSharedDeps_ElasticEui_=__webpack_require__(33);var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);var external_kbnSharedDeps_Theme_euiLightVars_=__webpack_require__(45);var external_kbnSharedDeps_Theme_euiLightVars_default=__webpack_require__.n(external_kbnSharedDeps_Theme_euiLightVars_);var job_message_icon=__webpack_require__(391);var date_utils=__webpack_require__(67);const JobMessages=({messages:messages,loading:loading,error:error,refreshMessage:refreshMessage})=>{const columns=[{name:refreshMessage?external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiToolTip"],{content:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobMessages.refreshLabel",{defaultMessage:"Refresh"})},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiButtonIcon"],{onClick:refreshMessage,iconType:"refresh","aria-label":external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobMessages.refreshAriaLabel",{defaultMessage:"Refresh"})})):"",render:message=>external_kbnSharedDeps_React_default.a.createElement(job_message_icon["a"],{message:message}),width:`${external_kbnSharedDeps_Theme_euiLightVars_default.a.euiSizeL}`},{field:"timestamp",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobMessages.timeLabel",{defaultMessage:"Time"}),render:date_utils["d"],width:"120px",sortable:true},{field:"node_name",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobMessages.nodeLabel",{defaultMessage:"Node"}),width:"150px"},{field:"message",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.jobMessages.messageLabel",{defaultMessage:"Message"}),width:"50%"}];const defaultSorting={sort:{field:"timestamp",direction:"asc"}};return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_default.a.Fragment,null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],{size:"s"}),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiInMemoryTable"],{className:"job-messages-table",items:messages,columns:columns,sorting:defaultSorting,compressed:true,loading:loading,error:error}))}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return clone_action_name["c"]}));__webpack_require__.d(__webpack_exports__,"b",(function(){return clone_action_name["d"]}));__webpack_require__.d(__webpack_exports__,"c",(function(){return useCloneAction}));var clone_action_name=__webpack_require__(134);var external_kbnSharedDeps_React_=__webpack_require__(10);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);const useCloneAction=canCreateDataFrameAnalytics=>{const navigateToWizardWithClonedJob=Object(clone_action_name["e"])();const clickHandler=Object(external_kbnSharedDeps_React_["useCallback"])(item=>{navigateToWizardWithClonedJob(item)},[]);const action=Object(external_kbnSharedDeps_React_["useMemo"])(()=>({name:()=>external_kbnSharedDeps_React_default.a.createElement(clone_action_name["a"],{isDisabled:!canCreateDataFrameAnalytics}),enabled:()=>canCreateDataFrameAnalytics,description:clone_action_name["b"],icon:"copy",type:"icon",onClick:clickHandler,"data-test-subj":"mlAnalyticsJobCloneButton"}),[]);return{action:action}}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return getModelMemoryLimitErrors}));__webpack_require__.d(__webpack_exports__,"b",(function(){return reducer}));var external_kbnSharedDeps_KbnI18n_=__webpack_require__(2);var external_kbnSharedDeps_Lodash_=__webpack_require__(5);var external_kbnSharedDeps_ElasticNumeral_=__webpack_require__(42);var external_kbnSharedDeps_ElasticNumeral_default=__webpack_require__.n(external_kbnSharedDeps_ElasticNumeral_);const windowWithTextEncoder=window;function isValidIndexNameLength(indexName){if(windowWithTextEncoder.TextEncoder&&new windowWithTextEncoder.TextEncoder("utf-8").encode(indexName).length>255){return false}return indexName.length<=255}function isValidIndexName(indexName){return typeof indexName==="string"&&indexName===indexName.toLowerCase()&&/^[^\*\\/\?"<>|\s,#:]+$/.test(indexName)&&/^[^-_\+]+$/.test(indexName.charAt(0))&&indexName!=="."&&indexName!==".."&&isValidIndexNameLength(indexName)}var shared_imports=__webpack_require__(159);var actions=__webpack_require__(304);var use_create_analytics_form_state=__webpack_require__(118);var job_utils=__webpack_require__(64);var validators=__webpack_require__(14);var validation=__webpack_require__(23);var data_frame_analytics=__webpack_require__(74);var analytics=__webpack_require__(62);var public_=__webpack_require__(35);var clone_action_name=__webpack_require__(134);const mmlAllowedUnitsStr=`${validation["a"].slice(0,validation["a"].length-1).join(", ")} or ${[...validation["a"]].pop()}`;const mmlUnitInvalidErrorMessage=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.modelMemoryUnitsInvalidError",{defaultMessage:"Model memory limit data unit unrecognized. It must be {str}",values:{str:mmlAllowedUnitsStr}});function getModelMemoryLimitErrors(mmlValidationResult){if(mmlValidationResult===null){return null}return Object.keys(mmlValidationResult).reduce((acc,errorKey)=>{if(errorKey==="min"){acc.push(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.modelMemoryUnitsMinError",{defaultMessage:"Model memory limit is lower than estimated value {mml}",values:{mml:mmlValidationResult.min.minValue}}))}if(errorKey==="invalidUnits"){acc.push(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.modelMemoryUnitsInvalidError",{defaultMessage:"Model memory limit data unit unrecognized. It must be {str}",values:{str:mmlAllowedUnitsStr}}))}return acc},[])}const getSourceIndexString=state=>{var _jobConfig$source;const{jobConfig:jobConfig}=state;const sourceIndex=jobConfig===null||jobConfig===void 0?void 0:(_jobConfig$source=jobConfig.source)===null||_jobConfig$source===void 0?void 0:_jobConfig$source.index;if(typeof sourceIndex==="string"){return sourceIndex}if(Array.isArray(sourceIndex)){return sourceIndex.join(",")}return""};const validateNumTopFeatureImportanceValues=numTopFeatureImportanceValues=>typeof numTopFeatureImportanceValues==="number"&&numTopFeatureImportanceValues>=analytics["g"]&&Number.isInteger(numTopFeatureImportanceValues);const validateAdvancedEditor=state=>{var _jobConfig$source2,_jobConfig$dest$index,_jobConfig$dest,_jobConfig$dest2,_jobConfig$dest3;const{jobIdEmpty:jobIdEmpty,jobIdValid:jobIdValid,jobIdExists:jobIdExists,jobType:jobType,createIndexPattern:createIndexPattern,includes:includes}=state.form;const{jobConfig:jobConfig}=state;state.advancedEditorMessages=[];const sourceIndexName=getSourceIndexString(state);const sourceIndexNameEmpty=sourceIndexName==="";let sourceIndexNameValid=Object.keys(public_["indexPatterns"].validate(sourceIndexName)).length===0;const sourceIndex=jobConfig===null||jobConfig===void 0?void 0:(_jobConfig$source2=jobConfig.source)===null||_jobConfig$source2===void 0?void 0:_jobConfig$source2.index;if(sourceIndexNameValid){if(typeof sourceIndex==="string"){sourceIndexNameValid=!sourceIndex.includes(",")}if(Array.isArray(sourceIndex)){sourceIndexNameValid=!sourceIndex.some(d=>d===null||d===void 0?void 0:d.includes(","))}}const destinationIndexName=(_jobConfig$dest$index=jobConfig===null||jobConfig===void 0?void 0:(_jobConfig$dest=jobConfig.dest)===null||_jobConfig$dest===void 0?void 0:_jobConfig$dest.index)!==null&&_jobConfig$dest$index!==void 0?_jobConfig$dest$index:"";const destinationIndexNameEmpty=destinationIndexName==="";const destinationIndexNameValid=isValidIndexName(destinationIndexName);const destinationIndexPatternTitleExists=state.indexPatternsMap[destinationIndexName]!==undefined;const resultsFieldEmptyString=typeof(jobConfig===null||jobConfig===void 0?void 0:(_jobConfig$dest2=jobConfig.dest)===null||_jobConfig$dest2===void 0?void 0:_jobConfig$dest2.results_field)==="string"&&(jobConfig===null||jobConfig===void 0?void 0:(_jobConfig$dest3=jobConfig.dest)===null||_jobConfig$dest3===void 0?void 0:_jobConfig$dest3.results_field.trim())==="";const mml=jobConfig.model_memory_limit;const modelMemoryLimitEmpty=mml===""||mml===undefined;if(!modelMemoryLimitEmpty&&mml!==undefined){const{valid:valid}=Object(job_utils["w"])(mml);state.form.modelMemoryLimitUnitValid=valid}let dependentVariableEmpty=false;let includesValid=true;let trainingPercentValid=true;let numTopFeatureImportanceValuesValid=true;if(jobConfig.analysis===undefined&&(jobType===data_frame_analytics["a"].CLASSIFICATION||jobType===data_frame_analytics["a"].REGRESSION)){dependentVariableEmpty=true}if(jobConfig.analysis!==undefined&&(Object(analytics["D"])(jobConfig.analysis)||Object(analytics["A"])(jobConfig.analysis))){const dependentVariableName=Object(analytics["t"])(jobConfig.analysis)||"";dependentVariableEmpty=dependentVariableName==="";if(!dependentVariableEmpty&&includes!==undefined&&includes.length>0&&!includes.includes(dependentVariableName)){includesValid=false;state.advancedEditorMessages.push({error:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.advancedEditorMessage.includesInvalid",{defaultMessage:"The dependent variable must be included."}),message:""})}const trainingPercent=Object(analytics["y"])(jobConfig.analysis);if(trainingPercent!==undefined&&(isNaN(trainingPercent)||typeof trainingPercent!=="number"||trainingPercent<analytics["o"]||trainingPercent>analytics["n"])){trainingPercentValid=false;state.advancedEditorMessages.push({error:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.advancedEditorMessage.trainingPercentInvalid",{defaultMessage:"The training percent must be a number between {min} and {max}.",values:{min:analytics["o"],max:analytics["n"]}}),message:""})}const numTopFeatureImportanceValues=Object(analytics["v"])(jobConfig.analysis);if(numTopFeatureImportanceValues!==undefined){numTopFeatureImportanceValuesValid=validateNumTopFeatureImportanceValues(numTopFeatureImportanceValues);if(numTopFeatureImportanceValuesValid===false){state.advancedEditorMessages.push({error:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.advancedEditorMessage.numTopFeatureImportanceValuesInvalid",{defaultMessage:"The value for num_top_feature_importance_values must be an integer of {min} or higher.",values:{min:0}}),message:""})}}}if(sourceIndexNameEmpty){state.advancedEditorMessages.push({error:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.advancedEditorMessage.sourceIndexNameEmpty",{defaultMessage:"The source index name must not be empty."}),message:""})}else if(!sourceIndexNameValid){state.advancedEditorMessages.push({error:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.advancedEditorMessage.sourceIndexNameValid",{defaultMessage:"Invalid source index name."}),message:""})}if(destinationIndexNameEmpty){state.advancedEditorMessages.push({error:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.advancedEditorMessage.destinationIndexNameEmpty",{defaultMessage:"The destination index name must not be empty."}),message:""})}else if(destinationIndexPatternTitleExists&&!createIndexPattern){state.advancedEditorMessages.push({error:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.advancedEditorMessage.destinationIndexNameExistsWarn",{defaultMessage:"An index with this destination index name already exists. Be aware that running this analytics job will modify this destination index."}),message:""})}else if(!destinationIndexNameValid){state.advancedEditorMessages.push({error:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.advancedEditorMessage.destinationIndexNameValid",{defaultMessage:"Invalid destination index name."}),message:""})}if(resultsFieldEmptyString){state.advancedEditorMessages.push({error:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.advancedEditorMessage.resultsFieldEmptyString",{defaultMessage:"The results field must not be an empty string."}),message:""})}if(dependentVariableEmpty){state.advancedEditorMessages.push({error:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.advancedEditorMessage.dependentVariableEmpty",{defaultMessage:"The dependent variable field must not be empty."}),message:""})}if(modelMemoryLimitEmpty){state.advancedEditorMessages.push({error:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.ml.dataframe.analytics.create.advancedEditorMessage.modelMemoryLimitEmpty",{defaultMessage:"The model memory limit field must not be empty."}),message:""})}if(!state.form.modelMemoryLimitUnitValid){state.advancedEditorMessages.push({error:mmlUnitInvalidErrorMessage,message:""})}state.form.destinationIndexPatternTitleExists=destinationIndexPatternTitleExists;state.isValid=includesValid&&trainingPercentValid&&state.form.modelMemoryLimitUnitValid&&!jobIdEmpty&&jobIdValid&&!jobIdExists&&!sourceIndexNameEmpty&&sourceIndexNameValid&&!destinationIndexNameEmpty&&destinationIndexNameValid&&!resultsFieldEmptyString&&!dependentVariableEmpty&&!modelMemoryLimitEmpty&&numTopFeatureImportanceValuesValid&&(!destinationIndexPatternTitleExists||!createIndexPattern);return state};function validateMinMML(estimatedMml){return mml=>{if(!mml||!estimatedMml){return null}const mmlInBytes=external_kbnSharedDeps_ElasticNumeral_default()(mml.toUpperCase()).value();const estimatedMmlInBytes=external_kbnSharedDeps_ElasticNumeral_default()(estimatedMml.toUpperCase()).value();return estimatedMmlInBytes>mmlInBytes?{min:{minValue:estimatedMml,actualValue:mml}}:null}}const mmlValidator=Object(external_kbnSharedDeps_Lodash_["memoize"])(estimatedMml=>Object(validators["a"])(Object(validators["e"])(),validateMinMML(estimatedMml),Object(validators["c"])()));const validateMml=Object(external_kbnSharedDeps_Lodash_["memoize"])((estimatedMml,mml)=>mmlValidator(estimatedMml)(mml),(...args)=>args.join("_"));const validateForm=state=>{const{jobIdEmpty:jobIdEmpty,jobIdValid:jobIdValid,jobIdExists:jobIdExists,jobType:jobType,sourceIndexNameEmpty:sourceIndexNameEmpty,sourceIndexNameValid:sourceIndexNameValid,destinationIndexNameEmpty:destinationIndexNameEmpty,destinationIndexNameValid:destinationIndexNameValid,destinationIndexPatternTitleExists:destinationIndexPatternTitleExists,createIndexPattern:createIndexPattern,dependentVariable:dependentVariable,modelMemoryLimit:modelMemoryLimit,numTopFeatureImportanceValuesValid:numTopFeatureImportanceValuesValid}=state.form;const{estimatedModelMemoryLimit:estimatedModelMemoryLimit}=state;const jobTypeEmpty=jobType===undefined;const dependentVariableEmpty=(jobType===data_frame_analytics["a"].REGRESSION||jobType===data_frame_analytics["a"].CLASSIFICATION)&&dependentVariable==="";const mmlValidationResult=validateMml(estimatedModelMemoryLimit,modelMemoryLimit);const mmlInvalid=mmlValidationResult!==null&&(mmlValidationResult.invalidUnits!==undefined||mmlValidationResult.required===true);state.form.modelMemoryLimitValidationResult=mmlValidationResult;state.isValid=!jobTypeEmpty&&!mmlInvalid&&!jobIdEmpty&&jobIdValid&&!jobIdExists&&!sourceIndexNameEmpty&&sourceIndexNameValid&&!destinationIndexNameEmpty&&destinationIndexNameValid&&!dependentVariableEmpty&&numTopFeatureImportanceValuesValid&&(!destinationIndexPatternTitleExists||!createIndexPattern);return state};function reducer(state,action){switch(action.type){case actions["a"].ADD_REQUEST_MESSAGE:const requestMessages=state.requestMessages;requestMessages.push(action.requestMessage);return{...state,requestMessages:requestMessages};case actions["a"].RESET_REQUEST_MESSAGES:return{...state,requestMessages:[]};case actions["a"].RESET_ADVANCED_EDITOR_MESSAGES:return{...state,advancedEditorMessages:[]};case actions["a"].RESET_FORM:return Object(use_create_analytics_form_state["e"])();case actions["a"].SET_ADVANCED_EDITOR_RAW_STRING:let resultJobConfig;let disableSwitchToForm=false;try{resultJobConfig=JSON.parse(Object(shared_imports["b"])(action.advancedEditorRawString));disableSwitchToForm=Object(clone_action_name["d"])(resultJobConfig)}catch(e){return{...state,advancedEditorRawString:action.advancedEditorRawString,isAdvancedEditorValidJson:false,disableSwitchToForm:true,advancedEditorMessages:[]}}return{...validateAdvancedEditor({...state,jobConfig:resultJobConfig}),advancedEditorRawString:action.advancedEditorRawString,isAdvancedEditorValidJson:true,disableSwitchToForm:disableSwitchToForm};case actions["a"].SET_FORM_STATE:const newFormState={...state.form,...action.payload};if(action.payload.destinationIndex!==undefined){newFormState.destinationIndexNameEmpty=newFormState.destinationIndex==="";newFormState.destinationIndexNameValid=isValidIndexName(newFormState.destinationIndex);newFormState.destinationIndexPatternTitleExists=state.indexPatternsMap[newFormState.destinationIndex]!==undefined}if(action.payload.jobId!==undefined){newFormState.jobIdEmpty=newFormState.jobId==="";newFormState.jobIdValid=Object(job_utils["i"])(newFormState.jobId);newFormState.jobIdInvalidMaxLength=!!Object(validators["b"])(validation["b"])(newFormState.jobId)}if(action.payload.sourceIndex!==undefined){newFormState.sourceIndexNameEmpty=newFormState.sourceIndex==="";const validationMessages=public_["indexPatterns"].validate(newFormState.sourceIndex);newFormState.sourceIndexNameValid=Object.keys(validationMessages).length===0}if(action.payload.numTopFeatureImportanceValues!==undefined){newFormState.numTopFeatureImportanceValuesValid=validateNumTopFeatureImportanceValues(newFormState===null||newFormState===void 0?void 0:newFormState.numTopFeatureImportanceValues)}return state.isAdvancedEditorEnabled?validateAdvancedEditor({...state,form:newFormState}):validateForm({...state,form:newFormState});case actions["a"].SET_INDEX_PATTERN_TITLES:{const newState={...state,...action.payload};newState.form.destinationIndexPatternTitleExists=newState.indexPatternsMap[newState.form.destinationIndex]!==undefined;return newState}case actions["a"].SET_IS_JOB_CREATED:return{...state,isJobCreated:action.isJobCreated};case actions["a"].SET_IS_JOB_STARTED:return{...state,isJobStarted:action.isJobStarted};case actions["a"].SET_JOB_CONFIG:return validateAdvancedEditor({...state,jobConfig:action.payload});case actions["a"].SWITCH_TO_ADVANCED_EDITOR:const jobConfig=Object(use_create_analytics_form_state["f"])(state.form);const shouldDisableSwitchToForm=Object(clone_action_name["d"])(jobConfig);return validateAdvancedEditor({...state,advancedEditorRawString:JSON.stringify(jobConfig,null,2),isAdvancedEditorEnabled:true,disableSwitchToForm:shouldDisableSwitchToForm,hasSwitchedToEditor:true,jobConfig:jobConfig});case actions["a"].SWITCH_TO_FORM:const{jobConfig:config}=state;const{jobId:jobId}=state.form;const formState={...state.form,...Object(use_create_analytics_form_state["d"])(config,false)};if(typeof jobId==="string"&&jobId.trim()!==""){formState.jobId=jobId}formState.jobIdEmpty=jobId==="";formState.jobIdValid=Object(job_utils["i"])(jobId);formState.jobIdInvalidMaxLength=!!Object(validators["b"])(validation["b"])(jobId);formState.destinationIndexNameEmpty=formState.destinationIndex==="";formState.destinationIndexNameValid=isValidIndexName(formState.destinationIndex||"");formState.destinationIndexPatternTitleExists=state.indexPatternsMap[formState.destinationIndex||""]!==undefined;if(formState.numTopFeatureImportanceValues!==undefined){formState.numTopFeatureImportanceValuesValid=validateNumTopFeatureImportanceValues(formState.numTopFeatureImportanceValues)}return validateForm({...state,form:formState,isAdvancedEditorEnabled:false,advancedEditorRawString:JSON.stringify(config,null,2),jobConfig:config});case actions["a"].SET_ESTIMATED_MODEL_MEMORY_LIMIT:return{...state,estimatedModelMemoryLimit:action.value};case actions["a"].SET_JOB_CLONE:return{...state,cloneJob:action.cloneJob}}return state}},,,,,,,,,,,,,,,,,,,,,,,,,,,,function(module,exports,__webpack_require__){switch(window.__kbnThemeTag__){case"v7dark":return __webpack_require__(423);case"v7light":return __webpack_require__(425);case"v8dark":return __webpack_require__(427);case"v8light":return __webpack_require__(429)}},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(424);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,'.ml-app {\n  /*\n  Resets the badge\'s default strong font-weight so it\'s possible\n  to put custom emphasis inside the badge only on a part of it.\n  Used in the Explorer Chart label badge to display an entity\'s\n  field_name as `normal` and field_value as `strong`.\n*/\n  /* wrapper class for the top right alert icon and view button */\n  /* Hides the progress bar\'s background so it doesn\'t look like it increases the thickness\n   of the horizontal bar below the tab menu elements in its inactive state. */\n  /* Overrides for d3/svg default styles */ }\n  .ml-app .ml-icon-severity-critical,\n  .ml-app .ml-icon-severity-major,\n  .ml-app .ml-icon-severity-minor,\n  .ml-app .ml-icon-severity-warning,\n  .ml-app .ml-icon-severity-unknown {\n    text-shadow: 1px 1px 1px #343741; }\n  .ml-app .ml-icon-severity-critical {\n    color: #FE5050; }\n  .ml-app .ml-icon-severity-major {\n    color: #FBA740; }\n  .ml-app .ml-icon-severity-minor {\n    color: #FDEC25; }\n  .ml-app .ml-icon-severity-warning {\n    color: #8BC8FB; }\n  .ml-app .ml-icon-severity-unknown {\n    color: #98A2B3; }\n  .ml-app .mlDataFrameAnalyticsRegression__evaluateStat {\n    padding-top: 24px; }\n  .ml-app .mlJobMapLegend__container {\n    background-color: \'#FFFFFF\'; }\n  .ml-app .mlJobMapLegend__indexPattern {\n    height: 12px;\n    width: 12px;\n    background-color: #FFF;\n    border: 2px solid #D36086;\n    transform: rotate(45deg);\n    display: \'inline-block\'; }\n  .ml-app .mlJobMapLegend__transform {\n    height: 12px;\n    width: 12px;\n    background-color: #FFF;\n    border: 2px solid #6092C0;\n    display: \'inline-block\'; }\n  .ml-app .mlJobMapLegend__analytics {\n    height: 12px;\n    width: 12px;\n    background-color: #FFF;\n    border: 2px solid #54B399;\n    border-radius: 50%;\n    display: \'inline-block\'; }\n  .ml-app .mlJobMapLegend__sourceNode {\n    height: 12px;\n    width: 12px;\n    background-color: #FFCE7A;\n    border: 1px solid #343741;\n    border-radius: 4px;\n    display: \'inline-block\'; }\n  .ml-app .mlAnalyticsTable .euiTableRow-isExpandedRow .euiTableCellContent {\n    animation: none !important; }\n    .ml-app .mlAnalyticsTable .euiTableRow-isExpandedRow .euiTableCellContent .euiTableCellContent__text {\n      width: 100%; }\n  .ml-app .mlAnalyticsTable .euiIcon-isLoaded {\n    animation: none !important; }\n  .ml-app .mlTaskStateBadge, .ml-app .mlTaskModeBadge {\n    max-width: 100px; }\n  .ml-app .dataFrameAnalyticsCreateSearchDialog {\n    width: 720px;\n    min-height: 600px; }\n  .ml-app .dfAnalyticsCreationWizard__card {\n    width: 300px; }\n  .ml-app .file-datavisualizer-file-picker {\n    max-width: inherit; }\n    .ml-app .file-datavisualizer-file-picker .euiFilePicker__prompt {\n      background-color: #1D1E24;\n      box-shadow: none; }\n      .ml-app .file-datavisualizer-file-picker .euiFilePicker__prompt .euiFilePicker__icon {\n        width: 40px;\n        height: 40px; }\n  .ml-app .results .euiDescriptionList dd, .ml-app .results .euiDescriptionList dt {\n    margin-top: 5px; }\n  .ml-app .results .euiDescriptionList dd:nth-child(1), .ml-app .results .euiDescriptionList dt:nth-child(1) {\n    margin-top: 0; }\n  .ml-app .analysis-summary-list.euiDescriptionList .euiDescriptionList__title {\n    flex-basis: 15%; }\n  .ml-app .analysis-summary-list.euiDescriptionList .euiDescriptionList__description {\n    flex-basis: 85%; }\n  .ml-app .file-datavisualizer-about-panel__icon {\n    width: 96px;\n    height: 96px;\n    margin-left: 32px;\n    margin-right: 24px; }\n  .ml-app .euiFlexItem.file-datavisualizer-about-panel__doc-icon {\n    margin-left: 32px;\n    margin-right: 4px;\n    margin-top: 16px; }\n  .ml-app .import-summary-list.euiDescriptionList .euiDescriptionList__title {\n    flex-basis: 15%; }\n  .ml-app .import-summary-list.euiDescriptionList .euiDescriptionList__description {\n    flex-basis: 85%; }\n  .ml-app .failure-list {\n    max-height: 200px;\n    overflow-y: auto; }\n    .ml-app .failure-list .error-message {\n      color: #F66; }\n  .ml-app .ml-experimental-badge.euiBetaBadge {\n    font-size: 10px;\n    vertical-align: middle;\n    margin-bottom: 5px;\n    padding: 0 20px;\n    line-height: 20px; }\n  .ml-app .mlFieldDataTopValuesContainer {\n    padding-top: 4px; }\n  .ml-app .mlTopValuesValueLabelContainer {\n    margin-right: 12px; }\n    .ml-app .mlTopValuesValueLabelContainer.mlTopValuesValueLabelContainer--small {\n      width: 70px; }\n    .ml-app .mlTopValuesValueLabelContainer.mlTopValuesValueLabelContainer--large {\n      width: 200px; }\n  .ml-app .mlTopValuesPercentLabelContainer {\n    margin-left: 12px;\n    width: 70px; }\n  .ml-app .mlMetricDistributionChartContainer {\n    padding-top: 4px;\n    width: 100%; }\n  @media only screen and (max-width: 574px) {\n    .ml-app .mlDataVisualizerExpandedRow {\n      flex-direction: column; } }\n  @media only screen and (min-width: 575px) and (max-width: 767px) {\n    .ml-app .mlDataVisualizerExpandedRow {\n      flex-direction: column; } }\n  @media only screen and (min-width: 768px) and (max-width: 991px) {\n    .ml-app .mlDataVisualizerExpandedRow {\n      flex-direction: column; } }\n  .ml-app .mlDataVisualizerFieldCountContainer {\n    max-width: 300px; }\n  .ml-app .mlDataVisualizerColumnHeaderIcon {\n    max-width: 12px; }\n  .ml-app .mlDataVisualizerFieldExpandedRow {\n    padding-left: 64px;\n    width: 100%; }\n    .ml-app .mlDataVisualizerFieldExpandedRow .mlFieldDataCard__valuesTitle {\n      text-transform: uppercase;\n      text-align: left;\n      color: #98A2B3;\n      font-weight: bold;\n      padding-bottom: 8px; }\n    .ml-app .mlDataVisualizerFieldExpandedRow .mlFieldDataCard__codeContent {\n      font-family: "Roboto Mono", Consolas, Menlo, Courier, monospace;\n      letter-spacing: normal; }\n  .ml-app .mlDataVisualizer .euiTableRow > .euiTableRowCell {\n    border-bottom: 0;\n    border-top: 1px solid #343741; }\n  .ml-app .mlDataVisualizer .euiTableRow-isExpandedRow .euiTableRowCell {\n    background-color: #1D1E24 !important;\n    border-top: 0;\n    border-bottom: 1px solid #343741; }\n    .ml-app .mlDataVisualizer .euiTableRow-isExpandedRow .euiTableRowCell:hover {\n      background-color: #1D1E24 !important; }\n  .ml-app .mlDataVisualizer .mlDataVisualizerSummaryTable {\n    max-width: 350px;\n    min-width: 250px; }\n    .ml-app .mlDataVisualizer .mlDataVisualizerSummaryTable .euiTableRow > .euiTableRowCell {\n      border-bottom: 0; }\n    .ml-app .mlDataVisualizer .mlDataVisualizerSummaryTable .euiTableHeaderCell {\n      display: none; }\n  .ml-app .mlDataVisualizer .mlDataVisualizerSummaryTableWrapper {\n    max-width: 300px; }\n  .ml-app .mlDataVisualizer .mlDataVisualizerMapWrapper {\n    min-height: 300px;\n    min-width: 600px; }\n  .ml-app .ml-explorer {\n    width: 100%;\n    display: inline-block;\n    color: #98A2B3; }\n    .ml-app .ml-explorer .mlAnomalyExplorer__filterBar {\n      padding-right: 16px;\n      padding-left: 16px; }\n    .ml-app .ml-explorer .results-container {\n      padding: 0 0 16px 0; }\n      .ml-app .ml-explorer .results-container .col-xs-12 {\n        width: calc(100% - 32px);\n        padding-left: 16px; }\n      .ml-app .ml-explorer .results-container .no-influencers-warning {\n        float: left;\n        padding-top: 4px;\n        padding-left: 16px;\n        color: #98A2B3;\n        font-size: 14px; }\n      .ml-app .ml-explorer .results-container .panel-title {\n        font-size: 18px;\n        font-weight: 400;\n        color: #98A2B3;\n        display: inline-block;\n        padding-bottom: 4px; }\n      .ml-app .ml-explorer .results-container .panel-sub-title {\n        color: #98A2B3;\n        font-size: 12px; }\n    .ml-app .ml-explorer .ml-anomalies-controls {\n      padding-top: 4px; }\n      .ml-app .ml-explorer .ml-anomalies-controls #show_charts_checkbox_control {\n        padding-top: 24px; }\n  .ml-app .mlSwimLaneContainer {\n    /* Override legend styles */ }\n    .ml-app .mlSwimLaneContainer .echLegendListContainer {\n      height: 34px !important; }\n    .ml-app .mlSwimLaneContainer .echLegendList {\n      display: flex !important;\n      justify-content: space-between !important;\n      flex-wrap: nowrap;\n      position: absolute;\n      right: 0; }\n  .ml-app .ml-explorer-chart-eui-icon-tip {\n    max-width: none; }\n  .ml-app .ml-explorer-chart-label-badges {\n    margin-top: 3px; }\n  .ml-app .ml-reset-font-weight {\n    font-weight: normal; }\n  .ml-app .ml-explorer-chart-container {\n    overflow: hidden; }\n    .ml-app .ml-explorer-chart-container .ml-explorer-chart-svg {\n      font-size: 12px;\n      font-family: "Inter UI", -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; }\n      .ml-app .ml-explorer-chart-container .ml-explorer-chart-svg .line-chart rect {\n        fill: #1D1E24;\n        opacity: 1; }\n      .ml-app .ml-explorer-chart-container .ml-explorer-chart-svg .line-chart rect.selected-interval {\n        fill: rgba(200, 200, 200, 0.1);\n        stroke: #98A2B3;\n        stroke-width: 2px;\n        stroke-opacity: .8; }\n      .ml-app .ml-explorer-chart-container .ml-explorer-chart-svg .line-chart rect.scheduled-event-marker {\n        stroke-width: 1px;\n        stroke: #535966;\n        fill: #343741;\n        pointer-events: none; }\n    .ml-app .ml-explorer-chart-container .axis path, .ml-app .ml-explorer-chart-container .axis line {\n      fill: none;\n      stroke: #343741;\n      shape-rendering: crispEdges; }\n    .ml-app .ml-explorer-chart-container .axis .tick line.ml-tick-emphasis {\n      stroke: rgba(0, 0, 0, 0.2); }\n    .ml-app .ml-explorer-chart-container .axis text {\n      fill: #98A2B3; }\n    .ml-app .ml-explorer-chart-container .axis .tick line {\n      stroke: rgba(0, 0, 0, 0.05);\n      stroke-width: 1px; }\n    .ml-app .ml-explorer-chart-container .values-line {\n      fill: none;\n      stroke: #32A7C2;\n      stroke-width: 2; }\n    .ml-app .ml-explorer-chart-container .values-dots circle,\n    .ml-app .ml-explorer-chart-container .values-dots-circle {\n      fill: #32A7C2;\n      stroke-width: 0; }\n    .ml-app .ml-explorer-chart-container .values-dots circle.values-dots-circle-blur {\n      fill: #AAA; }\n    .ml-app .ml-explorer-chart-container .metric-value {\n      opacity: 1;\n      fill: transparent;\n      stroke: #32A7C2;\n      stroke-width: 0; }\n    .ml-app .ml-explorer-chart-container .anomaly-marker {\n      stroke-width: 1px;\n      stroke: #AAAAAA; }\n    .ml-app .ml-explorer-chart-container .anomaly-marker:hover {\n      stroke-width: 6px;\n      stroke: #32A7C2; }\n    .ml-app .ml-explorer-chart-container .anomaly-marker.critical {\n      fill: #FE5050; }\n    .ml-app .ml-explorer-chart-container .anomaly-marker.major {\n      fill: #FBA740; }\n    .ml-app .ml-explorer-chart-container .anomaly-marker.minor {\n      fill: #FDEC25; }\n    .ml-app .ml-explorer-chart-container .anomaly-marker.warning {\n      fill: #8BC8FB; }\n    .ml-app .ml-explorer-chart-container .anomaly-marker.low {\n      fill: #D2E9F7; }\n    .ml-app .ml-explorer-chart-container .metric-value:hover,\n    .ml-app .ml-explorer-chart-container .anomaly-marker:hover {\n      stroke-width: 6px;\n      stroke-opacity: .65; }\n  .ml-app .ml-explorer-chart {\n    overflow: hidden; }\n  .ml-app .ml-explorer-chart-content-wrapper {\n    height: 215px; }\n  .ml-app .ml-explorer-chart-axis-emphasis {\n    font-weight: bold; }\n  .ml-app .explorer-charts ml-explorer-charts-container .row {\n    padding: 10px; }\n  .ml-app .explorer-charts ml-explorer-charts-container label {\n    font-size: 12px; }\n  .ml-app .explorer-charts ml-explorer-charts-container select {\n    font-size: 14px;\n    font-style: 400; }\n  .ml-app .explorer-charts ml-explorer-charts-container .chart-controls label {\n    padding: 0 0 10px 0; }\n  .ml-app .explorer-charts ml-explorer-charts-container .no-results-item {\n    text-align: center;\n    padding-top: 10px; }\n  .ml-app .explorer-charts ml-explorer-charts-container .ml-anomaly-interim-result {\n    font-style: italic;\n    padding-bottom: 3px; }\n  .ml-app .explorer-charts ml-explorer-charts-container .ml-tablerow-expanded {\n    width: 100%;\n    padding: 5px 20px;\n    overflow: hidden;\n    font-size: 12px; }\n    .ml-app .explorer-charts ml-explorer-charts-container .ml-tablerow-expanded td {\n      padding: 0 0 2px 0; }\n    .ml-app .explorer-charts ml-explorer-charts-container .ml-tablerow-expanded table tr > td:first-child {\n      padding-left: 2px;\n      vertical-align: top; }\n    .ml-app .explorer-charts ml-explorer-charts-container .ml-tablerow-expanded td:first-child {\n      width: 140px; }\n    .ml-app .explorer-charts ml-explorer-charts-container .ml-tablerow-expanded td:nth-child(2) {\n      padding-left: 5px; }\n  .ml-app .ml-explorer-chart-icons {\n    float: right;\n    padding-left: 5px;\n    /* counter-margin for EuiButtonEmpty\'s padding */\n    margin: 2px -8px 0 0; }\n  .ml-app .ml-edit-url-form .url-label {\n    width: 250px; }\n  .ml-app .ml-edit-url-form .url-link-to-radio .euiRadio {\n    display: inline-block;\n    padding-right: 24px; }\n  .ml-app .ml-edit-url-form .url-time-range {\n    width: 150px; }\n  .ml-app .new-job-button-container {\n    float: right; }\n  .ml-app .edit-custom-url-panel .close-editor-button {\n    position: relative;\n    float: right;\n    top: -4px;\n    right: 0; }\n  .ml-app .tab-contents {\n    margin: -8px;\n    padding: 8px;\n    background-color: #1D1E24; }\n    .ml-app .tab-contents .col-md-6:nth-child(1) {\n      padding-right: 7px; }\n    .ml-app .tab-contents .col-md-6:nth-child(2) {\n      padding-left: 7px; }\n    .ml-app .tab-contents .job-section {\n      overflow: auto;\n      padding: 5px 15px;\n      background-color: #25262E;\n      border: 1px solid #343741;\n      border-radius: 4px;\n      margin: 4px 0; }\n      .ml-app .tab-contents .job-section .euiTable {\n        background-color: transparent; }\n        .ml-app .tab-contents .job-section .euiTable .euiTableRow:first-child .euiTableRowCell {\n          border-top: 0; }\n        .ml-app .tab-contents .job-section .euiTable .euiTableRow:last-child .euiTableRowCell {\n          border-bottom: 0; }\n        .ml-app .tab-contents .job-section .euiTable .euiTableRow .euiTableRowCell {\n          vertical-align: top;\n          border-bottom: 1px solid #343741; }\n          .ml-app .tab-contents .job-section .euiTable .euiTableRow .euiTableRowCell .euiTableCellContent__text {\n            word-wrap: break-word; }\n        .ml-app .tab-contents .job-section .euiTable .euiTableRow:hover {\n          background-color: inherit; }\n      .ml-app .tab-contents .job-section .job-item {\n        font-size: 12px; }\n      .ml-app .tab-contents .job-section .job-item.header {\n        font-weight: bold; }\n    .ml-app .tab-contents .json-textarea {\n      height: 500px; }\n  .ml-app .job-messages-table {\n    max-height: 500px;\n    overflow: auto;\n    text-align: left; }\n    .ml-app .job-messages-table tr:last-child td {\n      border-bottom: none; }\n    .ml-app .job-messages-table .euiTableRowCell {\n      background-color: #1D1E24; }\n  .ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .group-item {\n    padding: 8px 16px; }\n  .ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .inline-group {\n    border: 1px solid #1D1E24;\n    border-radius: 4px; }\n  .ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .euiFilterSelectItem:hover, .ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .euiFilterSelectItem:focus {\n    text-decoration: none; }\n    .ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .euiFilterSelectItem:hover .inline-group, .ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .euiFilterSelectItem:focus .inline-group {\n      border: 1px solid #98A2B3;\n      box-shadow: 0 1px 2px #535966; }\n  .ml-app .inline-group {\n    font-size: 12px;\n    background-color: #343741;\n    padding: 2px 5px;\n    border-radius: 2px;\n    display: inline-block;\n    margin: 0 3px;\n    color: #1D1E24;\n    vertical-align: text-top; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th {\n    text-align: left;\n    white-space: normal; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(2) {\n    width: 34px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(3) {\n    width: auto; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(4) {\n    width: 20px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(5) {\n    width: auto; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(6) {\n    width: 100px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(7) {\n    width: 85px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(8) {\n    width: 80px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(9) {\n    width: 80px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(10) {\n    width: 150px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(11) {\n    width: 80px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(12) {\n    width: 30px; }\n    .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(12) .euiTableCellContent__text {\n      display: none; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody td:nth-child(4) .euiTableCellContent {\n    padding: 0; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody td:nth-child(10) {\n    white-space: nowrap; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody .euiTableCellContent {\n    animation: unset; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody .euiTableRow.euiTableRow-isExpandedRow > td > div > .euiTableCellContent__text {\n    width: 100%; }\n    .ml-app .jobs-list-table > div > .euiTable > tbody .euiTableRow.euiTableRow-isExpandedRow > td > div > .euiTableCellContent__text .euiTableRowCell {\n      background-color: inherit; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody .euiTableRow > .euiTableRowCell > .euiTableCellContent > .euiTableCellContent__hoverItem {\n    opacity: 1; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody .euiContextMenuPanel .euiContextMenuItem {\n    white-space: nowrap; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody .euiContextMenuPanel .euiContextMenuItem:last-child:not(.euiContextMenuItem-isDisabled) {\n    color: #F66; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody .results-button {\n    margin-right: 4px;\n    width: 18px; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody .euiContextMenuItem .euiIcon {\n    margin-right: 4px; }\n  .ml-app .jobs-list-table > div > .euiTable .actions-border {\n    height: 20px;\n    border-right: 1px solid #343741;\n    width: 1px;\n    display: inline-block;\n    vertical-align: middle;\n    margin: 0 4px; }\n  .ml-app .jobs-list-table > div > .euiTable .job-description {\n    display: inline-block; }\n  .ml-app .jobs-list-table > div > .euiTable .job-loading-spinner {\n    text-align: center; }\n  .ml-app .jobs-list-table.jobs-selected .results-button {\n    color: #343741;\n    pointer-events: none; }\n  .ml-app .actions-bar {\n    min-height: 60px;\n    display: flex;\n    align-items: center; }\n  .ml-app .job-management {\n    padding: 20px; }\n  .ml-app .multi-select-actions {\n    padding-right: 8px;\n    padding-bottom: 12px;\n    display: inline-block;\n    white-space: nowrap; }\n    .ml-app .multi-select-actions .actions-border, .ml-app .multi-select-actions .actions-border-large {\n      height: 20px;\n      border-right: 1px solid #343741;\n      width: 1px;\n      display: inline-block;\n      vertical-align: middle;\n      margin: 0 5px; }\n    .ml-app .multi-select-actions .actions-border-large {\n      height: 35px;\n      margin: 0 15px;\n      margin-top: -5px; }\n    .ml-app .multi-select-actions .results-button {\n      margin-right: 5px; }\n    .ml-app .multi-select-actions .euiContextMenuPanel .euiContextMenuItem__text {\n      white-space: nowrap; }\n    .ml-app .multi-select-actions .euiContextMenuPanel .euiContextMenuItem:last-child:not(.euiContextMenuItem-isDisabled) {\n      color: #F66; }\n  .ml-app .multi-select-actions-no-display {\n    display: none; }\n  .ml-app .group-selector {\n    max-width: 300px; }\n    .ml-app .group-selector .euiPopoverTitle {\n      margin-bottom: 8px !important; }\n  .ml-app .group-list {\n    max-height: 350px;\n    overflow: auto; }\n    .ml-app .group-list .group-item {\n      line-height: 18px;\n      padding: 6px 0;\n      border-bottom: 1px solid #343741;\n      cursor: pointer; }\n      .ml-app .group-list .group-item:focus {\n        background-color: #EEF6F9;\n        box-shadow: none; }\n      .ml-app .group-list .group-item .check {\n        width: 20px;\n        display: inline-block; }\n      .ml-app .group-list .group-item .inline-group {\n        border: 1px solid #1D1E24;\n        border-radius: 4px; }\n    .ml-app .group-list .group-item:hover .inline-group {\n      border: 1px solid #98A2B3;\n      box-shadow: 0 1px 2px #535966; }\n    .ml-app .group-list .group-item:last-child {\n      margin-bottom: 0;\n      border-bottom: none; }\n  .ml-app .new-group-input {\n    padding-bottom: 0; }\n  .ml-app .ml-custom-urls-selection > .euiFlexGroup > .euiFlexItem:first-child {\n    max-width: 388px; }\n  .ml-app .ml-custom-urls-selection > .euiFlexGroup > .euiFlexItem:last-child {\n    flex-basis: 50%; }\n  .ml-app .mlOverviewPanel {\n    padding-top: 0; }\n  .ml-app .mlOverviewPanel__isLoading {\n    text-align: center;\n    padding: 10%; }\n  .ml-app .mlOverviewPanel__buttons {\n    float: right; }\n  .ml-app .mlOverviewPanel__spinner {\n    display: inline-block; }\n  .ml-app .mlOverviewPanel__refreshButton {\n    padding-right: 12px; }\n  .ml-app .mlOverviewPanel__statsBar {\n    margin-top: 0;\n    margin-right: 0; }\n  .ml-app .mlSettingsPage .mlSettingsPage__header {\n    width: 1200px;\n    margin-left: auto;\n    margin-right: auto; }\n  .ml-app .mlSettingsPage .mlSettingsPage__content {\n    width: 1200px;\n    margin-top: 16px;\n    margin-bottom: 16px; }\n  .ml-app .ml-list-filter-lists .ml-list-filter-lists-content {\n    max-width: 1100px;\n    margin-top: 16px;\n    margin-bottom: 16px; }\n  .ml-app .ml-list-filter-lists .ml-filter-lists-table th:last-child, .ml-app .ml-list-filter-lists .ml-filter-lists-table td:last-child {\n    width: 70px; }\n  .ml-app .ml-edit-filter-lists .ml-edit-filter-lists-content {\n    max-width: 1100px;\n    width: 100%;\n    margin-top: 16px;\n    margin-bottom: 16px; }\n  .ml-app .ml-edit-filter-lists .ml-filter-list-usage > div {\n    display: inline; }\n  .ml-app .ml-edit-filter-lists .ml-filter-list-usage .euiButtonEmpty.euiButtonEmpty--small {\n    padding-bottom: 4px; }\n  .ml-app .ml-edit-filter-lists .ml-filter-list-usage .euiButtonEmpty .euiButtonEmpty__content {\n    padding: 0 4px; }\n  .ml-app .ml-add-filter-item-popover .euiFormRow {\n    width: 300px;\n    padding-bottom: 4px; }\n  .ml-app .ml-filter-list-usage-popover li {\n    line-height: 24px; }\n  .ml-app .mlCalendarEditForm .mlCalendarEditForm__content {\n    max-width: 1200px;\n    width: 100%;\n    margin-top: 16px;\n    margin-bottom: 16px; }\n  .ml-app .mlCalendarList .mlCalendarList__content {\n    max-width: 1200px;\n    margin-top: 16px;\n    margin-bottom: 16px; }\n  .ml-app .ml-time-series-explorer {\n    color: #98A2B3; }\n    .ml-app .ml-time-series-explorer .no-results-container {\n      text-align: center;\n      font-size: 20px;\n      padding-top: 60px; }\n      .ml-app .ml-time-series-explorer .no-results-container .no-results {\n        background-color: #08334a;\n        padding: 16px;\n        border-radius: 4px;\n        display: inline-block; }\n        .ml-app .ml-time-series-explorer .no-results-container .no-results i {\n          color: #1BA9F5;\n          margin-right: 4px; }\n        .ml-app .ml-time-series-explorer .no-results-container .no-results div:nth-child(2) {\n          margin-top: 8px;\n          font-size: 12px; }\n    .ml-app .ml-time-series-explorer .results-container .panel-title {\n      font-size: 18px;\n      font-weight: 400;\n      color: #98A2B3; }\n    .ml-app .ml-time-series-explorer .results-container .entity-count-text {\n      color: #7DE2D1;\n      font-size: 14px; }\n    .ml-app .ml-time-series-explorer .forecast-controls {\n      float: right; }\n    .ml-app .ml-time-series-explorer .ml-anomalies-controls {\n      padding-top: 4px; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart svg {\n      font-size: 12px;\n      font-family: "Inter UI", -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .axis path,\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .axis line {\n      fill: none;\n      stroke: #343741;\n      shape-rendering: crispEdges;\n      pointer-events: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .axis text {\n      fill: #DFE5EF; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .axis .tick line {\n      stroke: rgba(0, 0, 0, 0.1); }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .chart-border {\n      stroke: #343741;\n      fill: none;\n      stroke-width: 1;\n      shape-rendering: crispEdges; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .chart-border-highlight {\n      stroke: #98A2B3;\n      stroke-width: 2; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .chart-border-highlight:hover {\n      opacity: 1; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .area {\n      stroke-width: 1; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .area.bounds {\n      fill: rgba(50, 167, 194, 0.25);\n      pointer-events: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .values-line {\n      fill: none;\n      stroke: #32A7C2;\n      stroke-width: 2;\n      pointer-events: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .values-line.forecast {\n      stroke: #CCA300;\n      pointer-events: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .values-dots circle {\n      fill: #32A7C2;\n      stroke-width: 0; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .hidden {\n      visibility: hidden; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .area.forecast {\n      fill: rgba(204, 163, 0, 0.25);\n      pointer-events: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .metric-value {\n      opacity: 1;\n      fill: transparent;\n      stroke: #32A7C2;\n      stroke-width: 0; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker {\n      stroke-width: 1px;\n      stroke: #AAAAAA; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.critical {\n      fill: #FE5050; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.major {\n      fill: #FBA740; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.minor {\n      fill: #FDEC25; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.warning {\n      fill: #8BC8FB; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.low {\n      fill: #D2E9F7; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .metric-value:hover,\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker:hover,\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.highlighted {\n      stroke-width: 6px;\n      stroke-opacity: .65;\n      stroke: #32A7C2; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart rect.scheduled-event-marker {\n      stroke-width: 1px;\n      stroke: #535966;\n      fill: #343741;\n      pointer-events: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .forecast .metric-value,\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .forecast .metric-value:hover {\n      stroke: #CCA300; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .x-axis-background line {\n      fill: none;\n      shape-rendering: crispEdges;\n      stroke: #25262E; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .x-axis-background rect {\n      fill: #25262E; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .focus-zoom {\n      fill: #98A2B3; }\n      .ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .focus-zoom a text {\n        fill: #1BA9F5;\n        cursor: pointer; }\n      .ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .focus-zoom a:hover,\n      .ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .focus-zoom a:active,\n      .ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .focus-zoom a:focus {\n        text-decoration: underline; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .x.axis path {\n      display: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .axis text {\n      font-size: 10px;\n      fill: #DFE5EF; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .area.context {\n      fill: rgba(50, 167, 194, 0.25); }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .values-line {\n      stroke-width: 1; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .area.context.forecast {\n      fill: rgba(204, 163, 0, 0.25); }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .mask polygon {\n      fill-opacity: .1; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .mask .area.bounds {\n      fill: #D6D6D6; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .mask .values-line {\n      stroke-width: 1;\n      stroke: #B8B8B8; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .mask .values-dots circle {\n      fill: #B8B8B8;\n      stroke-width: 0; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .swimlane .axis text {\n      display: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .swimlane rect.swimlane-cell-hidden {\n      display: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .brush .extent {\n      fill-opacity: 0;\n      shape-rendering: crispEdges;\n      stroke: #98A2B3;\n      stroke-width: 2;\n      cursor: move; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .brush .extent:hover {\n      opacity: 1; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .top-border {\n      fill: #1D1E24; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart foreignObject.brush-handle {\n      pointer-events: none;\n      padding-top: 1px; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart div.brush-handle-inner {\n      border: 1px solid #98A2B3;\n      background-color: #343741;\n      height: 70px;\n      width: 10px;\n      text-align: center;\n      cursor: ew-resize;\n      margin-top: 9px;\n      font-size: 14px;\n      fill: #98A2B3; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart div.brush-handle-inner-left {\n      border-radius: 4px 0 0 4px; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart div.brush-handle-inner-right {\n      border-radius: 0 4px 4px 0; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart rect.brush-handle {\n      stroke-width: 1;\n      stroke: #98A2B3;\n      fill: #343741;\n      pointer-events: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart rect.brush-handle:hover {\n      opacity: 1; }\n  .ml-app .mlTimeSeriesExplorerProgress {\n    background-color: #1D1E24; }\n    .ml-app .mlTimeSeriesExplorerProgress::-moz-progress-bar, .ml-app .mlTimeSeriesExplorerProgress::-webkit-progress-bar {\n      background-color: #1D1E24; }\n  .ml-app .mlAnnotationBrush .extent {\n    stroke: #343741;\n    stroke-width: 2px;\n    stroke-dasharray: 2 2;\n    fill: #25262E;\n    shape-rendering: geometricPrecision; }\n  .ml-app .mlAnnotationRect {\n    stroke: #FFF;\n    stroke-width: 2px;\n    stroke-opacity: 0.2;\n    transition: stroke-opacity 150ms;\n    fill: #FFF;\n    fill-opacity: 0.05;\n    transition: fill-opacity 150ms;\n    shape-rendering: geometricPrecision; }\n  .ml-app .mlAnnotationRect-isHighlight {\n    stroke-opacity: 0.4;\n    transition: stroke-opacity 150ms;\n    fill-opacity: 0.1;\n    transition: fill-opacity 150ms; }\n  .ml-app .mlAnnotationRect-isBlur {\n    stroke-opacity: 0.1;\n    transition: stroke-opacity 150ms;\n    fill-opacity: 0.025;\n    transition: fill-opacity 150ms; }\n  .ml-app .mlAnnotationText {\n    text-anchor: middle;\n    font-size: 12px;\n    font-family: "Inter UI", -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";\n    font-weight: 500;\n    fill: #FFF;\n    transition: fill 150ms; }\n  .ml-app .mlAnnotationText-isBlur {\n    fill: #535966;\n    transition: fill 150ms; }\n  .ml-app .mlAnnotationTextRect {\n    fill: #343741;\n    transition: fill 150ms; }\n  .ml-app .mlAnnotationTextRect-isBlur {\n    fill: #25262E;\n    transition: fill 150ms; }\n  .ml-app .mlAnnotationHidden {\n    display: none; }\n  .ml-app .mlContextAnnotationRect {\n    stroke: #FFF;\n    stroke-width: 2px;\n    stroke-opacity: 0.2;\n    transition: stroke-opacity 150ms;\n    fill: #FFF;\n    fill-opacity: 0.05;\n    transition: fill-opacity 150ms;\n    shape-rendering: geometricPrecision; }\n  .ml-app .mlContextAnnotationRect-isBlur {\n    stroke-opacity: 0.1;\n    transition: stroke-opacity 150ms;\n    fill-opacity: 0.025;\n    transition: fill-opacity 150ms; }\n  .ml-app .euiDescriptionList.euiDescriptionList--column.ml-annotation-description-list .euiDescriptionList__title {\n    flex-basis: 30%; }\n  .ml-app .euiDescriptionList.euiDescriptionList--column.ml-annotation-description-list .euiDescriptionList__description {\n    flex-basis: 70%; }\n  .ml-app .euiDescriptionList.euiDescriptionList--column.ml-annotation-description-list > * {\n    margin-top: 4px; }\n  .ml-app .ml-anomalies-table .ml-icon-severity-critical,\n  .ml-app .ml-anomalies-table .ml-icon-severity-major,\n  .ml-app .ml-anomalies-table .ml-icon-severity-minor,\n  .ml-app .ml-anomalies-table .ml-icon-severity-warning,\n  .ml-app .ml-anomalies-table .ml-icon-severity-unknown {\n    color: inherit;\n    text-shadow: none; }\n  .ml-app .ml-anomalies-table .ml-icon-severity-critical .euiIcon {\n    fill: #FE5050; }\n  .ml-app .ml-anomalies-table .ml-icon-severity-major .euiIcon {\n    fill: #FBA740; }\n  .ml-app .ml-anomalies-table .ml-icon-severity-minor .euiIcon {\n    fill: #FDEC25; }\n  .ml-app .ml-anomalies-table .ml-icon-severity-warning .euiIcon {\n    fill: #8BC8FB; }\n  .ml-app .ml-anomalies-table .ml-icon-severity-unknown .euiIcon {\n    fill: #98A2B3; }\n  .ml-app .ml-anomalies-table tr th:first-child,\n  .ml-app .ml-anomalies-table tr td:first-child {\n    width: 32px; }\n  .ml-app .ml-anomalies-table .euiTableCellContent .euiHealth {\n    font-size: inherit; }\n  .ml-app .ml-anomalies-table .euiTableCellContent .detector-rules-icon {\n    margin-left: 4px;\n    opacity: .5; }\n  .ml-app .ml-anomalies-table .euiContextMenuItem {\n    min-width: 150px; }\n  .ml-app .ml-anomalies-table .mlAnomalyCategoryExamples__header {\n    display: inline; }\n  .ml-app .ml-anomalies-table .mlAnomalyCategoryExamples__link {\n    width: 100%; }\n  .ml-app .ml-anomalies-table .category-example {\n    display: block;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis; }\n  .ml-app .ml-anomalies-table .mlAnomalyCategoryExamples {\n    padding: 24px; }\n  .ml-app .ml-anomalies-table .mlAnomalyCategoryExamples__item {\n    display: block;\n    white-space: wrap;\n    font-family: "Roboto Mono", Consolas, Menlo, Courier, monospace; }\n  .ml-app .ml-anomalies-table .interim-result {\n    font-style: italic; }\n  .ml-app .ml-anomalies-table .ml-anomalies-table-details {\n    padding: 4px 32px;\n    max-height: 1000px;\n    overflow-y: auto; }\n    .ml-app .ml-anomalies-table .ml-anomalies-table-details .anomaly-description-list .euiDescriptionList__title {\n      margin-top: 0;\n      flex-basis: 15%;\n      font-size: inherit;\n      line-height: 1.5rem;\n      max-width: 100%;\n      overflow: hidden !important;\n      text-overflow: ellipsis !important;\n      white-space: nowrap !important;\n      word-wrap: normal !important; }\n    .ml-app .ml-anomalies-table .ml-anomalies-table-details .anomaly-description-list .euiDescriptionList__description {\n      margin-top: 0;\n      flex-basis: 85%;\n      font-size: inherit;\n      line-height: 1.5rem; }\n  .ml-app .mlColorRangeLegend text {\n    font-size: 10px;\n    font-size: 0.625rem;\n    fill: #98A2B3; }\n  .ml-app .mlColorRangeLegend .axis path {\n    fill: none;\n    stroke: none; }\n  .ml-app .mlColorRangeLegend .axis line {\n    fill: none;\n    stroke: #535966;\n    shape-rendering: crispEdges; }\n  .ml-app .ml-table-controls label {\n    font-size: 12px;\n    padding: 0 0 4px 4px; }\n  .ml-app .ml-table-controls .ml-table-controls-element {\n    display: inline-block;\n    padding-left: 16px; }\n  .ml-app .ml-table-controls select {\n    font-size: 12px;\n    font-style: normal; }\n  .ml-app .ml-select-severity .euiFormControlLayoutClearButton {\n    display: none; }\n  .ml-app .field-value-short {\n    max-width: 100%;\n    overflow: hidden !important;\n    text-overflow: ellipsis !important;\n    white-space: nowrap !important;\n    word-wrap: normal !important;\n    display: inline-block;\n    vertical-align: bottom; }\n  .ml-app .field-value-long {\n    overflow-wrap: break-word; }\n  .ml-app .filter-button {\n    opacity: .3;\n    min-width: 14px;\n    transform: translateY(-1px); }\n    .ml-app .filter-button .euiIcon {\n      width: 12px;\n      height: 12px; }\n  .ml-app .filter-button:hover {\n    opacity: 1; }\n  .ml-app .ml-field-title-bar {\n    font-size: 18px;\n    font-size: 1.125rem;\n    line-height: 1.5;\n    font-family: Roboto Mono, serif;\n    font-style: normal;\n    font-weight: bold;\n    font-size: 14px;\n    border-radius: 4px 4px 0 0;\n    padding: 4px;\n    margin: -16px -16px 0 -16px;\n    border-top: 3px solid;\n    text-align: center; }\n    .ml-app .ml-field-title-bar .field-type-icon {\n      vertical-align: middle;\n      margin-bottom: -4px;\n      display: inline-block; }\n    .ml-app .ml-field-title-bar .field-name {\n      max-width: 100%;\n      overflow: hidden !important;\n      text-overflow: ellipsis !important;\n      white-space: nowrap !important;\n      word-wrap: normal !important;\n      vertical-align: middle;\n      padding-right: 8px;\n      max-width: 290px;\n      display: inline-block;\n      margin-left: 8px; }\n  .ml-app .ml-influencers-list {\n    line-height: 1.45; }\n    .ml-app .ml-influencers-list .field-label {\n      font-size: 12px;\n      text-align: left;\n      max-height: 14px;\n      max-width: calc(100% - 102px); }\n      .ml-app .ml-influencers-list .field-label .field-value {\n        max-width: 100%;\n        overflow: hidden !important;\n        text-overflow: ellipsis !important;\n        white-space: nowrap !important;\n        word-wrap: normal !important;\n        display: inline-block;\n        vertical-align: bottom; }\n    .ml-app .ml-influencers-list .progress {\n      display: inline-block;\n      width: calc(100% - 34px);\n      height: 22px;\n      min-width: 70px;\n      margin-bottom: 0;\n      color: #98A2B3;\n      background-color: transparent; }\n      .ml-app .ml-influencers-list .progress .progress-bar-holder {\n        width: calc(100% - 28px); }\n      .ml-app .ml-influencers-list .progress .progress-bar {\n        height: 2px;\n        margin-top: 12px;\n        text-align: right;\n        line-height: 18px;\n        display: inline-block;\n        transition: none; }\n    .ml-app .ml-influencers-list .progress.critical .progress-bar {\n      background-color: #FE5050; }\n    .ml-app .ml-influencers-list .progress.critical .score-label {\n      border-color: #FE5050; }\n    .ml-app .ml-influencers-list .progress.major .progress-bar {\n      background-color: #FBA740; }\n    .ml-app .ml-influencers-list .progress.major .score-label {\n      border-color: #FBA740; }\n    .ml-app .ml-influencers-list .progress.minor .progress-bar {\n      background-color: #FDEC25; }\n    .ml-app .ml-influencers-list .progress.minor .score-label {\n      border-color: #FDEC25; }\n    .ml-app .ml-influencers-list .progress.warning .progress-bar {\n      background-color: #8BC8FB; }\n    .ml-app .ml-influencers-list .progress.warning .score-label {\n      border-color: #8BC8FB; }\n    .ml-app .ml-influencers-list .score-label {\n      text-align: center;\n      line-height: 14px;\n      white-space: nowrap;\n      font-size: 12px;\n      display: inline;\n      margin-left: 4px; }\n    .ml-app .ml-influencers-list .total-score-label {\n      width: 32px;\n      vertical-align: top;\n      text-align: center;\n      color: #98A2B3;\n      font-size: 11px;\n      line-height: 14px;\n      border-radius: 4px;\n      padding: 2px;\n      margin-top: 3px;\n      display: inline-block;\n      border: 1px solid #343741; }\n  .ml-app .ml-influencers-list-tooltip {\n    word-break: break-all; }\n  .ml-app .ml-items-grid-page-size-menu {\n    width: 140px; }\n  .ml-app .mlJobSelectorBar {\n    padding: 8px; }\n  .ml-app .mlJobSelectorFlyoutBody > .euiFlyoutBody__overflow {\n    padding-top: 8px; }\n  .ml-app .mlJobSelector__ganttBar {\n    background-color: #79ADDA;\n    height: 12px;\n    border-radius: 2px; }\n  .ml-app .mlJobSelector__ganttBarBackEdge {\n    height: 16px;\n    border-left: 1px solid #D6D6D6;\n    border-right: 1px solid #D6D6D6;\n    margin-bottom: -14px;\n    padding-top: 8px; }\n  .ml-app .mlJobSelector__ganttBarDashed {\n    height: 1px;\n    border-top: 1px dashed #D6D6D6; }\n  .ml-app .mlJobSelector__ganttBarRunning {\n    background-image: linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);\n    background-size: 40px 40px;\n    animation: progress-bar-stripes 2s linear infinite; }\n  .ml-app .ml-loading-indicator {\n    text-align: center;\n    font-size: 17px;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center; }\n  .ml-app .mlNavigationMenu {\n    padding: 0 12px;\n    border-bottom: 1px solid #343741;\n    background-color: #1D1E24; }\n  .ml-app .ml-rule-editor-flyout {\n    font-size: 14px; }\n    .ml-app .ml-rule-editor-flyout .select-rule-action .rule-detector-description-list {\n      padding-left: 16px; }\n    .ml-app .ml-rule-editor-flyout .select-rule-action-panel {\n      padding: 8px 0; }\n      .ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__title {\n        flex-basis: 15%;\n        padding: 0 16px; }\n      .ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__description {\n        flex-basis: 85%; }\n      .ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__title:nth-child(1),\n      .ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__description:nth-child(2) {\n        color: #DFE5EF;\n        font-weight: 700;\n        border-bottom: 1px solid #343741;\n        padding-bottom: 12px; }\n      .ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__title:nth-child(3),\n      .ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__description:nth-child(4) {\n        padding-top: 8px; }\n      .ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList.euiDescriptionList--column > * {\n        margin-top: 4px; }\n    .ml-app .ml-rule-editor-flyout .scope-enable-checkbox .euiCheckbox__input[disabled] ~ .euiCheckbox__label {\n      color: inherit; }\n    .ml-app .ml-rule-editor-flyout .scope-field-checkbox {\n      margin-right: 2px; }\n      .ml-app .ml-rule-editor-flyout .scope-field-checkbox .euiCheckbox {\n        margin-top: 4px; }\n    .ml-app .ml-rule-editor-flyout .scope-field-button {\n      pointer-events: none;\n      border-bottom: none; }\n    .ml-app .ml-rule-editor-flyout .scope-edit-filter-link {\n      line-height: 32px;\n      font-size: 12px; }\n    .ml-app .ml-rule-editor-flyout .condition-edit-value-field {\n      width: 170px;\n      height: 28px;\n      margin: 0 2px; }\n      .ml-app .ml-rule-editor-flyout .condition-edit-value-field input {\n        height: 28px; }\n    .ml-app .ml-rule-editor-flyout .euiExpressionButton.disabled {\n      pointer-events: none; }\n      .ml-app .ml-rule-editor-flyout .euiExpressionButton.disabled .euiExpressionButton__value,\n      .ml-app .ml-rule-editor-flyout .euiExpressionButton.disabled .euiExpressionButton__description {\n        color: #343741; }\n    .ml-app .ml-rule-editor-flyout .text-highlight {\n      font-weight: 700; }\n  .ml-app .euiDescriptionList.euiDescriptionList--column.rule-detector-description-list .euiDescriptionList__title {\n    flex-basis: 15%; }\n  .ml-app .euiDescriptionList.euiDescriptionList--column.rule-detector-description-list .euiDescriptionList__description {\n    flex-basis: 85%; }\n  .ml-app .euiDescriptionList.euiDescriptionList--column.rule-detector-description-list > * {\n    margin-top: 4px; }\n  .ml-app .stat {\n    margin-right: 8px; }\n  .ml-app .mlStatsBar {\n    height: 42px;\n    padding: 14px;\n    background-color: #25262E; }\n  .ml-app .mlEmbeddedMapContent {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    flex: 1 1 100%;\n    z-index: 1;\n    min-height: 0; }\n  .ml-app .tab-datavisualizer_index_select,\n  .ml-app .tab-timeseriesexplorer,\n  .ml-app .tab-explorer {\n    background-color: #1D1E24; }\n  .ml-app .button-wrapper {\n    display: inline; }\n  .ml-app .button-wrapper.disabled .kuiButton[disabled] {\n    pointer-events: none; }\n  .ml-app .button-wrapper.disabled {\n    cursor: not-allowed; }\n  .ml-app .clear, .ml-app .clearfix {\n    clear: both; }\n  .ml-app .mlDisableAntiAliasing {\n    -webkit-font-smoothing: none; }\n    .ml-app .mlDisableAntiAliasing * canvas {\n      image-rendering: pixelated; }\n',""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(426);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,'.ml-app {\n  /*\n  Resets the badge\'s default strong font-weight so it\'s possible\n  to put custom emphasis inside the badge only on a part of it.\n  Used in the Explorer Chart label badge to display an entity\'s\n  field_name as `normal` and field_value as `strong`.\n*/\n  /* wrapper class for the top right alert icon and view button */\n  /* Hides the progress bar\'s background so it doesn\'t look like it increases the thickness\n   of the horizontal bar below the tab menu elements in its inactive state. */\n  /* Overrides for d3/svg default styles */ }\n  .ml-app .ml-icon-severity-critical,\n  .ml-app .ml-icon-severity-major,\n  .ml-app .ml-icon-severity-minor,\n  .ml-app .ml-icon-severity-warning,\n  .ml-app .ml-icon-severity-unknown {\n    text-shadow: 1px 1px 1px #D3DAE6; }\n  .ml-app .ml-icon-severity-critical {\n    color: #cf4141; }\n  .ml-app .ml-icon-severity-major {\n    color: #9e6929; }\n  .ml-app .ml-icon-severity-minor {\n    color: #7c7313; }\n  .ml-app .ml-icon-severity-warning {\n    color: #537896; }\n  .ml-app .ml-icon-severity-unknown {\n    color: #69707D; }\n  .ml-app .mlDataFrameAnalyticsRegression__evaluateStat {\n    padding-top: 24px; }\n  .ml-app .mlJobMapLegend__container {\n    background-color: \'#FFFFFF\'; }\n  .ml-app .mlJobMapLegend__indexPattern {\n    height: 12px;\n    width: 12px;\n    background-color: #FFF;\n    border: 2px solid #D36086;\n    transform: rotate(45deg);\n    display: \'inline-block\'; }\n  .ml-app .mlJobMapLegend__transform {\n    height: 12px;\n    width: 12px;\n    background-color: #FFF;\n    border: 2px solid #6092C0;\n    display: \'inline-block\'; }\n  .ml-app .mlJobMapLegend__analytics {\n    height: 12px;\n    width: 12px;\n    background-color: #FFF;\n    border: 2px solid #54B399;\n    border-radius: 50%;\n    display: \'inline-block\'; }\n  .ml-app .mlJobMapLegend__sourceNode {\n    height: 12px;\n    width: 12px;\n    background-color: #F5A700;\n    border: 1px solid #D3DAE6;\n    border-radius: 4px;\n    display: \'inline-block\'; }\n  .ml-app .mlAnalyticsTable .euiTableRow-isExpandedRow .euiTableCellContent {\n    animation: none !important; }\n    .ml-app .mlAnalyticsTable .euiTableRow-isExpandedRow .euiTableCellContent .euiTableCellContent__text {\n      width: 100%; }\n  .ml-app .mlAnalyticsTable .euiIcon-isLoaded {\n    animation: none !important; }\n  .ml-app .mlTaskStateBadge, .ml-app .mlTaskModeBadge {\n    max-width: 100px; }\n  .ml-app .dataFrameAnalyticsCreateSearchDialog {\n    width: 720px;\n    min-height: 600px; }\n  .ml-app .dfAnalyticsCreationWizard__card {\n    width: 300px; }\n  .ml-app .file-datavisualizer-file-picker {\n    max-width: inherit; }\n    .ml-app .file-datavisualizer-file-picker .euiFilePicker__prompt {\n      background-color: #FFF;\n      box-shadow: none; }\n      .ml-app .file-datavisualizer-file-picker .euiFilePicker__prompt .euiFilePicker__icon {\n        width: 40px;\n        height: 40px; }\n  .ml-app .results .euiDescriptionList dd, .ml-app .results .euiDescriptionList dt {\n    margin-top: 5px; }\n  .ml-app .results .euiDescriptionList dd:nth-child(1), .ml-app .results .euiDescriptionList dt:nth-child(1) {\n    margin-top: 0; }\n  .ml-app .analysis-summary-list.euiDescriptionList .euiDescriptionList__title {\n    flex-basis: 15%; }\n  .ml-app .analysis-summary-list.euiDescriptionList .euiDescriptionList__description {\n    flex-basis: 85%; }\n  .ml-app .file-datavisualizer-about-panel__icon {\n    width: 96px;\n    height: 96px;\n    margin-left: 32px;\n    margin-right: 24px; }\n  .ml-app .euiFlexItem.file-datavisualizer-about-panel__doc-icon {\n    margin-left: 32px;\n    margin-right: 4px;\n    margin-top: 16px; }\n  .ml-app .import-summary-list.euiDescriptionList .euiDescriptionList__title {\n    flex-basis: 15%; }\n  .ml-app .import-summary-list.euiDescriptionList .euiDescriptionList__description {\n    flex-basis: 85%; }\n  .ml-app .failure-list {\n    max-height: 200px;\n    overflow-y: auto; }\n    .ml-app .failure-list .error-message {\n      color: #BD271E; }\n  .ml-app .ml-experimental-badge.euiBetaBadge {\n    font-size: 10px;\n    vertical-align: middle;\n    margin-bottom: 5px;\n    padding: 0 20px;\n    line-height: 20px; }\n  .ml-app .mlFieldDataTopValuesContainer {\n    padding-top: 4px; }\n  .ml-app .mlTopValuesValueLabelContainer {\n    margin-right: 12px; }\n    .ml-app .mlTopValuesValueLabelContainer.mlTopValuesValueLabelContainer--small {\n      width: 70px; }\n    .ml-app .mlTopValuesValueLabelContainer.mlTopValuesValueLabelContainer--large {\n      width: 200px; }\n  .ml-app .mlTopValuesPercentLabelContainer {\n    margin-left: 12px;\n    width: 70px; }\n  .ml-app .mlMetricDistributionChartContainer {\n    padding-top: 4px;\n    width: 100%; }\n  @media only screen and (max-width: 574px) {\n    .ml-app .mlDataVisualizerExpandedRow {\n      flex-direction: column; } }\n  @media only screen and (min-width: 575px) and (max-width: 767px) {\n    .ml-app .mlDataVisualizerExpandedRow {\n      flex-direction: column; } }\n  @media only screen and (min-width: 768px) and (max-width: 991px) {\n    .ml-app .mlDataVisualizerExpandedRow {\n      flex-direction: column; } }\n  .ml-app .mlDataVisualizerFieldCountContainer {\n    max-width: 300px; }\n  .ml-app .mlDataVisualizerColumnHeaderIcon {\n    max-width: 12px; }\n  .ml-app .mlDataVisualizerFieldExpandedRow {\n    padding-left: 64px;\n    width: 100%; }\n    .ml-app .mlDataVisualizerFieldExpandedRow .mlFieldDataCard__valuesTitle {\n      text-transform: uppercase;\n      text-align: left;\n      color: #69707D;\n      font-weight: bold;\n      padding-bottom: 8px; }\n    .ml-app .mlDataVisualizerFieldExpandedRow .mlFieldDataCard__codeContent {\n      font-family: "Roboto Mono", Consolas, Menlo, Courier, monospace;\n      letter-spacing: normal; }\n  .ml-app .mlDataVisualizer .euiTableRow > .euiTableRowCell {\n    border-bottom: 0;\n    border-top: 1px solid #D3DAE6; }\n  .ml-app .mlDataVisualizer .euiTableRow-isExpandedRow .euiTableRowCell {\n    background-color: #FFF !important;\n    border-top: 0;\n    border-bottom: 1px solid #D3DAE6; }\n    .ml-app .mlDataVisualizer .euiTableRow-isExpandedRow .euiTableRowCell:hover {\n      background-color: #FFF !important; }\n  .ml-app .mlDataVisualizer .mlDataVisualizerSummaryTable {\n    max-width: 350px;\n    min-width: 250px; }\n    .ml-app .mlDataVisualizer .mlDataVisualizerSummaryTable .euiTableRow > .euiTableRowCell {\n      border-bottom: 0; }\n    .ml-app .mlDataVisualizer .mlDataVisualizerSummaryTable .euiTableHeaderCell {\n      display: none; }\n  .ml-app .mlDataVisualizer .mlDataVisualizerSummaryTableWrapper {\n    max-width: 300px; }\n  .ml-app .mlDataVisualizer .mlDataVisualizerMapWrapper {\n    min-height: 300px;\n    min-width: 600px; }\n  .ml-app .ml-explorer {\n    width: 100%;\n    display: inline-block;\n    color: #69707D; }\n    .ml-app .ml-explorer .mlAnomalyExplorer__filterBar {\n      padding-right: 16px;\n      padding-left: 16px; }\n    .ml-app .ml-explorer .results-container {\n      padding: 0 0 16px 0; }\n      .ml-app .ml-explorer .results-container .col-xs-12 {\n        width: calc(100% - 32px);\n        padding-left: 16px; }\n      .ml-app .ml-explorer .results-container .no-influencers-warning {\n        float: left;\n        padding-top: 4px;\n        padding-left: 16px;\n        color: #69707D;\n        font-size: 14px; }\n      .ml-app .ml-explorer .results-container .panel-title {\n        font-size: 18px;\n        font-weight: 400;\n        color: #69707D;\n        display: inline-block;\n        padding-bottom: 4px; }\n      .ml-app .ml-explorer .results-container .panel-sub-title {\n        color: #69707D;\n        font-size: 12px; }\n    .ml-app .ml-explorer .ml-anomalies-controls {\n      padding-top: 4px; }\n      .ml-app .ml-explorer .ml-anomalies-controls #show_charts_checkbox_control {\n        padding-top: 24px; }\n  .ml-app .mlSwimLaneContainer {\n    /* Override legend styles */ }\n    .ml-app .mlSwimLaneContainer .echLegendListContainer {\n      height: 34px !important; }\n    .ml-app .mlSwimLaneContainer .echLegendList {\n      display: flex !important;\n      justify-content: space-between !important;\n      flex-wrap: nowrap;\n      position: absolute;\n      right: 0; }\n  .ml-app .ml-explorer-chart-eui-icon-tip {\n    max-width: none; }\n  .ml-app .ml-explorer-chart-label-badges {\n    margin-top: 3px; }\n  .ml-app .ml-reset-font-weight {\n    font-weight: normal; }\n  .ml-app .ml-explorer-chart-container {\n    overflow: hidden; }\n    .ml-app .ml-explorer-chart-container .ml-explorer-chart-svg {\n      font-size: 12px;\n      font-family: "Inter UI", -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; }\n      .ml-app .ml-explorer-chart-container .ml-explorer-chart-svg .line-chart rect {\n        fill: #FFF;\n        opacity: 1; }\n      .ml-app .ml-explorer-chart-container .ml-explorer-chart-svg .line-chart rect.selected-interval {\n        fill: rgba(200, 200, 200, 0.1);\n        stroke: #69707D;\n        stroke-width: 2px;\n        stroke-opacity: .8; }\n      .ml-app .ml-explorer-chart-container .ml-explorer-chart-svg .line-chart rect.scheduled-event-marker {\n        stroke-width: 1px;\n        stroke: #98A2B3;\n        fill: #D3DAE6;\n        pointer-events: none; }\n    .ml-app .ml-explorer-chart-container .axis path, .ml-app .ml-explorer-chart-container .axis line {\n      fill: none;\n      stroke: #D3DAE6;\n      shape-rendering: crispEdges; }\n    .ml-app .ml-explorer-chart-container .axis .tick line.ml-tick-emphasis {\n      stroke: rgba(0, 0, 0, 0.2); }\n    .ml-app .ml-explorer-chart-container .axis text {\n      fill: #69707D; }\n    .ml-app .ml-explorer-chart-container .axis .tick line {\n      stroke: rgba(0, 0, 0, 0.05);\n      stroke-width: 1px; }\n    .ml-app .ml-explorer-chart-container .values-line {\n      fill: none;\n      stroke: #32A7C2;\n      stroke-width: 2; }\n    .ml-app .ml-explorer-chart-container .values-dots circle,\n    .ml-app .ml-explorer-chart-container .values-dots-circle {\n      fill: #32A7C2;\n      stroke-width: 0; }\n    .ml-app .ml-explorer-chart-container .values-dots circle.values-dots-circle-blur {\n      fill: #AAA; }\n    .ml-app .ml-explorer-chart-container .metric-value {\n      opacity: 1;\n      fill: transparent;\n      stroke: #32A7C2;\n      stroke-width: 0; }\n    .ml-app .ml-explorer-chart-container .anomaly-marker {\n      stroke-width: 1px;\n      stroke: #AAAAAA; }\n    .ml-app .ml-explorer-chart-container .anomaly-marker:hover {\n      stroke-width: 6px;\n      stroke: #32A7C2; }\n    .ml-app .ml-explorer-chart-container .anomaly-marker.critical {\n      fill: #FE5050; }\n    .ml-app .ml-explorer-chart-container .anomaly-marker.major {\n      fill: #FBA740; }\n    .ml-app .ml-explorer-chart-container .anomaly-marker.minor {\n      fill: #FDEC25; }\n    .ml-app .ml-explorer-chart-container .anomaly-marker.warning {\n      fill: #8BC8FB; }\n    .ml-app .ml-explorer-chart-container .anomaly-marker.low {\n      fill: #D2E9F7; }\n    .ml-app .ml-explorer-chart-container .metric-value:hover,\n    .ml-app .ml-explorer-chart-container .anomaly-marker:hover {\n      stroke-width: 6px;\n      stroke-opacity: .65; }\n  .ml-app .ml-explorer-chart {\n    overflow: hidden; }\n  .ml-app .ml-explorer-chart-content-wrapper {\n    height: 215px; }\n  .ml-app .ml-explorer-chart-axis-emphasis {\n    font-weight: bold; }\n  .ml-app .explorer-charts ml-explorer-charts-container .row {\n    padding: 10px; }\n  .ml-app .explorer-charts ml-explorer-charts-container label {\n    font-size: 12px; }\n  .ml-app .explorer-charts ml-explorer-charts-container select {\n    font-size: 14px;\n    font-style: 400; }\n  .ml-app .explorer-charts ml-explorer-charts-container .chart-controls label {\n    padding: 0 0 10px 0; }\n  .ml-app .explorer-charts ml-explorer-charts-container .no-results-item {\n    text-align: center;\n    padding-top: 10px; }\n  .ml-app .explorer-charts ml-explorer-charts-container .ml-anomaly-interim-result {\n    font-style: italic;\n    padding-bottom: 3px; }\n  .ml-app .explorer-charts ml-explorer-charts-container .ml-tablerow-expanded {\n    width: 100%;\n    padding: 5px 20px;\n    overflow: hidden;\n    font-size: 12px; }\n    .ml-app .explorer-charts ml-explorer-charts-container .ml-tablerow-expanded td {\n      padding: 0 0 2px 0; }\n    .ml-app .explorer-charts ml-explorer-charts-container .ml-tablerow-expanded table tr > td:first-child {\n      padding-left: 2px;\n      vertical-align: top; }\n    .ml-app .explorer-charts ml-explorer-charts-container .ml-tablerow-expanded td:first-child {\n      width: 140px; }\n    .ml-app .explorer-charts ml-explorer-charts-container .ml-tablerow-expanded td:nth-child(2) {\n      padding-left: 5px; }\n  .ml-app .ml-explorer-chart-icons {\n    float: right;\n    padding-left: 5px;\n    /* counter-margin for EuiButtonEmpty\'s padding */\n    margin: 2px -8px 0 0; }\n  .ml-app .ml-edit-url-form .url-label {\n    width: 250px; }\n  .ml-app .ml-edit-url-form .url-link-to-radio .euiRadio {\n    display: inline-block;\n    padding-right: 24px; }\n  .ml-app .ml-edit-url-form .url-time-range {\n    width: 150px; }\n  .ml-app .new-job-button-container {\n    float: right; }\n  .ml-app .edit-custom-url-panel .close-editor-button {\n    position: relative;\n    float: right;\n    top: -4px;\n    right: 0; }\n  .ml-app .tab-contents {\n    margin: -8px;\n    padding: 8px;\n    background-color: #FFF; }\n    .ml-app .tab-contents .col-md-6:nth-child(1) {\n      padding-right: 7px; }\n    .ml-app .tab-contents .col-md-6:nth-child(2) {\n      padding-left: 7px; }\n    .ml-app .tab-contents .job-section {\n      overflow: auto;\n      padding: 5px 15px;\n      background-color: #F5F7FA;\n      border: 1px solid #D3DAE6;\n      border-radius: 4px;\n      margin: 4px 0; }\n      .ml-app .tab-contents .job-section .euiTable {\n        background-color: transparent; }\n        .ml-app .tab-contents .job-section .euiTable .euiTableRow:first-child .euiTableRowCell {\n          border-top: 0; }\n        .ml-app .tab-contents .job-section .euiTable .euiTableRow:last-child .euiTableRowCell {\n          border-bottom: 0; }\n        .ml-app .tab-contents .job-section .euiTable .euiTableRow .euiTableRowCell {\n          vertical-align: top;\n          border-bottom: 1px solid #D3DAE6; }\n          .ml-app .tab-contents .job-section .euiTable .euiTableRow .euiTableRowCell .euiTableCellContent__text {\n            word-wrap: break-word; }\n        .ml-app .tab-contents .job-section .euiTable .euiTableRow:hover {\n          background-color: inherit; }\n      .ml-app .tab-contents .job-section .job-item {\n        font-size: 12px; }\n      .ml-app .tab-contents .job-section .job-item.header {\n        font-weight: bold; }\n    .ml-app .tab-contents .json-textarea {\n      height: 500px; }\n  .ml-app .job-messages-table {\n    max-height: 500px;\n    overflow: auto;\n    text-align: left; }\n    .ml-app .job-messages-table tr:last-child td {\n      border-bottom: none; }\n    .ml-app .job-messages-table .euiTableRowCell {\n      background-color: #FFF; }\n  .ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .group-item {\n    padding: 8px 16px; }\n  .ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .inline-group {\n    border: 1px solid #FFF;\n    border-radius: 4px; }\n  .ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .euiFilterSelectItem:hover, .ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .euiFilterSelectItem:focus {\n    text-decoration: none; }\n    .ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .euiFilterSelectItem:hover .inline-group, .ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .euiFilterSelectItem:focus .inline-group {\n      border: 1px solid #69707D;\n      box-shadow: 0 1px 2px #98A2B3; }\n  .ml-app .inline-group {\n    font-size: 12px;\n    background-color: #D3DAE6;\n    padding: 2px 5px;\n    border-radius: 2px;\n    display: inline-block;\n    margin: 0 3px;\n    color: #FFF;\n    vertical-align: text-top; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th {\n    text-align: left;\n    white-space: normal; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(2) {\n    width: 34px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(3) {\n    width: auto; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(4) {\n    width: 20px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(5) {\n    width: auto; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(6) {\n    width: 100px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(7) {\n    width: 85px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(8) {\n    width: 80px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(9) {\n    width: 80px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(10) {\n    width: 150px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(11) {\n    width: 80px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(12) {\n    width: 30px; }\n    .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(12) .euiTableCellContent__text {\n      display: none; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody td:nth-child(4) .euiTableCellContent {\n    padding: 0; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody td:nth-child(10) {\n    white-space: nowrap; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody .euiTableCellContent {\n    animation: unset; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody .euiTableRow.euiTableRow-isExpandedRow > td > div > .euiTableCellContent__text {\n    width: 100%; }\n    .ml-app .jobs-list-table > div > .euiTable > tbody .euiTableRow.euiTableRow-isExpandedRow > td > div > .euiTableCellContent__text .euiTableRowCell {\n      background-color: inherit; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody .euiTableRow > .euiTableRowCell > .euiTableCellContent > .euiTableCellContent__hoverItem {\n    opacity: 1; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody .euiContextMenuPanel .euiContextMenuItem {\n    white-space: nowrap; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody .euiContextMenuPanel .euiContextMenuItem:last-child:not(.euiContextMenuItem-isDisabled) {\n    color: #BD271E; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody .results-button {\n    margin-right: 4px;\n    width: 18px; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody .euiContextMenuItem .euiIcon {\n    margin-right: 4px; }\n  .ml-app .jobs-list-table > div > .euiTable .actions-border {\n    height: 20px;\n    border-right: 1px solid #D3DAE6;\n    width: 1px;\n    display: inline-block;\n    vertical-align: middle;\n    margin: 0 4px; }\n  .ml-app .jobs-list-table > div > .euiTable .job-description {\n    display: inline-block; }\n  .ml-app .jobs-list-table > div > .euiTable .job-loading-spinner {\n    text-align: center; }\n  .ml-app .jobs-list-table.jobs-selected .results-button {\n    color: #D3DAE6;\n    pointer-events: none; }\n  .ml-app .actions-bar {\n    min-height: 60px;\n    display: flex;\n    align-items: center; }\n  .ml-app .job-management {\n    padding: 20px; }\n  .ml-app .multi-select-actions {\n    padding-right: 8px;\n    padding-bottom: 12px;\n    display: inline-block;\n    white-space: nowrap; }\n    .ml-app .multi-select-actions .actions-border, .ml-app .multi-select-actions .actions-border-large {\n      height: 20px;\n      border-right: 1px solid #D3DAE6;\n      width: 1px;\n      display: inline-block;\n      vertical-align: middle;\n      margin: 0 5px; }\n    .ml-app .multi-select-actions .actions-border-large {\n      height: 35px;\n      margin: 0 15px;\n      margin-top: -5px; }\n    .ml-app .multi-select-actions .results-button {\n      margin-right: 5px; }\n    .ml-app .multi-select-actions .euiContextMenuPanel .euiContextMenuItem__text {\n      white-space: nowrap; }\n    .ml-app .multi-select-actions .euiContextMenuPanel .euiContextMenuItem:last-child:not(.euiContextMenuItem-isDisabled) {\n      color: #BD271E; }\n  .ml-app .multi-select-actions-no-display {\n    display: none; }\n  .ml-app .group-selector {\n    max-width: 300px; }\n    .ml-app .group-selector .euiPopoverTitle {\n      margin-bottom: 8px !important; }\n  .ml-app .group-list {\n    max-height: 350px;\n    overflow: auto; }\n    .ml-app .group-list .group-item {\n      line-height: 18px;\n      padding: 6px 0;\n      border-bottom: 1px solid #D3DAE6;\n      cursor: pointer; }\n      .ml-app .group-list .group-item:focus {\n        background-color: #EEF6F9;\n        box-shadow: none; }\n      .ml-app .group-list .group-item .check {\n        width: 20px;\n        display: inline-block; }\n      .ml-app .group-list .group-item .inline-group {\n        border: 1px solid #FFF;\n        border-radius: 4px; }\n    .ml-app .group-list .group-item:hover .inline-group {\n      border: 1px solid #69707D;\n      box-shadow: 0 1px 2px #98A2B3; }\n    .ml-app .group-list .group-item:last-child {\n      margin-bottom: 0;\n      border-bottom: none; }\n  .ml-app .new-group-input {\n    padding-bottom: 0; }\n  .ml-app .ml-custom-urls-selection > .euiFlexGroup > .euiFlexItem:first-child {\n    max-width: 388px; }\n  .ml-app .ml-custom-urls-selection > .euiFlexGroup > .euiFlexItem:last-child {\n    flex-basis: 50%; }\n  .ml-app .mlOverviewPanel {\n    padding-top: 0; }\n  .ml-app .mlOverviewPanel__isLoading {\n    text-align: center;\n    padding: 10%; }\n  .ml-app .mlOverviewPanel__buttons {\n    float: right; }\n  .ml-app .mlOverviewPanel__spinner {\n    display: inline-block; }\n  .ml-app .mlOverviewPanel__refreshButton {\n    padding-right: 12px; }\n  .ml-app .mlOverviewPanel__statsBar {\n    margin-top: 0;\n    margin-right: 0; }\n  .ml-app .mlSettingsPage .mlSettingsPage__header {\n    width: 1200px;\n    margin-left: auto;\n    margin-right: auto; }\n  .ml-app .mlSettingsPage .mlSettingsPage__content {\n    width: 1200px;\n    margin-top: 16px;\n    margin-bottom: 16px; }\n  .ml-app .ml-list-filter-lists .ml-list-filter-lists-content {\n    max-width: 1100px;\n    margin-top: 16px;\n    margin-bottom: 16px; }\n  .ml-app .ml-list-filter-lists .ml-filter-lists-table th:last-child, .ml-app .ml-list-filter-lists .ml-filter-lists-table td:last-child {\n    width: 70px; }\n  .ml-app .ml-edit-filter-lists .ml-edit-filter-lists-content {\n    max-width: 1100px;\n    width: 100%;\n    margin-top: 16px;\n    margin-bottom: 16px; }\n  .ml-app .ml-edit-filter-lists .ml-filter-list-usage > div {\n    display: inline; }\n  .ml-app .ml-edit-filter-lists .ml-filter-list-usage .euiButtonEmpty.euiButtonEmpty--small {\n    padding-bottom: 4px; }\n  .ml-app .ml-edit-filter-lists .ml-filter-list-usage .euiButtonEmpty .euiButtonEmpty__content {\n    padding: 0 4px; }\n  .ml-app .ml-add-filter-item-popover .euiFormRow {\n    width: 300px;\n    padding-bottom: 4px; }\n  .ml-app .ml-filter-list-usage-popover li {\n    line-height: 24px; }\n  .ml-app .mlCalendarEditForm .mlCalendarEditForm__content {\n    max-width: 1200px;\n    width: 100%;\n    margin-top: 16px;\n    margin-bottom: 16px; }\n  .ml-app .mlCalendarList .mlCalendarList__content {\n    max-width: 1200px;\n    margin-top: 16px;\n    margin-bottom: 16px; }\n  .ml-app .ml-time-series-explorer {\n    color: #69707D; }\n    .ml-app .ml-time-series-explorer .no-results-container {\n      text-align: center;\n      font-size: 20px;\n      padding-top: 60px; }\n      .ml-app .ml-time-series-explorer .no-results-container .no-results {\n        background-color: #e6f0f8;\n        padding: 16px;\n        border-radius: 4px;\n        display: inline-block; }\n        .ml-app .ml-time-series-explorer .no-results-container .no-results i {\n          color: #006BB4;\n          margin-right: 4px; }\n        .ml-app .ml-time-series-explorer .no-results-container .no-results div:nth-child(2) {\n          margin-top: 8px;\n          font-size: 12px; }\n    .ml-app .ml-time-series-explorer .results-container .panel-title {\n      font-size: 18px;\n      font-weight: 400;\n      color: #69707D; }\n    .ml-app .ml-time-series-explorer .results-container .entity-count-text {\n      color: #017D73;\n      font-size: 14px; }\n    .ml-app .ml-time-series-explorer .forecast-controls {\n      float: right; }\n    .ml-app .ml-time-series-explorer .ml-anomalies-controls {\n      padding-top: 4px; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart svg {\n      font-size: 12px;\n      font-family: "Inter UI", -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .axis path,\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .axis line {\n      fill: none;\n      stroke: #D3DAE6;\n      shape-rendering: crispEdges;\n      pointer-events: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .axis text {\n      fill: #343741; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .axis .tick line {\n      stroke: rgba(0, 0, 0, 0.1); }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .chart-border {\n      stroke: #D3DAE6;\n      fill: none;\n      stroke-width: 1;\n      shape-rendering: crispEdges; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .chart-border-highlight {\n      stroke: #69707D;\n      stroke-width: 2; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .chart-border-highlight:hover {\n      opacity: 1; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .area {\n      stroke-width: 1; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .area.bounds {\n      fill: rgba(50, 167, 194, 0.25);\n      pointer-events: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .values-line {\n      fill: none;\n      stroke: #32A7C2;\n      stroke-width: 2;\n      pointer-events: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .values-line.forecast {\n      stroke: #CCA300;\n      pointer-events: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .values-dots circle {\n      fill: #32A7C2;\n      stroke-width: 0; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .hidden {\n      visibility: hidden; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .area.forecast {\n      fill: rgba(204, 163, 0, 0.25);\n      pointer-events: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .metric-value {\n      opacity: 1;\n      fill: transparent;\n      stroke: #32A7C2;\n      stroke-width: 0; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker {\n      stroke-width: 1px;\n      stroke: #AAAAAA; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.critical {\n      fill: #FE5050; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.major {\n      fill: #FBA740; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.minor {\n      fill: #FDEC25; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.warning {\n      fill: #8BC8FB; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.low {\n      fill: #D2E9F7; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .metric-value:hover,\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker:hover,\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.highlighted {\n      stroke-width: 6px;\n      stroke-opacity: .65;\n      stroke: #32A7C2; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart rect.scheduled-event-marker {\n      stroke-width: 1px;\n      stroke: #98A2B3;\n      fill: #D3DAE6;\n      pointer-events: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .forecast .metric-value,\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .forecast .metric-value:hover {\n      stroke: #CCA300; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .x-axis-background line {\n      fill: none;\n      shape-rendering: crispEdges;\n      stroke: #F5F7FA; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .x-axis-background rect {\n      fill: #F5F7FA; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .focus-zoom {\n      fill: #69707D; }\n      .ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .focus-zoom a text {\n        fill: #006BB4;\n        cursor: pointer; }\n      .ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .focus-zoom a:hover,\n      .ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .focus-zoom a:active,\n      .ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .focus-zoom a:focus {\n        text-decoration: underline; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .x.axis path {\n      display: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .axis text {\n      font-size: 10px;\n      fill: #343741; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .area.context {\n      fill: rgba(50, 167, 194, 0.25); }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .values-line {\n      stroke-width: 1; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .area.context.forecast {\n      fill: rgba(204, 163, 0, 0.25); }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .mask polygon {\n      fill-opacity: .1; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .mask .area.bounds {\n      fill: #D6D6D6; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .mask .values-line {\n      stroke-width: 1;\n      stroke: #B8B8B8; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .mask .values-dots circle {\n      fill: #B8B8B8;\n      stroke-width: 0; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .swimlane .axis text {\n      display: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .swimlane rect.swimlane-cell-hidden {\n      display: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .brush .extent {\n      fill-opacity: 0;\n      shape-rendering: crispEdges;\n      stroke: #69707D;\n      stroke-width: 2;\n      cursor: move; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .brush .extent:hover {\n      opacity: 1; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .top-border {\n      fill: #FFF; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart foreignObject.brush-handle {\n      pointer-events: none;\n      padding-top: 1px; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart div.brush-handle-inner {\n      border: 1px solid #69707D;\n      background-color: #D3DAE6;\n      height: 70px;\n      width: 10px;\n      text-align: center;\n      cursor: ew-resize;\n      margin-top: 9px;\n      font-size: 14px;\n      fill: #69707D; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart div.brush-handle-inner-left {\n      border-radius: 4px 0 0 4px; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart div.brush-handle-inner-right {\n      border-radius: 0 4px 4px 0; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart rect.brush-handle {\n      stroke-width: 1;\n      stroke: #69707D;\n      fill: #D3DAE6;\n      pointer-events: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart rect.brush-handle:hover {\n      opacity: 1; }\n  .ml-app .mlTimeSeriesExplorerProgress {\n    background-color: #FFF; }\n    .ml-app .mlTimeSeriesExplorerProgress::-moz-progress-bar, .ml-app .mlTimeSeriesExplorerProgress::-webkit-progress-bar {\n      background-color: #FFF; }\n  .ml-app .mlAnnotationBrush .extent {\n    stroke: #D3DAE6;\n    stroke-width: 2px;\n    stroke-dasharray: 2 2;\n    fill: #F5F7FA;\n    shape-rendering: geometricPrecision; }\n  .ml-app .mlAnnotationRect {\n    stroke: #000;\n    stroke-width: 2px;\n    stroke-opacity: 0.2;\n    transition: stroke-opacity 150ms;\n    fill: #000;\n    fill-opacity: 0.05;\n    transition: fill-opacity 150ms;\n    shape-rendering: geometricPrecision; }\n  .ml-app .mlAnnotationRect-isHighlight {\n    stroke-opacity: 0.4;\n    transition: stroke-opacity 150ms;\n    fill-opacity: 0.1;\n    transition: fill-opacity 150ms; }\n  .ml-app .mlAnnotationRect-isBlur {\n    stroke-opacity: 0.1;\n    transition: stroke-opacity 150ms;\n    fill-opacity: 0.025;\n    transition: fill-opacity 150ms; }\n  .ml-app .mlAnnotationText {\n    text-anchor: middle;\n    font-size: 12px;\n    font-family: "Inter UI", -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";\n    font-weight: 500;\n    fill: #000;\n    transition: fill 150ms; }\n  .ml-app .mlAnnotationText-isBlur {\n    fill: #98A2B3;\n    transition: fill 150ms; }\n  .ml-app .mlAnnotationTextRect {\n    fill: #D3DAE6;\n    transition: fill 150ms; }\n  .ml-app .mlAnnotationTextRect-isBlur {\n    fill: #F5F7FA;\n    transition: fill 150ms; }\n  .ml-app .mlAnnotationHidden {\n    display: none; }\n  .ml-app .mlContextAnnotationRect {\n    stroke: #000;\n    stroke-width: 2px;\n    stroke-opacity: 0.2;\n    transition: stroke-opacity 150ms;\n    fill: #000;\n    fill-opacity: 0.05;\n    transition: fill-opacity 150ms;\n    shape-rendering: geometricPrecision; }\n  .ml-app .mlContextAnnotationRect-isBlur {\n    stroke-opacity: 0.1;\n    transition: stroke-opacity 150ms;\n    fill-opacity: 0.025;\n    transition: fill-opacity 150ms; }\n  .ml-app .euiDescriptionList.euiDescriptionList--column.ml-annotation-description-list .euiDescriptionList__title {\n    flex-basis: 30%; }\n  .ml-app .euiDescriptionList.euiDescriptionList--column.ml-annotation-description-list .euiDescriptionList__description {\n    flex-basis: 70%; }\n  .ml-app .euiDescriptionList.euiDescriptionList--column.ml-annotation-description-list > * {\n    margin-top: 4px; }\n  .ml-app .ml-anomalies-table .ml-icon-severity-critical,\n  .ml-app .ml-anomalies-table .ml-icon-severity-major,\n  .ml-app .ml-anomalies-table .ml-icon-severity-minor,\n  .ml-app .ml-anomalies-table .ml-icon-severity-warning,\n  .ml-app .ml-anomalies-table .ml-icon-severity-unknown {\n    color: inherit;\n    text-shadow: none; }\n  .ml-app .ml-anomalies-table .ml-icon-severity-critical .euiIcon {\n    fill: #cf4141; }\n  .ml-app .ml-anomalies-table .ml-icon-severity-major .euiIcon {\n    fill: #9e6929; }\n  .ml-app .ml-anomalies-table .ml-icon-severity-minor .euiIcon {\n    fill: #7c7313; }\n  .ml-app .ml-anomalies-table .ml-icon-severity-warning .euiIcon {\n    fill: #537896; }\n  .ml-app .ml-anomalies-table .ml-icon-severity-unknown .euiIcon {\n    fill: #69707D; }\n  .ml-app .ml-anomalies-table tr th:first-child,\n  .ml-app .ml-anomalies-table tr td:first-child {\n    width: 32px; }\n  .ml-app .ml-anomalies-table .euiTableCellContent .euiHealth {\n    font-size: inherit; }\n  .ml-app .ml-anomalies-table .euiTableCellContent .detector-rules-icon {\n    margin-left: 4px;\n    opacity: .5; }\n  .ml-app .ml-anomalies-table .euiContextMenuItem {\n    min-width: 150px; }\n  .ml-app .ml-anomalies-table .mlAnomalyCategoryExamples__header {\n    display: inline; }\n  .ml-app .ml-anomalies-table .mlAnomalyCategoryExamples__link {\n    width: 100%; }\n  .ml-app .ml-anomalies-table .category-example {\n    display: block;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis; }\n  .ml-app .ml-anomalies-table .mlAnomalyCategoryExamples {\n    padding: 24px; }\n  .ml-app .ml-anomalies-table .mlAnomalyCategoryExamples__item {\n    display: block;\n    white-space: wrap;\n    font-family: "Roboto Mono", Consolas, Menlo, Courier, monospace; }\n  .ml-app .ml-anomalies-table .interim-result {\n    font-style: italic; }\n  .ml-app .ml-anomalies-table .ml-anomalies-table-details {\n    padding: 4px 32px;\n    max-height: 1000px;\n    overflow-y: auto; }\n    .ml-app .ml-anomalies-table .ml-anomalies-table-details .anomaly-description-list .euiDescriptionList__title {\n      margin-top: 0;\n      flex-basis: 15%;\n      font-size: inherit;\n      line-height: 1.5rem;\n      max-width: 100%;\n      overflow: hidden !important;\n      text-overflow: ellipsis !important;\n      white-space: nowrap !important;\n      word-wrap: normal !important; }\n    .ml-app .ml-anomalies-table .ml-anomalies-table-details .anomaly-description-list .euiDescriptionList__description {\n      margin-top: 0;\n      flex-basis: 85%;\n      font-size: inherit;\n      line-height: 1.5rem; }\n  .ml-app .mlColorRangeLegend text {\n    font-size: 10px;\n    font-size: 0.625rem;\n    fill: #69707D; }\n  .ml-app .mlColorRangeLegend .axis path {\n    fill: none;\n    stroke: none; }\n  .ml-app .mlColorRangeLegend .axis line {\n    fill: none;\n    stroke: #98A2B3;\n    shape-rendering: crispEdges; }\n  .ml-app .ml-table-controls label {\n    font-size: 12px;\n    padding: 0 0 4px 4px; }\n  .ml-app .ml-table-controls .ml-table-controls-element {\n    display: inline-block;\n    padding-left: 16px; }\n  .ml-app .ml-table-controls select {\n    font-size: 12px;\n    font-style: normal; }\n  .ml-app .ml-select-severity .euiFormControlLayoutClearButton {\n    display: none; }\n  .ml-app .field-value-short {\n    max-width: 100%;\n    overflow: hidden !important;\n    text-overflow: ellipsis !important;\n    white-space: nowrap !important;\n    word-wrap: normal !important;\n    display: inline-block;\n    vertical-align: bottom; }\n  .ml-app .field-value-long {\n    overflow-wrap: break-word; }\n  .ml-app .filter-button {\n    opacity: .3;\n    min-width: 14px;\n    transform: translateY(-1px); }\n    .ml-app .filter-button .euiIcon {\n      width: 12px;\n      height: 12px; }\n  .ml-app .filter-button:hover {\n    opacity: 1; }\n  .ml-app .ml-field-title-bar {\n    font-size: 18px;\n    font-size: 1.125rem;\n    line-height: 1.5;\n    font-family: Roboto Mono, serif;\n    font-style: normal;\n    font-weight: bold;\n    font-size: 14px;\n    border-radius: 4px 4px 0 0;\n    padding: 4px;\n    margin: -16px -16px 0 -16px;\n    border-top: 3px solid;\n    text-align: center; }\n    .ml-app .ml-field-title-bar .field-type-icon {\n      vertical-align: middle;\n      margin-bottom: -4px;\n      display: inline-block; }\n    .ml-app .ml-field-title-bar .field-name {\n      max-width: 100%;\n      overflow: hidden !important;\n      text-overflow: ellipsis !important;\n      white-space: nowrap !important;\n      word-wrap: normal !important;\n      vertical-align: middle;\n      padding-right: 8px;\n      max-width: 290px;\n      display: inline-block;\n      margin-left: 8px; }\n  .ml-app .ml-influencers-list {\n    line-height: 1.45; }\n    .ml-app .ml-influencers-list .field-label {\n      font-size: 12px;\n      text-align: left;\n      max-height: 14px;\n      max-width: calc(100% - 102px); }\n      .ml-app .ml-influencers-list .field-label .field-value {\n        max-width: 100%;\n        overflow: hidden !important;\n        text-overflow: ellipsis !important;\n        white-space: nowrap !important;\n        word-wrap: normal !important;\n        display: inline-block;\n        vertical-align: bottom; }\n    .ml-app .ml-influencers-list .progress {\n      display: inline-block;\n      width: calc(100% - 34px);\n      height: 22px;\n      min-width: 70px;\n      margin-bottom: 0;\n      color: #69707D;\n      background-color: transparent; }\n      .ml-app .ml-influencers-list .progress .progress-bar-holder {\n        width: calc(100% - 28px); }\n      .ml-app .ml-influencers-list .progress .progress-bar {\n        height: 2px;\n        margin-top: 12px;\n        text-align: right;\n        line-height: 18px;\n        display: inline-block;\n        transition: none; }\n    .ml-app .ml-influencers-list .progress.critical .progress-bar {\n      background-color: #FE5050; }\n    .ml-app .ml-influencers-list .progress.critical .score-label {\n      border-color: #FE5050; }\n    .ml-app .ml-influencers-list .progress.major .progress-bar {\n      background-color: #FBA740; }\n    .ml-app .ml-influencers-list .progress.major .score-label {\n      border-color: #FBA740; }\n    .ml-app .ml-influencers-list .progress.minor .progress-bar {\n      background-color: #FDEC25; }\n    .ml-app .ml-influencers-list .progress.minor .score-label {\n      border-color: #FDEC25; }\n    .ml-app .ml-influencers-list .progress.warning .progress-bar {\n      background-color: #8BC8FB; }\n    .ml-app .ml-influencers-list .progress.warning .score-label {\n      border-color: #8BC8FB; }\n    .ml-app .ml-influencers-list .score-label {\n      text-align: center;\n      line-height: 14px;\n      white-space: nowrap;\n      font-size: 12px;\n      display: inline;\n      margin-left: 4px; }\n    .ml-app .ml-influencers-list .total-score-label {\n      width: 32px;\n      vertical-align: top;\n      text-align: center;\n      color: #69707D;\n      font-size: 11px;\n      line-height: 14px;\n      border-radius: 4px;\n      padding: 2px;\n      margin-top: 3px;\n      display: inline-block;\n      border: 1px solid #D3DAE6; }\n  .ml-app .ml-influencers-list-tooltip {\n    word-break: break-all; }\n  .ml-app .ml-items-grid-page-size-menu {\n    width: 140px; }\n  .ml-app .mlJobSelectorBar {\n    padding: 8px; }\n  .ml-app .mlJobSelectorFlyoutBody > .euiFlyoutBody__overflow {\n    padding-top: 8px; }\n  .ml-app .mlJobSelector__ganttBar {\n    background-color: #79ADDA;\n    height: 12px;\n    border-radius: 2px; }\n  .ml-app .mlJobSelector__ganttBarBackEdge {\n    height: 16px;\n    border-left: 1px solid #D6D6D6;\n    border-right: 1px solid #D6D6D6;\n    margin-bottom: -14px;\n    padding-top: 8px; }\n  .ml-app .mlJobSelector__ganttBarDashed {\n    height: 1px;\n    border-top: 1px dashed #D6D6D6; }\n  .ml-app .mlJobSelector__ganttBarRunning {\n    background-image: linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);\n    background-size: 40px 40px;\n    animation: progress-bar-stripes 2s linear infinite; }\n  .ml-app .ml-loading-indicator {\n    text-align: center;\n    font-size: 17px;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center; }\n  .ml-app .mlNavigationMenu {\n    padding: 0 12px;\n    border-bottom: 1px solid #D3DAE6;\n    background-color: #FFF; }\n  .ml-app .ml-rule-editor-flyout {\n    font-size: 14px; }\n    .ml-app .ml-rule-editor-flyout .select-rule-action .rule-detector-description-list {\n      padding-left: 16px; }\n    .ml-app .ml-rule-editor-flyout .select-rule-action-panel {\n      padding: 8px 0; }\n      .ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__title {\n        flex-basis: 15%;\n        padding: 0 16px; }\n      .ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__description {\n        flex-basis: 85%; }\n      .ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__title:nth-child(1),\n      .ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__description:nth-child(2) {\n        color: #1a1c21;\n        font-weight: 700;\n        border-bottom: 1px solid #D3DAE6;\n        padding-bottom: 12px; }\n      .ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__title:nth-child(3),\n      .ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__description:nth-child(4) {\n        padding-top: 8px; }\n      .ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList.euiDescriptionList--column > * {\n        margin-top: 4px; }\n    .ml-app .ml-rule-editor-flyout .scope-enable-checkbox .euiCheckbox__input[disabled] ~ .euiCheckbox__label {\n      color: inherit; }\n    .ml-app .ml-rule-editor-flyout .scope-field-checkbox {\n      margin-right: 2px; }\n      .ml-app .ml-rule-editor-flyout .scope-field-checkbox .euiCheckbox {\n        margin-top: 4px; }\n    .ml-app .ml-rule-editor-flyout .scope-field-button {\n      pointer-events: none;\n      border-bottom: none; }\n    .ml-app .ml-rule-editor-flyout .scope-edit-filter-link {\n      line-height: 32px;\n      font-size: 12px; }\n    .ml-app .ml-rule-editor-flyout .condition-edit-value-field {\n      width: 170px;\n      height: 28px;\n      margin: 0 2px; }\n      .ml-app .ml-rule-editor-flyout .condition-edit-value-field input {\n        height: 28px; }\n    .ml-app .ml-rule-editor-flyout .euiExpressionButton.disabled {\n      pointer-events: none; }\n      .ml-app .ml-rule-editor-flyout .euiExpressionButton.disabled .euiExpressionButton__value,\n      .ml-app .ml-rule-editor-flyout .euiExpressionButton.disabled .euiExpressionButton__description {\n        color: #D3DAE6; }\n    .ml-app .ml-rule-editor-flyout .text-highlight {\n      font-weight: 700; }\n  .ml-app .euiDescriptionList.euiDescriptionList--column.rule-detector-description-list .euiDescriptionList__title {\n    flex-basis: 15%; }\n  .ml-app .euiDescriptionList.euiDescriptionList--column.rule-detector-description-list .euiDescriptionList__description {\n    flex-basis: 85%; }\n  .ml-app .euiDescriptionList.euiDescriptionList--column.rule-detector-description-list > * {\n    margin-top: 4px; }\n  .ml-app .stat {\n    margin-right: 8px; }\n  .ml-app .mlStatsBar {\n    height: 42px;\n    padding: 14px;\n    background-color: #F5F7FA; }\n  .ml-app .mlEmbeddedMapContent {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    flex: 1 1 100%;\n    z-index: 1;\n    min-height: 0; }\n  .ml-app .tab-datavisualizer_index_select,\n  .ml-app .tab-timeseriesexplorer,\n  .ml-app .tab-explorer {\n    background-color: #FFF; }\n  .ml-app .button-wrapper {\n    display: inline; }\n  .ml-app .button-wrapper.disabled .kuiButton[disabled] {\n    pointer-events: none; }\n  .ml-app .button-wrapper.disabled {\n    cursor: not-allowed; }\n  .ml-app .clear, .ml-app .clearfix {\n    clear: both; }\n  .ml-app .mlDisableAntiAliasing {\n    -webkit-font-smoothing: none; }\n    .ml-app .mlDisableAntiAliasing * canvas {\n      image-rendering: pixelated; }\n',""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(428);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,'.ml-app {\n  /*\n  Resets the badge\'s default strong font-weight so it\'s possible\n  to put custom emphasis inside the badge only on a part of it.\n  Used in the Explorer Chart label badge to display an entity\'s\n  field_name as `normal` and field_value as `strong`.\n*/\n  /* wrapper class for the top right alert icon and view button */\n  /* Hides the progress bar\'s background so it doesn\'t look like it increases the thickness\n   of the horizontal bar below the tab menu elements in its inactive state. */\n  /* Overrides for d3/svg default styles */ }\n  .ml-app .ml-icon-severity-critical,\n  .ml-app .ml-icon-severity-major,\n  .ml-app .ml-icon-severity-minor,\n  .ml-app .ml-icon-severity-warning,\n  .ml-app .ml-icon-severity-unknown {\n    text-shadow: 1px 1px 1px #343741; }\n  .ml-app .ml-icon-severity-critical {\n    color: #FE5050; }\n  .ml-app .ml-icon-severity-major {\n    color: #FBA740; }\n  .ml-app .ml-icon-severity-minor {\n    color: #FDEC25; }\n  .ml-app .ml-icon-severity-warning {\n    color: #8BC8FB; }\n  .ml-app .ml-icon-severity-unknown {\n    color: #98A2B3; }\n  .ml-app .mlDataFrameAnalyticsRegression__evaluateStat {\n    padding-top: 24px; }\n  .ml-app .mlJobMapLegend__container {\n    background-color: \'#FFFFFF\'; }\n  .ml-app .mlJobMapLegend__indexPattern {\n    height: 12px;\n    width: 12px;\n    background-color: #FFF;\n    border: 2px solid #D36086;\n    transform: rotate(45deg);\n    display: \'inline-block\'; }\n  .ml-app .mlJobMapLegend__transform {\n    height: 12px;\n    width: 12px;\n    background-color: #FFF;\n    border: 2px solid #6092C0;\n    display: \'inline-block\'; }\n  .ml-app .mlJobMapLegend__analytics {\n    height: 12px;\n    width: 12px;\n    background-color: #FFF;\n    border: 2px solid #54B399;\n    border-radius: 50%;\n    display: \'inline-block\'; }\n  .ml-app .mlJobMapLegend__sourceNode {\n    height: 12px;\n    width: 12px;\n    background-color: #F3D371;\n    border: 1px solid #343741;\n    border-radius: 6px;\n    display: \'inline-block\'; }\n  .ml-app .mlAnalyticsTable .euiTableRow-isExpandedRow .euiTableCellContent {\n    animation: none !important; }\n    .ml-app .mlAnalyticsTable .euiTableRow-isExpandedRow .euiTableCellContent .euiTableCellContent__text {\n      width: 100%; }\n  .ml-app .mlAnalyticsTable .euiIcon-isLoaded {\n    animation: none !important; }\n  .ml-app .mlTaskStateBadge, .ml-app .mlTaskModeBadge {\n    max-width: 100px; }\n  .ml-app .dataFrameAnalyticsCreateSearchDialog {\n    width: 720px;\n    min-height: 600px; }\n  .ml-app .dfAnalyticsCreationWizard__card {\n    width: 300px; }\n  .ml-app .file-datavisualizer-file-picker {\n    max-width: inherit; }\n    .ml-app .file-datavisualizer-file-picker .euiFilePicker__prompt {\n      background-color: #1D1E24;\n      box-shadow: none; }\n      .ml-app .file-datavisualizer-file-picker .euiFilePicker__prompt .euiFilePicker__icon {\n        width: 40px;\n        height: 40px; }\n  .ml-app .results .euiDescriptionList dd, .ml-app .results .euiDescriptionList dt {\n    margin-top: 5px; }\n  .ml-app .results .euiDescriptionList dd:nth-child(1), .ml-app .results .euiDescriptionList dt:nth-child(1) {\n    margin-top: 0; }\n  .ml-app .analysis-summary-list.euiDescriptionList .euiDescriptionList__title {\n    flex-basis: 15%; }\n  .ml-app .analysis-summary-list.euiDescriptionList .euiDescriptionList__description {\n    flex-basis: 85%; }\n  .ml-app .file-datavisualizer-about-panel__icon {\n    width: 96px;\n    height: 96px;\n    margin-left: 32px;\n    margin-right: 24px; }\n  .ml-app .euiFlexItem.file-datavisualizer-about-panel__doc-icon {\n    margin-left: 32px;\n    margin-right: 4px;\n    margin-top: 16px; }\n  .ml-app .import-summary-list.euiDescriptionList .euiDescriptionList__title {\n    flex-basis: 15%; }\n  .ml-app .import-summary-list.euiDescriptionList .euiDescriptionList__description {\n    flex-basis: 85%; }\n  .ml-app .failure-list {\n    max-height: 200px;\n    overflow-y: auto; }\n    .ml-app .failure-list .error-message {\n      color: #F86B63; }\n  .ml-app .ml-experimental-badge.euiBetaBadge {\n    font-size: 10px;\n    vertical-align: middle;\n    margin-bottom: 5px;\n    padding: 0 20px;\n    line-height: 20px; }\n  .ml-app .mlFieldDataTopValuesContainer {\n    padding-top: 4px; }\n  .ml-app .mlTopValuesValueLabelContainer {\n    margin-right: 12px; }\n    .ml-app .mlTopValuesValueLabelContainer.mlTopValuesValueLabelContainer--small {\n      width: 70px; }\n    .ml-app .mlTopValuesValueLabelContainer.mlTopValuesValueLabelContainer--large {\n      width: 200px; }\n  .ml-app .mlTopValuesPercentLabelContainer {\n    margin-left: 12px;\n    width: 70px; }\n  .ml-app .mlMetricDistributionChartContainer {\n    padding-top: 4px;\n    width: 100%; }\n  @media only screen and (max-width: 574px) {\n    .ml-app .mlDataVisualizerExpandedRow {\n      flex-direction: column; } }\n  @media only screen and (min-width: 575px) and (max-width: 767px) {\n    .ml-app .mlDataVisualizerExpandedRow {\n      flex-direction: column; } }\n  @media only screen and (min-width: 768px) and (max-width: 991px) {\n    .ml-app .mlDataVisualizerExpandedRow {\n      flex-direction: column; } }\n  .ml-app .mlDataVisualizerFieldCountContainer {\n    max-width: 300px; }\n  .ml-app .mlDataVisualizerColumnHeaderIcon {\n    max-width: 12px; }\n  .ml-app .mlDataVisualizerFieldExpandedRow {\n    padding-left: 64px;\n    width: 100%; }\n    .ml-app .mlDataVisualizerFieldExpandedRow .mlFieldDataCard__valuesTitle {\n      text-transform: uppercase;\n      text-align: left;\n      color: #98A2B3;\n      font-weight: bold;\n      padding-bottom: 8px; }\n    .ml-app .mlDataVisualizerFieldExpandedRow .mlFieldDataCard__codeContent {\n      font-family: "Roboto Mono", Consolas, Menlo, Courier, monospace;\n      letter-spacing: normal; }\n  .ml-app .mlDataVisualizer .euiTableRow > .euiTableRowCell {\n    border-bottom: 0;\n    border-top: 1px solid #343741; }\n  .ml-app .mlDataVisualizer .euiTableRow-isExpandedRow .euiTableRowCell {\n    background-color: #1D1E24 !important;\n    border-top: 0;\n    border-bottom: 1px solid #343741; }\n    .ml-app .mlDataVisualizer .euiTableRow-isExpandedRow .euiTableRowCell:hover {\n      background-color: #1D1E24 !important; }\n  .ml-app .mlDataVisualizer .mlDataVisualizerSummaryTable {\n    max-width: 350px;\n    min-width: 250px; }\n    .ml-app .mlDataVisualizer .mlDataVisualizerSummaryTable .euiTableRow > .euiTableRowCell {\n      border-bottom: 0; }\n    .ml-app .mlDataVisualizer .mlDataVisualizerSummaryTable .euiTableHeaderCell {\n      display: none; }\n  .ml-app .mlDataVisualizer .mlDataVisualizerSummaryTableWrapper {\n    max-width: 300px; }\n  .ml-app .mlDataVisualizer .mlDataVisualizerMapWrapper {\n    min-height: 300px;\n    min-width: 600px; }\n  .ml-app .ml-explorer {\n    width: 100%;\n    display: inline-block;\n    color: #98A2B3; }\n    .ml-app .ml-explorer .mlAnomalyExplorer__filterBar {\n      padding-right: 16px;\n      padding-left: 16px; }\n    .ml-app .ml-explorer .results-container {\n      padding: 0 0 16px 0; }\n      .ml-app .ml-explorer .results-container .col-xs-12 {\n        width: calc(100% - 32px);\n        padding-left: 16px; }\n      .ml-app .ml-explorer .results-container .no-influencers-warning {\n        float: left;\n        padding-top: 4px;\n        padding-left: 16px;\n        color: #98A2B3;\n        font-size: 14px; }\n      .ml-app .ml-explorer .results-container .panel-title {\n        font-size: 16px;\n        font-weight: 400;\n        color: #98A2B3;\n        display: inline-block;\n        padding-bottom: 4px; }\n      .ml-app .ml-explorer .results-container .panel-sub-title {\n        color: #98A2B3;\n        font-size: 12px; }\n    .ml-app .ml-explorer .ml-anomalies-controls {\n      padding-top: 4px; }\n      .ml-app .ml-explorer .ml-anomalies-controls #show_charts_checkbox_control {\n        padding-top: 24px; }\n  .ml-app .mlSwimLaneContainer {\n    /* Override legend styles */ }\n    .ml-app .mlSwimLaneContainer .echLegendListContainer {\n      height: 34px !important; }\n    .ml-app .mlSwimLaneContainer .echLegendList {\n      display: flex !important;\n      justify-content: space-between !important;\n      flex-wrap: nowrap;\n      position: absolute;\n      right: 0; }\n  .ml-app .ml-explorer-chart-eui-icon-tip {\n    max-width: none; }\n  .ml-app .ml-explorer-chart-label-badges {\n    margin-top: 3px; }\n  .ml-app .ml-reset-font-weight {\n    font-weight: normal; }\n  .ml-app .ml-explorer-chart-container {\n    overflow: hidden; }\n    .ml-app .ml-explorer-chart-container .ml-explorer-chart-svg {\n      font-size: 12px;\n      font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; }\n      .ml-app .ml-explorer-chart-container .ml-explorer-chart-svg .line-chart rect {\n        fill: #1D1E24;\n        opacity: 1; }\n      .ml-app .ml-explorer-chart-container .ml-explorer-chart-svg .line-chart rect.selected-interval {\n        fill: rgba(200, 200, 200, 0.1);\n        stroke: #98A2B3;\n        stroke-width: 2px;\n        stroke-opacity: .8; }\n      .ml-app .ml-explorer-chart-container .ml-explorer-chart-svg .line-chart rect.scheduled-event-marker {\n        stroke-width: 1px;\n        stroke: #535966;\n        fill: #343741;\n        pointer-events: none; }\n    .ml-app .ml-explorer-chart-container .axis path, .ml-app .ml-explorer-chart-container .axis line {\n      fill: none;\n      stroke: #343741;\n      shape-rendering: crispEdges; }\n    .ml-app .ml-explorer-chart-container .axis .tick line.ml-tick-emphasis {\n      stroke: rgba(0, 0, 0, 0.2); }\n    .ml-app .ml-explorer-chart-container .axis text {\n      fill: #98A2B3; }\n    .ml-app .ml-explorer-chart-container .axis .tick line {\n      stroke: rgba(0, 0, 0, 0.05);\n      stroke-width: 1px; }\n    .ml-app .ml-explorer-chart-container .values-line {\n      fill: none;\n      stroke: #32A7C2;\n      stroke-width: 2; }\n    .ml-app .ml-explorer-chart-container .values-dots circle,\n    .ml-app .ml-explorer-chart-container .values-dots-circle {\n      fill: #32A7C2;\n      stroke-width: 0; }\n    .ml-app .ml-explorer-chart-container .values-dots circle.values-dots-circle-blur {\n      fill: #AAA; }\n    .ml-app .ml-explorer-chart-container .metric-value {\n      opacity: 1;\n      fill: transparent;\n      stroke: #32A7C2;\n      stroke-width: 0; }\n    .ml-app .ml-explorer-chart-container .anomaly-marker {\n      stroke-width: 1px;\n      stroke: #AAAAAA; }\n    .ml-app .ml-explorer-chart-container .anomaly-marker:hover {\n      stroke-width: 6px;\n      stroke: #32A7C2; }\n    .ml-app .ml-explorer-chart-container .anomaly-marker.critical {\n      fill: #FE5050; }\n    .ml-app .ml-explorer-chart-container .anomaly-marker.major {\n      fill: #FBA740; }\n    .ml-app .ml-explorer-chart-container .anomaly-marker.minor {\n      fill: #FDEC25; }\n    .ml-app .ml-explorer-chart-container .anomaly-marker.warning {\n      fill: #8BC8FB; }\n    .ml-app .ml-explorer-chart-container .anomaly-marker.low {\n      fill: #D2E9F7; }\n    .ml-app .ml-explorer-chart-container .metric-value:hover,\n    .ml-app .ml-explorer-chart-container .anomaly-marker:hover {\n      stroke-width: 6px;\n      stroke-opacity: .65; }\n  .ml-app .ml-explorer-chart {\n    overflow: hidden; }\n  .ml-app .ml-explorer-chart-content-wrapper {\n    height: 215px; }\n  .ml-app .ml-explorer-chart-axis-emphasis {\n    font-weight: bold; }\n  .ml-app .explorer-charts ml-explorer-charts-container .row {\n    padding: 10px; }\n  .ml-app .explorer-charts ml-explorer-charts-container label {\n    font-size: 12px; }\n  .ml-app .explorer-charts ml-explorer-charts-container select {\n    font-size: 14px;\n    font-style: 400; }\n  .ml-app .explorer-charts ml-explorer-charts-container .chart-controls label {\n    padding: 0 0 10px 0; }\n  .ml-app .explorer-charts ml-explorer-charts-container .no-results-item {\n    text-align: center;\n    padding-top: 10px; }\n  .ml-app .explorer-charts ml-explorer-charts-container .ml-anomaly-interim-result {\n    font-style: italic;\n    padding-bottom: 3px; }\n  .ml-app .explorer-charts ml-explorer-charts-container .ml-tablerow-expanded {\n    width: 100%;\n    padding: 5px 20px;\n    overflow: hidden;\n    font-size: 12px; }\n    .ml-app .explorer-charts ml-explorer-charts-container .ml-tablerow-expanded td {\n      padding: 0 0 2px 0; }\n    .ml-app .explorer-charts ml-explorer-charts-container .ml-tablerow-expanded table tr > td:first-child {\n      padding-left: 2px;\n      vertical-align: top; }\n    .ml-app .explorer-charts ml-explorer-charts-container .ml-tablerow-expanded td:first-child {\n      width: 140px; }\n    .ml-app .explorer-charts ml-explorer-charts-container .ml-tablerow-expanded td:nth-child(2) {\n      padding-left: 5px; }\n  .ml-app .ml-explorer-chart-icons {\n    float: right;\n    padding-left: 5px;\n    /* counter-margin for EuiButtonEmpty\'s padding */\n    margin: 2px -8px 0 0; }\n  .ml-app .ml-edit-url-form .url-label {\n    width: 250px; }\n  .ml-app .ml-edit-url-form .url-link-to-radio .euiRadio {\n    display: inline-block;\n    padding-right: 24px; }\n  .ml-app .ml-edit-url-form .url-time-range {\n    width: 150px; }\n  .ml-app .new-job-button-container {\n    float: right; }\n  .ml-app .edit-custom-url-panel .close-editor-button {\n    position: relative;\n    float: right;\n    top: -4px;\n    right: 0; }\n  .ml-app .tab-contents {\n    margin: -8px;\n    padding: 8px;\n    background-color: #1D1E24; }\n    .ml-app .tab-contents .col-md-6:nth-child(1) {\n      padding-right: 7px; }\n    .ml-app .tab-contents .col-md-6:nth-child(2) {\n      padding-left: 7px; }\n    .ml-app .tab-contents .job-section {\n      overflow: auto;\n      padding: 5px 15px;\n      background-color: #25262E;\n      border: 1px solid #343741;\n      border-radius: 6px;\n      margin: 4px 0; }\n      .ml-app .tab-contents .job-section .euiTable {\n        background-color: transparent; }\n        .ml-app .tab-contents .job-section .euiTable .euiTableRow:first-child .euiTableRowCell {\n          border-top: 0; }\n        .ml-app .tab-contents .job-section .euiTable .euiTableRow:last-child .euiTableRowCell {\n          border-bottom: 0; }\n        .ml-app .tab-contents .job-section .euiTable .euiTableRow .euiTableRowCell {\n          vertical-align: top;\n          border-bottom: 1px solid #343741; }\n          .ml-app .tab-contents .job-section .euiTable .euiTableRow .euiTableRowCell .euiTableCellContent__text {\n            word-wrap: break-word; }\n        .ml-app .tab-contents .job-section .euiTable .euiTableRow:hover {\n          background-color: inherit; }\n      .ml-app .tab-contents .job-section .job-item {\n        font-size: 12px; }\n      .ml-app .tab-contents .job-section .job-item.header {\n        font-weight: bold; }\n    .ml-app .tab-contents .json-textarea {\n      height: 500px; }\n  .ml-app .job-messages-table {\n    max-height: 500px;\n    overflow: auto;\n    text-align: left; }\n    .ml-app .job-messages-table tr:last-child td {\n      border-bottom: none; }\n    .ml-app .job-messages-table .euiTableRowCell {\n      background-color: #1D1E24; }\n  .ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .group-item {\n    padding: 8px 16px; }\n  .ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .inline-group {\n    border: 1px solid #1D1E24;\n    border-radius: 6px; }\n  .ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .euiFilterSelectItem:hover, .ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .euiFilterSelectItem:focus {\n    text-decoration: none; }\n    .ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .euiFilterSelectItem:hover .inline-group, .ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .euiFilterSelectItem:focus .inline-group {\n      border: 1px solid #98A2B3;\n      box-shadow: 0 1px 2px #535966; }\n  .ml-app .inline-group {\n    font-size: 12px;\n    background-color: #343741;\n    padding: 2px 5px;\n    border-radius: 2px;\n    display: inline-block;\n    margin: 0 3px;\n    color: #1D1E24;\n    vertical-align: text-top; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th {\n    text-align: left;\n    white-space: normal; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(2) {\n    width: 34px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(3) {\n    width: auto; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(4) {\n    width: 20px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(5) {\n    width: auto; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(6) {\n    width: 100px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(7) {\n    width: 85px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(8) {\n    width: 80px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(9) {\n    width: 80px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(10) {\n    width: 150px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(11) {\n    width: 80px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(12) {\n    width: 30px; }\n    .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(12) .euiTableCellContent__text {\n      display: none; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody td:nth-child(4) .euiTableCellContent {\n    padding: 0; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody td:nth-child(10) {\n    white-space: nowrap; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody .euiTableCellContent {\n    animation: unset; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody .euiTableRow.euiTableRow-isExpandedRow > td > div > .euiTableCellContent__text {\n    width: 100%; }\n    .ml-app .jobs-list-table > div > .euiTable > tbody .euiTableRow.euiTableRow-isExpandedRow > td > div > .euiTableCellContent__text .euiTableRowCell {\n      background-color: inherit; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody .euiTableRow > .euiTableRowCell > .euiTableCellContent > .euiTableCellContent__hoverItem {\n    opacity: 1; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody .euiContextMenuPanel .euiContextMenuItem {\n    white-space: nowrap; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody .euiContextMenuPanel .euiContextMenuItem:last-child:not(.euiContextMenuItem-isDisabled) {\n    color: #F86B63; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody .results-button {\n    margin-right: 4px;\n    width: 18px; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody .euiContextMenuItem .euiIcon {\n    margin-right: 4px; }\n  .ml-app .jobs-list-table > div > .euiTable .actions-border {\n    height: 20px;\n    border-right: 1px solid #343741;\n    width: 1px;\n    display: inline-block;\n    vertical-align: middle;\n    margin: 0 4px; }\n  .ml-app .jobs-list-table > div > .euiTable .job-description {\n    display: inline-block; }\n  .ml-app .jobs-list-table > div > .euiTable .job-loading-spinner {\n    text-align: center; }\n  .ml-app .jobs-list-table.jobs-selected .results-button {\n    color: #343741;\n    pointer-events: none; }\n  .ml-app .actions-bar {\n    min-height: 60px;\n    display: flex;\n    align-items: center; }\n  .ml-app .job-management {\n    padding: 20px; }\n  .ml-app .multi-select-actions {\n    padding-right: 8px;\n    padding-bottom: 12px;\n    display: inline-block;\n    white-space: nowrap; }\n    .ml-app .multi-select-actions .actions-border, .ml-app .multi-select-actions .actions-border-large {\n      height: 20px;\n      border-right: 1px solid #343741;\n      width: 1px;\n      display: inline-block;\n      vertical-align: middle;\n      margin: 0 5px; }\n    .ml-app .multi-select-actions .actions-border-large {\n      height: 35px;\n      margin: 0 15px;\n      margin-top: -5px; }\n    .ml-app .multi-select-actions .results-button {\n      margin-right: 5px; }\n    .ml-app .multi-select-actions .euiContextMenuPanel .euiContextMenuItem__text {\n      white-space: nowrap; }\n    .ml-app .multi-select-actions .euiContextMenuPanel .euiContextMenuItem:last-child:not(.euiContextMenuItem-isDisabled) {\n      color: #F86B63; }\n  .ml-app .multi-select-actions-no-display {\n    display: none; }\n  .ml-app .group-selector {\n    max-width: 300px; }\n    .ml-app .group-selector .euiPopoverTitle {\n      margin-bottom: 8px !important; }\n  .ml-app .group-list {\n    max-height: 350px;\n    overflow: auto; }\n    .ml-app .group-list .group-item {\n      line-height: 18px;\n      padding: 6px 0;\n      border-bottom: 1px solid #343741;\n      cursor: pointer; }\n      .ml-app .group-list .group-item:focus {\n        background-color: #EEF6F9;\n        box-shadow: none; }\n      .ml-app .group-list .group-item .check {\n        width: 20px;\n        display: inline-block; }\n      .ml-app .group-list .group-item .inline-group {\n        border: 1px solid #1D1E24;\n        border-radius: 6px; }\n    .ml-app .group-list .group-item:hover .inline-group {\n      border: 1px solid #98A2B3;\n      box-shadow: 0 1px 2px #535966; }\n    .ml-app .group-list .group-item:last-child {\n      margin-bottom: 0;\n      border-bottom: none; }\n  .ml-app .new-group-input {\n    padding-bottom: 0; }\n  .ml-app .ml-custom-urls-selection > .euiFlexGroup > .euiFlexItem:first-child {\n    max-width: 388px; }\n  .ml-app .ml-custom-urls-selection > .euiFlexGroup > .euiFlexItem:last-child {\n    flex-basis: 50%; }\n  .ml-app .mlOverviewPanel {\n    padding-top: 0; }\n  .ml-app .mlOverviewPanel__isLoading {\n    text-align: center;\n    padding: 10%; }\n  .ml-app .mlOverviewPanel__buttons {\n    float: right; }\n  .ml-app .mlOverviewPanel__spinner {\n    display: inline-block; }\n  .ml-app .mlOverviewPanel__refreshButton {\n    padding-right: 12px; }\n  .ml-app .mlOverviewPanel__statsBar {\n    margin-top: 0;\n    margin-right: 0; }\n  .ml-app .mlSettingsPage .mlSettingsPage__header {\n    width: 1200px;\n    margin-left: auto;\n    margin-right: auto; }\n  .ml-app .mlSettingsPage .mlSettingsPage__content {\n    width: 1200px;\n    margin-top: 16px;\n    margin-bottom: 16px; }\n  .ml-app .ml-list-filter-lists .ml-list-filter-lists-content {\n    max-width: 1100px;\n    margin-top: 16px;\n    margin-bottom: 16px; }\n  .ml-app .ml-list-filter-lists .ml-filter-lists-table th:last-child, .ml-app .ml-list-filter-lists .ml-filter-lists-table td:last-child {\n    width: 70px; }\n  .ml-app .ml-edit-filter-lists .ml-edit-filter-lists-content {\n    max-width: 1100px;\n    width: 100%;\n    margin-top: 16px;\n    margin-bottom: 16px; }\n  .ml-app .ml-edit-filter-lists .ml-filter-list-usage > div {\n    display: inline; }\n  .ml-app .ml-edit-filter-lists .ml-filter-list-usage .euiButtonEmpty.euiButtonEmpty--small {\n    padding-bottom: 4px; }\n  .ml-app .ml-edit-filter-lists .ml-filter-list-usage .euiButtonEmpty .euiButtonEmpty__content {\n    padding: 0 4px; }\n  .ml-app .ml-add-filter-item-popover .euiFormRow {\n    width: 300px;\n    padding-bottom: 4px; }\n  .ml-app .ml-filter-list-usage-popover li {\n    line-height: 24px; }\n  .ml-app .mlCalendarEditForm .mlCalendarEditForm__content {\n    max-width: 1200px;\n    width: 100%;\n    margin-top: 16px;\n    margin-bottom: 16px; }\n  .ml-app .mlCalendarList .mlCalendarList__content {\n    max-width: 1200px;\n    margin-top: 16px;\n    margin-bottom: 16px; }\n  .ml-app .ml-time-series-explorer {\n    color: #98A2B3; }\n    .ml-app .ml-time-series-explorer .no-results-container {\n      text-align: center;\n      font-size: 22px;\n      padding-top: 60px; }\n      .ml-app .ml-time-series-explorer .no-results-container .no-results {\n        background-color: rgba(54, 162, 239, 0.3);\n        padding: 16px;\n        border-radius: 6px;\n        display: inline-block; }\n        .ml-app .ml-time-series-explorer .no-results-container .no-results i {\n          color: #36A2EF;\n          margin-right: 4px; }\n        .ml-app .ml-time-series-explorer .no-results-container .no-results div:nth-child(2) {\n          margin-top: 8px;\n          font-size: 12px; }\n    .ml-app .ml-time-series-explorer .results-container .panel-title {\n      font-size: 16px;\n      font-weight: 400;\n      color: #98A2B3; }\n    .ml-app .ml-time-series-explorer .results-container .entity-count-text {\n      color: #7DDED8;\n      font-size: 14px; }\n    .ml-app .ml-time-series-explorer .forecast-controls {\n      float: right; }\n    .ml-app .ml-time-series-explorer .ml-anomalies-controls {\n      padding-top: 4px; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart svg {\n      font-size: 12px;\n      font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .axis path,\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .axis line {\n      fill: none;\n      stroke: #343741;\n      shape-rendering: crispEdges;\n      pointer-events: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .axis text {\n      fill: #DFE5EF; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .axis .tick line {\n      stroke: rgba(0, 0, 0, 0.1); }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .chart-border {\n      stroke: #343741;\n      fill: none;\n      stroke-width: 1;\n      shape-rendering: crispEdges; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .chart-border-highlight {\n      stroke: #98A2B3;\n      stroke-width: 2; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .chart-border-highlight:hover {\n      opacity: 1; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .area {\n      stroke-width: 1; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .area.bounds {\n      fill: rgba(50, 167, 194, 0.25);\n      pointer-events: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .values-line {\n      fill: none;\n      stroke: #32A7C2;\n      stroke-width: 2;\n      pointer-events: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .values-line.forecast {\n      stroke: #CCA300;\n      pointer-events: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .values-dots circle {\n      fill: #32A7C2;\n      stroke-width: 0; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .hidden {\n      visibility: hidden; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .area.forecast {\n      fill: rgba(204, 163, 0, 0.25);\n      pointer-events: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .metric-value {\n      opacity: 1;\n      fill: transparent;\n      stroke: #32A7C2;\n      stroke-width: 0; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker {\n      stroke-width: 1px;\n      stroke: #AAAAAA; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.critical {\n      fill: #FE5050; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.major {\n      fill: #FBA740; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.minor {\n      fill: #FDEC25; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.warning {\n      fill: #8BC8FB; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.low {\n      fill: #D2E9F7; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .metric-value:hover,\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker:hover,\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.highlighted {\n      stroke-width: 6px;\n      stroke-opacity: .65;\n      stroke: #32A7C2; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart rect.scheduled-event-marker {\n      stroke-width: 1px;\n      stroke: #535966;\n      fill: #343741;\n      pointer-events: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .forecast .metric-value,\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .forecast .metric-value:hover {\n      stroke: #CCA300; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .x-axis-background line {\n      fill: none;\n      shape-rendering: crispEdges;\n      stroke: #25262E; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .x-axis-background rect {\n      fill: #25262E; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .focus-zoom {\n      fill: #98A2B3; }\n      .ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .focus-zoom a text {\n        fill: #36A2EF;\n        cursor: pointer; }\n      .ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .focus-zoom a:hover,\n      .ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .focus-zoom a:active,\n      .ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .focus-zoom a:focus {\n        text-decoration: underline; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .x.axis path {\n      display: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .axis text {\n      font-size: 10px;\n      fill: #DFE5EF; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .area.context {\n      fill: rgba(50, 167, 194, 0.25); }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .values-line {\n      stroke-width: 1; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .area.context.forecast {\n      fill: rgba(204, 163, 0, 0.25); }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .mask polygon {\n      fill-opacity: .1; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .mask .area.bounds {\n      fill: #D6D6D6; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .mask .values-line {\n      stroke-width: 1;\n      stroke: #B8B8B8; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .mask .values-dots circle {\n      fill: #B8B8B8;\n      stroke-width: 0; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .swimlane .axis text {\n      display: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .swimlane rect.swimlane-cell-hidden {\n      display: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .brush .extent {\n      fill-opacity: 0;\n      shape-rendering: crispEdges;\n      stroke: #98A2B3;\n      stroke-width: 2;\n      cursor: move; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .brush .extent:hover {\n      opacity: 1; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .top-border {\n      fill: #1D1E24; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart foreignObject.brush-handle {\n      pointer-events: none;\n      padding-top: 1px; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart div.brush-handle-inner {\n      border: 1px solid #98A2B3;\n      background-color: #343741;\n      height: 70px;\n      width: 10px;\n      text-align: center;\n      cursor: ew-resize;\n      margin-top: 9px;\n      font-size: 14px;\n      fill: #98A2B3; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart div.brush-handle-inner-left {\n      border-radius: 6px 0 0 6px; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart div.brush-handle-inner-right {\n      border-radius: 0 6px 6px 0; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart rect.brush-handle {\n      stroke-width: 1;\n      stroke: #98A2B3;\n      fill: #343741;\n      pointer-events: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart rect.brush-handle:hover {\n      opacity: 1; }\n  .ml-app .mlTimeSeriesExplorerProgress {\n    background-color: #1D1E24; }\n    .ml-app .mlTimeSeriesExplorerProgress::-moz-progress-bar, .ml-app .mlTimeSeriesExplorerProgress::-webkit-progress-bar {\n      background-color: #1D1E24; }\n  .ml-app .mlAnnotationBrush .extent {\n    stroke: #343741;\n    stroke-width: 2px;\n    stroke-dasharray: 2 2;\n    fill: #25262E;\n    shape-rendering: geometricPrecision; }\n  .ml-app .mlAnnotationRect {\n    stroke: #FFF;\n    stroke-width: 2px;\n    stroke-opacity: 0.2;\n    transition: stroke-opacity 150ms;\n    fill: #FFF;\n    fill-opacity: 0.05;\n    transition: fill-opacity 150ms;\n    shape-rendering: geometricPrecision; }\n  .ml-app .mlAnnotationRect-isHighlight {\n    stroke-opacity: 0.4;\n    transition: stroke-opacity 150ms;\n    fill-opacity: 0.1;\n    transition: fill-opacity 150ms; }\n  .ml-app .mlAnnotationRect-isBlur {\n    stroke-opacity: 0.1;\n    transition: stroke-opacity 150ms;\n    fill-opacity: 0.025;\n    transition: fill-opacity 150ms; }\n  .ml-app .mlAnnotationText {\n    text-anchor: middle;\n    font-size: 12px;\n    font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";\n    font-weight: 500;\n    fill: #FFF;\n    transition: fill 150ms; }\n  .ml-app .mlAnnotationText-isBlur {\n    fill: #535966;\n    transition: fill 150ms; }\n  .ml-app .mlAnnotationTextRect {\n    fill: #343741;\n    transition: fill 150ms; }\n  .ml-app .mlAnnotationTextRect-isBlur {\n    fill: #25262E;\n    transition: fill 150ms; }\n  .ml-app .mlAnnotationHidden {\n    display: none; }\n  .ml-app .mlContextAnnotationRect {\n    stroke: #FFF;\n    stroke-width: 2px;\n    stroke-opacity: 0.2;\n    transition: stroke-opacity 150ms;\n    fill: #FFF;\n    fill-opacity: 0.05;\n    transition: fill-opacity 150ms;\n    shape-rendering: geometricPrecision; }\n  .ml-app .mlContextAnnotationRect-isBlur {\n    stroke-opacity: 0.1;\n    transition: stroke-opacity 150ms;\n    fill-opacity: 0.025;\n    transition: fill-opacity 150ms; }\n  .ml-app .euiDescriptionList.euiDescriptionList--column.ml-annotation-description-list .euiDescriptionList__title {\n    flex-basis: 30%; }\n  .ml-app .euiDescriptionList.euiDescriptionList--column.ml-annotation-description-list .euiDescriptionList__description {\n    flex-basis: 70%; }\n  .ml-app .euiDescriptionList.euiDescriptionList--column.ml-annotation-description-list > * {\n    margin-top: 4px; }\n  .ml-app .ml-anomalies-table .ml-icon-severity-critical,\n  .ml-app .ml-anomalies-table .ml-icon-severity-major,\n  .ml-app .ml-anomalies-table .ml-icon-severity-minor,\n  .ml-app .ml-anomalies-table .ml-icon-severity-warning,\n  .ml-app .ml-anomalies-table .ml-icon-severity-unknown {\n    color: inherit;\n    text-shadow: none; }\n  .ml-app .ml-anomalies-table .ml-icon-severity-critical .euiIcon {\n    fill: #FE5050; }\n  .ml-app .ml-anomalies-table .ml-icon-severity-major .euiIcon {\n    fill: #FBA740; }\n  .ml-app .ml-anomalies-table .ml-icon-severity-minor .euiIcon {\n    fill: #FDEC25; }\n  .ml-app .ml-anomalies-table .ml-icon-severity-warning .euiIcon {\n    fill: #8BC8FB; }\n  .ml-app .ml-anomalies-table .ml-icon-severity-unknown .euiIcon {\n    fill: #98A2B3; }\n  .ml-app .ml-anomalies-table tr th:first-child,\n  .ml-app .ml-anomalies-table tr td:first-child {\n    width: 32px; }\n  .ml-app .ml-anomalies-table .euiTableCellContent .euiHealth {\n    font-size: inherit; }\n  .ml-app .ml-anomalies-table .euiTableCellContent .detector-rules-icon {\n    margin-left: 4px;\n    opacity: .5; }\n  .ml-app .ml-anomalies-table .euiContextMenuItem {\n    min-width: 150px; }\n  .ml-app .ml-anomalies-table .mlAnomalyCategoryExamples__header {\n    display: inline; }\n  .ml-app .ml-anomalies-table .mlAnomalyCategoryExamples__link {\n    width: 100%; }\n  .ml-app .ml-anomalies-table .category-example {\n    display: block;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis; }\n  .ml-app .ml-anomalies-table .mlAnomalyCategoryExamples {\n    padding: 24px; }\n  .ml-app .ml-anomalies-table .mlAnomalyCategoryExamples__item {\n    display: block;\n    white-space: wrap;\n    font-family: "Roboto Mono", Consolas, Menlo, Courier, monospace; }\n  .ml-app .ml-anomalies-table .interim-result {\n    font-style: italic; }\n  .ml-app .ml-anomalies-table .ml-anomalies-table-details {\n    padding: 4px 32px;\n    max-height: 1000px;\n    overflow-y: auto; }\n    .ml-app .ml-anomalies-table .ml-anomalies-table-details .anomaly-description-list .euiDescriptionList__title {\n      margin-top: 0;\n      flex-basis: 15%;\n      font-size: inherit;\n      line-height: 1.5rem;\n      max-width: 100%;\n      overflow: hidden !important;\n      text-overflow: ellipsis !important;\n      white-space: nowrap !important;\n      word-wrap: normal !important; }\n    .ml-app .ml-anomalies-table .ml-anomalies-table-details .anomaly-description-list .euiDescriptionList__description {\n      margin-top: 0;\n      flex-basis: 85%;\n      font-size: inherit;\n      line-height: 1.5rem; }\n  .ml-app .mlColorRangeLegend text {\n    font-size: 10px;\n    font-size: 0.71429rem;\n    fill: #98A2B3; }\n  .ml-app .mlColorRangeLegend .axis path {\n    fill: none;\n    stroke: none; }\n  .ml-app .mlColorRangeLegend .axis line {\n    fill: none;\n    stroke: #535966;\n    shape-rendering: crispEdges; }\n  .ml-app .ml-table-controls label {\n    font-size: 12px;\n    padding: 0 0 4px 4px; }\n  .ml-app .ml-table-controls .ml-table-controls-element {\n    display: inline-block;\n    padding-left: 16px; }\n  .ml-app .ml-table-controls select {\n    font-size: 12px;\n    font-style: normal; }\n  .ml-app .ml-select-severity .euiFormControlLayoutClearButton {\n    display: none; }\n  .ml-app .field-value-short {\n    max-width: 100%;\n    overflow: hidden !important;\n    text-overflow: ellipsis !important;\n    white-space: nowrap !important;\n    word-wrap: normal !important;\n    display: inline-block;\n    vertical-align: bottom; }\n  .ml-app .field-value-long {\n    overflow-wrap: break-word; }\n  .ml-app .filter-button {\n    opacity: .3;\n    min-width: 14px;\n    transform: translateY(-1px); }\n    .ml-app .filter-button .euiIcon {\n      width: 12px;\n      height: 12px; }\n  .ml-app .filter-button:hover {\n    opacity: 1; }\n  .ml-app .ml-field-title-bar {\n    font-size: 16px;\n    font-size: 1.14286rem;\n    line-height: 1.71429rem;\n    font-family: Roboto Mono, serif;\n    font-style: normal;\n    font-weight: bold;\n    font-size: 14px;\n    border-radius: 6px 6px 0 0;\n    padding: 4px;\n    margin: -16px -16px 0 -16px;\n    border-top: 3px solid;\n    text-align: center; }\n    .ml-app .ml-field-title-bar .field-type-icon {\n      vertical-align: middle;\n      margin-bottom: -4px;\n      display: inline-block; }\n    .ml-app .ml-field-title-bar .field-name {\n      max-width: 100%;\n      overflow: hidden !important;\n      text-overflow: ellipsis !important;\n      white-space: nowrap !important;\n      word-wrap: normal !important;\n      vertical-align: middle;\n      padding-right: 8px;\n      max-width: 290px;\n      display: inline-block;\n      margin-left: 8px; }\n  .ml-app .ml-influencers-list {\n    line-height: 1.45; }\n    .ml-app .ml-influencers-list .field-label {\n      font-size: 12px;\n      text-align: left;\n      max-height: 14px;\n      max-width: calc(100% - 102px); }\n      .ml-app .ml-influencers-list .field-label .field-value {\n        max-width: 100%;\n        overflow: hidden !important;\n        text-overflow: ellipsis !important;\n        white-space: nowrap !important;\n        word-wrap: normal !important;\n        display: inline-block;\n        vertical-align: bottom; }\n    .ml-app .ml-influencers-list .progress {\n      display: inline-block;\n      width: calc(100% - 34px);\n      height: 22px;\n      min-width: 70px;\n      margin-bottom: 0;\n      color: #98A2B3;\n      background-color: transparent; }\n      .ml-app .ml-influencers-list .progress .progress-bar-holder {\n        width: calc(100% - 28px); }\n      .ml-app .ml-influencers-list .progress .progress-bar {\n        height: 2px;\n        margin-top: 12px;\n        text-align: right;\n        line-height: 18px;\n        display: inline-block;\n        transition: none; }\n    .ml-app .ml-influencers-list .progress.critical .progress-bar {\n      background-color: #FE5050; }\n    .ml-app .ml-influencers-list .progress.critical .score-label {\n      border-color: #FE5050; }\n    .ml-app .ml-influencers-list .progress.major .progress-bar {\n      background-color: #FBA740; }\n    .ml-app .ml-influencers-list .progress.major .score-label {\n      border-color: #FBA740; }\n    .ml-app .ml-influencers-list .progress.minor .progress-bar {\n      background-color: #FDEC25; }\n    .ml-app .ml-influencers-list .progress.minor .score-label {\n      border-color: #FDEC25; }\n    .ml-app .ml-influencers-list .progress.warning .progress-bar {\n      background-color: #8BC8FB; }\n    .ml-app .ml-influencers-list .progress.warning .score-label {\n      border-color: #8BC8FB; }\n    .ml-app .ml-influencers-list .score-label {\n      text-align: center;\n      line-height: 14px;\n      white-space: nowrap;\n      font-size: 12px;\n      display: inline;\n      margin-left: 4px; }\n    .ml-app .ml-influencers-list .total-score-label {\n      width: 32px;\n      vertical-align: top;\n      text-align: center;\n      color: #98A2B3;\n      font-size: 11px;\n      line-height: 14px;\n      border-radius: 6px;\n      padding: 2px;\n      margin-top: 3px;\n      display: inline-block;\n      border: 1px solid #343741; }\n  .ml-app .ml-influencers-list-tooltip {\n    word-break: break-all; }\n  .ml-app .ml-items-grid-page-size-menu {\n    width: 140px; }\n  .ml-app .mlJobSelectorBar {\n    padding: 8px; }\n  .ml-app .mlJobSelectorFlyoutBody > .euiFlyoutBody__overflow {\n    padding-top: 8px; }\n  .ml-app .mlJobSelector__ganttBar {\n    background-color: #79ADDA;\n    height: 12px;\n    border-radius: 2px; }\n  .ml-app .mlJobSelector__ganttBarBackEdge {\n    height: 16px;\n    border-left: 1px solid #D6D6D6;\n    border-right: 1px solid #D6D6D6;\n    margin-bottom: -14px;\n    padding-top: 8px; }\n  .ml-app .mlJobSelector__ganttBarDashed {\n    height: 1px;\n    border-top: 1px dashed #D6D6D6; }\n  .ml-app .mlJobSelector__ganttBarRunning {\n    background-image: linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);\n    background-size: 40px 40px;\n    animation: progress-bar-stripes 2s linear infinite; }\n  .ml-app .ml-loading-indicator {\n    text-align: center;\n    font-size: 17px;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center; }\n  .ml-app .mlNavigationMenu {\n    padding: 0 12px;\n    border-bottom: 1px solid #343741;\n    background-color: #1D1E24; }\n  .ml-app .ml-rule-editor-flyout {\n    font-size: 14px; }\n    .ml-app .ml-rule-editor-flyout .select-rule-action .rule-detector-description-list {\n      padding-left: 16px; }\n    .ml-app .ml-rule-editor-flyout .select-rule-action-panel {\n      padding: 8px 0; }\n      .ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__title {\n        flex-basis: 15%;\n        padding: 0 16px; }\n      .ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__description {\n        flex-basis: 85%; }\n      .ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__title:nth-child(1),\n      .ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__description:nth-child(2) {\n        color: #DFE5EF;\n        font-weight: 700;\n        border-bottom: 1px solid #343741;\n        padding-bottom: 12px; }\n      .ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__title:nth-child(3),\n      .ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__description:nth-child(4) {\n        padding-top: 8px; }\n      .ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList.euiDescriptionList--column > * {\n        margin-top: 4px; }\n    .ml-app .ml-rule-editor-flyout .scope-enable-checkbox .euiCheckbox__input[disabled] ~ .euiCheckbox__label {\n      color: inherit; }\n    .ml-app .ml-rule-editor-flyout .scope-field-checkbox {\n      margin-right: 2px; }\n      .ml-app .ml-rule-editor-flyout .scope-field-checkbox .euiCheckbox {\n        margin-top: 4px; }\n    .ml-app .ml-rule-editor-flyout .scope-field-button {\n      pointer-events: none;\n      border-bottom: none; }\n    .ml-app .ml-rule-editor-flyout .scope-edit-filter-link {\n      line-height: 32px;\n      font-size: 12px; }\n    .ml-app .ml-rule-editor-flyout .condition-edit-value-field {\n      width: 170px;\n      height: 28px;\n      margin: 0 2px; }\n      .ml-app .ml-rule-editor-flyout .condition-edit-value-field input {\n        height: 28px; }\n    .ml-app .ml-rule-editor-flyout .euiExpressionButton.disabled {\n      pointer-events: none; }\n      .ml-app .ml-rule-editor-flyout .euiExpressionButton.disabled .euiExpressionButton__value,\n      .ml-app .ml-rule-editor-flyout .euiExpressionButton.disabled .euiExpressionButton__description {\n        color: #343741; }\n    .ml-app .ml-rule-editor-flyout .text-highlight {\n      font-weight: 700; }\n  .ml-app .euiDescriptionList.euiDescriptionList--column.rule-detector-description-list .euiDescriptionList__title {\n    flex-basis: 15%; }\n  .ml-app .euiDescriptionList.euiDescriptionList--column.rule-detector-description-list .euiDescriptionList__description {\n    flex-basis: 85%; }\n  .ml-app .euiDescriptionList.euiDescriptionList--column.rule-detector-description-list > * {\n    margin-top: 4px; }\n  .ml-app .stat {\n    margin-right: 8px; }\n  .ml-app .mlStatsBar {\n    height: 42px;\n    padding: 14px;\n    background-color: #25262E; }\n  .ml-app .mlEmbeddedMapContent {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    flex: 1 1 100%;\n    z-index: 1;\n    min-height: 0; }\n  .ml-app .tab-datavisualizer_index_select,\n  .ml-app .tab-timeseriesexplorer,\n  .ml-app .tab-explorer {\n    background-color: #1D1E24; }\n  .ml-app .button-wrapper {\n    display: inline; }\n  .ml-app .button-wrapper.disabled .kuiButton[disabled] {\n    pointer-events: none; }\n  .ml-app .button-wrapper.disabled {\n    cursor: not-allowed; }\n  .ml-app .clear, .ml-app .clearfix {\n    clear: both; }\n  .ml-app .mlDisableAntiAliasing {\n    -webkit-font-smoothing: none; }\n    .ml-app .mlDisableAntiAliasing * canvas {\n      image-rendering: pixelated; }\n',""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(430);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,'.ml-app {\n  /*\n  Resets the badge\'s default strong font-weight so it\'s possible\n  to put custom emphasis inside the badge only on a part of it.\n  Used in the Explorer Chart label badge to display an entity\'s\n  field_name as `normal` and field_value as `strong`.\n*/\n  /* wrapper class for the top right alert icon and view button */\n  /* Hides the progress bar\'s background so it doesn\'t look like it increases the thickness\n   of the horizontal bar below the tab menu elements in its inactive state. */\n  /* Overrides for d3/svg default styles */ }\n  .ml-app .ml-icon-severity-critical,\n  .ml-app .ml-icon-severity-major,\n  .ml-app .ml-icon-severity-minor,\n  .ml-app .ml-icon-severity-warning,\n  .ml-app .ml-icon-severity-unknown {\n    text-shadow: 1px 1px 1px #D3DAE6; }\n  .ml-app .ml-icon-severity-critical {\n    color: #cf4141; }\n  .ml-app .ml-icon-severity-major {\n    color: #9e6929; }\n  .ml-app .ml-icon-severity-minor {\n    color: #7c7313; }\n  .ml-app .ml-icon-severity-warning {\n    color: #537896; }\n  .ml-app .ml-icon-severity-unknown {\n    color: #69707D; }\n  .ml-app .mlDataFrameAnalyticsRegression__evaluateStat {\n    padding-top: 24px; }\n  .ml-app .mlJobMapLegend__container {\n    background-color: \'#FFFFFF\'; }\n  .ml-app .mlJobMapLegend__indexPattern {\n    height: 12px;\n    width: 12px;\n    background-color: #FFF;\n    border: 2px solid #D36086;\n    transform: rotate(45deg);\n    display: \'inline-block\'; }\n  .ml-app .mlJobMapLegend__transform {\n    height: 12px;\n    width: 12px;\n    background-color: #FFF;\n    border: 2px solid #6092C0;\n    display: \'inline-block\'; }\n  .ml-app .mlJobMapLegend__analytics {\n    height: 12px;\n    width: 12px;\n    background-color: #FFF;\n    border: 2px solid #54B399;\n    border-radius: 50%;\n    display: \'inline-block\'; }\n  .ml-app .mlJobMapLegend__sourceNode {\n    height: 12px;\n    width: 12px;\n    background-color: #FEC514;\n    border: 1px solid #D3DAE6;\n    border-radius: 6px;\n    display: \'inline-block\'; }\n  .ml-app .mlAnalyticsTable .euiTableRow-isExpandedRow .euiTableCellContent {\n    animation: none !important; }\n    .ml-app .mlAnalyticsTable .euiTableRow-isExpandedRow .euiTableCellContent .euiTableCellContent__text {\n      width: 100%; }\n  .ml-app .mlAnalyticsTable .euiIcon-isLoaded {\n    animation: none !important; }\n  .ml-app .mlTaskStateBadge, .ml-app .mlTaskModeBadge {\n    max-width: 100px; }\n  .ml-app .dataFrameAnalyticsCreateSearchDialog {\n    width: 720px;\n    min-height: 600px; }\n  .ml-app .dfAnalyticsCreationWizard__card {\n    width: 300px; }\n  .ml-app .file-datavisualizer-file-picker {\n    max-width: inherit; }\n    .ml-app .file-datavisualizer-file-picker .euiFilePicker__prompt {\n      background-color: #FFF;\n      box-shadow: none; }\n      .ml-app .file-datavisualizer-file-picker .euiFilePicker__prompt .euiFilePicker__icon {\n        width: 40px;\n        height: 40px; }\n  .ml-app .results .euiDescriptionList dd, .ml-app .results .euiDescriptionList dt {\n    margin-top: 5px; }\n  .ml-app .results .euiDescriptionList dd:nth-child(1), .ml-app .results .euiDescriptionList dt:nth-child(1) {\n    margin-top: 0; }\n  .ml-app .analysis-summary-list.euiDescriptionList .euiDescriptionList__title {\n    flex-basis: 15%; }\n  .ml-app .analysis-summary-list.euiDescriptionList .euiDescriptionList__description {\n    flex-basis: 85%; }\n  .ml-app .file-datavisualizer-about-panel__icon {\n    width: 96px;\n    height: 96px;\n    margin-left: 32px;\n    margin-right: 24px; }\n  .ml-app .euiFlexItem.file-datavisualizer-about-panel__doc-icon {\n    margin-left: 32px;\n    margin-right: 4px;\n    margin-top: 16px; }\n  .ml-app .import-summary-list.euiDescriptionList .euiDescriptionList__title {\n    flex-basis: 15%; }\n  .ml-app .import-summary-list.euiDescriptionList .euiDescriptionList__description {\n    flex-basis: 85%; }\n  .ml-app .failure-list {\n    max-height: 200px;\n    overflow-y: auto; }\n    .ml-app .failure-list .error-message {\n      color: #BD271E; }\n  .ml-app .ml-experimental-badge.euiBetaBadge {\n    font-size: 10px;\n    vertical-align: middle;\n    margin-bottom: 5px;\n    padding: 0 20px;\n    line-height: 20px; }\n  .ml-app .mlFieldDataTopValuesContainer {\n    padding-top: 4px; }\n  .ml-app .mlTopValuesValueLabelContainer {\n    margin-right: 12px; }\n    .ml-app .mlTopValuesValueLabelContainer.mlTopValuesValueLabelContainer--small {\n      width: 70px; }\n    .ml-app .mlTopValuesValueLabelContainer.mlTopValuesValueLabelContainer--large {\n      width: 200px; }\n  .ml-app .mlTopValuesPercentLabelContainer {\n    margin-left: 12px;\n    width: 70px; }\n  .ml-app .mlMetricDistributionChartContainer {\n    padding-top: 4px;\n    width: 100%; }\n  @media only screen and (max-width: 574px) {\n    .ml-app .mlDataVisualizerExpandedRow {\n      flex-direction: column; } }\n  @media only screen and (min-width: 575px) and (max-width: 767px) {\n    .ml-app .mlDataVisualizerExpandedRow {\n      flex-direction: column; } }\n  @media only screen and (min-width: 768px) and (max-width: 991px) {\n    .ml-app .mlDataVisualizerExpandedRow {\n      flex-direction: column; } }\n  .ml-app .mlDataVisualizerFieldCountContainer {\n    max-width: 300px; }\n  .ml-app .mlDataVisualizerColumnHeaderIcon {\n    max-width: 12px; }\n  .ml-app .mlDataVisualizerFieldExpandedRow {\n    padding-left: 64px;\n    width: 100%; }\n    .ml-app .mlDataVisualizerFieldExpandedRow .mlFieldDataCard__valuesTitle {\n      text-transform: uppercase;\n      text-align: left;\n      color: #69707D;\n      font-weight: bold;\n      padding-bottom: 8px; }\n    .ml-app .mlDataVisualizerFieldExpandedRow .mlFieldDataCard__codeContent {\n      font-family: "Roboto Mono", Consolas, Menlo, Courier, monospace;\n      letter-spacing: normal; }\n  .ml-app .mlDataVisualizer .euiTableRow > .euiTableRowCell {\n    border-bottom: 0;\n    border-top: 1px solid #D3DAE6; }\n  .ml-app .mlDataVisualizer .euiTableRow-isExpandedRow .euiTableRowCell {\n    background-color: #FFF !important;\n    border-top: 0;\n    border-bottom: 1px solid #D3DAE6; }\n    .ml-app .mlDataVisualizer .euiTableRow-isExpandedRow .euiTableRowCell:hover {\n      background-color: #FFF !important; }\n  .ml-app .mlDataVisualizer .mlDataVisualizerSummaryTable {\n    max-width: 350px;\n    min-width: 250px; }\n    .ml-app .mlDataVisualizer .mlDataVisualizerSummaryTable .euiTableRow > .euiTableRowCell {\n      border-bottom: 0; }\n    .ml-app .mlDataVisualizer .mlDataVisualizerSummaryTable .euiTableHeaderCell {\n      display: none; }\n  .ml-app .mlDataVisualizer .mlDataVisualizerSummaryTableWrapper {\n    max-width: 300px; }\n  .ml-app .mlDataVisualizer .mlDataVisualizerMapWrapper {\n    min-height: 300px;\n    min-width: 600px; }\n  .ml-app .ml-explorer {\n    width: 100%;\n    display: inline-block;\n    color: #69707D; }\n    .ml-app .ml-explorer .mlAnomalyExplorer__filterBar {\n      padding-right: 16px;\n      padding-left: 16px; }\n    .ml-app .ml-explorer .results-container {\n      padding: 0 0 16px 0; }\n      .ml-app .ml-explorer .results-container .col-xs-12 {\n        width: calc(100% - 32px);\n        padding-left: 16px; }\n      .ml-app .ml-explorer .results-container .no-influencers-warning {\n        float: left;\n        padding-top: 4px;\n        padding-left: 16px;\n        color: #69707D;\n        font-size: 14px; }\n      .ml-app .ml-explorer .results-container .panel-title {\n        font-size: 16px;\n        font-weight: 400;\n        color: #69707D;\n        display: inline-block;\n        padding-bottom: 4px; }\n      .ml-app .ml-explorer .results-container .panel-sub-title {\n        color: #69707D;\n        font-size: 12px; }\n    .ml-app .ml-explorer .ml-anomalies-controls {\n      padding-top: 4px; }\n      .ml-app .ml-explorer .ml-anomalies-controls #show_charts_checkbox_control {\n        padding-top: 24px; }\n  .ml-app .mlSwimLaneContainer {\n    /* Override legend styles */ }\n    .ml-app .mlSwimLaneContainer .echLegendListContainer {\n      height: 34px !important; }\n    .ml-app .mlSwimLaneContainer .echLegendList {\n      display: flex !important;\n      justify-content: space-between !important;\n      flex-wrap: nowrap;\n      position: absolute;\n      right: 0; }\n  .ml-app .ml-explorer-chart-eui-icon-tip {\n    max-width: none; }\n  .ml-app .ml-explorer-chart-label-badges {\n    margin-top: 3px; }\n  .ml-app .ml-reset-font-weight {\n    font-weight: normal; }\n  .ml-app .ml-explorer-chart-container {\n    overflow: hidden; }\n    .ml-app .ml-explorer-chart-container .ml-explorer-chart-svg {\n      font-size: 12px;\n      font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; }\n      .ml-app .ml-explorer-chart-container .ml-explorer-chart-svg .line-chart rect {\n        fill: #FFF;\n        opacity: 1; }\n      .ml-app .ml-explorer-chart-container .ml-explorer-chart-svg .line-chart rect.selected-interval {\n        fill: rgba(200, 200, 200, 0.1);\n        stroke: #69707D;\n        stroke-width: 2px;\n        stroke-opacity: .8; }\n      .ml-app .ml-explorer-chart-container .ml-explorer-chart-svg .line-chart rect.scheduled-event-marker {\n        stroke-width: 1px;\n        stroke: #98A2B3;\n        fill: #D3DAE6;\n        pointer-events: none; }\n    .ml-app .ml-explorer-chart-container .axis path, .ml-app .ml-explorer-chart-container .axis line {\n      fill: none;\n      stroke: #D3DAE6;\n      shape-rendering: crispEdges; }\n    .ml-app .ml-explorer-chart-container .axis .tick line.ml-tick-emphasis {\n      stroke: rgba(0, 0, 0, 0.2); }\n    .ml-app .ml-explorer-chart-container .axis text {\n      fill: #69707D; }\n    .ml-app .ml-explorer-chart-container .axis .tick line {\n      stroke: rgba(0, 0, 0, 0.05);\n      stroke-width: 1px; }\n    .ml-app .ml-explorer-chart-container .values-line {\n      fill: none;\n      stroke: #32A7C2;\n      stroke-width: 2; }\n    .ml-app .ml-explorer-chart-container .values-dots circle,\n    .ml-app .ml-explorer-chart-container .values-dots-circle {\n      fill: #32A7C2;\n      stroke-width: 0; }\n    .ml-app .ml-explorer-chart-container .values-dots circle.values-dots-circle-blur {\n      fill: #AAA; }\n    .ml-app .ml-explorer-chart-container .metric-value {\n      opacity: 1;\n      fill: transparent;\n      stroke: #32A7C2;\n      stroke-width: 0; }\n    .ml-app .ml-explorer-chart-container .anomaly-marker {\n      stroke-width: 1px;\n      stroke: #AAAAAA; }\n    .ml-app .ml-explorer-chart-container .anomaly-marker:hover {\n      stroke-width: 6px;\n      stroke: #32A7C2; }\n    .ml-app .ml-explorer-chart-container .anomaly-marker.critical {\n      fill: #FE5050; }\n    .ml-app .ml-explorer-chart-container .anomaly-marker.major {\n      fill: #FBA740; }\n    .ml-app .ml-explorer-chart-container .anomaly-marker.minor {\n      fill: #FDEC25; }\n    .ml-app .ml-explorer-chart-container .anomaly-marker.warning {\n      fill: #8BC8FB; }\n    .ml-app .ml-explorer-chart-container .anomaly-marker.low {\n      fill: #D2E9F7; }\n    .ml-app .ml-explorer-chart-container .metric-value:hover,\n    .ml-app .ml-explorer-chart-container .anomaly-marker:hover {\n      stroke-width: 6px;\n      stroke-opacity: .65; }\n  .ml-app .ml-explorer-chart {\n    overflow: hidden; }\n  .ml-app .ml-explorer-chart-content-wrapper {\n    height: 215px; }\n  .ml-app .ml-explorer-chart-axis-emphasis {\n    font-weight: bold; }\n  .ml-app .explorer-charts ml-explorer-charts-container .row {\n    padding: 10px; }\n  .ml-app .explorer-charts ml-explorer-charts-container label {\n    font-size: 12px; }\n  .ml-app .explorer-charts ml-explorer-charts-container select {\n    font-size: 14px;\n    font-style: 400; }\n  .ml-app .explorer-charts ml-explorer-charts-container .chart-controls label {\n    padding: 0 0 10px 0; }\n  .ml-app .explorer-charts ml-explorer-charts-container .no-results-item {\n    text-align: center;\n    padding-top: 10px; }\n  .ml-app .explorer-charts ml-explorer-charts-container .ml-anomaly-interim-result {\n    font-style: italic;\n    padding-bottom: 3px; }\n  .ml-app .explorer-charts ml-explorer-charts-container .ml-tablerow-expanded {\n    width: 100%;\n    padding: 5px 20px;\n    overflow: hidden;\n    font-size: 12px; }\n    .ml-app .explorer-charts ml-explorer-charts-container .ml-tablerow-expanded td {\n      padding: 0 0 2px 0; }\n    .ml-app .explorer-charts ml-explorer-charts-container .ml-tablerow-expanded table tr > td:first-child {\n      padding-left: 2px;\n      vertical-align: top; }\n    .ml-app .explorer-charts ml-explorer-charts-container .ml-tablerow-expanded td:first-child {\n      width: 140px; }\n    .ml-app .explorer-charts ml-explorer-charts-container .ml-tablerow-expanded td:nth-child(2) {\n      padding-left: 5px; }\n  .ml-app .ml-explorer-chart-icons {\n    float: right;\n    padding-left: 5px;\n    /* counter-margin for EuiButtonEmpty\'s padding */\n    margin: 2px -8px 0 0; }\n  .ml-app .ml-edit-url-form .url-label {\n    width: 250px; }\n  .ml-app .ml-edit-url-form .url-link-to-radio .euiRadio {\n    display: inline-block;\n    padding-right: 24px; }\n  .ml-app .ml-edit-url-form .url-time-range {\n    width: 150px; }\n  .ml-app .new-job-button-container {\n    float: right; }\n  .ml-app .edit-custom-url-panel .close-editor-button {\n    position: relative;\n    float: right;\n    top: -4px;\n    right: 0; }\n  .ml-app .tab-contents {\n    margin: -8px;\n    padding: 8px;\n    background-color: #FFF; }\n    .ml-app .tab-contents .col-md-6:nth-child(1) {\n      padding-right: 7px; }\n    .ml-app .tab-contents .col-md-6:nth-child(2) {\n      padding-left: 7px; }\n    .ml-app .tab-contents .job-section {\n      overflow: auto;\n      padding: 5px 15px;\n      background-color: #F5F7FA;\n      border: 1px solid #D3DAE6;\n      border-radius: 6px;\n      margin: 4px 0; }\n      .ml-app .tab-contents .job-section .euiTable {\n        background-color: transparent; }\n        .ml-app .tab-contents .job-section .euiTable .euiTableRow:first-child .euiTableRowCell {\n          border-top: 0; }\n        .ml-app .tab-contents .job-section .euiTable .euiTableRow:last-child .euiTableRowCell {\n          border-bottom: 0; }\n        .ml-app .tab-contents .job-section .euiTable .euiTableRow .euiTableRowCell {\n          vertical-align: top;\n          border-bottom: 1px solid #D3DAE6; }\n          .ml-app .tab-contents .job-section .euiTable .euiTableRow .euiTableRowCell .euiTableCellContent__text {\n            word-wrap: break-word; }\n        .ml-app .tab-contents .job-section .euiTable .euiTableRow:hover {\n          background-color: inherit; }\n      .ml-app .tab-contents .job-section .job-item {\n        font-size: 12px; }\n      .ml-app .tab-contents .job-section .job-item.header {\n        font-weight: bold; }\n    .ml-app .tab-contents .json-textarea {\n      height: 500px; }\n  .ml-app .job-messages-table {\n    max-height: 500px;\n    overflow: auto;\n    text-align: left; }\n    .ml-app .job-messages-table tr:last-child td {\n      border-bottom: none; }\n    .ml-app .job-messages-table .euiTableRowCell {\n      background-color: #FFF; }\n  .ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .group-item {\n    padding: 8px 16px; }\n  .ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .inline-group {\n    border: 1px solid #FFF;\n    border-radius: 6px; }\n  .ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .euiFilterSelectItem:hover, .ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .euiFilterSelectItem:focus {\n    text-decoration: none; }\n    .ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .euiFilterSelectItem:hover .inline-group, .ml-app .mlJobFilterBar .euiFilterGroup .euiPopover .euiPanel .euiFilterSelectItem:focus .inline-group {\n      border: 1px solid #69707D;\n      box-shadow: 0 1px 2px #98A2B3; }\n  .ml-app .inline-group {\n    font-size: 12px;\n    background-color: #D3DAE6;\n    padding: 2px 5px;\n    border-radius: 2px;\n    display: inline-block;\n    margin: 0 3px;\n    color: #FFF;\n    vertical-align: text-top; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th {\n    text-align: left;\n    white-space: normal; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(2) {\n    width: 34px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(3) {\n    width: auto; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(4) {\n    width: 20px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(5) {\n    width: auto; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(6) {\n    width: 100px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(7) {\n    width: 85px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(8) {\n    width: 80px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(9) {\n    width: 80px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(10) {\n    width: 150px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(11) {\n    width: 80px; }\n  .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(12) {\n    width: 30px; }\n    .ml-app .jobs-list-table > div > .euiTable > thead th:nth-child(12) .euiTableCellContent__text {\n      display: none; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody td:nth-child(4) .euiTableCellContent {\n    padding: 0; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody td:nth-child(10) {\n    white-space: nowrap; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody .euiTableCellContent {\n    animation: unset; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody .euiTableRow.euiTableRow-isExpandedRow > td > div > .euiTableCellContent__text {\n    width: 100%; }\n    .ml-app .jobs-list-table > div > .euiTable > tbody .euiTableRow.euiTableRow-isExpandedRow > td > div > .euiTableCellContent__text .euiTableRowCell {\n      background-color: inherit; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody .euiTableRow > .euiTableRowCell > .euiTableCellContent > .euiTableCellContent__hoverItem {\n    opacity: 1; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody .euiContextMenuPanel .euiContextMenuItem {\n    white-space: nowrap; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody .euiContextMenuPanel .euiContextMenuItem:last-child:not(.euiContextMenuItem-isDisabled) {\n    color: #BD271E; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody .results-button {\n    margin-right: 4px;\n    width: 18px; }\n  .ml-app .jobs-list-table > div > .euiTable > tbody .euiContextMenuItem .euiIcon {\n    margin-right: 4px; }\n  .ml-app .jobs-list-table > div > .euiTable .actions-border {\n    height: 20px;\n    border-right: 1px solid #D3DAE6;\n    width: 1px;\n    display: inline-block;\n    vertical-align: middle;\n    margin: 0 4px; }\n  .ml-app .jobs-list-table > div > .euiTable .job-description {\n    display: inline-block; }\n  .ml-app .jobs-list-table > div > .euiTable .job-loading-spinner {\n    text-align: center; }\n  .ml-app .jobs-list-table.jobs-selected .results-button {\n    color: #D3DAE6;\n    pointer-events: none; }\n  .ml-app .actions-bar {\n    min-height: 60px;\n    display: flex;\n    align-items: center; }\n  .ml-app .job-management {\n    padding: 20px; }\n  .ml-app .multi-select-actions {\n    padding-right: 8px;\n    padding-bottom: 12px;\n    display: inline-block;\n    white-space: nowrap; }\n    .ml-app .multi-select-actions .actions-border, .ml-app .multi-select-actions .actions-border-large {\n      height: 20px;\n      border-right: 1px solid #D3DAE6;\n      width: 1px;\n      display: inline-block;\n      vertical-align: middle;\n      margin: 0 5px; }\n    .ml-app .multi-select-actions .actions-border-large {\n      height: 35px;\n      margin: 0 15px;\n      margin-top: -5px; }\n    .ml-app .multi-select-actions .results-button {\n      margin-right: 5px; }\n    .ml-app .multi-select-actions .euiContextMenuPanel .euiContextMenuItem__text {\n      white-space: nowrap; }\n    .ml-app .multi-select-actions .euiContextMenuPanel .euiContextMenuItem:last-child:not(.euiContextMenuItem-isDisabled) {\n      color: #BD271E; }\n  .ml-app .multi-select-actions-no-display {\n    display: none; }\n  .ml-app .group-selector {\n    max-width: 300px; }\n    .ml-app .group-selector .euiPopoverTitle {\n      margin-bottom: 8px !important; }\n  .ml-app .group-list {\n    max-height: 350px;\n    overflow: auto; }\n    .ml-app .group-list .group-item {\n      line-height: 18px;\n      padding: 6px 0;\n      border-bottom: 1px solid #D3DAE6;\n      cursor: pointer; }\n      .ml-app .group-list .group-item:focus {\n        background-color: #EEF6F9;\n        box-shadow: none; }\n      .ml-app .group-list .group-item .check {\n        width: 20px;\n        display: inline-block; }\n      .ml-app .group-list .group-item .inline-group {\n        border: 1px solid #FFF;\n        border-radius: 6px; }\n    .ml-app .group-list .group-item:hover .inline-group {\n      border: 1px solid #69707D;\n      box-shadow: 0 1px 2px #98A2B3; }\n    .ml-app .group-list .group-item:last-child {\n      margin-bottom: 0;\n      border-bottom: none; }\n  .ml-app .new-group-input {\n    padding-bottom: 0; }\n  .ml-app .ml-custom-urls-selection > .euiFlexGroup > .euiFlexItem:first-child {\n    max-width: 388px; }\n  .ml-app .ml-custom-urls-selection > .euiFlexGroup > .euiFlexItem:last-child {\n    flex-basis: 50%; }\n  .ml-app .mlOverviewPanel {\n    padding-top: 0; }\n  .ml-app .mlOverviewPanel__isLoading {\n    text-align: center;\n    padding: 10%; }\n  .ml-app .mlOverviewPanel__buttons {\n    float: right; }\n  .ml-app .mlOverviewPanel__spinner {\n    display: inline-block; }\n  .ml-app .mlOverviewPanel__refreshButton {\n    padding-right: 12px; }\n  .ml-app .mlOverviewPanel__statsBar {\n    margin-top: 0;\n    margin-right: 0; }\n  .ml-app .mlSettingsPage .mlSettingsPage__header {\n    width: 1200px;\n    margin-left: auto;\n    margin-right: auto; }\n  .ml-app .mlSettingsPage .mlSettingsPage__content {\n    width: 1200px;\n    margin-top: 16px;\n    margin-bottom: 16px; }\n  .ml-app .ml-list-filter-lists .ml-list-filter-lists-content {\n    max-width: 1100px;\n    margin-top: 16px;\n    margin-bottom: 16px; }\n  .ml-app .ml-list-filter-lists .ml-filter-lists-table th:last-child, .ml-app .ml-list-filter-lists .ml-filter-lists-table td:last-child {\n    width: 70px; }\n  .ml-app .ml-edit-filter-lists .ml-edit-filter-lists-content {\n    max-width: 1100px;\n    width: 100%;\n    margin-top: 16px;\n    margin-bottom: 16px; }\n  .ml-app .ml-edit-filter-lists .ml-filter-list-usage > div {\n    display: inline; }\n  .ml-app .ml-edit-filter-lists .ml-filter-list-usage .euiButtonEmpty.euiButtonEmpty--small {\n    padding-bottom: 4px; }\n  .ml-app .ml-edit-filter-lists .ml-filter-list-usage .euiButtonEmpty .euiButtonEmpty__content {\n    padding: 0 4px; }\n  .ml-app .ml-add-filter-item-popover .euiFormRow {\n    width: 300px;\n    padding-bottom: 4px; }\n  .ml-app .ml-filter-list-usage-popover li {\n    line-height: 24px; }\n  .ml-app .mlCalendarEditForm .mlCalendarEditForm__content {\n    max-width: 1200px;\n    width: 100%;\n    margin-top: 16px;\n    margin-bottom: 16px; }\n  .ml-app .mlCalendarList .mlCalendarList__content {\n    max-width: 1200px;\n    margin-top: 16px;\n    margin-bottom: 16px; }\n  .ml-app .ml-time-series-explorer {\n    color: #69707D; }\n    .ml-app .ml-time-series-explorer .no-results-container {\n      text-align: center;\n      font-size: 22px;\n      padding-top: 60px; }\n      .ml-app .ml-time-series-explorer .no-results-container .no-results {\n        background-color: rgba(0, 119, 204, 0.1);\n        padding: 16px;\n        border-radius: 6px;\n        display: inline-block; }\n        .ml-app .ml-time-series-explorer .no-results-container .no-results i {\n          color: #07C;\n          margin-right: 4px; }\n        .ml-app .ml-time-series-explorer .no-results-container .no-results div:nth-child(2) {\n          margin-top: 8px;\n          font-size: 12px; }\n    .ml-app .ml-time-series-explorer .results-container .panel-title {\n      font-size: 16px;\n      font-weight: 400;\n      color: #69707D; }\n    .ml-app .ml-time-series-explorer .results-container .entity-count-text {\n      color: #00BFB3;\n      font-size: 14px; }\n    .ml-app .ml-time-series-explorer .forecast-controls {\n      float: right; }\n    .ml-app .ml-time-series-explorer .ml-anomalies-controls {\n      padding-top: 4px; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart svg {\n      font-size: 12px;\n      font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .axis path,\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .axis line {\n      fill: none;\n      stroke: #D3DAE6;\n      shape-rendering: crispEdges;\n      pointer-events: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .axis text {\n      fill: #343741; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .axis .tick line {\n      stroke: rgba(0, 0, 0, 0.1); }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .chart-border {\n      stroke: #D3DAE6;\n      fill: none;\n      stroke-width: 1;\n      shape-rendering: crispEdges; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .chart-border-highlight {\n      stroke: #69707D;\n      stroke-width: 2; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .chart-border-highlight:hover {\n      opacity: 1; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .area {\n      stroke-width: 1; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .area.bounds {\n      fill: rgba(50, 167, 194, 0.25);\n      pointer-events: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .values-line {\n      fill: none;\n      stroke: #32A7C2;\n      stroke-width: 2;\n      pointer-events: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .values-line.forecast {\n      stroke: #CCA300;\n      pointer-events: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .values-dots circle {\n      fill: #32A7C2;\n      stroke-width: 0; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .hidden {\n      visibility: hidden; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .area.forecast {\n      fill: rgba(204, 163, 0, 0.25);\n      pointer-events: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .metric-value {\n      opacity: 1;\n      fill: transparent;\n      stroke: #32A7C2;\n      stroke-width: 0; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker {\n      stroke-width: 1px;\n      stroke: #AAAAAA; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.critical {\n      fill: #FE5050; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.major {\n      fill: #FBA740; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.minor {\n      fill: #FDEC25; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.warning {\n      fill: #8BC8FB; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.low {\n      fill: #D2E9F7; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .metric-value:hover,\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker:hover,\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .anomaly-marker.highlighted {\n      stroke-width: 6px;\n      stroke-opacity: .65;\n      stroke: #32A7C2; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart rect.scheduled-event-marker {\n      stroke-width: 1px;\n      stroke: #98A2B3;\n      fill: #D3DAE6;\n      pointer-events: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .forecast .metric-value,\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .forecast .metric-value:hover {\n      stroke: #CCA300; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .x-axis-background line {\n      fill: none;\n      shape-rendering: crispEdges;\n      stroke: #F5F7FA; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .x-axis-background rect {\n      fill: #F5F7FA; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .focus-zoom {\n      fill: #69707D; }\n      .ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .focus-zoom a text {\n        fill: #07C;\n        cursor: pointer; }\n      .ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .focus-zoom a:hover,\n      .ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .focus-zoom a:active,\n      .ml-app .ml-time-series-explorer .ml-timeseries-chart .focus-chart .focus-zoom a:focus {\n        text-decoration: underline; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .x.axis path {\n      display: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .axis text {\n      font-size: 10px;\n      fill: #343741; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .area.context {\n      fill: rgba(50, 167, 194, 0.25); }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .values-line {\n      stroke-width: 1; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .area.context.forecast {\n      fill: rgba(204, 163, 0, 0.25); }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .mask polygon {\n      fill-opacity: .1; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .mask .area.bounds {\n      fill: #D6D6D6; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .mask .values-line {\n      stroke-width: 1;\n      stroke: #B8B8B8; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .context-chart .mask .values-dots circle {\n      fill: #B8B8B8;\n      stroke-width: 0; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .swimlane .axis text {\n      display: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .swimlane rect.swimlane-cell-hidden {\n      display: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .brush .extent {\n      fill-opacity: 0;\n      shape-rendering: crispEdges;\n      stroke: #69707D;\n      stroke-width: 2;\n      cursor: move; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .brush .extent:hover {\n      opacity: 1; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart .top-border {\n      fill: #FFF; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart foreignObject.brush-handle {\n      pointer-events: none;\n      padding-top: 1px; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart div.brush-handle-inner {\n      border: 1px solid #69707D;\n      background-color: #D3DAE6;\n      height: 70px;\n      width: 10px;\n      text-align: center;\n      cursor: ew-resize;\n      margin-top: 9px;\n      font-size: 14px;\n      fill: #69707D; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart div.brush-handle-inner-left {\n      border-radius: 6px 0 0 6px; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart div.brush-handle-inner-right {\n      border-radius: 0 6px 6px 0; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart rect.brush-handle {\n      stroke-width: 1;\n      stroke: #69707D;\n      fill: #D3DAE6;\n      pointer-events: none; }\n    .ml-app .ml-time-series-explorer .ml-timeseries-chart rect.brush-handle:hover {\n      opacity: 1; }\n  .ml-app .mlTimeSeriesExplorerProgress {\n    background-color: #FFF; }\n    .ml-app .mlTimeSeriesExplorerProgress::-moz-progress-bar, .ml-app .mlTimeSeriesExplorerProgress::-webkit-progress-bar {\n      background-color: #FFF; }\n  .ml-app .mlAnnotationBrush .extent {\n    stroke: #D3DAE6;\n    stroke-width: 2px;\n    stroke-dasharray: 2 2;\n    fill: #F5F7FA;\n    shape-rendering: geometricPrecision; }\n  .ml-app .mlAnnotationRect {\n    stroke: #000;\n    stroke-width: 2px;\n    stroke-opacity: 0.2;\n    transition: stroke-opacity 150ms;\n    fill: #000;\n    fill-opacity: 0.05;\n    transition: fill-opacity 150ms;\n    shape-rendering: geometricPrecision; }\n  .ml-app .mlAnnotationRect-isHighlight {\n    stroke-opacity: 0.4;\n    transition: stroke-opacity 150ms;\n    fill-opacity: 0.1;\n    transition: fill-opacity 150ms; }\n  .ml-app .mlAnnotationRect-isBlur {\n    stroke-opacity: 0.1;\n    transition: stroke-opacity 150ms;\n    fill-opacity: 0.025;\n    transition: fill-opacity 150ms; }\n  .ml-app .mlAnnotationText {\n    text-anchor: middle;\n    font-size: 12px;\n    font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";\n    font-weight: 500;\n    fill: #000;\n    transition: fill 150ms; }\n  .ml-app .mlAnnotationText-isBlur {\n    fill: #98A2B3;\n    transition: fill 150ms; }\n  .ml-app .mlAnnotationTextRect {\n    fill: #D3DAE6;\n    transition: fill 150ms; }\n  .ml-app .mlAnnotationTextRect-isBlur {\n    fill: #F5F7FA;\n    transition: fill 150ms; }\n  .ml-app .mlAnnotationHidden {\n    display: none; }\n  .ml-app .mlContextAnnotationRect {\n    stroke: #000;\n    stroke-width: 2px;\n    stroke-opacity: 0.2;\n    transition: stroke-opacity 150ms;\n    fill: #000;\n    fill-opacity: 0.05;\n    transition: fill-opacity 150ms;\n    shape-rendering: geometricPrecision; }\n  .ml-app .mlContextAnnotationRect-isBlur {\n    stroke-opacity: 0.1;\n    transition: stroke-opacity 150ms;\n    fill-opacity: 0.025;\n    transition: fill-opacity 150ms; }\n  .ml-app .euiDescriptionList.euiDescriptionList--column.ml-annotation-description-list .euiDescriptionList__title {\n    flex-basis: 30%; }\n  .ml-app .euiDescriptionList.euiDescriptionList--column.ml-annotation-description-list .euiDescriptionList__description {\n    flex-basis: 70%; }\n  .ml-app .euiDescriptionList.euiDescriptionList--column.ml-annotation-description-list > * {\n    margin-top: 4px; }\n  .ml-app .ml-anomalies-table .ml-icon-severity-critical,\n  .ml-app .ml-anomalies-table .ml-icon-severity-major,\n  .ml-app .ml-anomalies-table .ml-icon-severity-minor,\n  .ml-app .ml-anomalies-table .ml-icon-severity-warning,\n  .ml-app .ml-anomalies-table .ml-icon-severity-unknown {\n    color: inherit;\n    text-shadow: none; }\n  .ml-app .ml-anomalies-table .ml-icon-severity-critical .euiIcon {\n    fill: #cf4141; }\n  .ml-app .ml-anomalies-table .ml-icon-severity-major .euiIcon {\n    fill: #9e6929; }\n  .ml-app .ml-anomalies-table .ml-icon-severity-minor .euiIcon {\n    fill: #7c7313; }\n  .ml-app .ml-anomalies-table .ml-icon-severity-warning .euiIcon {\n    fill: #537896; }\n  .ml-app .ml-anomalies-table .ml-icon-severity-unknown .euiIcon {\n    fill: #69707D; }\n  .ml-app .ml-anomalies-table tr th:first-child,\n  .ml-app .ml-anomalies-table tr td:first-child {\n    width: 32px; }\n  .ml-app .ml-anomalies-table .euiTableCellContent .euiHealth {\n    font-size: inherit; }\n  .ml-app .ml-anomalies-table .euiTableCellContent .detector-rules-icon {\n    margin-left: 4px;\n    opacity: .5; }\n  .ml-app .ml-anomalies-table .euiContextMenuItem {\n    min-width: 150px; }\n  .ml-app .ml-anomalies-table .mlAnomalyCategoryExamples__header {\n    display: inline; }\n  .ml-app .ml-anomalies-table .mlAnomalyCategoryExamples__link {\n    width: 100%; }\n  .ml-app .ml-anomalies-table .category-example {\n    display: block;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis; }\n  .ml-app .ml-anomalies-table .mlAnomalyCategoryExamples {\n    padding: 24px; }\n  .ml-app .ml-anomalies-table .mlAnomalyCategoryExamples__item {\n    display: block;\n    white-space: wrap;\n    font-family: "Roboto Mono", Consolas, Menlo, Courier, monospace; }\n  .ml-app .ml-anomalies-table .interim-result {\n    font-style: italic; }\n  .ml-app .ml-anomalies-table .ml-anomalies-table-details {\n    padding: 4px 32px;\n    max-height: 1000px;\n    overflow-y: auto; }\n    .ml-app .ml-anomalies-table .ml-anomalies-table-details .anomaly-description-list .euiDescriptionList__title {\n      margin-top: 0;\n      flex-basis: 15%;\n      font-size: inherit;\n      line-height: 1.5rem;\n      max-width: 100%;\n      overflow: hidden !important;\n      text-overflow: ellipsis !important;\n      white-space: nowrap !important;\n      word-wrap: normal !important; }\n    .ml-app .ml-anomalies-table .ml-anomalies-table-details .anomaly-description-list .euiDescriptionList__description {\n      margin-top: 0;\n      flex-basis: 85%;\n      font-size: inherit;\n      line-height: 1.5rem; }\n  .ml-app .mlColorRangeLegend text {\n    font-size: 10px;\n    font-size: 0.71429rem;\n    fill: #69707D; }\n  .ml-app .mlColorRangeLegend .axis path {\n    fill: none;\n    stroke: none; }\n  .ml-app .mlColorRangeLegend .axis line {\n    fill: none;\n    stroke: #98A2B3;\n    shape-rendering: crispEdges; }\n  .ml-app .ml-table-controls label {\n    font-size: 12px;\n    padding: 0 0 4px 4px; }\n  .ml-app .ml-table-controls .ml-table-controls-element {\n    display: inline-block;\n    padding-left: 16px; }\n  .ml-app .ml-table-controls select {\n    font-size: 12px;\n    font-style: normal; }\n  .ml-app .ml-select-severity .euiFormControlLayoutClearButton {\n    display: none; }\n  .ml-app .field-value-short {\n    max-width: 100%;\n    overflow: hidden !important;\n    text-overflow: ellipsis !important;\n    white-space: nowrap !important;\n    word-wrap: normal !important;\n    display: inline-block;\n    vertical-align: bottom; }\n  .ml-app .field-value-long {\n    overflow-wrap: break-word; }\n  .ml-app .filter-button {\n    opacity: .3;\n    min-width: 14px;\n    transform: translateY(-1px); }\n    .ml-app .filter-button .euiIcon {\n      width: 12px;\n      height: 12px; }\n  .ml-app .filter-button:hover {\n    opacity: 1; }\n  .ml-app .ml-field-title-bar {\n    font-size: 16px;\n    font-size: 1.14286rem;\n    line-height: 1.71429rem;\n    font-family: Roboto Mono, serif;\n    font-style: normal;\n    font-weight: bold;\n    font-size: 14px;\n    border-radius: 6px 6px 0 0;\n    padding: 4px;\n    margin: -16px -16px 0 -16px;\n    border-top: 3px solid;\n    text-align: center; }\n    .ml-app .ml-field-title-bar .field-type-icon {\n      vertical-align: middle;\n      margin-bottom: -4px;\n      display: inline-block; }\n    .ml-app .ml-field-title-bar .field-name {\n      max-width: 100%;\n      overflow: hidden !important;\n      text-overflow: ellipsis !important;\n      white-space: nowrap !important;\n      word-wrap: normal !important;\n      vertical-align: middle;\n      padding-right: 8px;\n      max-width: 290px;\n      display: inline-block;\n      margin-left: 8px; }\n  .ml-app .ml-influencers-list {\n    line-height: 1.45; }\n    .ml-app .ml-influencers-list .field-label {\n      font-size: 12px;\n      text-align: left;\n      max-height: 14px;\n      max-width: calc(100% - 102px); }\n      .ml-app .ml-influencers-list .field-label .field-value {\n        max-width: 100%;\n        overflow: hidden !important;\n        text-overflow: ellipsis !important;\n        white-space: nowrap !important;\n        word-wrap: normal !important;\n        display: inline-block;\n        vertical-align: bottom; }\n    .ml-app .ml-influencers-list .progress {\n      display: inline-block;\n      width: calc(100% - 34px);\n      height: 22px;\n      min-width: 70px;\n      margin-bottom: 0;\n      color: #69707D;\n      background-color: transparent; }\n      .ml-app .ml-influencers-list .progress .progress-bar-holder {\n        width: calc(100% - 28px); }\n      .ml-app .ml-influencers-list .progress .progress-bar {\n        height: 2px;\n        margin-top: 12px;\n        text-align: right;\n        line-height: 18px;\n        display: inline-block;\n        transition: none; }\n    .ml-app .ml-influencers-list .progress.critical .progress-bar {\n      background-color: #FE5050; }\n    .ml-app .ml-influencers-list .progress.critical .score-label {\n      border-color: #FE5050; }\n    .ml-app .ml-influencers-list .progress.major .progress-bar {\n      background-color: #FBA740; }\n    .ml-app .ml-influencers-list .progress.major .score-label {\n      border-color: #FBA740; }\n    .ml-app .ml-influencers-list .progress.minor .progress-bar {\n      background-color: #FDEC25; }\n    .ml-app .ml-influencers-list .progress.minor .score-label {\n      border-color: #FDEC25; }\n    .ml-app .ml-influencers-list .progress.warning .progress-bar {\n      background-color: #8BC8FB; }\n    .ml-app .ml-influencers-list .progress.warning .score-label {\n      border-color: #8BC8FB; }\n    .ml-app .ml-influencers-list .score-label {\n      text-align: center;\n      line-height: 14px;\n      white-space: nowrap;\n      font-size: 12px;\n      display: inline;\n      margin-left: 4px; }\n    .ml-app .ml-influencers-list .total-score-label {\n      width: 32px;\n      vertical-align: top;\n      text-align: center;\n      color: #69707D;\n      font-size: 11px;\n      line-height: 14px;\n      border-radius: 6px;\n      padding: 2px;\n      margin-top: 3px;\n      display: inline-block;\n      border: 1px solid #D3DAE6; }\n  .ml-app .ml-influencers-list-tooltip {\n    word-break: break-all; }\n  .ml-app .ml-items-grid-page-size-menu {\n    width: 140px; }\n  .ml-app .mlJobSelectorBar {\n    padding: 8px; }\n  .ml-app .mlJobSelectorFlyoutBody > .euiFlyoutBody__overflow {\n    padding-top: 8px; }\n  .ml-app .mlJobSelector__ganttBar {\n    background-color: #79ADDA;\n    height: 12px;\n    border-radius: 2px; }\n  .ml-app .mlJobSelector__ganttBarBackEdge {\n    height: 16px;\n    border-left: 1px solid #D6D6D6;\n    border-right: 1px solid #D6D6D6;\n    margin-bottom: -14px;\n    padding-top: 8px; }\n  .ml-app .mlJobSelector__ganttBarDashed {\n    height: 1px;\n    border-top: 1px dashed #D6D6D6; }\n  .ml-app .mlJobSelector__ganttBarRunning {\n    background-image: linear-gradient(45deg, rgba(255, 255, 255, 0.15) 25%, transparent 25%, transparent 50%, rgba(255, 255, 255, 0.15) 50%, rgba(255, 255, 255, 0.15) 75%, transparent 75%, transparent);\n    background-size: 40px 40px;\n    animation: progress-bar-stripes 2s linear infinite; }\n  .ml-app .ml-loading-indicator {\n    text-align: center;\n    font-size: 17px;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center; }\n  .ml-app .mlNavigationMenu {\n    padding: 0 12px;\n    border-bottom: 1px solid #D3DAE6;\n    background-color: #FFF; }\n  .ml-app .ml-rule-editor-flyout {\n    font-size: 14px; }\n    .ml-app .ml-rule-editor-flyout .select-rule-action .rule-detector-description-list {\n      padding-left: 16px; }\n    .ml-app .ml-rule-editor-flyout .select-rule-action-panel {\n      padding: 8px 0; }\n      .ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__title {\n        flex-basis: 15%;\n        padding: 0 16px; }\n      .ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__description {\n        flex-basis: 85%; }\n      .ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__title:nth-child(1),\n      .ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__description:nth-child(2) {\n        color: #1a1c21;\n        font-weight: 700;\n        border-bottom: 1px solid #D3DAE6;\n        padding-bottom: 12px; }\n      .ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__title:nth-child(3),\n      .ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList .euiDescriptionList__description:nth-child(4) {\n        padding-top: 8px; }\n      .ml-app .ml-rule-editor-flyout .select-rule-action-panel .euiDescriptionList.euiDescriptionList--column > * {\n        margin-top: 4px; }\n    .ml-app .ml-rule-editor-flyout .scope-enable-checkbox .euiCheckbox__input[disabled] ~ .euiCheckbox__label {\n      color: inherit; }\n    .ml-app .ml-rule-editor-flyout .scope-field-checkbox {\n      margin-right: 2px; }\n      .ml-app .ml-rule-editor-flyout .scope-field-checkbox .euiCheckbox {\n        margin-top: 4px; }\n    .ml-app .ml-rule-editor-flyout .scope-field-button {\n      pointer-events: none;\n      border-bottom: none; }\n    .ml-app .ml-rule-editor-flyout .scope-edit-filter-link {\n      line-height: 32px;\n      font-size: 12px; }\n    .ml-app .ml-rule-editor-flyout .condition-edit-value-field {\n      width: 170px;\n      height: 28px;\n      margin: 0 2px; }\n      .ml-app .ml-rule-editor-flyout .condition-edit-value-field input {\n        height: 28px; }\n    .ml-app .ml-rule-editor-flyout .euiExpressionButton.disabled {\n      pointer-events: none; }\n      .ml-app .ml-rule-editor-flyout .euiExpressionButton.disabled .euiExpressionButton__value,\n      .ml-app .ml-rule-editor-flyout .euiExpressionButton.disabled .euiExpressionButton__description {\n        color: #D3DAE6; }\n    .ml-app .ml-rule-editor-flyout .text-highlight {\n      font-weight: 700; }\n  .ml-app .euiDescriptionList.euiDescriptionList--column.rule-detector-description-list .euiDescriptionList__title {\n    flex-basis: 15%; }\n  .ml-app .euiDescriptionList.euiDescriptionList--column.rule-detector-description-list .euiDescriptionList__description {\n    flex-basis: 85%; }\n  .ml-app .euiDescriptionList.euiDescriptionList--column.rule-detector-description-list > * {\n    margin-top: 4px; }\n  .ml-app .stat {\n    margin-right: 8px; }\n  .ml-app .mlStatsBar {\n    height: 42px;\n    padding: 14px;\n    background-color: #F5F7FA; }\n  .ml-app .mlEmbeddedMapContent {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    flex: 1 1 100%;\n    z-index: 1;\n    min-height: 0; }\n  .ml-app .tab-datavisualizer_index_select,\n  .ml-app .tab-timeseriesexplorer,\n  .ml-app .tab-explorer {\n    background-color: #FFF; }\n  .ml-app .button-wrapper {\n    display: inline; }\n  .ml-app .button-wrapper.disabled .kuiButton[disabled] {\n    pointer-events: none; }\n  .ml-app .button-wrapper.disabled {\n    cursor: not-allowed; }\n  .ml-app .clear, .ml-app .clearfix {\n    clear: both; }\n  .ml-app .mlDisableAntiAliasing {\n    -webkit-font-smoothing: none; }\n    .ml-app .mlDisableAntiAliasing * canvas {\n      image-rendering: pixelated; }\n',""]);module.exports=exports},,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.addXJsonToRules=exports.XJsonHighlightRules=exports.ScriptHighlightRules=exports.ElasticsearchSqlHighlightRules=void 0;var elasticsearch_sql_highlight_rules_1=__webpack_require__(292);Object.defineProperty(exports,"ElasticsearchSqlHighlightRules",{enumerable:true,get:function(){return elasticsearch_sql_highlight_rules_1.ElasticsearchSqlHighlightRules}});var script_highlight_rules_1=__webpack_require__(294);Object.defineProperty(exports,"ScriptHighlightRules",{enumerable:true,get:function(){return script_highlight_rules_1.ScriptHighlightRules}});var x_json_highlight_rules_1=__webpack_require__(433);Object.defineProperty(exports,"XJsonHighlightRules",{enumerable:true,get:function(){return x_json_highlight_rules_1.XJsonHighlightRules}});Object.defineProperty(exports,"addXJsonToRules",{enumerable:true,get:function(){return x_json_highlight_rules_1.addToRules}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.addToRules=exports.XJsonHighlightRules=void 0;const tslib_1=__webpack_require__(38);const lodash_1=__webpack_require__(5);const brace_1=tslib_1.__importDefault(__webpack_require__(184));__webpack_require__(434);const elasticsearch_sql_highlight_rules_1=__webpack_require__(292);const script_highlight_rules_1=__webpack_require__(294);const{JsonHighlightRules:JsonHighlightRules}=brace_1.default.acequire("ace/mode/json_highlight_rules");const oop=brace_1.default.acequire("ace/lib/oop");const jsonRules=function(root){root=root?root:"json";const rules={};const xJsonRules=[{token:["variable","whitespace","ace.punctuation.colon","whitespace","punctuation.start_triple_quote"],regex:'("(?:[^"]*_)?script"|"inline"|"source")(\\s*?)(:)(\\s*?)(""")',next:"script-start",merge:false,push:true},{token:"variable",regex:'["](?:(?:\\\\.)|(?:[^"\\\\]))*?["]\\s*(?=:)'},{token:"punctuation.start_triple_quote",regex:'"""',next:"string_literal",merge:false,push:true},{token:"string",regex:'["](?:(?:\\\\.)|(?:[^"\\\\]))*?["]'},{token:"constant.numeric",regex:"0[xX][0-9a-fA-F]+\\b"},{token:"constant.numeric",regex:"[+-]?\\d+(?:(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)?\\b"},{token:"constant.language.boolean",regex:"(?:true|false)\\b"},{token:"invalid.illegal",regex:"['](?:(?:\\\\.)|(?:[^'\\\\]))*?[']"},{token:"invalid.illegal",regex:"\\/\\/.*$"},{token:"paren.lparen",merge:false,regex:"{",next:root,push:true},{token:"paren.lparen",merge:false,regex:"[[(]"},{token:"paren.rparen",merge:false,regex:"[\\])]"},{token:"paren.rparen",regex:"}",merge:false,next:"pop"},{token:"punctuation.comma",regex:","},{token:"punctuation.colon",regex:":"},{token:"whitespace",regex:"\\s+"},{token:"text",regex:".+?"}];rules[root]=xJsonRules;rules[root+"-sql"]=[{token:["variable","whitespace","ace.punctuation.colon","whitespace","punctuation.start_triple_quote"],regex:'("query")(\\s*?)(:)(\\s*?)(""")',next:"sql-start",merge:false,push:true}].concat(xJsonRules);rules.string_literal=[{token:"punctuation.end_triple_quote",regex:'"""',next:"pop"},{token:"multi_string",regex:"."}];return rules};function XJsonHighlightRules(){this.$rules={...jsonRules("start")};this.embedRules(script_highlight_rules_1.ScriptHighlightRules,"script-",[{token:"punctuation.end_triple_quote",regex:'"""',next:"pop"}]);this.embedRules(elasticsearch_sql_highlight_rules_1.ElasticsearchSqlHighlightRules,"sql-",[{token:"punctuation.end_triple_quote",regex:'"""',next:"pop"}])}exports.XJsonHighlightRules=XJsonHighlightRules;oop.inherits(XJsonHighlightRules,JsonHighlightRules);function addToRules(otherRules,embedUnder){otherRules.$rules=lodash_1.defaultsDeep(otherRules.$rules,jsonRules(embedUnder));otherRules.embedRules(script_highlight_rules_1.ScriptHighlightRules,"script-",[{token:"punctuation.end_triple_quote",regex:'"""',next:"pop"}]);otherRules.embedRules(elasticsearch_sql_highlight_rules_1.ElasticsearchSqlHighlightRules,"sql-",[{token:"punctuation.end_triple_quote",regex:'"""',next:"pop"}])}exports.addToRules=addToRules},function(module,exports,__webpack_require__){ace.define("ace/mode/json_highlight_rules",["require","exports","module","ace/lib/oop","ace/mode/text_highlight_rules"],(function(acequire,exports,module){"use strict";var oop=acequire("../lib/oop");var TextHighlightRules=acequire("./text_highlight_rules").TextHighlightRules;var JsonHighlightRules=function(){this.$rules={start:[{token:"variable",regex:'["](?:(?:\\\\.)|(?:[^"\\\\]))*?["]\\s*(?=:)'},{token:"string",regex:'"',next:"string"},{token:"constant.numeric",regex:"0[xX][0-9a-fA-F]+\\b"},{token:"constant.numeric",regex:"[+-]?\\d+(?:(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)?\\b"},{token:"constant.language.boolean",regex:"(?:true|false)\\b"},{token:"text",regex:"['](?:(?:\\\\.)|(?:[^'\\\\]))*?[']"},{token:"comment",regex:"\\/\\/.*$"},{token:"comment.start",regex:"\\/\\*",next:"comment"},{token:"paren.lparen",regex:"[[({]"},{token:"paren.rparen",regex:"[\\])}]"},{token:"text",regex:"\\s+"}],string:[{token:"constant.language.escape",regex:/\\(?:x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}|["\\\/bfnrt])/},{token:"string",regex:'"|$',next:"start"},{defaultToken:"string"}],comment:[{token:"comment.end",regex:"\\*\\/",next:"start"},{defaultToken:"comment"}]}};oop.inherits(JsonHighlightRules,TextHighlightRules);exports.JsonHighlightRules=JsonHighlightRules}));ace.define("ace/mode/matching_brace_outdent",["require","exports","module","ace/range"],(function(acequire,exports,module){"use strict";var Range=acequire("../range").Range;var MatchingBraceOutdent=function(){};(function(){this.checkOutdent=function(line,input){if(!/^\s+$/.test(line))return false;return/^\s*\}/.test(input)};this.autoOutdent=function(doc,row){var line=doc.getLine(row);var match=line.match(/^(\s*\})/);if(!match)return 0;var column=match[1].length;var openBracePos=doc.findMatchingBracket({row:row,column:column});if(!openBracePos||openBracePos.row==row)return 0;var indent=this.$getIndent(doc.getLine(openBracePos.row));doc.replace(new Range(row,0,row,column-1),indent)};this.$getIndent=function(line){return line.match(/^\s*/)[0]}}).call(MatchingBraceOutdent.prototype);exports.MatchingBraceOutdent=MatchingBraceOutdent}));ace.define("ace/mode/folding/cstyle",["require","exports","module","ace/lib/oop","ace/range","ace/mode/folding/fold_mode"],(function(acequire,exports,module){"use strict";var oop=acequire("../../lib/oop");var Range=acequire("../../range").Range;var BaseFoldMode=acequire("./fold_mode").FoldMode;var FoldMode=exports.FoldMode=function(commentRegex){if(commentRegex){this.foldingStartMarker=new RegExp(this.foldingStartMarker.source.replace(/\|[^|]*?$/,"|"+commentRegex.start));this.foldingStopMarker=new RegExp(this.foldingStopMarker.source.replace(/\|[^|]*?$/,"|"+commentRegex.end))}};oop.inherits(FoldMode,BaseFoldMode);(function(){this.foldingStartMarker=/([\{\[\(])[^\}\]\)]*$|^\s*(\/\*)/;this.foldingStopMarker=/^[^\[\{\(]*([\}\]\)])|^[\s\*]*(\*\/)/;this.singleLineBlockCommentRe=/^\s*(\/\*).*\*\/\s*$/;this.tripleStarBlockCommentRe=/^\s*(\/\*\*\*).*\*\/\s*$/;this.startRegionRe=/^\s*(\/\*|\/\/)#?region\b/;this._getFoldWidgetBase=this.getFoldWidget;this.getFoldWidget=function(session,foldStyle,row){var line=session.getLine(row);if(this.singleLineBlockCommentRe.test(line)){if(!this.startRegionRe.test(line)&&!this.tripleStarBlockCommentRe.test(line))return""}var fw=this._getFoldWidgetBase(session,foldStyle,row);if(!fw&&this.startRegionRe.test(line))return"start";return fw};this.getFoldWidgetRange=function(session,foldStyle,row,forceMultiline){var line=session.getLine(row);if(this.startRegionRe.test(line))return this.getCommentRegionBlock(session,line,row);var match=line.match(this.foldingStartMarker);if(match){var i=match.index;if(match[1])return this.openingBracketBlock(session,match[1],row,i);var range=session.getCommentFoldRange(row,i+match[0].length,1);if(range&&!range.isMultiLine()){if(forceMultiline){range=this.getSectionRange(session,row)}else if(foldStyle!="all")range=null}return range}if(foldStyle==="markbegin")return;var match=line.match(this.foldingStopMarker);if(match){var i=match.index+match[0].length;if(match[1])return this.closingBracketBlock(session,match[1],row,i);return session.getCommentFoldRange(row,i,-1)}};this.getSectionRange=function(session,row){var line=session.getLine(row);var startIndent=line.search(/\S/);var startRow=row;var startColumn=line.length;row=row+1;var endRow=row;var maxRow=session.getLength();while(++row<maxRow){line=session.getLine(row);var indent=line.search(/\S/);if(indent===-1)continue;if(startIndent>indent)break;var subRange=this.getFoldWidgetRange(session,"all",row);if(subRange){if(subRange.start.row<=startRow){break}else if(subRange.isMultiLine()){row=subRange.end.row}else if(startIndent==indent){break}}endRow=row}return new Range(startRow,startColumn,endRow,session.getLine(endRow).length)};this.getCommentRegionBlock=function(session,line,row){var startColumn=line.search(/\s*$/);var maxRow=session.getLength();var startRow=row;var re=/^\s*(?:\/\*|\/\/|--)#?(end)?region\b/;var depth=1;while(++row<maxRow){line=session.getLine(row);var m=re.exec(line);if(!m)continue;if(m[1])depth--;else depth++;if(!depth)break}var endRow=row;if(endRow>startRow){return new Range(startRow,startColumn,endRow,line.length)}}}).call(FoldMode.prototype)}));ace.define("ace/mode/json",["require","exports","module","ace/lib/oop","ace/mode/text","ace/mode/json_highlight_rules","ace/mode/matching_brace_outdent","ace/mode/behaviour/cstyle","ace/mode/folding/cstyle","ace/worker/worker_client"],(function(acequire,exports,module){"use strict";var oop=acequire("../lib/oop");var TextMode=acequire("./text").Mode;var HighlightRules=acequire("./json_highlight_rules").JsonHighlightRules;var MatchingBraceOutdent=acequire("./matching_brace_outdent").MatchingBraceOutdent;var CstyleBehaviour=acequire("./behaviour/cstyle").CstyleBehaviour;var CStyleFoldMode=acequire("./folding/cstyle").FoldMode;var WorkerClient=acequire("../worker/worker_client").WorkerClient;var Mode=function(){this.HighlightRules=HighlightRules;this.$outdent=new MatchingBraceOutdent;this.$behaviour=new CstyleBehaviour;this.foldingRules=new CStyleFoldMode};oop.inherits(Mode,TextMode);(function(){this.getNextLineIndent=function(state,line,tab){var indent=this.$getIndent(line);if(state=="start"){var match=line.match(/^.*[\{\(\[]\s*$/);if(match){indent+=tab}}return indent};this.checkOutdent=function(state,line,input){return this.$outdent.checkOutdent(line,input)};this.autoOutdent=function(state,doc,row){this.$outdent.autoOutdent(doc,row)};this.createWorker=function(session){var worker=new WorkerClient(["ace"],__webpack_require__(435),"JsonWorker");worker.attachToDocument(session.getDocument());worker.on("annotate",(function(e){session.setAnnotations(e.data)}));worker.on("terminate",(function(){session.clearAnnotations()}));return worker};this.$id="ace/mode/json"}).call(Mode.prototype);exports.Mode=Mode}))},function(module,exports){module.exports.id="ace/mode/json_worker";module.exports.src='"no use strict";!function(window){function resolveModuleId(id,paths){for(var testPath=id,tail="";testPath;){var alias=paths[testPath];if("string"==typeof alias)return alias+tail;if(alias)return alias.location.replace(/\\/*$/,"/")+(tail||alias.main||alias.name);if(alias===!1)return"";var i=testPath.lastIndexOf("/");if(-1===i)break;tail=testPath.substr(i)+tail,testPath=testPath.slice(0,i)}return id}if(!(void 0!==window.window&&window.document||window.acequire&&window.define)){window.console||(window.console=function(){var msgs=Array.prototype.slice.call(arguments,0);postMessage({type:"log",data:msgs})},window.console.error=window.console.warn=window.console.log=window.console.trace=window.console),window.window=window,window.ace=window,window.onerror=function(message,file,line,col,err){postMessage({type:"error",data:{message:message,data:err.data,file:file,line:line,col:col,stack:err.stack}})},window.normalizeModule=function(parentId,moduleName){if(-1!==moduleName.indexOf("!")){var chunks=moduleName.split("!");return window.normalizeModule(parentId,chunks[0])+"!"+window.normalizeModule(parentId,chunks[1])}if("."==moduleName.charAt(0)){var base=parentId.split("/").slice(0,-1).join("/");for(moduleName=(base?base+"/":"")+moduleName;-1!==moduleName.indexOf(".")&&previous!=moduleName;){var previous=moduleName;moduleName=moduleName.replace(/^\\.\\//,"").replace(/\\/\\.\\//,"/").replace(/[^\\/]+\\/\\.\\.\\//,"")}}return moduleName},window.acequire=function acequire(parentId,id){if(id||(id=parentId,parentId=null),!id.charAt)throw Error("worker.js acequire() accepts only (parentId, id) as arguments");id=window.normalizeModule(parentId,id);var module=window.acequire.modules[id];if(module)return module.initialized||(module.initialized=!0,module.exports=module.factory().exports),module.exports;if(!window.acequire.tlns)return console.log("unable to load "+id);var path=resolveModuleId(id,window.acequire.tlns);return".js"!=path.slice(-3)&&(path+=".js"),window.acequire.id=id,window.acequire.modules[id]={},importScripts(path),window.acequire(parentId,id)},window.acequire.modules={},window.acequire.tlns={},window.define=function(id,deps,factory){if(2==arguments.length?(factory=deps,"string"!=typeof id&&(deps=id,id=window.acequire.id)):1==arguments.length&&(factory=id,deps=[],id=window.acequire.id),"function"!=typeof factory)return window.acequire.modules[id]={exports:factory,initialized:!0},void 0;deps.length||(deps=["require","exports","module"]);var req=function(childId){return window.acequire(id,childId)};window.acequire.modules[id]={exports:{},factory:function(){var module=this,returnExports=factory.apply(this,deps.map(function(dep){switch(dep){case"require":return req;case"exports":return module.exports;case"module":return module;default:return req(dep)}}));return returnExports&&(module.exports=returnExports),module}}},window.define.amd={},acequire.tlns={},window.initBaseUrls=function(topLevelNamespaces){for(var i in topLevelNamespaces)acequire.tlns[i]=topLevelNamespaces[i]},window.initSender=function(){var EventEmitter=window.acequire("ace/lib/event_emitter").EventEmitter,oop=window.acequire("ace/lib/oop"),Sender=function(){};return function(){oop.implement(this,EventEmitter),this.callback=function(data,callbackId){postMessage({type:"call",id:callbackId,data:data})},this.emit=function(name,data){postMessage({type:"event",name:name,data:data})}}.call(Sender.prototype),new Sender};var main=window.main=null,sender=window.sender=null;window.onmessage=function(e){var msg=e.data;if(msg.event&&sender)sender._signal(msg.event,msg.data);else if(msg.command)if(main[msg.command])main[msg.command].apply(main,msg.args);else{if(!window[msg.command])throw Error("Unknown command:"+msg.command);window[msg.command].apply(window,msg.args)}else if(msg.init){window.initBaseUrls(msg.tlns),acequire("ace/lib/es5-shim"),sender=window.sender=window.initSender();var clazz=acequire(msg.module)[msg.classname];main=window.main=new clazz(sender)}}}}(this),ace.define("ace/lib/oop",["require","exports","module"],function(acequire,exports){"use strict";exports.inherits=function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})},exports.mixin=function(obj,mixin){for(var key in mixin)obj[key]=mixin[key];return obj},exports.implement=function(proto,mixin){exports.mixin(proto,mixin)}}),ace.define("ace/range",["require","exports","module"],function(acequire,exports){"use strict";var comparePoints=function(p1,p2){return p1.row-p2.row||p1.column-p2.column},Range=function(startRow,startColumn,endRow,endColumn){this.start={row:startRow,column:startColumn},this.end={row:endRow,column:endColumn}};(function(){this.isEqual=function(range){return this.start.row===range.start.row&&this.end.row===range.end.row&&this.start.column===range.start.column&&this.end.column===range.end.column},this.toString=function(){return"Range: ["+this.start.row+"/"+this.start.column+"] -> ["+this.end.row+"/"+this.end.column+"]"},this.contains=function(row,column){return 0==this.compare(row,column)},this.compareRange=function(range){var cmp,end=range.end,start=range.start;return cmp=this.compare(end.row,end.column),1==cmp?(cmp=this.compare(start.row,start.column),1==cmp?2:0==cmp?1:0):-1==cmp?-2:(cmp=this.compare(start.row,start.column),-1==cmp?-1:1==cmp?42:0)},this.comparePoint=function(p){return this.compare(p.row,p.column)},this.containsRange=function(range){return 0==this.comparePoint(range.start)&&0==this.comparePoint(range.end)},this.intersects=function(range){var cmp=this.compareRange(range);return-1==cmp||0==cmp||1==cmp},this.isEnd=function(row,column){return this.end.row==row&&this.end.column==column},this.isStart=function(row,column){return this.start.row==row&&this.start.column==column},this.setStart=function(row,column){"object"==typeof row?(this.start.column=row.column,this.start.row=row.row):(this.start.row=row,this.start.column=column)},this.setEnd=function(row,column){"object"==typeof row?(this.end.column=row.column,this.end.row=row.row):(this.end.row=row,this.end.column=column)},this.inside=function(row,column){return 0==this.compare(row,column)?this.isEnd(row,column)||this.isStart(row,column)?!1:!0:!1},this.insideStart=function(row,column){return 0==this.compare(row,column)?this.isEnd(row,column)?!1:!0:!1},this.insideEnd=function(row,column){return 0==this.compare(row,column)?this.isStart(row,column)?!1:!0:!1},this.compare=function(row,column){return this.isMultiLine()||row!==this.start.row?this.start.row>row?-1:row>this.end.row?1:this.start.row===row?column>=this.start.column?0:-1:this.end.row===row?this.end.column>=column?0:1:0:this.start.column>column?-1:column>this.end.column?1:0},this.compareStart=function(row,column){return this.start.row==row&&this.start.column==column?-1:this.compare(row,column)},this.compareEnd=function(row,column){return this.end.row==row&&this.end.column==column?1:this.compare(row,column)},this.compareInside=function(row,column){return this.end.row==row&&this.end.column==column?1:this.start.row==row&&this.start.column==column?-1:this.compare(row,column)},this.clipRows=function(firstRow,lastRow){if(this.end.row>lastRow)var end={row:lastRow+1,column:0};else if(firstRow>this.end.row)var end={row:firstRow,column:0};if(this.start.row>lastRow)var start={row:lastRow+1,column:0};else if(firstRow>this.start.row)var start={row:firstRow,column:0};return Range.fromPoints(start||this.start,end||this.end)},this.extend=function(row,column){var cmp=this.compare(row,column);if(0==cmp)return this;if(-1==cmp)var start={row:row,column:column};else var end={row:row,column:column};return Range.fromPoints(start||this.start,end||this.end)},this.isEmpty=function(){return this.start.row===this.end.row&&this.start.column===this.end.column},this.isMultiLine=function(){return this.start.row!==this.end.row},this.clone=function(){return Range.fromPoints(this.start,this.end)},this.collapseRows=function(){return 0==this.end.column?new Range(this.start.row,0,Math.max(this.start.row,this.end.row-1),0):new Range(this.start.row,0,this.end.row,0)},this.toScreenRange=function(session){var screenPosStart=session.documentToScreenPosition(this.start),screenPosEnd=session.documentToScreenPosition(this.end);return new Range(screenPosStart.row,screenPosStart.column,screenPosEnd.row,screenPosEnd.column)},this.moveBy=function(row,column){this.start.row+=row,this.start.column+=column,this.end.row+=row,this.end.column+=column}}).call(Range.prototype),Range.fromPoints=function(start,end){return new Range(start.row,start.column,end.row,end.column)},Range.comparePoints=comparePoints,Range.comparePoints=function(p1,p2){return p1.row-p2.row||p1.column-p2.column},exports.Range=Range}),ace.define("ace/apply_delta",["require","exports","module"],function(acequire,exports){"use strict";exports.applyDelta=function(docLines,delta){var row=delta.start.row,startColumn=delta.start.column,line=docLines[row]||"";switch(delta.action){case"insert":var lines=delta.lines;if(1===lines.length)docLines[row]=line.substring(0,startColumn)+delta.lines[0]+line.substring(startColumn);else{var args=[row,1].concat(delta.lines);docLines.splice.apply(docLines,args),docLines[row]=line.substring(0,startColumn)+docLines[row],docLines[row+delta.lines.length-1]+=line.substring(startColumn)}break;case"remove":var endColumn=delta.end.column,endRow=delta.end.row;row===endRow?docLines[row]=line.substring(0,startColumn)+line.substring(endColumn):docLines.splice(row,endRow-row+1,line.substring(0,startColumn)+docLines[endRow].substring(endColumn))}}}),ace.define("ace/lib/event_emitter",["require","exports","module"],function(acequire,exports){"use strict";var EventEmitter={},stopPropagation=function(){this.propagationStopped=!0},preventDefault=function(){this.defaultPrevented=!0};EventEmitter._emit=EventEmitter._dispatchEvent=function(eventName,e){this._eventRegistry||(this._eventRegistry={}),this._defaultHandlers||(this._defaultHandlers={});var listeners=this._eventRegistry[eventName]||[],defaultHandler=this._defaultHandlers[eventName];if(listeners.length||defaultHandler){"object"==typeof e&&e||(e={}),e.type||(e.type=eventName),e.stopPropagation||(e.stopPropagation=stopPropagation),e.preventDefault||(e.preventDefault=preventDefault),listeners=listeners.slice();for(var i=0;listeners.length>i&&(listeners[i](e,this),!e.propagationStopped);i++);return defaultHandler&&!e.defaultPrevented?defaultHandler(e,this):void 0}},EventEmitter._signal=function(eventName,e){var listeners=(this._eventRegistry||{})[eventName];if(listeners){listeners=listeners.slice();for(var i=0;listeners.length>i;i++)listeners[i](e,this)}},EventEmitter.once=function(eventName,callback){var _self=this;callback&&this.addEventListener(eventName,function newCallback(){_self.removeEventListener(eventName,newCallback),callback.apply(null,arguments)})},EventEmitter.setDefaultHandler=function(eventName,callback){var handlers=this._defaultHandlers;if(handlers||(handlers=this._defaultHandlers={_disabled_:{}}),handlers[eventName]){var old=handlers[eventName],disabled=handlers._disabled_[eventName];disabled||(handlers._disabled_[eventName]=disabled=[]),disabled.push(old);var i=disabled.indexOf(callback);-1!=i&&disabled.splice(i,1)}handlers[eventName]=callback},EventEmitter.removeDefaultHandler=function(eventName,callback){var handlers=this._defaultHandlers;if(handlers){var disabled=handlers._disabled_[eventName];if(handlers[eventName]==callback)handlers[eventName],disabled&&this.setDefaultHandler(eventName,disabled.pop());else if(disabled){var i=disabled.indexOf(callback);-1!=i&&disabled.splice(i,1)}}},EventEmitter.on=EventEmitter.addEventListener=function(eventName,callback,capturing){this._eventRegistry=this._eventRegistry||{};var listeners=this._eventRegistry[eventName];return listeners||(listeners=this._eventRegistry[eventName]=[]),-1==listeners.indexOf(callback)&&listeners[capturing?"unshift":"push"](callback),callback},EventEmitter.off=EventEmitter.removeListener=EventEmitter.removeEventListener=function(eventName,callback){this._eventRegistry=this._eventRegistry||{};var listeners=this._eventRegistry[eventName];if(listeners){var index=listeners.indexOf(callback);-1!==index&&listeners.splice(index,1)}},EventEmitter.removeAllListeners=function(eventName){this._eventRegistry&&(this._eventRegistry[eventName]=[])},exports.EventEmitter=EventEmitter}),ace.define("ace/anchor",["require","exports","module","ace/lib/oop","ace/lib/event_emitter"],function(acequire,exports){"use strict";var oop=acequire("./lib/oop"),EventEmitter=acequire("./lib/event_emitter").EventEmitter,Anchor=exports.Anchor=function(doc,row,column){this.$onChange=this.onChange.bind(this),this.attach(doc),column===void 0?this.setPosition(row.row,row.column):this.setPosition(row,column)};(function(){function $pointsInOrder(point1,point2,equalPointsInOrder){var bColIsAfter=equalPointsInOrder?point1.column<=point2.column:point1.column<point2.column;return point1.row<point2.row||point1.row==point2.row&&bColIsAfter}function $getTransformedPoint(delta,point,moveIfEqual){var deltaIsInsert="insert"==delta.action,deltaRowShift=(deltaIsInsert?1:-1)*(delta.end.row-delta.start.row),deltaColShift=(deltaIsInsert?1:-1)*(delta.end.column-delta.start.column),deltaStart=delta.start,deltaEnd=deltaIsInsert?deltaStart:delta.end;return $pointsInOrder(point,deltaStart,moveIfEqual)?{row:point.row,column:point.column}:$pointsInOrder(deltaEnd,point,!moveIfEqual)?{row:point.row+deltaRowShift,column:point.column+(point.row==deltaEnd.row?deltaColShift:0)}:{row:deltaStart.row,column:deltaStart.column}}oop.implement(this,EventEmitter),this.getPosition=function(){return this.$clipPositionToDocument(this.row,this.column)},this.getDocument=function(){return this.document},this.$insertRight=!1,this.onChange=function(delta){if(!(delta.start.row==delta.end.row&&delta.start.row!=this.row||delta.start.row>this.row)){var point=$getTransformedPoint(delta,{row:this.row,column:this.column},this.$insertRight);this.setPosition(point.row,point.column,!0)}},this.setPosition=function(row,column,noClip){var pos;if(pos=noClip?{row:row,column:column}:this.$clipPositionToDocument(row,column),this.row!=pos.row||this.column!=pos.column){var old={row:this.row,column:this.column};this.row=pos.row,this.column=pos.column,this._signal("change",{old:old,value:pos})}},this.detach=function(){this.document.removeEventListener("change",this.$onChange)},this.attach=function(doc){this.document=doc||this.document,this.document.on("change",this.$onChange)},this.$clipPositionToDocument=function(row,column){var pos={};return row>=this.document.getLength()?(pos.row=Math.max(0,this.document.getLength()-1),pos.column=this.document.getLine(pos.row).length):0>row?(pos.row=0,pos.column=0):(pos.row=row,pos.column=Math.min(this.document.getLine(pos.row).length,Math.max(0,column))),0>column&&(pos.column=0),pos}}).call(Anchor.prototype)}),ace.define("ace/document",["require","exports","module","ace/lib/oop","ace/apply_delta","ace/lib/event_emitter","ace/range","ace/anchor"],function(acequire,exports){"use strict";var oop=acequire("./lib/oop"),applyDelta=acequire("./apply_delta").applyDelta,EventEmitter=acequire("./lib/event_emitter").EventEmitter,Range=acequire("./range").Range,Anchor=acequire("./anchor").Anchor,Document=function(textOrLines){this.$lines=[""],0===textOrLines.length?this.$lines=[""]:Array.isArray(textOrLines)?this.insertMergedLines({row:0,column:0},textOrLines):this.insert({row:0,column:0},textOrLines)};(function(){oop.implement(this,EventEmitter),this.setValue=function(text){var len=this.getLength()-1;this.remove(new Range(0,0,len,this.getLine(len).length)),this.insert({row:0,column:0},text)},this.getValue=function(){return this.getAllLines().join(this.getNewLineCharacter())},this.createAnchor=function(row,column){return new Anchor(this,row,column)},this.$split=0==="aaa".split(/a/).length?function(text){return text.replace(/\\r\\n|\\r/g,"\\n").split("\\n")}:function(text){return text.split(/\\r\\n|\\r|\\n/)},this.$detectNewLine=function(text){var match=text.match(/^.*?(\\r\\n|\\r|\\n)/m);this.$autoNewLine=match?match[1]:"\\n",this._signal("changeNewLineMode")},this.getNewLineCharacter=function(){switch(this.$newLineMode){case"windows":return"\\r\\n";case"unix":return"\\n";default:return this.$autoNewLine||"\\n"}},this.$autoNewLine="",this.$newLineMode="auto",this.setNewLineMode=function(newLineMode){this.$newLineMode!==newLineMode&&(this.$newLineMode=newLineMode,this._signal("changeNewLineMode"))},this.getNewLineMode=function(){return this.$newLineMode},this.isNewLine=function(text){return"\\r\\n"==text||"\\r"==text||"\\n"==text},this.getLine=function(row){return this.$lines[row]||""},this.getLines=function(firstRow,lastRow){return this.$lines.slice(firstRow,lastRow+1)},this.getAllLines=function(){return this.getLines(0,this.getLength())},this.getLength=function(){return this.$lines.length},this.getTextRange=function(range){return this.getLinesForRange(range).join(this.getNewLineCharacter())},this.getLinesForRange=function(range){var lines;if(range.start.row===range.end.row)lines=[this.getLine(range.start.row).substring(range.start.column,range.end.column)];else{lines=this.getLines(range.start.row,range.end.row),lines[0]=(lines[0]||"").substring(range.start.column);var l=lines.length-1;range.end.row-range.start.row==l&&(lines[l]=lines[l].substring(0,range.end.column))}return lines},this.insertLines=function(row,lines){return console.warn("Use of document.insertLines is deprecated. Use the insertFullLines method instead."),this.insertFullLines(row,lines)},this.removeLines=function(firstRow,lastRow){return console.warn("Use of document.removeLines is deprecated. Use the removeFullLines method instead."),this.removeFullLines(firstRow,lastRow)},this.insertNewLine=function(position){return console.warn("Use of document.insertNewLine is deprecated. Use insertMergedLines(position, [\'\', \'\']) instead."),this.insertMergedLines(position,["",""])},this.insert=function(position,text){return 1>=this.getLength()&&this.$detectNewLine(text),this.insertMergedLines(position,this.$split(text))},this.insertInLine=function(position,text){var start=this.clippedPos(position.row,position.column),end=this.pos(position.row,position.column+text.length);return this.applyDelta({start:start,end:end,action:"insert",lines:[text]},!0),this.clonePos(end)},this.clippedPos=function(row,column){var length=this.getLength();void 0===row?row=length:0>row?row=0:row>=length&&(row=length-1,column=void 0);var line=this.getLine(row);return void 0==column&&(column=line.length),column=Math.min(Math.max(column,0),line.length),{row:row,column:column}},this.clonePos=function(pos){return{row:pos.row,column:pos.column}},this.pos=function(row,column){return{row:row,column:column}},this.$clipPosition=function(position){var length=this.getLength();return position.row>=length?(position.row=Math.max(0,length-1),position.column=this.getLine(length-1).length):(position.row=Math.max(0,position.row),position.column=Math.min(Math.max(position.column,0),this.getLine(position.row).length)),position},this.insertFullLines=function(row,lines){row=Math.min(Math.max(row,0),this.getLength());var column=0;this.getLength()>row?(lines=lines.concat([""]),column=0):(lines=[""].concat(lines),row--,column=this.$lines[row].length),this.insertMergedLines({row:row,column:column},lines)},this.insertMergedLines=function(position,lines){var start=this.clippedPos(position.row,position.column),end={row:start.row+lines.length-1,column:(1==lines.length?start.column:0)+lines[lines.length-1].length};return this.applyDelta({start:start,end:end,action:"insert",lines:lines}),this.clonePos(end)},this.remove=function(range){var start=this.clippedPos(range.start.row,range.start.column),end=this.clippedPos(range.end.row,range.end.column);return this.applyDelta({start:start,end:end,action:"remove",lines:this.getLinesForRange({start:start,end:end})}),this.clonePos(start)},this.removeInLine=function(row,startColumn,endColumn){var start=this.clippedPos(row,startColumn),end=this.clippedPos(row,endColumn);return this.applyDelta({start:start,end:end,action:"remove",lines:this.getLinesForRange({start:start,end:end})},!0),this.clonePos(start)},this.removeFullLines=function(firstRow,lastRow){firstRow=Math.min(Math.max(0,firstRow),this.getLength()-1),lastRow=Math.min(Math.max(0,lastRow),this.getLength()-1);var deleteFirstNewLine=lastRow==this.getLength()-1&&firstRow>0,deleteLastNewLine=this.getLength()-1>lastRow,startRow=deleteFirstNewLine?firstRow-1:firstRow,startCol=deleteFirstNewLine?this.getLine(startRow).length:0,endRow=deleteLastNewLine?lastRow+1:lastRow,endCol=deleteLastNewLine?0:this.getLine(endRow).length,range=new Range(startRow,startCol,endRow,endCol),deletedLines=this.$lines.slice(firstRow,lastRow+1);return this.applyDelta({start:range.start,end:range.end,action:"remove",lines:this.getLinesForRange(range)}),deletedLines},this.removeNewLine=function(row){this.getLength()-1>row&&row>=0&&this.applyDelta({start:this.pos(row,this.getLine(row).length),end:this.pos(row+1,0),action:"remove",lines:["",""]})},this.replace=function(range,text){if(range instanceof Range||(range=Range.fromPoints(range.start,range.end)),0===text.length&&range.isEmpty())return range.start;if(text==this.getTextRange(range))return range.end;this.remove(range);var end;return end=text?this.insert(range.start,text):range.start},this.applyDeltas=function(deltas){for(var i=0;deltas.length>i;i++)this.applyDelta(deltas[i])},this.revertDeltas=function(deltas){for(var i=deltas.length-1;i>=0;i--)this.revertDelta(deltas[i])},this.applyDelta=function(delta,doNotValidate){var isInsert="insert"==delta.action;(isInsert?1>=delta.lines.length&&!delta.lines[0]:!Range.comparePoints(delta.start,delta.end))||(isInsert&&delta.lines.length>2e4&&this.$splitAndapplyLargeDelta(delta,2e4),applyDelta(this.$lines,delta,doNotValidate),this._signal("change",delta))},this.$splitAndapplyLargeDelta=function(delta,MAX){for(var lines=delta.lines,l=lines.length,row=delta.start.row,column=delta.start.column,from=0,to=0;;){from=to,to+=MAX-1;var chunk=lines.slice(from,to);if(to>l){delta.lines=chunk,delta.start.row=row+from,delta.start.column=column;break}chunk.push(""),this.applyDelta({start:this.pos(row+from,column),end:this.pos(row+to,column=0),action:delta.action,lines:chunk},!0)}},this.revertDelta=function(delta){this.applyDelta({start:this.clonePos(delta.start),end:this.clonePos(delta.end),action:"insert"==delta.action?"remove":"insert",lines:delta.lines.slice()})},this.indexToPosition=function(index,startRow){for(var lines=this.$lines||this.getAllLines(),newlineLength=this.getNewLineCharacter().length,i=startRow||0,l=lines.length;l>i;i++)if(index-=lines[i].length+newlineLength,0>index)return{row:i,column:index+lines[i].length+newlineLength};return{row:l-1,column:lines[l-1].length}},this.positionToIndex=function(pos,startRow){for(var lines=this.$lines||this.getAllLines(),newlineLength=this.getNewLineCharacter().length,index=0,row=Math.min(pos.row,lines.length),i=startRow||0;row>i;++i)index+=lines[i].length+newlineLength;return index+pos.column}}).call(Document.prototype),exports.Document=Document}),ace.define("ace/lib/lang",["require","exports","module"],function(acequire,exports){"use strict";exports.last=function(a){return a[a.length-1]},exports.stringReverse=function(string){return string.split("").reverse().join("")},exports.stringRepeat=function(string,count){for(var result="";count>0;)1&count&&(result+=string),(count>>=1)&&(string+=string);return result};var trimBeginRegexp=/^\\s\\s*/,trimEndRegexp=/\\s\\s*$/;exports.stringTrimLeft=function(string){return string.replace(trimBeginRegexp,"")},exports.stringTrimRight=function(string){return string.replace(trimEndRegexp,"")},exports.copyObject=function(obj){var copy={};for(var key in obj)copy[key]=obj[key];return copy},exports.copyArray=function(array){for(var copy=[],i=0,l=array.length;l>i;i++)copy[i]=array[i]&&"object"==typeof array[i]?this.copyObject(array[i]):array[i];return copy},exports.deepCopy=function deepCopy(obj){if("object"!=typeof obj||!obj)return obj;var copy;if(Array.isArray(obj)){copy=[];for(var key=0;obj.length>key;key++)copy[key]=deepCopy(obj[key]);return copy}if("[object Object]"!==Object.prototype.toString.call(obj))return obj;copy={};for(var key in obj)copy[key]=deepCopy(obj[key]);return copy},exports.arrayToMap=function(arr){for(var map={},i=0;arr.length>i;i++)map[arr[i]]=1;return map},exports.createMap=function(props){var map=Object.create(null);for(var i in props)map[i]=props[i];return map},exports.arrayRemove=function(array,value){for(var i=0;array.length>=i;i++)value===array[i]&&array.splice(i,1)},exports.escapeRegExp=function(str){return str.replace(/([.*+?^${}()|[\\]\\/\\\\])/g,"\\\\$1")},exports.escapeHTML=function(str){return str.replace(/&/g,"&#38;").replace(/"/g,"&#34;").replace(/\'/g,"&#39;").replace(/</g,"&#60;")},exports.getMatchOffsets=function(string,regExp){var matches=[];return string.replace(regExp,function(str){matches.push({offset:arguments[arguments.length-2],length:str.length})}),matches},exports.deferredCall=function(fcn){var timer=null,callback=function(){timer=null,fcn()},deferred=function(timeout){return deferred.cancel(),timer=setTimeout(callback,timeout||0),deferred};return deferred.schedule=deferred,deferred.call=function(){return this.cancel(),fcn(),deferred},deferred.cancel=function(){return clearTimeout(timer),timer=null,deferred},deferred.isPending=function(){return timer},deferred},exports.delayedCall=function(fcn,defaultTimeout){var timer=null,callback=function(){timer=null,fcn()},_self=function(timeout){null==timer&&(timer=setTimeout(callback,timeout||defaultTimeout))};return _self.delay=function(timeout){timer&&clearTimeout(timer),timer=setTimeout(callback,timeout||defaultTimeout)},_self.schedule=_self,_self.call=function(){this.cancel(),fcn()},_self.cancel=function(){timer&&clearTimeout(timer),timer=null},_self.isPending=function(){return timer},_self}}),ace.define("ace/worker/mirror",["require","exports","module","ace/range","ace/document","ace/lib/lang"],function(acequire,exports){"use strict";acequire("../range").Range;var Document=acequire("../document").Document,lang=acequire("../lib/lang"),Mirror=exports.Mirror=function(sender){this.sender=sender;var doc=this.doc=new Document(""),deferredUpdate=this.deferredUpdate=lang.delayedCall(this.onUpdate.bind(this)),_self=this;sender.on("change",function(e){var data=e.data;if(data[0].start)doc.applyDeltas(data);else for(var i=0;data.length>i;i+=2){if(Array.isArray(data[i+1]))var d={action:"insert",start:data[i],lines:data[i+1]};else var d={action:"remove",start:data[i],end:data[i+1]};doc.applyDelta(d,!0)}return _self.$timeout?deferredUpdate.schedule(_self.$timeout):(_self.onUpdate(),void 0)})};(function(){this.$timeout=500,this.setTimeout=function(timeout){this.$timeout=timeout},this.setValue=function(value){this.doc.setValue(value),this.deferredUpdate.schedule(this.$timeout)},this.getValue=function(callbackId){this.sender.callback(this.doc.getValue(),callbackId)},this.onUpdate=function(){},this.isPending=function(){return this.deferredUpdate.isPending()}}).call(Mirror.prototype)}),ace.define("ace/mode/json/json_parse",["require","exports","module"],function(){"use strict";var at,ch,text,value,escapee={\'"\':\'"\',"\\\\":"\\\\","/":"/",b:"\\b",f:"\\f",n:"\\n",r:"\\r",t:"\t"},error=function(m){throw{name:"SyntaxError",message:m,at:at,text:text}},next=function(c){return c&&c!==ch&&error("Expected \'"+c+"\' instead of \'"+ch+"\'"),ch=text.charAt(at),at+=1,ch},number=function(){var number,string="";for("-"===ch&&(string="-",next("-"));ch>="0"&&"9">=ch;)string+=ch,next();if("."===ch)for(string+=".";next()&&ch>="0"&&"9">=ch;)string+=ch;if("e"===ch||"E"===ch)for(string+=ch,next(),("-"===ch||"+"===ch)&&(string+=ch,next());ch>="0"&&"9">=ch;)string+=ch,next();return number=+string,isNaN(number)?(error("Bad number"),void 0):number},string=function(){var hex,i,uffff,string="";if(\'"\'===ch)for(;next();){if(\'"\'===ch)return next(),string;if("\\\\"===ch)if(next(),"u"===ch){for(uffff=0,i=0;4>i&&(hex=parseInt(next(),16),isFinite(hex));i+=1)uffff=16*uffff+hex;string+=String.fromCharCode(uffff)}else{if("string"!=typeof escapee[ch])break;string+=escapee[ch]}else string+=ch}error("Bad string")},white=function(){for(;ch&&" ">=ch;)next()},word=function(){switch(ch){case"t":return next("t"),next("r"),next("u"),next("e"),!0;case"f":return next("f"),next("a"),next("l"),next("s"),next("e"),!1;case"n":return next("n"),next("u"),next("l"),next("l"),null}error("Unexpected \'"+ch+"\'")},array=function(){var array=[];if("["===ch){if(next("["),white(),"]"===ch)return next("]"),array;for(;ch;){if(array.push(value()),white(),"]"===ch)return next("]"),array;next(","),white()}}error("Bad array")},object=function(){var key,object={};if("{"===ch){if(next("{"),white(),"}"===ch)return next("}"),object;for(;ch;){if(key=string(),white(),next(":"),Object.hasOwnProperty.call(object,key)&&error(\'Duplicate key "\'+key+\'"\'),object[key]=value(),white(),"}"===ch)return next("}"),object;next(","),white()}}error("Bad object")};return value=function(){switch(white(),ch){case"{":return object();case"[":return array();case\'"\':return string();case"-":return number();default:return ch>="0"&&"9">=ch?number():word()}},function(source,reviver){var result;return text=source,at=0,ch=" ",result=value(),white(),ch&&error("Syntax error"),"function"==typeof reviver?function walk(holder,key){var k,v,value=holder[key];if(value&&"object"==typeof value)for(k in value)Object.hasOwnProperty.call(value,k)&&(v=walk(value,k),void 0!==v?value[k]=v:delete value[k]);return reviver.call(holder,key,value)}({"":result},""):result}}),ace.define("ace/mode/json_worker",["require","exports","module","ace/lib/oop","ace/worker/mirror","ace/mode/json/json_parse"],function(acequire,exports){"use strict";var oop=acequire("../lib/oop"),Mirror=acequire("../worker/mirror").Mirror,parse=acequire("./json/json_parse"),JsonWorker=exports.JsonWorker=function(sender){Mirror.call(this,sender),this.setTimeout(200)};oop.inherits(JsonWorker,Mirror),function(){this.onUpdate=function(){var value=this.doc.getValue(),errors=[];try{value&&parse(value)}catch(e){var pos=this.doc.indexToPosition(e.at-1);errors.push({row:pos.row,column:pos.column,text:e.message,type:"error"})}this.sender.emit("annotate",errors)}}.call(JsonWorker.prototype)}),ace.define("ace/lib/es5-shim",["require","exports","module"],function(){function Empty(){}function doesDefinePropertyWork(object){try{return Object.defineProperty(object,"sentinel",{}),"sentinel"in object}catch(exception){}}function toInteger(n){return n=+n,n!==n?n=0:0!==n&&n!==1/0&&n!==-(1/0)&&(n=(n>0||-1)*Math.floor(Math.abs(n))),n}Function.prototype.bind||(Function.prototype.bind=function(that){var target=this;if("function"!=typeof target)throw new TypeError("Function.prototype.bind called on incompatible "+target);var args=slice.call(arguments,1),bound=function(){if(this instanceof bound){var result=target.apply(this,args.concat(slice.call(arguments)));return Object(result)===result?result:this}return target.apply(that,args.concat(slice.call(arguments)))};return target.prototype&&(Empty.prototype=target.prototype,bound.prototype=new Empty,Empty.prototype=null),bound});var defineGetter,defineSetter,lookupGetter,lookupSetter,supportsAccessors,call=Function.prototype.call,prototypeOfArray=Array.prototype,prototypeOfObject=Object.prototype,slice=prototypeOfArray.slice,_toString=call.bind(prototypeOfObject.toString),owns=call.bind(prototypeOfObject.hasOwnProperty);if((supportsAccessors=owns(prototypeOfObject,"__defineGetter__"))&&(defineGetter=call.bind(prototypeOfObject.__defineGetter__),defineSetter=call.bind(prototypeOfObject.__defineSetter__),lookupGetter=call.bind(prototypeOfObject.__lookupGetter__),lookupSetter=call.bind(prototypeOfObject.__lookupSetter__)),2!=[1,2].splice(0).length)if(function(){function makeArray(l){var a=Array(l+2);return a[0]=a[1]=0,a}var lengthBefore,array=[];return array.splice.apply(array,makeArray(20)),array.splice.apply(array,makeArray(26)),lengthBefore=array.length,array.splice(5,0,"XXX"),lengthBefore+1==array.length,lengthBefore+1==array.length?!0:void 0\n}()){var array_splice=Array.prototype.splice;Array.prototype.splice=function(start,deleteCount){return arguments.length?array_splice.apply(this,[void 0===start?0:start,void 0===deleteCount?this.length-start:deleteCount].concat(slice.call(arguments,2))):[]}}else Array.prototype.splice=function(pos,removeCount){var length=this.length;pos>0?pos>length&&(pos=length):void 0==pos?pos=0:0>pos&&(pos=Math.max(length+pos,0)),length>pos+removeCount||(removeCount=length-pos);var removed=this.slice(pos,pos+removeCount),insert=slice.call(arguments,2),add=insert.length;if(pos===length)add&&this.push.apply(this,insert);else{var remove=Math.min(removeCount,length-pos),tailOldPos=pos+remove,tailNewPos=tailOldPos+add-remove,tailCount=length-tailOldPos,lengthAfterRemove=length-remove;if(tailOldPos>tailNewPos)for(var i=0;tailCount>i;++i)this[tailNewPos+i]=this[tailOldPos+i];else if(tailNewPos>tailOldPos)for(i=tailCount;i--;)this[tailNewPos+i]=this[tailOldPos+i];if(add&&pos===lengthAfterRemove)this.length=lengthAfterRemove,this.push.apply(this,insert);else for(this.length=lengthAfterRemove+add,i=0;add>i;++i)this[pos+i]=insert[i]}return removed};Array.isArray||(Array.isArray=function(obj){return"[object Array]"==_toString(obj)});var boxedString=Object("a"),splitString="a"!=boxedString[0]||!(0 in boxedString);if(Array.prototype.forEach||(Array.prototype.forEach=function(fun){var object=toObject(this),self=splitString&&"[object String]"==_toString(this)?this.split(""):object,thisp=arguments[1],i=-1,length=self.length>>>0;if("[object Function]"!=_toString(fun))throw new TypeError;for(;length>++i;)i in self&&fun.call(thisp,self[i],i,object)}),Array.prototype.map||(Array.prototype.map=function(fun){var object=toObject(this),self=splitString&&"[object String]"==_toString(this)?this.split(""):object,length=self.length>>>0,result=Array(length),thisp=arguments[1];if("[object Function]"!=_toString(fun))throw new TypeError(fun+" is not a function");for(var i=0;length>i;i++)i in self&&(result[i]=fun.call(thisp,self[i],i,object));return result}),Array.prototype.filter||(Array.prototype.filter=function(fun){var value,object=toObject(this),self=splitString&&"[object String]"==_toString(this)?this.split(""):object,length=self.length>>>0,result=[],thisp=arguments[1];if("[object Function]"!=_toString(fun))throw new TypeError(fun+" is not a function");for(var i=0;length>i;i++)i in self&&(value=self[i],fun.call(thisp,value,i,object)&&result.push(value));return result}),Array.prototype.every||(Array.prototype.every=function(fun){var object=toObject(this),self=splitString&&"[object String]"==_toString(this)?this.split(""):object,length=self.length>>>0,thisp=arguments[1];if("[object Function]"!=_toString(fun))throw new TypeError(fun+" is not a function");for(var i=0;length>i;i++)if(i in self&&!fun.call(thisp,self[i],i,object))return!1;return!0}),Array.prototype.some||(Array.prototype.some=function(fun){var object=toObject(this),self=splitString&&"[object String]"==_toString(this)?this.split(""):object,length=self.length>>>0,thisp=arguments[1];if("[object Function]"!=_toString(fun))throw new TypeError(fun+" is not a function");for(var i=0;length>i;i++)if(i in self&&fun.call(thisp,self[i],i,object))return!0;return!1}),Array.prototype.reduce||(Array.prototype.reduce=function(fun){var object=toObject(this),self=splitString&&"[object String]"==_toString(this)?this.split(""):object,length=self.length>>>0;if("[object Function]"!=_toString(fun))throw new TypeError(fun+" is not a function");if(!length&&1==arguments.length)throw new TypeError("reduce of empty array with no initial value");var result,i=0;if(arguments.length>=2)result=arguments[1];else for(;;){if(i in self){result=self[i++];break}if(++i>=length)throw new TypeError("reduce of empty array with no initial value")}for(;length>i;i++)i in self&&(result=fun.call(void 0,result,self[i],i,object));return result}),Array.prototype.reduceRight||(Array.prototype.reduceRight=function(fun){var object=toObject(this),self=splitString&&"[object String]"==_toString(this)?this.split(""):object,length=self.length>>>0;if("[object Function]"!=_toString(fun))throw new TypeError(fun+" is not a function");if(!length&&1==arguments.length)throw new TypeError("reduceRight of empty array with no initial value");var result,i=length-1;if(arguments.length>=2)result=arguments[1];else for(;;){if(i in self){result=self[i--];break}if(0>--i)throw new TypeError("reduceRight of empty array with no initial value")}do i in this&&(result=fun.call(void 0,result,self[i],i,object));while(i--);return result}),Array.prototype.indexOf&&-1==[0,1].indexOf(1,2)||(Array.prototype.indexOf=function(sought){var self=splitString&&"[object String]"==_toString(this)?this.split(""):toObject(this),length=self.length>>>0;if(!length)return-1;var i=0;for(arguments.length>1&&(i=toInteger(arguments[1])),i=i>=0?i:Math.max(0,length+i);length>i;i++)if(i in self&&self[i]===sought)return i;return-1}),Array.prototype.lastIndexOf&&-1==[0,1].lastIndexOf(0,-3)||(Array.prototype.lastIndexOf=function(sought){var self=splitString&&"[object String]"==_toString(this)?this.split(""):toObject(this),length=self.length>>>0;if(!length)return-1;var i=length-1;for(arguments.length>1&&(i=Math.min(i,toInteger(arguments[1]))),i=i>=0?i:length-Math.abs(i);i>=0;i--)if(i in self&&sought===self[i])return i;return-1}),Object.getPrototypeOf||(Object.getPrototypeOf=function(object){return object.__proto__||(object.constructor?object.constructor.prototype:prototypeOfObject)}),!Object.getOwnPropertyDescriptor){var ERR_NON_OBJECT="Object.getOwnPropertyDescriptor called on a non-object: ";Object.getOwnPropertyDescriptor=function(object,property){if("object"!=typeof object&&"function"!=typeof object||null===object)throw new TypeError(ERR_NON_OBJECT+object);if(owns(object,property)){var descriptor,getter,setter;if(descriptor={enumerable:!0,configurable:!0},supportsAccessors){var prototype=object.__proto__;object.__proto__=prototypeOfObject;var getter=lookupGetter(object,property),setter=lookupSetter(object,property);if(object.__proto__=prototype,getter||setter)return getter&&(descriptor.get=getter),setter&&(descriptor.set=setter),descriptor}return descriptor.value=object[property],descriptor}}}if(Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(object){return Object.keys(object)}),!Object.create){var createEmpty;createEmpty=null===Object.prototype.__proto__?function(){return{__proto__:null}}:function(){var empty={};for(var i in empty)empty[i]=null;return empty.constructor=empty.hasOwnProperty=empty.propertyIsEnumerable=empty.isPrototypeOf=empty.toLocaleString=empty.toString=empty.valueOf=empty.__proto__=null,empty},Object.create=function(prototype,properties){var object;if(null===prototype)object=createEmpty();else{if("object"!=typeof prototype)throw new TypeError("typeof prototype["+typeof prototype+"] != \'object\'");var Type=function(){};Type.prototype=prototype,object=new Type,object.__proto__=prototype}return void 0!==properties&&Object.defineProperties(object,properties),object}}if(Object.defineProperty){var definePropertyWorksOnObject=doesDefinePropertyWork({}),definePropertyWorksOnDom="undefined"==typeof document||doesDefinePropertyWork(document.createElement("div"));if(!definePropertyWorksOnObject||!definePropertyWorksOnDom)var definePropertyFallback=Object.defineProperty}if(!Object.defineProperty||definePropertyFallback){var ERR_NON_OBJECT_DESCRIPTOR="Property description must be an object: ",ERR_NON_OBJECT_TARGET="Object.defineProperty called on non-object: ",ERR_ACCESSORS_NOT_SUPPORTED="getters & setters can not be defined on this javascript engine";Object.defineProperty=function(object,property,descriptor){if("object"!=typeof object&&"function"!=typeof object||null===object)throw new TypeError(ERR_NON_OBJECT_TARGET+object);if("object"!=typeof descriptor&&"function"!=typeof descriptor||null===descriptor)throw new TypeError(ERR_NON_OBJECT_DESCRIPTOR+descriptor);if(definePropertyFallback)try{return definePropertyFallback.call(Object,object,property,descriptor)}catch(exception){}if(owns(descriptor,"value"))if(supportsAccessors&&(lookupGetter(object,property)||lookupSetter(object,property))){var prototype=object.__proto__;object.__proto__=prototypeOfObject,delete object[property],object[property]=descriptor.value,object.__proto__=prototype}else object[property]=descriptor.value;else{if(!supportsAccessors)throw new TypeError(ERR_ACCESSORS_NOT_SUPPORTED);owns(descriptor,"get")&&defineGetter(object,property,descriptor.get),owns(descriptor,"set")&&defineSetter(object,property,descriptor.set)}return object}}Object.defineProperties||(Object.defineProperties=function(object,properties){for(var property in properties)owns(properties,property)&&Object.defineProperty(object,property,properties[property]);return object}),Object.seal||(Object.seal=function(object){return object}),Object.freeze||(Object.freeze=function(object){return object});try{Object.freeze(function(){})}catch(exception){Object.freeze=function(freezeObject){return function(object){return"function"==typeof object?object:freezeObject(object)}}(Object.freeze)}if(Object.preventExtensions||(Object.preventExtensions=function(object){return object}),Object.isSealed||(Object.isSealed=function(){return!1}),Object.isFrozen||(Object.isFrozen=function(){return!1}),Object.isExtensible||(Object.isExtensible=function(object){if(Object(object)===object)throw new TypeError;for(var name="";owns(object,name);)name+="?";object[name]=!0;var returnValue=owns(object,name);return delete object[name],returnValue}),!Object.keys){var hasDontEnumBug=!0,dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],dontEnumsLength=dontEnums.length;for(var key in{toString:null})hasDontEnumBug=!1;Object.keys=function(object){if("object"!=typeof object&&"function"!=typeof object||null===object)throw new TypeError("Object.keys called on a non-object");var keys=[];for(var name in object)owns(object,name)&&keys.push(name);if(hasDontEnumBug)for(var i=0,ii=dontEnumsLength;ii>i;i++){var dontEnum=dontEnums[i];owns(object,dontEnum)&&keys.push(dontEnum)}return keys}}Date.now||(Date.now=function(){return(new Date).getTime()});var ws="\t\\n\v\\f\\r   ᠎             　\\u2028\\u2029\ufeff";if(!String.prototype.trim||ws.trim()){ws="["+ws+"]";var trimBeginRegexp=RegExp("^"+ws+ws+"*"),trimEndRegexp=RegExp(ws+ws+"*$");String.prototype.trim=function(){return(this+"").replace(trimBeginRegexp,"").replace(trimEndRegexp,"")}}var toObject=function(o){if(null==o)throw new TypeError("can\'t convert "+o+" to object");return Object(o)}});'},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.XJsonMode=exports.installXJsonMode=void 0;var x_json_1=__webpack_require__(437);Object.defineProperty(exports,"installXJsonMode",{enumerable:true,get:function(){return x_json_1.installXJsonMode}});Object.defineProperty(exports,"XJsonMode",{enumerable:true,get:function(){return x_json_1.XJsonMode}})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.installXJsonMode=exports.XJsonMode=void 0;const tslib_1=__webpack_require__(38);const brace_1=tslib_1.__importDefault(__webpack_require__(184));const index_1=__webpack_require__(291);const worker_1=__webpack_require__(438);const{WorkerClient:WorkerClient}=brace_1.default.acequire("ace/worker/worker_client");const oop=brace_1.default.acequire("ace/lib/oop");const{Mode:JSONMode}=brace_1.default.acequire("ace/mode/json");const{Tokenizer:AceTokenizer}=brace_1.default.acequire("ace/tokenizer");const{MatchingBraceOutdent:MatchingBraceOutdent}=brace_1.default.acequire("ace/mode/matching_brace_outdent");const{CstyleBehaviour:CstyleBehaviour}=brace_1.default.acequire("ace/mode/behaviour/cstyle");const{FoldMode:CStyleFoldMode}=brace_1.default.acequire("ace/mode/folding/cstyle");const XJsonMode=function XJsonMode(){const ruleset=new index_1.XJsonHighlightRules;ruleset.normalizeRules();this.$tokenizer=new AceTokenizer(ruleset.getRules());this.$outdent=new MatchingBraceOutdent;this.$behaviour=new CstyleBehaviour;this.foldingRules=new CStyleFoldMode};exports.XJsonMode=XJsonMode;oop.inherits(XJsonMode,JSONMode);XJsonMode.prototype.createWorker=function(session){const xJsonWorker=new WorkerClient(["ace"],worker_1.workerModule,"JsonWorker");xJsonWorker.attachToDocument(session.getDocument());xJsonWorker.on("annotate",(function(e){session.setAnnotations(e.data)}));xJsonWorker.on("terminate",(function(){session.clearAnnotations()}));return xJsonWorker};function installXJsonMode(editor){const session=editor.getSession();session.setMode(new XJsonMode)}exports.installXJsonMode=installXJsonMode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.workerModule=void 0;const tslib_1=__webpack_require__(38);const x_json_ace_worker_js_1=tslib_1.__importDefault(__webpack_require__(439));exports.workerModule={id:"ace/mode/json_worker",src:x_json_ace_worker_js_1.default}},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_exports__["default"]='/*\n * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n * or more contributor license agreements. Licensed under the Elastic License\n * 2.0 and the Server Side Public License, v 1; you may not use this file except\n * in compliance with, at your election, the Elastic License 2.0 or the Server\n * Side Public License, v 1.\n */\n\n/* @notice\n *\n * This product includes code that is based on Ace editor, which was available\n * under a "BSD" license.\n *\n * Distributed under the BSD license:\n *\n * Copyright (c) 2010, Ajax.org B.V.\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *     * Redistributions of source code must retain the above copyright\n *       notice, this list of conditions and the following disclaimer.\n *     * Redistributions in binary form must reproduce the above copyright\n *       notice, this list of conditions and the following disclaimer in the\n *       documentation and/or other materials provided with the distribution.\n *     * Neither the name of Ajax.org B.V. nor the\n *       names of its contributors may be used to endorse or promote products\n *       derived from this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND\n * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL AJAX.ORG B.V. BE LIABLE FOR ANY\n * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\n * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\n * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\n * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n/* eslint-disable */\n/*\n  This file is loaded up as a blob by Brace to hand to Ace to load as Jsonp\n  (hence the redefining of everything).  It is based on the json\n  mode from the brace distro.\n\n  It is very likely that this file will be removed in future but for now it enables\n  extended JSON parsing, like e.g. """{}""" (triple quotes)\n*/\n"no use strict";\n! function(window) {\n  function resolveModuleId(id, paths) {\n    for (var testPath = id, tail = ""; testPath;) {\n      var alias = paths[testPath];\n      if ("string" == typeof alias) return alias + tail;\n      if (alias) return alias.location.replace(/\\/*$/, "/") + (tail || alias.main || alias.name);\n      if (alias === !1) return "";\n      var i = testPath.lastIndexOf("/");\n      if (-1 === i) break;\n      tail = testPath.substr(i) + tail, testPath = testPath.slice(0, i)\n    }\n    return id\n  }\n  if (!(void 0 !== window.window && window.document || window.acequire && window.define)) {\n    window.console || (window.console = function() {\n      var msgs = Array.prototype.slice.call(arguments, 0);\n      postMessage({\n        type: "log",\n        data: msgs\n      })\n    }, window.console.error = window.console.warn = window.console.log = window.console.trace = window.console), window.window = window, window.ace = window, window.onerror = function(message, file, line, col, err) {\n      postMessage({\n        type: "error",\n        data: {\n          message: message,\n          data: err.data,\n          file: file,\n          line: line,\n          col: col,\n          stack: err.stack\n        }\n      })\n    }, window.normalizeModule = function(parentId, moduleName) {\n      if (-1 !== moduleName.indexOf("!")) {\n        var chunks = moduleName.split("!");\n        return window.normalizeModule(parentId, chunks[0]) + "!" + window.normalizeModule(parentId, chunks[1])\n      }\n      if ("." == moduleName.charAt(0)) {\n        var base = parentId.split("/").slice(0, -1).join("/");\n        for (moduleName = (base ? base + "/" : "") + moduleName; - 1 !== moduleName.indexOf(".") && previous != moduleName;) {\n          var previous = moduleName;\n          moduleName = moduleName.replace(/^\\.\\//, "").replace(/\\/\\.\\//, "/").replace(/[^\\/]+\\/\\.\\.\\//, "")\n        }\n      }\n      return moduleName\n    }, window.acequire = function acequire(parentId, id) {\n      if (id || (id = parentId, parentId = null), !id.charAt) throw Error("worker.js acequire() accepts only (parentId, id) as arguments");\n      id = window.normalizeModule(parentId, id);\n      var module = window.acequire.modules[id];\n      if (module) return module.initialized || (module.initialized = !0, module.exports = module.factory().exports), module.exports;\n      if (!window.acequire.tlns) return console.log("unable to load " + id);\n      var path = resolveModuleId(id, window.acequire.tlns);\n      return ".js" != path.slice(-3) && (path += ".js"), window.acequire.id = id, window.acequire.modules[id] = {}, importScripts(path), window.acequire(parentId, id)\n    }, window.acequire.modules = {}, window.acequire.tlns = {}, window.define = function(id, deps, factory) {\n      if (2 == arguments.length ? (factory = deps, "string" != typeof id && (deps = id, id = window.acequire.id)) : 1 == arguments.length && (factory = id, deps = [], id = window.acequire.id), "function" != typeof factory) return window.acequire.modules[id] = {\n        exports: factory,\n        initialized: !0\n      }, void 0;\n      deps.length || (deps = ["require", "exports", "module"]);\n      var req = function(childId) {\n        return window.acequire(id, childId)\n      };\n      window.acequire.modules[id] = {\n        exports: {},\n        factory: function() {\n          var module = this,\n            returnExports = factory.apply(this, deps.map(function(dep) {\n              switch (dep) {\n                case "require":\n                  return req;\n                case "exports":\n                  return module.exports;\n                case "module":\n                  return module;\n                default:\n                  return req(dep)\n              }\n            }));\n          return returnExports && (module.exports = returnExports), module\n        }\n      }\n    }, window.define.amd = {}, acequire.tlns = {}, window.initBaseUrls = function(topLevelNamespaces) {\n      for (var i in topLevelNamespaces) acequire.tlns[i] = topLevelNamespaces[i]\n    }, window.initSender = function() {\n      var EventEmitter = window.acequire("ace/lib/event_emitter").EventEmitter,\n        oop = window.acequire("ace/lib/oop"),\n        Sender = function() {};\n      return function() {\n        oop.implement(this, EventEmitter), this.callback = function(data, callbackId) {\n          postMessage({\n            type: "call",\n            id: callbackId,\n            data: data\n          })\n        }, this.emit = function(name, data) {\n          postMessage({\n            type: "event",\n            name: name,\n            data: data\n          })\n        }\n      }.call(Sender.prototype), new Sender\n    };\n    var main = window.main = null,\n      sender = window.sender = null;\n    window.onmessage = function(e) {\n      var msg = e.data;\n      if (msg.event && sender) sender._signal(msg.event, msg.data);\n      else if (msg.command)\n        if (main[msg.command]) main[msg.command].apply(main, msg.args);\n        else {\n          if (!window[msg.command]) throw Error("Unknown command:" + msg.command);\n          window[msg.command].apply(window, msg.args)\n        }\n      else if (msg.init) {\n        window.initBaseUrls(msg.tlns), acequire("ace/lib/es5-shim"), sender = window.sender = window.initSender();\n        var clazz = acequire(msg.module)[msg.classname];\n        main = window.main = new clazz(sender)\n      }\n    }\n  }\n}(this), ace.define("ace/lib/oop", ["require", "exports", "module"], function(acequire, exports) {\n  "use strict";\n  exports.inherits = function(ctor, superCtor) {\n    ctor.super_ = superCtor, ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: !1,\n        writable: !0,\n        configurable: !0\n      }\n    })\n  }, exports.mixin = function(obj, mixin) {\n    for (var key in mixin) obj[key] = mixin[key];\n    return obj\n  }, exports.implement = function(proto, mixin) {\n    exports.mixin(proto, mixin)\n  }\n}), ace.define("ace/range", ["require", "exports", "module"], function(acequire, exports) {\n  "use strict";\n  var comparePoints = function(p1, p2) {\n      return p1.row - p2.row || p1.column - p2.column\n    },\n    Range = function(startRow, startColumn, endRow, endColumn) {\n      this.start = {\n        row: startRow,\n        column: startColumn\n      }, this.end = {\n        row: endRow,\n        column: endColumn\n      }\n    };\n  (function() {\n    this.isEqual = function(range) {\n      return this.start.row === range.start.row && this.end.row === range.end.row && this.start.column === range.start.column && this.end.column === range.end.column\n    }, this.toString = function() {\n      return "Range: [" + this.start.row + "/" + this.start.column + "] -> [" + this.end.row + "/" + this.end.column + "]"\n    }, this.contains = function(row, column) {\n      return 0 == this.compare(row, column)\n    }, this.compareRange = function(range) {\n      var cmp, end = range.end,\n        start = range.start;\n      return cmp = this.compare(end.row, end.column), 1 == cmp ? (cmp = this.compare(start.row, start.column), 1 == cmp ? 2 : 0 == cmp ? 1 : 0) : -1 == cmp ? -2 : (cmp = this.compare(start.row, start.column), -1 == cmp ? -1 : 1 == cmp ? 42 : 0)\n    }, this.comparePoint = function(p) {\n      return this.compare(p.row, p.column)\n    }, this.containsRange = function(range) {\n      return 0 == this.comparePoint(range.start) && 0 == this.comparePoint(range.end)\n    }, this.intersects = function(range) {\n      var cmp = this.compareRange(range);\n      return -1 == cmp || 0 == cmp || 1 == cmp\n    }, this.isEnd = function(row, column) {\n      return this.end.row == row && this.end.column == column\n    }, this.isStart = function(row, column) {\n      return this.start.row == row && this.start.column == column\n    }, this.setStart = function(row, column) {\n      "object" == typeof row ? (this.start.column = row.column, this.start.row = row.row) : (this.start.row = row, this.start.column = column)\n    }, this.setEnd = function(row, column) {\n      "object" == typeof row ? (this.end.column = row.column, this.end.row = row.row) : (this.end.row = row, this.end.column = column)\n    }, this.inside = function(row, column) {\n      return 0 == this.compare(row, column) ? this.isEnd(row, column) || this.isStart(row, column) ? !1 : !0 : !1\n    }, this.insideStart = function(row, column) {\n      return 0 == this.compare(row, column) ? this.isEnd(row, column) ? !1 : !0 : !1\n    }, this.insideEnd = function(row, column) {\n      return 0 == this.compare(row, column) ? this.isStart(row, column) ? !1 : !0 : !1\n    }, this.compare = function(row, column) {\n      return this.isMultiLine() || row !== this.start.row ? this.start.row > row ? -1 : row > this.end.row ? 1 : this.start.row === row ? column >= this.start.column ? 0 : -1 : this.end.row === row ? this.end.column >= column ? 0 : 1 : 0 : this.start.column > column ? -1 : column > this.end.column ? 1 : 0\n    }, this.compareStart = function(row, column) {\n      return this.start.row == row && this.start.column == column ? -1 : this.compare(row, column)\n    }, this.compareEnd = function(row, column) {\n      return this.end.row == row && this.end.column == column ? 1 : this.compare(row, column)\n    }, this.compareInside = function(row, column) {\n      return this.end.row == row && this.end.column == column ? 1 : this.start.row == row && this.start.column == column ? -1 : this.compare(row, column)\n    }, this.clipRows = function(firstRow, lastRow) {\n      if (this.end.row > lastRow) var end = {\n        row: lastRow + 1,\n        column: 0\n      };\n      else if (firstRow > this.end.row) var end = {\n        row: firstRow,\n        column: 0\n      };\n      if (this.start.row > lastRow) var start = {\n        row: lastRow + 1,\n        column: 0\n      };\n      else if (firstRow > this.start.row) var start = {\n        row: firstRow,\n        column: 0\n      };\n      return Range.fromPoints(start || this.start, end || this.end)\n    }, this.extend = function(row, column) {\n      var cmp = this.compare(row, column);\n      if (0 == cmp) return this;\n      if (-1 == cmp) var start = {\n        row: row,\n        column: column\n      };\n      else var end = {\n        row: row,\n        column: column\n      };\n      return Range.fromPoints(start || this.start, end || this.end)\n    }, this.isEmpty = function() {\n      return this.start.row === this.end.row && this.start.column === this.end.column\n    }, this.isMultiLine = function() {\n      return this.start.row !== this.end.row\n    }, this.clone = function() {\n      return Range.fromPoints(this.start, this.end)\n    }, this.collapseRows = function() {\n      return 0 == this.end.column ? new Range(this.start.row, 0, Math.max(this.start.row, this.end.row - 1), 0) : new Range(this.start.row, 0, this.end.row, 0)\n    }, this.toScreenRange = function(session) {\n      var screenPosStart = session.documentToScreenPosition(this.start),\n        screenPosEnd = session.documentToScreenPosition(this.end);\n      return new Range(screenPosStart.row, screenPosStart.column, screenPosEnd.row, screenPosEnd.column)\n    }, this.moveBy = function(row, column) {\n      this.start.row += row, this.start.column += column, this.end.row += row, this.end.column += column\n    }\n  }).call(Range.prototype), Range.fromPoints = function(start, end) {\n    return new Range(start.row, start.column, end.row, end.column)\n  }, Range.comparePoints = comparePoints, Range.comparePoints = function(p1, p2) {\n    return p1.row - p2.row || p1.column - p2.column\n  }, exports.Range = Range\n}), ace.define("ace/apply_delta", ["require", "exports", "module"], function(acequire, exports) {\n  "use strict";\n  exports.applyDelta = function(docLines, delta) {\n    var row = delta.start.row,\n      startColumn = delta.start.column,\n      line = docLines[row] || "";\n    switch (delta.action) {\n      case "insert":\n        var lines = delta.lines;\n        if (1 === lines.length) docLines[row] = line.substring(0, startColumn) + delta.lines[0] + line.substring(startColumn);\n        else {\n          var args = [row, 1].concat(delta.lines);\n          docLines.splice.apply(docLines, args), docLines[row] = line.substring(0, startColumn) + docLines[row], docLines[row + delta.lines.length - 1] += line.substring(startColumn)\n        }\n        break;\n      case "remove":\n        var endColumn = delta.end.column,\n          endRow = delta.end.row;\n        row === endRow ? docLines[row] = line.substring(0, startColumn) + line.substring(endColumn) : docLines.splice(row, endRow - row + 1, line.substring(0, startColumn) + docLines[endRow].substring(endColumn))\n    }\n  }\n}), ace.define("ace/lib/event_emitter", ["require", "exports", "module"], function(acequire, exports) {\n  "use strict";\n  var EventEmitter = {},\n    stopPropagation = function() {\n      this.propagationStopped = !0\n    },\n    preventDefault = function() {\n      this.defaultPrevented = !0\n    };\n  EventEmitter._emit = EventEmitter._dispatchEvent = function(eventName, e) {\n    this._eventRegistry || (this._eventRegistry = {}), this._defaultHandlers || (this._defaultHandlers = {});\n    var listeners = this._eventRegistry[eventName] || [],\n      defaultHandler = this._defaultHandlers[eventName];\n    if (listeners.length || defaultHandler) {\n      "object" == typeof e && e || (e = {}), e.type || (e.type = eventName), e.stopPropagation || (e.stopPropagation = stopPropagation), e.preventDefault || (e.preventDefault = preventDefault), listeners = listeners.slice();\n      for (var i = 0; listeners.length > i && (listeners[i](e, this), !e.propagationStopped); i++);\n      return defaultHandler && !e.defaultPrevented ? defaultHandler(e, this) : void 0\n    }\n  }, EventEmitter._signal = function(eventName, e) {\n    var listeners = (this._eventRegistry || {})[eventName];\n    if (listeners) {\n      listeners = listeners.slice();\n      for (var i = 0; listeners.length > i; i++) listeners[i](e, this)\n    }\n  }, EventEmitter.once = function(eventName, callback) {\n    var _self = this;\n    callback && this.addEventListener(eventName, function newCallback() {\n      _self.removeEventListener(eventName, newCallback), callback.apply(null, arguments)\n    })\n  }, EventEmitter.setDefaultHandler = function(eventName, callback) {\n    var handlers = this._defaultHandlers;\n    if (handlers || (handlers = this._defaultHandlers = {\n        _disabled_: {}\n      }), handlers[eventName]) {\n      var old = handlers[eventName],\n        disabled = handlers._disabled_[eventName];\n      disabled || (handlers._disabled_[eventName] = disabled = []), disabled.push(old);\n      var i = disabled.indexOf(callback); - 1 != i && disabled.splice(i, 1)\n    }\n    handlers[eventName] = callback\n  }, EventEmitter.removeDefaultHandler = function(eventName, callback) {\n    var handlers = this._defaultHandlers;\n    if (handlers) {\n      var disabled = handlers._disabled_[eventName];\n      if (handlers[eventName] == callback) handlers[eventName], disabled && this.setDefaultHandler(eventName, disabled.pop());\n      else if (disabled) {\n        var i = disabled.indexOf(callback); - 1 != i && disabled.splice(i, 1)\n      }\n    }\n  }, EventEmitter.on = EventEmitter.addEventListener = function(eventName, callback, capturing) {\n    this._eventRegistry = this._eventRegistry || {};\n    var listeners = this._eventRegistry[eventName];\n    return listeners || (listeners = this._eventRegistry[eventName] = []), -1 == listeners.indexOf(callback) && listeners[capturing ? "unshift" : "push"](callback), callback\n  }, EventEmitter.off = EventEmitter.removeListener = EventEmitter.removeEventListener = function(eventName, callback) {\n    this._eventRegistry = this._eventRegistry || {};\n    var listeners = this._eventRegistry[eventName];\n    if (listeners) {\n      var index = listeners.indexOf(callback); - 1 !== index && listeners.splice(index, 1)\n    }\n  }, EventEmitter.removeAllListeners = function(eventName) {\n    this._eventRegistry && (this._eventRegistry[eventName] = [])\n  }, exports.EventEmitter = EventEmitter\n}), ace.define("ace/anchor", ["require", "exports", "module", "ace/lib/oop", "ace/lib/event_emitter"], function(acequire, exports) {\n  "use strict";\n  var oop = acequire("./lib/oop"),\n    EventEmitter = acequire("./lib/event_emitter").EventEmitter,\n    Anchor = exports.Anchor = function(doc, row, column) {\n      this.$onChange = this.onChange.bind(this), this.attach(doc), column === void 0 ? this.setPosition(row.row, row.column) : this.setPosition(row, column)\n    };\n  (function() {\n    function $pointsInOrder(point1, point2, equalPointsInOrder) {\n      var bColIsAfter = equalPointsInOrder ? point1.column <= point2.column : point1.column < point2.column;\n      return point1.row < point2.row || point1.row == point2.row && bColIsAfter\n    }\n\n    function $getTransformedPoint(delta, point, moveIfEqual) {\n      var deltaIsInsert = "insert" == delta.action,\n        deltaRowShift = (deltaIsInsert ? 1 : -1) * (delta.end.row - delta.start.row),\n        deltaColShift = (deltaIsInsert ? 1 : -1) * (delta.end.column - delta.start.column),\n        deltaStart = delta.start,\n        deltaEnd = deltaIsInsert ? deltaStart : delta.end;\n      return $pointsInOrder(point, deltaStart, moveIfEqual) ? {\n        row: point.row,\n        column: point.column\n      } : $pointsInOrder(deltaEnd, point, !moveIfEqual) ? {\n        row: point.row + deltaRowShift,\n        column: point.column + (point.row == deltaEnd.row ? deltaColShift : 0)\n      } : {\n        row: deltaStart.row,\n        column: deltaStart.column\n      }\n    }\n    oop.implement(this, EventEmitter), this.getPosition = function() {\n      return this.$clipPositionToDocument(this.row, this.column)\n    }, this.getDocument = function() {\n      return this.document\n    }, this.$insertRight = !1, this.onChange = function(delta) {\n      if (!(delta.start.row == delta.end.row && delta.start.row != this.row || delta.start.row > this.row)) {\n        var point = $getTransformedPoint(delta, {\n          row: this.row,\n          column: this.column\n        }, this.$insertRight);\n        this.setPosition(point.row, point.column, !0)\n      }\n    }, this.setPosition = function(row, column, noClip) {\n      var pos;\n      if (pos = noClip ? {\n          row: row,\n          column: column\n        } : this.$clipPositionToDocument(row, column), this.row != pos.row || this.column != pos.column) {\n        var old = {\n          row: this.row,\n          column: this.column\n        };\n        this.row = pos.row, this.column = pos.column, this._signal("change", {\n          old: old,\n          value: pos\n        })\n      }\n    }, this.detach = function() {\n      this.document.removeEventListener("change", this.$onChange)\n    }, this.attach = function(doc) {\n      this.document = doc || this.document, this.document.on("change", this.$onChange)\n    }, this.$clipPositionToDocument = function(row, column) {\n      var pos = {};\n      return row >= this.document.getLength() ? (pos.row = Math.max(0, this.document.getLength() - 1), pos.column = this.document.getLine(pos.row).length) : 0 > row ? (pos.row = 0, pos.column = 0) : (pos.row = row, pos.column = Math.min(this.document.getLine(pos.row).length, Math.max(0, column))), 0 > column && (pos.column = 0), pos\n    }\n  }).call(Anchor.prototype)\n}), ace.define("ace/document", ["require", "exports", "module", "ace/lib/oop", "ace/apply_delta", "ace/lib/event_emitter", "ace/range", "ace/anchor"], function(acequire, exports) {\n  "use strict";\n  var oop = acequire("./lib/oop"),\n    applyDelta = acequire("./apply_delta").applyDelta,\n    EventEmitter = acequire("./lib/event_emitter").EventEmitter,\n    Range = acequire("./range").Range,\n    Anchor = acequire("./anchor").Anchor,\n    Document = function(textOrLines) {\n      this.$lines = [""], 0 === textOrLines.length ? this.$lines = [""] : Array.isArray(textOrLines) ? this.insertMergedLines({\n        row: 0,\n        column: 0\n      }, textOrLines) : this.insert({\n        row: 0,\n        column: 0\n      }, textOrLines)\n    };\n  (function() {\n    oop.implement(this, EventEmitter), this.setValue = function(text) {\n      var len = this.getLength() - 1;\n      this.remove(new Range(0, 0, len, this.getLine(len).length)), this.insert({\n        row: 0,\n        column: 0\n      }, text)\n    }, this.getValue = function() {\n      return this.getAllLines().join(this.getNewLineCharacter())\n    }, this.createAnchor = function(row, column) {\n      return new Anchor(this, row, column)\n    }, this.$split = 0 === "aaa".split(/a/).length ? function(text) {\n      return text.replace(/\\r\\n|\\r/g, "\\n").split("\\n")\n    } : function(text) {\n      return text.split(/\\r\\n|\\r|\\n/)\n    }, this.$detectNewLine = function(text) {\n      var match = text.match(/^.*?(\\r\\n|\\r|\\n)/m);\n      this.$autoNewLine = match ? match[1] : "\\n", this._signal("changeNewLineMode")\n    }, this.getNewLineCharacter = function() {\n      switch (this.$newLineMode) {\n        case "windows":\n          return "\\r\\n";\n        case "unix":\n          return "\\n";\n        default:\n          return this.$autoNewLine || "\\n"\n      }\n    }, this.$autoNewLine = "", this.$newLineMode = "auto", this.setNewLineMode = function(newLineMode) {\n      this.$newLineMode !== newLineMode && (this.$newLineMode = newLineMode, this._signal("changeNewLineMode"))\n    }, this.getNewLineMode = function() {\n      return this.$newLineMode\n    }, this.isNewLine = function(text) {\n      return "\\r\\n" == text || "\\r" == text || "\\n" == text\n    }, this.getLine = function(row) {\n      return this.$lines[row] || ""\n    }, this.getLines = function(firstRow, lastRow) {\n      return this.$lines.slice(firstRow, lastRow + 1)\n    }, this.getAllLines = function() {\n      return this.getLines(0, this.getLength())\n    }, this.getLength = function() {\n      return this.$lines.length\n    }, this.getTextRange = function(range) {\n      return this.getLinesForRange(range).join(this.getNewLineCharacter())\n    }, this.getLinesForRange = function(range) {\n      var lines;\n      if (range.start.row === range.end.row) lines = [this.getLine(range.start.row).substring(range.start.column, range.end.column)];\n      else {\n        lines = this.getLines(range.start.row, range.end.row), lines[0] = (lines[0] || "").substring(range.start.column);\n        var l = lines.length - 1;\n        range.end.row - range.start.row == l && (lines[l] = lines[l].substring(0, range.end.column))\n      }\n      return lines\n    }, this.insertLines = function(row, lines) {\n      return console.warn("Use of document.insertLines is deprecated. Use the insertFullLines method instead."), this.insertFullLines(row, lines)\n    }, this.removeLines = function(firstRow, lastRow) {\n      return console.warn("Use of document.removeLines is deprecated. Use the removeFullLines method instead."), this.removeFullLines(firstRow, lastRow)\n    }, this.insertNewLine = function(position) {\n      return console.warn("Use of document.insertNewLine is deprecated. Use insertMergedLines(position, [\'\', \'\']) instead."), this.insertMergedLines(position, ["", ""])\n    }, this.insert = function(position, text) {\n      return 1 >= this.getLength() && this.$detectNewLine(text), this.insertMergedLines(position, this.$split(text))\n    }, this.insertInLine = function(position, text) {\n      var start = this.clippedPos(position.row, position.column),\n        end = this.pos(position.row, position.column + text.length);\n      return this.applyDelta({\n        start: start,\n        end: end,\n        action: "insert",\n        lines: [text]\n      }, !0), this.clonePos(end)\n    }, this.clippedPos = function(row, column) {\n      var length = this.getLength();\n      void 0 === row ? row = length : 0 > row ? row = 0 : row >= length && (row = length - 1, column = void 0);\n      var line = this.getLine(row);\n      return void 0 == column && (column = line.length), column = Math.min(Math.max(column, 0), line.length), {\n        row: row,\n        column: column\n      }\n    }, this.clonePos = function(pos) {\n      return {\n        row: pos.row,\n        column: pos.column\n      }\n    }, this.pos = function(row, column) {\n      return {\n        row: row,\n        column: column\n      }\n    }, this.$clipPosition = function(position) {\n      var length = this.getLength();\n      return position.row >= length ? (position.row = Math.max(0, length - 1), position.column = this.getLine(length - 1).length) : (position.row = Math.max(0, position.row), position.column = Math.min(Math.max(position.column, 0), this.getLine(position.row).length)), position\n    }, this.insertFullLines = function(row, lines) {\n      row = Math.min(Math.max(row, 0), this.getLength());\n      var column = 0;\n      this.getLength() > row ? (lines = lines.concat([""]), column = 0) : (lines = [""].concat(lines), row--, column = this.$lines[row].length), this.insertMergedLines({\n        row: row,\n        column: column\n      }, lines)\n    }, this.insertMergedLines = function(position, lines) {\n      var start = this.clippedPos(position.row, position.column),\n        end = {\n          row: start.row + lines.length - 1,\n          column: (1 == lines.length ? start.column : 0) + lines[lines.length - 1].length\n        };\n      return this.applyDelta({\n        start: start,\n        end: end,\n        action: "insert",\n        lines: lines\n      }), this.clonePos(end)\n    }, this.remove = function(range) {\n      var start = this.clippedPos(range.start.row, range.start.column),\n        end = this.clippedPos(range.end.row, range.end.column);\n      return this.applyDelta({\n        start: start,\n        end: end,\n        action: "remove",\n        lines: this.getLinesForRange({\n          start: start,\n          end: end\n        })\n      }), this.clonePos(start)\n    }, this.removeInLine = function(row, startColumn, endColumn) {\n      var start = this.clippedPos(row, startColumn),\n        end = this.clippedPos(row, endColumn);\n      return this.applyDelta({\n        start: start,\n        end: end,\n        action: "remove",\n        lines: this.getLinesForRange({\n          start: start,\n          end: end\n        })\n      }, !0), this.clonePos(start)\n    }, this.removeFullLines = function(firstRow, lastRow) {\n      firstRow = Math.min(Math.max(0, firstRow), this.getLength() - 1), lastRow = Math.min(Math.max(0, lastRow), this.getLength() - 1);\n      var deleteFirstNewLine = lastRow == this.getLength() - 1 && firstRow > 0,\n        deleteLastNewLine = this.getLength() - 1 > lastRow,\n        startRow = deleteFirstNewLine ? firstRow - 1 : firstRow,\n        startCol = deleteFirstNewLine ? this.getLine(startRow).length : 0,\n        endRow = deleteLastNewLine ? lastRow + 1 : lastRow,\n        endCol = deleteLastNewLine ? 0 : this.getLine(endRow).length,\n        range = new Range(startRow, startCol, endRow, endCol),\n        deletedLines = this.$lines.slice(firstRow, lastRow + 1);\n      return this.applyDelta({\n        start: range.start,\n        end: range.end,\n        action: "remove",\n        lines: this.getLinesForRange(range)\n      }), deletedLines\n    }, this.removeNewLine = function(row) {\n      this.getLength() - 1 > row && row >= 0 && this.applyDelta({\n        start: this.pos(row, this.getLine(row).length),\n        end: this.pos(row + 1, 0),\n        action: "remove",\n        lines: ["", ""]\n      })\n    }, this.replace = function(range, text) {\n      if (range instanceof Range || (range = Range.fromPoints(range.start, range.end)), 0 === text.length && range.isEmpty()) return range.start;\n      if (text == this.getTextRange(range)) return range.end;\n      this.remove(range);\n      var end;\n      return end = text ? this.insert(range.start, text) : range.start\n    }, this.applyDeltas = function(deltas) {\n      for (var i = 0; deltas.length > i; i++) this.applyDelta(deltas[i])\n    }, this.revertDeltas = function(deltas) {\n      for (var i = deltas.length - 1; i >= 0; i--) this.revertDelta(deltas[i])\n    }, this.applyDelta = function(delta, doNotValidate) {\n      var isInsert = "insert" == delta.action;\n      (isInsert ? 1 >= delta.lines.length && !delta.lines[0] : !Range.comparePoints(delta.start, delta.end)) || (isInsert && delta.lines.length > 2e4 && this.$splitAndapplyLargeDelta(delta, 2e4), applyDelta(this.$lines, delta, doNotValidate), this._signal("change", delta))\n    }, this.$splitAndapplyLargeDelta = function(delta, MAX) {\n      for (var lines = delta.lines, l = lines.length, row = delta.start.row, column = delta.start.column, from = 0, to = 0;;) {\n        from = to, to += MAX - 1;\n        var chunk = lines.slice(from, to);\n        if (to > l) {\n          delta.lines = chunk, delta.start.row = row + from, delta.start.column = column;\n          break\n        }\n        chunk.push(""), this.applyDelta({\n          start: this.pos(row + from, column),\n          end: this.pos(row + to, column = 0),\n          action: delta.action,\n          lines: chunk\n        }, !0)\n      }\n    }, this.revertDelta = function(delta) {\n      this.applyDelta({\n        start: this.clonePos(delta.start),\n        end: this.clonePos(delta.end),\n        action: "insert" == delta.action ? "remove" : "insert",\n        lines: delta.lines.slice()\n      })\n    }, this.indexToPosition = function(index, startRow) {\n      for (var lines = this.$lines || this.getAllLines(), newlineLength = this.getNewLineCharacter().length, i = startRow || 0, l = lines.length; l > i; i++)\n        if (index -= lines[i].length + newlineLength, 0 > index) return {\n          row: i,\n          column: index + lines[i].length + newlineLength\n        };\n      return {\n        row: l - 1,\n        column: lines[l - 1].length\n      }\n    }, this.positionToIndex = function(pos, startRow) {\n      for (var lines = this.$lines || this.getAllLines(), newlineLength = this.getNewLineCharacter().length, index = 0, row = Math.min(pos.row, lines.length), i = startRow || 0; row > i; ++i) index += lines[i].length + newlineLength;\n      return index + pos.column\n    }\n  }).call(Document.prototype), exports.Document = Document\n}), ace.define("ace/lib/lang", ["require", "exports", "module"], function(acequire, exports) {\n  "use strict";\n  exports.last = function(a) {\n    return a[a.length - 1]\n  }, exports.stringReverse = function(string) {\n    return string.split("").reverse().join("")\n  }, exports.stringRepeat = function(string, count) {\n    for (var result = ""; count > 0;) 1 & count && (result += string), (count >>= 1) && (string += string);\n    return result\n  };\n  var trimBeginRegexp = /^\\s\\s*/,\n    trimEndRegexp = /\\s\\s*$/;\n  exports.stringTrimLeft = function(string) {\n    return string.replace(trimBeginRegexp, "")\n  }, exports.stringTrimRight = function(string) {\n    return string.replace(trimEndRegexp, "")\n  }, exports.copyObject = function(obj) {\n    var copy = {};\n    for (var key in obj) copy[key] = obj[key];\n    return copy\n  }, exports.copyArray = function(array) {\n    for (var copy = [], i = 0, l = array.length; l > i; i++) copy[i] = array[i] && "object" == typeof array[i] ? this.copyObject(array[i]) : array[i];\n    return copy\n  }, exports.deepCopy = function deepCopy(obj) {\n    if ("object" != typeof obj || !obj) return obj;\n    var copy;\n    if (Array.isArray(obj)) {\n      copy = [];\n      for (var key = 0; obj.length > key; key++) copy[key] = deepCopy(obj[key]);\n      return copy\n    }\n    if ("[object Object]" !== Object.prototype.toString.call(obj)) return obj;\n    copy = {};\n    for (var key in obj) copy[key] = deepCopy(obj[key]);\n    return copy\n  }, exports.arrayToMap = function(arr) {\n    for (var map = {}, i = 0; arr.length > i; i++) map[arr[i]] = 1;\n    return map\n  }, exports.createMap = function(props) {\n    var map = Object.create(null);\n    for (var i in props) map[i] = props[i];\n    return map\n  }, exports.arrayRemove = function(array, value) {\n    for (var i = 0; array.length >= i; i++) value === array[i] && array.splice(i, 1)\n  }, exports.escapeRegExp = function(str) {\n    return str.replace(/([.*+?^${}()|[\\]\\/\\\\])/g, "\\\\$1")\n  }, exports.escapeHTML = function(str) {\n    return str.replace(/&/g, "&#38;").replace(/"/g, "&#34;").replace(/\'/g, "&#39;").replace(/</g, "&#60;")\n  }, exports.getMatchOffsets = function(string, regExp) {\n    var matches = [];\n    return string.replace(regExp, function(str) {\n      matches.push({\n        offset: arguments[arguments.length - 2],\n        length: str.length\n      })\n    }), matches\n  }, exports.deferredCall = function(fcn) {\n    var timer = null,\n      callback = function() {\n        timer = null, fcn()\n      },\n      deferred = function(timeout) {\n        return deferred.cancel(), timer = setTimeout(callback, timeout || 0), deferred\n      };\n    return deferred.schedule = deferred, deferred.call = function() {\n      return this.cancel(), fcn(), deferred\n    }, deferred.cancel = function() {\n      return clearTimeout(timer), timer = null, deferred\n    }, deferred.isPending = function() {\n      return timer\n    }, deferred\n  }, exports.delayedCall = function(fcn, defaultTimeout) {\n    var timer = null,\n      callback = function() {\n        timer = null, fcn()\n      },\n      _self = function(timeout) {\n        null == timer && (timer = setTimeout(callback, timeout || defaultTimeout))\n      };\n    return _self.delay = function(timeout) {\n      timer && clearTimeout(timer), timer = setTimeout(callback, timeout || defaultTimeout)\n    }, _self.schedule = _self, _self.call = function() {\n      this.cancel(), fcn()\n    }, _self.cancel = function() {\n      timer && clearTimeout(timer), timer = null\n    }, _self.isPending = function() {\n      return timer\n    }, _self\n  }\n}), ace.define("ace/worker/mirror", ["require", "exports", "module", "ace/range", "ace/document", "ace/lib/lang"], function(acequire, exports) {\n  "use strict";\n  acequire("../range").Range;\n  var Document = acequire("../document").Document,\n    lang = acequire("../lib/lang"),\n    Mirror = exports.Mirror = function(sender) {\n      this.sender = sender;\n      var doc = this.doc = new Document(""),\n        deferredUpdate = this.deferredUpdate = lang.delayedCall(this.onUpdate.bind(this)),\n        _self = this;\n      sender.on("change", function(e) {\n        var data = e.data;\n        if (data[0].start) doc.applyDeltas(data);\n        else\n          for (var i = 0; data.length > i; i += 2) {\n            if (Array.isArray(data[i + 1])) var d = {\n              action: "insert",\n              start: data[i],\n              lines: data[i + 1]\n            };\n            else var d = {\n              action: "remove",\n              start: data[i],\n              end: data[i + 1]\n            };\n            doc.applyDelta(d, !0)\n          }\n        return _self.$timeout ? deferredUpdate.schedule(_self.$timeout) : (_self.onUpdate(), void 0)\n      })\n    };\n  (function() {\n    this.$timeout = 500, this.setTimeout = function(timeout) {\n      this.$timeout = timeout\n    }, this.setValue = function(value) {\n      this.doc.setValue(value), this.deferredUpdate.schedule(this.$timeout)\n    }, this.getValue = function(callbackId) {\n      this.sender.callback(this.doc.getValue(), callbackId)\n    }, this.onUpdate = function() {}, this.isPending = function() {\n      return this.deferredUpdate.isPending()\n    }\n  }).call(Mirror.prototype)\n}), ace.define("ace/mode/json/json_parse", ["require", "exports", "module"], function() {\n  "use strict";\n  var at, ch, text, value, escapee = {\n      \'"\': \'"\',\n      "\\\\": "\\\\",\n      "/": "/",\n      b: "\\b",\n      f: "\\f",\n      n: "\\n",\n      r: "\\r",\n      t: "\t"\n    },\n    error = function(m) {\n      throw {\n        name: "SyntaxError",\n        message: m,\n        at: at,\n        text: text\n      }\n    },\n    reset = function (newAt) {\n      ch = text.charAt(newAt);\n      at = newAt + 1;\n    },\n    next = function(c) {\n      return c && c !== ch && error("Expected \'" + c + "\' instead of \'" + ch + "\'"), ch = text.charAt(at), at += 1, ch\n    },\n    nextUpTo = function (upTo, errorMessage) {\n      let currentAt = at,\n        i = text.indexOf(upTo, currentAt);\n      if (i < 0) {\n        error(errorMessage || \'Expected \\\'\' + upTo + \'\\\'\');\n      }\n      reset(i + upTo.length);\n      return text.substring(currentAt, i);\n    },\n    peek = function (c) {\n      return text.substr(at, c.length) === c; // nocommit - double check\n    },\n    number = function() {\n      var number, string = "";\n      for ("-" === ch && (string = "-", next("-")); ch >= "0" && "9" >= ch;) string += ch, next();\n      if ("." === ch)\n        for (string += "."; next() && ch >= "0" && "9" >= ch;) string += ch;\n      if ("e" === ch || "E" === ch)\n        for (string += ch, next(), ("-" === ch || "+" === ch) && (string += ch, next()); ch >= "0" && "9" >= ch;) string += ch, next();\n      return number = +string, isNaN(number) ? (error("Bad number"), void 0) : number\n    },\n    string = function() {\n      var hex, i, uffff, string = "";\n      if (\'"\' === ch) {\n        if (peek(\'""\')) {\n          // literal\n          next(\'"\');\n          next(\'"\');\n          return nextUpTo(\'"""\', \'failed to find closing \\\'"""\\\'\');\n        } else {\n          for (; next();) {\n            if (\'"\' === ch) return next(), string;\n            if ("\\\\" === ch)\n              if (next(), "u" === ch) {\n                for (uffff = 0, i = 0; 4 > i && (hex = parseInt(next(), 16), isFinite(hex)); i += 1) uffff = 16 * uffff + hex;\n                string += String.fromCharCode(uffff)\n              } else {\n                if ("string" != typeof escapee[ch]) break;\n                string += escapee[ch]\n              }\n            else string += ch\n          }\n        }\n      }\n      error("Bad string")\n    },\n    white = function() {\n      for (; ch && " " >= ch;) next()\n    },\n    word = function() {\n      switch (ch) {\n        case "t":\n          return next("t"), next("r"), next("u"), next("e"), !0;\n        case "f":\n          return next("f"), next("a"), next("l"), next("s"), next("e"), !1;\n        case "n":\n          return next("n"), next("u"), next("l"), next("l"), null\n      }\n      error("Unexpected \'" + ch + "\'")\n    },\n    array = function() {\n      var array = [];\n      if ("[" === ch) {\n        if (next("["), white(), "]" === ch) return next("]"), array;\n        for (; ch;) {\n          if (array.push(value()), white(), "]" === ch) return next("]"), array;\n          next(","), white()\n        }\n      }\n      error("Bad array")\n    },\n    object = function() {\n      var key, object = {};\n      if ("{" === ch) {\n        if (next("{"), white(), "}" === ch) return next("}"), object;\n        for (; ch;) {\n          if (key = string(), white(), next(":"), Object.hasOwnProperty.call(object, key) && error(\'Duplicate key "\' + key + \'"\'), object[key] = value(), white(), "}" === ch) return next("}"), object;\n          next(","), white()\n        }\n      }\n      error("Bad object")\n    };\n  return value = function() {\n      switch (white(), ch) {\n        case "{":\n          return object();\n        case "[":\n          return array();\n        case \'"\':\n          return string();\n        case "-":\n          return number();\n        default:\n          return ch >= "0" && "9" >= ch ? number() : word()\n      }\n    },\n    function(source, reviver) {\n      var result;\n      return text = source, at = 0, ch = " ", result = value(), white(), ch && error("Syntax error"), "function" == typeof reviver ? function walk(holder, key) {\n        var k, v, value = holder[key];\n        if (value && "object" == typeof value)\n          for (k in value) Object.hasOwnProperty.call(value, k) && (v = walk(value, k), void 0 !== v ? value[k] = v : delete value[k]);\n        return reviver.call(holder, key, value)\n      }({\n        "": result\n      }, "") : result\n    }\n}), ace.define("ace/mode/json_worker", ["require", "exports", "module", "ace/lib/oop", "ace/worker/mirror", "ace/mode/json/json_parse"], function(acequire, exports) {\n  "use strict";\n  var oop = acequire("../lib/oop"),\n    Mirror = acequire("../worker/mirror").Mirror,\n    parse = acequire("./json/json_parse"),\n    JsonWorker = exports.JsonWorker = function(sender) {\n      Mirror.call(this, sender), this.setTimeout(200)\n    };\n  oop.inherits(JsonWorker, Mirror),\n    function() {\n      this.onUpdate = function() {\n        var value = this.doc.getValue(),\n          errors = [];\n        try {\n          value && parse(value)\n        } catch (e) {\n          var pos = this.doc.indexToPosition(e.at - 1);\n          errors.push({\n            row: pos.row,\n            column: pos.column,\n            text: e.message,\n            type: "error"\n          })\n        }\n        this.sender.emit("annotate", errors)\n      }\n    }.call(JsonWorker.prototype)\n}), ace.define("ace/lib/es5-shim", ["require", "exports", "module"], function() {\n  function Empty() {}\n\n  function doesDefinePropertyWork(object) {\n    try {\n      return Object.defineProperty(object, "sentinel", {}), "sentinel" in object\n    } catch (exception) {}\n  }\n\n  function toInteger(n) {\n    return n = +n, n !== n ? n = 0 : 0 !== n && n !== 1 / 0 && n !== -(1 / 0) && (n = (n > 0 || -1) * Math.floor(Math.abs(n))), n\n  }\n  Function.prototype.bind || (Function.prototype.bind = function(that) {\n    var target = this;\n    if ("function" != typeof target) throw new TypeError("Function.prototype.bind called on incompatible " + target);\n    var args = slice.call(arguments, 1),\n      bound = function() {\n        if (this instanceof bound) {\n          var result = target.apply(this, args.concat(slice.call(arguments)));\n          return Object(result) === result ? result : this\n        }\n        return target.apply(that, args.concat(slice.call(arguments)))\n      };\n    return target.prototype && (Empty.prototype = target.prototype, bound.prototype = new Empty, Empty.prototype = null), bound\n  });\n  var defineGetter, defineSetter, lookupGetter, lookupSetter, supportsAccessors, call = Function.prototype.call,\n    prototypeOfArray = Array.prototype,\n    prototypeOfObject = Object.prototype,\n    slice = prototypeOfArray.slice,\n    _toString = call.bind(prototypeOfObject.toString),\n    owns = call.bind(prototypeOfObject.hasOwnProperty);\n  if ((supportsAccessors = owns(prototypeOfObject, "__defineGetter__")) && (defineGetter = call.bind(prototypeOfObject.__defineGetter__), defineSetter = call.bind(prototypeOfObject.__defineSetter__), lookupGetter = call.bind(prototypeOfObject.__lookupGetter__), lookupSetter = call.bind(prototypeOfObject.__lookupSetter__)), 2 != [1, 2].splice(0).length)\n    if (function() {\n        function makeArray(l) {\n          var a = Array(l + 2);\n          return a[0] = a[1] = 0, a\n        }\n        var lengthBefore, array = [];\n        return array.splice.apply(array, makeArray(20)), array.splice.apply(array, makeArray(26)), lengthBefore = array.length, array.splice(5, 0, "XXX"), lengthBefore + 1 == array.length, lengthBefore + 1 == array.length ? !0 : void 0\n      }()) {\n      var array_splice = Array.prototype.splice;\n      Array.prototype.splice = function(start, deleteCount) {\n        return arguments.length ? array_splice.apply(this, [void 0 === start ? 0 : start, void 0 === deleteCount ? this.length - start : deleteCount].concat(slice.call(arguments, 2))) : []\n      }\n    } else Array.prototype.splice = function(pos, removeCount) {\n      var length = this.length;\n      pos > 0 ? pos > length && (pos = length) : void 0 == pos ? pos = 0 : 0 > pos && (pos = Math.max(length + pos, 0)), length > pos + removeCount || (removeCount = length - pos);\n      var removed = this.slice(pos, pos + removeCount),\n        insert = slice.call(arguments, 2),\n        add = insert.length;\n      if (pos === length) add && this.push.apply(this, insert);\n      else {\n        var remove = Math.min(removeCount, length - pos),\n          tailOldPos = pos + remove,\n          tailNewPos = tailOldPos + add - remove,\n          tailCount = length - tailOldPos,\n          lengthAfterRemove = length - remove;\n        if (tailOldPos > tailNewPos)\n          for (var i = 0; tailCount > i; ++i) this[tailNewPos + i] = this[tailOldPos + i];\n        else if (tailNewPos > tailOldPos)\n          for (i = tailCount; i--;) this[tailNewPos + i] = this[tailOldPos + i];\n        if (add && pos === lengthAfterRemove) this.length = lengthAfterRemove, this.push.apply(this, insert);\n        else\n          for (this.length = lengthAfterRemove + add, i = 0; add > i; ++i) this[pos + i] = insert[i]\n      }\n      return removed\n    };\n  Array.isArray || (Array.isArray = function(obj) {\n    return "[object Array]" == _toString(obj)\n  });\n  var boxedString = Object("a"),\n    splitString = "a" != boxedString[0] || !(0 in boxedString);\n  if (Array.prototype.forEach || (Array.prototype.forEach = function(fun) {\n      var object = toObject(this),\n        self = splitString && "[object String]" == _toString(this) ? this.split("") : object,\n        thisp = arguments[1],\n        i = -1,\n        length = self.length >>> 0;\n      if ("[object Function]" != _toString(fun)) throw new TypeError;\n      for (; length > ++i;) i in self && fun.call(thisp, self[i], i, object)\n    }), Array.prototype.map || (Array.prototype.map = function(fun) {\n      var object = toObject(this),\n        self = splitString && "[object String]" == _toString(this) ? this.split("") : object,\n        length = self.length >>> 0,\n        result = Array(length),\n        thisp = arguments[1];\n      if ("[object Function]" != _toString(fun)) throw new TypeError(fun + " is not a function");\n      for (var i = 0; length > i; i++) i in self && (result[i] = fun.call(thisp, self[i], i, object));\n      return result\n    }), Array.prototype.filter || (Array.prototype.filter = function(fun) {\n      var value, object = toObject(this),\n        self = splitString && "[object String]" == _toString(this) ? this.split("") : object,\n        length = self.length >>> 0,\n        result = [],\n        thisp = arguments[1];\n      if ("[object Function]" != _toString(fun)) throw new TypeError(fun + " is not a function");\n      for (var i = 0; length > i; i++) i in self && (value = self[i], fun.call(thisp, value, i, object) && result.push(value));\n      return result\n    }), Array.prototype.every || (Array.prototype.every = function(fun) {\n      var object = toObject(this),\n        self = splitString && "[object String]" == _toString(this) ? this.split("") : object,\n        length = self.length >>> 0,\n        thisp = arguments[1];\n      if ("[object Function]" != _toString(fun)) throw new TypeError(fun + " is not a function");\n      for (var i = 0; length > i; i++)\n        if (i in self && !fun.call(thisp, self[i], i, object)) return !1;\n      return !0\n    }), Array.prototype.some || (Array.prototype.some = function(fun) {\n      var object = toObject(this),\n        self = splitString && "[object String]" == _toString(this) ? this.split("") : object,\n        length = self.length >>> 0,\n        thisp = arguments[1];\n      if ("[object Function]" != _toString(fun)) throw new TypeError(fun + " is not a function");\n      for (var i = 0; length > i; i++)\n        if (i in self && fun.call(thisp, self[i], i, object)) return !0;\n      return !1\n    }), Array.prototype.reduce || (Array.prototype.reduce = function(fun) {\n      var object = toObject(this),\n        self = splitString && "[object String]" == _toString(this) ? this.split("") : object,\n        length = self.length >>> 0;\n      if ("[object Function]" != _toString(fun)) throw new TypeError(fun + " is not a function");\n      if (!length && 1 == arguments.length) throw new TypeError("reduce of empty array with no initial value");\n      var result, i = 0;\n      if (arguments.length >= 2) result = arguments[1];\n      else\n        for (;;) {\n          if (i in self) {\n            result = self[i++];\n            break\n          }\n          if (++i >= length) throw new TypeError("reduce of empty array with no initial value")\n        }\n      for (; length > i; i++) i in self && (result = fun.call(void 0, result, self[i], i, object));\n      return result\n    }), Array.prototype.reduceRight || (Array.prototype.reduceRight = function(fun) {\n      var object = toObject(this),\n        self = splitString && "[object String]" == _toString(this) ? this.split("") : object,\n        length = self.length >>> 0;\n      if ("[object Function]" != _toString(fun)) throw new TypeError(fun + " is not a function");\n      if (!length && 1 == arguments.length) throw new TypeError("reduceRight of empty array with no initial value");\n      var result, i = length - 1;\n      if (arguments.length >= 2) result = arguments[1];\n      else\n        for (;;) {\n          if (i in self) {\n            result = self[i--];\n            break\n          }\n          if (0 > --i) throw new TypeError("reduceRight of empty array with no initial value")\n        }\n      do i in this && (result = fun.call(void 0, result, self[i], i, object)); while (i--);\n      return result\n    }), Array.prototype.indexOf && -1 == [0, 1].indexOf(1, 2) || (Array.prototype.indexOf = function(sought) {\n      var self = splitString && "[object String]" == _toString(this) ? this.split("") : toObject(this),\n        length = self.length >>> 0;\n      if (!length) return -1;\n      var i = 0;\n      for (arguments.length > 1 && (i = toInteger(arguments[1])), i = i >= 0 ? i : Math.max(0, length + i); length > i; i++)\n        if (i in self && self[i] === sought) return i;\n      return -1\n    }), Array.prototype.lastIndexOf && -1 == [0, 1].lastIndexOf(0, -3) || (Array.prototype.lastIndexOf = function(sought) {\n      var self = splitString && "[object String]" == _toString(this) ? this.split("") : toObject(this),\n        length = self.length >>> 0;\n      if (!length) return -1;\n      var i = length - 1;\n      for (arguments.length > 1 && (i = Math.min(i, toInteger(arguments[1]))), i = i >= 0 ? i : length - Math.abs(i); i >= 0; i--)\n        if (i in self && sought === self[i]) return i;\n      return -1\n    }), Object.getPrototypeOf || (Object.getPrototypeOf = function(object) {\n      return object.__proto__ || (object.constructor ? object.constructor.prototype : prototypeOfObject)\n    }), !Object.getOwnPropertyDescriptor) {\n    var ERR_NON_OBJECT = "Object.getOwnPropertyDescriptor called on a non-object: ";\n    Object.getOwnPropertyDescriptor = function(object, property) {\n      if ("object" != typeof object && "function" != typeof object || null === object) throw new TypeError(ERR_NON_OBJECT + object);\n      if (owns(object, property)) {\n        var descriptor, getter, setter;\n        if (descriptor = {\n            enumerable: !0,\n            configurable: !0\n          }, supportsAccessors) {\n          var prototype = object.__proto__;\n          object.__proto__ = prototypeOfObject;\n          var getter = lookupGetter(object, property),\n            setter = lookupSetter(object, property);\n          if (object.__proto__ = prototype, getter || setter) return getter && (descriptor.get = getter), setter && (descriptor.set = setter), descriptor\n        }\n        return descriptor.value = object[property], descriptor\n      }\n    }\n  }\n  if (Object.getOwnPropertyNames || (Object.getOwnPropertyNames = function(object) {\n      return Object.keys(object)\n    }), !Object.create) {\n    var createEmpty;\n    createEmpty = null === Object.prototype.__proto__ ? function() {\n      return {\n        __proto__: null\n      }\n    } : function() {\n      var empty = {};\n      for (var i in empty) empty[i] = null;\n      return empty.constructor = empty.hasOwnProperty = empty.propertyIsEnumerable = empty.isPrototypeOf = empty.toLocaleString = empty.toString = empty.valueOf = empty.__proto__ = null, empty\n    }, Object.create = function(prototype, properties) {\n      var object;\n      if (null === prototype) object = createEmpty();\n      else {\n        if ("object" != typeof prototype) throw new TypeError("typeof prototype[" + typeof prototype + "] != \'object\'");\n        var Type = function() {};\n        Type.prototype = prototype, object = new Type, object.__proto__ = prototype\n      }\n      return void 0 !== properties && Object.defineProperties(object, properties), object\n    }\n  }\n  if (Object.defineProperty) {\n    var definePropertyWorksOnObject = doesDefinePropertyWork({}),\n      definePropertyWorksOnDom = "undefined" == typeof document || doesDefinePropertyWork(document.createElement("div"));\n    if (!definePropertyWorksOnObject || !definePropertyWorksOnDom) var definePropertyFallback = Object.defineProperty\n  }\n  if (!Object.defineProperty || definePropertyFallback) {\n    var ERR_NON_OBJECT_DESCRIPTOR = "Property description must be an object: ",\n      ERR_NON_OBJECT_TARGET = "Object.defineProperty called on non-object: ",\n      ERR_ACCESSORS_NOT_SUPPORTED = "getters & setters can not be defined on this javascript engine";\n    Object.defineProperty = function(object, property, descriptor) {\n      if ("object" != typeof object && "function" != typeof object || null === object) throw new TypeError(ERR_NON_OBJECT_TARGET + object);\n      if ("object" != typeof descriptor && "function" != typeof descriptor || null === descriptor) throw new TypeError(ERR_NON_OBJECT_DESCRIPTOR + descriptor);\n      if (definePropertyFallback) try {\n        return definePropertyFallback.call(Object, object, property, descriptor)\n      } catch (exception) {}\n      if (owns(descriptor, "value"))\n        if (supportsAccessors && (lookupGetter(object, property) || lookupSetter(object, property))) {\n          var prototype = object.__proto__;\n          object.__proto__ = prototypeOfObject, delete object[property], object[property] = descriptor.value, object.__proto__ = prototype\n        } else object[property] = descriptor.value;\n      else {\n        if (!supportsAccessors) throw new TypeError(ERR_ACCESSORS_NOT_SUPPORTED);\n        owns(descriptor, "get") && defineGetter(object, property, descriptor.get), owns(descriptor, "set") && defineSetter(object, property, descriptor.set)\n      }\n      return object\n    }\n  }\n  Object.defineProperties || (Object.defineProperties = function(object, properties) {\n    for (var property in properties) owns(properties, property) && Object.defineProperty(object, property, properties[property]);\n    return object\n  }), Object.seal || (Object.seal = function(object) {\n    return object\n  }), Object.freeze || (Object.freeze = function(object) {\n    return object\n  });\n  try {\n    Object.freeze(function() {})\n  } catch (exception) {\n    Object.freeze = function(freezeObject) {\n      return function(object) {\n        return "function" == typeof object ? object : freezeObject(object)\n      }\n    }(Object.freeze)\n  }\n  if (Object.preventExtensions || (Object.preventExtensions = function(object) {\n      return object\n    }), Object.isSealed || (Object.isSealed = function() {\n      return !1\n    }), Object.isFrozen || (Object.isFrozen = function() {\n      return !1\n    }), Object.isExtensible || (Object.isExtensible = function(object) {\n      if (Object(object) === object) throw new TypeError;\n      for (var name = ""; owns(object, name);) name += "?";\n      object[name] = !0;\n      var returnValue = owns(object, name);\n      return delete object[name], returnValue\n    }), !Object.keys) {\n    var hasDontEnumBug = !0,\n      dontEnums = ["toString", "toLocaleString", "valueOf", "hasOwnProperty", "isPrototypeOf", "propertyIsEnumerable", "constructor"],\n      dontEnumsLength = dontEnums.length;\n    for (var key in {\n        toString: null\n      }) hasDontEnumBug = !1;\n    Object.keys = function(object) {\n      if ("object" != typeof object && "function" != typeof object || null === object) throw new TypeError("Object.keys called on a non-object");\n      var keys = [];\n      for (var name in object) owns(object, name) && keys.push(name);\n      if (hasDontEnumBug)\n        for (var i = 0, ii = dontEnumsLength; ii > i; i++) {\n          var dontEnum = dontEnums[i];\n          owns(object, dontEnum) && keys.push(dontEnum)\n        }\n      return keys\n    }\n  }\n  Date.now || (Date.now = function() {\n    return (new Date).getTime()\n  });\n  var ws = "\t\\n\v\\f\\r   ᠎             　\\u2028\\u2029\ufeff";\n  if (!String.prototype.trim || ws.trim()) {\n    ws = "[" + ws + "]";\n    var trimBeginRegexp = RegExp("^" + ws + ws + "*"),\n      trimEndRegexp = RegExp(ws + ws + "*$");\n    String.prototype.trim = function() {\n      return (this + "").replace(trimBeginRegexp, "").replace(trimEndRegexp, "")\n    }\n  }\n  var toObject = function(o) {\n    if (null == o) throw new TypeError("can\'t convert " + o + " to object");\n    return Object(o)\n  }\n});\n'},function(module,exports,__webpack_require__){"use strict";var punycode=__webpack_require__(441);var util=__webpack_require__(442);exports.parse=urlParse;exports.resolve=urlResolve;exports.resolveObject=urlResolveObject;exports.format=urlFormat;exports.Url=Url;function Url(){this.protocol=null;this.slashes=null;this.auth=null;this.host=null;this.port=null;this.hostname=null;this.hash=null;this.search=null;this.query=null;this.pathname=null;this.path=null;this.href=null}var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,delims=["<",">",'"',"`"," ","\r","\n","\t"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:true,"javascript:":true},hostlessProtocol={javascript:true,"javascript:":true},slashedProtocol={http:true,https:true,ftp:true,gopher:true,file:true,"http:":true,"https:":true,"ftp:":true,"gopher:":true,"file:":true},querystring=__webpack_require__(443);function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&util.isObject(url)&&url instanceof Url)return url;var u=new Url;u.parse(url,parseQueryString,slashesDenoteHost);return u}Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if(!util.isString(url)){throw new TypeError("Parameter 'url' must be a string, not "+typeof url)}var queryIndex=url.indexOf("?"),splitter=queryIndex!==-1&&queryIndex<url.indexOf("#")?"?":"#",uSplit=url.split(splitter),slashRegex=/\\/g;uSplit[0]=uSplit[0].replace(slashRegex,"/");url=uSplit.join(splitter);var rest=url;rest=rest.trim();if(!slashesDenoteHost&&url.split("#").length===1){var simplePath=simplePathPattern.exec(rest);if(simplePath){this.path=rest;this.href=rest;this.pathname=simplePath[1];if(simplePath[2]){this.search=simplePath[2];if(parseQueryString){this.query=querystring.parse(this.search.substr(1))}else{this.query=this.search.substr(1)}}else if(parseQueryString){this.search="";this.query={}}return this}}var proto=protocolPattern.exec(rest);if(proto){proto=proto[0];var lowerProto=proto.toLowerCase();this.protocol=lowerProto;rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes=rest.substr(0,2)==="//";if(slashes&&!(proto&&hostlessProtocol[proto])){rest=rest.substr(2);this.slashes=true}}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){var hostEnd=-1;for(var i=0;i<hostEndingChars.length;i++){var hec=rest.indexOf(hostEndingChars[i]);if(hec!==-1&&(hostEnd===-1||hec<hostEnd))hostEnd=hec}var auth,atSign;if(hostEnd===-1){atSign=rest.lastIndexOf("@")}else{atSign=rest.lastIndexOf("@",hostEnd)}if(atSign!==-1){auth=rest.slice(0,atSign);rest=rest.slice(atSign+1);this.auth=decodeURIComponent(auth)}hostEnd=-1;for(var i=0;i<nonHostChars.length;i++){var hec=rest.indexOf(nonHostChars[i]);if(hec!==-1&&(hostEnd===-1||hec<hostEnd))hostEnd=hec}if(hostEnd===-1)hostEnd=rest.length;this.host=rest.slice(0,hostEnd);rest=rest.slice(hostEnd);this.parseHost();this.hostname=this.hostname||"";var ipv6Hostname=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!ipv6Hostname){var hostparts=this.hostname.split(/\./);for(var i=0,l=hostparts.length;i<l;i++){var part=hostparts[i];if(!part)continue;if(!part.match(hostnamePartPattern)){var newpart="";for(var j=0,k=part.length;j<k;j++){if(part.charCodeAt(j)>127){newpart+="x"}else{newpart+=part[j]}}if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i);var notHost=hostparts.slice(i+1);var bit=part.match(hostnamePartStart);if(bit){validParts.push(bit[1]);notHost.unshift(bit[2])}if(notHost.length){rest="/"+notHost.join(".")+rest}this.hostname=validParts.join(".");break}}}}if(this.hostname.length>hostnameMaxLen){this.hostname=""}else{this.hostname=this.hostname.toLowerCase()}if(!ipv6Hostname){this.hostname=punycode.toASCII(this.hostname)}var p=this.port?":"+this.port:"";var h=this.hostname||"";this.host=h+p;this.href+=this.host;if(ipv6Hostname){this.hostname=this.hostname.substr(1,this.hostname.length-2);if(rest[0]!=="/"){rest="/"+rest}}}if(!unsafeProtocol[lowerProto]){for(var i=0,l=autoEscape.length;i<l;i++){var ae=autoEscape[i];if(rest.indexOf(ae)===-1)continue;var esc=encodeURIComponent(ae);if(esc===ae){esc=escape(ae)}rest=rest.split(ae).join(esc)}}var hash=rest.indexOf("#");if(hash!==-1){this.hash=rest.substr(hash);rest=rest.slice(0,hash)}var qm=rest.indexOf("?");if(qm!==-1){this.search=rest.substr(qm);this.query=rest.substr(qm+1);if(parseQueryString){this.query=querystring.parse(this.query)}rest=rest.slice(0,qm)}else if(parseQueryString){this.search="";this.query={}}if(rest)this.pathname=rest;if(slashedProtocol[lowerProto]&&this.hostname&&!this.pathname){this.pathname="/"}if(this.pathname||this.search){var p=this.pathname||"";var s=this.search||"";this.path=p+s}this.href=this.format();return this};function urlFormat(obj){if(util.isString(obj))obj=urlParse(obj);if(!(obj instanceof Url))return Url.prototype.format.call(obj);return obj.format()}Url.prototype.format=function(){var auth=this.auth||"";if(auth){auth=encodeURIComponent(auth);auth=auth.replace(/%3A/i,":");auth+="@"}var protocol=this.protocol||"",pathname=this.pathname||"",hash=this.hash||"",host=false,query="";if(this.host){host=auth+this.host}else if(this.hostname){host=auth+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]");if(this.port){host+=":"+this.port}}if(this.query&&util.isObject(this.query)&&Object.keys(this.query).length){query=querystring.stringify(this.query)}var search=this.search||query&&"?"+query||"";if(protocol&&protocol.substr(-1)!==":")protocol+=":";if(this.slashes||(!protocol||slashedProtocol[protocol])&&host!==false){host="//"+(host||"");if(pathname&&pathname.charAt(0)!=="/")pathname="/"+pathname}else if(!host){host=""}if(hash&&hash.charAt(0)!=="#")hash="#"+hash;if(search&&search.charAt(0)!=="?")search="?"+search;pathname=pathname.replace(/[?#]/g,(function(match){return encodeURIComponent(match)}));search=search.replace("#","%23");return protocol+host+pathname+search+hash};function urlResolve(source,relative){return urlParse(source,false,true).resolve(relative)}Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,false,true)).format()};function urlResolveObject(source,relative){if(!source)return relative;return urlParse(source,false,true).resolveObject(relative)}Url.prototype.resolveObject=function(relative){if(util.isString(relative)){var rel=new Url;rel.parse(relative,false,true);relative=rel}var result=new Url;var tkeys=Object.keys(this);for(var tk=0;tk<tkeys.length;tk++){var tkey=tkeys[tk];result[tkey]=this[tkey]}result.hash=relative.hash;if(relative.href===""){result.href=result.format();return result}if(relative.slashes&&!relative.protocol){var rkeys=Object.keys(relative);for(var rk=0;rk<rkeys.length;rk++){var rkey=rkeys[rk];if(rkey!=="protocol")result[rkey]=relative[rkey]}if(slashedProtocol[result.protocol]&&result.hostname&&!result.pathname){result.path=result.pathname="/"}result.href=result.format();return result}if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol]){var keys=Object.keys(relative);for(var v=0;v<keys.length;v++){var k=keys[v];result[k]=relative[k]}result.href=result.format();return result}result.protocol=relative.protocol;if(!relative.host&&!hostlessProtocol[relative.protocol]){var relPath=(relative.pathname||"").split("/");while(relPath.length&&!(relative.host=relPath.shift()));if(!relative.host)relative.host="";if(!relative.hostname)relative.hostname="";if(relPath[0]!=="")relPath.unshift("");if(relPath.length<2)relPath.unshift("");result.pathname=relPath.join("/")}else{result.pathname=relative.pathname}result.search=relative.search;result.query=relative.query;result.host=relative.host||"";result.auth=relative.auth;result.hostname=relative.hostname||relative.host;result.port=relative.port;if(result.pathname||result.search){var p=result.pathname||"";var s=result.search||"";result.path=p+s}result.slashes=result.slashes||relative.slashes;result.href=result.format();return result}var isSourceAbs=result.pathname&&result.pathname.charAt(0)==="/",isRelAbs=relative.host||relative.pathname&&relative.pathname.charAt(0)==="/",mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split("/")||[],relPath=relative.pathname&&relative.pathname.split("/")||[],psychotic=result.protocol&&!slashedProtocol[result.protocol];if(psychotic){result.hostname="";result.port=null;if(result.host){if(srcPath[0]==="")srcPath[0]=result.host;else srcPath.unshift(result.host)}result.host="";if(relative.protocol){relative.hostname=null;relative.port=null;if(relative.host){if(relPath[0]==="")relPath[0]=relative.host;else relPath.unshift(relative.host)}relative.host=null}mustEndAbs=mustEndAbs&&(relPath[0]===""||srcPath[0]==="")}if(isRelAbs){result.host=relative.host||relative.host===""?relative.host:result.host;result.hostname=relative.hostname||relative.hostname===""?relative.hostname:result.hostname;result.search=relative.search;result.query=relative.query;srcPath=relPath}else if(relPath.length){if(!srcPath)srcPath=[];srcPath.pop();srcPath=srcPath.concat(relPath);result.search=relative.search;result.query=relative.query}else if(!util.isNullOrUndefined(relative.search)){if(psychotic){result.hostname=result.host=srcPath.shift();var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):false;if(authInHost){result.auth=authInHost.shift();result.host=result.hostname=authInHost.shift()}}result.search=relative.search;result.query=relative.query;if(!util.isNull(result.pathname)||!util.isNull(result.search)){result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")}result.href=result.format();return result}if(!srcPath.length){result.pathname=null;if(result.search){result.path="/"+result.search}else{result.path=null}result.href=result.format();return result}var last=srcPath.slice(-1)[0];var hasTrailingSlash=(result.host||relative.host||srcPath.length>1)&&(last==="."||last==="..")||last==="";var up=0;for(var i=srcPath.length;i>=0;i--){last=srcPath[i];if(last==="."){srcPath.splice(i,1)}else if(last===".."){srcPath.splice(i,1);up++}else if(up){srcPath.splice(i,1);up--}}if(!mustEndAbs&&!removeAllDots){for(;up--;up){srcPath.unshift("..")}}if(mustEndAbs&&srcPath[0]!==""&&(!srcPath[0]||srcPath[0].charAt(0)!=="/")){srcPath.unshift("")}if(hasTrailingSlash&&srcPath.join("/").substr(-1)!=="/"){srcPath.push("")}var isAbsolute=srcPath[0]===""||srcPath[0]&&srcPath[0].charAt(0)==="/";if(psychotic){result.hostname=result.host=isAbsolute?"":srcPath.length?srcPath.shift():"";var authInHost=result.host&&result.host.indexOf("@")>0?result.host.split("@"):false;if(authInHost){result.auth=authInHost.shift();result.host=result.hostname=authInHost.shift()}}mustEndAbs=mustEndAbs||result.host&&srcPath.length;if(mustEndAbs&&!isAbsolute){srcPath.unshift("")}if(!srcPath.length){result.pathname=null;result.path=null}else{result.pathname=srcPath.join("/")}if(!util.isNull(result.pathname)||!util.isNull(result.search)){result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")}result.auth=relative.auth||result.auth;result.slashes=result.slashes||relative.slashes;result.href=result.format();return result};Url.prototype.parseHost=function(){var host=this.host;var port=portPattern.exec(host);if(port){port=port[0];if(port!==":"){this.port=port.substr(1)}host=host.substr(0,host.length-port.length)}if(host)this.hostname=host}},function(module,exports,__webpack_require__){(function(module,global){var __WEBPACK_AMD_DEFINE_RESULT__;/*! https://mths.be/punycode v1.4.1 by @mathias */(function(root){var freeExports=true&&exports&&!exports.nodeType&&exports;var freeModule=true&&module&&!module.nodeType&&module;var freeGlobal=typeof global=="object"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal||freeGlobal.self===freeGlobal){root=freeGlobal}var punycode,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode,key;function error(type){throw new RangeError(errors[type])}function map(array,fn){var length=array.length;var result=[];while(length--){result[length]=fn(array[length])}return result}function mapDomain(string,fn){var parts=string.split("@");var result="";if(parts.length>1){result=parts[0]+"@";string=parts[1]}string=string.replace(regexSeparators,".");var labels=string.split(".");var encoded=map(labels,fn).join(".");return result+encoded}function ucs2decode(string){var output=[],counter=0,length=string.length,value,extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){return map(array,(function(value){var output="";if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value);return output})).join("")}function basicToDigit(codePoint){if(codePoint-48<10){return codePoint-22}if(codePoint-65<26){return codePoint-65}if(codePoint-97<26){return codePoint-97}return base}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((flag!=0)<<5)}function adapt(delta,numPoints,firstTime){var k=0;delta=firstTime?floor(delta/damp):delta>>1;delta+=floor(delta/numPoints);for(;delta>baseMinusTMin*tMax>>1;k+=base){delta=floor(delta/baseMinusTMin)}return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}function decode(input){var output=[],inputLength=input.length,out,i=0,n=initialN,bias=initialBias,basic,j,index,oldi,w,k,digit,t,baseMinusT;basic=input.lastIndexOf(delimiter);if(basic<0){basic=0}for(j=0;j<basic;++j){if(input.charCodeAt(j)>=128){error("not-basic")}output.push(input.charCodeAt(j))}for(index=basic>0?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=base;;k+=base){if(index>=inputLength){error("invalid-input")}digit=basicToDigit(input.charCodeAt(index++));if(digit>=base||digit>floor((maxInt-i)/w)){error("overflow")}i+=digit*w;t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(digit<t){break}baseMinusT=base-t;if(w>floor(maxInt/baseMinusT)){error("overflow")}w*=baseMinusT}out=output.length+1;bias=adapt(i-oldi,out,oldi==0);if(floor(i/out)>maxInt-n){error("overflow")}n+=floor(i/out);i%=out;output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,output=[],inputLength,handledCPCountPlusOne,baseMinusT,qMinusT;input=ucs2decode(input);inputLength=input.length;n=initialN;delta=0;bias=initialBias;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<128){output.push(stringFromCharCode(currentValue))}}handledCPCount=basicLength=output.length;if(basicLength){output.push(delimiter)}while(handledCPCount<inputLength){for(m=maxInt,j=0;j<inputLength;++j){currentValue=input[j];if(currentValue>=n&&currentValue<m){m=currentValue}}handledCPCountPlusOne=handledCPCount+1;if(m-n>floor((maxInt-delta)/handledCPCountPlusOne)){error("overflow")}delta+=(m-n)*handledCPCountPlusOne;n=m;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<n&&++delta>maxInt){error("overflow")}if(currentValue==n){for(q=delta,k=base;;k+=base){t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(q<t){break}qMinusT=q-t;baseMinusT=base-t;output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0)));q=floor(qMinusT/baseMinusT)}output.push(stringFromCharCode(digitToBasic(q,0)));bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength);delta=0;++handledCPCount}}++delta;++n}return output.join("")}function toUnicode(input){return mapDomain(input,(function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string}))}function toASCII(input){return mapDomain(input,(function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string}))}punycode={version:"1.4.1",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:toASCII,toUnicode:toUnicode};if(true){!(__WEBPACK_AMD_DEFINE_RESULT__=function(){return punycode}.call(exports,__webpack_require__,exports,module),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}else{}})(this)}).call(this,__webpack_require__(158)(module),__webpack_require__(106))},function(module,exports,__webpack_require__){"use strict";module.exports={isString:function(arg){return typeof arg==="string"},isObject:function(arg){return typeof arg==="object"&&arg!==null},isNull:function(arg){return arg===null},isNullOrUndefined:function(arg){return arg==null}}},function(module,exports,__webpack_require__){"use strict";exports.decode=exports.parse=__webpack_require__(444);exports.encode=exports.stringify=__webpack_require__(445)},function(module,exports,__webpack_require__){"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&";eq=eq||"=";var obj={};if(typeof qs!=="string"||qs.length===0){return obj}var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;if(options&&typeof options.maxKeys==="number"){maxKeys=options.maxKeys}var len=qs.length;if(maxKeys>0&&len>maxKeys){len=maxKeys}for(var i=0;i<len;++i){var x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq),kstr,vstr,k,v;if(idx>=0){kstr=x.substr(0,idx);vstr=x.substr(idx+1)}else{kstr=x;vstr=""}k=decodeURIComponent(kstr);v=decodeURIComponent(vstr);if(!hasOwnProperty(obj,k)){obj[k]=v}else if(isArray(obj[k])){obj[k].push(v)}else{obj[k]=[obj[k],v]}}return obj};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"}},function(module,exports,__webpack_require__){"use strict";var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){sep=sep||"&";eq=eq||"=";if(obj===null){obj=undefined}if(typeof obj==="object"){return map(objectKeys(obj),(function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;if(isArray(obj[k])){return map(obj[k],(function(v){return ks+encodeURIComponent(stringifyPrimitive(v))})).join(sep)}else{return ks+encodeURIComponent(stringifyPrimitive(obj[k]))}})).join(sep)}if(!name)return"";return encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj))};var isArray=Array.isArray||function(xs){return Object.prototype.toString.call(xs)==="[object Array]"};function map(xs,f){if(xs.map)return xs.map(f);var res=[];for(var i=0;i<xs.length;i++){res.push(f(xs[i],i))}return res}var objectKeys=Object.keys||function(obj){var res=[];for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))res.push(key)}return res}},function(module,exports,__webpack_require__){switch(window.__kbnThemeTag__){case"v7dark":return __webpack_require__(447);case"v7light":return __webpack_require__(449);case"v8dark":return __webpack_require__(451);case"v8light":return __webpack_require__(453)}},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(448);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".time-range-selector .time-range-section-container {\n  display: flex; }\n\n.time-range-selector .time-range-section-title {\n  font-weight: bold;\n  margin-bottom: 8px; }\n\n.time-range-selector .time-range-section {\n  flex: 50%;\n  padding: 0 8px;\n  border-right: 1px solid #343741; }\n\n.time-range-selector .tab-stack {\n  margin-bottom: 0;\n  padding-left: 0;\n  list-style: none; }\n  .time-range-selector .tab-stack > li {\n    float: none;\n    position: relative;\n    display: block;\n    margin-bottom: 4px; }\n    .time-range-selector .tab-stack > li > a {\n      position: relative;\n      display: block;\n      padding: 8px 16px;\n      border-radius: 4px; }\n    .time-range-selector .tab-stack > li > a:hover {\n      background-color: #25262E; }\n    .time-range-selector .tab-stack > li .body {\n      display: none; }\n  .time-range-selector .tab-stack > li.active > a {\n    color: #1D1E24;\n    background-color: #1BA9F5; }\n  .time-range-selector .tab-stack > li.active .body {\n    display: block;\n    height: 315px; }\n  .time-range-selector .tab-stack > li.has-body.active > a {\n    border-radius: 4px 4px 0 0; }\n  .time-range-selector .tab-stack > li.has-body.active .react-datepicker {\n    border-radius: 0 0 4px 4px;\n    border-top: none; }\n\n.time-range-selector .time-range-section:last-child {\n  border-right: none; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(450);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".time-range-selector .time-range-section-container {\n  display: flex; }\n\n.time-range-selector .time-range-section-title {\n  font-weight: bold;\n  margin-bottom: 8px; }\n\n.time-range-selector .time-range-section {\n  flex: 50%;\n  padding: 0 8px;\n  border-right: 1px solid #D3DAE6; }\n\n.time-range-selector .tab-stack {\n  margin-bottom: 0;\n  padding-left: 0;\n  list-style: none; }\n  .time-range-selector .tab-stack > li {\n    float: none;\n    position: relative;\n    display: block;\n    margin-bottom: 4px; }\n    .time-range-selector .tab-stack > li > a {\n      position: relative;\n      display: block;\n      padding: 8px 16px;\n      border-radius: 4px; }\n    .time-range-selector .tab-stack > li > a:hover {\n      background-color: #F5F7FA; }\n    .time-range-selector .tab-stack > li .body {\n      display: none; }\n  .time-range-selector .tab-stack > li.active > a {\n    color: #FFF;\n    background-color: #006BB4; }\n  .time-range-selector .tab-stack > li.active .body {\n    display: block;\n    height: 315px; }\n  .time-range-selector .tab-stack > li.has-body.active > a {\n    border-radius: 4px 4px 0 0; }\n  .time-range-selector .tab-stack > li.has-body.active .react-datepicker {\n    border-radius: 0 0 4px 4px;\n    border-top: none; }\n\n.time-range-selector .time-range-section:last-child {\n  border-right: none; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(452);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".time-range-selector .time-range-section-container {\n  display: flex; }\n\n.time-range-selector .time-range-section-title {\n  font-weight: bold;\n  margin-bottom: 8px; }\n\n.time-range-selector .time-range-section {\n  flex: 50%;\n  padding: 0 8px;\n  border-right: 1px solid #343741; }\n\n.time-range-selector .tab-stack {\n  margin-bottom: 0;\n  padding-left: 0;\n  list-style: none; }\n  .time-range-selector .tab-stack > li {\n    float: none;\n    position: relative;\n    display: block;\n    margin-bottom: 4px; }\n    .time-range-selector .tab-stack > li > a {\n      position: relative;\n      display: block;\n      padding: 8px 16px;\n      border-radius: 4px; }\n    .time-range-selector .tab-stack > li > a:hover {\n      background-color: #25262E; }\n    .time-range-selector .tab-stack > li .body {\n      display: none; }\n  .time-range-selector .tab-stack > li.active > a {\n    color: #1D1E24;\n    background-color: #36A2EF; }\n  .time-range-selector .tab-stack > li.active .body {\n    display: block;\n    height: 315px; }\n  .time-range-selector .tab-stack > li.has-body.active > a {\n    border-radius: 6px 6px 0 0; }\n  .time-range-selector .tab-stack > li.has-body.active .react-datepicker {\n    border-radius: 0 0 6px 6px;\n    border-top: none; }\n\n.time-range-selector .time-range-section:last-child {\n  border-right: none; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(454);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".time-range-selector .time-range-section-container {\n  display: flex; }\n\n.time-range-selector .time-range-section-title {\n  font-weight: bold;\n  margin-bottom: 8px; }\n\n.time-range-selector .time-range-section {\n  flex: 50%;\n  padding: 0 8px;\n  border-right: 1px solid #D3DAE6; }\n\n.time-range-selector .tab-stack {\n  margin-bottom: 0;\n  padding-left: 0;\n  list-style: none; }\n  .time-range-selector .tab-stack > li {\n    float: none;\n    position: relative;\n    display: block;\n    margin-bottom: 4px; }\n    .time-range-selector .tab-stack > li > a {\n      position: relative;\n      display: block;\n      padding: 8px 16px;\n      border-radius: 4px; }\n    .time-range-selector .tab-stack > li > a:hover {\n      background-color: #F5F7FA; }\n    .time-range-selector .tab-stack > li .body {\n      display: none; }\n  .time-range-selector .tab-stack > li.active > a {\n    color: #FFF;\n    background-color: #07C; }\n  .time-range-selector .tab-stack > li.active .body {\n    display: block;\n    height: 315px; }\n  .time-range-selector .tab-stack > li.has-body.active > a {\n    border-radius: 6px 6px 0 0; }\n  .time-range-selector .tab-stack > li.has-body.active .react-datepicker {\n    border-radius: 0 0 6px 6px;\n    border-top: none; }\n\n.time-range-selector .time-range-section:last-child {\n  border-right: none; }\n",""]);module.exports=exports},,,function(module,exports,__webpack_require__){var rng=__webpack_require__(458);var bytesToUuid=__webpack_require__(459);function v4(options,buf,offset){var i=buf&&offset||0;if(typeof options=="string"){buf=options==="binary"?new Array(16):null;options=null}options=options||{};var rnds=options.random||(options.rng||rng)();rnds[6]=rnds[6]&15|64;rnds[8]=rnds[8]&63|128;if(buf){for(var ii=0;ii<16;++ii){buf[i+ii]=rnds[ii]}}return buf||bytesToUuid(rnds)}module.exports=v4},function(module,exports){var getRandomValues=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(getRandomValues){var rnds8=new Uint8Array(16);module.exports=function whatwgRNG(){getRandomValues(rnds8);return rnds8}}else{var rnds=new Array(16);module.exports=function mathRNG(){for(var i=0,r;i<16;i++){if((i&3)===0)r=Math.random()*4294967296;rnds[i]=r>>>((i&3)<<3)&255}return rnds}}},function(module,exports){var byteToHex=[];for(var i=0;i<256;++i){byteToHex[i]=(i+256).toString(16).substr(1)}function bytesToUuid(buf,offset){var i=offset||0;var bth=byteToHex;return[bth[buf[i++]],bth[buf[i++]],bth[buf[i++]],bth[buf[i++]],"-",bth[buf[i++]],bth[buf[i++]],"-",bth[buf[i++]],bth[buf[i++]],"-",bth[buf[i++]],bth[buf[i++]],"-",bth[buf[i++]],bth[buf[i++]],bth[buf[i++]],bth[buf[i++]],bth[buf[i++]],bth[buf[i++]]].join("")}module.exports=bytesToUuid},function(module,exports,__webpack_require__){"use strict";exports.byteLength=byteLength;exports.toByteArray=toByteArray;exports.fromByteArray=fromByteArray;var lookup=[];var revLookup=[];var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i=0,len=code.length;i<len;++i){lookup[i]=code[i];revLookup[code.charCodeAt(i)]=i}revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63;function getLens(b64){var len=b64.length;if(len%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}var validLen=b64.indexOf("=");if(validLen===-1)validLen=len;var placeHoldersLen=validLen===len?0:4-validLen%4;return[validLen,placeHoldersLen]}function byteLength(b64){var lens=getLens(b64);var validLen=lens[0];var placeHoldersLen=lens[1];return(validLen+placeHoldersLen)*3/4-placeHoldersLen}function _byteLength(b64,validLen,placeHoldersLen){return(validLen+placeHoldersLen)*3/4-placeHoldersLen}function toByteArray(b64){var tmp;var lens=getLens(b64);var validLen=lens[0];var placeHoldersLen=lens[1];var arr=new Arr(_byteLength(b64,validLen,placeHoldersLen));var curByte=0;var len=placeHoldersLen>0?validLen-4:validLen;var i;for(i=0;i<len;i+=4){tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)];arr[curByte++]=tmp>>16&255;arr[curByte++]=tmp>>8&255;arr[curByte++]=tmp&255}if(placeHoldersLen===2){tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4;arr[curByte++]=tmp&255}if(placeHoldersLen===1){tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2;arr[curByte++]=tmp>>8&255;arr[curByte++]=tmp&255}return arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}function encodeChunk(uint8,start,end){var tmp;var output=[];for(var i=start;i<end;i+=3){tmp=(uint8[i]<<16&16711680)+(uint8[i+1]<<8&65280)+(uint8[i+2]&255);output.push(tripletToBase64(tmp))}return output.join("")}function fromByteArray(uint8){var tmp;var len=uint8.length;var extraBytes=len%3;var parts=[];var maxChunkLength=16383;for(var i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength){parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength))}if(extraBytes===1){tmp=uint8[len-1];parts.push(lookup[tmp>>2]+lookup[tmp<<4&63]+"==")}else if(extraBytes===2){tmp=(uint8[len-2]<<8)+uint8[len-1];parts.push(lookup[tmp>>10]+lookup[tmp>>4&63]+lookup[tmp<<2&63]+"=")}return parts.join("")}},function(module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i=isLE?nBytes-1:0;var d=isLE?-1:1;var s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i],i+=d,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i=isLE?0:nBytes-1;var d=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i]=m&255,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i]=e&255,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=s*128}},function(module,exports){var toString={}.toString;module.exports=Array.isArray||function(arr){return toString.call(arr)=="[object Array]"}},function(module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==="object"&&typeof arg.copy==="function"&&typeof arg.fill==="function"&&typeof arg.readUInt8==="function"}},function(module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},function(module,exports,__webpack_require__){"use strict";var util=__webpack_require__(162);var CalendarObject=__webpack_require__(102).CalendarObject;var schema=__webpack_require__(102).schema;var iCalendar=__webpack_require__(190).iCalendar;var RRule=__webpack_require__(189).RRule;var VEvent=exports.VEvent=function(calendar,uid){if(!(calendar instanceof iCalendar)&&calendar!=null){uid=calendar;calendar=null}CalendarObject.call(this,calendar,"VEVENT");if(uid!==undefined){this.addProperty("DTSTAMP",new Date);this.addProperty("UID",uid)}};util.inherits(VEvent,CalendarObject);VEvent.prototype.setSummary=function(summ){this.addProperty("SUMMARY",summ)};VEvent.prototype.setLocation=function(loc){this.addProperty("LOCATION",loc)};VEvent.prototype.setDescription=function(desc){this.addProperty("DESCRIPTION",desc)};VEvent.prototype.setDate=function(start,end){this.addProperty("DTSTART",start);if(end instanceof Date)this.addProperty("DTEND",end);else this.addProperty("DURATION",end)};VEvent.prototype.rrule=function(){var rr=this.getPropertyValue("RRULE");if(!rr)return null;var exceptions=[];var ex,i=0;while(ex=this.getPropertyValue("EXDATE",i++))exceptions.push.apply(exceptions,ex);return new RRule(rr,{DTSTART:this.getPropertyValue("DTSTART"),DTEND:this.getPropertyValue("DTEND"),EXDATE:exceptions})};VEvent.prototype.inTimeRange=function(start,end){var rr=this.rrule();if(rr){var next=rr.next(start);return next!==null&&(!end||next<=end)}var dtstart=this.getPropertyValue("DTSTART");var dtend=this.getPropertyValue("DTEND");if(!dtend){var duration=this.getPropertyValue("DURATION");if(duration===0)return(!start||start<=dtstart)&&(!end||end>dtstart);else if(duration)dtend=new Date(dtstart.valueOf()+this.getPropertyValue("DURATION")*1e3);else dtend=new Date(dtstart.valueOf()+24*60*60*1e3)}return(!start||start<dtend)&&(!end||end>dtstart)};VEvent.prototype.reply=function(fromuser,status,options){var resp=this.clone(true);options=options||{};if(status===true||status===undefined)status="ACCEPTED";else if(status===false)status="DECLINED";resp.setProperty("ATTENDEE",fromuser,{PARTSTAT:status,CN:options["CN"]||fromuser});resp.setProperty("DTSTAMP",new Date);resp.setProperty("LAST-MODIFIED",new Date);var ics=new iCalendar;ics.addProperty("METHOD","REPLY");if(this.calendar)ics.addComponents(this.calendar.getComponents("VTIMEZONE"));ics.addComponent(resp);return ics};schema.VEVENT={factory:VEvent,valid_properties:[],required_properties:["DTSTAMP","UID"],valid_children:[],required_children:[]}},function(module,exports,__webpack_require__){var assert=__webpack_require__(231);var util=__webpack_require__(162);var CalendarObject=__webpack_require__(102).CalendarObject;var schema=__webpack_require__(102).schema;var RRule=__webpack_require__(189).RRule;var VTimezone=exports.VTimezone=function(calendar,tzid){CalendarObject.call(this,calendar,"VTIMEZONE");this.addProperty("TZID",tzid)};util.inherits(VTimezone,CalendarObject);VTimezone.prototype.getRRule=function(section){var comp=this.getComponents(section)[0];if(!comp||!comp.getPropertyValue("RRULE"))return null;return new RRule(comp.getPropertyValue("RRULE"),comp.getPropertyValue("DTSTART"),comp.getPropertyValue("DTEND"))};VTimezone.prototype.getOffsetForDate=function(dt){if(!this.getComponents("DAYLIGHT").length)return this.getComponents("STANDARD")[0].getPropertyValue("TZOFFSETTO");assert.equal(1,this.components["STANDARD"].length);assert.equal(1,this.components["DAYLIGHT"].length);var next_std=this.getRRule("STANDARD");var next_dst=this.getRRule("DAYLIGHT");if(next_std===null||next_dst===null){var comp=this.getComponents("STANDARD")[0];return comp.getPropertyValue("TZOFFSETTO")}next_std=next_std.next(dt);next_dst=next_dst.next(dt);return this.getComponents(next_dst<next_std?"STANDARD":"DAYLIGHT")[0].getPropertyValue("TZOFFSETTO")};VTimezone.prototype.fromLocalTime=function(dtarray){var hrs=this.getOffsetForDate(dtarray);var min=hrs%100;hrs=(hrs-min)/100;return new Date(Date.UTC(dtarray[0],dtarray[1]-1,dtarray[2],dtarray[3]-hrs,dtarray[4]-min,dtarray[5]))};schema.VTIMEZONE={factory:VTimezone}},function(module,exports,__webpack_require__){switch(window.__kbnThemeTag__){case"v7dark":return __webpack_require__(468);case"v7light":return __webpack_require__(470);case"v8dark":return __webpack_require__(472);case"v8light":return __webpack_require__(474)}},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(469);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".mlExpandedRowDetails {\n  padding: 0 8px 8px 8px; }\n\n/* Hide the basic table's header */\n.mlExpandedRowDetailsSection thead {\n  display: none; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(471);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".mlExpandedRowDetails {\n  padding: 0 8px 8px 8px; }\n\n/* Hide the basic table's header */\n.mlExpandedRowDetailsSection thead {\n  display: none; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(473);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".mlExpandedRowDetails {\n  padding: 0 8px 8px 8px; }\n\n/* Hide the basic table's header */\n.mlExpandedRowDetailsSection thead {\n  display: none; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(475);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".mlExpandedRowDetails {\n  padding: 0 8px 8px 8px; }\n\n/* Hide the basic table's header */\n.mlExpandedRowDetailsSection thead {\n  display: none; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){switch(window.__kbnThemeTag__){case"v7dark":return __webpack_require__(477);case"v7light":return __webpack_require__(479);case"v8dark":return __webpack_require__(481);case"v8light":return __webpack_require__(483)}},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(478);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,'.mlExpandedRowJobMessages {\n  padding: 0 8px 8px 8px; }\n\n/* override ML legacy class "job-messages-table" */\n.mlExpandedRowJobMessages .euiTable, .mlExpandedRowJobMessages .euiTableRowCell {\n  background-color: transparent !important; }\n',""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(480);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,'.mlExpandedRowJobMessages {\n  padding: 0 8px 8px 8px; }\n\n/* override ML legacy class "job-messages-table" */\n.mlExpandedRowJobMessages .euiTable, .mlExpandedRowJobMessages .euiTableRowCell {\n  background-color: transparent !important; }\n',""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(482);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,'.mlExpandedRowJobMessages {\n  padding: 0 8px 8px 8px; }\n\n/* override ML legacy class "job-messages-table" */\n.mlExpandedRowJobMessages .euiTable, .mlExpandedRowJobMessages .euiTableRowCell {\n  background-color: transparent !important; }\n',""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(484);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,'.mlExpandedRowJobMessages {\n  padding: 0 8px 8px 8px; }\n\n/* override ML legacy class "job-messages-table" */\n.mlExpandedRowJobMessages .euiTable, .mlExpandedRowJobMessages .euiTableRowCell {\n  background-color: transparent !important; }\n',""]);module.exports=exports},function(module,exports,__webpack_require__){"use strict";(function(setImmediate){function _interopDefault(ex){return ex&&typeof ex==="object"&&"default"in ex?ex["default"]:ex}var util=_interopDefault(__webpack_require__(488));var Heap=_interopDefault(__webpack_require__(489));function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function(obj){return typeof obj}}else{_typeof=function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_nonIterableRest()}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function _iterableToArrayLimit(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var window$1=typeof window==="undefined"?null:window;var navigator=window$1?window$1.navigator:null;var document$1=window$1?window$1.document:null;var typeofstr=_typeof("");var typeofobj=_typeof({});var typeoffn=_typeof((function(){}));var typeofhtmlele=typeof HTMLElement==="undefined"?"undefined":_typeof(HTMLElement);var instanceStr=function instanceStr(obj){return obj&&obj.instanceString&&fn(obj.instanceString)?obj.instanceString():null};var string=function string(obj){return obj!=null&&_typeof(obj)==typeofstr};var fn=function fn(obj){return obj!=null&&_typeof(obj)===typeoffn};var array=function array(obj){return Array.isArray?Array.isArray(obj):obj!=null&&obj instanceof Array};var plainObject=function plainObject(obj){return obj!=null&&_typeof(obj)===typeofobj&&!array(obj)&&obj.constructor===Object};var object=function object(obj){return obj!=null&&_typeof(obj)===typeofobj};var number=function number(obj){return obj!=null&&_typeof(obj)===_typeof(1)&&!isNaN(obj)};var integer=function integer(obj){return number(obj)&&Math.floor(obj)===obj};var htmlElement=function htmlElement(obj){if("undefined"===typeofhtmlele){return undefined}else{return null!=obj&&obj instanceof HTMLElement}};var elementOrCollection=function elementOrCollection(obj){return element(obj)||collection(obj)};var element=function element(obj){return instanceStr(obj)==="collection"&&obj._private.single};var collection=function collection(obj){return instanceStr(obj)==="collection"&&!obj._private.single};var core=function core(obj){return instanceStr(obj)==="core"};var stylesheet=function stylesheet(obj){return instanceStr(obj)==="stylesheet"};var event=function event(obj){return instanceStr(obj)==="event"};var emptyString=function emptyString(obj){if(obj===undefined||obj===null){return true}else if(obj===""||obj.match(/^\s+$/)){return true}return false};var domElement=function domElement(obj){if(typeof HTMLElement==="undefined"){return false}else{return obj instanceof HTMLElement}};var boundingBox=function boundingBox(obj){return plainObject(obj)&&number(obj.x1)&&number(obj.x2)&&number(obj.y1)&&number(obj.y2)};var promise=function promise(obj){return object(obj)&&fn(obj.then)};var ms=function ms(){return navigator&&navigator.userAgent.match(/msie|trident|edge/i)};var memoize=function memoize(fn,keyFn){if(!keyFn){keyFn=function keyFn(){if(arguments.length===1){return arguments[0]}else if(arguments.length===0){return"undefined"}var args=[];for(var i=0;i<arguments.length;i++){args.push(arguments[i])}return args.join("$")}}var memoizedFn=function memoizedFn(){var self=this;var args=arguments;var ret;var k=keyFn.apply(self,args);var cache=memoizedFn.cache;if(!(ret=cache[k])){ret=cache[k]=fn.apply(self,args)}return ret};memoizedFn.cache={};return memoizedFn};var camel2dash=memoize((function(str){return str.replace(/([A-Z])/g,(function(v){return"-"+v.toLowerCase()}))}));var dash2camel=memoize((function(str){return str.replace(/(-\w)/g,(function(v){return v[1].toUpperCase()}))}));var prependCamel=memoize((function(prefix,str){return prefix+str[0].toUpperCase()+str.substring(1)}),(function(prefix,str){return prefix+"$"+str}));var capitalize=function capitalize(str){if(emptyString(str)){return str}return str.charAt(0).toUpperCase()+str.substring(1)};var number$1="(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))";var rgba="rgb[a]?\\(("+number$1+"[%]?)\\s*,\\s*("+number$1+"[%]?)\\s*,\\s*("+number$1+"[%]?)(?:\\s*,\\s*("+number$1+"))?\\)";var rgbaNoBackRefs="rgb[a]?\\((?:"+number$1+"[%]?)\\s*,\\s*(?:"+number$1+"[%]?)\\s*,\\s*(?:"+number$1+"[%]?)(?:\\s*,\\s*(?:"+number$1+"))?\\)";var hsla="hsl[a]?\\(("+number$1+")\\s*,\\s*("+number$1+"[%])\\s*,\\s*("+number$1+"[%])(?:\\s*,\\s*("+number$1+"))?\\)";var hslaNoBackRefs="hsl[a]?\\((?:"+number$1+")\\s*,\\s*(?:"+number$1+"[%])\\s*,\\s*(?:"+number$1+"[%])(?:\\s*,\\s*(?:"+number$1+"))?\\)";var hex3="\\#[0-9a-fA-F]{3}";var hex6="\\#[0-9a-fA-F]{6}";var ascending=function ascending(a,b){if(a<b){return-1}else if(a>b){return 1}else{return 0}};var descending=function descending(a,b){return-1*ascending(a,b)};var extend=Object.assign!=null?Object.assign.bind(Object):function(tgt){var args=arguments;for(var i=1;i<args.length;i++){var obj=args[i];if(obj==null){continue}var keys=Object.keys(obj);for(var j=0;j<keys.length;j++){var k=keys[j];tgt[k]=obj[k]}}return tgt};var hex2tuple=function hex2tuple(hex){if(!(hex.length===4||hex.length===7)||hex[0]!=="#"){return}var shortHex=hex.length===4;var r,g,b;var base=16;if(shortHex){r=parseInt(hex[1]+hex[1],base);g=parseInt(hex[2]+hex[2],base);b=parseInt(hex[3]+hex[3],base)}else{r=parseInt(hex[1]+hex[2],base);g=parseInt(hex[3]+hex[4],base);b=parseInt(hex[5]+hex[6],base)}return[r,g,b]};var hsl2tuple=function hsl2tuple(hsl){var ret;var h,s,l,a,r,g,b;function hue2rgb(p,q,t){if(t<0)t+=1;if(t>1)t-=1;if(t<1/6)return p+(q-p)*6*t;if(t<1/2)return q;if(t<2/3)return p+(q-p)*(2/3-t)*6;return p}var m=new RegExp("^"+hsla+"$").exec(hsl);if(m){h=parseInt(m[1]);if(h<0){h=(360- -1*h%360)%360}else if(h>360){h=h%360}h/=360;s=parseFloat(m[2]);if(s<0||s>100){return}s=s/100;l=parseFloat(m[3]);if(l<0||l>100){return}l=l/100;a=m[4];if(a!==undefined){a=parseFloat(a);if(a<0||a>1){return}}if(s===0){r=g=b=Math.round(l*255)}else{var q=l<.5?l*(1+s):l+s-l*s;var p=2*l-q;r=Math.round(255*hue2rgb(p,q,h+1/3));g=Math.round(255*hue2rgb(p,q,h));b=Math.round(255*hue2rgb(p,q,h-1/3))}ret=[r,g,b,a]}return ret};var rgb2tuple=function rgb2tuple(rgb){var ret;var m=new RegExp("^"+rgba+"$").exec(rgb);if(m){ret=[];var isPct=[];for(var i=1;i<=3;i++){var channel=m[i];if(channel[channel.length-1]==="%"){isPct[i]=true}channel=parseFloat(channel);if(isPct[i]){channel=channel/100*255}if(channel<0||channel>255){return}ret.push(Math.floor(channel))}var atLeastOneIsPct=isPct[1]||isPct[2]||isPct[3];var allArePct=isPct[1]&&isPct[2]&&isPct[3];if(atLeastOneIsPct&&!allArePct){return}var alpha=m[4];if(alpha!==undefined){alpha=parseFloat(alpha);if(alpha<0||alpha>1){return}ret.push(alpha)}}return ret};var colorname2tuple=function colorname2tuple(color){return colors[color.toLowerCase()]};var color2tuple=function color2tuple(color){return(array(color)?color:null)||colorname2tuple(color)||hex2tuple(color)||rgb2tuple(color)||hsl2tuple(color)};var colors={transparent:[0,0,0,0],aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],grey:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};var setMap=function setMap(options){var obj=options.map;var keys=options.keys;var l=keys.length;for(var i=0;i<l;i++){var key=keys[i];if(plainObject(key)){throw Error("Tried to set map with object key")}if(i<keys.length-1){if(obj[key]==null){obj[key]={}}obj=obj[key]}else{obj[key]=options.value}}};var getMap=function getMap(options){var obj=options.map;var keys=options.keys;var l=keys.length;for(var i=0;i<l;i++){var key=keys[i];if(plainObject(key)){throw Error("Tried to get map with object key")}obj=obj[key];if(obj==null){return obj}}return obj};var performance=window$1?window$1.performance:null;var pnow=performance&&performance.now?function(){return performance.now()}:function(){return Date.now()};var raf=function(){if(window$1){if(window$1.requestAnimationFrame){return function(fn){window$1.requestAnimationFrame(fn)}}else if(window$1.mozRequestAnimationFrame){return function(fn){window$1.mozRequestAnimationFrame(fn)}}else if(window$1.webkitRequestAnimationFrame){return function(fn){window$1.webkitRequestAnimationFrame(fn)}}else if(window$1.msRequestAnimationFrame){return function(fn){window$1.msRequestAnimationFrame(fn)}}}return function(fn){if(fn){setTimeout((function(){fn(pnow())}),1e3/60)}}}();var requestAnimationFrame=function requestAnimationFrame(fn){return raf(fn)};var performanceNow=pnow;var DEFAULT_SEED=5381;var hashIterableInts=function hashIterableInts(iterator){var seed=arguments.length>1&&arguments[1]!==undefined?arguments[1]:DEFAULT_SEED;var hash=seed;var entry;for(;;){entry=iterator.next();if(entry.done){break}hash=(hash<<5)+hash+entry.value|0}return hash};var hashInt=function hashInt(num){var seed=arguments.length>1&&arguments[1]!==undefined?arguments[1]:DEFAULT_SEED;return(seed<<5)+seed+num|0};var hashIntsArray=function hashIntsArray(ints,seed){var entry={value:0,done:false};var i=0;var length=ints.length;var iterator={next:function next(){if(i<length){entry.value=ints[i++]}else{entry.done=true}return entry}};return hashIterableInts(iterator,seed)};var hashString=function hashString(str,seed){var entry={value:0,done:false};var i=0;var length=str.length;var iterator={next:function next(){if(i<length){entry.value=str.charCodeAt(i++)}else{entry.done=true}return entry}};return hashIterableInts(iterator,seed)};var hashStrings=function hashStrings(){return hashStringsArray(arguments)};var hashStringsArray=function hashStringsArray(strs){var hash;for(var i=0;i<strs.length;i++){var str=strs[i];if(i===0){hash=hashString(str)}else{hash=hashString(str,hash)}}return hash};var warningsEnabled=true;var warnSupported=console.warn!=null;var traceSupported=console.trace!=null;var MAX_INT=Number.MAX_SAFE_INTEGER||9007199254740991;var trueify=function trueify(){return true};var falsify=function falsify(){return false};var zeroify=function zeroify(){return 0};var noop=function noop(){};var error=function error(msg){throw new Error(msg)};var warnings=function warnings(enabled){if(enabled!==undefined){warningsEnabled=!!enabled}else{return warningsEnabled}};var warn=function warn(msg){if(!warnings()){return}if(warnSupported){console.warn(msg)}else{console.log(msg);if(traceSupported){console.trace()}}};var clone=function clone(obj){return extend({},obj)};var copy=function copy(obj){if(obj==null){return obj}if(array(obj)){return obj.slice()}else if(plainObject(obj)){return clone(obj)}else{return obj}};var copyArray=function copyArray(arr){return arr.slice()};var uuid=function uuid(a,b){for(b=a="";a++<36;b+=a*51&52?(a^15?8^Math.random()*(a^20?16:4):4).toString(16):"-"){}return b};var _staticEmptyObject={};var staticEmptyObject=function staticEmptyObject(){return _staticEmptyObject};var defaults=function defaults(_defaults){var keys=Object.keys(_defaults);return function(opts){var filledOpts={};for(var i=0;i<keys.length;i++){var key=keys[i];var optVal=opts==null?undefined:opts[key];filledOpts[key]=optVal===undefined?_defaults[key]:optVal}return filledOpts}};var removeFromArray=function removeFromArray(arr,ele,manyCopies){for(var i=arr.length;i>=0;i--){if(arr[i]===ele){arr.splice(i,1);if(!manyCopies){break}}}};var clearArray=function clearArray(arr){arr.splice(0,arr.length)};var push=function push(arr,otherArr){for(var i=0;i<otherArr.length;i++){var el=otherArr[i];arr.push(el)}};var getPrefixedProperty=function getPrefixedProperty(obj,propName,prefix){if(prefix){propName=prependCamel(prefix,propName)}return obj[propName]};var setPrefixedProperty=function setPrefixedProperty(obj,propName,prefix,value){if(prefix){propName=prependCamel(prefix,propName)}obj[propName]=value};var ObjectMap=function(){function ObjectMap(){_classCallCheck(this,ObjectMap);this._obj={}}_createClass(ObjectMap,[{key:"set",value:function set(key,val){this._obj[key]=val;return this}},{key:"delete",value:function _delete(key){this._obj[key]=undefined;return this}},{key:"clear",value:function clear(){this._obj={}}},{key:"has",value:function has(key){return this._obj[key]!==undefined}},{key:"get",value:function get(key){return this._obj[key]}}]);return ObjectMap}();var Map$1=typeof Map!=="undefined"?Map:ObjectMap;var undef="undefined";var ObjectSet=function(){function ObjectSet(arrayOrObjectSet){_classCallCheck(this,ObjectSet);this._obj=Object.create(null);this.size=0;if(arrayOrObjectSet!=null){var arr;if(arrayOrObjectSet.instanceString!=null&&arrayOrObjectSet.instanceString()===this.instanceString()){arr=arrayOrObjectSet.toArray()}else{arr=arrayOrObjectSet}for(var i=0;i<arr.length;i++){this.add(arr[i])}}}_createClass(ObjectSet,[{key:"instanceString",value:function instanceString(){return"set"}},{key:"add",value:function add(val){var o=this._obj;if(o[val]!==1){o[val]=1;this.size++}}},{key:"delete",value:function _delete(val){var o=this._obj;if(o[val]===1){o[val]=0;this.size--}}},{key:"clear",value:function clear(){this._obj=Object.create(null)}},{key:"has",value:function has(val){return this._obj[val]===1}},{key:"toArray",value:function toArray(){var _this=this;return Object.keys(this._obj).filter((function(key){return _this.has(key)}))}},{key:"forEach",value:function forEach(callback,thisArg){return this.toArray().forEach(callback,thisArg)}}]);return ObjectSet}();var Set$1=(typeof Set==="undefined"?"undefined":_typeof(Set))!==undef?Set:ObjectSet;var Element=function Element(cy,params,restore){restore=restore===undefined||restore?true:false;if(cy===undefined||params===undefined||!core(cy)){error("An element must have a core reference and parameters set");return}var group=params.group;if(group==null){if(params.data&&params.data.source!=null&&params.data.target!=null){group="edges"}else{group="nodes"}}if(group!=="nodes"&&group!=="edges"){error("An element must be of type `nodes` or `edges`; you specified `"+group+"`");return}this.length=1;this[0]=this;var _p=this._private={cy:cy,single:true,data:params.data||{},position:params.position||{x:0,y:0},autoWidth:undefined,autoHeight:undefined,autoPadding:undefined,compoundBoundsClean:false,listeners:[],group:group,style:{},rstyle:{},styleCxts:[],styleKeys:{},removed:true,selected:params.selected?true:false,selectable:params.selectable===undefined?true:params.selectable?true:false,locked:params.locked?true:false,grabbed:false,grabbable:params.grabbable===undefined?true:params.grabbable?true:false,pannable:params.pannable===undefined?group==="edges"?true:false:params.pannable?true:false,active:false,classes:new Set$1,animation:{current:[],queue:[]},rscratch:{},scratch:params.scratch||{},edges:[],children:[],parent:null,traversalCache:{},backgrounding:false,bbCache:null,bbCacheShift:{x:0,y:0},bodyBounds:null,overlayBounds:null,labelBounds:{all:null,source:null,target:null,main:null},arrowBounds:{source:null,target:null,"mid-source":null,"mid-target":null}};if(_p.position.x==null){_p.position.x=0}if(_p.position.y==null){_p.position.y=0}if(params.renderedPosition){var rpos=params.renderedPosition;var pan=cy.pan();var zoom=cy.zoom();_p.position={x:(rpos.x-pan.x)/zoom,y:(rpos.y-pan.y)/zoom}}var classes=[];if(array(params.classes)){classes=params.classes}else if(string(params.classes)){classes=params.classes.split(/\s+/)}for(var i=0,l=classes.length;i<l;i++){var cls=classes[i];if(!cls||cls===""){continue}_p.classes.add(cls)}this.createEmitter();var bypass=params.style||params.css;if(bypass){warn("Setting a `style` bypass at element creation is deprecated");this.style(bypass)}if(restore===undefined||restore){this.restore()}};var defineSearch=function defineSearch(params){params={bfs:params.bfs||!params.dfs,dfs:params.dfs||!params.bfs};return function searchFn(roots,fn$1,directed){var options;if(plainObject(roots)&&!elementOrCollection(roots)){options=roots;roots=options.roots||options.root;fn$1=options.visit;directed=options.directed}directed=arguments.length===2&&!fn(fn$1)?fn$1:directed;fn$1=fn(fn$1)?fn$1:function(){};var cy=this._private.cy;var v=roots=string(roots)?this.filter(roots):roots;var Q=[];var connectedNodes=[];var connectedBy={};var id2depth={};var V={};var j=0;var found;var _this$byGroup=this.byGroup(),nodes=_this$byGroup.nodes,edges=_this$byGroup.edges;for(var i=0;i<v.length;i++){var vi=v[i];var viId=vi.id();if(vi.isNode()){Q.unshift(vi);if(params.bfs){V[viId]=true;connectedNodes.push(vi)}id2depth[viId]=0}}var _loop2=function _loop2(){var v=params.bfs?Q.shift():Q.pop();var vId=v.id();if(params.dfs){if(V[vId]){return"continue"}V[vId]=true;connectedNodes.push(v)}var depth=id2depth[vId];var prevEdge=connectedBy[vId];var src=prevEdge!=null?prevEdge.source():null;var tgt=prevEdge!=null?prevEdge.target():null;var prevNode=prevEdge==null?undefined:v.same(src)?tgt[0]:src[0];var ret=void 0;ret=fn$1(v,prevEdge,prevNode,j++,depth);if(ret===true){found=v;return"break"}if(ret===false){return"break"}var vwEdges=v.connectedEdges().filter((function(e){return(!directed||e.source().same(v))&&edges.has(e)}));for(var _i2=0;_i2<vwEdges.length;_i2++){var e=vwEdges[_i2];var w=e.connectedNodes().filter((function(n){return!n.same(v)&&nodes.has(n)}));var wId=w.id();if(w.length!==0&&!V[wId]){w=w[0];Q.push(w);if(params.bfs){V[wId]=true;connectedNodes.push(w)}connectedBy[wId]=e;id2depth[wId]=id2depth[vId]+1}}};_loop:while(Q.length!==0){var _ret=_loop2();switch(_ret){case"continue":continue;case"break":break _loop}}var connectedEles=cy.collection();for(var _i=0;_i<connectedNodes.length;_i++){var node=connectedNodes[_i];var edge=connectedBy[node.id()];if(edge!=null){connectedEles.merge(edge)}connectedEles.merge(node)}return{path:cy.collection(connectedEles),found:cy.collection(found)}}};var elesfn={breadthFirstSearch:defineSearch({bfs:true}),depthFirstSearch:defineSearch({dfs:true})};elesfn.bfs=elesfn.breadthFirstSearch;elesfn.dfs=elesfn.depthFirstSearch;var dijkstraDefaults=defaults({root:null,weight:function weight(edge){return 1},directed:false});var elesfn$1={dijkstra:function dijkstra(options){if(!plainObject(options)){var args=arguments;options={root:args[0],weight:args[1],directed:args[2]}}var _dijkstraDefaults=dijkstraDefaults(options),root=_dijkstraDefaults.root,weight=_dijkstraDefaults.weight,directed=_dijkstraDefaults.directed;var eles=this;var weightFn=weight;var source=string(root)?this.filter(root)[0]:root[0];var dist={};var prev={};var knownDist={};var _this$byGroup=this.byGroup(),nodes=_this$byGroup.nodes,edges=_this$byGroup.edges;edges.unmergeBy((function(ele){return ele.isLoop()}));var getDist=function getDist(node){return dist[node.id()]};var setDist=function setDist(node,d){dist[node.id()]=d;Q.updateItem(node)};var Q=new Heap((function(a,b){return getDist(a)-getDist(b)}));for(var i=0;i<nodes.length;i++){var node=nodes[i];dist[node.id()]=node.same(source)?0:Infinity;Q.push(node)}var distBetween=function distBetween(u,v){var uvs=(directed?u.edgesTo(v):u.edgesWith(v)).intersect(edges);var smallestDistance=Infinity;var smallestEdge;for(var _i=0;_i<uvs.length;_i++){var edge=uvs[_i];var _weight=weightFn(edge);if(_weight<smallestDistance||!smallestEdge){smallestDistance=_weight;smallestEdge=edge}}return{edge:smallestEdge,dist:smallestDistance}};while(Q.size()>0){var u=Q.pop();var smalletsDist=getDist(u);var uid=u.id();knownDist[uid]=smalletsDist;if(smalletsDist===Infinity){continue}var neighbors=u.neighborhood().intersect(nodes);for(var _i2=0;_i2<neighbors.length;_i2++){var v=neighbors[_i2];var vid=v.id();var vDist=distBetween(u,v);var alt=smalletsDist+vDist.dist;if(alt<getDist(v)){setDist(v,alt);prev[vid]={node:u,edge:vDist.edge}}}}return{distanceTo:function distanceTo(node){var target=string(node)?nodes.filter(node)[0]:node[0];return knownDist[target.id()]},pathTo:function pathTo(node){var target=string(node)?nodes.filter(node)[0]:node[0];var S=[];var u=target;var uid=u.id();if(target.length>0){S.unshift(target);while(prev[uid]){var p=prev[uid];S.unshift(p.edge);S.unshift(p.node);u=p.node;uid=u.id()}}return eles.spawn(S)}}}};var elesfn$2={kruskal:function kruskal(weightFn){weightFn=weightFn||function(edge){return 1};var _this$byGroup=this.byGroup(),nodes=_this$byGroup.nodes,edges=_this$byGroup.edges;var numNodes=nodes.length;var forest=new Array(numNodes);var A=nodes;var findSetIndex=function findSetIndex(ele){for(var i=0;i<forest.length;i++){var eles=forest[i];if(eles.has(ele)){return i}}};for(var i=0;i<numNodes;i++){forest[i]=this.spawn(nodes[i])}var S=edges.sort((function(a,b){return weightFn(a)-weightFn(b)}));for(var _i=0;_i<S.length;_i++){var edge=S[_i];var u=edge.source()[0];var v=edge.target()[0];var setUIndex=findSetIndex(u);var setVIndex=findSetIndex(v);var setU=forest[setUIndex];var setV=forest[setVIndex];if(setUIndex!==setVIndex){A.merge(edge);setU.merge(setV);forest.splice(setVIndex,1)}}return A}};var aStarDefaults=defaults({root:null,goal:null,weight:function weight(edge){return 1},heuristic:function heuristic(edge){return 0},directed:false});var elesfn$3={aStar:function aStar(options){var cy=this.cy();var _aStarDefaults=aStarDefaults(options),root=_aStarDefaults.root,goal=_aStarDefaults.goal,heuristic=_aStarDefaults.heuristic,directed=_aStarDefaults.directed,weight=_aStarDefaults.weight;root=cy.collection(root)[0];goal=cy.collection(goal)[0];var sid=root.id();var tid=goal.id();var gScore={};var fScore={};var closedSetIds={};var openSet=new Heap((function(a,b){return fScore[a.id()]-fScore[b.id()]}));var openSetIds=new Set$1;var cameFrom={};var cameFromEdge={};var addToOpenSet=function addToOpenSet(ele,id){openSet.push(ele);openSetIds.add(id)};var cMin,cMinId;var popFromOpenSet=function popFromOpenSet(){cMin=openSet.pop();cMinId=cMin.id();openSetIds["delete"](cMinId)};var isInOpenSet=function isInOpenSet(id){return openSetIds.has(id)};addToOpenSet(root,sid);gScore[sid]=0;fScore[sid]=heuristic(root);var steps=0;while(openSet.size()>0){popFromOpenSet();steps++;if(cMinId===tid){var path=[];var pathNode=goal;var pathNodeId=tid;var pathEdge=cameFromEdge[pathNodeId];for(;;){path.unshift(pathNode);if(pathEdge!=null){path.unshift(pathEdge)}pathNode=cameFrom[pathNodeId];if(pathNode==null){break}pathNodeId=pathNode.id();pathEdge=cameFromEdge[pathNodeId]}return{found:true,distance:gScore[cMinId],path:this.spawn(path),steps:steps}}closedSetIds[cMinId]=true;var vwEdges=cMin._private.edges;for(var i=0;i<vwEdges.length;i++){var e=vwEdges[i];if(!this.hasElementWithId(e.id())){continue}if(directed&&e.data("source")!==cMinId){continue}var wSrc=e.source();var wTgt=e.target();var w=wSrc.id()!==cMinId?wSrc:wTgt;var wid=w.id();if(!this.hasElementWithId(wid)){continue}if(closedSetIds[wid]){continue}var tempScore=gScore[cMinId]+weight(e);if(!isInOpenSet(wid)){gScore[wid]=tempScore;fScore[wid]=tempScore+heuristic(w);addToOpenSet(w,wid);cameFrom[wid]=cMin;cameFromEdge[wid]=e;continue}if(tempScore<gScore[wid]){gScore[wid]=tempScore;fScore[wid]=tempScore+heuristic(w);cameFrom[wid]=cMin}}}return{found:false,distance:undefined,path:undefined,steps:steps}}};var floydWarshallDefaults=defaults({weight:function weight(edge){return 1},directed:false});var elesfn$4={floydWarshall:function floydWarshall(options){var cy=this.cy();var _floydWarshallDefault=floydWarshallDefaults(options),weight=_floydWarshallDefault.weight,directed=_floydWarshallDefault.directed;var weightFn=weight;var _this$byGroup=this.byGroup(),nodes=_this$byGroup.nodes,edges=_this$byGroup.edges;var N=nodes.length;var Nsq=N*N;var indexOf=function indexOf(node){return nodes.indexOf(node)};var atIndex=function atIndex(i){return nodes[i]};var dist=new Array(Nsq);for(var n=0;n<Nsq;n++){var j=n%N;var i=(n-j)/N;if(i===j){dist[n]=0}else{dist[n]=Infinity}}var next=new Array(Nsq);var edgeNext=new Array(Nsq);for(var _i=0;_i<edges.length;_i++){var edge=edges[_i];var src=edge.source()[0];var tgt=edge.target()[0];if(src===tgt){continue}var s=indexOf(src);var t=indexOf(tgt);var st=s*N+t;var _weight=weightFn(edge);if(dist[st]>_weight){dist[st]=_weight;next[st]=t;edgeNext[st]=edge}if(!directed){var ts=t*N+s;if(!directed&&dist[ts]>_weight){dist[ts]=_weight;next[ts]=s;edgeNext[ts]=edge}}}for(var k=0;k<N;k++){for(var _i2=0;_i2<N;_i2++){var ik=_i2*N+k;for(var _j=0;_j<N;_j++){var ij=_i2*N+_j;var kj=k*N+_j;if(dist[ik]+dist[kj]<dist[ij]){dist[ij]=dist[ik]+dist[kj];next[ij]=next[ik]}}}}var getArgEle=function getArgEle(ele){return(string(ele)?cy.filter(ele):ele)[0]};var indexOfArgEle=function indexOfArgEle(ele){return indexOf(getArgEle(ele))};var res={distance:function distance(from,to){var i=indexOfArgEle(from);var j=indexOfArgEle(to);return dist[i*N+j]},path:function path(from,to){var i=indexOfArgEle(from);var j=indexOfArgEle(to);var fromNode=atIndex(i);if(i===j){return fromNode.collection()}if(next[i*N+j]==null){return cy.collection()}var path=cy.collection();var prev=i;var edge;path.merge(fromNode);while(i!==j){prev=i;i=next[i*N+j];edge=edgeNext[prev*N+i];path.merge(edge);path.merge(atIndex(i))}return path}};return res}};var bellmanFordDefaults=defaults({weight:function weight(edge){return 1},directed:false,root:null});var elesfn$5={bellmanFord:function bellmanFord(options){var _this=this;var _bellmanFordDefaults=bellmanFordDefaults(options),weight=_bellmanFordDefaults.weight,directed=_bellmanFordDefaults.directed,root=_bellmanFordDefaults.root;var weightFn=weight;var eles=this;var cy=this.cy();var _this$byGroup=this.byGroup(),edges=_this$byGroup.edges,nodes=_this$byGroup.nodes;var numNodes=nodes.length;var infoMap=new Map$1;var hasNegativeWeightCycle=false;var negativeWeightCycles=[];root=cy.collection(root)[0];edges.unmergeBy((function(edge){return edge.isLoop()}));var numEdges=edges.length;var getInfo=function getInfo(node){var obj=infoMap.get(node.id());if(!obj){obj={};infoMap.set(node.id(),obj)}return obj};var getNodeFromTo=function getNodeFromTo(to){return(string(to)?cy.$(to):to)[0]};var distanceTo=function distanceTo(to){return getInfo(getNodeFromTo(to)).dist};var pathTo=function pathTo(to){var thisStart=arguments.length>1&&arguments[1]!==undefined?arguments[1]:root;var end=getNodeFromTo(to);var path=[];var node=end;for(;;){if(node==null){return _this.spawn()}var _getInfo=getInfo(node),edge=_getInfo.edge,pred=_getInfo.pred;path.unshift(node[0]);if(node.same(thisStart)&&path.length>0){break}if(edge!=null){path.unshift(edge)}node=pred}return eles.spawn(path)};for(var i=0;i<numNodes;i++){var node=nodes[i];var info=getInfo(node);if(node.same(root)){info.dist=0}else{info.dist=Infinity}info.pred=null;info.edge=null}var replacedEdge=false;var checkForEdgeReplacement=function checkForEdgeReplacement(node1,node2,edge,info1,info2,weight){var dist=info1.dist+weight;if(dist<info2.dist&&!edge.same(info1.edge)){info2.dist=dist;info2.pred=node1;info2.edge=edge;replacedEdge=true}};for(var _i=1;_i<numNodes;_i++){replacedEdge=false;for(var e=0;e<numEdges;e++){var edge=edges[e];var src=edge.source();var tgt=edge.target();var _weight=weightFn(edge);var srcInfo=getInfo(src);var tgtInfo=getInfo(tgt);checkForEdgeReplacement(src,tgt,edge,srcInfo,tgtInfo,_weight);if(!directed){checkForEdgeReplacement(tgt,src,edge,tgtInfo,srcInfo,_weight)}}if(!replacedEdge){break}}if(replacedEdge){for(var _e=0;_e<numEdges;_e++){var _edge=edges[_e];var _src=_edge.source();var _tgt=_edge.target();var _weight2=weightFn(_edge);var srcDist=getInfo(_src).dist;var tgtDist=getInfo(_tgt).dist;if(srcDist+_weight2<tgtDist||!directed&&tgtDist+_weight2<srcDist){warn("Graph contains a negative weight cycle for Bellman-Ford");hasNegativeWeightCycle=true;break}}}return{distanceTo:distanceTo,pathTo:pathTo,hasNegativeWeightCycle:hasNegativeWeightCycle,negativeWeightCycles:negativeWeightCycles}}};var sqrt2=Math.sqrt(2);var collapse=function collapse(edgeIndex,nodeMap,remainingEdges){if(remainingEdges.length===0){error("Karger-Stein must be run on a connected (sub)graph")}var edgeInfo=remainingEdges[edgeIndex];var sourceIn=edgeInfo[1];var targetIn=edgeInfo[2];var partition1=nodeMap[sourceIn];var partition2=nodeMap[targetIn];var newEdges=remainingEdges;for(var i=newEdges.length-1;i>=0;i--){var edge=newEdges[i];var src=edge[1];var tgt=edge[2];if(nodeMap[src]===partition1&&nodeMap[tgt]===partition2||nodeMap[src]===partition2&&nodeMap[tgt]===partition1){newEdges.splice(i,1)}}for(var _i=0;_i<newEdges.length;_i++){var _edge=newEdges[_i];if(_edge[1]===partition2){newEdges[_i]=_edge.slice();newEdges[_i][1]=partition1}else if(_edge[2]===partition2){newEdges[_i]=_edge.slice();newEdges[_i][2]=partition1}}for(var _i2=0;_i2<nodeMap.length;_i2++){if(nodeMap[_i2]===partition2){nodeMap[_i2]=partition1}}return newEdges};var contractUntil=function contractUntil(metaNodeMap,remainingEdges,size,sizeLimit){while(size>sizeLimit){var edgeIndex=Math.floor(Math.random()*remainingEdges.length);remainingEdges=collapse(edgeIndex,metaNodeMap,remainingEdges);size--}return remainingEdges};var elesfn$6={kargerStein:function kargerStein(){var _this$byGroup=this.byGroup(),nodes=_this$byGroup.nodes,edges=_this$byGroup.edges;edges.unmergeBy((function(edge){return edge.isLoop()}));var numNodes=nodes.length;var numEdges=edges.length;var numIter=Math.ceil(Math.pow(Math.log(numNodes)/Math.LN2,2));var stopSize=Math.floor(numNodes/sqrt2);if(numNodes<2){error("At least 2 nodes are required for Karger-Stein algorithm");return undefined}var edgeIndexes=[];for(var i=0;i<numEdges;i++){var e=edges[i];edgeIndexes.push([i,nodes.indexOf(e.source()),nodes.indexOf(e.target())])}var minCutSize=Infinity;var minCutEdgeIndexes=[];var minCutNodeMap=new Array(numNodes);var metaNodeMap=new Array(numNodes);var metaNodeMap2=new Array(numNodes);var copyNodesMap=function copyNodesMap(from,to){for(var _i3=0;_i3<numNodes;_i3++){to[_i3]=from[_i3]}};for(var iter=0;iter<=numIter;iter++){for(var _i4=0;_i4<numNodes;_i4++){metaNodeMap[_i4]=_i4}var edgesState=contractUntil(metaNodeMap,edgeIndexes.slice(),numNodes,stopSize);var edgesState2=edgesState.slice();copyNodesMap(metaNodeMap,metaNodeMap2);var res1=contractUntil(metaNodeMap,edgesState,stopSize,2);var res2=contractUntil(metaNodeMap2,edgesState2,stopSize,2);if(res1.length<=res2.length&&res1.length<minCutSize){minCutSize=res1.length;minCutEdgeIndexes=res1;copyNodesMap(metaNodeMap,minCutNodeMap)}else if(res2.length<=res1.length&&res2.length<minCutSize){minCutSize=res2.length;minCutEdgeIndexes=res2;copyNodesMap(metaNodeMap2,minCutNodeMap)}}var cut=this.spawn(minCutEdgeIndexes.map((function(e){return edges[e[0]]})));var partition1=this.spawn();var partition2=this.spawn();var witnessNodePartition=minCutNodeMap[0];for(var _i5=0;_i5<minCutNodeMap.length;_i5++){var partitionId=minCutNodeMap[_i5];var node=nodes[_i5];if(partitionId===witnessNodePartition){partition1.merge(node)}else{partition2.merge(node)}}var ret={cut:cut,partition1:partition1,partition2:partition2};return ret}};var copyPosition=function copyPosition(p){return{x:p.x,y:p.y}};var modelToRenderedPosition=function modelToRenderedPosition(p,zoom,pan){return{x:p.x*zoom+pan.x,y:p.y*zoom+pan.y}};var renderedToModelPosition=function renderedToModelPosition(p,zoom,pan){return{x:(p.x-pan.x)/zoom,y:(p.y-pan.y)/zoom}};var array2point=function array2point(arr){return{x:arr[0],y:arr[1]}};var min=function min(arr){var begin=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var end=arguments.length>2&&arguments[2]!==undefined?arguments[2]:arr.length;var min=Infinity;for(var i=begin;i<end;i++){var val=arr[i];if(isFinite(val)){min=Math.min(val,min)}}return min};var max=function max(arr){var begin=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var end=arguments.length>2&&arguments[2]!==undefined?arguments[2]:arr.length;var max=-Infinity;for(var i=begin;i<end;i++){var val=arr[i];if(isFinite(val)){max=Math.max(val,max)}}return max};var mean=function mean(arr){var begin=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var end=arguments.length>2&&arguments[2]!==undefined?arguments[2]:arr.length;var total=0;var n=0;for(var i=begin;i<end;i++){var val=arr[i];if(isFinite(val)){total+=val;n++}}return total/n};var median=function median(arr){var begin=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var end=arguments.length>2&&arguments[2]!==undefined?arguments[2]:arr.length;var copy=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var sort=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var includeHoles=arguments.length>5&&arguments[5]!==undefined?arguments[5]:true;if(copy){arr=arr.slice(begin,end)}else{if(end<arr.length){arr.splice(end,arr.length-end)}if(begin>0){arr.splice(0,begin)}}var off=0;for(var i=arr.length-1;i>=0;i--){var v=arr[i];if(includeHoles){if(!isFinite(v)){arr[i]=-Infinity;off++}}else{arr.splice(i,1)}}if(sort){arr.sort((function(a,b){return a-b}))}var len=arr.length;var mid=Math.floor(len/2);if(len%2!==0){return arr[mid+1+off]}else{return(arr[mid-1+off]+arr[mid+off])/2}};var deg2rad=function deg2rad(deg){return Math.PI*deg/180};var getAngleFromDisp=function getAngleFromDisp(dispX,dispY){return Math.atan2(dispY,dispX)-Math.PI/2};var log2=Math.log2||function(n){return Math.log(n)/Math.log(2)};var signum=function signum(x){if(x>0){return 1}else if(x<0){return-1}else{return 0}};var dist=function dist(p1,p2){return Math.sqrt(sqdist(p1,p2))};var sqdist=function sqdist(p1,p2){var dx=p2.x-p1.x;var dy=p2.y-p1.y;return dx*dx+dy*dy};var inPlaceSumNormalize=function inPlaceSumNormalize(v){var length=v.length;var total=0;for(var i=0;i<length;i++){total+=v[i]}for(var _i=0;_i<length;_i++){v[_i]=v[_i]/total}return v};var qbezierAt=function qbezierAt(p0,p1,p2,t){return(1-t)*(1-t)*p0+2*(1-t)*t*p1+t*t*p2};var qbezierPtAt=function qbezierPtAt(p0,p1,p2,t){return{x:qbezierAt(p0.x,p1.x,p2.x,t),y:qbezierAt(p0.y,p1.y,p2.y,t)}};var lineAt=function lineAt(p0,p1,t,d){var vec={x:p1.x-p0.x,y:p1.y-p0.y};var vecDist=dist(p0,p1);var normVec={x:vec.x/vecDist,y:vec.y/vecDist};t=t==null?0:t;d=d!=null?d:t*vecDist;return{x:p0.x+normVec.x*d,y:p0.y+normVec.y*d}};var bound=function bound(min,val,max){return Math.max(min,Math.min(max,val))};var makeBoundingBox=function makeBoundingBox(bb){if(bb==null){return{x1:Infinity,y1:Infinity,x2:-Infinity,y2:-Infinity,w:0,h:0}}else if(bb.x1!=null&&bb.y1!=null){if(bb.x2!=null&&bb.y2!=null&&bb.x2>=bb.x1&&bb.y2>=bb.y1){return{x1:bb.x1,y1:bb.y1,x2:bb.x2,y2:bb.y2,w:bb.x2-bb.x1,h:bb.y2-bb.y1}}else if(bb.w!=null&&bb.h!=null&&bb.w>=0&&bb.h>=0){return{x1:bb.x1,y1:bb.y1,x2:bb.x1+bb.w,y2:bb.y1+bb.h,w:bb.w,h:bb.h}}}};var copyBoundingBox=function copyBoundingBox(bb){return{x1:bb.x1,x2:bb.x2,w:bb.w,y1:bb.y1,y2:bb.y2,h:bb.h}};var clearBoundingBox=function clearBoundingBox(bb){bb.x1=Infinity;bb.y1=Infinity;bb.x2=-Infinity;bb.y2=-Infinity;bb.w=0;bb.h=0};var updateBoundingBox=function updateBoundingBox(bb1,bb2){bb1.x1=Math.min(bb1.x1,bb2.x1);bb1.x2=Math.max(bb1.x2,bb2.x2);bb1.w=bb1.x2-bb1.x1;bb1.y1=Math.min(bb1.y1,bb2.y1);bb1.y2=Math.max(bb1.y2,bb2.y2);bb1.h=bb1.y2-bb1.y1};var expandBoundingBoxByPoint=function expandBoundingBoxByPoint(bb,x,y){bb.x1=Math.min(bb.x1,x);bb.x2=Math.max(bb.x2,x);bb.w=bb.x2-bb.x1;bb.y1=Math.min(bb.y1,y);bb.y2=Math.max(bb.y2,y);bb.h=bb.y2-bb.y1};var expandBoundingBox=function expandBoundingBox(bb){var padding=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;bb.x1-=padding;bb.x2+=padding;bb.y1-=padding;bb.y2+=padding;bb.w=bb.x2-bb.x1;bb.h=bb.y2-bb.y1;return bb};var expandBoundingBoxSides=function expandBoundingBoxSides(bb){var padding=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[0];var top,right,bottom,left;if(padding.length===1){top=right=bottom=left=padding[0]}else if(padding.length===2){top=bottom=padding[0];left=right=padding[1]}else if(padding.length===4){var _padding=_slicedToArray(padding,4);top=_padding[0];right=_padding[1];bottom=_padding[2];left=_padding[3]}bb.x1-=left;bb.x2+=right;bb.y1-=top;bb.y2+=bottom;bb.w=bb.x2-bb.x1;bb.h=bb.y2-bb.y1;return bb};var assignBoundingBox=function assignBoundingBox(bb1,bb2){bb1.x1=bb2.x1;bb1.y1=bb2.y1;bb1.x2=bb2.x2;bb1.y2=bb2.y2;bb1.w=bb1.x2-bb1.x1;bb1.h=bb1.y2-bb1.y1};var assignShiftToBoundingBox=function assignShiftToBoundingBox(bb,delta){bb.x1+=delta.x;bb.x2+=delta.x;bb.y1+=delta.y;bb.y2+=delta.y};var boundingBoxesIntersect=function boundingBoxesIntersect(bb1,bb2){if(bb1.x1>bb2.x2){return false}if(bb2.x1>bb1.x2){return false}if(bb1.x2<bb2.x1){return false}if(bb2.x2<bb1.x1){return false}if(bb1.y2<bb2.y1){return false}if(bb2.y2<bb1.y1){return false}if(bb1.y1>bb2.y2){return false}if(bb2.y1>bb1.y2){return false}return true};var inBoundingBox=function inBoundingBox(bb,x,y){return bb.x1<=x&&x<=bb.x2&&bb.y1<=y&&y<=bb.y2};var pointInBoundingBox=function pointInBoundingBox(bb,pt){return inBoundingBox(bb,pt.x,pt.y)};var boundingBoxInBoundingBox=function boundingBoxInBoundingBox(bb1,bb2){return inBoundingBox(bb1,bb2.x1,bb2.y1)&&inBoundingBox(bb1,bb2.x2,bb2.y2)};var roundRectangleIntersectLine=function roundRectangleIntersectLine(x,y,nodeX,nodeY,width,height,padding){var cornerRadius=getRoundRectangleRadius(width,height);var halfWidth=width/2;var halfHeight=height/2;var straightLineIntersections;{var topStartX=nodeX-halfWidth+cornerRadius-padding;var topStartY=nodeY-halfHeight-padding;var topEndX=nodeX+halfWidth-cornerRadius+padding;var topEndY=topStartY;straightLineIntersections=finiteLinesIntersect(x,y,nodeX,nodeY,topStartX,topStartY,topEndX,topEndY,false);if(straightLineIntersections.length>0){return straightLineIntersections}}{var rightStartX=nodeX+halfWidth+padding;var rightStartY=nodeY-halfHeight+cornerRadius-padding;var rightEndX=rightStartX;var rightEndY=nodeY+halfHeight-cornerRadius+padding;straightLineIntersections=finiteLinesIntersect(x,y,nodeX,nodeY,rightStartX,rightStartY,rightEndX,rightEndY,false);if(straightLineIntersections.length>0){return straightLineIntersections}}{var bottomStartX=nodeX-halfWidth+cornerRadius-padding;var bottomStartY=nodeY+halfHeight+padding;var bottomEndX=nodeX+halfWidth-cornerRadius+padding;var bottomEndY=bottomStartY;straightLineIntersections=finiteLinesIntersect(x,y,nodeX,nodeY,bottomStartX,bottomStartY,bottomEndX,bottomEndY,false);if(straightLineIntersections.length>0){return straightLineIntersections}}{var leftStartX=nodeX-halfWidth-padding;var leftStartY=nodeY-halfHeight+cornerRadius-padding;var leftEndX=leftStartX;var leftEndY=nodeY+halfHeight-cornerRadius+padding;straightLineIntersections=finiteLinesIntersect(x,y,nodeX,nodeY,leftStartX,leftStartY,leftEndX,leftEndY,false);if(straightLineIntersections.length>0){return straightLineIntersections}}var arcIntersections;{var topLeftCenterX=nodeX-halfWidth+cornerRadius;var topLeftCenterY=nodeY-halfHeight+cornerRadius;arcIntersections=intersectLineCircle(x,y,nodeX,nodeY,topLeftCenterX,topLeftCenterY,cornerRadius+padding);if(arcIntersections.length>0&&arcIntersections[0]<=topLeftCenterX&&arcIntersections[1]<=topLeftCenterY){return[arcIntersections[0],arcIntersections[1]]}}{var topRightCenterX=nodeX+halfWidth-cornerRadius;var topRightCenterY=nodeY-halfHeight+cornerRadius;arcIntersections=intersectLineCircle(x,y,nodeX,nodeY,topRightCenterX,topRightCenterY,cornerRadius+padding);if(arcIntersections.length>0&&arcIntersections[0]>=topRightCenterX&&arcIntersections[1]<=topRightCenterY){return[arcIntersections[0],arcIntersections[1]]}}{var bottomRightCenterX=nodeX+halfWidth-cornerRadius;var bottomRightCenterY=nodeY+halfHeight-cornerRadius;arcIntersections=intersectLineCircle(x,y,nodeX,nodeY,bottomRightCenterX,bottomRightCenterY,cornerRadius+padding);if(arcIntersections.length>0&&arcIntersections[0]>=bottomRightCenterX&&arcIntersections[1]>=bottomRightCenterY){return[arcIntersections[0],arcIntersections[1]]}}{var bottomLeftCenterX=nodeX-halfWidth+cornerRadius;var bottomLeftCenterY=nodeY+halfHeight-cornerRadius;arcIntersections=intersectLineCircle(x,y,nodeX,nodeY,bottomLeftCenterX,bottomLeftCenterY,cornerRadius+padding);if(arcIntersections.length>0&&arcIntersections[0]<=bottomLeftCenterX&&arcIntersections[1]>=bottomLeftCenterY){return[arcIntersections[0],arcIntersections[1]]}}return[]};var inLineVicinity=function inLineVicinity(x,y,lx1,ly1,lx2,ly2,tolerance){var t=tolerance;var x1=Math.min(lx1,lx2);var x2=Math.max(lx1,lx2);var y1=Math.min(ly1,ly2);var y2=Math.max(ly1,ly2);return x1-t<=x&&x<=x2+t&&y1-t<=y&&y<=y2+t};var inBezierVicinity=function inBezierVicinity(x,y,x1,y1,x2,y2,x3,y3,tolerance){var bb={x1:Math.min(x1,x3,x2)-tolerance,x2:Math.max(x1,x3,x2)+tolerance,y1:Math.min(y1,y3,y2)-tolerance,y2:Math.max(y1,y3,y2)+tolerance};if(x<bb.x1||x>bb.x2||y<bb.y1||y>bb.y2){return false}else{return true}};var solveQuadratic=function solveQuadratic(a,b,c,val){c-=val;var r=b*b-4*a*c;if(r<0){return[]}var sqrtR=Math.sqrt(r);var denom=2*a;var root1=(-b+sqrtR)/denom;var root2=(-b-sqrtR)/denom;return[root1,root2]};var solveCubic=function solveCubic(a,b,c,d,result){var epsilon=1e-5;if(a===0){a=epsilon}b/=a;c/=a;d/=a;var discriminant,q,r,dum1,s,t,term1,r13;q=(3*c-b*b)/9;r=-(27*d)+b*(9*c-2*(b*b));r/=54;discriminant=q*q*q+r*r;result[1]=0;term1=b/3;if(discriminant>0){s=r+Math.sqrt(discriminant);s=s<0?-Math.pow(-s,1/3):Math.pow(s,1/3);t=r-Math.sqrt(discriminant);t=t<0?-Math.pow(-t,1/3):Math.pow(t,1/3);result[0]=-term1+s+t;term1+=(s+t)/2;result[4]=result[2]=-term1;term1=Math.sqrt(3)*(-t+s)/2;result[3]=term1;result[5]=-term1;return}result[5]=result[3]=0;if(discriminant===0){r13=r<0?-Math.pow(-r,1/3):Math.pow(r,1/3);result[0]=-term1+2*r13;result[4]=result[2]=-(r13+term1);return}q=-q;dum1=q*q*q;dum1=Math.acos(r/Math.sqrt(dum1));r13=2*Math.sqrt(q);result[0]=-term1+r13*Math.cos(dum1/3);result[2]=-term1+r13*Math.cos((dum1+2*Math.PI)/3);result[4]=-term1+r13*Math.cos((dum1+4*Math.PI)/3);return};var sqdistToQuadraticBezier=function sqdistToQuadraticBezier(x,y,x1,y1,x2,y2,x3,y3){var a=1*x1*x1-4*x1*x2+2*x1*x3+4*x2*x2-4*x2*x3+x3*x3+y1*y1-4*y1*y2+2*y1*y3+4*y2*y2-4*y2*y3+y3*y3;var b=1*9*x1*x2-3*x1*x1-3*x1*x3-6*x2*x2+3*x2*x3+9*y1*y2-3*y1*y1-3*y1*y3-6*y2*y2+3*y2*y3;var c=1*3*x1*x1-6*x1*x2+x1*x3-x1*x+2*x2*x2+2*x2*x-x3*x+3*y1*y1-6*y1*y2+y1*y3-y1*y+2*y2*y2+2*y2*y-y3*y;var d=1*x1*x2-x1*x1+x1*x-x2*x+y1*y2-y1*y1+y1*y-y2*y;var roots=[];solveCubic(a,b,c,d,roots);var zeroThreshold=1e-7;var params=[];for(var index=0;index<6;index+=2){if(Math.abs(roots[index+1])<zeroThreshold&&roots[index]>=0&&roots[index]<=1){params.push(roots[index])}}params.push(1);params.push(0);var minDistanceSquared=-1;var curX,curY,distSquared;for(var i=0;i<params.length;i++){curX=Math.pow(1-params[i],2)*x1+2*(1-params[i])*params[i]*x2+params[i]*params[i]*x3;curY=Math.pow(1-params[i],2)*y1+2*(1-params[i])*params[i]*y2+params[i]*params[i]*y3;distSquared=Math.pow(curX-x,2)+Math.pow(curY-y,2);if(minDistanceSquared>=0){if(distSquared<minDistanceSquared){minDistanceSquared=distSquared}}else{minDistanceSquared=distSquared}}return minDistanceSquared};var sqdistToFiniteLine=function sqdistToFiniteLine(x,y,x1,y1,x2,y2){var offset=[x-x1,y-y1];var line=[x2-x1,y2-y1];var lineSq=line[0]*line[0]+line[1]*line[1];var hypSq=offset[0]*offset[0]+offset[1]*offset[1];var dotProduct=offset[0]*line[0]+offset[1]*line[1];var adjSq=dotProduct*dotProduct/lineSq;if(dotProduct<0){return hypSq}if(adjSq>lineSq){return(x-x2)*(x-x2)+(y-y2)*(y-y2)}return hypSq-adjSq};var pointInsidePolygonPoints=function pointInsidePolygonPoints(x,y,points){var x1,y1,x2,y2;var y3;var up=0;for(var i=0;i<points.length/2;i++){x1=points[i*2];y1=points[i*2+1];if(i+1<points.length/2){x2=points[(i+1)*2];y2=points[(i+1)*2+1]}else{x2=points[(i+1-points.length/2)*2];y2=points[(i+1-points.length/2)*2+1]}if(x1==x&&x2==x);else if(x1>=x&&x>=x2||x1<=x&&x<=x2){y3=(x-x1)/(x2-x1)*(y2-y1)+y1;if(y3>y){up++}}else{continue}}if(up%2===0){return false}else{return true}};var pointInsidePolygon=function pointInsidePolygon(x,y,basePoints,centerX,centerY,width,height,direction,padding){var transformedPoints=new Array(basePoints.length);var angle;if(direction[0]!=null){angle=Math.atan(direction[1]/direction[0]);if(direction[0]<0){angle=angle+Math.PI/2}else{angle=-angle-Math.PI/2}}else{angle=direction}var cos=Math.cos(-angle);var sin=Math.sin(-angle);for(var i=0;i<transformedPoints.length/2;i++){transformedPoints[i*2]=width/2*(basePoints[i*2]*cos-basePoints[i*2+1]*sin);transformedPoints[i*2+1]=height/2*(basePoints[i*2+1]*cos+basePoints[i*2]*sin);transformedPoints[i*2]+=centerX;transformedPoints[i*2+1]+=centerY}var points;if(padding>0){var expandedLineSet=expandPolygon(transformedPoints,-padding);points=joinLines(expandedLineSet)}else{points=transformedPoints}return pointInsidePolygonPoints(x,y,points)};var joinLines=function joinLines(lineSet){var vertices=new Array(lineSet.length/2);var currentLineStartX,currentLineStartY,currentLineEndX,currentLineEndY;var nextLineStartX,nextLineStartY,nextLineEndX,nextLineEndY;for(var i=0;i<lineSet.length/4;i++){currentLineStartX=lineSet[i*4];currentLineStartY=lineSet[i*4+1];currentLineEndX=lineSet[i*4+2];currentLineEndY=lineSet[i*4+3];if(i<lineSet.length/4-1){nextLineStartX=lineSet[(i+1)*4];nextLineStartY=lineSet[(i+1)*4+1];nextLineEndX=lineSet[(i+1)*4+2];nextLineEndY=lineSet[(i+1)*4+3]}else{nextLineStartX=lineSet[0];nextLineStartY=lineSet[1];nextLineEndX=lineSet[2];nextLineEndY=lineSet[3]}var intersection=finiteLinesIntersect(currentLineStartX,currentLineStartY,currentLineEndX,currentLineEndY,nextLineStartX,nextLineStartY,nextLineEndX,nextLineEndY,true);vertices[i*2]=intersection[0];vertices[i*2+1]=intersection[1]}return vertices};var expandPolygon=function expandPolygon(points,pad){var expandedLineSet=new Array(points.length*2);var currentPointX,currentPointY,nextPointX,nextPointY;for(var i=0;i<points.length/2;i++){currentPointX=points[i*2];currentPointY=points[i*2+1];if(i<points.length/2-1){nextPointX=points[(i+1)*2];nextPointY=points[(i+1)*2+1]}else{nextPointX=points[0];nextPointY=points[1]}var offsetX=nextPointY-currentPointY;var offsetY=-(nextPointX-currentPointX);var offsetLength=Math.sqrt(offsetX*offsetX+offsetY*offsetY);var normalizedOffsetX=offsetX/offsetLength;var normalizedOffsetY=offsetY/offsetLength;expandedLineSet[i*4]=currentPointX+normalizedOffsetX*pad;expandedLineSet[i*4+1]=currentPointY+normalizedOffsetY*pad;expandedLineSet[i*4+2]=nextPointX+normalizedOffsetX*pad;expandedLineSet[i*4+3]=nextPointY+normalizedOffsetY*pad}return expandedLineSet};var intersectLineEllipse=function intersectLineEllipse(x,y,centerX,centerY,ellipseWradius,ellipseHradius){var dispX=centerX-x;var dispY=centerY-y;dispX/=ellipseWradius;dispY/=ellipseHradius;var len=Math.sqrt(dispX*dispX+dispY*dispY);var newLength=len-1;if(newLength<0){return[]}var lenProportion=newLength/len;return[(centerX-x)*lenProportion+x,(centerY-y)*lenProportion+y]};var checkInEllipse=function checkInEllipse(x,y,width,height,centerX,centerY,padding){x-=centerX;y-=centerY;x/=width/2+padding;y/=height/2+padding;return x*x+y*y<=1};var intersectLineCircle=function intersectLineCircle(x1,y1,x2,y2,centerX,centerY,radius){var d=[x2-x1,y2-y1];var f=[x1-centerX,y1-centerY];var a=d[0]*d[0]+d[1]*d[1];var b=2*(f[0]*d[0]+f[1]*d[1]);var c=f[0]*f[0]+f[1]*f[1]-radius*radius;var discriminant=b*b-4*a*c;if(discriminant<0){return[]}var t1=(-b+Math.sqrt(discriminant))/(2*a);var t2=(-b-Math.sqrt(discriminant))/(2*a);var tMin=Math.min(t1,t2);var tMax=Math.max(t1,t2);var inRangeParams=[];if(tMin>=0&&tMin<=1){inRangeParams.push(tMin)}if(tMax>=0&&tMax<=1){inRangeParams.push(tMax)}if(inRangeParams.length===0){return[]}var nearIntersectionX=inRangeParams[0]*d[0]+x1;var nearIntersectionY=inRangeParams[0]*d[1]+y1;if(inRangeParams.length>1){if(inRangeParams[0]==inRangeParams[1]){return[nearIntersectionX,nearIntersectionY]}else{var farIntersectionX=inRangeParams[1]*d[0]+x1;var farIntersectionY=inRangeParams[1]*d[1]+y1;return[nearIntersectionX,nearIntersectionY,farIntersectionX,farIntersectionY]}}else{return[nearIntersectionX,nearIntersectionY]}};var midOfThree=function midOfThree(a,b,c){if(b<=a&&a<=c||c<=a&&a<=b){return a}else if(a<=b&&b<=c||c<=b&&b<=a){return b}else{return c}};var finiteLinesIntersect=function finiteLinesIntersect(x1,y1,x2,y2,x3,y3,x4,y4,infiniteLines){var dx13=x1-x3;var dx21=x2-x1;var dx43=x4-x3;var dy13=y1-y3;var dy21=y2-y1;var dy43=y4-y3;var ua_t=dx43*dy13-dy43*dx13;var ub_t=dx21*dy13-dy21*dx13;var u_b=dy43*dx21-dx43*dy21;if(u_b!==0){var ua=ua_t/u_b;var ub=ub_t/u_b;var flptThreshold=.001;var _min=0-flptThreshold;var _max=1+flptThreshold;if(_min<=ua&&ua<=_max&&_min<=ub&&ub<=_max){return[x1+ua*dx21,y1+ua*dy21]}else{if(!infiniteLines){return[]}else{return[x1+ua*dx21,y1+ua*dy21]}}}else{if(ua_t===0||ub_t===0){if(midOfThree(x1,x2,x4)===x4){return[x4,y4]}if(midOfThree(x1,x2,x3)===x3){return[x3,y3]}if(midOfThree(x3,x4,x2)===x2){return[x2,y2]}return[]}else{return[]}}};var polygonIntersectLine=function polygonIntersectLine(x,y,basePoints,centerX,centerY,width,height,padding){var intersections=[];var intersection;var transformedPoints=new Array(basePoints.length);var doTransform=true;if(width==null){doTransform=false}var points;if(doTransform){for(var i=0;i<transformedPoints.length/2;i++){transformedPoints[i*2]=basePoints[i*2]*width+centerX;transformedPoints[i*2+1]=basePoints[i*2+1]*height+centerY}if(padding>0){var expandedLineSet=expandPolygon(transformedPoints,-padding);points=joinLines(expandedLineSet)}else{points=transformedPoints}}else{points=basePoints}var currentX,currentY,nextX,nextY;for(var _i2=0;_i2<points.length/2;_i2++){currentX=points[_i2*2];currentY=points[_i2*2+1];if(_i2<points.length/2-1){nextX=points[(_i2+1)*2];nextY=points[(_i2+1)*2+1]}else{nextX=points[0];nextY=points[1]}intersection=finiteLinesIntersect(x,y,centerX,centerY,currentX,currentY,nextX,nextY);if(intersection.length!==0){intersections.push(intersection[0],intersection[1])}}return intersections};var shortenIntersection=function shortenIntersection(intersection,offset,amount){var disp=[intersection[0]-offset[0],intersection[1]-offset[1]];var length=Math.sqrt(disp[0]*disp[0]+disp[1]*disp[1]);var lenRatio=(length-amount)/length;if(lenRatio<0){lenRatio=1e-5}return[offset[0]+lenRatio*disp[0],offset[1]+lenRatio*disp[1]]};var generateUnitNgonPointsFitToSquare=function generateUnitNgonPointsFitToSquare(sides,rotationRadians){var points=generateUnitNgonPoints(sides,rotationRadians);points=fitPolygonToSquare(points);return points};var fitPolygonToSquare=function fitPolygonToSquare(points){var x,y;var sides=points.length/2;var minX=Infinity,minY=Infinity,maxX=-Infinity,maxY=-Infinity;for(var i=0;i<sides;i++){x=points[2*i];y=points[2*i+1];minX=Math.min(minX,x);maxX=Math.max(maxX,x);minY=Math.min(minY,y);maxY=Math.max(maxY,y)}var sx=2/(maxX-minX);var sy=2/(maxY-minY);for(var _i3=0;_i3<sides;_i3++){x=points[2*_i3]=points[2*_i3]*sx;y=points[2*_i3+1]=points[2*_i3+1]*sy;minX=Math.min(minX,x);maxX=Math.max(maxX,x);minY=Math.min(minY,y);maxY=Math.max(maxY,y)}if(minY<-1){for(var _i4=0;_i4<sides;_i4++){y=points[2*_i4+1]=points[2*_i4+1]+(-1-minY)}}return points};var generateUnitNgonPoints=function generateUnitNgonPoints(sides,rotationRadians){var increment=1/sides*2*Math.PI;var startAngle=sides%2===0?Math.PI/2+increment/2:Math.PI/2;startAngle+=rotationRadians;var points=new Array(sides*2);var currentAngle;for(var i=0;i<sides;i++){currentAngle=i*increment+startAngle;points[2*i]=Math.cos(currentAngle);points[2*i+1]=Math.sin(-currentAngle)}return points};var getRoundRectangleRadius=function getRoundRectangleRadius(width,height){return Math.min(width/4,height/4,8)};var getCutRectangleCornerLength=function getCutRectangleCornerLength(){return 8};var bezierPtsToQuadCoeff=function bezierPtsToQuadCoeff(p0,p1,p2){return[p0-2*p1+p2,2*(p1-p0),p0]};var getBarrelCurveConstants=function getBarrelCurveConstants(width,height){return{heightOffset:Math.min(15,.05*height),widthOffset:Math.min(100,.25*width),ctrlPtOffsetPct:.05}};var pageRankDefaults=defaults({dampingFactor:.8,precision:1e-6,iterations:200,weight:function weight(edge){return 1}});var elesfn$7={pageRank:function pageRank(options){var _pageRankDefaults=pageRankDefaults(options),dampingFactor=_pageRankDefaults.dampingFactor,precision=_pageRankDefaults.precision,iterations=_pageRankDefaults.iterations,weight=_pageRankDefaults.weight;var cy=this._private.cy;var _this$byGroup=this.byGroup(),nodes=_this$byGroup.nodes,edges=_this$byGroup.edges;var numNodes=nodes.length;var numNodesSqd=numNodes*numNodes;var numEdges=edges.length;var matrix=new Array(numNodesSqd);var columnSum=new Array(numNodes);var additionalProb=(1-dampingFactor)/numNodes;for(var i=0;i<numNodes;i++){for(var j=0;j<numNodes;j++){var n=i*numNodes+j;matrix[n]=0}columnSum[i]=0}for(var _i=0;_i<numEdges;_i++){var edge=edges[_i];var srcId=edge.data("source");var tgtId=edge.data("target");if(srcId===tgtId){continue}var s=nodes.indexOfId(srcId);var t=nodes.indexOfId(tgtId);var w=weight(edge);var _n=t*numNodes+s;matrix[_n]+=w;columnSum[s]+=w}var p=1/numNodes+additionalProb;for(var _j=0;_j<numNodes;_j++){if(columnSum[_j]===0){for(var _i2=0;_i2<numNodes;_i2++){var _n2=_i2*numNodes+_j;matrix[_n2]=p}}else{for(var _i3=0;_i3<numNodes;_i3++){var _n3=_i3*numNodes+_j;matrix[_n3]=matrix[_n3]/columnSum[_j]+additionalProb}}}var eigenvector=new Array(numNodes);var temp=new Array(numNodes);var previous;for(var _i4=0;_i4<numNodes;_i4++){eigenvector[_i4]=1}for(var iter=0;iter<iterations;iter++){for(var _i5=0;_i5<numNodes;_i5++){temp[_i5]=0}for(var _i6=0;_i6<numNodes;_i6++){for(var _j2=0;_j2<numNodes;_j2++){var _n4=_i6*numNodes+_j2;temp[_i6]+=matrix[_n4]*eigenvector[_j2]}}inPlaceSumNormalize(temp);previous=eigenvector;eigenvector=temp;temp=previous;var diff=0;for(var _i7=0;_i7<numNodes;_i7++){var delta=previous[_i7]-eigenvector[_i7];diff+=delta*delta}if(diff<precision){break}}var res={rank:function rank(node){node=cy.collection(node)[0];return eigenvector[nodes.indexOf(node)]}};return res}};var defaults$1=defaults({root:null,weight:function weight(edge){return 1},directed:false,alpha:0});var elesfn$8={degreeCentralityNormalized:function degreeCentralityNormalized(options){options=defaults$1(options);var cy=this.cy();var nodes=this.nodes();var numNodes=nodes.length;if(!options.directed){var degrees={};var maxDegree=0;for(var i=0;i<numNodes;i++){var node=nodes[i];options.root=node;var currDegree=this.degreeCentrality(options);if(maxDegree<currDegree.degree){maxDegree=currDegree.degree}degrees[node.id()]=currDegree.degree}return{degree:function degree(node){if(maxDegree===0){return 0}if(string(node)){node=cy.filter(node)}return degrees[node.id()]/maxDegree}}}else{var indegrees={};var outdegrees={};var maxIndegree=0;var maxOutdegree=0;for(var _i=0;_i<numNodes;_i++){var _node=nodes[_i];var id=_node.id();options.root=_node;var _currDegree=this.degreeCentrality(options);if(maxIndegree<_currDegree.indegree)maxIndegree=_currDegree.indegree;if(maxOutdegree<_currDegree.outdegree)maxOutdegree=_currDegree.outdegree;indegrees[id]=_currDegree.indegree;outdegrees[id]=_currDegree.outdegree}return{indegree:function indegree(node){if(maxIndegree==0){return 0}if(string(node)){node=cy.filter(node)}return indegrees[node.id()]/maxIndegree},outdegree:function outdegree(node){if(maxOutdegree===0){return 0}if(string(node)){node=cy.filter(node)}return outdegrees[node.id()]/maxOutdegree}}}},degreeCentrality:function degreeCentrality(options){options=defaults$1(options);var cy=this.cy();var callingEles=this;var _options=options,root=_options.root,weight=_options.weight,directed=_options.directed,alpha=_options.alpha;root=cy.collection(root)[0];if(!directed){var connEdges=root.connectedEdges().intersection(callingEles);var k=connEdges.length;var s=0;for(var i=0;i<connEdges.length;i++){s+=weight(connEdges[i])}return{degree:Math.pow(k,1-alpha)*Math.pow(s,alpha)}}else{var edges=root.connectedEdges();var incoming=edges.filter((function(edge){return edge.target().same(root)&&callingEles.has(edge)}));var outgoing=edges.filter((function(edge){return edge.source().same(root)&&callingEles.has(edge)}));var k_in=incoming.length;var k_out=outgoing.length;var s_in=0;var s_out=0;for(var _i2=0;_i2<incoming.length;_i2++){s_in+=weight(incoming[_i2])}for(var _i3=0;_i3<outgoing.length;_i3++){s_out+=weight(outgoing[_i3])}return{indegree:Math.pow(k_in,1-alpha)*Math.pow(s_in,alpha),outdegree:Math.pow(k_out,1-alpha)*Math.pow(s_out,alpha)}}}};elesfn$8.dc=elesfn$8.degreeCentrality;elesfn$8.dcn=elesfn$8.degreeCentralityNormalised=elesfn$8.degreeCentralityNormalized;var defaults$2=defaults({harmonic:true,weight:function weight(){return 1},directed:false,root:null});var elesfn$9={closenessCentralityNormalized:function closenessCentralityNormalized(options){var _defaults=defaults$2(options),harmonic=_defaults.harmonic,weight=_defaults.weight,directed=_defaults.directed;var cy=this.cy();var closenesses={};var maxCloseness=0;var nodes=this.nodes();var fw=this.floydWarshall({weight:weight,directed:directed});for(var i=0;i<nodes.length;i++){var currCloseness=0;var node_i=nodes[i];for(var j=0;j<nodes.length;j++){if(i!==j){var d=fw.distance(node_i,nodes[j]);if(harmonic){currCloseness+=1/d}else{currCloseness+=d}}}if(!harmonic){currCloseness=1/currCloseness}if(maxCloseness<currCloseness){maxCloseness=currCloseness}closenesses[node_i.id()]=currCloseness}return{closeness:function closeness(node){if(maxCloseness==0){return 0}if(string(node)){node=cy.filter(node)[0].id()}else{node=node.id()}return closenesses[node]/maxCloseness}}},closenessCentrality:function closenessCentrality(options){var _defaults2=defaults$2(options),root=_defaults2.root,weight=_defaults2.weight,directed=_defaults2.directed,harmonic=_defaults2.harmonic;root=this.filter(root)[0];var dijkstra=this.dijkstra({root:root,weight:weight,directed:directed});var totalDistance=0;var nodes=this.nodes();for(var i=0;i<nodes.length;i++){var n=nodes[i];if(!n.same(root)){var d=dijkstra.distanceTo(n);if(harmonic){totalDistance+=1/d}else{totalDistance+=d}}}return harmonic?totalDistance:1/totalDistance}};elesfn$9.cc=elesfn$9.closenessCentrality;elesfn$9.ccn=elesfn$9.closenessCentralityNormalised=elesfn$9.closenessCentralityNormalized;var defaults$3=defaults({weight:null,directed:false});var elesfn$a={betweennessCentrality:function betweennessCentrality(options){var _defaults=defaults$3(options),directed=_defaults.directed,weight=_defaults.weight;var weighted=weight!=null;var cy=this.cy();var V=this.nodes();var A={};var _C={};var max=0;var C={set:function set(key,val){_C[key]=val;if(val>max){max=val}},get:function get(key){return _C[key]}};for(var i=0;i<V.length;i++){var v=V[i];var vid=v.id();if(directed){A[vid]=v.outgoers().nodes()}else{A[vid]=v.openNeighborhood().nodes()}C.set(vid,0)}var _loop=function _loop(s){var sid=V[s].id();var S=[];var P={};var g={};var d={};var Q=new Heap((function(a,b){return d[a]-d[b]}));for(var _i=0;_i<V.length;_i++){var _vid=V[_i].id();P[_vid]=[];g[_vid]=0;d[_vid]=Infinity}g[sid]=1;d[sid]=0;Q.push(sid);while(!Q.empty()){var _v=Q.pop();S.push(_v);if(weighted){for(var j=0;j<A[_v].length;j++){var w=A[_v][j];var vEle=cy.getElementById(_v);var edge=void 0;if(vEle.edgesTo(w).length>0){edge=vEle.edgesTo(w)[0]}else{edge=w.edgesTo(vEle)[0]}var edgeWeight=weight(edge);w=w.id();if(d[w]>d[_v]+edgeWeight){d[w]=d[_v]+edgeWeight;if(Q.nodes.indexOf(w)<0){Q.push(w)}else{Q.updateItem(w)}g[w]=0;P[w]=[]}if(d[w]==d[_v]+edgeWeight){g[w]=g[w]+g[_v];P[w].push(_v)}}}else{for(var _j=0;_j<A[_v].length;_j++){var _w=A[_v][_j].id();if(d[_w]==Infinity){Q.push(_w);d[_w]=d[_v]+1}if(d[_w]==d[_v]+1){g[_w]=g[_w]+g[_v];P[_w].push(_v)}}}}var e={};for(var _i2=0;_i2<V.length;_i2++){e[V[_i2].id()]=0}while(S.length>0){var _w2=S.pop();for(var _j2=0;_j2<P[_w2].length;_j2++){var _v2=P[_w2][_j2];e[_v2]=e[_v2]+g[_v2]/g[_w2]*(1+e[_w2]);if(_w2!=V[s].id()){C.set(_w2,C.get(_w2)+e[_w2])}}}};for(var s=0;s<V.length;s++){_loop(s)}var ret={betweenness:function betweenness(node){var id=cy.collection(node).id();return C.get(id)},betweennessNormalized:function betweennessNormalized(node){if(max==0){return 0}var id=cy.collection(node).id();return C.get(id)/max}};ret.betweennessNormalised=ret.betweennessNormalized;return ret}};elesfn$a.bc=elesfn$a.betweennessCentrality;var defaults$4=defaults({expandFactor:2,inflateFactor:2,multFactor:1,maxIterations:20,attributes:[function(edge){return 1}]});var setOptions=function setOptions(options){return defaults$4(options)};var getSimilarity=function getSimilarity(edge,attributes){var total=0;for(var i=0;i<attributes.length;i++){total+=attributes[i](edge)}return total};var addLoops=function addLoops(M,n,val){for(var i=0;i<n;i++){M[i*n+i]=val}};var normalize=function normalize(M,n){var sum;for(var col=0;col<n;col++){sum=0;for(var row=0;row<n;row++){sum+=M[row*n+col]}for(var _row=0;_row<n;_row++){M[_row*n+col]=M[_row*n+col]/sum}}};var mmult=function mmult(A,B,n){var C=new Array(n*n);for(var i=0;i<n;i++){for(var j=0;j<n;j++){C[i*n+j]=0}for(var k=0;k<n;k++){for(var _j=0;_j<n;_j++){C[i*n+_j]+=A[i*n+k]*B[k*n+_j]}}}return C};var expand=function expand(M,n,expandFactor){var _M=M.slice(0);for(var p=1;p<expandFactor;p++){M=mmult(M,_M,n)}return M};var inflate=function inflate(M,n,inflateFactor){var _M=new Array(n*n);for(var i=0;i<n*n;i++){_M[i]=Math.pow(M[i],inflateFactor)}normalize(_M,n);return _M};var hasConverged=function hasConverged(M,_M,n2,roundFactor){for(var i=0;i<n2;i++){var v1=Math.round(M[i]*Math.pow(10,roundFactor))/Math.pow(10,roundFactor);var v2=Math.round(_M[i]*Math.pow(10,roundFactor))/Math.pow(10,roundFactor);if(v1!==v2){return false}}return true};var assign=function assign(M,n,nodes,cy){var clusters=[];for(var i=0;i<n;i++){var cluster=[];for(var j=0;j<n;j++){if(Math.round(M[i*n+j]*1e3)/1e3>0){cluster.push(nodes[j])}}if(cluster.length!==0){clusters.push(cy.collection(cluster))}}return clusters};var isDuplicate=function isDuplicate(c1,c2){for(var i=0;i<c1.length;i++){if(!c2[i]||c1[i].id()!==c2[i].id()){return false}}return true};var removeDuplicates=function removeDuplicates(clusters){for(var i=0;i<clusters.length;i++){for(var j=0;j<clusters.length;j++){if(i!=j&&isDuplicate(clusters[i],clusters[j])){clusters.splice(j,1)}}}return clusters};var markovClustering=function markovClustering(options){var nodes=this.nodes();var edges=this.edges();var cy=this.cy();var opts=setOptions(options);var id2position={};for(var i=0;i<nodes.length;i++){id2position[nodes[i].id()]=i}var n=nodes.length,n2=n*n;var M=new Array(n2),_M;for(var _i=0;_i<n2;_i++){M[_i]=0}for(var e=0;e<edges.length;e++){var edge=edges[e];var _i2=id2position[edge.source().id()];var j=id2position[edge.target().id()];var sim=getSimilarity(edge,opts.attributes);M[_i2*n+j]+=sim;M[j*n+_i2]+=sim}addLoops(M,n,opts.multFactor);normalize(M,n);var isStillMoving=true;var iterations=0;while(isStillMoving&&iterations<opts.maxIterations){isStillMoving=false;_M=expand(M,n,opts.expandFactor);M=inflate(_M,n,opts.inflateFactor);if(!hasConverged(M,_M,n2,4)){isStillMoving=true}iterations++}var clusters=assign(M,n,nodes,cy);clusters=removeDuplicates(clusters);return clusters};var markovClustering$1={markovClustering:markovClustering,mcl:markovClustering};var identity=function identity(x){return x};var absDiff=function absDiff(p,q){return Math.abs(q-p)};var addAbsDiff=function addAbsDiff(total,p,q){return total+absDiff(p,q)};var addSquaredDiff=function addSquaredDiff(total,p,q){return total+Math.pow(q-p,2)};var sqrt=function sqrt(x){return Math.sqrt(x)};var maxAbsDiff=function maxAbsDiff(currentMax,p,q){return Math.max(currentMax,absDiff(p,q))};var getDistance=function getDistance(length,getP,getQ,init,visit){var post=arguments.length>5&&arguments[5]!==undefined?arguments[5]:identity;var ret=init;var p,q;for(var dim=0;dim<length;dim++){p=getP(dim);q=getQ(dim);ret=visit(ret,p,q)}return post(ret)};var distances={euclidean:function euclidean(length,getP,getQ){if(length>=2){return getDistance(length,getP,getQ,0,addSquaredDiff,sqrt)}else{return getDistance(length,getP,getQ,0,addAbsDiff)}},squaredEuclidean:function squaredEuclidean(length,getP,getQ){return getDistance(length,getP,getQ,0,addSquaredDiff)},manhattan:function manhattan(length,getP,getQ){return getDistance(length,getP,getQ,0,addAbsDiff)},max:function max(length,getP,getQ){return getDistance(length,getP,getQ,-Infinity,maxAbsDiff)}};distances["squared-euclidean"]=distances["squaredEuclidean"];distances["squaredeuclidean"]=distances["squaredEuclidean"];function clusteringDistance(method,length,getP,getQ,nodeP,nodeQ){var impl;if(fn(method)){impl=method}else{impl=distances[method]||distances.euclidean}if(length===0&&fn(method)){return impl(nodeP,nodeQ)}else{return impl(length,getP,getQ,nodeP,nodeQ)}}var defaults$5=defaults({k:2,m:2,sensitivityThreshold:1e-4,distance:"euclidean",maxIterations:10,attributes:[],testMode:false,testCentroids:null});var setOptions$1=function setOptions(options){return defaults$5(options)};var getDist=function getDist(type,node,centroid,attributes,mode){var noNodeP=mode!=="kMedoids";var getP=noNodeP?function(i){return centroid[i]}:function(i){return attributes[i](centroid)};var getQ=function getQ(i){return attributes[i](node)};var nodeP=centroid;var nodeQ=node;return clusteringDistance(type,attributes.length,getP,getQ,nodeP,nodeQ)};var randomCentroids=function randomCentroids(nodes,k,attributes){var ndim=attributes.length;var min=new Array(ndim);var max=new Array(ndim);var centroids=new Array(k);var centroid=null;for(var i=0;i<ndim;i++){min[i]=nodes.min(attributes[i]).value;max[i]=nodes.max(attributes[i]).value}for(var c=0;c<k;c++){centroid=[];for(var _i=0;_i<ndim;_i++){centroid[_i]=Math.random()*(max[_i]-min[_i])+min[_i]}centroids[c]=centroid}return centroids};var classify=function classify(node,centroids,distance,attributes,type){var min=Infinity;var index=0;for(var i=0;i<centroids.length;i++){var dist=getDist(distance,node,centroids[i],attributes,type);if(dist<min){min=dist;index=i}}return index};var buildCluster=function buildCluster(centroid,nodes,assignment){var cluster=[];var node=null;for(var n=0;n<nodes.length;n++){node=nodes[n];if(assignment[node.id()]===centroid){cluster.push(node)}}return cluster};var haveValuesConverged=function haveValuesConverged(v1,v2,sensitivityThreshold){return Math.abs(v2-v1)<=sensitivityThreshold};var haveMatricesConverged=function haveMatricesConverged(v1,v2,sensitivityThreshold){for(var i=0;i<v1.length;i++){for(var j=0;j<v1[i].length;j++){var diff=Math.abs(v1[i][j]-v2[i][j]);if(diff>sensitivityThreshold){return false}}}return true};var seenBefore=function seenBefore(node,medoids,n){for(var i=0;i<n;i++){if(node===medoids[i])return true}return false};var randomMedoids=function randomMedoids(nodes,k){var medoids=new Array(k);if(nodes.length<50){for(var i=0;i<k;i++){var node=nodes[Math.floor(Math.random()*nodes.length)];while(seenBefore(node,medoids,i)){node=nodes[Math.floor(Math.random()*nodes.length)]}medoids[i]=node}}else{for(var _i2=0;_i2<k;_i2++){medoids[_i2]=nodes[Math.floor(Math.random()*nodes.length)]}}return medoids};var findCost=function findCost(potentialNewMedoid,cluster,attributes){var cost=0;for(var n=0;n<cluster.length;n++){cost+=getDist("manhattan",cluster[n],potentialNewMedoid,attributes,"kMedoids")}return cost};var kMeans=function kMeans(options){var cy=this.cy();var nodes=this.nodes();var node=null;var opts=setOptions$1(options);var clusters=new Array(opts.k);var assignment={};var centroids;if(opts.testMode){if(typeof opts.testCentroids==="number"){centroids=randomCentroids(nodes,opts.k,opts.attributes)}else if(_typeof(opts.testCentroids)==="object"){centroids=opts.testCentroids}else{centroids=randomCentroids(nodes,opts.k,opts.attributes)}}else{centroids=randomCentroids(nodes,opts.k,opts.attributes)}var isStillMoving=true;var iterations=0;while(isStillMoving&&iterations<opts.maxIterations){for(var n=0;n<nodes.length;n++){node=nodes[n];assignment[node.id()]=classify(node,centroids,opts.distance,opts.attributes,"kMeans")}isStillMoving=false;for(var c=0;c<opts.k;c++){var cluster=buildCluster(c,nodes,assignment);if(cluster.length===0){continue}var ndim=opts.attributes.length;var centroid=centroids[c];var newCentroid=new Array(ndim);var sum=new Array(ndim);for(var d=0;d<ndim;d++){sum[d]=0;for(var i=0;i<cluster.length;i++){node=cluster[i];sum[d]+=opts.attributes[d](node)}newCentroid[d]=sum[d]/cluster.length;if(!haveValuesConverged(newCentroid[d],centroid[d],opts.sensitivityThreshold)){isStillMoving=true}}centroids[c]=newCentroid;clusters[c]=cy.collection(cluster)}iterations++}return clusters};var kMedoids=function kMedoids(options){var cy=this.cy();var nodes=this.nodes();var node=null;var opts=setOptions$1(options);var clusters=new Array(opts.k);var medoids;var assignment={};var curCost;var minCosts=new Array(opts.k);if(opts.testMode){if(typeof opts.testCentroids==="number");else if(_typeof(opts.testCentroids)==="object"){medoids=opts.testCentroids}else{medoids=randomMedoids(nodes,opts.k)}}else{medoids=randomMedoids(nodes,opts.k)}var isStillMoving=true;var iterations=0;while(isStillMoving&&iterations<opts.maxIterations){for(var n=0;n<nodes.length;n++){node=nodes[n];assignment[node.id()]=classify(node,medoids,opts.distance,opts.attributes,"kMedoids")}isStillMoving=false;for(var m=0;m<medoids.length;m++){var cluster=buildCluster(m,nodes,assignment);if(cluster.length===0){continue}minCosts[m]=findCost(medoids[m],cluster,opts.attributes);for(var _n=0;_n<cluster.length;_n++){curCost=findCost(cluster[_n],cluster,opts.attributes);if(curCost<minCosts[m]){minCosts[m]=curCost;medoids[m]=cluster[_n];isStillMoving=true}}clusters[m]=cy.collection(cluster)}iterations++}return clusters};var updateCentroids=function updateCentroids(centroids,nodes,U,weight,opts){var numerator,denominator;for(var n=0;n<nodes.length;n++){for(var c=0;c<centroids.length;c++){weight[n][c]=Math.pow(U[n][c],opts.m)}}for(var _c=0;_c<centroids.length;_c++){for(var dim=0;dim<opts.attributes.length;dim++){numerator=0;denominator=0;for(var _n2=0;_n2<nodes.length;_n2++){numerator+=weight[_n2][_c]*opts.attributes[dim](nodes[_n2]);denominator+=weight[_n2][_c]}centroids[_c][dim]=numerator/denominator}}};var updateMembership=function updateMembership(U,_U,centroids,nodes,opts){for(var i=0;i<U.length;i++){_U[i]=U[i].slice()}var sum,numerator,denominator;var pow=2/(opts.m-1);for(var c=0;c<centroids.length;c++){for(var n=0;n<nodes.length;n++){sum=0;for(var k=0;k<centroids.length;k++){numerator=getDist(opts.distance,nodes[n],centroids[c],opts.attributes,"cmeans");denominator=getDist(opts.distance,nodes[n],centroids[k],opts.attributes,"cmeans");sum+=Math.pow(numerator/denominator,pow)}U[n][c]=1/sum}}};var assign$1=function assign(nodes,U,opts,cy){var clusters=new Array(opts.k);for(var c=0;c<clusters.length;c++){clusters[c]=[]}var max;var index;for(var n=0;n<U.length;n++){max=-Infinity;index=-1;for(var _c2=0;_c2<U[0].length;_c2++){if(U[n][_c2]>max){max=U[n][_c2];index=_c2}}clusters[index].push(nodes[n])}for(var _c3=0;_c3<clusters.length;_c3++){clusters[_c3]=cy.collection(clusters[_c3])}return clusters};var fuzzyCMeans=function fuzzyCMeans(options){var cy=this.cy();var nodes=this.nodes();var opts=setOptions$1(options);var clusters;var centroids;var U;var _U;var weight;_U=new Array(nodes.length);for(var i=0;i<nodes.length;i++){_U[i]=new Array(opts.k)}U=new Array(nodes.length);for(var _i3=0;_i3<nodes.length;_i3++){U[_i3]=new Array(opts.k)}for(var _i4=0;_i4<nodes.length;_i4++){var total=0;for(var j=0;j<opts.k;j++){U[_i4][j]=Math.random();total+=U[_i4][j]}for(var _j=0;_j<opts.k;_j++){U[_i4][_j]=U[_i4][_j]/total}}centroids=new Array(opts.k);for(var _i5=0;_i5<opts.k;_i5++){centroids[_i5]=new Array(opts.attributes.length)}weight=new Array(nodes.length);for(var _i6=0;_i6<nodes.length;_i6++){weight[_i6]=new Array(opts.k)}var isStillMoving=true;var iterations=0;while(isStillMoving&&iterations<opts.maxIterations){isStillMoving=false;updateCentroids(centroids,nodes,U,weight,opts);updateMembership(U,_U,centroids,nodes,opts);if(!haveMatricesConverged(U,_U,opts.sensitivityThreshold)){isStillMoving=true}iterations++}clusters=assign$1(nodes,U,opts,cy);return{clusters:clusters,degreeOfMembership:U}};var kClustering={kMeans:kMeans,kMedoids:kMedoids,fuzzyCMeans:fuzzyCMeans,fcm:fuzzyCMeans};var defaults$6=defaults({distance:"euclidean",linkage:"min",mode:"threshold",threshold:Infinity,addDendrogram:false,dendrogramDepth:0,attributes:[]});var linkageAliases={single:"min",complete:"max"};var setOptions$2=function setOptions(options){var opts=defaults$6(options);var preferredAlias=linkageAliases[opts.linkage];if(preferredAlias!=null){opts.linkage=preferredAlias}return opts};var mergeClosest=function mergeClosest(clusters,index,dists,mins,opts){var minKey=0;var min=Infinity;var dist;var attrs=opts.attributes;var getDist=function getDist(n1,n2){return clusteringDistance(opts.distance,attrs.length,(function(i){return attrs[i](n1)}),(function(i){return attrs[i](n2)}),n1,n2)};for(var i=0;i<clusters.length;i++){var key=clusters[i].key;var _dist=dists[key][mins[key]];if(_dist<min){minKey=key;min=_dist}}if(opts.mode==="threshold"&&min>=opts.threshold||opts.mode==="dendrogram"&&clusters.length===1){return false}var c1=index[minKey];var c2=index[mins[minKey]];var merged;if(opts.mode==="dendrogram"){merged={left:c1,right:c2,key:c1.key}}else{merged={value:c1.value.concat(c2.value),key:c1.key}}clusters[c1.index]=merged;clusters.splice(c2.index,1);index[c1.key]=merged;for(var _i=0;_i<clusters.length;_i++){var cur=clusters[_i];if(c1.key===cur.key){dist=Infinity}else if(opts.linkage==="min"){dist=dists[c1.key][cur.key];if(dists[c1.key][cur.key]>dists[c2.key][cur.key]){dist=dists[c2.key][cur.key]}}else if(opts.linkage==="max"){dist=dists[c1.key][cur.key];if(dists[c1.key][cur.key]<dists[c2.key][cur.key]){dist=dists[c2.key][cur.key]}}else if(opts.linkage==="mean"){dist=(dists[c1.key][cur.key]*c1.size+dists[c2.key][cur.key]*c2.size)/(c1.size+c2.size)}else{if(opts.mode==="dendrogram")dist=getDist(cur.value,c1.value);else dist=getDist(cur.value[0],c1.value[0])}dists[c1.key][cur.key]=dists[cur.key][c1.key]=dist}for(var _i2=0;_i2<clusters.length;_i2++){var key1=clusters[_i2].key;if(mins[key1]===c1.key||mins[key1]===c2.key){var _min=key1;for(var j=0;j<clusters.length;j++){var key2=clusters[j].key;if(dists[key1][key2]<dists[key1][_min]){_min=key2}}mins[key1]=_min}clusters[_i2].index=_i2}c1.key=c2.key=c1.index=c2.index=null;return true};var getAllChildren=function getAllChildren(root,arr,cy){if(!root)return;if(root.value){arr.push(root.value)}else{if(root.left)getAllChildren(root.left,arr);if(root.right)getAllChildren(root.right,arr)}};var buildDendrogram=function buildDendrogram(root,cy){if(!root)return"";if(root.left&&root.right){var leftStr=buildDendrogram(root.left,cy);var rightStr=buildDendrogram(root.right,cy);var node=cy.add({group:"nodes",data:{id:leftStr+","+rightStr}});cy.add({group:"edges",data:{source:leftStr,target:node.id()}});cy.add({group:"edges",data:{source:rightStr,target:node.id()}});return node.id()}else if(root.value){return root.value.id()}};var buildClustersFromTree=function buildClustersFromTree(root,k,cy){if(!root)return[];var left=[],right=[],leaves=[];if(k===0){if(root.left)getAllChildren(root.left,left);if(root.right)getAllChildren(root.right,right);leaves=left.concat(right);return[cy.collection(leaves)]}else if(k===1){if(root.value){return[cy.collection(root.value)]}else{if(root.left)getAllChildren(root.left,left);if(root.right)getAllChildren(root.right,right);return[cy.collection(left),cy.collection(right)]}}else{if(root.value){return[cy.collection(root.value)]}else{if(root.left)left=buildClustersFromTree(root.left,k-1,cy);if(root.right)right=buildClustersFromTree(root.right,k-1,cy);return left.concat(right)}}};var hierarchicalClustering=function hierarchicalClustering(options){var cy=this.cy();var nodes=this.nodes();var opts=setOptions$2(options);var attrs=opts.attributes;var getDist=function getDist(n1,n2){return clusteringDistance(opts.distance,attrs.length,(function(i){return attrs[i](n1)}),(function(i){return attrs[i](n2)}),n1,n2)};var clusters=[];var dists=[];var mins=[];var index=[];for(var n=0;n<nodes.length;n++){var cluster={value:opts.mode==="dendrogram"?nodes[n]:[nodes[n]],key:n,index:n};clusters[n]=cluster;index[n]=cluster;dists[n]=[];mins[n]=0}for(var i=0;i<clusters.length;i++){for(var j=0;j<=i;j++){var dist=void 0;if(opts.mode==="dendrogram"){dist=i===j?Infinity:getDist(clusters[i].value,clusters[j].value)}else{dist=i===j?Infinity:getDist(clusters[i].value[0],clusters[j].value[0])}dists[i][j]=dist;dists[j][i]=dist;if(dist<dists[i][mins[i]]){mins[i]=j}}}var merged=mergeClosest(clusters,index,dists,mins,opts);while(merged){merged=mergeClosest(clusters,index,dists,mins,opts)}var retClusters;if(opts.mode==="dendrogram"){retClusters=buildClustersFromTree(clusters[0],opts.dendrogramDepth,cy);if(opts.addDendrogram)buildDendrogram(clusters[0],cy)}else{retClusters=new Array(clusters.length);clusters.forEach((function(cluster,i){cluster.key=cluster.index=null;retClusters[i]=cy.collection(cluster.value)}))}return retClusters};var hierarchicalClustering$1={hierarchicalClustering:hierarchicalClustering,hca:hierarchicalClustering};var defaults$7=defaults({distance:"euclidean",preference:"median",damping:.8,maxIterations:1e3,minIterations:100,attributes:[]});var setOptions$3=function setOptions(options){var dmp=options.damping;var pref=options.preference;if(!(.5<=dmp&&dmp<1)){error("Damping must range on [0.5, 1).  Got: ".concat(dmp))}var validPrefs=["median","mean","min","max"];if(!(validPrefs.some((function(v){return v===pref}))||number(pref))){error("Preference must be one of [".concat(validPrefs.map((function(p){return"'".concat(p,"'")})).join(", "),"] or a number.  Got: ").concat(pref))}return defaults$7(options)};var getSimilarity$1=function getSimilarity(type,n1,n2,attributes){var attr=function attr(n,i){return attributes[i](n)};return-clusteringDistance(type,attributes.length,(function(i){return attr(n1,i)}),(function(i){return attr(n2,i)}),n1,n2)};var getPreference=function getPreference(S,preference){var p=null;if(preference==="median"){p=median(S)}else if(preference==="mean"){p=mean(S)}else if(preference==="min"){p=min(S)}else if(preference==="max"){p=max(S)}else{p=preference}return p};var findExemplars=function findExemplars(n,R,A){var indices=[];for(var i=0;i<n;i++){if(R[i*n+i]+A[i*n+i]>0){indices.push(i)}}return indices};var assignClusters=function assignClusters(n,S,exemplars){var clusters=[];for(var i=0;i<n;i++){var index=-1;var max=-Infinity;for(var ei=0;ei<exemplars.length;ei++){var e=exemplars[ei];if(S[i*n+e]>max){index=e;max=S[i*n+e]}}if(index>0){clusters.push(index)}}for(var _ei=0;_ei<exemplars.length;_ei++){clusters[exemplars[_ei]]=exemplars[_ei]}return clusters};var assign$2=function assign(n,S,exemplars){var clusters=assignClusters(n,S,exemplars);for(var ei=0;ei<exemplars.length;ei++){var ii=[];for(var c=0;c<clusters.length;c++){if(clusters[c]===exemplars[ei]){ii.push(c)}}var maxI=-1;var maxSum=-Infinity;for(var i=0;i<ii.length;i++){var sum=0;for(var j=0;j<ii.length;j++){sum+=S[ii[j]*n+ii[i]]}if(sum>maxSum){maxI=i;maxSum=sum}}exemplars[ei]=ii[maxI]}clusters=assignClusters(n,S,exemplars);return clusters};var affinityPropagation=function affinityPropagation(options){var cy=this.cy();var nodes=this.nodes();var opts=setOptions$3(options);var id2position={};for(var i=0;i<nodes.length;i++){id2position[nodes[i].id()]=i}var n;var n2;var S;var p;var R;var A;n=nodes.length;n2=n*n;S=new Array(n2);for(var _i=0;_i<n2;_i++){S[_i]=-Infinity}for(var _i2=0;_i2<n;_i2++){for(var j=0;j<n;j++){if(_i2!==j){S[_i2*n+j]=getSimilarity$1(opts.distance,nodes[_i2],nodes[j],opts.attributes)}}}p=getPreference(S,opts.preference);for(var _i3=0;_i3<n;_i3++){S[_i3*n+_i3]=p}R=new Array(n2);for(var _i4=0;_i4<n2;_i4++){R[_i4]=0}A=new Array(n2);for(var _i5=0;_i5<n2;_i5++){A[_i5]=0}var old=new Array(n);var Rp=new Array(n);var se=new Array(n);for(var _i6=0;_i6<n;_i6++){old[_i6]=0;Rp[_i6]=0;se[_i6]=0}var e=new Array(n*opts.minIterations);for(var _i7=0;_i7<e.length;_i7++){e[_i7]=0}var iter;for(iter=0;iter<opts.maxIterations;iter++){for(var _i8=0;_i8<n;_i8++){var max=-Infinity,max2=-Infinity,maxI=-1,AS=0;for(var _j=0;_j<n;_j++){old[_j]=R[_i8*n+_j];AS=A[_i8*n+_j]+S[_i8*n+_j];if(AS>=max){max2=max;max=AS;maxI=_j}else if(AS>max2){max2=AS}}for(var _j2=0;_j2<n;_j2++){R[_i8*n+_j2]=(1-opts.damping)*(S[_i8*n+_j2]-max)+opts.damping*old[_j2]}R[_i8*n+maxI]=(1-opts.damping)*(S[_i8*n+maxI]-max2)+opts.damping*old[maxI]}for(var _i9=0;_i9<n;_i9++){var sum=0;for(var _j3=0;_j3<n;_j3++){old[_j3]=A[_j3*n+_i9];Rp[_j3]=Math.max(0,R[_j3*n+_i9]);sum+=Rp[_j3]}sum-=Rp[_i9];Rp[_i9]=R[_i9*n+_i9];sum+=Rp[_i9];for(var _j4=0;_j4<n;_j4++){A[_j4*n+_i9]=(1-opts.damping)*Math.min(0,sum-Rp[_j4])+opts.damping*old[_j4]}A[_i9*n+_i9]=(1-opts.damping)*(sum-Rp[_i9])+opts.damping*old[_i9]}var K=0;for(var _i10=0;_i10<n;_i10++){var E=A[_i10*n+_i10]+R[_i10*n+_i10]>0?1:0;e[iter%opts.minIterations*n+_i10]=E;K+=E}if(K>0&&(iter>=opts.minIterations-1||iter==opts.maxIterations-1)){var _sum=0;for(var _i11=0;_i11<n;_i11++){se[_i11]=0;for(var _j5=0;_j5<opts.minIterations;_j5++){se[_i11]+=e[_j5*n+_i11]}if(se[_i11]===0||se[_i11]===opts.minIterations){_sum++}}if(_sum===n){break}}}var exemplarsIndices=findExemplars(n,R,A);var clusterIndices=assign$2(n,S,exemplarsIndices);var clusters={};for(var c=0;c<exemplarsIndices.length;c++){clusters[exemplarsIndices[c]]=[]}for(var _i12=0;_i12<nodes.length;_i12++){var pos=id2position[nodes[_i12].id()];var clusterIndex=clusterIndices[pos];if(clusterIndex!=null){clusters[clusterIndex].push(nodes[_i12])}}var retClusters=new Array(exemplarsIndices.length);for(var _c=0;_c<exemplarsIndices.length;_c++){retClusters[_c]=cy.collection(clusters[exemplarsIndices[_c]])}return retClusters};var affinityPropagation$1={affinityPropagation:affinityPropagation,ap:affinityPropagation};var elesfn$b={};[elesfn,elesfn$1,elesfn$2,elesfn$3,elesfn$4,elesfn$5,elesfn$6,elesfn$7,elesfn$8,elesfn$9,elesfn$a,markovClustering$1,kClustering,hierarchicalClustering$1,affinityPropagation$1].forEach((function(props){extend(elesfn$b,props)}));
/*!
Embeddable Minimum Strictly-Compliant Promises/A+ 1.1.1 Thenable
Copyright (c) 2013-2014 Ralf S. Engelschall (http://engelschall.com)
Licensed under The MIT License (http://opensource.org/licenses/MIT)
*/var STATE_PENDING=0;var STATE_FULFILLED=1;var STATE_REJECTED=2;var api=function api(executor){if(!(this instanceof api))return new api(executor);this.id="Thenable/1.0.7";this.state=STATE_PENDING;this.fulfillValue=undefined;this.rejectReason=undefined;this.onFulfilled=[];this.onRejected=[];this.proxy={then:this.then.bind(this)};if(typeof executor==="function")executor.call(this,this.fulfill.bind(this),this.reject.bind(this))};api.prototype={fulfill:function fulfill(value){return deliver(this,STATE_FULFILLED,"fulfillValue",value)},reject:function reject(value){return deliver(this,STATE_REJECTED,"rejectReason",value)},then:function then(onFulfilled,onRejected){var curr=this;var next=new api;curr.onFulfilled.push(resolver(onFulfilled,next,"fulfill"));curr.onRejected.push(resolver(onRejected,next,"reject"));execute(curr);return next.proxy}};var deliver=function deliver(curr,state,name,value){if(curr.state===STATE_PENDING){curr.state=state;curr[name]=value;execute(curr)}return curr};var execute=function execute(curr){if(curr.state===STATE_FULFILLED)execute_handlers(curr,"onFulfilled",curr.fulfillValue);else if(curr.state===STATE_REJECTED)execute_handlers(curr,"onRejected",curr.rejectReason)};var execute_handlers=function execute_handlers(curr,name,value){if(curr[name].length===0)return;var handlers=curr[name];curr[name]=[];var func=function func(){for(var i=0;i<handlers.length;i++){handlers[i](value)}};if(typeof setImmediate==="function")setImmediate(func);else setTimeout(func,0)};var resolver=function resolver(cb,next,method){return function(value){if(typeof cb!=="function")next[method].call(next,value);else{var result;try{result=cb(value)}catch(e){next.reject(e);return}resolve(next,result)}}};var resolve=function resolve(promise,x){if(promise===x||promise.proxy===x){promise.reject(new TypeError("cannot resolve promise with itself"));return}var then;if(_typeof(x)==="object"&&x!==null||typeof x==="function"){try{then=x.then}catch(e){promise.reject(e);return}}if(typeof then==="function"){var resolved=false;try{then.call(x,(function(y){if(resolved)return;resolved=true;if(y===x)promise.reject(new TypeError("circular thenable chain"));else resolve(promise,y)}),(function(r){if(resolved)return;resolved=true;promise.reject(r)}))}catch(e){if(!resolved)promise.reject(e)}return}promise.fulfill(x)};api.all=function(ps){return new api((function(resolveAll,rejectAll){var vals=new Array(ps.length);var doneCount=0;var fulfill=function fulfill(i,val){vals[i]=val;doneCount++;if(doneCount===ps.length){resolveAll(vals)}};for(var i=0;i<ps.length;i++){(function(i){var p=ps[i];var isPromise=p!=null&&p.then!=null;if(isPromise){p.then((function(val){fulfill(i,val)}),(function(err){rejectAll(err)}))}else{var val=p;fulfill(i,val)}})(i)}}))};api.resolve=function(val){return new api((function(resolve,reject){resolve(val)}))};api.reject=function(val){return new api((function(resolve,reject){reject(val)}))};var Promise$1=typeof Promise!=="undefined"?Promise:api;var Animation=function Animation(target,opts,opts2){var isCore=core(target);var isEle=!isCore;var _p=this._private=extend({duration:1e3},opts,opts2);_p.target=target;_p.style=_p.style||_p.css;_p.started=false;_p.playing=false;_p.hooked=false;_p.applying=false;_p.progress=0;_p.completes=[];_p.frames=[];if(_p.complete&&fn(_p.complete)){_p.completes.push(_p.complete)}if(isEle){var pos=target.position();_p.startPosition=_p.startPosition||{x:pos.x,y:pos.y};_p.startStyle=_p.startStyle||target.cy().style().getAnimationStartStyle(target,_p.style)}if(isCore){var pan=target.pan();_p.startPan={x:pan.x,y:pan.y};_p.startZoom=target.zoom()}this.length=1;this[0]=this};var anifn=Animation.prototype;extend(anifn,{instanceString:function instanceString(){return"animation"},hook:function hook(){var _p=this._private;if(!_p.hooked){var q;var tAni=_p.target._private.animation;if(_p.queue){q=tAni.queue}else{q=tAni.current}q.push(this);if(elementOrCollection(_p.target)){_p.target.cy().addToAnimationPool(_p.target)}_p.hooked=true}return this},play:function play(){var _p=this._private;if(_p.progress===1){_p.progress=0}_p.playing=true;_p.started=false;_p.stopped=false;this.hook();return this},playing:function playing(){return this._private.playing},apply:function apply(){var _p=this._private;_p.applying=true;_p.started=false;_p.stopped=false;this.hook();return this},applying:function applying(){return this._private.applying},pause:function pause(){var _p=this._private;_p.playing=false;_p.started=false;return this},stop:function stop(){var _p=this._private;_p.playing=false;_p.started=false;_p.stopped=true;return this},rewind:function rewind(){return this.progress(0)},fastforward:function fastforward(){return this.progress(1)},time:function time(t){var _p=this._private;if(t===undefined){return _p.progress*_p.duration}else{return this.progress(t/_p.duration)}},progress:function progress(p){var _p=this._private;var wasPlaying=_p.playing;if(p===undefined){return _p.progress}else{if(wasPlaying){this.pause()}_p.progress=p;_p.started=false;if(wasPlaying){this.play()}}return this},completed:function completed(){return this._private.progress===1},reverse:function reverse(){var _p=this._private;var wasPlaying=_p.playing;if(wasPlaying){this.pause()}_p.progress=1-_p.progress;_p.started=false;var swap=function swap(a,b){var _pa=_p[a];if(_pa==null){return}_p[a]=_p[b];_p[b]=_pa};swap("zoom","startZoom");swap("pan","startPan");swap("position","startPosition");if(_p.style){for(var i=0;i<_p.style.length;i++){var prop=_p.style[i];var name=prop.name;var startStyleProp=_p.startStyle[name];_p.startStyle[name]=prop;_p.style[i]=startStyleProp}}if(wasPlaying){this.play()}return this},promise:function promise(type){var _p=this._private;var arr;switch(type){case"frame":arr=_p.frames;break;default:case"complete":case"completed":arr=_p.completes}return new Promise$1((function(resolve,reject){arr.push((function(){resolve()}))}))}});anifn.complete=anifn.completed;anifn.run=anifn.play;anifn.running=anifn.playing;var define={animated:function animated(){return function animatedImpl(){var self=this;var selfIsArrayLike=self.length!==undefined;var all=selfIsArrayLike?self:[self];var cy=this._private.cy||this;if(!cy.styleEnabled()){return false}var ele=all[0];if(ele){return ele._private.animation.current.length>0}}},clearQueue:function clearQueue(){return function clearQueueImpl(){var self=this;var selfIsArrayLike=self.length!==undefined;var all=selfIsArrayLike?self:[self];var cy=this._private.cy||this;if(!cy.styleEnabled()){return this}for(var i=0;i<all.length;i++){var ele=all[i];ele._private.animation.queue=[]}return this}},delay:function delay(){return function delayImpl(time,complete){var cy=this._private.cy||this;if(!cy.styleEnabled()){return this}return this.animate({delay:time,duration:time,complete:complete})}},delayAnimation:function delayAnimation(){return function delayAnimationImpl(time,complete){var cy=this._private.cy||this;if(!cy.styleEnabled()){return this}return this.animation({delay:time,duration:time,complete:complete})}},animation:function animation(){return function animationImpl(properties,params){var self=this;var selfIsArrayLike=self.length!==undefined;var all=selfIsArrayLike?self:[self];var cy=this._private.cy||this;var isCore=!selfIsArrayLike;var isEles=!isCore;if(!cy.styleEnabled()){return this}var style=cy.style();properties=extend({},properties,params);var propertiesEmpty=Object.keys(properties).length===0;if(propertiesEmpty){return new Animation(all[0],properties)}if(properties.duration===undefined){properties.duration=400}switch(properties.duration){case"slow":properties.duration=600;break;case"fast":properties.duration=200;break}if(isEles){properties.style=style.getPropsList(properties.style||properties.css);properties.css=undefined}if(isEles&&properties.renderedPosition!=null){var rpos=properties.renderedPosition;var pan=cy.pan();var zoom=cy.zoom();properties.position=renderedToModelPosition(rpos,zoom,pan)}if(isCore&&properties.panBy!=null){var panBy=properties.panBy;var cyPan=cy.pan();properties.pan={x:cyPan.x+panBy.x,y:cyPan.y+panBy.y}}var center=properties.center||properties.centre;if(isCore&&center!=null){var centerPan=cy.getCenterPan(center.eles,properties.zoom);if(centerPan!=null){properties.pan=centerPan}}if(isCore&&properties.fit!=null){var fit=properties.fit;var fitVp=cy.getFitViewport(fit.eles||fit.boundingBox,fit.padding);if(fitVp!=null){properties.pan=fitVp.pan;properties.zoom=fitVp.zoom}}if(isCore&&plainObject(properties.zoom)){var vp=cy.getZoomedViewport(properties.zoom);if(vp!=null){if(vp.zoomed){properties.zoom=vp.zoom}if(vp.panned){properties.pan=vp.pan}}}return new Animation(all[0],properties)}},animate:function animate(){return function animateImpl(properties,params){var self=this;var selfIsArrayLike=self.length!==undefined;var all=selfIsArrayLike?self:[self];var cy=this._private.cy||this;if(!cy.styleEnabled()){return this}if(params){properties=extend({},properties,params)}for(var i=0;i<all.length;i++){var ele=all[i];var queue=ele.animated()&&(properties.queue===undefined||properties.queue);var ani=ele.animation(properties,queue?{queue:true}:undefined);ani.play()}return this}},stop:function stop(){return function stopImpl(clearQueue,jumpToEnd){var self=this;var selfIsArrayLike=self.length!==undefined;var all=selfIsArrayLike?self:[self];var cy=this._private.cy||this;if(!cy.styleEnabled()){return this}for(var i=0;i<all.length;i++){var ele=all[i];var _p=ele._private;var anis=_p.animation.current;for(var j=0;j<anis.length;j++){var ani=anis[j];var ani_p=ani._private;if(jumpToEnd){ani_p.duration=0}}if(clearQueue){_p.animation.queue=[]}if(!jumpToEnd){_p.animation.current=[]}}cy.notify("draw");return this}}};var define$1={data:function data(params){var defaults={field:"data",bindingEvent:"data",allowBinding:false,allowSetting:false,allowGetting:false,settingEvent:"data",settingTriggersEvent:false,triggerFnName:"trigger",immutableKeys:{},updateStyle:false,beforeGet:function beforeGet(self){},beforeSet:function beforeSet(self,obj){},onSet:function onSet(self){},canSet:function canSet(self){return true}};params=extend({},defaults,params);return function dataImpl(name,value){var p=params;var self=this;var selfIsArrayLike=self.length!==undefined;var all=selfIsArrayLike?self:[self];var single=selfIsArrayLike?self[0]:self;if(string(name)){if(p.allowGetting&&value===undefined){var ret;if(single){p.beforeGet(single);ret=single._private[p.field][name]}return ret}else if(p.allowSetting&&value!==undefined){var valid=!p.immutableKeys[name];if(valid){var change=_defineProperty({},name,value);p.beforeSet(self,change);for(var i=0,l=all.length;i<l;i++){var ele=all[i];if(p.canSet(ele)){ele._private[p.field][name]=value}}if(p.updateStyle){self.updateStyle()}p.onSet(self);if(p.settingTriggersEvent){self[p.triggerFnName](p.settingEvent)}}}}else if(p.allowSetting&&plainObject(name)){var obj=name;var k,v;var keys=Object.keys(obj);p.beforeSet(self,obj);for(var _i=0;_i<keys.length;_i++){k=keys[_i];v=obj[k];var _valid=!p.immutableKeys[k];if(_valid){for(var j=0;j<all.length;j++){var _ele=all[j];if(p.canSet(_ele)){_ele._private[p.field][k]=v}}}}if(p.updateStyle){self.updateStyle()}p.onSet(self);if(p.settingTriggersEvent){self[p.triggerFnName](p.settingEvent)}}else if(p.allowBinding&&fn(name)){var fn$1=name;self.on(p.bindingEvent,fn$1)}else if(p.allowGetting&&name===undefined){var _ret;if(single){p.beforeGet(single);_ret=single._private[p.field]}return _ret}return self}},removeData:function removeData(params){var defaults={field:"data",event:"data",triggerFnName:"trigger",triggerEvent:false,immutableKeys:{}};params=extend({},defaults,params);return function removeDataImpl(names){var p=params;var self=this;var selfIsArrayLike=self.length!==undefined;var all=selfIsArrayLike?self:[self];if(string(names)){var keys=names.split(/\s+/);var l=keys.length;for(var i=0;i<l;i++){var key=keys[i];if(emptyString(key)){continue}var valid=!p.immutableKeys[key];if(valid){for(var i_a=0,l_a=all.length;i_a<l_a;i_a++){all[i_a]._private[p.field][key]=undefined}}}if(p.triggerEvent){self[p.triggerFnName](p.event)}}else if(names===undefined){for(var _i_a=0,_l_a=all.length;_i_a<_l_a;_i_a++){var _privateFields=all[_i_a]._private[p.field];var _keys=Object.keys(_privateFields);for(var _i2=0;_i2<_keys.length;_i2++){var _key=_keys[_i2];var validKeyToDelete=!p.immutableKeys[_key];if(validKeyToDelete){_privateFields[_key]=undefined}}}if(p.triggerEvent){self[p.triggerFnName](p.event)}}return self}}};var define$2={eventAliasesOn:function eventAliasesOn(proto){var p=proto;p.addListener=p.listen=p.bind=p.on;p.unlisten=p.unbind=p.off=p.removeListener;p.trigger=p.emit;p.pon=p.promiseOn=function(events,selector){var self=this;var args=Array.prototype.slice.call(arguments,0);return new Promise$1((function(resolve,reject){var callback=function callback(e){self.off.apply(self,offArgs);resolve(e)};var onArgs=args.concat([callback]);var offArgs=onArgs.concat([]);self.on.apply(self,onArgs)}))}}};var define$3={};[define,define$1,define$2].forEach((function(m){extend(define$3,m)}));var elesfn$c={animate:define$3.animate(),animation:define$3.animation(),animated:define$3.animated(),clearQueue:define$3.clearQueue(),delay:define$3.delay(),delayAnimation:define$3.delayAnimation(),stop:define$3.stop()};var elesfn$d={classes:function classes(_classes){var self=this;if(_classes===undefined){var ret=[];self[0]._private.classes.forEach((function(cls){return ret.push(cls)}));return ret}else if(!array(_classes)){_classes=(_classes||"").match(/\S+/g)||[]}var changed=[];var classesSet=new Set$1(_classes);for(var j=0;j<self.length;j++){var ele=self[j];var _p=ele._private;var eleClasses=_p.classes;var changedEle=false;for(var i=0;i<_classes.length;i++){var cls=_classes[i];var eleHasClass=eleClasses.has(cls);if(!eleHasClass){changedEle=true;break}}if(!changedEle){changedEle=eleClasses.size!==_classes.length}if(changedEle){_p.classes=classesSet;changed.push(ele)}}if(changed.length>0){this.spawn(changed).updateStyle().emit("class")}return self},addClass:function addClass(classes){return this.toggleClass(classes,true)},hasClass:function hasClass(className){var ele=this[0];return ele!=null&&ele._private.classes.has(className)},toggleClass:function toggleClass(classes,toggle){if(!array(classes)){classes=classes.match(/\S+/g)||[]}var self=this;var toggleUndefd=toggle===undefined;var changed=[];for(var i=0,il=self.length;i<il;i++){var ele=self[i];var eleClasses=ele._private.classes;var changedEle=false;for(var j=0;j<classes.length;j++){var cls=classes[j];var hasClass=eleClasses.has(cls);var changedNow=false;if(toggle||toggleUndefd&&!hasClass){eleClasses.add(cls);changedNow=true}else if(!toggle||toggleUndefd&&hasClass){eleClasses["delete"](cls);changedNow=true}if(!changedEle&&changedNow){changed.push(ele);changedEle=true}}}if(changed.length>0){this.spawn(changed).updateStyle().emit("class")}return self},removeClass:function removeClass(classes){return this.toggleClass(classes,false)},flashClass:function flashClass(classes,duration){var self=this;if(duration==null){duration=250}else if(duration===0){return self}self.addClass(classes);setTimeout((function(){self.removeClass(classes)}),duration);return self}};elesfn$d.className=elesfn$d.classNames=elesfn$d.classes;var tokens={metaChar:"[\\!\\\"\\#\\$\\%\\&\\'\\(\\)\\*\\+\\,\\.\\/\\:\\;\\<\\=\\>\\?\\@\\[\\]\\^\\`\\{\\|\\}\\~]",comparatorOp:"=|\\!=|>|>=|<|<=|\\$=|\\^=|\\*=",boolOp:"\\?|\\!|\\^",string:'"(?:\\\\"|[^"])*"'+"|"+"'(?:\\\\'|[^'])*'",number:number$1,meta:"degree|indegree|outdegree",separator:"\\s*,\\s*",descendant:"\\s+",child:"\\s+>\\s+",subject:"\\$",group:"node|edge|\\*",directedEdge:"\\s+->\\s+",undirectedEdge:"\\s+<->\\s+"};tokens.variable="(?:[\\w-]|(?:\\\\"+tokens.metaChar+"))+";tokens.value=tokens.string+"|"+tokens.number;tokens.className=tokens.variable;tokens.id=tokens.variable;(function(){var ops,op,i;ops=tokens.comparatorOp.split("|");for(i=0;i<ops.length;i++){op=ops[i];tokens.comparatorOp+="|@"+op}ops=tokens.comparatorOp.split("|");for(i=0;i<ops.length;i++){op=ops[i];if(op.indexOf("!")>=0){continue}if(op==="="){continue}tokens.comparatorOp+="|\\!"+op}})();var newQuery=function newQuery(){return{checks:[]}};var Type={GROUP:0,COLLECTION:1,FILTER:2,DATA_COMPARE:3,DATA_EXIST:4,DATA_BOOL:5,META_COMPARE:6,STATE:7,ID:8,CLASS:9,UNDIRECTED_EDGE:10,DIRECTED_EDGE:11,NODE_SOURCE:12,NODE_TARGET:13,NODE_NEIGHBOR:14,CHILD:15,DESCENDANT:16,PARENT:17,ANCESTOR:18,COMPOUND_SPLIT:19,TRUE:20};var stateSelectors=[{selector:":selected",matches:function matches(ele){return ele.selected()}},{selector:":unselected",matches:function matches(ele){return!ele.selected()}},{selector:":selectable",matches:function matches(ele){return ele.selectable()}},{selector:":unselectable",matches:function matches(ele){return!ele.selectable()}},{selector:":locked",matches:function matches(ele){return ele.locked()}},{selector:":unlocked",matches:function matches(ele){return!ele.locked()}},{selector:":visible",matches:function matches(ele){return ele.visible()}},{selector:":hidden",matches:function matches(ele){return!ele.visible()}},{selector:":transparent",matches:function matches(ele){return ele.transparent()}},{selector:":grabbed",matches:function matches(ele){return ele.grabbed()}},{selector:":free",matches:function matches(ele){return!ele.grabbed()}},{selector:":removed",matches:function matches(ele){return ele.removed()}},{selector:":inside",matches:function matches(ele){return!ele.removed()}},{selector:":grabbable",matches:function matches(ele){return ele.grabbable()}},{selector:":ungrabbable",matches:function matches(ele){return!ele.grabbable()}},{selector:":animated",matches:function matches(ele){return ele.animated()}},{selector:":unanimated",matches:function matches(ele){return!ele.animated()}},{selector:":parent",matches:function matches(ele){return ele.isParent()}},{selector:":childless",matches:function matches(ele){return ele.isChildless()}},{selector:":child",matches:function matches(ele){return ele.isChild()}},{selector:":orphan",matches:function matches(ele){return ele.isOrphan()}},{selector:":nonorphan",matches:function matches(ele){return ele.isChild()}},{selector:":compound",matches:function matches(ele){if(ele.isNode()){return ele.isParent()}else{return ele.source().isParent()||ele.target().isParent()}}},{selector:":loop",matches:function matches(ele){return ele.isLoop()}},{selector:":simple",matches:function matches(ele){return ele.isSimple()}},{selector:":active",matches:function matches(ele){return ele.active()}},{selector:":inactive",matches:function matches(ele){return!ele.active()}},{selector:":backgrounding",matches:function matches(ele){return ele.backgrounding()}},{selector:":nonbackgrounding",matches:function matches(ele){return!ele.backgrounding()}}].sort((function(a,b){return descending(a.selector,b.selector)}));var lookup=function(){var selToFn={};var s;for(var i=0;i<stateSelectors.length;i++){s=stateSelectors[i];selToFn[s.selector]=s.matches}return selToFn}();var stateSelectorMatches=function stateSelectorMatches(sel,ele){return lookup[sel](ele)};var stateSelectorRegex="("+stateSelectors.map((function(s){return s.selector})).join("|")+")";var cleanMetaChars=function cleanMetaChars(str){return str.replace(new RegExp("\\\\("+tokens.metaChar+")","g"),(function(match,$1){return $1}))};var replaceLastQuery=function replaceLastQuery(selector,examiningQuery,replacementQuery){selector[selector.length-1]=replacementQuery};var exprs=[{name:"group",query:true,regex:"("+tokens.group+")",populate:function populate(selector,query,_ref){var _ref2=_slicedToArray(_ref,1),group=_ref2[0];query.checks.push({type:Type.GROUP,value:group==="*"?group:group+"s"})}},{name:"state",query:true,regex:stateSelectorRegex,populate:function populate(selector,query,_ref3){var _ref4=_slicedToArray(_ref3,1),state=_ref4[0];query.checks.push({type:Type.STATE,value:state})}},{name:"id",query:true,regex:"\\#("+tokens.id+")",populate:function populate(selector,query,_ref5){var _ref6=_slicedToArray(_ref5,1),id=_ref6[0];query.checks.push({type:Type.ID,value:cleanMetaChars(id)})}},{name:"className",query:true,regex:"\\.("+tokens.className+")",populate:function populate(selector,query,_ref7){var _ref8=_slicedToArray(_ref7,1),className=_ref8[0];query.checks.push({type:Type.CLASS,value:cleanMetaChars(className)})}},{name:"dataExists",query:true,regex:"\\[\\s*("+tokens.variable+")\\s*\\]",populate:function populate(selector,query,_ref9){var _ref10=_slicedToArray(_ref9,1),variable=_ref10[0];query.checks.push({type:Type.DATA_EXIST,field:cleanMetaChars(variable)})}},{name:"dataCompare",query:true,regex:"\\[\\s*("+tokens.variable+")\\s*("+tokens.comparatorOp+")\\s*("+tokens.value+")\\s*\\]",populate:function populate(selector,query,_ref11){var _ref12=_slicedToArray(_ref11,3),variable=_ref12[0],comparatorOp=_ref12[1],value=_ref12[2];var valueIsString=new RegExp("^"+tokens.string+"$").exec(value)!=null;if(valueIsString){value=value.substring(1,value.length-1)}else{value=parseFloat(value)}query.checks.push({type:Type.DATA_COMPARE,field:cleanMetaChars(variable),operator:comparatorOp,value:value})}},{name:"dataBool",query:true,regex:"\\[\\s*("+tokens.boolOp+")\\s*("+tokens.variable+")\\s*\\]",populate:function populate(selector,query,_ref13){var _ref14=_slicedToArray(_ref13,2),boolOp=_ref14[0],variable=_ref14[1];query.checks.push({type:Type.DATA_BOOL,field:cleanMetaChars(variable),operator:boolOp})}},{name:"metaCompare",query:true,regex:"\\[\\[\\s*("+tokens.meta+")\\s*("+tokens.comparatorOp+")\\s*("+tokens.number+")\\s*\\]\\]",populate:function populate(selector,query,_ref15){var _ref16=_slicedToArray(_ref15,3),meta=_ref16[0],comparatorOp=_ref16[1],number=_ref16[2];query.checks.push({type:Type.META_COMPARE,field:cleanMetaChars(meta),operator:comparatorOp,value:parseFloat(number)})}},{name:"nextQuery",separator:true,regex:tokens.separator,populate:function populate(selector,query){var currentSubject=selector.currentSubject;var edgeCount=selector.edgeCount;var compoundCount=selector.compoundCount;var lastQ=selector[selector.length-1];if(currentSubject!=null){lastQ.subject=currentSubject;selector.currentSubject=null}lastQ.edgeCount=edgeCount;lastQ.compoundCount=compoundCount;selector.edgeCount=0;selector.compoundCount=0;var nextQuery=selector[selector.length++]=newQuery();return nextQuery}},{name:"directedEdge",separator:true,regex:tokens.directedEdge,populate:function populate(selector,query){if(selector.currentSubject==null){var edgeQuery=newQuery();var source=query;var target=newQuery();edgeQuery.checks.push({type:Type.DIRECTED_EDGE,source:source,target:target});replaceLastQuery(selector,query,edgeQuery);selector.edgeCount++;return target}else{var srcTgtQ=newQuery();var _source=query;var _target=newQuery();srcTgtQ.checks.push({type:Type.NODE_SOURCE,source:_source,target:_target});replaceLastQuery(selector,query,srcTgtQ);selector.edgeCount++;return _target}}},{name:"undirectedEdge",separator:true,regex:tokens.undirectedEdge,populate:function populate(selector,query){if(selector.currentSubject==null){var edgeQuery=newQuery();var source=query;var target=newQuery();edgeQuery.checks.push({type:Type.UNDIRECTED_EDGE,nodes:[source,target]});replaceLastQuery(selector,query,edgeQuery);selector.edgeCount++;return target}else{var nhoodQ=newQuery();var node=query;var neighbor=newQuery();nhoodQ.checks.push({type:Type.NODE_NEIGHBOR,node:node,neighbor:neighbor});replaceLastQuery(selector,query,nhoodQ);return neighbor}}},{name:"child",separator:true,regex:tokens.child,populate:function populate(selector,query){if(selector.currentSubject==null){var parentChildQuery=newQuery();var child=newQuery();var parent=selector[selector.length-1];parentChildQuery.checks.push({type:Type.CHILD,parent:parent,child:child});replaceLastQuery(selector,query,parentChildQuery);selector.compoundCount++;return child}else if(selector.currentSubject===query){var compound=newQuery();var left=selector[selector.length-1];var right=newQuery();var subject=newQuery();var _child=newQuery();var _parent=newQuery();compound.checks.push({type:Type.COMPOUND_SPLIT,left:left,right:right,subject:subject});subject.checks=query.checks;query.checks=[{type:Type.TRUE}];_parent.checks.push({type:Type.TRUE});right.checks.push({type:Type.PARENT,parent:_parent,child:_child});replaceLastQuery(selector,left,compound);selector.currentSubject=subject;selector.compoundCount++;return _child}else{var _parent2=newQuery();var _child2=newQuery();var pcQChecks=[{type:Type.PARENT,parent:_parent2,child:_child2}];_parent2.checks=query.checks;query.checks=pcQChecks;selector.compoundCount++;return _child2}}},{name:"descendant",separator:true,regex:tokens.descendant,populate:function populate(selector,query){if(selector.currentSubject==null){var ancChQuery=newQuery();var descendant=newQuery();var ancestor=selector[selector.length-1];ancChQuery.checks.push({type:Type.DESCENDANT,ancestor:ancestor,descendant:descendant});replaceLastQuery(selector,query,ancChQuery);selector.compoundCount++;return descendant}else if(selector.currentSubject===query){var compound=newQuery();var left=selector[selector.length-1];var right=newQuery();var subject=newQuery();var _descendant=newQuery();var _ancestor=newQuery();compound.checks.push({type:Type.COMPOUND_SPLIT,left:left,right:right,subject:subject});subject.checks=query.checks;query.checks=[{type:Type.TRUE}];_ancestor.checks.push({type:Type.TRUE});right.checks.push({type:Type.ANCESTOR,ancestor:_ancestor,descendant:_descendant});replaceLastQuery(selector,left,compound);selector.currentSubject=subject;selector.compoundCount++;return _descendant}else{var _ancestor2=newQuery();var _descendant2=newQuery();var adQChecks=[{type:Type.ANCESTOR,ancestor:_ancestor2,descendant:_descendant2}];_ancestor2.checks=query.checks;query.checks=adQChecks;selector.compoundCount++;return _descendant2}}},{name:"subject",modifier:true,regex:tokens.subject,populate:function populate(selector,query){if(selector.currentSubject!=null&&selector.currentSubject!==query){warn("Redefinition of subject in selector `"+selector.toString()+"`");return false}selector.currentSubject=query;var topQ=selector[selector.length-1];var topChk=topQ.checks[0];var topType=topChk==null?null:topChk.type;if(topType===Type.DIRECTED_EDGE){topChk.type=Type.NODE_TARGET}else if(topType===Type.UNDIRECTED_EDGE){topChk.type=Type.NODE_NEIGHBOR;topChk.node=topChk.nodes[1];topChk.neighbor=topChk.nodes[0];topChk.nodes=null}}}];exprs.forEach((function(e){return e.regexObj=new RegExp("^"+e.regex)}));var consumeExpr=function consumeExpr(remaining){var expr;var match;var name;for(var j=0;j<exprs.length;j++){var e=exprs[j];var n=e.name;var m=remaining.match(e.regexObj);if(m!=null){match=m;expr=e;name=n;var consumed=m[0];remaining=remaining.substring(consumed.length);break}}return{expr:expr,match:match,name:name,remaining:remaining}};var consumeWhitespace=function consumeWhitespace(remaining){var match=remaining.match(/^\s+/);if(match){var consumed=match[0];remaining=remaining.substring(consumed.length)}return remaining};var parse=function parse(selector){var self=this;var remaining=self.inputText=selector;var currentQuery=self[0]=newQuery();self.length=1;remaining=consumeWhitespace(remaining);for(;;){var exprInfo=consumeExpr(remaining);if(exprInfo.expr==null){warn("The selector `"+selector+"`is invalid");return false}else{var args=exprInfo.match.slice(1);var ret=exprInfo.expr.populate(self,currentQuery,args);if(ret===false){return false}else if(ret!=null){currentQuery=ret}}remaining=exprInfo.remaining;if(remaining.match(/^\s*$/)){break}}var lastQ=self[self.length-1];if(self.currentSubject!=null){lastQ.subject=self.currentSubject}lastQ.edgeCount=self.edgeCount;lastQ.compoundCount=self.compoundCount;for(var i=0;i<self.length;i++){var q=self[i];if(q.compoundCount>0&&q.edgeCount>0){warn("The selector `"+selector+"` is invalid because it uses both a compound selector and an edge selector");return false}if(q.edgeCount>1){warn("The selector `"+selector+"` is invalid because it uses multiple edge selectors");return false}else if(q.edgeCount===1){warn("The selector `"+selector+"` is deprecated.  Edge selectors do not take effect on changes to source and target nodes after an edge is added, for performance reasons.  Use a class or data selector on edges instead, updating the class or data of an edge when your app detects a change in source or target nodes.")}}return true};var toString=function toString(){if(this.toStringCache!=null){return this.toStringCache}var clean=function clean(obj){if(obj==null){return""}else{return obj}};var cleanVal=function cleanVal(val){if(string(val)){return'"'+val+'"'}else{return clean(val)}};var space=function space(val){return" "+val+" "};var checkToString=function checkToString(check,subject){var type=check.type,value=check.value;switch(type){case Type.GROUP:{var group=clean(value);return group.substring(0,group.length-1)}case Type.DATA_COMPARE:{var field=check.field,operator=check.operator;return"["+field+space(clean(operator))+cleanVal(value)+"]"}case Type.DATA_BOOL:{var _operator=check.operator,_field=check.field;return"["+clean(_operator)+_field+"]"}case Type.DATA_EXIST:{var _field2=check.field;return"["+_field2+"]"}case Type.META_COMPARE:{var _operator2=check.operator,_field3=check.field;return"[["+_field3+space(clean(_operator2))+cleanVal(value)+"]]"}case Type.STATE:{return value}case Type.ID:{return"#"+value}case Type.CLASS:{return"."+value}case Type.PARENT:case Type.CHILD:{return queryToString(check.parent,subject)+space(">")+queryToString(check.child,subject)}case Type.ANCESTOR:case Type.DESCENDANT:{return queryToString(check.ancestor,subject)+" "+queryToString(check.descendant,subject)}case Type.COMPOUND_SPLIT:{var lhs=queryToString(check.left,subject);var sub=queryToString(check.subject,subject);var rhs=queryToString(check.right,subject);return lhs+(lhs.length>0?" ":"")+sub+rhs}case Type.TRUE:{return""}}};var queryToString=function queryToString(query,subject){return query.checks.reduce((function(str,chk,i){return str+(subject===query&&i===0?"$":"")+checkToString(chk,subject)}),"")};var str="";for(var i=0;i<this.length;i++){var query=this[i];str+=queryToString(query,query.subject);if(this.length>1&&i<this.length-1){str+=", "}}this.toStringCache=str;return str};var parse$1={parse:parse,toString:toString};var valCmp=function valCmp(fieldVal,operator,value){var matches;var isFieldStr=string(fieldVal);var isFieldNum=number(fieldVal);var isValStr=string(value);var fieldStr,valStr;var caseInsensitive=false;var notExpr=false;var isIneqCmp=false;if(operator.indexOf("!")>=0){operator=operator.replace("!","");notExpr=true}if(operator.indexOf("@")>=0){operator=operator.replace("@","");caseInsensitive=true}if(isFieldStr||isValStr||caseInsensitive){fieldStr=!isFieldStr&&!isFieldNum?"":""+fieldVal;valStr=""+value}if(caseInsensitive){fieldVal=fieldStr=fieldStr.toLowerCase();value=valStr=valStr.toLowerCase()}switch(operator){case"*=":matches=fieldStr.indexOf(valStr)>=0;break;case"$=":matches=fieldStr.indexOf(valStr,fieldStr.length-valStr.length)>=0;break;case"^=":matches=fieldStr.indexOf(valStr)===0;break;case"=":matches=fieldVal===value;break;case">":isIneqCmp=true;matches=fieldVal>value;break;case">=":isIneqCmp=true;matches=fieldVal>=value;break;case"<":isIneqCmp=true;matches=fieldVal<value;break;case"<=":isIneqCmp=true;matches=fieldVal<=value;break;default:matches=false;break}if(notExpr&&(fieldVal!=null||!isIneqCmp)){matches=!matches}return matches};var boolCmp=function boolCmp(fieldVal,operator){switch(operator){case"?":return fieldVal?true:false;case"!":return fieldVal?false:true;case"^":return fieldVal===undefined}};var existCmp=function existCmp(fieldVal){return fieldVal!==undefined};var data=function data(ele,field){return ele.data(field)};var meta=function meta(ele,field){return ele[field]()};var match=[];var matches=function matches(query,ele){return query.checks.every((function(chk){return match[chk.type](chk,ele)}))};match[Type.GROUP]=function(check,ele){var group=check.value;return group==="*"||group===ele.group()};match[Type.STATE]=function(check,ele){var stateSelector=check.value;return stateSelectorMatches(stateSelector,ele)};match[Type.ID]=function(check,ele){var id=check.value;return ele.id()===id};match[Type.CLASS]=function(check,ele){var cls=check.value;return ele.hasClass(cls)};match[Type.META_COMPARE]=function(check,ele){var field=check.field,operator=check.operator,value=check.value;return valCmp(meta(ele,field),operator,value)};match[Type.DATA_COMPARE]=function(check,ele){var field=check.field,operator=check.operator,value=check.value;return valCmp(data(ele,field),operator,value)};match[Type.DATA_BOOL]=function(check,ele){var field=check.field,operator=check.operator;return boolCmp(data(ele,field),operator)};match[Type.DATA_EXIST]=function(check,ele){var field=check.field,operator=check.operator;return existCmp(data(ele,field))};match[Type.UNDIRECTED_EDGE]=function(check,ele){var qA=check.nodes[0];var qB=check.nodes[1];var src=ele.source();var tgt=ele.target();return matches(qA,src)&&matches(qB,tgt)||matches(qB,src)&&matches(qA,tgt)};match[Type.NODE_NEIGHBOR]=function(check,ele){return matches(check.node,ele)&&ele.neighborhood().some((function(n){return n.isNode()&&matches(check.neighbor,n)}))};match[Type.DIRECTED_EDGE]=function(check,ele){return matches(check.source,ele.source())&&matches(check.target,ele.target())};match[Type.NODE_SOURCE]=function(check,ele){return matches(check.source,ele)&&ele.outgoers().some((function(n){return n.isNode()&&matches(check.target,n)}))};match[Type.NODE_TARGET]=function(check,ele){return matches(check.target,ele)&&ele.incomers().some((function(n){return n.isNode()&&matches(check.source,n)}))};match[Type.CHILD]=function(check,ele){return matches(check.child,ele)&&matches(check.parent,ele.parent())};match[Type.PARENT]=function(check,ele){return matches(check.parent,ele)&&ele.children().some((function(c){return matches(check.child,c)}))};match[Type.DESCENDANT]=function(check,ele){return matches(check.descendant,ele)&&ele.ancestors().some((function(a){return matches(check.ancestor,a)}))};match[Type.ANCESTOR]=function(check,ele){return matches(check.ancestor,ele)&&ele.descendants().some((function(d){return matches(check.descendant,d)}))};match[Type.COMPOUND_SPLIT]=function(check,ele){return matches(check.subject,ele)&&matches(check.left,ele)&&matches(check.right,ele)};match[Type.TRUE]=function(){return true};match[Type.COLLECTION]=function(check,ele){var collection=check.value;return collection.has(ele)};match[Type.FILTER]=function(check,ele){var filter=check.value;return filter(ele)};var filter=function filter(collection){var self=this;if(self.length===1&&self[0].checks.length===1&&self[0].checks[0].type===Type.ID){return collection.getElementById(self[0].checks[0].value).collection()}var selectorFunction=function selectorFunction(element){for(var j=0;j<self.length;j++){var query=self[j];if(matches(query,element)){return true}}return false};if(self.text()==null){selectorFunction=function selectorFunction(){return true}}return collection.filter(selectorFunction)};var matches$1=function matches$1(ele){var self=this;for(var j=0;j<self.length;j++){var query=self[j];if(matches(query,ele)){return true}}return false};var matching={matches:matches$1,filter:filter};var Selector=function Selector(selector){this.inputText=selector;this.currentSubject=null;this.compoundCount=0;this.edgeCount=0;this.length=0;if(selector==null||string(selector)&&selector.match(/^\s*$/));else if(elementOrCollection(selector)){this.addQuery({checks:[{type:Type.COLLECTION,value:selector.collection()}]})}else if(fn(selector)){this.addQuery({checks:[{type:Type.FILTER,value:selector}]})}else if(string(selector)){if(!this.parse(selector)){this.invalid=true}}else{error("A selector must be created from a string; found ")}};var selfn=Selector.prototype;[parse$1,matching].forEach((function(p){return extend(selfn,p)}));selfn.text=function(){return this.inputText};selfn.size=function(){return this.length};selfn.eq=function(i){return this[i]};selfn.sameText=function(otherSel){return!this.invalid&&!otherSel.invalid&&this.text()===otherSel.text()};selfn.addQuery=function(q){this[this.length++]=q};selfn.selector=selfn.toString;var elesfn$e={allAre:function allAre(selector){var selObj=new Selector(selector);return this.every((function(ele){return selObj.matches(ele)}))},is:function is(selector){var selObj=new Selector(selector);return this.some((function(ele){return selObj.matches(ele)}))},some:function some(fn,thisArg){for(var i=0;i<this.length;i++){var ret=!thisArg?fn(this[i],i,this):fn.apply(thisArg,[this[i],i,this]);if(ret){return true}}return false},every:function every(fn,thisArg){for(var i=0;i<this.length;i++){var ret=!thisArg?fn(this[i],i,this):fn.apply(thisArg,[this[i],i,this]);if(!ret){return false}}return true},same:function same(collection){if(this===collection){return true}collection=this.cy().collection(collection);var thisLength=this.length;var collectionLength=collection.length;if(thisLength!==collectionLength){return false}if(thisLength===1){return this[0]===collection[0]}return this.every((function(ele){return collection.hasElementWithId(ele.id())}))},anySame:function anySame(collection){collection=this.cy().collection(collection);return this.some((function(ele){return collection.hasElementWithId(ele.id())}))},allAreNeighbors:function allAreNeighbors(collection){collection=this.cy().collection(collection);var nhood=this.neighborhood();return collection.every((function(ele){return nhood.hasElementWithId(ele.id())}))},contains:function contains(collection){collection=this.cy().collection(collection);var self=this;return collection.every((function(ele){return self.hasElementWithId(ele.id())}))}};elesfn$e.allAreNeighbours=elesfn$e.allAreNeighbors;elesfn$e.has=elesfn$e.contains;elesfn$e.equal=elesfn$e.equals=elesfn$e.same;var cache=function cache(fn,name){return function traversalCache(arg1,arg2,arg3,arg4){var selectorOrEles=arg1;var eles=this;var key;if(selectorOrEles==null){key=""}else if(elementOrCollection(selectorOrEles)&&selectorOrEles.length===1){key=selectorOrEles.id()}if(eles.length===1&&key){var _p=eles[0]._private;var tch=_p.traversalCache=_p.traversalCache||{};var ch=tch[name]=tch[name]||[];var hash=hashString(key);var cacheHit=ch[hash];if(cacheHit){return cacheHit}else{return ch[hash]=fn.call(eles,arg1,arg2,arg3,arg4)}}else{return fn.call(eles,arg1,arg2,arg3,arg4)}}};var elesfn$f={parent:function parent(selector){var parents=[];if(this.length===1){var parent=this[0]._private.parent;if(parent){return parent}}for(var i=0;i<this.length;i++){var ele=this[i];var _parent=ele._private.parent;if(_parent){parents.push(_parent)}}return this.spawn(parents,{unique:true}).filter(selector)},parents:function parents(selector){var parents=[];var eles=this.parent();while(eles.nonempty()){for(var i=0;i<eles.length;i++){var ele=eles[i];parents.push(ele)}eles=eles.parent()}return this.spawn(parents,{unique:true}).filter(selector)},commonAncestors:function commonAncestors(selector){var ancestors;for(var i=0;i<this.length;i++){var ele=this[i];var parents=ele.parents();ancestors=ancestors||parents;ancestors=ancestors.intersect(parents)}return ancestors.filter(selector)},orphans:function orphans(selector){return this.stdFilter((function(ele){return ele.isOrphan()})).filter(selector)},nonorphans:function nonorphans(selector){return this.stdFilter((function(ele){return ele.isChild()})).filter(selector)},children:cache((function(selector){var children=[];for(var i=0;i<this.length;i++){var ele=this[i];var eleChildren=ele._private.children;for(var j=0;j<eleChildren.length;j++){children.push(eleChildren[j])}}return this.spawn(children,{unique:true}).filter(selector)}),"children"),siblings:function siblings(selector){return this.parent().children().not(this).filter(selector)},isParent:function isParent(){var ele=this[0];if(ele){return ele.isNode()&&ele._private.children.length!==0}},isChildless:function isChildless(){var ele=this[0];if(ele){return ele.isNode()&&ele._private.children.length===0}},isChild:function isChild(){var ele=this[0];if(ele){return ele.isNode()&&ele._private.parent!=null}},isOrphan:function isOrphan(){var ele=this[0];if(ele){return ele.isNode()&&ele._private.parent==null}},descendants:function descendants(selector){var elements=[];function add(eles){for(var i=0;i<eles.length;i++){var ele=eles[i];elements.push(ele);if(ele.children().nonempty()){add(ele.children())}}}add(this.children());return this.spawn(elements,{unique:true}).filter(selector)}};function forEachCompound(eles,fn,includeSelf,recursiveStep){var q=[];var did=new Set$1;var cy=eles.cy();var hasCompounds=cy.hasCompoundNodes();for(var i=0;i<eles.length;i++){var ele=eles[i];if(includeSelf){q.push(ele)}else if(hasCompounds){recursiveStep(q,did,ele)}}while(q.length>0){var _ele=q.shift();fn(_ele);did.add(_ele.id());if(hasCompounds){recursiveStep(q,did,_ele)}}return eles}function addChildren(q,did,ele){if(ele.isParent()){var children=ele._private.children;for(var i=0;i<children.length;i++){var child=children[i];if(!did.has(child.id())){q.push(child)}}}}elesfn$f.forEachDown=function(fn){var includeSelf=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;return forEachCompound(this,fn,includeSelf,addChildren)};function addParent(q,did,ele){if(ele.isChild()){var parent=ele._private.parent;if(!did.has(parent.id())){q.push(parent)}}}elesfn$f.forEachUp=function(fn){var includeSelf=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;return forEachCompound(this,fn,includeSelf,addParent)};function addParentAndChildren(q,did,ele){addParent(q,did,ele);addChildren(q,did,ele)}elesfn$f.forEachUpAndDown=function(fn){var includeSelf=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;return forEachCompound(this,fn,includeSelf,addParentAndChildren)};elesfn$f.ancestors=elesfn$f.parents;var fn$1,elesfn$g;fn$1=elesfn$g={data:define$3.data({field:"data",bindingEvent:"data",allowBinding:true,allowSetting:true,settingEvent:"data",settingTriggersEvent:true,triggerFnName:"trigger",allowGetting:true,immutableKeys:{id:true,source:true,target:true,parent:true},updateStyle:true}),removeData:define$3.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:true,immutableKeys:{id:true,source:true,target:true,parent:true},updateStyle:true}),scratch:define$3.data({field:"scratch",bindingEvent:"scratch",allowBinding:true,allowSetting:true,settingEvent:"scratch",settingTriggersEvent:true,triggerFnName:"trigger",allowGetting:true,updateStyle:true}),removeScratch:define$3.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:true,updateStyle:true}),rscratch:define$3.data({field:"rscratch",allowBinding:false,allowSetting:true,settingTriggersEvent:false,allowGetting:true}),removeRscratch:define$3.removeData({field:"rscratch",triggerEvent:false}),id:function id(){var ele=this[0];if(ele){return ele._private.data.id}}};fn$1.attr=fn$1.data;fn$1.removeAttr=fn$1.removeData;var data$1=elesfn$g;var elesfn$h={};function defineDegreeFunction(callback){return function(includeLoops){var self=this;if(includeLoops===undefined){includeLoops=true}if(self.length===0){return}if(self.isNode()&&!self.removed()){var degree=0;var node=self[0];var connectedEdges=node._private.edges;for(var i=0;i<connectedEdges.length;i++){var edge=connectedEdges[i];if(!includeLoops&&edge.isLoop()){continue}degree+=callback(node,edge)}return degree}else{return}}}extend(elesfn$h,{degree:defineDegreeFunction((function(node,edge){if(edge.source().same(edge.target())){return 2}else{return 1}})),indegree:defineDegreeFunction((function(node,edge){if(edge.target().same(node)){return 1}else{return 0}})),outdegree:defineDegreeFunction((function(node,edge){if(edge.source().same(node)){return 1}else{return 0}}))});function defineDegreeBoundsFunction(degreeFn,callback){return function(includeLoops){var ret;var nodes=this.nodes();for(var i=0;i<nodes.length;i++){var ele=nodes[i];var degree=ele[degreeFn](includeLoops);if(degree!==undefined&&(ret===undefined||callback(degree,ret))){ret=degree}}return ret}}extend(elesfn$h,{minDegree:defineDegreeBoundsFunction("degree",(function(degree,min){return degree<min})),maxDegree:defineDegreeBoundsFunction("degree",(function(degree,max){return degree>max})),minIndegree:defineDegreeBoundsFunction("indegree",(function(degree,min){return degree<min})),maxIndegree:defineDegreeBoundsFunction("indegree",(function(degree,max){return degree>max})),minOutdegree:defineDegreeBoundsFunction("outdegree",(function(degree,min){return degree<min})),maxOutdegree:defineDegreeBoundsFunction("outdegree",(function(degree,max){return degree>max}))});extend(elesfn$h,{totalDegree:function totalDegree(includeLoops){var total=0;var nodes=this.nodes();for(var i=0;i<nodes.length;i++){total+=nodes[i].degree(includeLoops)}return total}});var fn$2,elesfn$i;var beforePositionSet=function beforePositionSet(eles,newPos,silent){for(var i=0;i<eles.length;i++){var ele=eles[i];if(!ele.locked()){var oldPos=ele._private.position;var delta={x:newPos.x!=null?newPos.x-oldPos.x:0,y:newPos.y!=null?newPos.y-oldPos.y:0};if(ele.isParent()&&!(delta.x===0&&delta.y===0)){ele.children().shift(delta,silent)}ele.shiftCachedBoundingBox(delta)}}};var positionDef={field:"position",bindingEvent:"position",allowBinding:true,allowSetting:true,settingEvent:"position",settingTriggersEvent:true,triggerFnName:"emitAndNotify",allowGetting:true,validKeys:["x","y"],beforeGet:function beforeGet(ele){ele.updateCompoundBounds()},beforeSet:function beforeSet(eles,newPos){beforePositionSet(eles,newPos,false)},onSet:function onSet(eles){eles.dirtyCompoundBoundsCache()},canSet:function canSet(ele){return!ele.locked()}};fn$2=elesfn$i={position:define$3.data(positionDef),silentPosition:define$3.data(extend({},positionDef,{allowBinding:false,allowSetting:true,settingTriggersEvent:false,allowGetting:false,beforeSet:function beforeSet(eles,newPos){beforePositionSet(eles,newPos,true)}})),positions:function positions(pos,silent){if(plainObject(pos)){if(silent){this.silentPosition(pos)}else{this.position(pos)}}else if(fn(pos)){var _fn=pos;var cy=this.cy();cy.startBatch();for(var i=0;i<this.length;i++){var ele=this[i];var _pos=void 0;if(_pos=_fn(ele,i)){if(silent){ele.silentPosition(_pos)}else{ele.position(_pos)}}}cy.endBatch()}return this},silentPositions:function silentPositions(pos){return this.positions(pos,true)},shift:function shift(dim,val,silent){var delta;if(plainObject(dim)){delta={x:number(dim.x)?dim.x:0,y:number(dim.y)?dim.y:0};silent=val}else if(string(dim)&&number(val)){delta={x:0,y:0};delta[dim]=val}if(delta!=null){var cy=this.cy();cy.startBatch();for(var i=0;i<this.length;i++){var ele=this[i];var pos=ele.position();var newPos={x:pos.x+delta.x,y:pos.y+delta.y};if(silent){ele.silentPosition(newPos)}else{ele.position(newPos)}}cy.endBatch()}return this},silentShift:function silentShift(dim,val){if(plainObject(dim)){this.shift(dim,true)}else if(string(dim)&&number(val)){this.shift(dim,val,true)}return this},renderedPosition:function renderedPosition(dim,val){var ele=this[0];var cy=this.cy();var zoom=cy.zoom();var pan=cy.pan();var rpos=plainObject(dim)?dim:undefined;var setting=rpos!==undefined||val!==undefined&&string(dim);if(ele&&ele.isNode()){if(setting){for(var i=0;i<this.length;i++){var _ele=this[i];if(val!==undefined){_ele.position(dim,(val-pan[dim])/zoom)}else if(rpos!==undefined){_ele.position(renderedToModelPosition(rpos,zoom,pan))}}}else{var pos=ele.position();rpos=modelToRenderedPosition(pos,zoom,pan);if(dim===undefined){return rpos}else{return rpos[dim]}}}else if(!setting){return undefined}return this},relativePosition:function relativePosition(dim,val){var ele=this[0];var cy=this.cy();var ppos=plainObject(dim)?dim:undefined;var setting=ppos!==undefined||val!==undefined&&string(dim);var hasCompoundNodes=cy.hasCompoundNodes();if(ele&&ele.isNode()){if(setting){for(var i=0;i<this.length;i++){var _ele2=this[i];var parent=hasCompoundNodes?_ele2.parent():null;var hasParent=parent&&parent.length>0;var relativeToParent=hasParent;if(hasParent){parent=parent[0]}var origin=relativeToParent?parent.position():{x:0,y:0};if(val!==undefined){_ele2.position(dim,val+origin[dim])}else if(ppos!==undefined){_ele2.position({x:ppos.x+origin.x,y:ppos.y+origin.y})}}}else{var pos=ele.position();var _parent=hasCompoundNodes?ele.parent():null;var _hasParent=_parent&&_parent.length>0;var _relativeToParent=_hasParent;if(_hasParent){_parent=_parent[0]}var _origin=_relativeToParent?_parent.position():{x:0,y:0};ppos={x:pos.x-_origin.x,y:pos.y-_origin.y};if(dim===undefined){return ppos}else{return ppos[dim]}}}else if(!setting){return undefined}return this}};fn$2.modelPosition=fn$2.point=fn$2.position;fn$2.modelPositions=fn$2.points=fn$2.positions;fn$2.renderedPoint=fn$2.renderedPosition;fn$2.relativePoint=fn$2.relativePosition;var position=elesfn$i;var fn$3,elesfn$j;fn$3=elesfn$j={};elesfn$j.renderedBoundingBox=function(options){var bb=this.boundingBox(options);var cy=this.cy();var zoom=cy.zoom();var pan=cy.pan();var x1=bb.x1*zoom+pan.x;var x2=bb.x2*zoom+pan.x;var y1=bb.y1*zoom+pan.y;var y2=bb.y2*zoom+pan.y;return{x1:x1,x2:x2,y1:y1,y2:y2,w:x2-x1,h:y2-y1}};elesfn$j.dirtyCompoundBoundsCache=function(){var cy=this.cy();if(!cy.styleEnabled()||!cy.hasCompoundNodes()){return this}this.forEachUp((function(ele){if(ele.isParent()){var _p=ele._private;_p.compoundBoundsClean=false;_p.bbCache=null;ele.emitAndNotify("bounds")}}));return this};elesfn$j.updateCompoundBounds=function(){var force=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var cy=this.cy();if(!cy.styleEnabled()||!cy.hasCompoundNodes()){return this}if(!force&&cy.batching()){return this}function update(parent){if(!parent.isParent()){return}var _p=parent._private;var children=parent.children();var includeLabels=parent.pstyle("compound-sizing-wrt-labels").value==="include";var min={width:{val:parent.pstyle("min-width").pfValue,left:parent.pstyle("min-width-bias-left"),right:parent.pstyle("min-width-bias-right")},height:{val:parent.pstyle("min-height").pfValue,top:parent.pstyle("min-height-bias-top"),bottom:parent.pstyle("min-height-bias-bottom")}};var bb=children.boundingBox({includeLabels:includeLabels,includeOverlays:false,useCache:false});var pos=_p.position;if(bb.w===0||bb.h===0){bb={w:parent.pstyle("width").pfValue,h:parent.pstyle("height").pfValue};bb.x1=pos.x-bb.w/2;bb.x2=pos.x+bb.w/2;bb.y1=pos.y-bb.h/2;bb.y2=pos.y+bb.h/2}function computeBiasValues(propDiff,propBias,propBiasComplement){var biasDiff=0;var biasComplementDiff=0;var biasTotal=propBias+propBiasComplement;if(propDiff>0&&biasTotal>0){biasDiff=propBias/biasTotal*propDiff;biasComplementDiff=propBiasComplement/biasTotal*propDiff}return{biasDiff:biasDiff,biasComplementDiff:biasComplementDiff}}function computePaddingValues(width,height,paddingObject,relativeTo){if(paddingObject.units==="%"){switch(relativeTo){case"width":return width>0?paddingObject.pfValue*width:0;case"height":return height>0?paddingObject.pfValue*height:0;case"average":return width>0&&height>0?paddingObject.pfValue*(width+height)/2:0;case"min":return width>0&&height>0?width>height?paddingObject.pfValue*height:paddingObject.pfValue*width:0;case"max":return width>0&&height>0?width>height?paddingObject.pfValue*width:paddingObject.pfValue*height:0;default:return 0}}else if(paddingObject.units==="px"){return paddingObject.pfValue}else{return 0}}var leftVal=min.width.left.value;if(min.width.left.units==="px"&&min.width.val>0){leftVal=leftVal*100/min.width.val}var rightVal=min.width.right.value;if(min.width.right.units==="px"&&min.width.val>0){rightVal=rightVal*100/min.width.val}var topVal=min.height.top.value;if(min.height.top.units==="px"&&min.height.val>0){topVal=topVal*100/min.height.val}var bottomVal=min.height.bottom.value;if(min.height.bottom.units==="px"&&min.height.val>0){bottomVal=bottomVal*100/min.height.val}var widthBiasDiffs=computeBiasValues(min.width.val-bb.w,leftVal,rightVal);var diffLeft=widthBiasDiffs.biasDiff;var diffRight=widthBiasDiffs.biasComplementDiff;var heightBiasDiffs=computeBiasValues(min.height.val-bb.h,topVal,bottomVal);var diffTop=heightBiasDiffs.biasDiff;var diffBottom=heightBiasDiffs.biasComplementDiff;_p.autoPadding=computePaddingValues(bb.w,bb.h,parent.pstyle("padding"),parent.pstyle("padding-relative-to").value);_p.autoWidth=Math.max(bb.w,min.width.val);pos.x=(-diffLeft+bb.x1+bb.x2+diffRight)/2;_p.autoHeight=Math.max(bb.h,min.height.val);pos.y=(-diffTop+bb.y1+bb.y2+diffBottom)/2}for(var i=0;i<this.length;i++){var ele=this[i];var _p=ele._private;if(!_p.compoundBoundsClean){update(ele);if(!cy.batching()){_p.compoundBoundsClean=true}}}return this};var noninf=function noninf(x){if(x===Infinity||x===-Infinity){return 0}return x};var updateBounds=function updateBounds(b,x1,y1,x2,y2){if(x2-x1===0||y2-y1===0){return}if(x1==null||y1==null||x2==null||y2==null){return}b.x1=x1<b.x1?x1:b.x1;b.x2=x2>b.x2?x2:b.x2;b.y1=y1<b.y1?y1:b.y1;b.y2=y2>b.y2?y2:b.y2;b.w=b.x2-b.x1;b.h=b.y2-b.y1};var updateBoundsFromBox=function updateBoundsFromBox(b,b2){if(b2==null){return b}return updateBounds(b,b2.x1,b2.y1,b2.x2,b2.y2)};var prefixedProperty=function prefixedProperty(obj,field,prefix){return getPrefixedProperty(obj,field,prefix)};var updateBoundsFromArrow=function updateBoundsFromArrow(bounds,ele,prefix){if(ele.cy().headless()){return}var _p=ele._private;var rstyle=_p.rstyle;var halfArW=rstyle.arrowWidth/2;var arrowType=ele.pstyle(prefix+"-arrow-shape").value;var x;var y;if(arrowType!=="none"){if(prefix==="source"){x=rstyle.srcX;y=rstyle.srcY}else if(prefix==="target"){x=rstyle.tgtX;y=rstyle.tgtY}else{x=rstyle.midX;y=rstyle.midY}var bbs=_p.arrowBounds=_p.arrowBounds||{};var bb=bbs[prefix]=bbs[prefix]||{};bb.x1=x-halfArW;bb.y1=y-halfArW;bb.x2=x+halfArW;bb.y2=y+halfArW;bb.w=bb.x2-bb.x1;bb.h=bb.y2-bb.y1;expandBoundingBox(bb,1);updateBounds(bounds,bb.x1,bb.y1,bb.x2,bb.y2)}};var updateBoundsFromLabel=function updateBoundsFromLabel(bounds,ele,prefix){if(ele.cy().headless()){return}var prefixDash;if(prefix){prefixDash=prefix+"-"}else{prefixDash=""}var _p=ele._private;var rstyle=_p.rstyle;var label=ele.pstyle(prefixDash+"label").strValue;if(label){var halign=ele.pstyle("text-halign");var valign=ele.pstyle("text-valign");var labelWidth=prefixedProperty(rstyle,"labelWidth",prefix);var labelHeight=prefixedProperty(rstyle,"labelHeight",prefix);var labelX=prefixedProperty(rstyle,"labelX",prefix);var labelY=prefixedProperty(rstyle,"labelY",prefix);var marginX=ele.pstyle(prefixDash+"text-margin-x").pfValue;var marginY=ele.pstyle(prefixDash+"text-margin-y").pfValue;var isEdge=ele.isEdge();var rotation=ele.pstyle(prefixDash+"text-rotation");var outlineWidth=ele.pstyle("text-outline-width").pfValue;var borderWidth=ele.pstyle("text-border-width").pfValue;var halfBorderWidth=borderWidth/2;var padding=ele.pstyle("text-background-padding").pfValue;var lh=labelHeight;var lw=labelWidth;var lw_2=lw/2;var lh_2=lh/2;var lx1,lx2,ly1,ly2;if(isEdge){lx1=labelX-lw_2;lx2=labelX+lw_2;ly1=labelY-lh_2;ly2=labelY+lh_2}else{switch(halign.value){case"left":lx1=labelX-lw;lx2=labelX;break;case"center":lx1=labelX-lw_2;lx2=labelX+lw_2;break;case"right":lx1=labelX;lx2=labelX+lw;break}switch(valign.value){case"top":ly1=labelY-lh;ly2=labelY;break;case"center":ly1=labelY-lh_2;ly2=labelY+lh_2;break;case"bottom":ly1=labelY;ly2=labelY+lh;break}}lx1+=marginX-Math.max(outlineWidth,halfBorderWidth)-padding;lx2+=marginX+Math.max(outlineWidth,halfBorderWidth)+padding;ly1+=marginY-Math.max(outlineWidth,halfBorderWidth)-padding;ly2+=marginY+Math.max(outlineWidth,halfBorderWidth)+padding;var bbPrefix=prefix||"main";var bbs=_p.labelBounds;var bb=bbs[bbPrefix]=bbs[bbPrefix]||{};bb.x1=lx1;bb.y1=ly1;bb.x2=lx2;bb.y2=ly2;bb.w=lx2-lx1;bb.h=ly2-ly1;expandBoundingBox(bb,1);var isAutorotate=isEdge&&rotation.strValue==="autorotate";var isPfValue=rotation.pfValue!=null&&rotation.pfValue!==0;if(isAutorotate||isPfValue){var theta=isAutorotate?prefixedProperty(_p.rstyle,"labelAngle",prefix):rotation.pfValue;var cos=Math.cos(theta);var sin=Math.sin(theta);var xo=(lx1+lx2)/2;var yo=(ly1+ly2)/2;if(!isEdge){switch(halign.value){case"left":xo=lx2;break;case"right":xo=lx1;break}switch(valign.value){case"top":yo=ly2;break;case"bottom":yo=ly1;break}}var rotate=function rotate(x,y){x=x-xo;y=y-yo;return{x:x*cos-y*sin+xo,y:x*sin+y*cos+yo}};var px1y1=rotate(lx1,ly1);var px1y2=rotate(lx1,ly2);var px2y1=rotate(lx2,ly1);var px2y2=rotate(lx2,ly2);lx1=Math.min(px1y1.x,px1y2.x,px2y1.x,px2y2.x);lx2=Math.max(px1y1.x,px1y2.x,px2y1.x,px2y2.x);ly1=Math.min(px1y1.y,px1y2.y,px2y1.y,px2y2.y);ly2=Math.max(px1y1.y,px1y2.y,px2y1.y,px2y2.y)}updateBounds(bounds,lx1,ly1,lx2,ly2);updateBounds(_p.labelBounds.all,lx1,ly1,lx2,ly2)}return bounds};var boundingBoxImpl=function boundingBoxImpl(ele,options){var cy=ele._private.cy;var styleEnabled=cy.styleEnabled();var headless=cy.headless();var bounds=makeBoundingBox();var _p=ele._private;var isNode=ele.isNode();var isEdge=ele.isEdge();var ex1,ex2,ey1,ey2;var x,y;var rstyle=_p.rstyle;var manualExpansion=isNode&&styleEnabled?ele.pstyle("bounds-expansion").pfValue:[0];var isDisplayed=function isDisplayed(ele){return ele.pstyle("display").value!=="none"};var displayed=!styleEnabled||isDisplayed(ele)&&(!isEdge||isDisplayed(ele.source())&&isDisplayed(ele.target()));if(displayed){var overlayOpacity=0;var overlayPadding=0;if(styleEnabled&&options.includeOverlays){overlayOpacity=ele.pstyle("overlay-opacity").value;if(overlayOpacity!==0){overlayPadding=ele.pstyle("overlay-padding").value}}var w=0;var wHalf=0;if(styleEnabled){w=ele.pstyle("width").pfValue;wHalf=w/2}if(isNode&&options.includeNodes){var pos=ele.position();x=pos.x;y=pos.y;var _w=ele.outerWidth();var halfW=_w/2;var h=ele.outerHeight();var halfH=h/2;ex1=x-halfW;ex2=x+halfW;ey1=y-halfH;ey2=y+halfH;updateBounds(bounds,ex1,ey1,ex2,ey2)}else if(isEdge&&options.includeEdges){if(styleEnabled&&!headless){ex1=Math.min(rstyle.srcX,rstyle.midX,rstyle.tgtX);ex2=Math.max(rstyle.srcX,rstyle.midX,rstyle.tgtX);ey1=Math.min(rstyle.srcY,rstyle.midY,rstyle.tgtY);ey2=Math.max(rstyle.srcY,rstyle.midY,rstyle.tgtY);ex1-=wHalf;ex2+=wHalf;ey1-=wHalf;ey2+=wHalf;updateBounds(bounds,ex1,ey1,ex2,ey2)}if(styleEnabled&&!headless&&ele.pstyle("curve-style").strValue==="haystack"){var hpts=rstyle.haystackPts||[];ex1=hpts[0].x;ey1=hpts[0].y;ex2=hpts[1].x;ey2=hpts[1].y;if(ex1>ex2){var temp=ex1;ex1=ex2;ex2=temp}if(ey1>ey2){var _temp=ey1;ey1=ey2;ey2=_temp}updateBounds(bounds,ex1-wHalf,ey1-wHalf,ex2+wHalf,ey2+wHalf)}else{var pts=rstyle.bezierPts||rstyle.linePts||[];for(var j=0;j<pts.length;j++){var pt=pts[j];ex1=pt.x-wHalf;ex2=pt.x+wHalf;ey1=pt.y-wHalf;ey2=pt.y+wHalf;updateBounds(bounds,ex1,ey1,ex2,ey2)}if(pts.length===0){var n1=ele.source();var n1pos=n1.position();var n2=ele.target();var n2pos=n2.position();ex1=n1pos.x;ex2=n2pos.x;ey1=n1pos.y;ey2=n2pos.y;if(ex1>ex2){var _temp2=ex1;ex1=ex2;ex2=_temp2}if(ey1>ey2){var _temp3=ey1;ey1=ey2;ey2=_temp3}ex1-=wHalf;ex2+=wHalf;ey1-=wHalf;ey2+=wHalf;updateBounds(bounds,ex1,ey1,ex2,ey2)}}}if(styleEnabled&&options.includeEdges&&isEdge){updateBoundsFromArrow(bounds,ele,"mid-source");updateBoundsFromArrow(bounds,ele,"mid-target");updateBoundsFromArrow(bounds,ele,"source");updateBoundsFromArrow(bounds,ele,"target")}if(styleEnabled){var ghost=ele.pstyle("ghost").value==="yes";if(ghost){var gx=ele.pstyle("ghost-offset-x").pfValue;var gy=ele.pstyle("ghost-offset-y").pfValue;updateBounds(bounds,bounds.x1+gx,bounds.y1+gy,bounds.x2+gx,bounds.y2+gy)}}var bbBody=_p.bodyBounds=_p.bodyBounds||{};assignBoundingBox(bbBody,bounds);expandBoundingBoxSides(bbBody,manualExpansion);expandBoundingBox(bbBody,1);if(styleEnabled){ex1=bounds.x1;ex2=bounds.x2;ey1=bounds.y1;ey2=bounds.y2;updateBounds(bounds,ex1-overlayPadding,ey1-overlayPadding,ex2+overlayPadding,ey2+overlayPadding)}var bbOverlay=_p.overlayBounds=_p.overlayBounds||{};assignBoundingBox(bbOverlay,bounds);expandBoundingBoxSides(bbOverlay,manualExpansion);expandBoundingBox(bbOverlay,1);var bbLabels=_p.labelBounds=_p.labelBounds||{};if(bbLabels.all!=null){clearBoundingBox(bbLabels.all)}else{bbLabels.all=makeBoundingBox()}if(styleEnabled&&options.includeLabels){if(options.includeMainLabels){updateBoundsFromLabel(bounds,ele,null)}if(isEdge){if(options.includeSourceLabels){updateBoundsFromLabel(bounds,ele,"source")}if(options.includeTargetLabels){updateBoundsFromLabel(bounds,ele,"target")}}}}bounds.x1=noninf(bounds.x1);bounds.y1=noninf(bounds.y1);bounds.x2=noninf(bounds.x2);bounds.y2=noninf(bounds.y2);bounds.w=noninf(bounds.x2-bounds.x1);bounds.h=noninf(bounds.y2-bounds.y1);if(bounds.w>0&&bounds.h>0&&displayed){expandBoundingBoxSides(bounds,manualExpansion);expandBoundingBox(bounds,1)}return bounds};var getKey=function getKey(opts){var i=0;var tf=function tf(val){return(val?1:0)<<i++};var key=0;key+=tf(opts.incudeNodes);key+=tf(opts.includeEdges);key+=tf(opts.includeLabels);key+=tf(opts.includeMainLabels);key+=tf(opts.includeSourceLabels);key+=tf(opts.includeTargetLabels);key+=tf(opts.includeOverlays);return key};var getBoundingBoxPosKey=function getBoundingBoxPosKey(ele){if(ele.isEdge()){var p1=ele.source().position();var p2=ele.target().position();var r=function r(x){return Math.round(x)};return hashIntsArray([r(p1.x),r(p1.y),r(p2.x),r(p2.y)])}else{return 0}};var cachedBoundingBoxImpl=function cachedBoundingBoxImpl(ele,opts){var _p=ele._private;var bb;var isEdge=ele.isEdge();var key=opts==null?defBbOptsKey:getKey(opts);var usingDefOpts=key===defBbOptsKey;var currPosKey=getBoundingBoxPosKey(ele);var isPosKeySame=_p.bbCachePosKey===currPosKey;var useCache=opts.useCache&&isPosKeySame;var needRecalc=!useCache||_p.bbCache==null;if(needRecalc){if(!isPosKeySame){ele.recalculateRenderedStyle()}bb=boundingBoxImpl(ele,defBbOpts);_p.bbCache=bb;_p.bbCacheShift.x=_p.bbCacheShift.y=0;_p.bbCachePosKey=currPosKey}else{bb=_p.bbCache}if(!needRecalc&&(_p.bbCacheShift.x!==0||_p.bbCacheShift.y!==0)){var shift=assignShiftToBoundingBox;var delta=_p.bbCacheShift;var safeShift=function safeShift(bb,delta){if(bb!=null){shift(bb,delta)}};shift(bb,delta);var bodyBounds=_p.bodyBounds,overlayBounds=_p.overlayBounds,labelBounds=_p.labelBounds,arrowBounds=_p.arrowBounds;safeShift(bodyBounds,delta);safeShift(overlayBounds,delta);if(arrowBounds!=null){safeShift(arrowBounds.source,delta);safeShift(arrowBounds.target,delta);safeShift(arrowBounds["mid-source"],delta);safeShift(arrowBounds["mid-target"],delta)}if(labelBounds!=null){safeShift(labelBounds.main,delta);safeShift(labelBounds.all,delta);safeShift(labelBounds.source,delta);safeShift(labelBounds.target,delta)}}_p.bbCacheShift.x=_p.bbCacheShift.y=0;if(!usingDefOpts){var isNode=ele.isNode();bb=makeBoundingBox();if(opts.includeNodes&&isNode||opts.includeEdges&&!isNode){if(opts.includeOverlays){updateBoundsFromBox(bb,_p.overlayBounds)}else{updateBoundsFromBox(bb,_p.bodyBounds)}}if(opts.includeLabels){if(opts.includeMainLabels&&(!isEdge||opts.includeSourceLabels&&opts.includeTargetLabels)){updateBoundsFromBox(bb,_p.labelBounds.all)}else{if(opts.includeMainLabels){updateBoundsFromBox(bb,_p.labelBounds.main)}if(opts.includeSourceLabels){updateBoundsFromBox(bb,_p.labelBounds.source)}if(opts.includeTargetLabels){updateBoundsFromBox(bb,_p.labelBounds.target)}}}bb.w=bb.x2-bb.x1;bb.h=bb.y2-bb.y1}return bb};var defBbOpts={includeNodes:true,includeEdges:true,includeLabels:true,includeMainLabels:true,includeSourceLabels:true,includeTargetLabels:true,includeOverlays:true,useCache:true};var defBbOptsKey=getKey(defBbOpts);var filledBbOpts=defaults(defBbOpts);elesfn$j.boundingBox=function(options){var bounds;if(this.length===1&&this[0]._private.bbCache!=null&&(options===undefined||options.useCache===undefined||options.useCache===true)){if(options===undefined){options=defBbOpts}else{options=filledBbOpts(options)}bounds=cachedBoundingBoxImpl(this[0],options)}else{bounds=makeBoundingBox();options=options||defBbOpts;var opts=filledBbOpts(options);var eles=this;var cy=eles.cy();var styleEnabled=cy.styleEnabled();if(styleEnabled){for(var i=0;i<eles.length;i++){var ele=eles[i];var _p=ele._private;var currPosKey=getBoundingBoxPosKey(ele);var isPosKeySame=_p.bbCachePosKey===currPosKey;var useCache=opts.useCache&&isPosKeySame;ele.recalculateRenderedStyle(useCache)}}this.updateCompoundBounds();for(var _i=0;_i<eles.length;_i++){var _ele=eles[_i];updateBoundsFromBox(bounds,cachedBoundingBoxImpl(_ele,opts))}}bounds.x1=noninf(bounds.x1);bounds.y1=noninf(bounds.y1);bounds.x2=noninf(bounds.x2);bounds.y2=noninf(bounds.y2);bounds.w=noninf(bounds.x2-bounds.x1);bounds.h=noninf(bounds.y2-bounds.y1);return bounds};elesfn$j.dirtyBoundingBoxCache=function(){for(var i=0;i<this.length;i++){var _p=this[i]._private;_p.bbCache=null;_p.bbCacheShift.x=_p.bbCacheShift.y=0;_p.bbCachePosKey=null;_p.bodyBounds=null;_p.overlayBounds=null;_p.labelBounds.all=null;_p.labelBounds.source=null;_p.labelBounds.target=null;_p.labelBounds.main=null;_p.arrowBounds.source=null;_p.arrowBounds.target=null;_p.arrowBounds["mid-source"]=null;_p.arrowBounds["mid-target"]=null}this.emitAndNotify("bounds");return this};elesfn$j.shiftCachedBoundingBox=function(delta){for(var i=0;i<this.length;i++){var ele=this[i];var _p=ele._private;var bb=_p.bbCache;if(bb!=null){_p.bbCacheShift.x+=delta.x;_p.bbCacheShift.y+=delta.y}}this.emitAndNotify("bounds");return this};elesfn$j.boundingBoxAt=function(fn){var nodes=this.nodes();var cy=this.cy();var hasCompoundNodes=cy.hasCompoundNodes();if(hasCompoundNodes){nodes=nodes.filter((function(node){return!node.isParent()}))}if(plainObject(fn)){var obj=fn;fn=function fn(){return obj}}var storeOldPos=function storeOldPos(node,i){return node._private.bbAtOldPos=fn(node,i)};var getOldPos=function getOldPos(node){return node._private.bbAtOldPos};cy.startBatch();nodes.forEach(storeOldPos).silentPositions(fn);if(hasCompoundNodes){this.updateCompoundBounds(true)}var bb=copyBoundingBox(this.boundingBox({useCache:false}));nodes.silentPositions(getOldPos);cy.endBatch();return bb};fn$3.boundingbox=fn$3.bb=fn$3.boundingBox;fn$3.renderedBoundingbox=fn$3.renderedBoundingBox;var bounds=elesfn$j;var fn$4,elesfn$k;fn$4=elesfn$k={};var defineDimFns=function defineDimFns(opts){opts.uppercaseName=capitalize(opts.name);opts.autoName="auto"+opts.uppercaseName;opts.labelName="label"+opts.uppercaseName;opts.outerName="outer"+opts.uppercaseName;opts.uppercaseOuterName=capitalize(opts.outerName);fn$4[opts.name]=function dimImpl(){var ele=this[0];var _p=ele._private;var cy=_p.cy;var styleEnabled=cy._private.styleEnabled;if(ele){if(styleEnabled){if(ele.isParent()){ele.updateCompoundBounds();return _p[opts.autoName]||0}var d=ele.pstyle(opts.name);switch(d.strValue){case"label":ele.recalculateRenderedStyle();return _p.rstyle[opts.labelName]||0;default:return d.pfValue}}else{return 1}}};fn$4["outer"+opts.uppercaseName]=function outerDimImpl(){var ele=this[0];var _p=ele._private;var cy=_p.cy;var styleEnabled=cy._private.styleEnabled;if(ele){if(styleEnabled){var dim=ele[opts.name]();var border=ele.pstyle("border-width").pfValue;var padding=2*ele.padding();return dim+border+padding}else{return 1}}};fn$4["rendered"+opts.uppercaseName]=function renderedDimImpl(){var ele=this[0];if(ele){var d=ele[opts.name]();return d*this.cy().zoom()}};fn$4["rendered"+opts.uppercaseOuterName]=function renderedOuterDimImpl(){var ele=this[0];if(ele){var od=ele[opts.outerName]();return od*this.cy().zoom()}}};defineDimFns({name:"width"});defineDimFns({name:"height"});elesfn$k.padding=function(){var ele=this[0];var _p=ele._private;if(ele.isParent()){ele.updateCompoundBounds();if(_p.autoPadding!==undefined){return _p.autoPadding}else{return ele.pstyle("padding").pfValue}}else{return ele.pstyle("padding").pfValue}};elesfn$k.paddedHeight=function(){var ele=this[0];return ele.height()+2*ele.padding()};elesfn$k.paddedWidth=function(){var ele=this[0];return ele.width()+2*ele.padding()};var widthHeight=elesfn$k;var ifEdge=function ifEdge(ele,getValue){if(ele.isEdge()){return getValue(ele)}};var ifEdgeRenderedPosition=function ifEdgeRenderedPosition(ele,getPoint){if(ele.isEdge()){var cy=ele.cy();return modelToRenderedPosition(getPoint(ele),cy.zoom(),cy.pan())}};var ifEdgeRenderedPositions=function ifEdgeRenderedPositions(ele,getPoints){if(ele.isEdge()){var cy=ele.cy();var pan=cy.pan();var zoom=cy.zoom();return getPoints(ele).map((function(p){return modelToRenderedPosition(p,zoom,pan)}))}};var controlPoints=function controlPoints(ele){return ele.renderer().getControlPoints(ele)};var segmentPoints=function segmentPoints(ele){return ele.renderer().getSegmentPoints(ele)};var sourceEndpoint=function sourceEndpoint(ele){return ele.renderer().getSourceEndpoint(ele)};var targetEndpoint=function targetEndpoint(ele){return ele.renderer().getTargetEndpoint(ele)};var midpoint=function midpoint(ele){return ele.renderer().getEdgeMidpoint(ele)};var pts={controlPoints:{get:controlPoints,mult:true},segmentPoints:{get:segmentPoints,mult:true},sourceEndpoint:{get:sourceEndpoint},targetEndpoint:{get:targetEndpoint},midpoint:{get:midpoint}};var renderedName=function renderedName(name){return"rendered"+name[0].toUpperCase()+name.substr(1)};var edgePoints=Object.keys(pts).reduce((function(obj,name){var spec=pts[name];var rName=renderedName(name);obj[name]=function(){return ifEdge(this,spec.get)};if(spec.mult){obj[rName]=function(){return ifEdgeRenderedPositions(this,spec.get)}}else{obj[rName]=function(){return ifEdgeRenderedPosition(this,spec.get)}}return obj}),{});var dimensions=extend({},position,bounds,widthHeight,edgePoints);
/*!
Event object based on jQuery events, MIT license

https://jquery.org/license/
https://tldrlegal.com/license/mit-license
https://github.com/jquery/jquery/blob/master/src/event.js
*/var Event=function Event(src,props){this.recycle(src,props)};function returnFalse(){return false}function returnTrue(){return true}Event.prototype={instanceString:function instanceString(){return"event"},recycle:function recycle(src,props){this.isImmediatePropagationStopped=this.isPropagationStopped=this.isDefaultPrevented=returnFalse;if(src!=null&&src.preventDefault){this.type=src.type;this.isDefaultPrevented=src.defaultPrevented?returnTrue:returnFalse}else if(src!=null&&src.type){props=src}else{this.type=src}if(props!=null){this.originalEvent=props.originalEvent;this.type=props.type!=null?props.type:this.type;this.cy=props.cy;this.target=props.target;this.position=props.position;this.renderedPosition=props.renderedPosition;this.namespace=props.namespace;this.layout=props.layout}if(this.cy!=null&&this.position!=null&&this.renderedPosition==null){var pos=this.position;var zoom=this.cy.zoom();var pan=this.cy.pan();this.renderedPosition={x:pos.x*zoom+pan.x,y:pos.y*zoom+pan.y}}this.timeStamp=src&&src.timeStamp||Date.now()},preventDefault:function preventDefault(){this.isDefaultPrevented=returnTrue;var e=this.originalEvent;if(!e){return}if(e.preventDefault){e.preventDefault()}},stopPropagation:function stopPropagation(){this.isPropagationStopped=returnTrue;var e=this.originalEvent;if(!e){return}if(e.stopPropagation){e.stopPropagation()}},stopImmediatePropagation:function stopImmediatePropagation(){this.isImmediatePropagationStopped=returnTrue;this.stopPropagation()},isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse};var eventRegex=/^([^.]+)(\.(?:[^.]+))?$/;var universalNamespace=".*";var defaults$8={qualifierCompare:function qualifierCompare(q1,q2){return q1===q2},eventMatches:function eventMatches(){return true},addEventFields:function addEventFields(){},callbackContext:function callbackContext(context){return context},beforeEmit:function beforeEmit(){},afterEmit:function afterEmit(){},bubble:function bubble(){return false},parent:function parent(){return null},context:null};var defaultsKeys=Object.keys(defaults$8);var emptyOpts={};function Emitter(){var opts=arguments.length>0&&arguments[0]!==undefined?arguments[0]:emptyOpts;var context=arguments.length>1?arguments[1]:undefined;for(var i=0;i<defaultsKeys.length;i++){var key=defaultsKeys[i];this[key]=opts[key]||defaults$8[key]}this.context=context||this.context;this.listeners=[];this.emitting=0}var p=Emitter.prototype;var forEachEvent=function forEachEvent(self,handler,events,qualifier,callback,conf,confOverrides){if(fn(qualifier)){callback=qualifier;qualifier=null}if(confOverrides){if(conf==null){conf=confOverrides}else{conf=extend({},conf,confOverrides)}}var eventList=array(events)?events:events.split(/\s+/);for(var i=0;i<eventList.length;i++){var evt=eventList[i];if(emptyString(evt)){continue}var match=evt.match(eventRegex);if(match){var type=match[1];var namespace=match[2]?match[2]:null;var ret=handler(self,evt,type,namespace,qualifier,callback,conf);if(ret===false){break}}}};var makeEventObj=function makeEventObj(self,obj){self.addEventFields(self.context,obj);return new Event(obj.type,obj)};var forEachEventObj=function forEachEventObj(self,handler,events){if(event(events)){handler(self,events);return}else if(plainObject(events)){handler(self,makeEventObj(self,events));return}var eventList=array(events)?events:events.split(/\s+/);for(var i=0;i<eventList.length;i++){var evt=eventList[i];if(emptyString(evt)){continue}var match=evt.match(eventRegex);if(match){var type=match[1];var namespace=match[2]?match[2]:null;var eventObj=makeEventObj(self,{type:type,namespace:namespace,target:self.context});handler(self,eventObj)}}};p.on=p.addListener=function(events,qualifier,callback,conf,confOverrides){forEachEvent(this,(function(self,event,type,namespace,qualifier,callback,conf){if(fn(callback)){self.listeners.push({event:event,callback:callback,type:type,namespace:namespace,qualifier:qualifier,conf:conf})}}),events,qualifier,callback,conf,confOverrides);return this};p.one=function(events,qualifier,callback,conf){return this.on(events,qualifier,callback,conf,{one:true})};p.removeListener=p.off=function(events,qualifier,callback,conf){var _this=this;if(this.emitting!==0){this.listeners=copyArray(this.listeners)}var listeners=this.listeners;var _loop=function _loop(i){var listener=listeners[i];forEachEvent(_this,(function(self,event,type,namespace,qualifier,callback){if((listener.type===type||events==="*")&&(!namespace&&listener.namespace!==".*"||listener.namespace===namespace)&&(!qualifier||self.qualifierCompare(listener.qualifier,qualifier))&&(!callback||listener.callback===callback)){listeners.splice(i,1);return false}}),events,qualifier,callback,conf)};for(var i=listeners.length-1;i>=0;i--){_loop(i)}return this};p.removeAllListeners=function(){return this.removeListener("*")};p.emit=p.trigger=function(events,extraParams,manualCallback){var listeners=this.listeners;var numListenersBeforeEmit=listeners.length;this.emitting++;if(!array(extraParams)){extraParams=[extraParams]}forEachEventObj(this,(function(self,eventObj){if(manualCallback!=null){listeners=[{event:eventObj.event,type:eventObj.type,namespace:eventObj.namespace,callback:manualCallback}];numListenersBeforeEmit=listeners.length}var _loop2=function _loop2(i){var listener=listeners[i];if(listener.type===eventObj.type&&(!listener.namespace||listener.namespace===eventObj.namespace||listener.namespace===universalNamespace)&&self.eventMatches(self.context,listener,eventObj)){var args=[eventObj];if(extraParams!=null){push(args,extraParams)}self.beforeEmit(self.context,listener,eventObj);if(listener.conf&&listener.conf.one){self.listeners=self.listeners.filter((function(l){return l!==listener}))}var context=self.callbackContext(self.context,listener,eventObj);var ret=listener.callback.apply(context,args);self.afterEmit(self.context,listener,eventObj);if(ret===false){eventObj.stopPropagation();eventObj.preventDefault()}}};for(var i=0;i<numListenersBeforeEmit;i++){_loop2(i)}if(self.bubble(self.context)&&!eventObj.isPropagationStopped()){self.parent(self.context).emit(eventObj,extraParams)}}),events);this.emitting--;return this};var emitterOptions={qualifierCompare:function qualifierCompare(selector1,selector2){if(selector1==null||selector2==null){return selector1==null&&selector2==null}else{return selector1.sameText(selector2)}},eventMatches:function eventMatches(ele,listener,eventObj){var selector=listener.qualifier;if(selector!=null){return ele!==eventObj.target&&element(eventObj.target)&&selector.matches(eventObj.target)}return true},addEventFields:function addEventFields(ele,evt){evt.cy=ele.cy();evt.target=ele},callbackContext:function callbackContext(ele,listener,eventObj){return listener.qualifier!=null?eventObj.target:ele},beforeEmit:function beforeEmit(context,listener){if(listener.conf&&listener.conf.once){listener.conf.onceCollection.removeListener(listener.event,listener.qualifier,listener.callback)}},bubble:function bubble(){return true},parent:function parent(ele){return ele.isChild()?ele.parent():ele.cy()}};var argSelector=function argSelector(arg){if(string(arg)){return new Selector(arg)}else{return arg}};var elesfn$l={createEmitter:function createEmitter(){for(var i=0;i<this.length;i++){var ele=this[i];var _p=ele._private;if(!_p.emitter){_p.emitter=new Emitter(emitterOptions,ele)}}return this},emitter:function emitter(){return this._private.emitter},on:function on(events,selector,callback){var argSel=argSelector(selector);for(var i=0;i<this.length;i++){var ele=this[i];ele.emitter().on(events,argSel,callback)}return this},removeListener:function removeListener(events,selector,callback){var argSel=argSelector(selector);for(var i=0;i<this.length;i++){var ele=this[i];ele.emitter().removeListener(events,argSel,callback)}return this},removeAllListeners:function removeAllListeners(){for(var i=0;i<this.length;i++){var ele=this[i];ele.emitter().removeAllListeners()}return this},one:function one(events,selector,callback){var argSel=argSelector(selector);for(var i=0;i<this.length;i++){var ele=this[i];ele.emitter().one(events,argSel,callback)}return this},once:function once(events,selector,callback){var argSel=argSelector(selector);for(var i=0;i<this.length;i++){var ele=this[i];ele.emitter().on(events,argSel,callback,{once:true,onceCollection:this})}},emit:function emit(events,extraParams){for(var i=0;i<this.length;i++){var ele=this[i];ele.emitter().emit(events,extraParams)}return this},emitAndNotify:function emitAndNotify(event,extraParams){if(this.length===0){return}this.cy().notify(event,this);this.emit(event,extraParams);return this}};define$3.eventAliasesOn(elesfn$l);var elesfn$m={nodes:function nodes(selector){return this.filter((function(ele){return ele.isNode()})).filter(selector)},edges:function edges(selector){return this.filter((function(ele){return ele.isEdge()})).filter(selector)},byGroup:function byGroup(){var nodes=this.spawn();var edges=this.spawn();for(var i=0;i<this.length;i++){var ele=this[i];if(ele.isNode()){nodes.merge(ele)}else{edges.merge(ele)}}return{nodes:nodes,edges:edges}},filter:function filter(_filter,thisArg){if(_filter===undefined){return this}else if(string(_filter)||elementOrCollection(_filter)){return new Selector(_filter).filter(this)}else if(fn(_filter)){var filterEles=this.spawn();var eles=this;for(var i=0;i<eles.length;i++){var ele=eles[i];var include=thisArg?_filter.apply(thisArg,[ele,i,eles]):_filter(ele,i,eles);if(include){filterEles.merge(ele)}}return filterEles}return this.spawn()},not:function not(toRemove){if(!toRemove){return this}else{if(string(toRemove)){toRemove=this.filter(toRemove)}var elements=[];var rMap=toRemove._private.map;for(var i=0;i<this.length;i++){var element=this[i];var remove=rMap.has(element.id());if(!remove){elements.push(element)}}return this.spawn(elements)}},absoluteComplement:function absoluteComplement(){var cy=this.cy();return cy.mutableElements().not(this)},intersect:function intersect(other){if(string(other)){var selector=other;return this.filter(selector)}var elements=[];var col1=this;var col2=other;var col1Smaller=this.length<other.length;var map2=col1Smaller?col2._private.map:col1._private.map;var col=col1Smaller?col1:col2;for(var i=0;i<col.length;i++){var id=col[i]._private.data.id;var entry=map2.get(id);if(entry){elements.push(entry.ele)}}return this.spawn(elements)},xor:function xor(other){var cy=this._private.cy;if(string(other)){other=cy.$(other)}var elements=[];var col1=this;var col2=other;var add=function add(col,other){for(var i=0;i<col.length;i++){var ele=col[i];var id=ele._private.data.id;var inOther=other.hasElementWithId(id);if(!inOther){elements.push(ele)}}};add(col1,col2);add(col2,col1);return this.spawn(elements)},diff:function diff(other){var cy=this._private.cy;if(string(other)){other=cy.$(other)}var left=[];var right=[];var both=[];var col1=this;var col2=other;var add=function add(col,other,retEles){for(var i=0;i<col.length;i++){var ele=col[i];var id=ele._private.data.id;var inOther=other.hasElementWithId(id);if(inOther){both.push(ele)}else{retEles.push(ele)}}};add(col1,col2,left);add(col2,col1,right);return{left:this.spawn(left,{unique:true}),right:this.spawn(right,{unique:true}),both:this.spawn(both,{unique:true})}},add:function add(toAdd){var cy=this._private.cy;if(!toAdd){return this}if(string(toAdd)){var selector=toAdd;toAdd=cy.mutableElements().filter(selector)}var elements=[];for(var i=0;i<this.length;i++){elements.push(this[i])}var map=this._private.map;for(var _i=0;_i<toAdd.length;_i++){var add=!map.has(toAdd[_i].id());if(add){elements.push(toAdd[_i])}}return this.spawn(elements)},merge:function merge(toAdd){var _p=this._private;var cy=_p.cy;if(!toAdd){return this}if(toAdd&&string(toAdd)){var selector=toAdd;toAdd=cy.mutableElements().filter(selector)}var map=_p.map;for(var i=0;i<toAdd.length;i++){var toAddEle=toAdd[i];var id=toAddEle._private.data.id;var add=!map.has(id);if(add){var index=this.length++;this[index]=toAddEle;map.set(id,{ele:toAddEle,index:index})}else{var _index=map.get(id).index;this[_index]=toAddEle;map.set(id,{ele:toAddEle,index:_index})}}return this},unmergeAt:function unmergeAt(i){var ele=this[i];var id=ele.id();var _p=this._private;var map=_p.map;this[i]=undefined;map["delete"](id);var unmergedLastEle=i===this.length-1;if(this.length>1&&!unmergedLastEle){var lastEleI=this.length-1;var lastEle=this[lastEleI];var lastEleId=lastEle._private.data.id;this[lastEleI]=undefined;this[i]=lastEle;map.set(lastEleId,{ele:lastEle,index:i})}this.length--;return this},unmergeOne:function unmergeOne(ele){ele=ele[0];var _p=this._private;var id=ele._private.data.id;var map=_p.map;var entry=map.get(id);if(!entry){return this}var i=entry.index;this.unmergeAt(i);return this},unmerge:function unmerge(toRemove){var cy=this._private.cy;if(!toRemove){return this}if(toRemove&&string(toRemove)){var selector=toRemove;toRemove=cy.mutableElements().filter(selector)}for(var i=0;i<toRemove.length;i++){this.unmergeOne(toRemove[i])}return this},unmergeBy:function unmergeBy(toRmFn){for(var i=this.length-1;i>=0;i--){var ele=this[i];if(toRmFn(ele)){this.unmergeAt(i)}}return this},map:function map(mapFn,thisArg){var arr=[];var eles=this;for(var i=0;i<eles.length;i++){var ele=eles[i];var ret=thisArg?mapFn.apply(thisArg,[ele,i,eles]):mapFn(ele,i,eles);arr.push(ret)}return arr},reduce:function reduce(fn,initialValue){var val=initialValue;var eles=this;for(var i=0;i<eles.length;i++){val=fn(val,eles[i],i,eles)}return val},max:function max(valFn,thisArg){var max=-Infinity;var maxEle;var eles=this;for(var i=0;i<eles.length;i++){var ele=eles[i];var val=thisArg?valFn.apply(thisArg,[ele,i,eles]):valFn(ele,i,eles);if(val>max){max=val;maxEle=ele}}return{value:max,ele:maxEle}},min:function min(valFn,thisArg){var min=Infinity;var minEle;var eles=this;for(var i=0;i<eles.length;i++){var ele=eles[i];var val=thisArg?valFn.apply(thisArg,[ele,i,eles]):valFn(ele,i,eles);if(val<min){min=val;minEle=ele}}return{value:min,ele:minEle}}};var fn$5=elesfn$m;fn$5["u"]=fn$5["|"]=fn$5["+"]=fn$5.union=fn$5.or=fn$5.add;fn$5["\\"]=fn$5["!"]=fn$5["-"]=fn$5.difference=fn$5.relativeComplement=fn$5.subtract=fn$5.not;fn$5["n"]=fn$5["&"]=fn$5["."]=fn$5.and=fn$5.intersection=fn$5.intersect;fn$5["^"]=fn$5["(+)"]=fn$5["(-)"]=fn$5.symmetricDifference=fn$5.symdiff=fn$5.xor;fn$5.fnFilter=fn$5.filterFn=fn$5.stdFilter=fn$5.filter;fn$5.complement=fn$5.abscomp=fn$5.absoluteComplement;var elesfn$n={isNode:function isNode(){return this.group()==="nodes"},isEdge:function isEdge(){return this.group()==="edges"},isLoop:function isLoop(){return this.isEdge()&&this.source()[0]===this.target()[0]},isSimple:function isSimple(){return this.isEdge()&&this.source()[0]!==this.target()[0]},group:function group(){var ele=this[0];if(ele){return ele._private.group}}};var zIndexSort=function zIndexSort(a,b){var cy=a.cy();var hasCompoundNodes=cy.hasCompoundNodes();function getDepth(ele){var style=ele.pstyle("z-compound-depth");if(style.value==="auto"){return hasCompoundNodes?ele.zDepth():0}else if(style.value==="bottom"){return-1}else if(style.value==="top"){return MAX_INT}return 0}var depthDiff=getDepth(a)-getDepth(b);if(depthDiff!==0){return depthDiff}function getEleDepth(ele){var style=ele.pstyle("z-index-compare");if(style.value==="auto"){return ele.isNode()?1:0}return 0}var eleDiff=getEleDepth(a)-getEleDepth(b);if(eleDiff!==0){return eleDiff}var zDiff=a.pstyle("z-index").value-b.pstyle("z-index").value;if(zDiff!==0){return zDiff}return a.poolIndex()-b.poolIndex()};var elesfn$o={forEach:function forEach(fn$1,thisArg){if(fn(fn$1)){var N=this.length;for(var i=0;i<N;i++){var ele=this[i];var ret=thisArg?fn$1.apply(thisArg,[ele,i,this]):fn$1(ele,i,this);if(ret===false){break}}}return this},toArray:function toArray(){var array=[];for(var i=0;i<this.length;i++){array.push(this[i])}return array},slice:function slice(start,end){var array=[];var thisSize=this.length;if(end==null){end=thisSize}if(start==null){start=0}if(start<0){start=thisSize+start}if(end<0){end=thisSize+end}for(var i=start;i>=0&&i<end&&i<thisSize;i++){array.push(this[i])}return this.spawn(array)},size:function size(){return this.length},eq:function eq(i){return this[i]||this.spawn()},first:function first(){return this[0]||this.spawn()},last:function last(){return this[this.length-1]||this.spawn()},empty:function empty(){return this.length===0},nonempty:function nonempty(){return!this.empty()},sort:function sort(sortFn){if(!fn(sortFn)){return this}var sorted=this.toArray().sort(sortFn);return this.spawn(sorted)},sortByZIndex:function sortByZIndex(){return this.sort(zIndexSort)},zDepth:function zDepth(){var ele=this[0];if(!ele){return undefined}var _p=ele._private;var group=_p.group;if(group==="nodes"){var depth=_p.data.parent?ele.parents().size():0;if(!ele.isParent()){return MAX_INT-1}return depth}else{var src=_p.source;var tgt=_p.target;var srcDepth=src.zDepth();var tgtDepth=tgt.zDepth();return Math.max(srcDepth,tgtDepth,0)}}};elesfn$o.each=elesfn$o.forEach;var getLayoutDimensionOptions=defaults({nodeDimensionsIncludeLabels:false});var elesfn$p={layoutDimensions:function layoutDimensions(options){options=getLayoutDimensionOptions(options);var dims;if(!this.takesUpSpace()){dims={w:0,h:0}}else if(options.nodeDimensionsIncludeLabels){var bbDim=this.boundingBox();dims={w:bbDim.w,h:bbDim.h}}else{dims={w:this.outerWidth(),h:this.outerHeight()}}if(dims.w===0||dims.h===0){dims.w=dims.h=1}return dims},layoutPositions:function layoutPositions(layout,options,fn){var nodes=this.nodes();var cy=this.cy();var layoutEles=options.eles;var getMemoizeKey=function getMemoizeKey(node){return node.id()};var fnMem=memoize(fn,getMemoizeKey);layout.emit({type:"layoutstart",layout:layout});layout.animations=[];var calculateSpacing=function calculateSpacing(spacing,nodesBb,pos){var center={x:nodesBb.x1+nodesBb.w/2,y:nodesBb.y1+nodesBb.h/2};var spacingVector={x:(pos.x-center.x)*spacing,y:(pos.y-center.y)*spacing};return{x:center.x+spacingVector.x,y:center.y+spacingVector.y}};var useSpacingFactor=options.spacingFactor&&options.spacingFactor!==1;var spacingBb=function spacingBb(){if(!useSpacingFactor){return null}var bb=makeBoundingBox();for(var i=0;i<nodes.length;i++){var node=nodes[i];var pos=fnMem(node,i);expandBoundingBoxByPoint(bb,pos.x,pos.y)}return bb};var bb=spacingBb();var getFinalPos=memoize((function(node,i){var newPos=fnMem(node,i);if(useSpacingFactor){var spacing=Math.abs(options.spacingFactor);newPos=calculateSpacing(spacing,bb,newPos)}if(options.transform!=null){newPos=options.transform(node,newPos)}return newPos}),getMemoizeKey);if(options.animate){for(var i=0;i<nodes.length;i++){var node=nodes[i];var newPos=getFinalPos(node,i);var animateNode=options.animateFilter==null||options.animateFilter(node,i);if(animateNode){var ani=node.animation({position:newPos,duration:options.animationDuration,easing:options.animationEasing});layout.animations.push(ani)}else{node.position(newPos)}}if(options.fit){var fitAni=cy.animation({fit:{boundingBox:layoutEles.boundingBoxAt(getFinalPos),padding:options.padding},duration:options.animationDuration,easing:options.animationEasing});layout.animations.push(fitAni)}else if(options.zoom!==undefined&&options.pan!==undefined){var zoomPanAni=cy.animation({zoom:options.zoom,pan:options.pan,duration:options.animationDuration,easing:options.animationEasing});layout.animations.push(zoomPanAni)}layout.animations.forEach((function(ani){return ani.play()}));layout.one("layoutready",options.ready);layout.emit({type:"layoutready",layout:layout});Promise$1.all(layout.animations.map((function(ani){return ani.promise()}))).then((function(){layout.one("layoutstop",options.stop);layout.emit({type:"layoutstop",layout:layout})}))}else{nodes.positions(getFinalPos);if(options.fit){cy.fit(options.eles,options.padding)}if(options.zoom!=null){cy.zoom(options.zoom)}if(options.pan){cy.pan(options.pan)}layout.one("layoutready",options.ready);layout.emit({type:"layoutready",layout:layout});layout.one("layoutstop",options.stop);layout.emit({type:"layoutstop",layout:layout})}return this},layout:function layout(options){var cy=this.cy();return cy.makeLayout(extend({},options,{eles:this}))}};elesfn$p.createLayout=elesfn$p.makeLayout=elesfn$p.layout;function styleCache(key,fn,ele){var _p=ele._private;var cache=_p.styleCache=_p.styleCache||[];var val;if((val=cache[key])!=null){return val}else{val=cache[key]=fn(ele);return val}}function cacheStyleFunction(key,fn){key=hashString(key);return function cachedStyleFunction(ele){return styleCache(key,fn,ele)}}function cachePrototypeStyleFunction(key,fn){key=hashString(key);var selfFn=function selfFn(ele){return fn.call(ele)};return function cachedPrototypeStyleFunction(){var ele=this[0];if(ele){return styleCache(key,selfFn,ele)}}}var elesfn$q={recalculateRenderedStyle:function recalculateRenderedStyle(useCache){var cy=this.cy();var renderer=cy.renderer();var styleEnabled=cy.styleEnabled();if(renderer&&styleEnabled){renderer.recalculateRenderedStyle(this,useCache)}return this},dirtyStyleCache:function dirtyStyleCache(){var cy=this.cy();var dirty=function dirty(ele){return ele._private.styleCache=null};if(cy.hasCompoundNodes()){var eles;eles=this.spawnSelf().merge(this.descendants()).merge(this.parents());eles.merge(eles.connectedEdges());eles.forEach(dirty)}else{this.forEach((function(ele){dirty(ele);ele.connectedEdges().forEach(dirty)}))}return this},updateStyle:function updateStyle(notifyRenderer){var cy=this._private.cy;if(!cy.styleEnabled()){return this}if(cy.batching()){var bEles=cy._private.batchStyleEles;bEles.merge(this);return this}var hasCompounds=cy.hasCompoundNodes();var style=cy.style();var updatedEles=this;notifyRenderer=notifyRenderer||notifyRenderer===undefined?true:false;if(hasCompounds){updatedEles=this.spawnSelf().merge(this.descendants()).merge(this.parents())}var changedEles=style.apply(updatedEles);if(notifyRenderer){changedEles.emitAndNotify("style")}else{changedEles.emit("style")}return this},parsedStyle:function parsedStyle(property){var includeNonDefault=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var ele=this[0];var cy=ele.cy();if(!cy.styleEnabled()){return}if(ele){var overriddenStyle=ele._private.style[property];if(overriddenStyle!=null){return overriddenStyle}else if(includeNonDefault){return cy.style().getDefaultProperty(property)}else{return null}}},numericStyle:function numericStyle(property){var ele=this[0];if(!ele.cy().styleEnabled()){return}if(ele){var pstyle=ele.pstyle(property);return pstyle.pfValue!==undefined?pstyle.pfValue:pstyle.value}},numericStyleUnits:function numericStyleUnits(property){var ele=this[0];if(!ele.cy().styleEnabled()){return}if(ele){return ele.pstyle(property).units}},renderedStyle:function renderedStyle(property){var cy=this.cy();if(!cy.styleEnabled()){return this}var ele=this[0];if(ele){return cy.style().getRenderedStyle(ele,property)}},style:function style(name,value){var cy=this.cy();if(!cy.styleEnabled()){return this}var updateTransitions=false;var style=cy.style();if(plainObject(name)){var props=name;style.applyBypass(this,props,updateTransitions);this.emitAndNotify("style")}else if(string(name)){if(value===undefined){var ele=this[0];if(ele){return style.getStylePropertyValue(ele,name)}else{return}}else{style.applyBypass(this,name,value,updateTransitions);this.emitAndNotify("style")}}else if(name===undefined){var _ele=this[0];if(_ele){return style.getRawStyle(_ele)}else{return}}return this},removeStyle:function removeStyle(names){var cy=this.cy();if(!cy.styleEnabled()){return this}var updateTransitions=false;var style=cy.style();var eles=this;if(names===undefined){for(var i=0;i<eles.length;i++){var ele=eles[i];style.removeAllBypasses(ele,updateTransitions)}}else{names=names.split(/\s+/);for(var _i=0;_i<eles.length;_i++){var _ele2=eles[_i];style.removeBypasses(_ele2,names,updateTransitions)}}this.emitAndNotify("style");return this},show:function show(){this.css("display","element");return this},hide:function hide(){this.css("display","none");return this},effectiveOpacity:function effectiveOpacity(){var cy=this.cy();if(!cy.styleEnabled()){return 1}var hasCompoundNodes=cy.hasCompoundNodes();var ele=this[0];if(ele){var _p=ele._private;var parentOpacity=ele.pstyle("opacity").value;if(!hasCompoundNodes){return parentOpacity}var parents=!_p.data.parent?null:ele.parents();if(parents){for(var i=0;i<parents.length;i++){var parent=parents[i];var opacity=parent.pstyle("opacity").value;parentOpacity=opacity*parentOpacity}}return parentOpacity}},transparent:function transparent(){var cy=this.cy();if(!cy.styleEnabled()){return false}var ele=this[0];var hasCompoundNodes=ele.cy().hasCompoundNodes();if(ele){if(!hasCompoundNodes){return ele.pstyle("opacity").value===0}else{return ele.effectiveOpacity()===0}}},backgrounding:function backgrounding(){var cy=this.cy();if(!cy.styleEnabled()){return false}var ele=this[0];return ele._private.backgrounding?true:false}};function checkCompound(ele,parentOk){var _p=ele._private;var parents=_p.data.parent?ele.parents():null;if(parents){for(var i=0;i<parents.length;i++){var parent=parents[i];if(!parentOk(parent)){return false}}}return true}function defineDerivedStateFunction(specs){var ok=specs.ok;var edgeOkViaNode=specs.edgeOkViaNode||specs.ok;var parentOk=specs.parentOk||specs.ok;return function(){var cy=this.cy();if(!cy.styleEnabled()){return true}var ele=this[0];var hasCompoundNodes=cy.hasCompoundNodes();if(ele){var _p=ele._private;if(!ok(ele)){return false}if(ele.isNode()){return!hasCompoundNodes||checkCompound(ele,parentOk)}else{var src=_p.source;var tgt=_p.target;return edgeOkViaNode(src)&&(!hasCompoundNodes||checkCompound(src,edgeOkViaNode))&&(src===tgt||edgeOkViaNode(tgt)&&(!hasCompoundNodes||checkCompound(tgt,edgeOkViaNode)))}}}}var eleTakesUpSpace=cacheStyleFunction("eleTakesUpSpace",(function(ele){return ele.pstyle("display").value==="element"&&ele.width()!==0&&(ele.isNode()?ele.height()!==0:true)}));elesfn$q.takesUpSpace=cachePrototypeStyleFunction("takesUpSpace",defineDerivedStateFunction({ok:eleTakesUpSpace}));var eleInteractive=cacheStyleFunction("eleInteractive",(function(ele){return ele.pstyle("events").value==="yes"&&ele.pstyle("visibility").value==="visible"&&eleTakesUpSpace(ele)}));var parentInteractive=cacheStyleFunction("parentInteractive",(function(parent){return parent.pstyle("visibility").value==="visible"&&eleTakesUpSpace(parent)}));elesfn$q.interactive=cachePrototypeStyleFunction("interactive",defineDerivedStateFunction({ok:eleInteractive,parentOk:parentInteractive,edgeOkViaNode:eleTakesUpSpace}));elesfn$q.noninteractive=function(){var ele=this[0];if(ele){return!ele.interactive()}};var eleVisible=cacheStyleFunction("eleVisible",(function(ele){return ele.pstyle("visibility").value==="visible"&&ele.pstyle("opacity").pfValue!==0&&eleTakesUpSpace(ele)}));var edgeVisibleViaNode=eleTakesUpSpace;elesfn$q.visible=cachePrototypeStyleFunction("visible",defineDerivedStateFunction({ok:eleVisible,edgeOkViaNode:edgeVisibleViaNode}));elesfn$q.hidden=function(){var ele=this[0];if(ele){return!ele.visible()}};elesfn$q.isBundledBezier=cachePrototypeStyleFunction("isBundledBezier",(function(){if(!this.cy().styleEnabled()){return false}return!this.removed()&&this.pstyle("curve-style").value==="bezier"&&this.takesUpSpace()}));elesfn$q.bypass=elesfn$q.css=elesfn$q.style;elesfn$q.renderedCss=elesfn$q.renderedStyle;elesfn$q.removeBypass=elesfn$q.removeCss=elesfn$q.removeStyle;elesfn$q.pstyle=elesfn$q.parsedStyle;var elesfn$r={};function defineSwitchFunction(params){return function(){var args=arguments;var changedEles=[];if(args.length===2){var data=args[0];var handler=args[1];this.on(params.event,data,handler)}else if(args.length===1&&fn(args[0])){var _handler=args[0];this.on(params.event,_handler)}else if(args.length===0||args.length===1&&array(args[0])){var addlEvents=args.length===1?args[0]:null;for(var i=0;i<this.length;i++){var ele=this[i];var able=!params.ableField||ele._private[params.ableField];var changed=ele._private[params.field]!=params.value;if(params.overrideAble){var overrideAble=params.overrideAble(ele);if(overrideAble!==undefined){able=overrideAble;if(!overrideAble){return this}}}if(able){ele._private[params.field]=params.value;if(changed){changedEles.push(ele)}}}var changedColl=this.spawn(changedEles);changedColl.updateStyle();changedColl.emit(params.event);if(addlEvents){changedColl.emit(addlEvents)}}return this}}function defineSwitchSet(params){elesfn$r[params.field]=function(){var ele=this[0];if(ele){if(params.overrideField){var val=params.overrideField(ele);if(val!==undefined){return val}}return ele._private[params.field]}};elesfn$r[params.on]=defineSwitchFunction({event:params.on,field:params.field,ableField:params.ableField,overrideAble:params.overrideAble,value:true});elesfn$r[params.off]=defineSwitchFunction({event:params.off,field:params.field,ableField:params.ableField,overrideAble:params.overrideAble,value:false})}defineSwitchSet({field:"locked",overrideField:function overrideField(ele){return ele.cy().autolock()?true:undefined},on:"lock",off:"unlock"});defineSwitchSet({field:"grabbable",overrideField:function overrideField(ele){return ele.cy().autoungrabify()||ele.pannable()?false:undefined},on:"grabify",off:"ungrabify"});defineSwitchSet({field:"selected",ableField:"selectable",overrideAble:function overrideAble(ele){return ele.cy().autounselectify()?false:undefined},on:"select",off:"unselect"});defineSwitchSet({field:"selectable",overrideField:function overrideField(ele){return ele.cy().autounselectify()?false:undefined},on:"selectify",off:"unselectify"});elesfn$r.deselect=elesfn$r.unselect;elesfn$r.grabbed=function(){var ele=this[0];if(ele){return ele._private.grabbed}};defineSwitchSet({field:"active",on:"activate",off:"unactivate"});defineSwitchSet({field:"pannable",on:"panify",off:"unpanify"});elesfn$r.inactive=function(){var ele=this[0];if(ele){return!ele._private.active}};var elesfn$s={};var defineDagExtremity=function defineDagExtremity(params){return function dagExtremityImpl(selector){var eles=this;var ret=[];for(var i=0;i<eles.length;i++){var ele=eles[i];if(!ele.isNode()){continue}var disqualified=false;var edges=ele.connectedEdges();for(var j=0;j<edges.length;j++){var edge=edges[j];var src=edge.source();var tgt=edge.target();if(params.noIncomingEdges&&tgt===ele&&src!==ele||params.noOutgoingEdges&&src===ele&&tgt!==ele){disqualified=true;break}}if(!disqualified){ret.push(ele)}}return this.spawn(ret,{unique:true}).filter(selector)}};var defineDagOneHop=function defineDagOneHop(params){return function(selector){var eles=this;var oEles=[];for(var i=0;i<eles.length;i++){var ele=eles[i];if(!ele.isNode()){continue}var edges=ele.connectedEdges();for(var j=0;j<edges.length;j++){var edge=edges[j];var src=edge.source();var tgt=edge.target();if(params.outgoing&&src===ele){oEles.push(edge);oEles.push(tgt)}else if(params.incoming&&tgt===ele){oEles.push(edge);oEles.push(src)}}}return this.spawn(oEles,{unique:true}).filter(selector)}};var defineDagAllHops=function defineDagAllHops(params){return function(selector){var eles=this;var sEles=[];var sElesIds={};for(;;){var next=params.outgoing?eles.outgoers():eles.incomers();if(next.length===0){break}var newNext=false;for(var i=0;i<next.length;i++){var n=next[i];var nid=n.id();if(!sElesIds[nid]){sElesIds[nid]=true;sEles.push(n);newNext=true}}if(!newNext){break}eles=next}return this.spawn(sEles,{unique:true}).filter(selector)}};elesfn$s.clearTraversalCache=function(){for(var i=0;i<this.length;i++){this[i]._private.traversalCache=null}};extend(elesfn$s,{roots:defineDagExtremity({noIncomingEdges:true}),leaves:defineDagExtremity({noOutgoingEdges:true}),outgoers:cache(defineDagOneHop({outgoing:true}),"outgoers"),successors:defineDagAllHops({outgoing:true}),incomers:cache(defineDagOneHop({incoming:true}),"incomers"),predecessors:defineDagAllHops({incoming:true})});extend(elesfn$s,{neighborhood:cache((function(selector){var elements=[];var nodes=this.nodes();for(var i=0;i<nodes.length;i++){var node=nodes[i];var connectedEdges=node.connectedEdges();for(var j=0;j<connectedEdges.length;j++){var edge=connectedEdges[j];var src=edge.source();var tgt=edge.target();var otherNode=node===src?tgt:src;if(otherNode.length>0){elements.push(otherNode[0])}elements.push(edge[0])}}return this.spawn(elements,{unique:true}).filter(selector)}),"neighborhood"),closedNeighborhood:function closedNeighborhood(selector){return this.neighborhood().add(this).filter(selector)},openNeighborhood:function openNeighborhood(selector){return this.neighborhood(selector)}});elesfn$s.neighbourhood=elesfn$s.neighborhood;elesfn$s.closedNeighbourhood=elesfn$s.closedNeighborhood;elesfn$s.openNeighbourhood=elesfn$s.openNeighborhood;extend(elesfn$s,{source:cache((function sourceImpl(selector){var ele=this[0];var src;if(ele){src=ele._private.source||ele.cy().collection()}return src&&selector?src.filter(selector):src}),"source"),target:cache((function targetImpl(selector){var ele=this[0];var tgt;if(ele){tgt=ele._private.target||ele.cy().collection()}return tgt&&selector?tgt.filter(selector):tgt}),"target"),sources:defineSourceFunction({attr:"source"}),targets:defineSourceFunction({attr:"target"})});function defineSourceFunction(params){return function sourceImpl(selector){var sources=[];for(var i=0;i<this.length;i++){var ele=this[i];var src=ele._private[params.attr];if(src){sources.push(src)}}return this.spawn(sources,{unique:true}).filter(selector)}}extend(elesfn$s,{edgesWith:cache(defineEdgesWithFunction(),"edgesWith"),edgesTo:cache(defineEdgesWithFunction({thisIsSrc:true}),"edgesTo")});function defineEdgesWithFunction(params){return function edgesWithImpl(otherNodes){var elements=[];var cy=this._private.cy;var p=params||{};if(string(otherNodes)){otherNodes=cy.$(otherNodes)}for(var h=0;h<otherNodes.length;h++){var edges=otherNodes[h]._private.edges;for(var i=0;i<edges.length;i++){var edge=edges[i];var edgeData=edge._private.data;var thisToOther=this.hasElementWithId(edgeData.source)&&otherNodes.hasElementWithId(edgeData.target);var otherToThis=otherNodes.hasElementWithId(edgeData.source)&&this.hasElementWithId(edgeData.target);var edgeConnectsThisAndOther=thisToOther||otherToThis;if(!edgeConnectsThisAndOther){continue}if(p.thisIsSrc||p.thisIsTgt){if(p.thisIsSrc&&!thisToOther){continue}if(p.thisIsTgt&&!otherToThis){continue}}elements.push(edge)}}return this.spawn(elements,{unique:true})}}extend(elesfn$s,{connectedEdges:cache((function(selector){var retEles=[];var eles=this;for(var i=0;i<eles.length;i++){var node=eles[i];if(!node.isNode()){continue}var edges=node._private.edges;for(var j=0;j<edges.length;j++){var edge=edges[j];retEles.push(edge)}}return this.spawn(retEles,{unique:true}).filter(selector)}),"connectedEdges"),connectedNodes:cache((function(selector){var retEles=[];var eles=this;for(var i=0;i<eles.length;i++){var edge=eles[i];if(!edge.isEdge()){continue}retEles.push(edge.source()[0]);retEles.push(edge.target()[0])}return this.spawn(retEles,{unique:true}).filter(selector)}),"connectedNodes"),parallelEdges:cache(defineParallelEdgesFunction(),"parallelEdges"),codirectedEdges:cache(defineParallelEdgesFunction({codirected:true}),"codirectedEdges")});function defineParallelEdgesFunction(params){var defaults={codirected:false};params=extend({},defaults,params);return function parallelEdgesImpl(selector){var elements=[];var edges=this.edges();var p=params;for(var i=0;i<edges.length;i++){var edge1=edges[i];var edge1_p=edge1._private;var src1=edge1_p.source;var srcid1=src1._private.data.id;var tgtid1=edge1_p.data.target;var srcEdges1=src1._private.edges;for(var j=0;j<srcEdges1.length;j++){var edge2=srcEdges1[j];var edge2data=edge2._private.data;var tgtid2=edge2data.target;var srcid2=edge2data.source;var codirected=tgtid2===tgtid1&&srcid2===srcid1;var oppdirected=srcid1===tgtid2&&tgtid1===srcid2;if(p.codirected&&codirected||!p.codirected&&(codirected||oppdirected)){elements.push(edge2)}}}return this.spawn(elements,{unique:true}).filter(selector)}}extend(elesfn$s,{components:function components(root){var self=this;var cy=self.cy();var visited=cy.collection();var unvisited=root==null?self.nodes():root.nodes();var components=[];if(root!=null&&unvisited.empty()){unvisited=root.sources()}var visitInComponent=function visitInComponent(node,component){visited.merge(node);unvisited.unmerge(node);component.merge(node)};if(unvisited.empty()){return self.spawn()}var _loop=function _loop(){var cmpt=cy.collection();components.push(cmpt);var root=unvisited[0];visitInComponent(root,cmpt);self.bfs({directed:false,roots:root,visit:function visit(v){return visitInComponent(v,cmpt)}});cmpt.forEach((function(node){node.connectedEdges().forEach((function(e){if(cmpt.has(e.source())&&cmpt.has(e.target())){cmpt.merge(e)}}))}))};do{_loop()}while(unvisited.length>0);return components},component:function component(){var ele=this[0];return ele.cy().mutableElements().components(ele)[0]}});elesfn$s.componentsOf=elesfn$s.components;var idFactory={generate:function generate(cy,element,tryThisId){var id=tryThisId!=null?tryThisId:uuid();while(cy.hasElementWithId(id)){id=uuid()}return id}};var Collection=function Collection(cy,elements,options){if(cy===undefined||!core(cy)){error("A collection must have a reference to the core");return}var map=new Map$1;var createdElements=false;if(!elements){elements=[]}else if(elements.length>0&&plainObject(elements[0])&&!element(elements[0])){createdElements=true;var eles=[];var elesIds=new Set$1;for(var i=0,l=elements.length;i<l;i++){var json=elements[i];if(json.data==null){json.data={}}var _data=json.data;if(_data.id==null){_data.id=idFactory.generate(cy,json)}else if(cy.hasElementWithId(_data.id)||elesIds.has(_data.id)){continue}var ele=new Element(cy,json,false);eles.push(ele);elesIds.add(_data.id)}elements=eles}this.length=0;for(var _i=0,_l=elements.length;_i<_l;_i++){var element$1=elements[_i][0];if(element$1==null){continue}var id=element$1._private.data.id;if(options==null||options.unique&&!map.has(id)){map.set(id,{index:this.length,ele:element$1});this[this.length]=element$1;this.length++}}this._private={cy:cy,map:map};if(createdElements){this.restore()}};var elesfn$t=Element.prototype=Collection.prototype;elesfn$t.instanceString=function(){return"collection"};elesfn$t.spawn=function(cy,eles,opts){if(!core(cy)){opts=eles;eles=cy;cy=this.cy()}return new Collection(cy,eles,opts)};elesfn$t.spawnSelf=function(){return this.spawn(this)};elesfn$t.cy=function(){return this._private.cy};elesfn$t.renderer=function(){return this._private.cy.renderer()};elesfn$t.element=function(){return this[0]};elesfn$t.collection=function(){if(collection(this)){return this}else{return new Collection(this._private.cy,[this])}};elesfn$t.unique=function(){return new Collection(this._private.cy,this,{unique:true})};elesfn$t.hasElementWithId=function(id){id=""+id;return this._private.map.has(id)};elesfn$t.getElementById=function(id){id=""+id;var cy=this._private.cy;var entry=this._private.map.get(id);return entry?entry.ele:new Collection(cy)};elesfn$t.$id=elesfn$t.getElementById;elesfn$t.poolIndex=function(){var cy=this._private.cy;var eles=cy._private.elements;var id=this[0]._private.data.id;return eles._private.map.get(id).index};elesfn$t.indexOf=function(ele){var id=ele[0]._private.data.id;return this._private.map.get(id).index};elesfn$t.indexOfId=function(id){id=""+id;return this._private.map.get(id).index};elesfn$t.json=function(obj){var ele=this.element();var cy=this.cy();if(ele==null&&obj){return this}if(ele==null){return undefined}var p=ele._private;if(plainObject(obj)){cy.startBatch();if(obj.data){ele.data(obj.data);var _data2=p.data;if(ele.isEdge()){var move=false;var spec={};var src=obj.data.source;var tgt=obj.data.target;if(src!=null&&src!=_data2.source){spec.source=""+src;move=true}if(tgt!=null&&tgt!=_data2.target){spec.target=""+tgt;move=true}if(move){ele=ele.move(spec)}}else{var parent=obj.data.parent;if((parent!=null||_data2.parent!=null)&&parent!=_data2.parent){if(parent===undefined){parent=null}if(parent!=null){parent=""+parent}ele=ele.move({parent:parent})}}}if(obj.position){ele.position(obj.position)}var checkSwitch=function checkSwitch(k,trueFnName,falseFnName){var obj_k=obj[k];if(obj_k!=null&&obj_k!==p[k]){if(obj_k){ele[trueFnName]()}else{ele[falseFnName]()}}};checkSwitch("removed","remove","restore");checkSwitch("selected","select","unselect");checkSwitch("selectable","selectify","unselectify");checkSwitch("locked","lock","unlock");checkSwitch("grabbable","grabify","ungrabify");checkSwitch("pannable","panify","unpanify");if(obj.classes!=null){ele.classes(obj.classes)}cy.endBatch();return this}else if(obj===undefined){var json={data:copy(p.data),position:copy(p.position),group:p.group,removed:p.removed,selected:p.selected,selectable:p.selectable,locked:p.locked,grabbable:p.grabbable,pannable:p.pannable,classes:null};json.classes="";var i=0;p.classes.forEach((function(cls){return json.classes+=i++===0?cls:" "+cls}));return json}};elesfn$t.jsons=function(){var jsons=[];for(var i=0;i<this.length;i++){var ele=this[i];var json=ele.json();jsons.push(json)}return jsons};elesfn$t.clone=function(){var cy=this.cy();var elesArr=[];for(var i=0;i<this.length;i++){var ele=this[i];var json=ele.json();var clone=new Element(cy,json,false);elesArr.push(clone)}return new Collection(cy,elesArr)};elesfn$t.copy=elesfn$t.clone;elesfn$t.restore=function(){var notifyRenderer=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var addToPool=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var self=this;var cy=self.cy();var cy_p=cy._private;var nodes=[];var edges=[];var elements;for(var _i2=0,l=self.length;_i2<l;_i2++){var ele=self[_i2];if(addToPool&&!ele.removed()){continue}if(ele.isNode()){nodes.push(ele)}else{edges.push(ele)}}elements=nodes.concat(edges);var i;var removeFromElements=function removeFromElements(){elements.splice(i,1);i--};for(i=0;i<elements.length;i++){var _ele=elements[i];var _private=_ele._private;var _data3=_private.data;_ele.clearTraversalCache();if(!addToPool&&!_private.removed);else if(_data3.id===undefined){_data3.id=idFactory.generate(cy,_ele)}else if(number(_data3.id)){_data3.id=""+_data3.id}else if(emptyString(_data3.id)||!string(_data3.id)){error("Can not create element with invalid string ID `"+_data3.id+"`");removeFromElements();continue}else if(cy.hasElementWithId(_data3.id)){error("Can not create second element with ID `"+_data3.id+"`");removeFromElements();continue}var id=_data3.id;if(_ele.isNode()){var pos=_private.position;if(pos.x==null){pos.x=0}if(pos.y==null){pos.y=0}}if(_ele.isEdge()){var edge=_ele;var fields=["source","target"];var fieldsLength=fields.length;var badSourceOrTarget=false;for(var j=0;j<fieldsLength;j++){var field=fields[j];var val=_data3[field];if(number(val)){val=_data3[field]=""+_data3[field]}if(val==null||val===""){error("Can not create edge `"+id+"` with unspecified "+field);badSourceOrTarget=true}else if(!cy.hasElementWithId(val)){error("Can not create edge `"+id+"` with nonexistant "+field+" `"+val+"`");badSourceOrTarget=true}}if(badSourceOrTarget){removeFromElements();continue}var src=cy.getElementById(_data3.source);var tgt=cy.getElementById(_data3.target);if(src.same(tgt)){src._private.edges.push(edge)}else{src._private.edges.push(edge);tgt._private.edges.push(edge)}edge._private.source=src;edge._private.target=tgt}_private.map=new Map$1;_private.map.set(id,{ele:_ele,index:0});_private.removed=false;if(addToPool){cy.addToPool(_ele)}}for(var _i3=0;_i3<nodes.length;_i3++){var node=nodes[_i3];var _data4=node._private.data;if(number(_data4.parent)){_data4.parent=""+_data4.parent}var parentId=_data4.parent;var specifiedParent=parentId!=null;if(specifiedParent){var parent=cy.getElementById(parentId);if(parent.empty()){_data4.parent=undefined}else{var selfAsParent=false;var ancestor=parent;while(!ancestor.empty()){if(node.same(ancestor)){selfAsParent=true;_data4.parent=undefined;break}ancestor=ancestor.parent()}if(!selfAsParent){parent[0]._private.children.push(node);node._private.parent=parent[0];cy_p.hasCompoundNodes=true}}}}if(elements.length>0){var restored=new Collection(cy,elements);for(var _i4=0;_i4<restored.length;_i4++){var _ele2=restored[_i4];if(_ele2.isNode()){continue}_ele2.parallelEdges().clearTraversalCache();_ele2.source().clearTraversalCache();_ele2.target().clearTraversalCache()}var toUpdateStyle;if(cy_p.hasCompoundNodes){toUpdateStyle=cy.collection().merge(restored).merge(restored.connectedNodes()).merge(restored.parent())}else{toUpdateStyle=restored}toUpdateStyle.dirtyCompoundBoundsCache().dirtyBoundingBoxCache().updateStyle(notifyRenderer);if(notifyRenderer){restored.emitAndNotify("add")}else if(addToPool){restored.emit("add")}}return self};elesfn$t.removed=function(){var ele=this[0];return ele&&ele._private.removed};elesfn$t.inside=function(){var ele=this[0];return ele&&!ele._private.removed};elesfn$t.remove=function(){var notifyRenderer=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var removeFromPool=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var self=this;var elesToRemove=[];var elesToRemoveIds={};var cy=self._private.cy;function addConnectedEdges(node){var edges=node._private.edges;for(var i=0;i<edges.length;i++){add(edges[i])}}function addChildren(node){var children=node._private.children;for(var i=0;i<children.length;i++){add(children[i])}}function add(ele){var alreadyAdded=elesToRemoveIds[ele.id()];if(removeFromPool&&ele.removed()||alreadyAdded){return}else{elesToRemoveIds[ele.id()]=true}if(ele.isNode()){elesToRemove.push(ele);addConnectedEdges(ele);addChildren(ele)}else{elesToRemove.unshift(ele)}}for(var i=0,l=self.length;i<l;i++){var ele=self[i];add(ele)}function removeEdgeRef(node,edge){var connectedEdges=node._private.edges;removeFromArray(connectedEdges,edge);node.clearTraversalCache()}function removeParallelRef(pllEdge){pllEdge.clearTraversalCache()}var alteredParents=[];alteredParents.ids={};function removeChildRef(parent,ele){ele=ele[0];parent=parent[0];var children=parent._private.children;var pid=parent.id();removeFromArray(children,ele);ele._private.parent=null;if(!alteredParents.ids[pid]){alteredParents.ids[pid]=true;alteredParents.push(parent)}}self.dirtyCompoundBoundsCache();if(removeFromPool){cy.removeFromPool(elesToRemove)}for(var _i5=0;_i5<elesToRemove.length;_i5++){var _ele3=elesToRemove[_i5];if(_ele3.isEdge()){var src=_ele3.source()[0];var tgt=_ele3.target()[0];removeEdgeRef(src,_ele3);removeEdgeRef(tgt,_ele3);var pllEdges=_ele3.parallelEdges();for(var j=0;j<pllEdges.length;j++){var pllEdge=pllEdges[j];removeParallelRef(pllEdge);if(pllEdge.isBundledBezier()){pllEdge.dirtyBoundingBoxCache()}}}else{var parent=_ele3.parent();if(parent.length!==0){removeChildRef(parent,_ele3)}}if(removeFromPool){_ele3._private.removed=true}}var elesStillInside=cy._private.elements;cy._private.hasCompoundNodes=false;for(var _i6=0;_i6<elesStillInside.length;_i6++){var _ele4=elesStillInside[_i6];if(_ele4.isParent()){cy._private.hasCompoundNodes=true;break}}var removedElements=new Collection(this.cy(),elesToRemove);if(removedElements.size()>0){if(notifyRenderer){removedElements.emitAndNotify("remove")}else if(removeFromPool){removedElements.emit("remove")}}for(var _i7=0;_i7<alteredParents.length;_i7++){var _ele5=alteredParents[_i7];if(!removeFromPool||!_ele5.removed()){_ele5.updateStyle()}}return removedElements};elesfn$t.move=function(struct){var cy=this._private.cy;var eles=this;var notifyRenderer=false;var modifyPool=false;var toString=function toString(id){return id==null?id:""+id};if(struct.source!==undefined||struct.target!==undefined){var srcId=toString(struct.source);var tgtId=toString(struct.target);var srcExists=srcId!=null&&cy.hasElementWithId(srcId);var tgtExists=tgtId!=null&&cy.hasElementWithId(tgtId);if(srcExists||tgtExists){cy.batch((function(){eles.remove(notifyRenderer,modifyPool);eles.emitAndNotify("moveout");for(var i=0;i<eles.length;i++){var ele=eles[i];var _data5=ele._private.data;if(ele.isEdge()){if(srcExists){_data5.source=srcId}if(tgtExists){_data5.target=tgtId}}}eles.restore(notifyRenderer,modifyPool)}));eles.emitAndNotify("move")}}else if(struct.parent!==undefined){var parentId=toString(struct.parent);var parentExists=parentId===null||cy.hasElementWithId(parentId);if(parentExists){var pidToAssign=parentId===null?undefined:parentId;cy.batch((function(){var updated=eles.remove(notifyRenderer,modifyPool);updated.emitAndNotify("moveout");for(var i=0;i<eles.length;i++){var ele=eles[i];var _data6=ele._private.data;if(ele.isNode()){_data6.parent=pidToAssign}}updated.restore(notifyRenderer,modifyPool)}));eles.emitAndNotify("move")}}return this};[elesfn$b,elesfn$c,elesfn$d,elesfn$e,elesfn$f,data$1,elesfn$h,dimensions,elesfn$l,elesfn$m,elesfn$n,elesfn$o,elesfn$p,elesfn$q,elesfn$r,elesfn$s].forEach((function(props){extend(elesfn$t,props)}));var corefn={add:function add(opts){var elements;var cy=this;if(elementOrCollection(opts)){var eles=opts;if(eles._private.cy===cy){elements=eles.restore()}else{var jsons=[];for(var i=0;i<eles.length;i++){var ele=eles[i];jsons.push(ele.json())}elements=new Collection(cy,jsons)}}else if(array(opts)){var _jsons=opts;elements=new Collection(cy,_jsons)}else if(plainObject(opts)&&(array(opts.nodes)||array(opts.edges))){var elesByGroup=opts;var _jsons2=[];var grs=["nodes","edges"];for(var _i=0,il=grs.length;_i<il;_i++){var group=grs[_i];var elesArray=elesByGroup[group];if(array(elesArray)){for(var j=0,jl=elesArray.length;j<jl;j++){var json=extend({group:group},elesArray[j]);_jsons2.push(json)}}}elements=new Collection(cy,_jsons2)}else{var _json=opts;elements=new Element(cy,_json).collection()}return elements},remove:function remove(collection){if(elementOrCollection(collection));else if(string(collection)){var selector=collection;collection=this.$(selector)}return collection.remove()}};
/*! Bezier curve function generator. Copyright Gaetan Renaudeau. MIT License: http://en.wikipedia.org/wiki/MIT_License */function generateCubicBezier(mX1,mY1,mX2,mY2){var NEWTON_ITERATIONS=4,NEWTON_MIN_SLOPE=.001,SUBDIVISION_PRECISION=1e-7,SUBDIVISION_MAX_ITERATIONS=10,kSplineTableSize=11,kSampleStepSize=1/(kSplineTableSize-1),float32ArraySupported=typeof Float32Array!=="undefined";if(arguments.length!==4){return false}for(var i=0;i<4;++i){if(typeof arguments[i]!=="number"||isNaN(arguments[i])||!isFinite(arguments[i])){return false}}mX1=Math.min(mX1,1);mX2=Math.min(mX2,1);mX1=Math.max(mX1,0);mX2=Math.max(mX2,0);var mSampleValues=float32ArraySupported?new Float32Array(kSplineTableSize):new Array(kSplineTableSize);function A(aA1,aA2){return 1-3*aA2+3*aA1}function B(aA1,aA2){return 3*aA2-6*aA1}function C(aA1){return 3*aA1}function calcBezier(aT,aA1,aA2){return((A(aA1,aA2)*aT+B(aA1,aA2))*aT+C(aA1))*aT}function getSlope(aT,aA1,aA2){return 3*A(aA1,aA2)*aT*aT+2*B(aA1,aA2)*aT+C(aA1)}function newtonRaphsonIterate(aX,aGuessT){for(var _i=0;_i<NEWTON_ITERATIONS;++_i){var currentSlope=getSlope(aGuessT,mX1,mX2);if(currentSlope===0){return aGuessT}var currentX=calcBezier(aGuessT,mX1,mX2)-aX;aGuessT-=currentX/currentSlope}return aGuessT}function calcSampleValues(){for(var _i2=0;_i2<kSplineTableSize;++_i2){mSampleValues[_i2]=calcBezier(_i2*kSampleStepSize,mX1,mX2)}}function binarySubdivide(aX,aA,aB){var currentX,currentT,i=0;do{currentT=aA+(aB-aA)/2;currentX=calcBezier(currentT,mX1,mX2)-aX;if(currentX>0){aB=currentT}else{aA=currentT}}while(Math.abs(currentX)>SUBDIVISION_PRECISION&&++i<SUBDIVISION_MAX_ITERATIONS);return currentT}function getTForX(aX){var intervalStart=0,currentSample=1,lastSample=kSplineTableSize-1;for(;currentSample!==lastSample&&mSampleValues[currentSample]<=aX;++currentSample){intervalStart+=kSampleStepSize}--currentSample;var dist=(aX-mSampleValues[currentSample])/(mSampleValues[currentSample+1]-mSampleValues[currentSample]),guessForT=intervalStart+dist*kSampleStepSize,initialSlope=getSlope(guessForT,mX1,mX2);if(initialSlope>=NEWTON_MIN_SLOPE){return newtonRaphsonIterate(aX,guessForT)}else if(initialSlope===0){return guessForT}else{return binarySubdivide(aX,intervalStart,intervalStart+kSampleStepSize)}}var _precomputed=false;function precompute(){_precomputed=true;if(mX1!==mY1||mX2!==mY2){calcSampleValues()}}var f=function f(aX){if(!_precomputed){precompute()}if(mX1===mY1&&mX2===mY2){return aX}if(aX===0){return 0}if(aX===1){return 1}return calcBezier(getTForX(aX),mY1,mY2)};f.getControlPoints=function(){return[{x:mX1,y:mY1},{x:mX2,y:mY2}]};var str="generateBezier("+[mX1,mY1,mX2,mY2]+")";f.toString=function(){return str};return f}
/*! Runge-Kutta spring physics function generator. Adapted from Framer.js, copyright Koen Bok. MIT License: http://en.wikipedia.org/wiki/MIT_License */var generateSpringRK4=function(){function springAccelerationForState(state){return-state.tension*state.x-state.friction*state.v}function springEvaluateStateWithDerivative(initialState,dt,derivative){var state={x:initialState.x+derivative.dx*dt,v:initialState.v+derivative.dv*dt,tension:initialState.tension,friction:initialState.friction};return{dx:state.v,dv:springAccelerationForState(state)}}function springIntegrateState(state,dt){var a={dx:state.v,dv:springAccelerationForState(state)},b=springEvaluateStateWithDerivative(state,dt*.5,a),c=springEvaluateStateWithDerivative(state,dt*.5,b),d=springEvaluateStateWithDerivative(state,dt,c),dxdt=1/6*(a.dx+2*(b.dx+c.dx)+d.dx),dvdt=1/6*(a.dv+2*(b.dv+c.dv)+d.dv);state.x=state.x+dxdt*dt;state.v=state.v+dvdt*dt;return state}return function springRK4Factory(tension,friction,duration){var initState={x:-1,v:0,tension:null,friction:null},path=[0],time_lapsed=0,tolerance=1/1e4,DT=16/1e3,have_duration,dt,last_state;tension=parseFloat(tension)||500;friction=parseFloat(friction)||20;duration=duration||null;initState.tension=tension;initState.friction=friction;have_duration=duration!==null;if(have_duration){time_lapsed=springRK4Factory(tension,friction);dt=time_lapsed/duration*DT}else{dt=DT}for(;;){last_state=springIntegrateState(last_state||initState,dt);path.push(1+last_state.x);time_lapsed+=16;if(!(Math.abs(last_state.x)>tolerance&&Math.abs(last_state.v)>tolerance)){break}}return!have_duration?time_lapsed:function(percentComplete){return path[percentComplete*(path.length-1)|0]}}}();var cubicBezier=function cubicBezier(t1,p1,t2,p2){var bezier=generateCubicBezier(t1,p1,t2,p2);return function(start,end,percent){return start+(end-start)*bezier(percent)}};var easings={linear:function linear(start,end,percent){return start+(end-start)*percent},ease:cubicBezier(.25,.1,.25,1),"ease-in":cubicBezier(.42,0,1,1),"ease-out":cubicBezier(0,0,.58,1),"ease-in-out":cubicBezier(.42,0,.58,1),"ease-in-sine":cubicBezier(.47,0,.745,.715),"ease-out-sine":cubicBezier(.39,.575,.565,1),"ease-in-out-sine":cubicBezier(.445,.05,.55,.95),"ease-in-quad":cubicBezier(.55,.085,.68,.53),"ease-out-quad":cubicBezier(.25,.46,.45,.94),"ease-in-out-quad":cubicBezier(.455,.03,.515,.955),"ease-in-cubic":cubicBezier(.55,.055,.675,.19),"ease-out-cubic":cubicBezier(.215,.61,.355,1),"ease-in-out-cubic":cubicBezier(.645,.045,.355,1),"ease-in-quart":cubicBezier(.895,.03,.685,.22),"ease-out-quart":cubicBezier(.165,.84,.44,1),"ease-in-out-quart":cubicBezier(.77,0,.175,1),"ease-in-quint":cubicBezier(.755,.05,.855,.06),"ease-out-quint":cubicBezier(.23,1,.32,1),"ease-in-out-quint":cubicBezier(.86,0,.07,1),"ease-in-expo":cubicBezier(.95,.05,.795,.035),"ease-out-expo":cubicBezier(.19,1,.22,1),"ease-in-out-expo":cubicBezier(1,0,0,1),"ease-in-circ":cubicBezier(.6,.04,.98,.335),"ease-out-circ":cubicBezier(.075,.82,.165,1),"ease-in-out-circ":cubicBezier(.785,.135,.15,.86),spring:function spring(tension,friction,duration){if(duration===0){return easings.linear}var spring=generateSpringRK4(tension,friction,duration);return function(start,end,percent){return start+(end-start)*spring(percent)}},"cubic-bezier":cubicBezier};function getEasedValue(type,start,end,percent,easingFn){if(percent===1){return end}var val=easingFn(start,end,percent);if(type==null){return val}if(type.roundValue||type.color){val=Math.round(val)}if(type.min!==undefined){val=Math.max(val,type.min)}if(type.max!==undefined){val=Math.min(val,type.max)}return val}function getValue(prop,spec){if(prop.pfValue!=null||prop.value!=null){if(prop.pfValue!=null&&(spec==null||spec.type.units!=="%")){return prop.pfValue}else{return prop.value}}else{return prop}}function ease(startProp,endProp,percent,easingFn,propSpec){var type=propSpec!=null?propSpec.type:null;if(percent<0){percent=0}else if(percent>1){percent=1}var start=getValue(startProp,propSpec);var end=getValue(endProp,propSpec);if(number(start)&&number(end)){return getEasedValue(type,start,end,percent,easingFn)}else if(array(start)&&array(end)){var easedArr=[];for(var i=0;i<end.length;i++){var si=start[i];var ei=end[i];if(si!=null&&ei!=null){var val=getEasedValue(type,si,ei,percent,easingFn);easedArr.push(val)}else{easedArr.push(ei)}}return easedArr}return undefined}function step(self,ani,now,isCore){var isEles=!isCore;var _p=self._private;var ani_p=ani._private;var pEasing=ani_p.easing;var startTime=ani_p.startTime;var cy=isCore?self:self.cy();var style=cy.style();if(!ani_p.easingImpl){if(pEasing==null){ani_p.easingImpl=easings["linear"]}else{var easingVals;if(string(pEasing)){var easingProp=style.parse("transition-timing-function",pEasing);easingVals=easingProp.value}else{easingVals=pEasing}var name,args;if(string(easingVals)){name=easingVals;args=[]}else{name=easingVals[1];args=easingVals.slice(2).map((function(n){return+n}))}if(args.length>0){if(name==="spring"){args.push(ani_p.duration)}ani_p.easingImpl=easings[name].apply(null,args)}else{ani_p.easingImpl=easings[name]}}}var easing=ani_p.easingImpl;var percent;if(ani_p.duration===0){percent=1}else{percent=(now-startTime)/ani_p.duration}if(ani_p.applying){percent=ani_p.progress}if(percent<0){percent=0}else if(percent>1){percent=1}if(ani_p.delay==null){var startPos=ani_p.startPosition;var endPos=ani_p.position;if(endPos&&isEles&&!self.locked()){var newPos={};if(valid(startPos.x,endPos.x)){newPos.x=ease(startPos.x,endPos.x,percent,easing)}if(valid(startPos.y,endPos.y)){newPos.y=ease(startPos.y,endPos.y,percent,easing)}self.position(newPos)}var startPan=ani_p.startPan;var endPan=ani_p.pan;var pan=_p.pan;var animatingPan=endPan!=null&&isCore;if(animatingPan){if(valid(startPan.x,endPan.x)){pan.x=ease(startPan.x,endPan.x,percent,easing)}if(valid(startPan.y,endPan.y)){pan.y=ease(startPan.y,endPan.y,percent,easing)}self.emit("pan")}var startZoom=ani_p.startZoom;var endZoom=ani_p.zoom;var animatingZoom=endZoom!=null&&isCore;if(animatingZoom){if(valid(startZoom,endZoom)){_p.zoom=bound(_p.minZoom,ease(startZoom,endZoom,percent,easing),_p.maxZoom)}self.emit("zoom")}if(animatingPan||animatingZoom){self.emit("viewport")}var props=ani_p.style;if(props&&props.length>0&&isEles){for(var i=0;i<props.length;i++){var prop=props[i];var _name=prop.name;var end=prop;var start=ani_p.startStyle[_name];var propSpec=style.properties[start.name];var easedVal=ease(start,end,percent,easing,propSpec);style.overrideBypass(self,_name,easedVal)}self.emit("style")}}ani_p.progress=percent;return percent}function valid(start,end){if(start==null||end==null){return false}if(number(start)&&number(end)){return true}else if(start&&end){return true}return false}function startAnimation(self,ani,now,isCore){var ani_p=ani._private;ani_p.started=true;ani_p.startTime=now-ani_p.progress*ani_p.duration}function stepAll(now,cy){var eles=cy._private.aniEles;var doneEles=[];function stepOne(ele,isCore){var _p=ele._private;var current=_p.animation.current;var queue=_p.animation.queue;var ranAnis=false;if(!isCore&&ele.pstyle("display").value==="none"){current=current.splice(0,current.length).concat(queue.splice(0,queue.length));for(var i=0;i<current.length;i++){current[i].stop()}}if(current.length===0){var next=queue.shift();if(next){current.push(next)}}var callbacks=function callbacks(_callbacks){for(var j=_callbacks.length-1;j>=0;j--){var cb=_callbacks[j];cb()}_callbacks.splice(0,_callbacks.length)};for(var _i=current.length-1;_i>=0;_i--){var ani=current[_i];var ani_p=ani._private;if(ani_p.stopped){current.splice(_i,1);ani_p.hooked=false;ani_p.playing=false;ani_p.started=false;callbacks(ani_p.frames);continue}if(!ani_p.playing&&!ani_p.applying){continue}if(ani_p.playing&&ani_p.applying){ani_p.applying=false}if(!ani_p.started){startAnimation(ele,ani,now)}step(ele,ani,now,isCore);if(ani_p.applying){ani_p.applying=false}callbacks(ani_p.frames);if(ani_p.step!=null){ani_p.step(now)}if(ani.completed()){current.splice(_i,1);ani_p.hooked=false;ani_p.playing=false;ani_p.started=false;callbacks(ani_p.completes)}ranAnis=true}if(!isCore&&current.length===0&&queue.length===0){doneEles.push(ele)}return ranAnis}var ranEleAni=false;for(var e=0;e<eles.length;e++){var ele=eles[e];var handledThisEle=stepOne(ele);ranEleAni=ranEleAni||handledThisEle}var ranCoreAni=stepOne(cy,true);if(ranEleAni||ranCoreAni){if(eles.length>0){cy.notify("draw",eles)}else{cy.notify("draw")}}eles.unmerge(doneEles);cy.emit("step")}var corefn$1={animate:define$3.animate(),animation:define$3.animation(),animated:define$3.animated(),clearQueue:define$3.clearQueue(),delay:define$3.delay(),delayAnimation:define$3.delayAnimation(),stop:define$3.stop(),addToAnimationPool:function addToAnimationPool(eles){var cy=this;if(!cy.styleEnabled()){return}cy._private.aniEles.merge(eles)},stopAnimationLoop:function stopAnimationLoop(){this._private.animationsRunning=false},startAnimationLoop:function startAnimationLoop(){var cy=this;cy._private.animationsRunning=true;if(!cy.styleEnabled()){return}function headlessStep(){if(!cy._private.animationsRunning){return}requestAnimationFrame((function animationStep(now){stepAll(now,cy);headlessStep()}))}var renderer=cy.renderer();if(renderer&&renderer.beforeRender){renderer.beforeRender((function rendererAnimationStep(willDraw,now){stepAll(now,cy)}),renderer.beforeRenderPriorities.animations)}else{headlessStep()}}};var emitterOptions$1={qualifierCompare:function qualifierCompare(selector1,selector2){if(selector1==null||selector2==null){return selector1==null&&selector2==null}else{return selector1.sameText(selector2)}},eventMatches:function eventMatches(cy,listener,eventObj){var selector=listener.qualifier;if(selector!=null){return cy!==eventObj.target&&element(eventObj.target)&&selector.matches(eventObj.target)}return true},addEventFields:function addEventFields(cy,evt){evt.cy=cy;evt.target=cy},callbackContext:function callbackContext(cy,listener,eventObj){return listener.qualifier!=null?eventObj.target:cy}};var argSelector$1=function argSelector(arg){if(string(arg)){return new Selector(arg)}else{return arg}};var elesfn$u={createEmitter:function createEmitter(){var _p=this._private;if(!_p.emitter){_p.emitter=new Emitter(emitterOptions$1,this)}return this},emitter:function emitter(){return this._private.emitter},on:function on(events,selector,callback){this.emitter().on(events,argSelector$1(selector),callback);return this},removeListener:function removeListener(events,selector,callback){this.emitter().removeListener(events,argSelector$1(selector),callback);return this},removeAllListeners:function removeAllListeners(){this.emitter().removeAllListeners();return this},one:function one(events,selector,callback){this.emitter().one(events,argSelector$1(selector),callback);return this},once:function once(events,selector,callback){this.emitter().one(events,argSelector$1(selector),callback);return this},emit:function emit(events,extraParams){this.emitter().emit(events,extraParams);return this},emitAndNotify:function emitAndNotify(event,eles){this.emit(event);this.notify(event,eles);return this}};define$3.eventAliasesOn(elesfn$u);var corefn$2={png:function png(options){var renderer=this._private.renderer;options=options||{};return renderer.png(options)},jpg:function jpg(options){var renderer=this._private.renderer;options=options||{};options.bg=options.bg||"#fff";return renderer.jpg(options)}};corefn$2.jpeg=corefn$2.jpg;var corefn$3={layout:function layout(options){var cy=this;if(options==null){error("Layout options must be specified to make a layout");return}if(options.name==null){error("A `name` must be specified to make a layout");return}var name=options.name;var Layout=cy.extension("layout",name);if(Layout==null){error("No such layout `"+name+"` found.  Did you forget to import it and `cytoscape.use()` it?");return}var eles;if(string(options.eles)){eles=cy.$(options.eles)}else{eles=options.eles!=null?options.eles:cy.$()}var layout=new Layout(extend({},options,{cy:cy,eles:eles}));return layout}};corefn$3.createLayout=corefn$3.makeLayout=corefn$3.layout;var corefn$4={notify:function notify(eventName,eventEles){var _p=this._private;if(this.batching()){_p.batchNotifications=_p.batchNotifications||{};var eles=_p.batchNotifications[eventName]=_p.batchNotifications[eventName]||this.collection();if(eventEles!=null){eles.merge(eventEles)}return}if(!_p.notificationsEnabled){return}var renderer=this.renderer();if(this.destroyed()||!renderer){return}renderer.notify(eventName,eventEles)},notifications:function notifications(bool){var p=this._private;if(bool===undefined){return p.notificationsEnabled}else{p.notificationsEnabled=bool?true:false}return this},noNotifications:function noNotifications(callback){this.notifications(false);callback();this.notifications(true)},batching:function batching(){return this._private.batchCount>0},startBatch:function startBatch(){var _p=this._private;if(_p.batchCount==null){_p.batchCount=0}if(_p.batchCount===0){_p.batchStyleEles=this.collection();_p.batchNotifications={}}_p.batchCount++;return this},endBatch:function endBatch(){var _p=this._private;if(_p.batchCount===0){return this}_p.batchCount--;if(_p.batchCount===0){_p.batchStyleEles.updateStyle();var renderer=this.renderer();Object.keys(_p.batchNotifications).forEach((function(eventName){var eles=_p.batchNotifications[eventName];if(eles.empty()){renderer.notify(eventName)}else{renderer.notify(eventName,eles)}}))}return this},batch:function batch(callback){this.startBatch();callback();this.endBatch();return this},batchData:function batchData(map){var cy=this;return this.batch((function(){var ids=Object.keys(map);for(var i=0;i<ids.length;i++){var id=ids[i];var data=map[id];var ele=cy.getElementById(id);ele.data(data)}}))}};var rendererDefaults=defaults({hideEdgesOnViewport:false,textureOnViewport:false,motionBlur:false,motionBlurOpacity:.05,pixelRatio:undefined,desktopTapThreshold:4,touchTapThreshold:8,wheelSensitivity:1,debug:false,showFps:false});var corefn$5={renderTo:function renderTo(context,zoom,pan,pxRatio){var r=this._private.renderer;r.renderTo(context,zoom,pan,pxRatio);return this},renderer:function renderer(){return this._private.renderer},forceRender:function forceRender(){this.notify("draw");return this},resize:function resize(){this.invalidateSize();this.emitAndNotify("resize");return this},initRenderer:function initRenderer(options){var cy=this;var RendererProto=cy.extension("renderer",options.name);if(RendererProto==null){error("Can not initialise: No such renderer `".concat(options.name,"` found. Did you forget to import it and `cytoscape.use()` it?"));return}if(options.wheelSensitivity!==undefined){warn("You have set a custom wheel sensitivity.  This will make your app zoom unnaturally when using mainstream mice.  You should change this value from the default only if you can guarantee that all your users will use the same hardware and OS configuration as your current machine.")}var rOpts=rendererDefaults(options);rOpts.cy=cy;cy._private.renderer=new RendererProto(rOpts);this.notify("init")},destroyRenderer:function destroyRenderer(){var cy=this;cy.notify("destroy");var domEle=cy.container();if(domEle){domEle._cyreg=null;while(domEle.childNodes.length>0){domEle.removeChild(domEle.childNodes[0])}}cy._private.renderer=null;cy.mutableElements().forEach((function(ele){var _p=ele._private;_p.rscratch={};_p.rstyle={};_p.animation.current=[];_p.animation.queue=[]}))},onRender:function onRender(fn){return this.on("render",fn)},offRender:function offRender(fn){return this.off("render",fn)}};corefn$5.invalidateDimensions=corefn$5.resize;var corefn$6={collection:function collection(eles,opts){if(string(eles)){return this.$(eles)}else if(elementOrCollection(eles)){return eles.collection()}else if(array(eles)){return new Collection(this,eles,opts)}return new Collection(this)},nodes:function nodes(selector){var nodes=this.$((function(ele){return ele.isNode()}));if(selector){return nodes.filter(selector)}return nodes},edges:function edges(selector){var edges=this.$((function(ele){return ele.isEdge()}));if(selector){return edges.filter(selector)}return edges},$:function $(selector){var eles=this._private.elements;if(selector){return eles.filter(selector)}else{return eles.spawnSelf()}},mutableElements:function mutableElements(){return this._private.elements}};corefn$6.elements=corefn$6.filter=corefn$6.$;var styfn={};var TRUE="t";var FALSE="f";styfn.apply=function(eles){var self=this;var _p=self._private;var cy=_p.cy;var updatedEles=cy.collection();if(_p.newStyle){_p.contextStyles={};_p.propDiffs={};self.cleanElements(eles,true)}for(var ie=0;ie<eles.length;ie++){var ele=eles[ie];var cxtMeta=self.getContextMeta(ele);if(cxtMeta.empty){continue}var cxtStyle=self.getContextStyle(cxtMeta);var app=self.applyContextStyle(cxtMeta,cxtStyle,ele);if(!_p.newStyle){self.updateTransitions(ele,app.diffProps)}var hintsDiff=self.updateStyleHints(ele);if(hintsDiff){updatedEles.merge(ele)}}_p.newStyle=false;return updatedEles};styfn.getPropertiesDiff=function(oldCxtKey,newCxtKey){var self=this;var cache=self._private.propDiffs=self._private.propDiffs||{};var dualCxtKey=oldCxtKey+"-"+newCxtKey;var cachedVal=cache[dualCxtKey];if(cachedVal){return cachedVal}var diffProps=[];var addedProp={};for(var i=0;i<self.length;i++){var cxt=self[i];var oldHasCxt=oldCxtKey[i]===TRUE;var newHasCxt=newCxtKey[i]===TRUE;var cxtHasDiffed=oldHasCxt!==newHasCxt;var cxtHasMappedProps=cxt.mappedProperties.length>0;if(cxtHasDiffed||newHasCxt&&cxtHasMappedProps){var props=void 0;if(cxtHasDiffed&&cxtHasMappedProps){props=cxt.properties}else if(cxtHasDiffed){props=cxt.properties}else if(cxtHasMappedProps){props=cxt.mappedProperties}for(var j=0;j<props.length;j++){var prop=props[j];var name=prop.name;var laterCxtOverrides=false;for(var k=i+1;k<self.length;k++){var laterCxt=self[k];var hasLaterCxt=newCxtKey[k]===TRUE;if(!hasLaterCxt){continue}laterCxtOverrides=laterCxt.properties[prop.name]!=null;if(laterCxtOverrides){break}}if(!addedProp[name]&&!laterCxtOverrides){addedProp[name]=true;diffProps.push(name)}}}}cache[dualCxtKey]=diffProps;return diffProps};styfn.getContextMeta=function(ele){var self=this;var cxtKey="";var diffProps;var prevKey=ele._private.styleCxtKey||"";if(self._private.newStyle){prevKey=""}for(var i=0;i<self.length;i++){var context=self[i];var contextSelectorMatches=context.selector&&context.selector.matches(ele);if(contextSelectorMatches){cxtKey+=TRUE}else{cxtKey+=FALSE}}diffProps=self.getPropertiesDiff(prevKey,cxtKey);ele._private.styleCxtKey=cxtKey;return{key:cxtKey,diffPropNames:diffProps,empty:diffProps.length===0}};styfn.getContextStyle=function(cxtMeta){var cxtKey=cxtMeta.key;var self=this;var cxtStyles=this._private.contextStyles=this._private.contextStyles||{};if(cxtStyles[cxtKey]){return cxtStyles[cxtKey]}var style={_private:{key:cxtKey}};for(var i=0;i<self.length;i++){var cxt=self[i];var hasCxt=cxtKey[i]===TRUE;if(!hasCxt){continue}for(var j=0;j<cxt.properties.length;j++){var prop=cxt.properties[j];style[prop.name]=prop}}cxtStyles[cxtKey]=style;return style};styfn.applyContextStyle=function(cxtMeta,cxtStyle,ele){var self=this;var diffProps=cxtMeta.diffPropNames;var retDiffProps={};var types=self.types;for(var i=0;i<diffProps.length;i++){var diffPropName=diffProps[i];var cxtProp=cxtStyle[diffPropName];var eleProp=ele.pstyle(diffPropName);if(!cxtProp){if(!eleProp){continue}else if(eleProp.bypass){cxtProp={name:diffPropName,deleteBypassed:true}}else{cxtProp={name:diffPropName,delete:true}}}if(eleProp===cxtProp){continue}if(cxtProp.mapped===types.fn&&eleProp!=null&&eleProp.mapping!=null&&eleProp.mapping.value===cxtProp.value){var mapping=eleProp.mapping;var fnValue=mapping.fnValue=cxtProp.value(ele);if(fnValue===mapping.prevFnValue){continue}}var retDiffProp=retDiffProps[diffPropName]={prev:eleProp};self.applyParsedProperty(ele,cxtProp);retDiffProp.next=ele.pstyle(diffPropName);if(retDiffProp.next&&retDiffProp.next.bypass){retDiffProp.next=retDiffProp.next.bypassed}}return{diffProps:retDiffProps}};styfn.updateStyleHints=function(ele){var _p=ele._private;var self=this;var propNames=self.propertyGroupNames;var propGrKeys=self.propertyGroupKeys;var propHash=function propHash(ele,propNames,seedKey){return self.getPropertiesHash(ele,propNames,seedKey)};var oldStyleKey=_p.styleKey;if(ele.removed()){return false}var isNode=_p.group==="nodes";var overriddenStyles=ele._private.style;propNames=Object.keys(overriddenStyles);for(var i=0;i<propGrKeys.length;i++){var grKey=propGrKeys[i];_p.styleKeys[grKey]=0}var updateGrKey=function updateGrKey(val,grKey){return _p.styleKeys[grKey]=hashInt(val,_p.styleKeys[grKey])};var updateGrKeyWStr=function updateGrKeyWStr(strVal,grKey){for(var j=0;j<strVal.length;j++){updateGrKey(strVal.charCodeAt(j),grKey)}};var N=2e9;var cleanNum=function cleanNum(val){return-128<val&&val<128&&Math.floor(val)!==val?N-(val*1024|0):val};for(var _i=0;_i<propNames.length;_i++){var name=propNames[_i];var parsedProp=overriddenStyles[name];if(parsedProp==null){continue}var propInfo=this.properties[name];var type=propInfo.type;var _grKey=propInfo.groupKey;var normalizedNumberVal=void 0;if(propInfo.hashOverride!=null){normalizedNumberVal=propInfo.hashOverride(ele,parsedProp)}else if(parsedProp.pfValue!=null){normalizedNumberVal=parsedProp.pfValue}var numberVal=propInfo.enums==null?parsedProp.value:null;var haveNormNum=normalizedNumberVal!=null;var haveUnitedNum=numberVal!=null;var haveNum=haveNormNum||haveUnitedNum;var units=parsedProp.units;if(type.number&&haveNum){var v=haveNormNum?normalizedNumberVal:numberVal;if(type.multiple){for(var _i2=0;_i2<v.length;_i2++){updateGrKey(cleanNum(v[_i2]),_grKey)}}else{updateGrKey(cleanNum(v),_grKey)}if(!haveNormNum&&units!=null){updateGrKeyWStr(units,_grKey)}}else{updateGrKeyWStr(parsedProp.strValue,_grKey)}}var hash=0;for(var _i3=0;_i3<propGrKeys.length;_i3++){var _grKey2=propGrKeys[_i3];var grHash=_p.styleKeys[_grKey2];hash=hashInt(grHash,hash)}_p.styleKey=hash;var labelDimsKey=_p.labelDimsKey=_p.styleKeys.labelDimensions;_p.labelKey=propHash(ele,["label"],labelDimsKey);_p.labelStyleKey=hashInt(_p.styleKeys.commonLabel,_p.labelKey);if(!isNode){_p.sourceLabelKey=propHash(ele,["source-label"],labelDimsKey);_p.sourceLabelStyleKey=hashInt(_p.styleKeys.commonLabel,_p.sourceLabelKey);_p.targetLabelKey=propHash(ele,["target-label"],labelDimsKey);_p.targetLabelStyleKey=hashInt(_p.styleKeys.commonLabel,_p.targetLabelKey)}if(isNode){var _p$styleKeys=_p.styleKeys,nodeBody=_p$styleKeys.nodeBody,nodeBorder=_p$styleKeys.nodeBorder,backgroundImage=_p$styleKeys.backgroundImage,compound=_p$styleKeys.compound,pie=_p$styleKeys.pie;_p.nodeKey=hashIntsArray([nodeBorder,backgroundImage,compound,pie],nodeBody);_p.hasPie=pie!=0}return oldStyleKey!==_p.styleKey};styfn.clearStyleHints=function(ele){var _p=ele._private;_p.styleKeys={};_p.styleKey=null;_p.labelKey=null;_p.labelStyleKey=null;_p.sourceLabelKey=null;_p.sourceLabelStyleKey=null;_p.targetLabelKey=null;_p.targetLabelStyleKey=null;_p.nodeKey=null;_p.hasPie=null};styfn.applyParsedProperty=function(ele,parsedProp){var self=this;var prop=parsedProp;var style=ele._private.style;var flatProp;var types=self.types;var type=self.properties[prop.name].type;var propIsBypass=prop.bypass;var origProp=style[prop.name];var origPropIsBypass=origProp&&origProp.bypass;var _p=ele._private;var flatPropMapping="mapping";var getVal=function getVal(p){if(p==null){return null}else if(p.pfValue!=null){return p.pfValue}else{return p.value}};var checkTriggers=function checkTriggers(){var fromVal=getVal(origProp);var toVal=getVal(prop);self.checkTriggers(ele,prop.name,fromVal,toVal)};if(parsedProp.name==="curve-style"&&ele.isEdge()&&(parsedProp.value!=="bezier"&&ele.isLoop()||parsedProp.value==="haystack"&&(ele.source().isParent()||ele.target().isParent()))){prop=parsedProp=this.parse(parsedProp.name,"bezier",propIsBypass)}if(prop["delete"]){style[prop.name]=undefined;checkTriggers();return true}if(prop.deleteBypassed){if(!origProp){checkTriggers();return true}else if(origProp.bypass){origProp.bypassed=undefined;checkTriggers();return true}else{return false}}if(prop.deleteBypass){if(!origProp){checkTriggers();return true}else if(origProp.bypass){style[prop.name]=origProp.bypassed;checkTriggers();return true}else{return false}}var printMappingErr=function printMappingErr(){warn("Do not assign mappings to elements without corresponding data (i.e. ele `"+ele.id()+"` has no mapping for property `"+prop.name+"` with data field `"+prop.field+"`); try a `["+prop.field+"]` selector to limit scope to elements with `"+prop.field+"` defined")};switch(prop.mapped){case types.mapData:{var fields=prop.field.split(".");var fieldVal=_p.data;for(var i=0;i<fields.length&&fieldVal;i++){var field=fields[i];fieldVal=fieldVal[field]}if(fieldVal==null){printMappingErr();return false}var percent;if(!number(fieldVal)){warn("Do not use continuous mappers without specifying numeric data (i.e. `"+prop.field+": "+fieldVal+"` for `"+ele.id()+"` is non-numeric)");return false}else{var fieldWidth=prop.fieldMax-prop.fieldMin;if(fieldWidth===0){percent=0}else{percent=(fieldVal-prop.fieldMin)/fieldWidth}}if(percent<0){percent=0}else if(percent>1){percent=1}if(type.color){var r1=prop.valueMin[0];var r2=prop.valueMax[0];var g1=prop.valueMin[1];var g2=prop.valueMax[1];var b1=prop.valueMin[2];var b2=prop.valueMax[2];var a1=prop.valueMin[3]==null?1:prop.valueMin[3];var a2=prop.valueMax[3]==null?1:prop.valueMax[3];var clr=[Math.round(r1+(r2-r1)*percent),Math.round(g1+(g2-g1)*percent),Math.round(b1+(b2-b1)*percent),Math.round(a1+(a2-a1)*percent)];flatProp={bypass:prop.bypass,name:prop.name,value:clr,strValue:"rgb("+clr[0]+", "+clr[1]+", "+clr[2]+")"}}else if(type.number){var calcValue=prop.valueMin+(prop.valueMax-prop.valueMin)*percent;flatProp=this.parse(prop.name,calcValue,prop.bypass,flatPropMapping)}else{return false}if(!flatProp){printMappingErr();return false}flatProp.mapping=prop;prop=flatProp;break}case types.data:{var _fields=prop.field.split(".");var _fieldVal=_p.data;for(var _i4=0;_i4<_fields.length&&_fieldVal;_i4++){var _field=_fields[_i4];_fieldVal=_fieldVal[_field]}if(_fieldVal!=null){flatProp=this.parse(prop.name,_fieldVal,prop.bypass,flatPropMapping)}if(!flatProp){printMappingErr();return false}flatProp.mapping=prop;prop=flatProp;break}case types.fn:{var fn=prop.value;var fnRetVal=prop.fnValue!=null?prop.fnValue:fn(ele);prop.prevFnValue=fnRetVal;if(fnRetVal==null){warn("Custom function mappers may not return null (i.e. `"+prop.name+"` for ele `"+ele.id()+"` is null)");return false}flatProp=this.parse(prop.name,fnRetVal,prop.bypass,flatPropMapping);if(!flatProp){warn("Custom function mappers may not return invalid values for the property type (i.e. `"+prop.name+"` for ele `"+ele.id()+"` is invalid)");return false}flatProp.mapping=copy(prop);prop=flatProp;break}case undefined:break;default:return false}if(propIsBypass){if(origPropIsBypass){prop.bypassed=origProp.bypassed}else{prop.bypassed=origProp}style[prop.name]=prop}else{if(origPropIsBypass){origProp.bypassed=prop}else{style[prop.name]=prop}}checkTriggers();return true};styfn.cleanElements=function(eles,keepBypasses){for(var i=0;i<eles.length;i++){var ele=eles[i];this.clearStyleHints(ele);ele.dirtyCompoundBoundsCache();ele.dirtyBoundingBoxCache();if(!keepBypasses){ele._private.style={}}else{var style=ele._private.style;var propNames=Object.keys(style);for(var j=0;j<propNames.length;j++){var propName=propNames[j];var eleProp=style[propName];if(eleProp!=null){if(eleProp.bypass){eleProp.bypassed=null}else{style[propName]=null}}}}}};styfn.update=function(){var cy=this._private.cy;var eles=cy.mutableElements();eles.updateStyle()};styfn.updateTransitions=function(ele,diffProps){var self=this;var _p=ele._private;var props=ele.pstyle("transition-property").value;var duration=ele.pstyle("transition-duration").pfValue;var delay=ele.pstyle("transition-delay").pfValue;if(props.length>0&&duration>0){var style={};var anyPrev=false;for(var i=0;i<props.length;i++){var prop=props[i];var styProp=ele.pstyle(prop);var diffProp=diffProps[prop];if(!diffProp){continue}var prevProp=diffProp.prev;var fromProp=prevProp;var toProp=diffProp.next!=null?diffProp.next:styProp;var diff=false;var initVal=void 0;var initDt=1e-6;if(!fromProp){continue}if(number(fromProp.pfValue)&&number(toProp.pfValue)){diff=toProp.pfValue-fromProp.pfValue;initVal=fromProp.pfValue+initDt*diff}else if(number(fromProp.value)&&number(toProp.value)){diff=toProp.value-fromProp.value;initVal=fromProp.value+initDt*diff}else if(array(fromProp.value)&&array(toProp.value)){diff=fromProp.value[0]!==toProp.value[0]||fromProp.value[1]!==toProp.value[1]||fromProp.value[2]!==toProp.value[2];initVal=fromProp.strValue}if(diff){style[prop]=toProp.strValue;this.applyBypass(ele,prop,initVal);anyPrev=true}}if(!anyPrev){return}_p.transitioning=true;new Promise$1((function(resolve){if(delay>0){ele.delayAnimation(delay).play().promise().then(resolve)}else{resolve()}})).then((function(){return ele.animation({style:style,duration:duration,easing:ele.pstyle("transition-timing-function").value,queue:false}).play().promise()})).then((function(){self.removeBypasses(ele,props);ele.emitAndNotify("style");_p.transitioning=false}))}else if(_p.transitioning){this.removeBypasses(ele,props);ele.emitAndNotify("style");_p.transitioning=false}};styfn.checkTrigger=function(ele,name,fromValue,toValue,getTrigger,onTrigger){var prop=this.properties[name];var triggerCheck=getTrigger(prop);if(triggerCheck!=null&&triggerCheck(fromValue,toValue)){onTrigger(prop)}};styfn.checkZOrderTrigger=function(ele,name,fromValue,toValue){var _this=this;this.checkTrigger(ele,name,fromValue,toValue,(function(prop){return prop.triggersZOrder}),(function(){_this._private.cy.notify("zorder",ele)}))};styfn.checkBoundsTrigger=function(ele,name,fromValue,toValue){this.checkTrigger(ele,name,fromValue,toValue,(function(prop){return prop.triggersBounds}),(function(prop){ele.dirtyCompoundBoundsCache();ele.dirtyBoundingBoxCache();if((ele.pstyle("curve-style").value==="bezier"||name==="curve-style"&&(fromValue==="bezier"||toValue==="bezier"))&&prop.triggersBoundsOfParallelBeziers){ele.parallelEdges().forEach((function(pllEdge){if(pllEdge.isBundledBezier()){pllEdge.dirtyBoundingBoxCache()}}))}}))};styfn.checkTriggers=function(ele,name,fromValue,toValue){ele.dirtyStyleCache();this.checkZOrderTrigger(ele,name,fromValue,toValue);this.checkBoundsTrigger(ele,name,fromValue,toValue)};var styfn$1={};styfn$1.applyBypass=function(eles,name,value,updateTransitions){var self=this;var props=[];var isBypass=true;if(name==="*"||name==="**"){if(value!==undefined){for(var i=0;i<self.properties.length;i++){var prop=self.properties[i];var _name=prop.name;var parsedProp=this.parse(_name,value,true);if(parsedProp){props.push(parsedProp)}}}}else if(string(name)){var _parsedProp=this.parse(name,value,true);if(_parsedProp){props.push(_parsedProp)}}else if(plainObject(name)){var specifiedProps=name;updateTransitions=value;var names=Object.keys(specifiedProps);for(var _i=0;_i<names.length;_i++){var _name2=names[_i];var _value=specifiedProps[_name2];if(_value===undefined){_value=specifiedProps[dash2camel(_name2)]}if(_value!==undefined){var _parsedProp2=this.parse(_name2,_value,true);if(_parsedProp2){props.push(_parsedProp2)}}}}else{return false}if(props.length===0){return false}var ret=false;for(var _i2=0;_i2<eles.length;_i2++){var ele=eles[_i2];var diffProps={};var diffProp=void 0;for(var j=0;j<props.length;j++){var _prop=props[j];if(updateTransitions){var prevProp=ele.pstyle(_prop.name);diffProp=diffProps[_prop.name]={prev:prevProp}}ret=this.applyParsedProperty(ele,_prop)||ret;if(updateTransitions){diffProp.next=ele.pstyle(_prop.name)}}if(ret){this.updateStyleHints(ele)}if(updateTransitions){this.updateTransitions(ele,diffProps,isBypass)}}return ret};styfn$1.overrideBypass=function(eles,name,value){name=camel2dash(name);for(var i=0;i<eles.length;i++){var ele=eles[i];var prop=ele._private.style[name];var type=this.properties[name].type;var isColor=type.color;var isMulti=type.mutiple;var oldValue=!prop?null:prop.pfValue!=null?prop.pfValue:prop.value;if(!prop||!prop.bypass){this.applyBypass(ele,name,value)}else{prop.value=value;if(prop.pfValue!=null){prop.pfValue=value}if(isColor){prop.strValue="rgb("+value.join(",")+")"}else if(isMulti){prop.strValue=value.join(" ")}else{prop.strValue=""+value}this.updateStyleHints(ele)}this.checkTriggers(ele,name,oldValue,value)}};styfn$1.removeAllBypasses=function(eles,updateTransitions){return this.removeBypasses(eles,this.propertyNames,updateTransitions)};styfn$1.removeBypasses=function(eles,props,updateTransitions){var isBypass=true;for(var j=0;j<eles.length;j++){var ele=eles[j];var diffProps={};for(var i=0;i<props.length;i++){var name=props[i];var prop=this.properties[name];var prevProp=ele.pstyle(prop.name);if(!prevProp||!prevProp.bypass){continue}var value="";var parsedProp=this.parse(name,value,true);var diffProp=diffProps[prop.name]={prev:prevProp};this.applyParsedProperty(ele,parsedProp);diffProp.next=ele.pstyle(prop.name)}this.updateStyleHints(ele);if(updateTransitions){this.updateTransitions(ele,diffProps,isBypass)}}};var styfn$2={};styfn$2.getEmSizeInPixels=function(){var px=this.containerCss("font-size");if(px!=null){return parseFloat(px)}else{return 1}};styfn$2.containerCss=function(propName){var cy=this._private.cy;var domElement=cy.container();if(window$1&&domElement&&window$1.getComputedStyle){return window$1.getComputedStyle(domElement).getPropertyValue(propName)}};var styfn$3={};styfn$3.getRenderedStyle=function(ele,prop){if(prop){return this.getStylePropertyValue(ele,prop,true)}else{return this.getRawStyle(ele,true)}};styfn$3.getRawStyle=function(ele,isRenderedVal){var self=this;ele=ele[0];if(ele){var rstyle={};for(var i=0;i<self.properties.length;i++){var prop=self.properties[i];var val=self.getStylePropertyValue(ele,prop.name,isRenderedVal);if(val!=null){rstyle[prop.name]=val;rstyle[dash2camel(prop.name)]=val}}return rstyle}};styfn$3.getIndexedStyle=function(ele,property,subproperty,index){var pstyle=ele.pstyle(property)[subproperty][index];return pstyle!=null?pstyle:ele.cy().style().getDefaultProperty(property)[subproperty][0]};styfn$3.getStylePropertyValue=function(ele,propName,isRenderedVal){var self=this;ele=ele[0];if(ele){var prop=self.properties[propName];if(prop.alias){prop=prop.pointsTo}var type=prop.type;var styleProp=ele.pstyle(prop.name);if(styleProp){var value=styleProp.value,units=styleProp.units,strValue=styleProp.strValue;if(isRenderedVal&&type.number&&value!=null&&number(value)){var zoom=ele.cy().zoom();var getRenderedValue=function getRenderedValue(val){return val*zoom};var getValueStringWithUnits=function getValueStringWithUnits(val,units){return getRenderedValue(val)+units};var isArrayValue=array(value);var haveUnits=isArrayValue?units.every((function(u){return u!=null})):units!=null;if(haveUnits){if(isArrayValue){return value.map((function(v,i){return getValueStringWithUnits(v,units[i])})).join(" ")}else{return getValueStringWithUnits(value,units)}}else{if(isArrayValue){return value.map((function(v){return string(v)?v:""+getRenderedValue(v)})).join(" ")}else{return""+getRenderedValue(value)}}}else if(strValue!=null){return strValue}}return null}};styfn$3.getAnimationStartStyle=function(ele,aniProps){var rstyle={};for(var i=0;i<aniProps.length;i++){var aniProp=aniProps[i];var name=aniProp.name;var styleProp=ele.pstyle(name);if(styleProp!==undefined){if(plainObject(styleProp)){styleProp=this.parse(name,styleProp.strValue)}else{styleProp=this.parse(name,styleProp)}}if(styleProp){rstyle[name]=styleProp}}return rstyle};styfn$3.getPropsList=function(propsObj){var self=this;var rstyle=[];var style=propsObj;var props=self.properties;if(style){var names=Object.keys(style);for(var i=0;i<names.length;i++){var name=names[i];var val=style[name];var prop=props[name]||props[camel2dash(name)];var styleProp=this.parse(prop.name,val);if(styleProp){rstyle.push(styleProp)}}}return rstyle};styfn$3.getNonDefaultPropertiesHash=function(ele,propNames,seed){var hash=seed;var name,val,strVal,chVal;var i,j;for(i=0;i<propNames.length;i++){name=propNames[i];val=ele.pstyle(name,false);if(val==null){continue}else if(val.pfValue!=null){hash=hashInt(chVal,hash)}else{strVal=val.strValue;for(j=0;j<strVal.length;j++){chVal=strVal.charCodeAt(j);hash=hashInt(chVal,hash)}}}return hash};styfn$3.getPropertiesHash=styfn$3.getNonDefaultPropertiesHash;var styfn$4={};styfn$4.appendFromJson=function(json){var style=this;for(var i=0;i<json.length;i++){var context=json[i];var selector=context.selector;var props=context.style||context.css;var names=Object.keys(props);style.selector(selector);for(var j=0;j<names.length;j++){var name=names[j];var value=props[name];style.css(name,value)}}return style};styfn$4.fromJson=function(json){var style=this;style.resetToDefault();style.appendFromJson(json);return style};styfn$4.json=function(){var json=[];for(var i=this.defaultLength;i<this.length;i++){var cxt=this[i];var selector=cxt.selector;var props=cxt.properties;var css={};for(var j=0;j<props.length;j++){var prop=props[j];css[prop.name]=prop.strValue}json.push({selector:!selector?"core":selector.toString(),style:css})}return json};var styfn$5={};styfn$5.appendFromString=function(string){var self=this;var style=this;var remaining=""+string;var selAndBlockStr;var blockRem;var propAndValStr;remaining=remaining.replace(/[/][*](\s|.)+?[*][/]/g,"");function removeSelAndBlockFromRemaining(){if(remaining.length>selAndBlockStr.length){remaining=remaining.substr(selAndBlockStr.length)}else{remaining=""}}function removePropAndValFromRem(){if(blockRem.length>propAndValStr.length){blockRem=blockRem.substr(propAndValStr.length)}else{blockRem=""}}for(;;){var nothingLeftToParse=remaining.match(/^\s*$/);if(nothingLeftToParse){break}var selAndBlock=remaining.match(/^\s*((?:.|\s)+?)\s*\{((?:.|\s)+?)\}/);if(!selAndBlock){warn("Halting stylesheet parsing: String stylesheet contains more to parse but no selector and block found in: "+remaining);break}selAndBlockStr=selAndBlock[0];var selectorStr=selAndBlock[1];if(selectorStr!=="core"){var selector=new Selector(selectorStr);if(selector.invalid){warn("Skipping parsing of block: Invalid selector found in string stylesheet: "+selectorStr);removeSelAndBlockFromRemaining();continue}}var blockStr=selAndBlock[2];var invalidBlock=false;blockRem=blockStr;var props=[];for(;;){var _nothingLeftToParse=blockRem.match(/^\s*$/);if(_nothingLeftToParse){break}var propAndVal=blockRem.match(/^\s*(.+?)\s*:\s*(.+?)\s*;/);if(!propAndVal){warn("Skipping parsing of block: Invalid formatting of style property and value definitions found in:"+blockStr);invalidBlock=true;break}propAndValStr=propAndVal[0];var propStr=propAndVal[1];var valStr=propAndVal[2];var prop=self.properties[propStr];if(!prop){warn("Skipping property: Invalid property name in: "+propAndValStr);removePropAndValFromRem();continue}var parsedProp=style.parse(propStr,valStr);if(!parsedProp){warn("Skipping property: Invalid property definition in: "+propAndValStr);removePropAndValFromRem();continue}props.push({name:propStr,val:valStr});removePropAndValFromRem()}if(invalidBlock){removeSelAndBlockFromRemaining();break}style.selector(selectorStr);for(var i=0;i<props.length;i++){var _prop=props[i];style.css(_prop.name,_prop.val)}removeSelAndBlockFromRemaining()}return style};styfn$5.fromString=function(string){var style=this;style.resetToDefault();style.appendFromString(string);return style};var styfn$6={};(function(){var number=number$1;var rgba=rgbaNoBackRefs;var hsla=hslaNoBackRefs;var hex3$1=hex3;var hex6$1=hex6;var data=function data(prefix){return"^"+prefix+"\\s*\\(\\s*([\\w\\.]+)\\s*\\)$"};var mapData=function mapData(prefix){var mapArg=number+"|\\w+|"+rgba+"|"+hsla+"|"+hex3$1+"|"+hex6$1;return"^"+prefix+"\\s*\\(([\\w\\.]+)\\s*\\,\\s*("+number+")\\s*\\,\\s*("+number+")\\s*,\\s*("+mapArg+")\\s*\\,\\s*("+mapArg+")\\)$"};var urlRegexes=["^url\\s*\\(\\s*['\"]?(.+?)['\"]?\\s*\\)$","^(none)$","^(.+)$"];styfn$6.types={time:{number:true,min:0,units:"s|ms",implicitUnits:"ms"},percent:{number:true,min:0,max:100,units:"%",implicitUnits:"%"},percentages:{number:true,min:0,max:100,units:"%",implicitUnits:"%",multiple:true},zeroOneNumber:{number:true,min:0,max:1,unitless:true},zeroOneNumbers:{number:true,min:0,max:1,unitless:true,multiple:true},nOneOneNumber:{number:true,min:-1,max:1,unitless:true},nonNegativeInt:{number:true,min:0,integer:true,unitless:true},position:{enums:["parent","origin"]},nodeSize:{number:true,min:0,enums:["label"]},number:{number:true,unitless:true},numbers:{number:true,unitless:true,multiple:true},positiveNumber:{number:true,unitless:true,min:0,strictMin:true},size:{number:true,min:0},bidirectionalSize:{number:true},bidirectionalSizes:{number:true,multiple:true},sizeMaybePercent:{number:true,min:0,allowPercent:true},axisDirection:{enums:["horizontal","leftward","rightward","vertical","upward","downward","auto"]},paddingRelativeTo:{enums:["width","height","average","min","max"]},bgWH:{number:true,min:0,allowPercent:true,enums:["auto"],multiple:true},bgPos:{number:true,allowPercent:true,multiple:true},bgRelativeTo:{enums:["inner","include-padding"],multiple:true},bgRepeat:{enums:["repeat","repeat-x","repeat-y","no-repeat"],multiple:true},bgFit:{enums:["none","contain","cover"],multiple:true},bgCrossOrigin:{enums:["anonymous","use-credentials"],multiple:true},bgClip:{enums:["none","node"],multiple:true},color:{color:true},colors:{color:true,multiple:true},fill:{enums:["solid","linear-gradient","radial-gradient"]},bool:{enums:["yes","no"]},lineStyle:{enums:["solid","dotted","dashed"]},lineCap:{enums:["butt","round","square"]},borderStyle:{enums:["solid","dotted","dashed","double"]},curveStyle:{enums:["bezier","unbundled-bezier","haystack","segments","straight","taxi"]},fontFamily:{regex:'^([\\w- \\"]+(?:\\s*,\\s*[\\w- \\"]+)*)$'},fontStyle:{enums:["italic","normal","oblique"]},fontWeight:{enums:["normal","bold","bolder","lighter","100","200","300","400","500","600","800","900",100,200,300,400,500,600,700,800,900]},textDecoration:{enums:["none","underline","overline","line-through"]},textTransform:{enums:["none","uppercase","lowercase"]},textWrap:{enums:["none","wrap","ellipsis"]},textOverflowWrap:{enums:["whitespace","anywhere"]},textBackgroundShape:{enums:["rectangle","roundrectangle","round-rectangle"]},nodeShape:{enums:["rectangle","roundrectangle","round-rectangle","cutrectangle","cut-rectangle","bottomroundrectangle","bottom-round-rectangle","barrel","ellipse","triangle","square","pentagon","hexagon","concavehexagon","concave-hexagon","heptagon","octagon","tag","star","diamond","vee","rhomboid","polygon"]},compoundIncludeLabels:{enums:["include","exclude"]},arrowShape:{enums:["tee","triangle","triangle-tee","triangle-cross","triangle-backcurve","vee","square","circle","diamond","chevron","none"]},arrowFill:{enums:["filled","hollow"]},display:{enums:["element","none"]},visibility:{enums:["hidden","visible"]},zCompoundDepth:{enums:["bottom","orphan","auto","top"]},zIndexCompare:{enums:["auto","manual"]},valign:{enums:["top","center","bottom"]},halign:{enums:["left","center","right"]},justification:{enums:["left","center","right","auto"]},text:{string:true},data:{mapping:true,regex:data("data")},layoutData:{mapping:true,regex:data("layoutData")},scratch:{mapping:true,regex:data("scratch")},mapData:{mapping:true,regex:mapData("mapData")},mapLayoutData:{mapping:true,regex:mapData("mapLayoutData")},mapScratch:{mapping:true,regex:mapData("mapScratch")},fn:{mapping:true,fn:true},url:{regexes:urlRegexes,singleRegexMatchValue:true},urls:{regexes:urlRegexes,singleRegexMatchValue:true,multiple:true},propList:{propList:true},angle:{number:true,units:"deg|rad",implicitUnits:"rad"},textRotation:{number:true,units:"deg|rad",implicitUnits:"rad",enums:["none","autorotate"]},polygonPointList:{number:true,multiple:true,evenMultiple:true,min:-1,max:1,unitless:true},edgeDistances:{enums:["intersection","node-position"]},edgeEndpoint:{number:true,multiple:true,units:"%|px|em|deg|rad",implicitUnits:"px",enums:["inside-to-node","outside-to-node","outside-to-node-or-label","outside-to-line","outside-to-line-or-label"],singleEnum:true,validate:function validate(valArr,unitsArr){switch(valArr.length){case 2:return unitsArr[0]!=="deg"&&unitsArr[0]!=="rad"&&unitsArr[1]!=="deg"&&unitsArr[1]!=="rad";case 1:return string(valArr[0])||unitsArr[0]==="deg"||unitsArr[0]==="rad";default:return false}}},easing:{regexes:["^(spring)\\s*\\(\\s*("+number+")\\s*,\\s*("+number+")\\s*\\)$","^(cubic-bezier)\\s*\\(\\s*("+number+")\\s*,\\s*("+number+")\\s*,\\s*("+number+")\\s*,\\s*("+number+")\\s*\\)$"],enums:["linear","ease","ease-in","ease-out","ease-in-out","ease-in-sine","ease-out-sine","ease-in-out-sine","ease-in-quad","ease-out-quad","ease-in-out-quad","ease-in-cubic","ease-out-cubic","ease-in-out-cubic","ease-in-quart","ease-out-quart","ease-in-out-quart","ease-in-quint","ease-out-quint","ease-in-out-quint","ease-in-expo","ease-out-expo","ease-in-out-expo","ease-in-circ","ease-out-circ","ease-in-out-circ"]},gradientDirection:{enums:["to-bottom","to-top","to-left","to-right","to-bottom-right","to-bottom-left","to-top-right","to-top-left","to-right-bottom","to-left-bottom","to-right-top","to-left-top"]},boundsExpansion:{number:true,multiple:true,min:0,validate:function validate(valArr){var length=valArr.length;return length===1||length===2||length===4}}};var diff={zeroNonZero:function zeroNonZero(val1,val2){if((val1==null||val2==null)&&val1!==val2){return true}if(val1==0&&val2!=0){return true}else if(val1!=0&&val2==0){return true}else{return false}},any:function any(val1,val2){return val1!=val2}};var t=styfn$6.types;var mainLabel=[{name:"label",type:t.text,triggersBounds:diff.any},{name:"text-rotation",type:t.textRotation,triggersBounds:diff.any},{name:"text-margin-x",type:t.bidirectionalSize,triggersBounds:diff.any},{name:"text-margin-y",type:t.bidirectionalSize,triggersBounds:diff.any}];var sourceLabel=[{name:"source-label",type:t.text,triggersBounds:diff.any},{name:"source-text-rotation",type:t.textRotation,triggersBounds:diff.any},{name:"source-text-margin-x",type:t.bidirectionalSize,triggersBounds:diff.any},{name:"source-text-margin-y",type:t.bidirectionalSize,triggersBounds:diff.any},{name:"source-text-offset",type:t.size,triggersBounds:diff.any}];var targetLabel=[{name:"target-label",type:t.text,triggersBounds:diff.any},{name:"target-text-rotation",type:t.textRotation,triggersBounds:diff.any},{name:"target-text-margin-x",type:t.bidirectionalSize,triggersBounds:diff.any},{name:"target-text-margin-y",type:t.bidirectionalSize,triggersBounds:diff.any},{name:"target-text-offset",type:t.size,triggersBounds:diff.any}];var labelDimensions=[{name:"font-family",type:t.fontFamily,triggersBounds:diff.any},{name:"font-style",type:t.fontStyle,triggersBounds:diff.any},{name:"font-weight",type:t.fontWeight,triggersBounds:diff.any},{name:"font-size",type:t.size,triggersBounds:diff.any},{name:"text-transform",type:t.textTransform,triggersBounds:diff.any},{name:"text-wrap",type:t.textWrap,triggersBounds:diff.any},{name:"text-overflow-wrap",type:t.textOverflowWrap,triggersBounds:diff.any},{name:"text-max-width",type:t.size,triggersBounds:diff.any},{name:"text-outline-width",type:t.size,triggersBounds:diff.any},{name:"line-height",type:t.positiveNumber,triggersBounds:diff.any}];var commonLabel=[{name:"text-valign",type:t.valign,triggersBounds:diff.any},{name:"text-halign",type:t.halign,triggersBounds:diff.any},{name:"color",type:t.color},{name:"text-outline-color",type:t.color},{name:"text-outline-opacity",type:t.zeroOneNumber},{name:"text-background-color",type:t.color},{name:"text-background-opacity",type:t.zeroOneNumber},{name:"text-background-padding",type:t.size,triggersBounds:diff.any},{name:"text-border-opacity",type:t.zeroOneNumber},{name:"text-border-color",type:t.color},{name:"text-border-width",type:t.size,triggersBounds:diff.any},{name:"text-border-style",type:t.borderStyle,triggersBounds:diff.any},{name:"text-background-shape",type:t.textBackgroundShape,triggersBounds:diff.any},{name:"text-justification",type:t.justification}];var behavior=[{name:"events",type:t.bool},{name:"text-events",type:t.bool}];var visibility=[{name:"display",type:t.display,triggersZOrder:diff.any,triggersBounds:diff.any,triggersBoundsOfParallelBeziers:true},{name:"visibility",type:t.visibility,triggersZOrder:diff.any},{name:"opacity",type:t.zeroOneNumber,triggersZOrder:diff.zeroNonZero},{name:"text-opacity",type:t.zeroOneNumber},{name:"min-zoomed-font-size",type:t.size},{name:"z-compound-depth",type:t.zCompoundDepth,triggersZOrder:diff.any},{name:"z-index-compare",type:t.zIndexCompare,triggersZOrder:diff.any},{name:"z-index",type:t.nonNegativeInt,triggersZOrder:diff.any}];var overlay=[{name:"overlay-padding",type:t.size,triggersBounds:diff.any},{name:"overlay-color",type:t.color},{name:"overlay-opacity",type:t.zeroOneNumber,triggersBounds:diff.zeroNonZero}];var transition=[{name:"transition-property",type:t.propList},{name:"transition-duration",type:t.time},{name:"transition-delay",type:t.time},{name:"transition-timing-function",type:t.easing}];var nodeSizeHashOverride=function nodeSizeHashOverride(ele,parsedProp){if(parsedProp.value==="label"){return-ele.poolIndex()}else{return parsedProp.pfValue}};var nodeBody=[{name:"height",type:t.nodeSize,triggersBounds:diff.any,hashOverride:nodeSizeHashOverride},{name:"width",type:t.nodeSize,triggersBounds:diff.any,hashOverride:nodeSizeHashOverride},{name:"shape",type:t.nodeShape,triggersBounds:diff.any},{name:"shape-polygon-points",type:t.polygonPointList,triggersBounds:diff.any},{name:"background-color",type:t.color},{name:"background-fill",type:t.fill},{name:"background-opacity",type:t.zeroOneNumber},{name:"background-blacken",type:t.nOneOneNumber},{name:"background-gradient-stop-colors",type:t.colors},{name:"background-gradient-stop-positions",type:t.percentages},{name:"background-gradient-direction",type:t.gradientDirection},{name:"padding",type:t.sizeMaybePercent,triggersBounds:diff.any},{name:"padding-relative-to",type:t.paddingRelativeTo,triggersBounds:diff.any},{name:"bounds-expansion",type:t.boundsExpansion,triggersBounds:diff.any}];var nodeBorder=[{name:"border-color",type:t.color},{name:"border-opacity",type:t.zeroOneNumber},{name:"border-width",type:t.size,triggersBounds:diff.any},{name:"border-style",type:t.borderStyle}];var backgroundImage=[{name:"background-image",type:t.urls},{name:"background-image-crossorigin",type:t.bgCrossOrigin},{name:"background-image-opacity",type:t.zeroOneNumbers},{name:"background-position-x",type:t.bgPos},{name:"background-position-y",type:t.bgPos},{name:"background-width-relative-to",type:t.bgRelativeTo},{name:"background-height-relative-to",type:t.bgRelativeTo},{name:"background-repeat",type:t.bgRepeat},{name:"background-fit",type:t.bgFit},{name:"background-clip",type:t.bgClip},{name:"background-width",type:t.bgWH},{name:"background-height",type:t.bgWH},{name:"background-offset-x",type:t.bgPos},{name:"background-offset-y",type:t.bgPos}];var compound=[{name:"position",type:t.position,triggersBounds:diff.any},{name:"compound-sizing-wrt-labels",type:t.compoundIncludeLabels,triggersBounds:diff.any},{name:"min-width",type:t.size,triggersBounds:diff.any},{name:"min-width-bias-left",type:t.sizeMaybePercent,triggersBounds:diff.any},{name:"min-width-bias-right",type:t.sizeMaybePercent,triggersBounds:diff.any},{name:"min-height",type:t.size,triggersBounds:diff.any},{name:"min-height-bias-top",type:t.sizeMaybePercent,triggersBounds:diff.any},{name:"min-height-bias-bottom",type:t.sizeMaybePercent,triggersBounds:diff.any}];var edgeLine=[{name:"line-style",type:t.lineStyle},{name:"line-color",type:t.color},{name:"line-fill",type:t.fill},{name:"line-cap",type:t.lineCap},{name:"line-dash-pattern",type:t.numbers},{name:"line-dash-offset",type:t.number},{name:"line-gradient-stop-colors",type:t.colors},{name:"line-gradient-stop-positions",type:t.percentages},{name:"curve-style",type:t.curveStyle,triggersBounds:diff.any,triggersBoundsOfParallelBeziers:true},{name:"haystack-radius",type:t.zeroOneNumber,triggersBounds:diff.any},{name:"source-endpoint",type:t.edgeEndpoint,triggersBounds:diff.any},{name:"target-endpoint",type:t.edgeEndpoint,triggersBounds:diff.any},{name:"control-point-step-size",type:t.size,triggersBounds:diff.any},{name:"control-point-distances",type:t.bidirectionalSizes,triggersBounds:diff.any},{name:"control-point-weights",type:t.numbers,triggersBounds:diff.any},{name:"segment-distances",type:t.bidirectionalSizes,triggersBounds:diff.any},{name:"segment-weights",type:t.numbers,triggersBounds:diff.any},{name:"taxi-turn",type:t.sizeMaybePercent,triggersBounds:diff.any},{name:"taxi-turn-min-distance",type:t.size,triggersBounds:diff.any},{name:"taxi-direction",type:t.axisDirection,triggersBounds:diff.any},{name:"edge-distances",type:t.edgeDistances,triggersBounds:diff.any},{name:"arrow-scale",type:t.positiveNumber,triggersBounds:diff.any},{name:"loop-direction",type:t.angle,triggersBounds:diff.any},{name:"loop-sweep",type:t.angle,triggersBounds:diff.any},{name:"source-distance-from-node",type:t.size,triggersBounds:diff.any},{name:"target-distance-from-node",type:t.size,triggersBounds:diff.any}];var ghost=[{name:"ghost",type:t.bool,triggersBounds:diff.any},{name:"ghost-offset-x",type:t.bidirectionalSize,triggersBounds:diff.any},{name:"ghost-offset-y",type:t.bidirectionalSize,triggersBounds:diff.any},{name:"ghost-opacity",type:t.zeroOneNumber}];var core=[{name:"selection-box-color",type:t.color},{name:"selection-box-opacity",type:t.zeroOneNumber},{name:"selection-box-border-color",type:t.color},{name:"selection-box-border-width",type:t.size},{name:"active-bg-color",type:t.color},{name:"active-bg-opacity",type:t.zeroOneNumber},{name:"active-bg-size",type:t.size},{name:"outside-texture-bg-color",type:t.color},{name:"outside-texture-bg-opacity",type:t.zeroOneNumber}];var pie=[];styfn$6.pieBackgroundN=16;pie.push({name:"pie-size",type:t.sizeMaybePercent});for(var i=1;i<=styfn$6.pieBackgroundN;i++){pie.push({name:"pie-"+i+"-background-color",type:t.color});pie.push({name:"pie-"+i+"-background-size",type:t.percent});pie.push({name:"pie-"+i+"-background-opacity",type:t.zeroOneNumber})}var edgeArrow=[];var arrowPrefixes=styfn$6.arrowPrefixes=["source","mid-source","target","mid-target"];[{name:"arrow-shape",type:t.arrowShape,triggersBounds:diff.any},{name:"arrow-color",type:t.color},{name:"arrow-fill",type:t.arrowFill}].forEach((function(prop){arrowPrefixes.forEach((function(prefix){var name=prefix+"-"+prop.name;var type=prop.type,triggersBounds=prop.triggersBounds;edgeArrow.push({name:name,type:type,triggersBounds:triggersBounds})}))}),{});var props=styfn$6.properties=[].concat(behavior,transition,visibility,overlay,ghost,commonLabel,labelDimensions,mainLabel,sourceLabel,targetLabel,nodeBody,nodeBorder,backgroundImage,pie,compound,edgeLine,edgeArrow,core);var propGroups=styfn$6.propertyGroups={behavior:behavior,transition:transition,visibility:visibility,overlay:overlay,ghost:ghost,commonLabel:commonLabel,labelDimensions:labelDimensions,mainLabel:mainLabel,sourceLabel:sourceLabel,targetLabel:targetLabel,nodeBody:nodeBody,nodeBorder:nodeBorder,backgroundImage:backgroundImage,pie:pie,compound:compound,edgeLine:edgeLine,edgeArrow:edgeArrow,core:core};var propGroupNames=styfn$6.propertyGroupNames={};var propGroupKeys=styfn$6.propertyGroupKeys=Object.keys(propGroups);propGroupKeys.forEach((function(key){propGroupNames[key]=propGroups[key].map((function(prop){return prop.name}));propGroups[key].forEach((function(prop){return prop.groupKey=key}))}));var aliases=styfn$6.aliases=[{name:"content",pointsTo:"label"},{name:"control-point-distance",pointsTo:"control-point-distances"},{name:"control-point-weight",pointsTo:"control-point-weights"},{name:"edge-text-rotation",pointsTo:"text-rotation"},{name:"padding-left",pointsTo:"padding"},{name:"padding-right",pointsTo:"padding"},{name:"padding-top",pointsTo:"padding"},{name:"padding-bottom",pointsTo:"padding"}];styfn$6.propertyNames=props.map((function(p){return p.name}));for(var _i=0;_i<props.length;_i++){var prop=props[_i];props[prop.name]=prop}for(var _i2=0;_i2<aliases.length;_i2++){var alias=aliases[_i2];var pointsToProp=props[alias.pointsTo];var aliasProp={name:alias.name,alias:true,pointsTo:pointsToProp};props.push(aliasProp);props[alias.name]=aliasProp}})();styfn$6.getDefaultProperty=function(name){return this.getDefaultProperties()[name]};styfn$6.getDefaultProperties=function(){var _p=this._private;if(_p.defaultProperties!=null){return _p.defaultProperties}var rawProps=extend({"selection-box-color":"#ddd","selection-box-opacity":.65,"selection-box-border-color":"#aaa","selection-box-border-width":1,"active-bg-color":"black","active-bg-opacity":.15,"active-bg-size":30,"outside-texture-bg-color":"#000","outside-texture-bg-opacity":.125,events:"yes","text-events":"no","text-valign":"top","text-halign":"center","text-justification":"auto","line-height":1,color:"#000","text-outline-color":"#000","text-outline-width":0,"text-outline-opacity":1,"text-opacity":1,"text-decoration":"none","text-transform":"none","text-wrap":"none","text-overflow-wrap":"whitespace","text-max-width":9999,"text-background-color":"#000","text-background-opacity":0,"text-background-shape":"rectangle","text-background-padding":0,"text-border-opacity":0,"text-border-width":0,"text-border-style":"solid","text-border-color":"#000","font-family":"Helvetica Neue, Helvetica, sans-serif","font-style":"normal","font-weight":"normal","font-size":16,"min-zoomed-font-size":0,"text-rotation":"none","source-text-rotation":"none","target-text-rotation":"none",visibility:"visible",display:"element",opacity:1,"z-compound-depth":"auto","z-index-compare":"auto","z-index":0,label:"","text-margin-x":0,"text-margin-y":0,"source-label":"","source-text-offset":0,"source-text-margin-x":0,"source-text-margin-y":0,"target-label":"","target-text-offset":0,"target-text-margin-x":0,"target-text-margin-y":0,"overlay-opacity":0,"overlay-color":"#000","overlay-padding":10,"transition-property":"none","transition-duration":0,"transition-delay":0,"transition-timing-function":"linear","background-blacken":0,"background-color":"#999","background-fill":"solid","background-opacity":1,"background-image":"none","background-image-crossorigin":"anonymous","background-image-opacity":1,"background-position-x":"50%","background-position-y":"50%","background-offset-x":0,"background-offset-y":0,"background-width-relative-to":"include-padding","background-height-relative-to":"include-padding","background-repeat":"no-repeat","background-fit":"none","background-clip":"node","background-width":"auto","background-height":"auto","border-color":"#000","border-opacity":1,"border-width":0,"border-style":"solid",height:30,width:30,shape:"ellipse","shape-polygon-points":"-1, -1,   1, -1,   1, 1,   -1, 1","bounds-expansion":0,"background-gradient-direction":"to-bottom","background-gradient-stop-colors":"#999","background-gradient-stop-positions":"0%",ghost:"no","ghost-offset-y":0,"ghost-offset-x":0,"ghost-opacity":0,padding:0,"padding-relative-to":"width",position:"origin","compound-sizing-wrt-labels":"include","min-width":0,"min-width-bias-left":0,"min-width-bias-right":0,"min-height":0,"min-height-bias-top":0,"min-height-bias-bottom":0},{"pie-size":"100%"},[{name:"pie-{{i}}-background-color",value:"black"},{name:"pie-{{i}}-background-size",value:"0%"},{name:"pie-{{i}}-background-opacity",value:1}].reduce((function(css,prop){for(var i=1;i<=styfn$6.pieBackgroundN;i++){var name=prop.name.replace("{{i}}",i);var val=prop.value;css[name]=val}return css}),{}),{"line-style":"solid","line-color":"#999","line-fill":"solid","line-cap":"butt","line-gradient-stop-colors":"#999","line-gradient-stop-positions":"0%","control-point-step-size":40,"control-point-weights":.5,"segment-weights":.5,"segment-distances":20,"taxi-turn":"50%","taxi-turn-min-distance":10,"taxi-direction":"auto","edge-distances":"intersection","curve-style":"haystack","haystack-radius":0,"arrow-scale":1,"loop-direction":"-45deg","loop-sweep":"-90deg","source-distance-from-node":0,"target-distance-from-node":0,"source-endpoint":"outside-to-node","target-endpoint":"outside-to-node","line-dash-pattern":[6,3],"line-dash-offset":0},[{name:"arrow-shape",value:"none"},{name:"arrow-color",value:"#999"},{name:"arrow-fill",value:"filled"}].reduce((function(css,prop){styfn$6.arrowPrefixes.forEach((function(prefix){var name=prefix+"-"+prop.name;var val=prop.value;css[name]=val}));return css}),{}));var parsedProps={};for(var i=0;i<this.properties.length;i++){var prop=this.properties[i];if(prop.pointsTo){continue}var name=prop.name;var val=rawProps[name];var parsedProp=this.parse(name,val);parsedProps[name]=parsedProp}_p.defaultProperties=parsedProps;return _p.defaultProperties};styfn$6.addDefaultStylesheet=function(){this.selector(":parent").css({shape:"rectangle",padding:10,"background-color":"#eee","border-color":"#ccc","border-width":1}).selector("edge").css({width:3}).selector(":loop").css({"curve-style":"bezier"}).selector("edge:compound").css({"curve-style":"bezier","source-endpoint":"outside-to-line","target-endpoint":"outside-to-line"}).selector(":selected").css({"background-color":"#0169D9","line-color":"#0169D9","source-arrow-color":"#0169D9","target-arrow-color":"#0169D9","mid-source-arrow-color":"#0169D9","mid-target-arrow-color":"#0169D9"}).selector(":parent:selected").css({"background-color":"#CCE1F9","border-color":"#aec8e5"}).selector(":active").css({"overlay-color":"black","overlay-padding":10,"overlay-opacity":.25});this.defaultLength=this.length};var styfn$7={};styfn$7.parse=function(name,value,propIsBypass,propIsFlat){var self=this;if(fn(value)){return self.parseImplWarn(name,value,propIsBypass,propIsFlat)}var flatKey=propIsFlat==="mapping"||propIsFlat===true||propIsFlat===false||propIsFlat==null?"dontcare":propIsFlat;var bypassKey=propIsBypass?"t":"f";var valueKey=""+value;var argHash=hashStrings(name,valueKey,bypassKey,flatKey);var propCache=self.propCache=self.propCache||[];var ret;if(!(ret=propCache[argHash])){ret=propCache[argHash]=self.parseImplWarn(name,value,propIsBypass,propIsFlat)}if(propIsBypass||propIsFlat==="mapping"){ret=copy(ret);if(ret){ret.value=copy(ret.value)}}return ret};styfn$7.parseImplWarn=function(name,value,propIsBypass,propIsFlat){var prop=this.parseImpl(name,value,propIsBypass,propIsFlat);if(!prop&&value!=null){warn("The style property `".concat(name,": ").concat(value,"` is invalid"))}return prop};styfn$7.parseImpl=function(name,value,propIsBypass,propIsFlat){var self=this;name=camel2dash(name);var property=self.properties[name];var passedValue=value;var types=self.types;if(!property){return null}if(value===undefined){return null}if(property.alias){property=property.pointsTo;name=property.name}var valueIsString=string(value);if(valueIsString){value=value.trim()}var type=property.type;if(!type){return null}if(propIsBypass&&(value===""||value===null)){return{name:name,value:value,bypass:true,deleteBypass:true}}if(fn(value)){return{name:name,value:value,strValue:"fn",mapped:types.fn,bypass:propIsBypass}}var data,mapData;if(!valueIsString||propIsFlat||value.length<7||value[1]!=="a");else if(value.length>=7&&value[0]==="d"&&(data=new RegExp(types.data.regex).exec(value))){if(propIsBypass){return false}var mapped=types.data;return{name:name,value:data,strValue:""+value,mapped:mapped,field:data[1],bypass:propIsBypass}}else if(value.length>=10&&value[0]==="m"&&(mapData=new RegExp(types.mapData.regex).exec(value))){if(propIsBypass){return false}if(type.multiple){return false}var _mapped=types.mapData;if(!(type.color||type.number)){return false}var valueMin=this.parse(name,mapData[4]);if(!valueMin||valueMin.mapped){return false}var valueMax=this.parse(name,mapData[5]);if(!valueMax||valueMax.mapped){return false}if(valueMin.pfValue===valueMax.pfValue||valueMin.strValue===valueMax.strValue){warn("`"+name+": "+value+"` is not a valid mapper because the output range is zero; converting to `"+name+": "+valueMin.strValue+"`");return this.parse(name,valueMin.strValue)}else if(type.color){var c1=valueMin.value;var c2=valueMax.value;var same=c1[0]===c2[0]&&c1[1]===c2[1]&&c1[2]===c2[2]&&(c1[3]===c2[3]||(c1[3]==null||c1[3]===1)&&(c2[3]==null||c2[3]===1));if(same){return false}}return{name:name,value:mapData,strValue:""+value,mapped:_mapped,field:mapData[1],fieldMin:parseFloat(mapData[2]),fieldMax:parseFloat(mapData[3]),valueMin:valueMin.value,valueMax:valueMax.value,bypass:propIsBypass}}if(type.multiple&&propIsFlat!=="multiple"){var vals;if(valueIsString){vals=value.split(/\s+/)}else if(array(value)){vals=value}else{vals=[value]}if(type.evenMultiple&&vals.length%2!==0){return null}var valArr=[];var unitsArr=[];var pfValArr=[];var strVal="";var hasEnum=false;for(var i=0;i<vals.length;i++){var p=self.parse(name,vals[i],propIsBypass,"multiple");hasEnum=hasEnum||string(p.value);valArr.push(p.value);pfValArr.push(p.pfValue!=null?p.pfValue:p.value);unitsArr.push(p.units);strVal+=(i>0?" ":"")+p.strValue}if(type.validate&&!type.validate(valArr,unitsArr)){return null}if(type.singleEnum&&hasEnum){if(valArr.length===1&&string(valArr[0])){return{name:name,value:valArr[0],strValue:valArr[0],bypass:propIsBypass}}else{return null}}return{name:name,value:valArr,pfValue:pfValArr,strValue:strVal,bypass:propIsBypass,units:unitsArr}}var checkEnums=function checkEnums(){for(var _i=0;_i<type.enums.length;_i++){var en=type.enums[_i];if(en===value){return{name:name,value:value,strValue:""+value,bypass:propIsBypass}}}return null};if(type.number){var units;var implicitUnits="px";if(type.units){units=type.units}if(type.implicitUnits){implicitUnits=type.implicitUnits}if(!type.unitless){if(valueIsString){var unitsRegex="px|em"+(type.allowPercent?"|\\%":"");if(units){unitsRegex=units}var match=value.match("^("+number$1+")("+unitsRegex+")?"+"$");if(match){value=match[1];units=match[2]||implicitUnits}}else if(!units||type.implicitUnits){units=implicitUnits}}value=parseFloat(value);if(isNaN(value)&&type.enums===undefined){return null}if(isNaN(value)&&type.enums!==undefined){value=passedValue;return checkEnums()}if(type.integer&&!integer(value)){return null}if(type.min!==undefined&&(value<type.min||type.strictMin&&value===type.min)||type.max!==undefined&&(value>type.max||type.strictMax&&value===type.max)){return null}var ret={name:name,value:value,strValue:""+value+(units?units:""),units:units,bypass:propIsBypass};if(type.unitless||units!=="px"&&units!=="em"){ret.pfValue=value}else{ret.pfValue=units==="px"||!units?value:this.getEmSizeInPixels()*value}if(units==="ms"||units==="s"){ret.pfValue=units==="ms"?value:1e3*value}if(units==="deg"||units==="rad"){ret.pfValue=units==="rad"?value:deg2rad(value)}if(units==="%"){ret.pfValue=value/100}return ret}else if(type.propList){var props=[];var propsStr=""+value;if(propsStr==="none");else{var propsSplit=propsStr.split(/\s*,\s*|\s+/);for(var _i2=0;_i2<propsSplit.length;_i2++){var propName=propsSplit[_i2].trim();if(self.properties[propName]){props.push(propName)}else{warn("`"+propName+"` is not a valid property name")}}if(props.length===0){return null}}return{name:name,value:props,strValue:props.length===0?"none":props.join(" "),bypass:propIsBypass}}else if(type.color){var tuple=color2tuple(value);if(!tuple){return null}return{name:name,value:tuple,pfValue:tuple,strValue:"rgb("+tuple[0]+","+tuple[1]+","+tuple[2]+")",bypass:propIsBypass}}else if(type.regex||type.regexes){if(type.enums){var enumProp=checkEnums();if(enumProp){return enumProp}}var regexes=type.regexes?type.regexes:[type.regex];for(var _i3=0;_i3<regexes.length;_i3++){var regex=new RegExp(regexes[_i3]);var m=regex.exec(value);if(m){return{name:name,value:type.singleRegexMatchValue?m[1]:m,strValue:""+value,bypass:propIsBypass}}}return null}else if(type.string){return{name:name,value:""+value,strValue:""+value,bypass:propIsBypass}}else if(type.enums){return checkEnums()}else{return null}};var Style=function Style(cy){if(!(this instanceof Style)){return new Style(cy)}if(!core(cy)){error("A style must have a core reference");return}this._private={cy:cy,coreStyle:{}};this.length=0;this.resetToDefault()};var styfn$8=Style.prototype;styfn$8.instanceString=function(){return"style"};styfn$8.clear=function(){for(var i=0;i<this.length;i++){this[i]=undefined}this.length=0;var _p=this._private;_p.newStyle=true;return this};styfn$8.resetToDefault=function(){this.clear();this.addDefaultStylesheet();return this};styfn$8.core=function(propName){return this._private.coreStyle[propName]||this.getDefaultProperty(propName)};styfn$8.selector=function(selectorStr){var selector=selectorStr==="core"?null:new Selector(selectorStr);var i=this.length++;this[i]={selector:selector,properties:[],mappedProperties:[],index:i};return this};styfn$8.css=function(){var self=this;var args=arguments;if(args.length===1){var map=args[0];for(var i=0;i<self.properties.length;i++){var prop=self.properties[i];var mapVal=map[prop.name];if(mapVal===undefined){mapVal=map[dash2camel(prop.name)]}if(mapVal!==undefined){this.cssRule(prop.name,mapVal)}}}else if(args.length===2){this.cssRule(args[0],args[1])}return this};styfn$8.style=styfn$8.css;styfn$8.cssRule=function(name,value){var property=this.parse(name,value);if(property){var i=this.length-1;this[i].properties.push(property);this[i].properties[property.name]=property;if(property.name.match(/pie-(\d+)-background-size/)&&property.value){this._private.hasPie=true}if(property.mapped){this[i].mappedProperties.push(property)}var currentSelectorIsCore=!this[i].selector;if(currentSelectorIsCore){this._private.coreStyle[property.name]=property}}return this};styfn$8.append=function(style){if(stylesheet(style)){style.appendToStyle(this)}else if(array(style)){this.appendFromJson(style)}else if(string(style)){this.appendFromString(style)}return this};Style.fromJson=function(cy,json){var style=new Style(cy);style.fromJson(json);return style};Style.fromString=function(cy,string){return new Style(cy).fromString(string)};[styfn,styfn$1,styfn$2,styfn$3,styfn$4,styfn$5,styfn$6,styfn$7].forEach((function(props){extend(styfn$8,props)}));Style.types=styfn$8.types;Style.properties=styfn$8.properties;Style.propertyGroups=styfn$8.propertyGroups;Style.propertyGroupNames=styfn$8.propertyGroupNames;Style.propertyGroupKeys=styfn$8.propertyGroupKeys;var corefn$7={style:function style(newStyle){if(newStyle){var s=this.setStyle(newStyle);s.update()}return this._private.style},setStyle:function setStyle(style){var _p=this._private;if(stylesheet(style)){_p.style=style.generateStyle(this)}else if(array(style)){_p.style=Style.fromJson(this,style)}else if(string(style)){_p.style=Style.fromString(this,style)}else{_p.style=Style(this)}return _p.style}};var defaultSelectionType="single";var corefn$8={autolock:function autolock(bool){if(bool!==undefined){this._private.autolock=bool?true:false}else{return this._private.autolock}return this},autoungrabify:function autoungrabify(bool){if(bool!==undefined){this._private.autoungrabify=bool?true:false}else{return this._private.autoungrabify}return this},autounselectify:function autounselectify(bool){if(bool!==undefined){this._private.autounselectify=bool?true:false}else{return this._private.autounselectify}return this},selectionType:function selectionType(selType){var _p=this._private;if(_p.selectionType==null){_p.selectionType=defaultSelectionType}if(selType!==undefined){if(selType==="additive"||selType==="single"){_p.selectionType=selType}}else{return _p.selectionType}return this},panningEnabled:function panningEnabled(bool){if(bool!==undefined){this._private.panningEnabled=bool?true:false}else{return this._private.panningEnabled}return this},userPanningEnabled:function userPanningEnabled(bool){if(bool!==undefined){this._private.userPanningEnabled=bool?true:false}else{return this._private.userPanningEnabled}return this},zoomingEnabled:function zoomingEnabled(bool){if(bool!==undefined){this._private.zoomingEnabled=bool?true:false}else{return this._private.zoomingEnabled}return this},userZoomingEnabled:function userZoomingEnabled(bool){if(bool!==undefined){this._private.userZoomingEnabled=bool?true:false}else{return this._private.userZoomingEnabled}return this},boxSelectionEnabled:function boxSelectionEnabled(bool){if(bool!==undefined){this._private.boxSelectionEnabled=bool?true:false}else{return this._private.boxSelectionEnabled}return this},pan:function pan(){var args=arguments;var pan=this._private.pan;var dim,val,dims,x,y;switch(args.length){case 0:return pan;case 1:if(string(args[0])){dim=args[0];return pan[dim]}else if(plainObject(args[0])){if(!this._private.panningEnabled){return this}dims=args[0];x=dims.x;y=dims.y;if(number(x)){pan.x=x}if(number(y)){pan.y=y}this.emit("pan viewport")}break;case 2:if(!this._private.panningEnabled){return this}dim=args[0];val=args[1];if((dim==="x"||dim==="y")&&number(val)){pan[dim]=val}this.emit("pan viewport");break;default:break}this.notify("viewport");return this},panBy:function panBy(arg0,arg1){var args=arguments;var pan=this._private.pan;var dim,val,dims,x,y;if(!this._private.panningEnabled){return this}switch(args.length){case 1:if(plainObject(arg0)){dims=args[0];x=dims.x;y=dims.y;if(number(x)){pan.x+=x}if(number(y)){pan.y+=y}this.emit("pan viewport")}break;case 2:dim=arg0;val=arg1;if((dim==="x"||dim==="y")&&number(val)){pan[dim]+=val}this.emit("pan viewport");break;default:break}this.notify("viewport");return this},fit:function fit(elements,padding){var viewportState=this.getFitViewport(elements,padding);if(viewportState){var _p=this._private;_p.zoom=viewportState.zoom;_p.pan=viewportState.pan;this.emit("pan zoom viewport");this.notify("viewport")}return this},getFitViewport:function getFitViewport(elements,padding){if(number(elements)&&padding===undefined){padding=elements;elements=undefined}if(!this._private.panningEnabled||!this._private.zoomingEnabled){return}var bb;if(string(elements)){var sel=elements;elements=this.$(sel)}else if(boundingBox(elements)){var bbe=elements;bb={x1:bbe.x1,y1:bbe.y1,x2:bbe.x2,y2:bbe.y2};bb.w=bb.x2-bb.x1;bb.h=bb.y2-bb.y1}else if(!elementOrCollection(elements)){elements=this.mutableElements()}if(elementOrCollection(elements)&&elements.empty()){return}bb=bb||elements.boundingBox();var w=this.width();var h=this.height();var zoom;padding=number(padding)?padding:0;if(!isNaN(w)&&!isNaN(h)&&w>0&&h>0&&!isNaN(bb.w)&&!isNaN(bb.h)&&bb.w>0&&bb.h>0){zoom=Math.min((w-2*padding)/bb.w,(h-2*padding)/bb.h);zoom=zoom>this._private.maxZoom?this._private.maxZoom:zoom;zoom=zoom<this._private.minZoom?this._private.minZoom:zoom;var pan={x:(w-zoom*(bb.x1+bb.x2))/2,y:(h-zoom*(bb.y1+bb.y2))/2};return{zoom:zoom,pan:pan}}return},zoomRange:function zoomRange(min,max){var _p=this._private;if(max==null){var opts=min;min=opts.min;max=opts.max}if(number(min)&&number(max)&&min<=max){_p.minZoom=min;_p.maxZoom=max}else if(number(min)&&max===undefined&&min<=_p.maxZoom){_p.minZoom=min}else if(number(max)&&min===undefined&&max>=_p.minZoom){_p.maxZoom=max}return this},minZoom:function minZoom(zoom){if(zoom===undefined){return this._private.minZoom}else{return this.zoomRange({min:zoom})}},maxZoom:function maxZoom(zoom){if(zoom===undefined){return this._private.maxZoom}else{return this.zoomRange({max:zoom})}},getZoomedViewport:function getZoomedViewport(params){var _p=this._private;var currentPan=_p.pan;var currentZoom=_p.zoom;var pos;var zoom;var bail=false;if(!_p.zoomingEnabled){bail=true}if(number(params)){zoom=params}else if(plainObject(params)){zoom=params.level;if(params.position!=null){pos=modelToRenderedPosition(params.position,currentZoom,currentPan)}else if(params.renderedPosition!=null){pos=params.renderedPosition}if(pos!=null&&!_p.panningEnabled){bail=true}}zoom=zoom>_p.maxZoom?_p.maxZoom:zoom;zoom=zoom<_p.minZoom?_p.minZoom:zoom;if(bail||!number(zoom)||zoom===currentZoom||pos!=null&&(!number(pos.x)||!number(pos.y))){return null}if(pos!=null){var pan1=currentPan;var zoom1=currentZoom;var zoom2=zoom;var pan2={x:-zoom2/zoom1*(pos.x-pan1.x)+pos.x,y:-zoom2/zoom1*(pos.y-pan1.y)+pos.y};return{zoomed:true,panned:true,zoom:zoom2,pan:pan2}}else{return{zoomed:true,panned:false,zoom:zoom,pan:currentPan}}},zoom:function zoom(params){if(params===undefined){return this._private.zoom}else{var vp=this.getZoomedViewport(params);var _p=this._private;if(vp==null||!vp.zoomed){return this}_p.zoom=vp.zoom;if(vp.panned){_p.pan.x=vp.pan.x;_p.pan.y=vp.pan.y}this.emit("zoom"+(vp.panned?" pan":"")+" viewport");this.notify("viewport");return this}},viewport:function viewport(opts){var _p=this._private;var zoomDefd=true;var panDefd=true;var events=[];var zoomFailed=false;var panFailed=false;if(!opts){return this}if(!number(opts.zoom)){zoomDefd=false}if(!plainObject(opts.pan)){panDefd=false}if(!zoomDefd&&!panDefd){return this}if(zoomDefd){var z=opts.zoom;if(z<_p.minZoom||z>_p.maxZoom||!_p.zoomingEnabled){zoomFailed=true}else{_p.zoom=z;events.push("zoom")}}if(panDefd&&(!zoomFailed||!opts.cancelOnFailedZoom)&&_p.panningEnabled){var p=opts.pan;if(number(p.x)){_p.pan.x=p.x;panFailed=false}if(number(p.y)){_p.pan.y=p.y;panFailed=false}if(!panFailed){events.push("pan")}}if(events.length>0){events.push("viewport");this.emit(events.join(" "));this.notify("viewport")}return this},center:function center(elements){var pan=this.getCenterPan(elements);if(pan){this._private.pan=pan;this.emit("pan viewport");this.notify("viewport")}return this},getCenterPan:function getCenterPan(elements,zoom){if(!this._private.panningEnabled){return}if(string(elements)){var selector=elements;elements=this.mutableElements().filter(selector)}else if(!elementOrCollection(elements)){elements=this.mutableElements()}if(elements.length===0){return}var bb=elements.boundingBox();var w=this.width();var h=this.height();zoom=zoom===undefined?this._private.zoom:zoom;var pan={x:(w-zoom*(bb.x1+bb.x2))/2,y:(h-zoom*(bb.y1+bb.y2))/2};return pan},reset:function reset(){if(!this._private.panningEnabled||!this._private.zoomingEnabled){return this}this.viewport({pan:{x:0,y:0},zoom:1});return this},invalidateSize:function invalidateSize(){this._private.sizeCache=null},size:function size(){var _p=this._private;var container=_p.container;return _p.sizeCache=_p.sizeCache||(container?function(){var style=window$1.getComputedStyle(container);var val=function val(name){return parseFloat(style.getPropertyValue(name))};return{width:container.clientWidth-val("padding-left")-val("padding-right"),height:container.clientHeight-val("padding-top")-val("padding-bottom")}}():{width:1,height:1})},width:function width(){return this.size().width},height:function height(){return this.size().height},extent:function extent(){var pan=this._private.pan;var zoom=this._private.zoom;var rb=this.renderedExtent();var b={x1:(rb.x1-pan.x)/zoom,x2:(rb.x2-pan.x)/zoom,y1:(rb.y1-pan.y)/zoom,y2:(rb.y2-pan.y)/zoom};b.w=b.x2-b.x1;b.h=b.y2-b.y1;return b},renderedExtent:function renderedExtent(){var width=this.width();var height=this.height();return{x1:0,y1:0,x2:width,y2:height,w:width,h:height}}};corefn$8.centre=corefn$8.center;corefn$8.autolockNodes=corefn$8.autolock;corefn$8.autoungrabifyNodes=corefn$8.autoungrabify;var fn$6={data:define$3.data({field:"data",bindingEvent:"data",allowBinding:true,allowSetting:true,settingEvent:"data",settingTriggersEvent:true,triggerFnName:"trigger",allowGetting:true}),removeData:define$3.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:true}),scratch:define$3.data({field:"scratch",bindingEvent:"scratch",allowBinding:true,allowSetting:true,settingEvent:"scratch",settingTriggersEvent:true,triggerFnName:"trigger",allowGetting:true}),removeScratch:define$3.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:true})};fn$6.attr=fn$6.data;fn$6.removeAttr=fn$6.removeData;var Core=function Core(opts){var cy=this;opts=extend({},opts);var container=opts.container;if(container&&!htmlElement(container)&&htmlElement(container[0])){container=container[0]}var reg=container?container._cyreg:null;reg=reg||{};if(reg&&reg.cy){reg.cy.destroy();reg={}}var readies=reg.readies=reg.readies||[];if(container){container._cyreg=reg}reg.cy=cy;var head=window$1!==undefined&&container!==undefined&&!opts.headless;var options=opts;options.layout=extend({name:head?"grid":"null"},options.layout);options.renderer=extend({name:head?"canvas":"null"},options.renderer);var defVal=function defVal(def,val,altVal){if(val!==undefined){return val}else if(altVal!==undefined){return altVal}else{return def}};var _p=this._private={container:container,ready:false,options:options,elements:new Collection(this),listeners:[],aniEles:new Collection(this),data:{},scratch:{},layout:null,renderer:null,destroyed:false,notificationsEnabled:true,minZoom:1e-50,maxZoom:1e50,zoomingEnabled:defVal(true,options.zoomingEnabled),userZoomingEnabled:defVal(true,options.userZoomingEnabled),panningEnabled:defVal(true,options.panningEnabled),userPanningEnabled:defVal(true,options.userPanningEnabled),boxSelectionEnabled:defVal(true,options.boxSelectionEnabled),autolock:defVal(false,options.autolock,options.autolockNodes),autoungrabify:defVal(false,options.autoungrabify,options.autoungrabifyNodes),autounselectify:defVal(false,options.autounselectify),styleEnabled:options.styleEnabled===undefined?head:options.styleEnabled,zoom:number(options.zoom)?options.zoom:1,pan:{x:plainObject(options.pan)&&number(options.pan.x)?options.pan.x:0,y:plainObject(options.pan)&&number(options.pan.y)?options.pan.y:0},animation:{current:[],queue:[]},hasCompoundNodes:false};this.createEmitter();this.selectionType(options.selectionType);this.zoomRange({min:options.minZoom,max:options.maxZoom});var loadExtData=function loadExtData(extData,next){var anyIsPromise=extData.some(promise);if(anyIsPromise){return Promise$1.all(extData).then(next)}else{next(extData)}};if(_p.styleEnabled){cy.setStyle([])}var rendererOptions=extend({},options,options.renderer);cy.initRenderer(rendererOptions);var setElesAndLayout=function setElesAndLayout(elements,onload,ondone){cy.notifications(false);var oldEles=cy.mutableElements();if(oldEles.length>0){oldEles.remove()}if(elements!=null){if(plainObject(elements)||array(elements)){cy.add(elements)}}cy.one("layoutready",(function(e){cy.notifications(true);cy.emit(e);cy.one("load",onload);cy.emitAndNotify("load")})).one("layoutstop",(function(){cy.one("done",ondone);cy.emit("done")}));var layoutOpts=extend({},cy._private.options.layout);layoutOpts.eles=cy.elements();cy.layout(layoutOpts).run()};loadExtData([options.style,options.elements],(function(thens){var initStyle=thens[0];var initEles=thens[1];if(_p.styleEnabled){cy.style().append(initStyle)}setElesAndLayout(initEles,(function(){cy.startAnimationLoop();_p.ready=true;if(fn(options.ready)){cy.on("ready",options.ready)}for(var i=0;i<readies.length;i++){var fn$1=readies[i];cy.on("ready",fn$1)}if(reg){reg.readies=[]}cy.emit("ready")}),options.done)}))};var corefn$9=Core.prototype;extend(corefn$9,{instanceString:function instanceString(){return"core"},isReady:function isReady(){return this._private.ready},destroyed:function destroyed(){return this._private.destroyed},ready:function ready(fn){if(this.isReady()){this.emitter().emit("ready",[],fn)}else{this.on("ready",fn)}return this},destroy:function destroy(){var cy=this;if(cy.destroyed())return;cy.stopAnimationLoop();cy.destroyRenderer();this.emit("destroy");cy._private.destroyed=true;return cy},hasElementWithId:function hasElementWithId(id){return this._private.elements.hasElementWithId(id)},getElementById:function getElementById(id){return this._private.elements.getElementById(id)},hasCompoundNodes:function hasCompoundNodes(){return this._private.hasCompoundNodes},headless:function headless(){return this._private.renderer.isHeadless()},styleEnabled:function styleEnabled(){return this._private.styleEnabled},addToPool:function addToPool(eles){this._private.elements.merge(eles);return this},removeFromPool:function removeFromPool(eles){this._private.elements.unmerge(eles);return this},container:function container(){return this._private.container||null},mount:function mount(container){if(container==null){return}var cy=this;var _p=cy._private;var options=_p.options;if(!htmlElement(container)&&htmlElement(container[0])){container=container[0]}cy.stopAnimationLoop();cy.destroyRenderer();_p.container=container;_p.styleEnabled=true;cy.invalidateSize();cy.initRenderer(extend({},options,options.renderer,{name:options.renderer.name==="null"?"canvas":options.renderer.name}));cy.startAnimationLoop();cy.style(options.style);cy.emit("mount");return cy},unmount:function unmount(){var cy=this;cy.stopAnimationLoop();cy.destroyRenderer();cy.initRenderer({name:"null"});cy.emit("unmount");return cy},options:function options(){return copy(this._private.options)},json:function json(obj){var cy=this;var _p=cy._private;var eles=cy.mutableElements();var getFreshRef=function getFreshRef(ele){return cy.getElementById(ele.id())};if(plainObject(obj)){cy.startBatch();if(obj.elements){var idInJson={};var updateEles=function updateEles(jsons,gr){var toAdd=[];var toMod=[];for(var i=0;i<jsons.length;i++){var json=jsons[i];var id=""+json.data.id;var ele=cy.getElementById(id);idInJson[id]=true;if(ele.length!==0){toMod.push({ele:ele,json:json})}else{if(gr){json.group=gr;toAdd.push(json)}else{toAdd.push(json)}}}cy.add(toAdd);for(var _i=0;_i<toMod.length;_i++){var _toMod$_i=toMod[_i],_ele=_toMod$_i.ele,_json=_toMod$_i.json;_ele.json(_json)}};if(array(obj.elements)){updateEles(obj.elements)}else{var grs=["nodes","edges"];for(var i=0;i<grs.length;i++){var gr=grs[i];var elements=obj.elements[gr];if(array(elements)){updateEles(elements,gr)}}}var parentsToRemove=cy.collection();eles.filter((function(ele){return!idInJson[ele.id()]})).forEach((function(ele){if(ele.isParent()){parentsToRemove.merge(ele)}else{ele.remove()}}));parentsToRemove.forEach((function(ele){return ele.children().move({parent:null})}));parentsToRemove.forEach((function(ele){return getFreshRef(ele).remove()}))}if(obj.style){cy.style(obj.style)}if(obj.zoom!=null&&obj.zoom!==_p.zoom){cy.zoom(obj.zoom)}if(obj.pan){if(obj.pan.x!==_p.pan.x||obj.pan.y!==_p.pan.y){cy.pan(obj.pan)}}if(obj.data){cy.data(obj.data)}var fields=["minZoom","maxZoom","zoomingEnabled","userZoomingEnabled","panningEnabled","userPanningEnabled","boxSelectionEnabled","autolock","autoungrabify","autounselectify"];for(var _i2=0;_i2<fields.length;_i2++){var f=fields[_i2];if(obj[f]!=null){cy[f](obj[f])}}cy.endBatch();return this}else{var flat=!!obj;var json={};if(flat){json.elements=this.elements().map((function(ele){return ele.json()}))}else{json.elements={};eles.forEach((function(ele){var group=ele.group();if(!json.elements[group]){json.elements[group]=[]}json.elements[group].push(ele.json())}))}if(this._private.styleEnabled){json.style=cy.style().json()}json.data=copy(cy.data());var options=_p.options;json.zoomingEnabled=_p.zoomingEnabled;json.userZoomingEnabled=_p.userZoomingEnabled;json.zoom=_p.zoom;json.minZoom=_p.minZoom;json.maxZoom=_p.maxZoom;json.panningEnabled=_p.panningEnabled;json.userPanningEnabled=_p.userPanningEnabled;json.pan=copy(_p.pan);json.boxSelectionEnabled=_p.boxSelectionEnabled;json.renderer=copy(options.renderer);json.hideEdgesOnViewport=options.hideEdgesOnViewport;json.textureOnViewport=options.textureOnViewport;json.wheelSensitivity=options.wheelSensitivity;json.motionBlur=options.motionBlur;return json}}});corefn$9.$id=corefn$9.getElementById;[corefn,corefn$1,elesfn$u,corefn$2,corefn$3,corefn$4,corefn$5,corefn$6,corefn$7,corefn$8,fn$6].forEach((function(props){extend(corefn$9,props)}));var defaults$9={fit:true,directed:false,padding:30,circle:false,grid:false,spacingFactor:1.75,boundingBox:undefined,avoidOverlap:true,nodeDimensionsIncludeLabels:false,roots:undefined,maximal:false,animate:false,animationDuration:500,animationEasing:undefined,animateFilter:function animateFilter(node,i){return true},ready:undefined,stop:undefined,transform:function transform(node,position){return position}};var getInfo=function getInfo(ele){return ele.scratch("breadthfirst")};var setInfo=function setInfo(ele,obj){return ele.scratch("breadthfirst",obj)};function BreadthFirstLayout(options){this.options=extend({},defaults$9,options)}BreadthFirstLayout.prototype.run=function(){var params=this.options;var options=params;var cy=params.cy;var eles=options.eles;var nodes=eles.nodes().filter((function(n){return!n.isParent()}));var graph=eles;var directed=options.directed;var maximal=options.maximal||options.maximalAdjustments>0;var bb=makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()});var roots;if(elementOrCollection(options.roots)){roots=options.roots}else if(array(options.roots)){var rootsArray=[];for(var i=0;i<options.roots.length;i++){var id=options.roots[i];var ele=cy.getElementById(id);rootsArray.push(ele)}roots=cy.collection(rootsArray)}else if(string(options.roots)){roots=cy.$(options.roots)}else{if(directed){roots=nodes.roots()}else{var components=eles.components();roots=cy.collection();var _loop=function _loop(_i){var comp=components[_i];var maxDegree=comp.maxDegree(false);var compRoots=comp.filter((function(ele){return ele.degree(false)===maxDegree}));roots=roots.add(compRoots)};for(var _i=0;_i<components.length;_i++){_loop(_i)}}}var depths=[];var foundByBfs={};var addToDepth=function addToDepth(ele,d){if(depths[d]==null){depths[d]=[]}var i=depths[d].length;depths[d].push(ele);setInfo(ele,{index:i,depth:d})};var changeDepth=function changeDepth(ele,newDepth){var _getInfo=getInfo(ele),depth=_getInfo.depth,index=_getInfo.index;depths[depth][index]=null;addToDepth(ele,newDepth)};graph.bfs({roots:roots,directed:options.directed,visit:function visit(node,edge,pNode,i,depth){var ele=node[0];var id=ele.id();addToDepth(ele,depth);foundByBfs[id]=true}});var orphanNodes=[];for(var _i2=0;_i2<nodes.length;_i2++){var _ele=nodes[_i2];if(foundByBfs[_ele.id()]){continue}else{orphanNodes.push(_ele)}}var assignDepthsAt=function assignDepthsAt(i){var eles=depths[i];for(var j=0;j<eles.length;j++){var _ele2=eles[j];if(_ele2==null){eles.splice(j,1);j--;continue}setInfo(_ele2,{depth:i,index:j})}};var assignDepths=function assignDepths(){for(var _i3=0;_i3<depths.length;_i3++){assignDepthsAt(_i3)}};var adjustMaximally=function adjustMaximally(ele,shifted){var eInfo=getInfo(ele);var incomers=ele.incomers().filter((function(el){return el.isNode()&&eles.has(el)}));var maxDepth=-1;var id=ele.id();for(var k=0;k<incomers.length;k++){var incmr=incomers[k];var iInfo=getInfo(incmr);maxDepth=Math.max(maxDepth,iInfo.depth)}if(eInfo.depth<=maxDepth){if(shifted[id]){return null}changeDepth(ele,maxDepth+1);shifted[id]=true;return true}return false};if(directed&&maximal){var Q=[];var shifted={};var enqueue=function enqueue(n){return Q.push(n)};var dequeue=function dequeue(){return Q.shift()};nodes.forEach((function(n){return Q.push(n)}));while(Q.length>0){var _ele3=dequeue();var didShift=adjustMaximally(_ele3,shifted);if(didShift){_ele3.outgoers().filter((function(el){return el.isNode()&&eles.has(el)})).forEach(enqueue)}else if(didShift===null){warn("Detected double maximal shift for node `"+_ele3.id()+"`.  Bailing maximal adjustment due to cycle.  Use `options.maximal: true` only on DAGs.");break}}}assignDepths();var minDistance=0;if(options.avoidOverlap){for(var _i4=0;_i4<nodes.length;_i4++){var n=nodes[_i4];var nbb=n.layoutDimensions(options);var w=nbb.w;var h=nbb.h;minDistance=Math.max(minDistance,w,h)}}var cachedWeightedPercent={};var getWeightedPercent=function getWeightedPercent(ele){if(cachedWeightedPercent[ele.id()]){return cachedWeightedPercent[ele.id()]}var eleDepth=getInfo(ele).depth;var neighbors=ele.neighborhood();var percent=0;var samples=0;for(var _i5=0;_i5<neighbors.length;_i5++){var neighbor=neighbors[_i5];if(neighbor.isEdge()||neighbor.isParent()||!nodes.has(neighbor)){continue}var bf=getInfo(neighbor);var index=bf.index;var depth=bf.depth;if(index==null||depth==null){continue}var nDepth=depths[depth].length;if(depth<eleDepth){percent+=index/nDepth;samples++}}samples=Math.max(1,samples);percent=percent/samples;if(samples===0){percent=0}cachedWeightedPercent[ele.id()]=percent;return percent};var sortFn=function sortFn(a,b){var apct=getWeightedPercent(a);var bpct=getWeightedPercent(b);var diff=apct-bpct;if(diff===0){return ascending(a.id(),b.id())}else{return diff}};for(var _i6=0;_i6<depths.length;_i6++){depths[_i6].sort(sortFn);assignDepthsAt(_i6)}var orphanDepth=[];for(var _i7=0;_i7<orphanNodes.length;_i7++){orphanDepth.push(orphanNodes[_i7])}depths.unshift(orphanDepth);assignDepths();var biggestDepthSize=0;for(var _i8=0;_i8<depths.length;_i8++){biggestDepthSize=Math.max(depths[_i8].length,biggestDepthSize)}var center={x:bb.x1+bb.w/2,y:bb.x1+bb.h/2};var maxDepthSize=depths.reduce((function(max,eles){return Math.max(max,eles.length)}),0);var getPosition=function getPosition(ele){var _getInfo2=getInfo(ele),depth=_getInfo2.depth,index=_getInfo2.index;var depthSize=depths[depth].length;var distanceX=Math.max(bb.w/((options.grid?maxDepthSize:depthSize)+1),minDistance);var distanceY=Math.max(bb.h/(depths.length+1),minDistance);var radiusStepSize=Math.min(bb.w/2/depths.length,bb.h/2/depths.length);radiusStepSize=Math.max(radiusStepSize,minDistance);if(!options.circle){var epos={x:center.x+(index+1-(depthSize+1)/2)*distanceX,y:(depth+1)*distanceY};return epos}else{var radius=radiusStepSize*depth+radiusStepSize-(depths.length>0&&depths[0].length<=3?radiusStepSize/2:0);var theta=2*Math.PI/depths[depth].length*index;if(depth===0&&depths[0].length===1){radius=1}return{x:center.x+radius*Math.cos(theta),y:center.y+radius*Math.sin(theta)}}};nodes.layoutPositions(this,options,getPosition);return this};var defaults$a={fit:true,padding:30,boundingBox:undefined,avoidOverlap:true,nodeDimensionsIncludeLabels:false,spacingFactor:undefined,radius:undefined,startAngle:3/2*Math.PI,sweep:undefined,clockwise:true,sort:undefined,animate:false,animationDuration:500,animationEasing:undefined,animateFilter:function animateFilter(node,i){return true},ready:undefined,stop:undefined,transform:function transform(node,position){return position}};function CircleLayout(options){this.options=extend({},defaults$a,options)}CircleLayout.prototype.run=function(){var params=this.options;var options=params;var cy=params.cy;var eles=options.eles;var clockwise=options.counterclockwise!==undefined?!options.counterclockwise:options.clockwise;var nodes=eles.nodes().not(":parent");if(options.sort){nodes=nodes.sort(options.sort)}var bb=makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()});var center={x:bb.x1+bb.w/2,y:bb.y1+bb.h/2};var sweep=options.sweep===undefined?2*Math.PI-2*Math.PI/nodes.length:options.sweep;var dTheta=sweep/Math.max(1,nodes.length-1);var r;var minDistance=0;for(var i=0;i<nodes.length;i++){var n=nodes[i];var nbb=n.layoutDimensions(options);var w=nbb.w;var h=nbb.h;minDistance=Math.max(minDistance,w,h)}if(number(options.radius)){r=options.radius}else if(nodes.length<=1){r=0}else{r=Math.min(bb.h,bb.w)/2-minDistance}if(nodes.length>1&&options.avoidOverlap){minDistance*=1.75;var dcos=Math.cos(dTheta)-Math.cos(0);var dsin=Math.sin(dTheta)-Math.sin(0);var rMin=Math.sqrt(minDistance*minDistance/(dcos*dcos+dsin*dsin));r=Math.max(rMin,r)}var getPos=function getPos(ele,i){var theta=options.startAngle+i*dTheta*(clockwise?1:-1);var rx=r*Math.cos(theta);var ry=r*Math.sin(theta);var pos={x:center.x+rx,y:center.y+ry};return pos};nodes.layoutPositions(this,options,getPos);return this};var defaults$b={fit:true,padding:30,startAngle:3/2*Math.PI,sweep:undefined,clockwise:true,equidistant:false,minNodeSpacing:10,boundingBox:undefined,avoidOverlap:true,nodeDimensionsIncludeLabels:false,height:undefined,width:undefined,spacingFactor:undefined,concentric:function concentric(node){return node.degree()},levelWidth:function levelWidth(nodes){return nodes.maxDegree()/4},animate:false,animationDuration:500,animationEasing:undefined,animateFilter:function animateFilter(node,i){return true},ready:undefined,stop:undefined,transform:function transform(node,position){return position}};function ConcentricLayout(options){this.options=extend({},defaults$b,options)}ConcentricLayout.prototype.run=function(){var params=this.options;var options=params;var clockwise=options.counterclockwise!==undefined?!options.counterclockwise:options.clockwise;var cy=params.cy;var eles=options.eles;var nodes=eles.nodes().not(":parent");var bb=makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()});var center={x:bb.x1+bb.w/2,y:bb.y1+bb.h/2};var nodeValues=[];var maxNodeSize=0;for(var i=0;i<nodes.length;i++){var node=nodes[i];var value=void 0;value=options.concentric(node);nodeValues.push({value:value,node:node});node._private.scratch.concentric=value}nodes.updateStyle();for(var _i=0;_i<nodes.length;_i++){var _node=nodes[_i];var nbb=_node.layoutDimensions(options);maxNodeSize=Math.max(maxNodeSize,nbb.w,nbb.h)}nodeValues.sort((function(a,b){return b.value-a.value}));var levelWidth=options.levelWidth(nodes);var levels=[[]];var currentLevel=levels[0];for(var _i2=0;_i2<nodeValues.length;_i2++){var val=nodeValues[_i2];if(currentLevel.length>0){var diff=Math.abs(currentLevel[0].value-val.value);if(diff>=levelWidth){currentLevel=[];levels.push(currentLevel)}}currentLevel.push(val)}var minDist=maxNodeSize+options.minNodeSpacing;if(!options.avoidOverlap){var firstLvlHasMulti=levels.length>0&&levels[0].length>1;var maxR=Math.min(bb.w,bb.h)/2-minDist;var rStep=maxR/(levels.length+firstLvlHasMulti?1:0);minDist=Math.min(minDist,rStep)}var r=0;for(var _i3=0;_i3<levels.length;_i3++){var level=levels[_i3];var sweep=options.sweep===undefined?2*Math.PI-2*Math.PI/level.length:options.sweep;var dTheta=level.dTheta=sweep/Math.max(1,level.length-1);if(level.length>1&&options.avoidOverlap){var dcos=Math.cos(dTheta)-Math.cos(0);var dsin=Math.sin(dTheta)-Math.sin(0);var rMin=Math.sqrt(minDist*minDist/(dcos*dcos+dsin*dsin));r=Math.max(rMin,r)}level.r=r;r+=minDist}if(options.equidistant){var rDeltaMax=0;var _r=0;for(var _i4=0;_i4<levels.length;_i4++){var _level=levels[_i4];var rDelta=_level.r-_r;rDeltaMax=Math.max(rDeltaMax,rDelta)}_r=0;for(var _i5=0;_i5<levels.length;_i5++){var _level2=levels[_i5];if(_i5===0){_r=_level2.r}_level2.r=_r;_r+=rDeltaMax}}var pos={};for(var _i6=0;_i6<levels.length;_i6++){var _level3=levels[_i6];var _dTheta=_level3.dTheta;var _r2=_level3.r;for(var j=0;j<_level3.length;j++){var _val=_level3[j];var theta=options.startAngle+(clockwise?1:-1)*_dTheta*j;var p={x:center.x+_r2*Math.cos(theta),y:center.y+_r2*Math.sin(theta)};pos[_val.node.id()]=p}}nodes.layoutPositions(this,options,(function(ele){var id=ele.id();return pos[id]}));return this};var DEBUG;var defaults$c={ready:function ready(){},stop:function stop(){},animate:true,animationEasing:undefined,animationDuration:undefined,animateFilter:function animateFilter(node,i){return true},animationThreshold:250,refresh:20,fit:true,padding:30,boundingBox:undefined,nodeDimensionsIncludeLabels:false,randomize:false,componentSpacing:40,nodeRepulsion:function nodeRepulsion(node){return 2048},nodeOverlap:4,idealEdgeLength:function idealEdgeLength(edge){return 32},edgeElasticity:function edgeElasticity(edge){return 32},nestingFactor:1.2,gravity:1,numIter:1e3,initialTemp:1e3,coolingFactor:.99,minTemp:1};function CoseLayout(options){this.options=extend({},defaults$c,options);this.options.layout=this}CoseLayout.prototype.run=function(){var options=this.options;var cy=options.cy;var layout=this;layout.stopped=false;if(options.animate===true||options.animate===false){layout.emit({type:"layoutstart",layout:layout})}if(true===options.debug){DEBUG=true}else{DEBUG=false}var layoutInfo=createLayoutInfo(cy,layout,options);if(DEBUG){printLayoutInfo(layoutInfo)}if(options.randomize){randomizePositions(layoutInfo)}var startTime=performanceNow();var refresh=function refresh(){refreshPositions(layoutInfo,cy,options);if(true===options.fit){cy.fit(options.padding)}};var mainLoop=function mainLoop(i){if(layout.stopped||i>=options.numIter){return false}step$1(layoutInfo,options);layoutInfo.temperature=layoutInfo.temperature*options.coolingFactor;if(layoutInfo.temperature<options.minTemp){return false}return true};var done=function done(){if(options.animate===true||options.animate===false){refresh();layout.one("layoutstop",options.stop);layout.emit({type:"layoutstop",layout:layout})}else{var nodes=options.eles.nodes();var getScaledPos=getScaleInBoundsFn(layoutInfo,options,nodes);nodes.layoutPositions(layout,options,getScaledPos)}};var i=0;var loopRet=true;if(options.animate===true){var frame=function frame(){var f=0;while(loopRet&&f<options.refresh){loopRet=mainLoop(i);i++;f++}if(!loopRet){separateComponents(layoutInfo,options);done()}else{var now=performanceNow();if(now-startTime>=options.animationThreshold){refresh()}requestAnimationFrame(frame)}};frame()}else{while(loopRet){loopRet=mainLoop(i);i++}separateComponents(layoutInfo,options);done()}return this};CoseLayout.prototype.stop=function(){this.stopped=true;if(this.thread){this.thread.stop()}this.emit("layoutstop");return this};CoseLayout.prototype.destroy=function(){if(this.thread){this.thread.stop()}return this};var createLayoutInfo=function createLayoutInfo(cy,layout,options){var edges=options.eles.edges();var nodes=options.eles.nodes();var layoutInfo={isCompound:cy.hasCompoundNodes(),layoutNodes:[],idToIndex:{},nodeSize:nodes.size(),graphSet:[],indexToGraph:[],layoutEdges:[],edgeSize:edges.size(),temperature:options.initialTemp,clientWidth:cy.width(),clientHeight:cy.width(),boundingBox:makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()})};var components=options.eles.components();var id2cmptId={};for(var i=0;i<components.length;i++){var component=components[i];for(var j=0;j<component.length;j++){var node=component[j];id2cmptId[node.id()]=i}}for(var i=0;i<layoutInfo.nodeSize;i++){var n=nodes[i];var nbb=n.layoutDimensions(options);var tempNode={};tempNode.isLocked=n.locked();tempNode.id=n.data("id");tempNode.parentId=n.data("parent");tempNode.cmptId=id2cmptId[n.id()];tempNode.children=[];tempNode.positionX=n.position("x");tempNode.positionY=n.position("y");tempNode.offsetX=0;tempNode.offsetY=0;tempNode.height=nbb.w;tempNode.width=nbb.h;tempNode.maxX=tempNode.positionX+tempNode.width/2;tempNode.minX=tempNode.positionX-tempNode.width/2;tempNode.maxY=tempNode.positionY+tempNode.height/2;tempNode.minY=tempNode.positionY-tempNode.height/2;tempNode.padLeft=parseFloat(n.style("padding"));tempNode.padRight=parseFloat(n.style("padding"));tempNode.padTop=parseFloat(n.style("padding"));tempNode.padBottom=parseFloat(n.style("padding"));tempNode.nodeRepulsion=fn(options.nodeRepulsion)?options.nodeRepulsion(n):options.nodeRepulsion;layoutInfo.layoutNodes.push(tempNode);layoutInfo.idToIndex[tempNode.id]=i}var queue=[];var start=0;var end=-1;var tempGraph=[];for(var i=0;i<layoutInfo.nodeSize;i++){var n=layoutInfo.layoutNodes[i];var p_id=n.parentId;if(null!=p_id){layoutInfo.layoutNodes[layoutInfo.idToIndex[p_id]].children.push(n.id)}else{queue[++end]=n.id;tempGraph.push(n.id)}}layoutInfo.graphSet.push(tempGraph);while(start<=end){var node_id=queue[start++];var node_ix=layoutInfo.idToIndex[node_id];var node=layoutInfo.layoutNodes[node_ix];var children=node.children;if(children.length>0){layoutInfo.graphSet.push(children);for(var i=0;i<children.length;i++){queue[++end]=children[i]}}}for(var i=0;i<layoutInfo.graphSet.length;i++){var graph=layoutInfo.graphSet[i];for(var j=0;j<graph.length;j++){var index=layoutInfo.idToIndex[graph[j]];layoutInfo.indexToGraph[index]=i}}for(var i=0;i<layoutInfo.edgeSize;i++){var e=edges[i];var tempEdge={};tempEdge.id=e.data("id");tempEdge.sourceId=e.data("source");tempEdge.targetId=e.data("target");var idealLength=fn(options.idealEdgeLength)?options.idealEdgeLength(e):options.idealEdgeLength;var elasticity=fn(options.edgeElasticity)?options.edgeElasticity(e):options.edgeElasticity;var sourceIx=layoutInfo.idToIndex[tempEdge.sourceId];var targetIx=layoutInfo.idToIndex[tempEdge.targetId];var sourceGraph=layoutInfo.indexToGraph[sourceIx];var targetGraph=layoutInfo.indexToGraph[targetIx];if(sourceGraph!=targetGraph){var lca=findLCA(tempEdge.sourceId,tempEdge.targetId,layoutInfo);var lcaGraph=layoutInfo.graphSet[lca];var depth=0;var tempNode=layoutInfo.layoutNodes[sourceIx];while(-1===lcaGraph.indexOf(tempNode.id)){tempNode=layoutInfo.layoutNodes[layoutInfo.idToIndex[tempNode.parentId]];depth++}tempNode=layoutInfo.layoutNodes[targetIx];while(-1===lcaGraph.indexOf(tempNode.id)){tempNode=layoutInfo.layoutNodes[layoutInfo.idToIndex[tempNode.parentId]];depth++}idealLength*=depth*options.nestingFactor}tempEdge.idealLength=idealLength;tempEdge.elasticity=elasticity;layoutInfo.layoutEdges.push(tempEdge)}return layoutInfo};var findLCA=function findLCA(node1,node2,layoutInfo){var res=findLCA_aux(node1,node2,0,layoutInfo);if(2>res.count){return 0}else{return res.graph}};var findLCA_aux=function findLCA_aux(node1,node2,graphIx,layoutInfo){var graph=layoutInfo.graphSet[graphIx];if(-1<graph.indexOf(node1)&&-1<graph.indexOf(node2)){return{count:2,graph:graphIx}}var c=0;for(var i=0;i<graph.length;i++){var nodeId=graph[i];var nodeIx=layoutInfo.idToIndex[nodeId];var children=layoutInfo.layoutNodes[nodeIx].children;if(0===children.length){continue}var childGraphIx=layoutInfo.indexToGraph[layoutInfo.idToIndex[children[0]]];var result=findLCA_aux(node1,node2,childGraphIx,layoutInfo);if(0===result.count){continue}else if(1===result.count){c++;if(2===c){break}}else{return result}}return{count:c,graph:graphIx}};if(false){var printLayoutInfo}var randomizePositions=function randomizePositions(layoutInfo,cy){var width=layoutInfo.clientWidth;var height=layoutInfo.clientHeight;for(var i=0;i<layoutInfo.nodeSize;i++){var n=layoutInfo.layoutNodes[i];if(0===n.children.length&&!n.isLocked){n.positionX=Math.random()*width;n.positionY=Math.random()*height}}};var getScaleInBoundsFn=function getScaleInBoundsFn(layoutInfo,options,nodes){var bb=layoutInfo.boundingBox;var coseBB={x1:Infinity,x2:-Infinity,y1:Infinity,y2:-Infinity};if(options.boundingBox){nodes.forEach((function(node){var lnode=layoutInfo.layoutNodes[layoutInfo.idToIndex[node.data("id")]];coseBB.x1=Math.min(coseBB.x1,lnode.positionX);coseBB.x2=Math.max(coseBB.x2,lnode.positionX);coseBB.y1=Math.min(coseBB.y1,lnode.positionY);coseBB.y2=Math.max(coseBB.y2,lnode.positionY)}));coseBB.w=coseBB.x2-coseBB.x1;coseBB.h=coseBB.y2-coseBB.y1}return function(ele,i){var lnode=layoutInfo.layoutNodes[layoutInfo.idToIndex[ele.data("id")]];if(options.boundingBox){var pctX=(lnode.positionX-coseBB.x1)/coseBB.w;var pctY=(lnode.positionY-coseBB.y1)/coseBB.h;return{x:bb.x1+pctX*bb.w,y:bb.y1+pctY*bb.h}}else{return{x:lnode.positionX,y:lnode.positionY}}}};var refreshPositions=function refreshPositions(layoutInfo,cy,options){var layout=options.layout;var nodes=options.eles.nodes();var getScaledPos=getScaleInBoundsFn(layoutInfo,options,nodes);nodes.positions(getScaledPos);if(true!==layoutInfo.ready){layoutInfo.ready=true;layout.one("layoutready",options.ready);layout.emit({type:"layoutready",layout:this})}};var step$1=function step(layoutInfo,options,_step){calculateNodeForces(layoutInfo,options);calculateEdgeForces(layoutInfo);calculateGravityForces(layoutInfo,options);propagateForces(layoutInfo);updatePositions(layoutInfo)};var calculateNodeForces=function calculateNodeForces(layoutInfo,options){for(var i=0;i<layoutInfo.graphSet.length;i++){var graph=layoutInfo.graphSet[i];var numNodes=graph.length;for(var j=0;j<numNodes;j++){var node1=layoutInfo.layoutNodes[layoutInfo.idToIndex[graph[j]]];for(var k=j+1;k<numNodes;k++){var node2=layoutInfo.layoutNodes[layoutInfo.idToIndex[graph[k]]];nodeRepulsion(node1,node2,layoutInfo,options)}}}};var randomDistance=function randomDistance(max){return-max+2*max*Math.random()};var nodeRepulsion=function nodeRepulsion(node1,node2,layoutInfo,options){var cmptId1=node1.cmptId;var cmptId2=node2.cmptId;if(cmptId1!==cmptId2&&!layoutInfo.isCompound){return}var directionX=node2.positionX-node1.positionX;var directionY=node2.positionY-node1.positionY;var maxRandDist=1;if(0===directionX&&0===directionY){directionX=randomDistance(maxRandDist);directionY=randomDistance(maxRandDist)}var overlap=nodesOverlap(node1,node2,directionX,directionY);if(overlap>0){var force=options.nodeOverlap*overlap;var distance=Math.sqrt(directionX*directionX+directionY*directionY);var forceX=force*directionX/distance;var forceY=force*directionY/distance}else{var point1=findClippingPoint(node1,directionX,directionY);var point2=findClippingPoint(node2,-1*directionX,-1*directionY);var distanceX=point2.x-point1.x;var distanceY=point2.y-point1.y;var distanceSqr=distanceX*distanceX+distanceY*distanceY;var distance=Math.sqrt(distanceSqr);var force=(node1.nodeRepulsion+node2.nodeRepulsion)/distanceSqr;var forceX=force*distanceX/distance;var forceY=force*distanceY/distance}if(!node1.isLocked){node1.offsetX-=forceX;node1.offsetY-=forceY}if(!node2.isLocked){node2.offsetX+=forceX;node2.offsetY+=forceY}return};var nodesOverlap=function nodesOverlap(node1,node2,dX,dY){if(dX>0){var overlapX=node1.maxX-node2.minX}else{var overlapX=node2.maxX-node1.minX}if(dY>0){var overlapY=node1.maxY-node2.minY}else{var overlapY=node2.maxY-node1.minY}if(overlapX>=0&&overlapY>=0){return Math.sqrt(overlapX*overlapX+overlapY*overlapY)}else{return 0}};var findClippingPoint=function findClippingPoint(node,dX,dY){var X=node.positionX;var Y=node.positionY;var H=node.height||1;var W=node.width||1;var dirSlope=dY/dX;var nodeSlope=H/W;var res={};if(0===dX&&0<dY){res.x=X;res.y=Y+H/2;return res}if(0===dX&&0>dY){res.x=X;res.y=Y+H/2;return res}if(0<dX&&-1*nodeSlope<=dirSlope&&dirSlope<=nodeSlope){res.x=X+W/2;res.y=Y+W*dY/2/dX;return res}if(0>dX&&-1*nodeSlope<=dirSlope&&dirSlope<=nodeSlope){res.x=X-W/2;res.y=Y-W*dY/2/dX;return res}if(0<dY&&(dirSlope<=-1*nodeSlope||dirSlope>=nodeSlope)){res.x=X+H*dX/2/dY;res.y=Y+H/2;return res}if(0>dY&&(dirSlope<=-1*nodeSlope||dirSlope>=nodeSlope)){res.x=X-H*dX/2/dY;res.y=Y-H/2;return res}return res};var calculateEdgeForces=function calculateEdgeForces(layoutInfo,options){for(var i=0;i<layoutInfo.edgeSize;i++){var edge=layoutInfo.layoutEdges[i];var sourceIx=layoutInfo.idToIndex[edge.sourceId];var source=layoutInfo.layoutNodes[sourceIx];var targetIx=layoutInfo.idToIndex[edge.targetId];var target=layoutInfo.layoutNodes[targetIx];var directionX=target.positionX-source.positionX;var directionY=target.positionY-source.positionY;if(0===directionX&&0===directionY){continue}var point1=findClippingPoint(source,directionX,directionY);var point2=findClippingPoint(target,-1*directionX,-1*directionY);var lx=point2.x-point1.x;var ly=point2.y-point1.y;var l=Math.sqrt(lx*lx+ly*ly);var force=Math.pow(edge.idealLength-l,2)/edge.elasticity;if(0!==l){var forceX=force*lx/l;var forceY=force*ly/l}else{var forceX=0;var forceY=0}if(!source.isLocked){source.offsetX+=forceX;source.offsetY+=forceY}if(!target.isLocked){target.offsetX-=forceX;target.offsetY-=forceY}}};var calculateGravityForces=function calculateGravityForces(layoutInfo,options){var distThreshold=1;for(var i=0;i<layoutInfo.graphSet.length;i++){var graph=layoutInfo.graphSet[i];var numNodes=graph.length;if(0===i){var centerX=layoutInfo.clientHeight/2;var centerY=layoutInfo.clientWidth/2}else{var temp=layoutInfo.layoutNodes[layoutInfo.idToIndex[graph[0]]];var parent=layoutInfo.layoutNodes[layoutInfo.idToIndex[temp.parentId]];var centerX=parent.positionX;var centerY=parent.positionY}for(var j=0;j<numNodes;j++){var node=layoutInfo.layoutNodes[layoutInfo.idToIndex[graph[j]]];if(node.isLocked){continue}var dx=centerX-node.positionX;var dy=centerY-node.positionY;var d=Math.sqrt(dx*dx+dy*dy);if(d>distThreshold){var fx=options.gravity*dx/d;var fy=options.gravity*dy/d;node.offsetX+=fx;node.offsetY+=fy}}}};var propagateForces=function propagateForces(layoutInfo,options){var queue=[];var start=0;var end=-1;queue.push.apply(queue,layoutInfo.graphSet[0]);end+=layoutInfo.graphSet[0].length;while(start<=end){var nodeId=queue[start++];var nodeIndex=layoutInfo.idToIndex[nodeId];var node=layoutInfo.layoutNodes[nodeIndex];var children=node.children;if(0<children.length&&!node.isLocked){var offX=node.offsetX;var offY=node.offsetY;for(var i=0;i<children.length;i++){var childNode=layoutInfo.layoutNodes[layoutInfo.idToIndex[children[i]]];childNode.offsetX+=offX;childNode.offsetY+=offY;queue[++end]=children[i]}node.offsetX=0;node.offsetY=0}}};var updatePositions=function updatePositions(layoutInfo,options){for(var i=0;i<layoutInfo.nodeSize;i++){var n=layoutInfo.layoutNodes[i];if(0<n.children.length){n.maxX=undefined;n.minX=undefined;n.maxY=undefined;n.minY=undefined}}for(var i=0;i<layoutInfo.nodeSize;i++){var n=layoutInfo.layoutNodes[i];if(0<n.children.length||n.isLocked){continue}var tempForce=limitForce(n.offsetX,n.offsetY,layoutInfo.temperature);n.positionX+=tempForce.x;n.positionY+=tempForce.y;n.offsetX=0;n.offsetY=0;n.minX=n.positionX-n.width;n.maxX=n.positionX+n.width;n.minY=n.positionY-n.height;n.maxY=n.positionY+n.height;updateAncestryBoundaries(n,layoutInfo)}for(var i=0;i<layoutInfo.nodeSize;i++){var n=layoutInfo.layoutNodes[i];if(0<n.children.length&&!n.isLocked){n.positionX=(n.maxX+n.minX)/2;n.positionY=(n.maxY+n.minY)/2;n.width=n.maxX-n.minX;n.height=n.maxY-n.minY}}};var limitForce=function limitForce(forceX,forceY,max){var force=Math.sqrt(forceX*forceX+forceY*forceY);if(force>max){var res={x:max*forceX/force,y:max*forceY/force}}else{var res={x:forceX,y:forceY}}return res};var updateAncestryBoundaries=function updateAncestryBoundaries(node,layoutInfo){var parentId=node.parentId;if(null==parentId){return}var p=layoutInfo.layoutNodes[layoutInfo.idToIndex[parentId]];var flag=false;if(null==p.maxX||node.maxX+p.padRight>p.maxX){p.maxX=node.maxX+p.padRight;flag=true}if(null==p.minX||node.minX-p.padLeft<p.minX){p.minX=node.minX-p.padLeft;flag=true}if(null==p.maxY||node.maxY+p.padBottom>p.maxY){p.maxY=node.maxY+p.padBottom;flag=true}if(null==p.minY||node.minY-p.padTop<p.minY){p.minY=node.minY-p.padTop;flag=true}if(flag){return updateAncestryBoundaries(p,layoutInfo)}return};var separateComponents=function separateComponents(layoutInfo,options){var nodes=layoutInfo.layoutNodes;var components=[];for(var i=0;i<nodes.length;i++){var node=nodes[i];var cid=node.cmptId;var component=components[cid]=components[cid]||[];component.push(node)}var totalA=0;for(var i=0;i<components.length;i++){var c=components[i];if(!c){continue}c.x1=Infinity;c.x2=-Infinity;c.y1=Infinity;c.y2=-Infinity;for(var j=0;j<c.length;j++){var n=c[j];c.x1=Math.min(c.x1,n.positionX-n.width/2);c.x2=Math.max(c.x2,n.positionX+n.width/2);c.y1=Math.min(c.y1,n.positionY-n.height/2);c.y2=Math.max(c.y2,n.positionY+n.height/2)}c.w=c.x2-c.x1;c.h=c.y2-c.y1;totalA+=c.w*c.h}components.sort((function(c1,c2){return c2.w*c2.h-c1.w*c1.h}));var x=0;var y=0;var usedW=0;var rowH=0;var maxRowW=Math.sqrt(totalA)*layoutInfo.clientWidth/layoutInfo.clientHeight;for(var i=0;i<components.length;i++){var c=components[i];if(!c){continue}for(var j=0;j<c.length;j++){var n=c[j];if(!n.isLocked){n.positionX+=x-c.x1;n.positionY+=y-c.y1}}x+=c.w+options.componentSpacing;usedW+=c.w+options.componentSpacing;rowH=Math.max(rowH,c.h);if(usedW>maxRowW){y+=rowH+options.componentSpacing;x=0;usedW=0;rowH=0}}};var defaults$d={fit:true,padding:30,boundingBox:undefined,avoidOverlap:true,avoidOverlapPadding:10,nodeDimensionsIncludeLabels:false,spacingFactor:undefined,condense:false,rows:undefined,cols:undefined,position:function position(node){},sort:undefined,animate:false,animationDuration:500,animationEasing:undefined,animateFilter:function animateFilter(node,i){return true},ready:undefined,stop:undefined,transform:function transform(node,position){return position}};function GridLayout(options){this.options=extend({},defaults$d,options)}GridLayout.prototype.run=function(){var params=this.options;var options=params;var cy=params.cy;var eles=options.eles;var nodes=eles.nodes().not(":parent");if(options.sort){nodes=nodes.sort(options.sort)}var bb=makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()});if(bb.h===0||bb.w===0){nodes.layoutPositions(this,options,(function(ele){return{x:bb.x1,y:bb.y1}}))}else{var cells=nodes.size();var splits=Math.sqrt(cells*bb.h/bb.w);var rows=Math.round(splits);var cols=Math.round(bb.w/bb.h*splits);var small=function small(val){if(val==null){return Math.min(rows,cols)}else{var min=Math.min(rows,cols);if(min==rows){rows=val}else{cols=val}}};var large=function large(val){if(val==null){return Math.max(rows,cols)}else{var max=Math.max(rows,cols);if(max==rows){rows=val}else{cols=val}}};var oRows=options.rows;var oCols=options.cols!=null?options.cols:options.columns;if(oRows!=null&&oCols!=null){rows=oRows;cols=oCols}else if(oRows!=null&&oCols==null){rows=oRows;cols=Math.ceil(cells/rows)}else if(oRows==null&&oCols!=null){cols=oCols;rows=Math.ceil(cells/cols)}else if(cols*rows>cells){var sm=small();var lg=large();if((sm-1)*lg>=cells){small(sm-1)}else if((lg-1)*sm>=cells){large(lg-1)}}else{while(cols*rows<cells){var _sm=small();var _lg=large();if((_lg+1)*_sm>=cells){large(_lg+1)}else{small(_sm+1)}}}var cellWidth=bb.w/cols;var cellHeight=bb.h/rows;if(options.condense){cellWidth=0;cellHeight=0}if(options.avoidOverlap){for(var i=0;i<nodes.length;i++){var node=nodes[i];var pos=node._private.position;if(pos.x==null||pos.y==null){pos.x=0;pos.y=0}var nbb=node.layoutDimensions(options);var p=options.avoidOverlapPadding;var w=nbb.w+p;var h=nbb.h+p;cellWidth=Math.max(cellWidth,w);cellHeight=Math.max(cellHeight,h)}}var cellUsed={};var used=function used(row,col){return cellUsed["c-"+row+"-"+col]?true:false};var use=function use(row,col){cellUsed["c-"+row+"-"+col]=true};var row=0;var col=0;var moveToNextCell=function moveToNextCell(){col++;if(col>=cols){col=0;row++}};var id2manPos={};for(var _i=0;_i<nodes.length;_i++){var _node=nodes[_i];var rcPos=options.position(_node);if(rcPos&&(rcPos.row!==undefined||rcPos.col!==undefined)){var _pos={row:rcPos.row,col:rcPos.col};if(_pos.col===undefined){_pos.col=0;while(used(_pos.row,_pos.col)){_pos.col++}}else if(_pos.row===undefined){_pos.row=0;while(used(_pos.row,_pos.col)){_pos.row++}}id2manPos[_node.id()]=_pos;use(_pos.row,_pos.col)}}var getPos=function getPos(element,i){var x,y;if(element.locked()||element.isParent()){return false}var rcPos=id2manPos[element.id()];if(rcPos){x=rcPos.col*cellWidth+cellWidth/2+bb.x1;y=rcPos.row*cellHeight+cellHeight/2+bb.y1}else{while(used(row,col)){moveToNextCell()}x=col*cellWidth+cellWidth/2+bb.x1;y=row*cellHeight+cellHeight/2+bb.y1;use(row,col);moveToNextCell()}return{x:x,y:y}};nodes.layoutPositions(this,options,getPos)}return this};var defaults$e={ready:function ready(){},stop:function stop(){}};function NullLayout(options){this.options=extend({},defaults$e,options)}NullLayout.prototype.run=function(){var options=this.options;var eles=options.eles;var layout=this;var cy=options.cy;layout.emit("layoutstart");eles.nodes().positions((function(){return{x:0,y:0}}));layout.one("layoutready",options.ready);layout.emit("layoutready");layout.one("layoutstop",options.stop);layout.emit("layoutstop");return this};NullLayout.prototype.stop=function(){return this};var defaults$f={positions:undefined,zoom:undefined,pan:undefined,fit:true,padding:30,animate:false,animationDuration:500,animationEasing:undefined,animateFilter:function animateFilter(node,i){return true},ready:undefined,stop:undefined,transform:function transform(node,position){return position}};function PresetLayout(options){this.options=extend({},defaults$f,options)}PresetLayout.prototype.run=function(){var options=this.options;var eles=options.eles;var nodes=eles.nodes();var posIsFn=fn(options.positions);function getPosition(node){if(options.positions==null){return copyPosition(node.position())}if(posIsFn){return options.positions(node)}var pos=options.positions[node._private.data.id];if(pos==null){return null}return pos}nodes.layoutPositions(this,options,(function(node,i){var position=getPosition(node);if(node.locked()||position==null){return false}return position}));return this};var defaults$g={fit:true,padding:30,boundingBox:undefined,animate:false,animationDuration:500,animationEasing:undefined,animateFilter:function animateFilter(node,i){return true},ready:undefined,stop:undefined,transform:function transform(node,position){return position}};function RandomLayout(options){this.options=extend({},defaults$g,options)}RandomLayout.prototype.run=function(){var options=this.options;var cy=options.cy;var eles=options.eles;var nodes=eles.nodes().not(":parent");var bb=makeBoundingBox(options.boundingBox?options.boundingBox:{x1:0,y1:0,w:cy.width(),h:cy.height()});var getPos=function getPos(node,i){return{x:bb.x1+Math.round(Math.random()*bb.w),y:bb.y1+Math.round(Math.random()*bb.h)}};nodes.layoutPositions(this,options,getPos);return this};var layout=[{name:"breadthfirst",impl:BreadthFirstLayout},{name:"circle",impl:CircleLayout},{name:"concentric",impl:ConcentricLayout},{name:"cose",impl:CoseLayout},{name:"grid",impl:GridLayout},{name:"null",impl:NullLayout},{name:"preset",impl:PresetLayout},{name:"random",impl:RandomLayout}];function NullRenderer(options){this.options=options;this.notifications=0}var noop$1=function noop(){};NullRenderer.prototype={recalculateRenderedStyle:noop$1,notify:function notify(){this.notifications++},init:noop$1,isHeadless:function isHeadless(){return true}};var BRp={};BRp.arrowShapeWidth=.3;BRp.registerArrowShapes=function(){var arrowShapes=this.arrowShapes={};var renderer=this;var bbCollide=function bbCollide(x,y,size,angle,translation,edgeWidth,padding){var x1=translation.x-size/2-padding;var x2=translation.x+size/2+padding;var y1=translation.y-size/2-padding;var y2=translation.y+size/2+padding;var inside=x1<=x&&x<=x2&&y1<=y&&y<=y2;return inside};var transform=function transform(x,y,size,angle,translation){var xRotated=x*Math.cos(angle)-y*Math.sin(angle);var yRotated=x*Math.sin(angle)+y*Math.cos(angle);var xScaled=xRotated*size;var yScaled=yRotated*size;var xTranslated=xScaled+translation.x;var yTranslated=yScaled+translation.y;return{x:xTranslated,y:yTranslated}};var transformPoints=function transformPoints(pts,size,angle,translation){var retPts=[];for(var i=0;i<pts.length;i+=2){var x=pts[i];var y=pts[i+1];retPts.push(transform(x,y,size,angle,translation))}return retPts};var pointsToArr=function pointsToArr(pts){var ret=[];for(var i=0;i<pts.length;i++){var p=pts[i];ret.push(p.x,p.y)}return ret};var standardGap=function standardGap(edge){return edge.pstyle("width").pfValue*edge.pstyle("arrow-scale").pfValue*2};var defineArrowShape=function defineArrowShape(name,defn){if(string(defn)){defn=arrowShapes[defn]}arrowShapes[name]=extend({name:name,points:[-.15,-.3,.15,-.3,.15,.3,-.15,.3],collide:function collide(x,y,size,angle,translation,padding){var points=pointsToArr(transformPoints(this.points,size+2*padding,angle,translation));var inside=pointInsidePolygonPoints(x,y,points);return inside},roughCollide:bbCollide,draw:function draw(context,size,angle,translation){var points=transformPoints(this.points,size,angle,translation);renderer.arrowShapeImpl("polygon")(context,points)},spacing:function spacing(edge){return 0},gap:standardGap},defn)};defineArrowShape("none",{collide:falsify,roughCollide:falsify,draw:noop,spacing:zeroify,gap:zeroify});defineArrowShape("triangle",{points:[-.15,-.3,0,0,.15,-.3]});defineArrowShape("arrow","triangle");defineArrowShape("triangle-backcurve",{points:arrowShapes["triangle"].points,controlPoint:[0,-.15],roughCollide:bbCollide,draw:function draw(context,size,angle,translation,edgeWidth){var ptsTrans=transformPoints(this.points,size,angle,translation);var ctrlPt=this.controlPoint;var ctrlPtTrans=transform(ctrlPt[0],ctrlPt[1],size,angle,translation);renderer.arrowShapeImpl(this.name)(context,ptsTrans,ctrlPtTrans)},gap:function gap(edge){return standardGap(edge)*.8}});defineArrowShape("triangle-tee",{points:[0,0,.15,-.3,-.15,-.3,0,0],pointsTee:[-.15,-.4,-.15,-.5,.15,-.5,.15,-.4],collide:function collide(x,y,size,angle,translation,edgeWidth,padding){var triPts=pointsToArr(transformPoints(this.points,size+2*padding,angle,translation));var teePts=pointsToArr(transformPoints(this.pointsTee,size+2*padding,angle,translation));var inside=pointInsidePolygonPoints(x,y,triPts)||pointInsidePolygonPoints(x,y,teePts);return inside},draw:function draw(context,size,angle,translation,edgeWidth){var triPts=transformPoints(this.points,size,angle,translation);var teePts=transformPoints(this.pointsTee,size,angle,translation);renderer.arrowShapeImpl(this.name)(context,triPts,teePts)}});defineArrowShape("triangle-cross",{points:[0,0,.15,-.3,-.15,-.3,0,0],baseCrossLinePts:[-.15,-.4,-.15,-.4,.15,-.4,.15,-.4],crossLinePts:function crossLinePts(size,edgeWidth){var p=this.baseCrossLinePts.slice();var shiftFactor=edgeWidth/size;var y0=3;var y1=5;p[y0]=p[y0]-shiftFactor;p[y1]=p[y1]-shiftFactor;return p},collide:function collide(x,y,size,angle,translation,edgeWidth,padding){var triPts=pointsToArr(transformPoints(this.points,size+2*padding,angle,translation));var teePts=pointsToArr(transformPoints(this.crossLinePts(size,edgeWidth),size+2*padding,angle,translation));var inside=pointInsidePolygonPoints(x,y,triPts)||pointInsidePolygonPoints(x,y,teePts);return inside},draw:function draw(context,size,angle,translation,edgeWidth){var triPts=transformPoints(this.points,size,angle,translation);var crossLinePts=transformPoints(this.crossLinePts(size,edgeWidth),size,angle,translation);renderer.arrowShapeImpl(this.name)(context,triPts,crossLinePts)}});defineArrowShape("vee",{points:[-.15,-.3,0,0,.15,-.3,0,-.15],gap:function gap(edge){return standardGap(edge)*.525}});defineArrowShape("circle",{radius:.15,collide:function collide(x,y,size,angle,translation,edgeWidth,padding){var t=translation;var inside=Math.pow(t.x-x,2)+Math.pow(t.y-y,2)<=Math.pow((size+2*padding)*this.radius,2);return inside},draw:function draw(context,size,angle,translation,edgeWidth){renderer.arrowShapeImpl(this.name)(context,translation.x,translation.y,this.radius*size)},spacing:function spacing(edge){return renderer.getArrowWidth(edge.pstyle("width").pfValue,edge.pstyle("arrow-scale").value)*this.radius}});defineArrowShape("tee",{points:[-.15,0,-.15,-.1,.15,-.1,.15,0],spacing:function spacing(edge){return 1},gap:function gap(edge){return 1}});defineArrowShape("square",{points:[-.15,0,.15,0,.15,-.3,-.15,-.3]});defineArrowShape("diamond",{points:[-.15,-.15,0,-.3,.15,-.15,0,0],gap:function gap(edge){return edge.pstyle("width").pfValue*edge.pstyle("arrow-scale").value}});defineArrowShape("chevron",{points:[0,0,-.15,-.15,-.1,-.2,0,-.1,.1,-.2,.15,-.15],gap:function gap(edge){return.95*edge.pstyle("width").pfValue*edge.pstyle("arrow-scale").value}})};var BRp$1={};BRp$1.projectIntoViewport=function(clientX,clientY){var cy=this.cy;var offsets=this.findContainerClientCoords();var offsetLeft=offsets[0];var offsetTop=offsets[1];var scale=offsets[4];var pan=cy.pan();var zoom=cy.zoom();var x=((clientX-offsetLeft)/scale-pan.x)/zoom;var y=((clientY-offsetTop)/scale-pan.y)/zoom;return[x,y]};BRp$1.findContainerClientCoords=function(){if(this.containerBB){return this.containerBB}var container=this.container;var rect=container.getBoundingClientRect();var style=window$1.getComputedStyle(container);var styleValue=function styleValue(name){return parseFloat(style.getPropertyValue(name))};var padding={left:styleValue("padding-left"),right:styleValue("padding-right"),top:styleValue("padding-top"),bottom:styleValue("padding-bottom")};var border={left:styleValue("border-left-width"),right:styleValue("border-right-width"),top:styleValue("border-top-width"),bottom:styleValue("border-bottom-width")};var clientWidth=container.clientWidth;var clientHeight=container.clientHeight;var paddingHor=padding.left+padding.right;var paddingVer=padding.top+padding.bottom;var borderHor=border.left+border.right;var scale=rect.width/(clientWidth+borderHor);var unscaledW=clientWidth-paddingHor;var unscaledH=clientHeight-paddingVer;var left=rect.left+padding.left+border.left;var top=rect.top+padding.top+border.top;return this.containerBB=[left,top,unscaledW,unscaledH,scale]};BRp$1.invalidateContainerClientCoordsCache=function(){this.containerBB=null};BRp$1.findNearestElement=function(x,y,interactiveElementsOnly,isTouch){return this.findNearestElements(x,y,interactiveElementsOnly,isTouch)[0]};BRp$1.findNearestElements=function(x,y,interactiveElementsOnly,isTouch){var self=this;var r=this;var eles=r.getCachedZSortedEles();var near=[];var zoom=r.cy.zoom();var hasCompounds=r.cy.hasCompoundNodes();var edgeThreshold=(isTouch?24:8)/zoom;var nodeThreshold=(isTouch?8:2)/zoom;var labelThreshold=(isTouch?8:2)/zoom;var minSqDist=Infinity;var nearEdge;var nearNode;if(interactiveElementsOnly){eles=eles.interactive}function addEle(ele,sqDist){if(ele.isNode()){if(nearNode){return}else{nearNode=ele;near.push(ele)}}if(ele.isEdge()&&(sqDist==null||sqDist<minSqDist)){if(nearEdge){if(nearEdge.pstyle("z-compound-depth").value===ele.pstyle("z-compound-depth").value&&nearEdge.pstyle("z-compound-depth").value===ele.pstyle("z-compound-depth").value){for(var i=0;i<near.length;i++){if(near[i].isEdge()){near[i]=ele;nearEdge=ele;minSqDist=sqDist!=null?sqDist:minSqDist;break}}}}else{near.push(ele);nearEdge=ele;minSqDist=sqDist!=null?sqDist:minSqDist}}}function checkNode(node){var width=node.outerWidth()+2*nodeThreshold;var height=node.outerHeight()+2*nodeThreshold;var hw=width/2;var hh=height/2;var pos=node.position();if(pos.x-hw<=x&&x<=pos.x+hw&&pos.y-hh<=y&&y<=pos.y+hh){var shape=r.nodeShapes[self.getNodeShape(node)];if(shape.checkPoint(x,y,0,width,height,pos.x,pos.y)){addEle(node,0);return true}}}function checkEdge(edge){var _p=edge._private;var rs=_p.rscratch;var styleWidth=edge.pstyle("width").pfValue;var scale=edge.pstyle("arrow-scale").value;var width=styleWidth/2+edgeThreshold;var widthSq=width*width;var width2=width*2;var src=_p.source;var tgt=_p.target;var sqDist;if(rs.edgeType==="segments"||rs.edgeType==="straight"||rs.edgeType==="haystack"){var pts=rs.allpts;for(var i=0;i+3<pts.length;i+=2){if(inLineVicinity(x,y,pts[i],pts[i+1],pts[i+2],pts[i+3],width2)&&widthSq>(sqDist=sqdistToFiniteLine(x,y,pts[i],pts[i+1],pts[i+2],pts[i+3]))){addEle(edge,sqDist);return true}}}else if(rs.edgeType==="bezier"||rs.edgeType==="multibezier"||rs.edgeType==="self"||rs.edgeType==="compound"){var pts=rs.allpts;for(var i=0;i+5<rs.allpts.length;i+=4){if(inBezierVicinity(x,y,pts[i],pts[i+1],pts[i+2],pts[i+3],pts[i+4],pts[i+5],width2)&&widthSq>(sqDist=sqdistToQuadraticBezier(x,y,pts[i],pts[i+1],pts[i+2],pts[i+3],pts[i+4],pts[i+5]))){addEle(edge,sqDist);return true}}}var src=src||_p.source;var tgt=tgt||_p.target;var arSize=self.getArrowWidth(styleWidth,scale);var arrows=[{name:"source",x:rs.arrowStartX,y:rs.arrowStartY,angle:rs.srcArrowAngle},{name:"target",x:rs.arrowEndX,y:rs.arrowEndY,angle:rs.tgtArrowAngle},{name:"mid-source",x:rs.midX,y:rs.midY,angle:rs.midsrcArrowAngle},{name:"mid-target",x:rs.midX,y:rs.midY,angle:rs.midtgtArrowAngle}];for(var i=0;i<arrows.length;i++){var ar=arrows[i];var shape=r.arrowShapes[edge.pstyle(ar.name+"-arrow-shape").value];var edgeWidth=edge.pstyle("width").pfValue;if(shape.roughCollide(x,y,arSize,ar.angle,{x:ar.x,y:ar.y},edgeWidth,edgeThreshold)&&shape.collide(x,y,arSize,ar.angle,{x:ar.x,y:ar.y},edgeWidth,edgeThreshold)){addEle(edge);return true}}if(hasCompounds&&near.length>0){checkNode(src);checkNode(tgt)}}function preprop(obj,name,pre){return getPrefixedProperty(obj,name,pre)}function checkLabel(ele,prefix){var _p=ele._private;var th=labelThreshold;var prefixDash;if(prefix){prefixDash=prefix+"-"}else{prefixDash=""}var bb=_p.labelBounds[prefix||"main"];var text=ele.pstyle(prefixDash+"label").value;var eventsEnabled=ele.pstyle("text-events").strValue==="yes";if(!eventsEnabled||!text){return}var rstyle=_p.rstyle;var lx=preprop(rstyle,"labelX",prefix);var ly=preprop(rstyle,"labelY",prefix);var theta=preprop(_p.rscratch,"labelAngle",prefix);var lx1=bb.x1-th;var lx2=bb.x2+th;var ly1=bb.y1-th;var ly2=bb.y2+th;if(theta){var cos=Math.cos(theta);var sin=Math.sin(theta);var rotate=function rotate(x,y){x=x-lx;y=y-ly;return{x:x*cos-y*sin+lx,y:x*sin+y*cos+ly}};var px1y1=rotate(lx1,ly1);var px1y2=rotate(lx1,ly2);var px2y1=rotate(lx2,ly1);var px2y2=rotate(lx2,ly2);var points=[px1y1.x,px1y1.y,px2y1.x,px2y1.y,px2y2.x,px2y2.y,px1y2.x,px1y2.y];if(pointInsidePolygonPoints(x,y,points)){addEle(ele);return true}}else{if(inBoundingBox(bb,x,y)){addEle(ele);return true}}}for(var i=eles.length-1;i>=0;i--){var ele=eles[i];if(ele.isNode()){checkNode(ele)||checkLabel(ele)}else{checkEdge(ele)||checkLabel(ele)||checkLabel(ele,"source")||checkLabel(ele,"target")}}return near};BRp$1.getAllInBox=function(x1,y1,x2,y2){var eles=this.getCachedZSortedEles().interactive;var box=[];var x1c=Math.min(x1,x2);var x2c=Math.max(x1,x2);var y1c=Math.min(y1,y2);var y2c=Math.max(y1,y2);x1=x1c;x2=x2c;y1=y1c;y2=y2c;var boxBb=makeBoundingBox({x1:x1,y1:y1,x2:x2,y2:y2});for(var e=0;e<eles.length;e++){var ele=eles[e];if(ele.isNode()){var node=ele;var nodeBb=node.boundingBox({includeNodes:true,includeEdges:false,includeLabels:false});if(boundingBoxesIntersect(boxBb,nodeBb)&&!boundingBoxInBoundingBox(nodeBb,boxBb)){box.push(node)}}else{var edge=ele;var _p=edge._private;var rs=_p.rscratch;if(rs.startX!=null&&rs.startY!=null&&!inBoundingBox(boxBb,rs.startX,rs.startY)){continue}if(rs.endX!=null&&rs.endY!=null&&!inBoundingBox(boxBb,rs.endX,rs.endY)){continue}if(rs.edgeType==="bezier"||rs.edgeType==="multibezier"||rs.edgeType==="self"||rs.edgeType==="compound"||rs.edgeType==="segments"||rs.edgeType==="haystack"){var pts=_p.rstyle.bezierPts||_p.rstyle.linePts||_p.rstyle.haystackPts;var allInside=true;for(var i=0;i<pts.length;i++){if(!pointInBoundingBox(boxBb,pts[i])){allInside=false;break}}if(allInside){box.push(edge)}}else if(rs.edgeType==="haystack"||rs.edgeType==="straight"){box.push(edge)}}}return box};var BRp$2={};BRp$2.calculateArrowAngles=function(edge){var rs=edge._private.rscratch;var isHaystack=rs.edgeType==="haystack";var isBezier=rs.edgeType==="bezier";var isMultibezier=rs.edgeType==="multibezier";var isSegments=rs.edgeType==="segments";var isCompound=rs.edgeType==="compound";var isSelf=rs.edgeType==="self";var dispX,dispY;var startX,startY,endX,endY,midX,midY;if(isHaystack){startX=rs.haystackPts[0];startY=rs.haystackPts[1];endX=rs.haystackPts[2];endY=rs.haystackPts[3]}else{startX=rs.arrowStartX;startY=rs.arrowStartY;endX=rs.arrowEndX;endY=rs.arrowEndY}midX=rs.midX;midY=rs.midY;if(isSegments){dispX=startX-rs.segpts[0];dispY=startY-rs.segpts[1]}else if(isMultibezier||isCompound||isSelf||isBezier){var pts=rs.allpts;var bX=qbezierAt(pts[0],pts[2],pts[4],.1);var bY=qbezierAt(pts[1],pts[3],pts[5],.1);dispX=startX-bX;dispY=startY-bY}else{dispX=startX-midX;dispY=startY-midY}rs.srcArrowAngle=getAngleFromDisp(dispX,dispY);var midX=rs.midX;var midY=rs.midY;if(isHaystack){midX=(startX+endX)/2;midY=(startY+endY)/2}dispX=endX-startX;dispY=endY-startY;if(isSegments){var pts=rs.allpts;if(pts.length/2%2===0){var i2=pts.length/2;var i1=i2-2;dispX=pts[i2]-pts[i1];dispY=pts[i2+1]-pts[i1+1]}else{var i2=pts.length/2-1;var i1=i2-2;var i3=i2+2;dispX=pts[i2]-pts[i1];dispY=pts[i2+1]-pts[i1+1]}}else if(isMultibezier||isCompound||isSelf){var pts=rs.allpts;var cpts=rs.ctrlpts;var bp0x,bp0y;var bp1x,bp1y;if(cpts.length/2%2===0){var p0=pts.length/2-1;var ic=p0+2;var p1=ic+2;bp0x=qbezierAt(pts[p0],pts[ic],pts[p1],0);bp0y=qbezierAt(pts[p0+1],pts[ic+1],pts[p1+1],0);bp1x=qbezierAt(pts[p0],pts[ic],pts[p1],1e-4);bp1y=qbezierAt(pts[p0+1],pts[ic+1],pts[p1+1],1e-4)}else{var ic=pts.length/2-1;var p0=ic-2;var p1=ic+2;bp0x=qbezierAt(pts[p0],pts[ic],pts[p1],.4999);bp0y=qbezierAt(pts[p0+1],pts[ic+1],pts[p1+1],.4999);bp1x=qbezierAt(pts[p0],pts[ic],pts[p1],.5);bp1y=qbezierAt(pts[p0+1],pts[ic+1],pts[p1+1],.5)}dispX=bp1x-bp0x;dispY=bp1y-bp0y}rs.midtgtArrowAngle=getAngleFromDisp(dispX,dispY);rs.midDispX=dispX;rs.midDispY=dispY;dispX*=-1;dispY*=-1;if(isSegments){var pts=rs.allpts;if(pts.length/2%2===0);else{var i2=pts.length/2-1;var i3=i2+2;dispX=-(pts[i3]-pts[i2]);dispY=-(pts[i3+1]-pts[i2+1])}}rs.midsrcArrowAngle=getAngleFromDisp(dispX,dispY);if(isSegments){dispX=endX-rs.segpts[rs.segpts.length-2];dispY=endY-rs.segpts[rs.segpts.length-1]}else if(isMultibezier||isCompound||isSelf||isBezier){var pts=rs.allpts;var l=pts.length;var bX=qbezierAt(pts[l-6],pts[l-4],pts[l-2],.9);var bY=qbezierAt(pts[l-5],pts[l-3],pts[l-1],.9);dispX=endX-bX;dispY=endY-bY}else{dispX=endX-midX;dispY=endY-midY}rs.tgtArrowAngle=getAngleFromDisp(dispX,dispY)};BRp$2.getArrowWidth=BRp$2.getArrowHeight=function(edgeWidth,scale){var cache=this.arrowWidthCache=this.arrowWidthCache||{};var cachedVal=cache[edgeWidth+", "+scale];if(cachedVal){return cachedVal}cachedVal=Math.max(Math.pow(edgeWidth*13.37,.9),29)*scale;cache[edgeWidth+", "+scale]=cachedVal;return cachedVal};var BRp$3={};BRp$3.findHaystackPoints=function(edges){for(var i=0;i<edges.length;i++){var edge=edges[i];var _p=edge._private;var rs=_p.rscratch;if(!rs.haystack){var angle=Math.random()*2*Math.PI;rs.source={x:Math.cos(angle),y:Math.sin(angle)};angle=Math.random()*2*Math.PI;rs.target={x:Math.cos(angle),y:Math.sin(angle)}}var src=_p.source;var tgt=_p.target;var srcPos=src.position();var tgtPos=tgt.position();var srcW=src.width();var tgtW=tgt.width();var srcH=src.height();var tgtH=tgt.height();var radius=edge.pstyle("haystack-radius").value;var halfRadius=radius/2;rs.haystackPts=rs.allpts=[rs.source.x*srcW*halfRadius+srcPos.x,rs.source.y*srcH*halfRadius+srcPos.y,rs.target.x*tgtW*halfRadius+tgtPos.x,rs.target.y*tgtH*halfRadius+tgtPos.y];rs.midX=(rs.allpts[0]+rs.allpts[2])/2;rs.midY=(rs.allpts[1]+rs.allpts[3])/2;rs.edgeType="haystack";rs.haystack=true;this.storeEdgeProjections(edge);this.calculateArrowAngles(edge);this.recalculateEdgeLabelProjections(edge);this.calculateLabelAngles(edge)}};BRp$3.findSegmentsPoints=function(edge,pairInfo){var rs=edge._private.rscratch;var posPts=pairInfo.posPts,intersectionPts=pairInfo.intersectionPts,vectorNormInverse=pairInfo.vectorNormInverse;var edgeDistances=edge.pstyle("edge-distances").value;var segmentWs=edge.pstyle("segment-weights");var segmentDs=edge.pstyle("segment-distances");var segmentsN=Math.min(segmentWs.pfValue.length,segmentDs.pfValue.length);rs.edgeType="segments";rs.segpts=[];for(var s=0;s<segmentsN;s++){var w=segmentWs.pfValue[s];var d=segmentDs.pfValue[s];var w1=1-w;var w2=w;var midptPts=edgeDistances==="node-position"?posPts:intersectionPts;var adjustedMidpt={x:midptPts.x1*w1+midptPts.x2*w2,y:midptPts.y1*w1+midptPts.y2*w2};rs.segpts.push(adjustedMidpt.x+vectorNormInverse.x*d,adjustedMidpt.y+vectorNormInverse.y*d)}};BRp$3.findLoopPoints=function(edge,pairInfo,i,edgeIsUnbundled){var rs=edge._private.rscratch;var dirCounts=pairInfo.dirCounts,srcPos=pairInfo.srcPos;var ctrlptDists=edge.pstyle("control-point-distances");var ctrlptDist=ctrlptDists?ctrlptDists.pfValue[0]:undefined;var loopDir=edge.pstyle("loop-direction").pfValue;var loopSwp=edge.pstyle("loop-sweep").pfValue;var stepSize=edge.pstyle("control-point-step-size").pfValue;rs.edgeType="self";var j=i;var loopDist=stepSize;if(edgeIsUnbundled){j=0;loopDist=ctrlptDist}var loopAngle=loopDir-Math.PI/2;var outAngle=loopAngle-loopSwp/2;var inAngle=loopAngle+loopSwp/2;var dc=String(loopDir+"_"+loopSwp);j=dirCounts[dc]===undefined?dirCounts[dc]=0:++dirCounts[dc];rs.ctrlpts=[srcPos.x+Math.cos(outAngle)*1.4*loopDist*(j/3+1),srcPos.y+Math.sin(outAngle)*1.4*loopDist*(j/3+1),srcPos.x+Math.cos(inAngle)*1.4*loopDist*(j/3+1),srcPos.y+Math.sin(inAngle)*1.4*loopDist*(j/3+1)]};BRp$3.findCompoundLoopPoints=function(edge,pairInfo,i,edgeIsUnbundled){var rs=edge._private.rscratch;rs.edgeType="compound";var srcPos=pairInfo.srcPos,tgtPos=pairInfo.tgtPos,srcW=pairInfo.srcW,srcH=pairInfo.srcH,tgtW=pairInfo.tgtW,tgtH=pairInfo.tgtH;var stepSize=edge.pstyle("control-point-step-size").pfValue;var ctrlptDists=edge.pstyle("control-point-distances");var ctrlptDist=ctrlptDists?ctrlptDists.pfValue[0]:undefined;var j=i;var loopDist=stepSize;if(edgeIsUnbundled){j=0;loopDist=ctrlptDist}var loopW=50;var loopaPos={x:srcPos.x-srcW/2,y:srcPos.y-srcH/2};var loopbPos={x:tgtPos.x-tgtW/2,y:tgtPos.y-tgtH/2};var loopPos={x:Math.min(loopaPos.x,loopbPos.x),y:Math.min(loopaPos.y,loopbPos.y)};var minCompoundStretch=.5;var compoundStretchA=Math.max(minCompoundStretch,Math.log(srcW*.01));var compoundStretchB=Math.max(minCompoundStretch,Math.log(tgtW*.01));rs.ctrlpts=[loopPos.x,loopPos.y-(1+Math.pow(loopW,1.12)/100)*loopDist*(j/3+1)*compoundStretchA,loopPos.x-(1+Math.pow(loopW,1.12)/100)*loopDist*(j/3+1)*compoundStretchB,loopPos.y]};BRp$3.findStraightEdgePoints=function(edge){edge._private.rscratch.edgeType="straight"};BRp$3.findBezierPoints=function(edge,pairInfo,i,edgeIsUnbundled,edgeIsSwapped){var rs=edge._private.rscratch;var vectorNormInverse=pairInfo.vectorNormInverse,posPts=pairInfo.posPts,intersectionPts=pairInfo.intersectionPts;var edgeDistances=edge.pstyle("edge-distances").value;var stepSize=edge.pstyle("control-point-step-size").pfValue;var ctrlptDists=edge.pstyle("control-point-distances");var ctrlptWs=edge.pstyle("control-point-weights");var bezierN=ctrlptDists&&ctrlptWs?Math.min(ctrlptDists.value.length,ctrlptWs.value.length):1;var ctrlptDist=ctrlptDists?ctrlptDists.pfValue[0]:undefined;var ctrlptWeight=ctrlptWs.value[0];var multi=edgeIsUnbundled;rs.edgeType=multi?"multibezier":"bezier";rs.ctrlpts=[];for(var b=0;b<bezierN;b++){var normctrlptDist=(.5-pairInfo.eles.length/2+i)*stepSize*(edgeIsSwapped?-1:1);var manctrlptDist=void 0;var sign=signum(normctrlptDist);if(multi){ctrlptDist=ctrlptDists?ctrlptDists.pfValue[b]:stepSize;ctrlptWeight=ctrlptWs.value[b]}if(edgeIsUnbundled){manctrlptDist=ctrlptDist}else{manctrlptDist=ctrlptDist!==undefined?sign*ctrlptDist:undefined}var distanceFromMidpoint=manctrlptDist!==undefined?manctrlptDist:normctrlptDist;var w1=1-ctrlptWeight;var w2=ctrlptWeight;var midptPts=edgeDistances==="node-position"?posPts:intersectionPts;var adjustedMidpt={x:midptPts.x1*w1+midptPts.x2*w2,y:midptPts.y1*w1+midptPts.y2*w2};rs.ctrlpts.push(adjustedMidpt.x+vectorNormInverse.x*distanceFromMidpoint,adjustedMidpt.y+vectorNormInverse.y*distanceFromMidpoint)}};BRp$3.findTaxiPoints=function(edge,pairInfo){var rs=edge._private.rscratch;rs.edgeType="segments";var VERTICAL="vertical";var HORIZONTAL="horizontal";var LEFTWARD="leftward";var RIGHTWARD="rightward";var DOWNWARD="downward";var UPWARD="upward";var AUTO="auto";var posPts=pairInfo.posPts,srcW=pairInfo.srcW,srcH=pairInfo.srcH,tgtW=pairInfo.tgtW,tgtH=pairInfo.tgtH;var edgeDistances=edge.pstyle("edge-distances").value;var dIncludesNodeBody=edgeDistances!=="node-position";var taxiDir=edge.pstyle("taxi-direction").value;var rawTaxiDir=taxiDir;var taxiTurn=edge.pstyle("taxi-turn");var taxiTurnPfVal=taxiTurn.pfValue;var minD=edge.pstyle("taxi-turn-min-distance").pfValue;var turnIsPercent=taxiTurn.units==="%";var dw=dIncludesNodeBody?(srcW+tgtW)/2:0;var dh=dIncludesNodeBody?(srcH+tgtH)/2:0;var pdx=posPts.x2-posPts.x1;var pdy=posPts.y2-posPts.y1;var subDWH=function subDWH(dxy,dwh){if(dxy>0){return Math.max(dxy-dwh,0)}else{return Math.min(dxy+dwh,0)}};var dx=subDWH(pdx,dw);var dy=subDWH(pdy,dh);var isExplicitDir=false;if(taxiDir===AUTO){taxiDir=Math.abs(dx)>Math.abs(dy)?HORIZONTAL:VERTICAL}else if(taxiDir===UPWARD||taxiDir===DOWNWARD){taxiDir=VERTICAL;isExplicitDir=true}else if(taxiDir===LEFTWARD||taxiDir===RIGHTWARD){taxiDir=HORIZONTAL;isExplicitDir=true}var isVert=taxiDir===VERTICAL;var l=isVert?dy:dx;var pl=isVert?pdy:pdx;var sgnL=signum(pl);var forcedDir=false;if(!(isExplicitDir&&turnIsPercent)&&(rawTaxiDir===DOWNWARD&&pl<0||rawTaxiDir===UPWARD&&pl>0||rawTaxiDir===LEFTWARD&&pl>0||rawTaxiDir===RIGHTWARD&&pl<0)){sgnL*=-1;l=sgnL*Math.abs(l);forcedDir=true}var d=turnIsPercent?taxiTurnPfVal*l:taxiTurnPfVal*sgnL;var getIsTooClose=function getIsTooClose(d){return Math.abs(d)<minD||Math.abs(d)>=Math.abs(l)};var isTooCloseSrc=getIsTooClose(d);var isTooCloseTgt=getIsTooClose(l-d);var isTooClose=isTooCloseSrc||isTooCloseTgt;if(isTooClose&&!forcedDir){if(isVert){var lShapeInsideSrc=Math.abs(pl)<=srcH/2;var lShapeInsideTgt=Math.abs(pdx)<=tgtW/2;if(lShapeInsideSrc){var x=(posPts.x1+posPts.x2)/2;var y1=posPts.y1,y2=posPts.y2;rs.segpts=[x,y1,x,y2]}else if(lShapeInsideTgt){var y=(posPts.y1+posPts.y2)/2;var x1=posPts.x1,x2=posPts.x2;rs.segpts=[x1,y,x2,y]}else{rs.segpts=[posPts.x1,posPts.y2]}}else{var _lShapeInsideSrc=Math.abs(pl)<=srcW/2;var _lShapeInsideTgt=Math.abs(pdy)<=tgtH/2;if(_lShapeInsideSrc){var _y=(posPts.y1+posPts.y2)/2;var _x=posPts.x1,_x2=posPts.x2;rs.segpts=[_x,_y,_x2,_y]}else if(_lShapeInsideTgt){var _x3=(posPts.x1+posPts.x2)/2;var _y2=posPts.y1,_y3=posPts.y2;rs.segpts=[_x3,_y2,_x3,_y3]}else{rs.segpts=[posPts.x2,posPts.y1]}}}else{if(isVert){var _y4=posPts.y1+d+(dIncludesNodeBody?srcH/2*sgnL:0);var _x4=posPts.x1,_x5=posPts.x2;rs.segpts=[_x4,_y4,_x5,_y4]}else{var _x6=posPts.x1+d+(dIncludesNodeBody?srcW/2*sgnL:0);var _y5=posPts.y1,_y6=posPts.y2;rs.segpts=[_x6,_y5,_x6,_y6]}}};BRp$3.tryToCorrectInvalidPoints=function(edge,pairInfo){var rs=edge._private.rscratch;if(rs.edgeType==="bezier"){var srcPos=pairInfo.srcPos,tgtPos=pairInfo.tgtPos,srcW=pairInfo.srcW,srcH=pairInfo.srcH,tgtW=pairInfo.tgtW,tgtH=pairInfo.tgtH,srcShape=pairInfo.srcShape,tgtShape=pairInfo.tgtShape;var badStart=!number(rs.startX)||!number(rs.startY);var badAStart=!number(rs.arrowStartX)||!number(rs.arrowStartY);var badEnd=!number(rs.endX)||!number(rs.endY);var badAEnd=!number(rs.arrowEndX)||!number(rs.arrowEndY);var minCpADistFactor=3;var arrowW=this.getArrowWidth(edge.pstyle("width").pfValue,edge.pstyle("arrow-scale").value)*this.arrowShapeWidth;var minCpADist=minCpADistFactor*arrowW;var startACpDist=dist({x:rs.ctrlpts[0],y:rs.ctrlpts[1]},{x:rs.startX,y:rs.startY});var closeStartACp=startACpDist<minCpADist;var endACpDist=dist({x:rs.ctrlpts[0],y:rs.ctrlpts[1]},{x:rs.endX,y:rs.endY});var closeEndACp=endACpDist<minCpADist;var overlapping=false;if(badStart||badAStart||closeStartACp){overlapping=true;var cpD={x:rs.ctrlpts[0]-srcPos.x,y:rs.ctrlpts[1]-srcPos.y};var cpL=Math.sqrt(cpD.x*cpD.x+cpD.y*cpD.y);var cpM={x:cpD.x/cpL,y:cpD.y/cpL};var radius=Math.max(srcW,srcH);var cpProj={x:rs.ctrlpts[0]+cpM.x*2*radius,y:rs.ctrlpts[1]+cpM.y*2*radius};var srcCtrlPtIntn=srcShape.intersectLine(srcPos.x,srcPos.y,srcW,srcH,cpProj.x,cpProj.y,0);if(closeStartACp){rs.ctrlpts[0]=rs.ctrlpts[0]+cpM.x*(minCpADist-startACpDist);rs.ctrlpts[1]=rs.ctrlpts[1]+cpM.y*(minCpADist-startACpDist)}else{rs.ctrlpts[0]=srcCtrlPtIntn[0]+cpM.x*minCpADist;rs.ctrlpts[1]=srcCtrlPtIntn[1]+cpM.y*minCpADist}}if(badEnd||badAEnd||closeEndACp){overlapping=true;var _cpD={x:rs.ctrlpts[0]-tgtPos.x,y:rs.ctrlpts[1]-tgtPos.y};var _cpL=Math.sqrt(_cpD.x*_cpD.x+_cpD.y*_cpD.y);var _cpM={x:_cpD.x/_cpL,y:_cpD.y/_cpL};var _radius=Math.max(srcW,srcH);var _cpProj={x:rs.ctrlpts[0]+_cpM.x*2*_radius,y:rs.ctrlpts[1]+_cpM.y*2*_radius};var tgtCtrlPtIntn=tgtShape.intersectLine(tgtPos.x,tgtPos.y,tgtW,tgtH,_cpProj.x,_cpProj.y,0);if(closeEndACp){rs.ctrlpts[0]=rs.ctrlpts[0]+_cpM.x*(minCpADist-endACpDist);rs.ctrlpts[1]=rs.ctrlpts[1]+_cpM.y*(minCpADist-endACpDist)}else{rs.ctrlpts[0]=tgtCtrlPtIntn[0]+_cpM.x*minCpADist;rs.ctrlpts[1]=tgtCtrlPtIntn[1]+_cpM.y*minCpADist}}if(overlapping){this.findEndpoints(edge)}}};BRp$3.storeAllpts=function(edge){var rs=edge._private.rscratch;if(rs.edgeType==="multibezier"||rs.edgeType==="bezier"||rs.edgeType==="self"||rs.edgeType==="compound"){rs.allpts=[];rs.allpts.push(rs.startX,rs.startY);for(var b=0;b+1<rs.ctrlpts.length;b+=2){rs.allpts.push(rs.ctrlpts[b],rs.ctrlpts[b+1]);if(b+3<rs.ctrlpts.length){rs.allpts.push((rs.ctrlpts[b]+rs.ctrlpts[b+2])/2,(rs.ctrlpts[b+1]+rs.ctrlpts[b+3])/2)}}rs.allpts.push(rs.endX,rs.endY);var m,mt;if(rs.ctrlpts.length/2%2===0){m=rs.allpts.length/2-1;rs.midX=rs.allpts[m];rs.midY=rs.allpts[m+1]}else{m=rs.allpts.length/2-3;mt=.5;rs.midX=qbezierAt(rs.allpts[m],rs.allpts[m+2],rs.allpts[m+4],mt);rs.midY=qbezierAt(rs.allpts[m+1],rs.allpts[m+3],rs.allpts[m+5],mt)}}else if(rs.edgeType==="straight"){rs.allpts=[rs.startX,rs.startY,rs.endX,rs.endY];rs.midX=(rs.startX+rs.endX+rs.arrowStartX+rs.arrowEndX)/4;rs.midY=(rs.startY+rs.endY+rs.arrowStartY+rs.arrowEndY)/4}else if(rs.edgeType==="segments"){rs.allpts=[];rs.allpts.push(rs.startX,rs.startY);rs.allpts.push.apply(rs.allpts,rs.segpts);rs.allpts.push(rs.endX,rs.endY);if(rs.segpts.length%4===0){var i2=rs.segpts.length/2;var i1=i2-2;rs.midX=(rs.segpts[i1]+rs.segpts[i2])/2;rs.midY=(rs.segpts[i1+1]+rs.segpts[i2+1])/2}else{var _i=rs.segpts.length/2-1;rs.midX=rs.segpts[_i];rs.midY=rs.segpts[_i+1]}}};BRp$3.checkForInvalidEdgeWarning=function(edge){var rs=edge[0]._private.rscratch;if(rs.nodesOverlap||number(rs.startX)&&number(rs.startY)&&number(rs.endX)&&number(rs.endY)){rs.loggedErr=false}else{if(!rs.loggedErr){rs.loggedErr=true;warn("Edge `"+edge.id()+"` has invalid endpoints and so it is impossible to draw.  Adjust your edge style (e.g. control points) accordingly or use an alternative edge type.  This is expected behaviour when the source node and the target node overlap.")}}};BRp$3.findEdgeControlPoints=function(edges){var _this=this;if(!edges||edges.length===0){return}var r=this;var cy=r.cy;var hasCompounds=cy.hasCompoundNodes();var hashTable={map:new Map$1,get:function get(pairId){var map2=this.map.get(pairId[0]);if(map2!=null){return map2.get(pairId[1])}else{return null}},set:function set(pairId,val){var map2=this.map.get(pairId[0]);if(map2==null){map2=new Map$1;this.map.set(pairId[0],map2)}map2.set(pairId[1],val)}};var pairIds=[];var haystackEdges=[];for(var i=0;i<edges.length;i++){var edge=edges[i];var _p=edge._private;var curveStyle=edge.pstyle("curve-style").value;if(edge.removed()||!edge.takesUpSpace()){continue}if(curveStyle==="haystack"){haystackEdges.push(edge);continue}var edgeIsUnbundled=curveStyle==="unbundled-bezier"||curveStyle==="segments"||curveStyle==="straight"||curveStyle==="taxi";var edgeIsBezier=curveStyle==="unbundled-bezier"||curveStyle==="bezier";var src=_p.source;var tgt=_p.target;var srcIndex=src.poolIndex();var tgtIndex=tgt.poolIndex();var pairId=[srcIndex,tgtIndex].sort();var tableEntry=hashTable.get(pairId);if(tableEntry==null){tableEntry={eles:[]};hashTable.set(pairId,tableEntry);pairIds.push(pairId)}tableEntry.eles.push(edge);if(edgeIsUnbundled){tableEntry.hasUnbundled=true}if(edgeIsBezier){tableEntry.hasBezier=true}}var _loop=function _loop(p){var pairId=pairIds[p];var pairInfo=hashTable.get(pairId);var swappedpairInfo=void 0;if(!pairInfo.hasUnbundled){var pllEdges=pairInfo.eles[0].parallelEdges().filter((function(e){return e.isBundledBezier()}));clearArray(pairInfo.eles);pllEdges.forEach((function(edge){return pairInfo.eles.push(edge)}));pairInfo.eles.sort((function(edge1,edge2){return edge1.poolIndex()-edge2.poolIndex()}))}var firstEdge=pairInfo.eles[0];var src=firstEdge.source();var tgt=firstEdge.target();if(src.poolIndex()>tgt.poolIndex()){var temp=src;src=tgt;tgt=temp}var srcPos=pairInfo.srcPos=src.position();var tgtPos=pairInfo.tgtPos=tgt.position();var srcW=pairInfo.srcW=src.outerWidth();var srcH=pairInfo.srcH=src.outerHeight();var tgtW=pairInfo.tgtW=tgt.outerWidth();var tgtH=pairInfo.tgtH=tgt.outerHeight();var srcShape=pairInfo.srcShape=r.nodeShapes[_this.getNodeShape(src)];var tgtShape=pairInfo.tgtShape=r.nodeShapes[_this.getNodeShape(tgt)];pairInfo.dirCounts={north:0,west:0,south:0,east:0,northwest:0,southwest:0,northeast:0,southeast:0};for(var _i2=0;_i2<pairInfo.eles.length;_i2++){var _edge=pairInfo.eles[_i2];var rs=_edge[0]._private.rscratch;var _curveStyle=_edge.pstyle("curve-style").value;var _edgeIsUnbundled=_curveStyle==="unbundled-bezier"||_curveStyle==="segments"||_curveStyle==="taxi";var edgeIsSwapped=!src.same(_edge.source());if(!pairInfo.calculatedIntersection&&src!==tgt&&(pairInfo.hasBezier||pairInfo.hasUnbundled)){pairInfo.calculatedIntersection=true;var srcOutside=srcShape.intersectLine(srcPos.x,srcPos.y,srcW,srcH,tgtPos.x,tgtPos.y,0);var srcIntn=pairInfo.srcIntn=srcOutside;var tgtOutside=tgtShape.intersectLine(tgtPos.x,tgtPos.y,tgtW,tgtH,srcPos.x,srcPos.y,0);var tgtIntn=pairInfo.tgtIntn=tgtOutside;var intersectionPts=pairInfo.intersectionPts={x1:srcOutside[0],x2:tgtOutside[0],y1:srcOutside[1],y2:tgtOutside[1]};var posPts=pairInfo.posPts={x1:srcPos.x,x2:tgtPos.x,y1:srcPos.y,y2:tgtPos.y};var dy=tgtOutside[1]-srcOutside[1];var dx=tgtOutside[0]-srcOutside[0];var l=Math.sqrt(dx*dx+dy*dy);var vector=pairInfo.vector={x:dx,y:dy};var vectorNorm=pairInfo.vectorNorm={x:vector.x/l,y:vector.y/l};var vectorNormInverse={x:-vectorNorm.y,y:vectorNorm.x};pairInfo.nodesOverlap=!number(l)||tgtShape.checkPoint(srcOutside[0],srcOutside[1],0,tgtW,tgtH,tgtPos.x,tgtPos.y)||srcShape.checkPoint(tgtOutside[0],tgtOutside[1],0,srcW,srcH,srcPos.x,srcPos.y);pairInfo.vectorNormInverse=vectorNormInverse;swappedpairInfo={nodesOverlap:pairInfo.nodesOverlap,dirCounts:pairInfo.dirCounts,calculatedIntersection:true,hasBezier:pairInfo.hasBezier,hasUnbundled:pairInfo.hasUnbundled,eles:pairInfo.eles,srcPos:tgtPos,tgtPos:srcPos,srcW:tgtW,srcH:tgtH,tgtW:srcW,tgtH:srcH,srcIntn:tgtIntn,tgtIntn:srcIntn,srcShape:tgtShape,tgtShape:srcShape,posPts:{x1:posPts.x2,y1:posPts.y2,x2:posPts.x1,y2:posPts.y1},intersectionPts:{x1:intersectionPts.x2,y1:intersectionPts.y2,x2:intersectionPts.x1,y2:intersectionPts.y1},vector:{x:-vector.x,y:-vector.y},vectorNorm:{x:-vectorNorm.x,y:-vectorNorm.y},vectorNormInverse:{x:-vectorNormInverse.x,y:-vectorNormInverse.y}}}var passedPairInfo=edgeIsSwapped?swappedpairInfo:pairInfo;rs.nodesOverlap=passedPairInfo.nodesOverlap;rs.srcIntn=passedPairInfo.srcIntn;rs.tgtIntn=passedPairInfo.tgtIntn;if(hasCompounds&&(src.isParent()||src.isChild()||tgt.isParent()||tgt.isChild())&&(src.parents().anySame(tgt)||tgt.parents().anySame(src)||src.same(tgt)&&src.isParent())){_this.findCompoundLoopPoints(_edge,passedPairInfo,_i2,_edgeIsUnbundled)}else if(src===tgt){_this.findLoopPoints(_edge,passedPairInfo,_i2,_edgeIsUnbundled)}else if(_curveStyle==="segments"){_this.findSegmentsPoints(_edge,passedPairInfo)}else if(_curveStyle==="taxi"){_this.findTaxiPoints(_edge,passedPairInfo)}else if(_curveStyle==="straight"||!_edgeIsUnbundled&&pairInfo.eles.length%2===1&&_i2===Math.floor(pairInfo.eles.length/2)){_this.findStraightEdgePoints(_edge)}else{_this.findBezierPoints(_edge,passedPairInfo,_i2,_edgeIsUnbundled,edgeIsSwapped)}_this.findEndpoints(_edge);_this.tryToCorrectInvalidPoints(_edge,passedPairInfo);_this.checkForInvalidEdgeWarning(_edge);_this.storeAllpts(_edge);_this.storeEdgeProjections(_edge);_this.calculateArrowAngles(_edge);_this.recalculateEdgeLabelProjections(_edge);_this.calculateLabelAngles(_edge)}};for(var p=0;p<pairIds.length;p++){_loop(p)}this.findHaystackPoints(haystackEdges)};function getPts(pts){var retPts=[];if(pts==null){return}for(var i=0;i<pts.length;i+=2){var x=pts[i];var y=pts[i+1];retPts.push({x:x,y:y})}return retPts}BRp$3.getSegmentPoints=function(edge){var rs=edge[0]._private.rscratch;var type=rs.edgeType;if(type==="segments"){this.recalculateRenderedStyle(edge);return getPts(rs.segpts)}};BRp$3.getControlPoints=function(edge){var rs=edge[0]._private.rscratch;var type=rs.edgeType;if(type==="bezier"||type==="multibezier"||type==="self"||type==="compound"){this.recalculateRenderedStyle(edge);return getPts(rs.ctrlpts)}};BRp$3.getEdgeMidpoint=function(edge){var rs=edge[0]._private.rscratch;this.recalculateRenderedStyle(edge);return{x:rs.midX,y:rs.midY}};var BRp$4={};BRp$4.manualEndptToPx=function(node,prop){var r=this;var npos=node.position();var w=node.outerWidth();var h=node.outerHeight();if(prop.value.length===2){var p=[prop.pfValue[0],prop.pfValue[1]];if(prop.units[0]==="%"){p[0]=p[0]*w}if(prop.units[1]==="%"){p[1]=p[1]*h}p[0]+=npos.x;p[1]+=npos.y;return p}else{var angle=prop.pfValue[0];angle=-Math.PI/2+angle;var l=2*Math.max(w,h);var _p=[npos.x+Math.cos(angle)*l,npos.y+Math.sin(angle)*l];return r.nodeShapes[this.getNodeShape(node)].intersectLine(npos.x,npos.y,w,h,_p[0],_p[1],0)}};BRp$4.findEndpoints=function(edge){var r=this;var intersect;var source=edge.source()[0];var target=edge.target()[0];var srcPos=source.position();var tgtPos=target.position();var tgtArShape=edge.pstyle("target-arrow-shape").value;var srcArShape=edge.pstyle("source-arrow-shape").value;var tgtDist=edge.pstyle("target-distance-from-node").pfValue;var srcDist=edge.pstyle("source-distance-from-node").pfValue;var curveStyle=edge.pstyle("curve-style").value;var rs=edge._private.rscratch;var et=rs.edgeType;var taxi=curveStyle==="taxi";var self=et==="self"||et==="compound";var bezier=et==="bezier"||et==="multibezier"||self;var multi=et!=="bezier";var lines=et==="straight"||et==="segments";var segments=et==="segments";var hasEndpts=bezier||multi||lines;var overrideEndpts=self||taxi;var srcManEndpt=edge.pstyle("source-endpoint");var srcManEndptVal=overrideEndpts?"outside-to-node":srcManEndpt.value;var tgtManEndpt=edge.pstyle("target-endpoint");var tgtManEndptVal=overrideEndpts?"outside-to-node":tgtManEndpt.value;rs.srcManEndpt=srcManEndpt;rs.tgtManEndpt=tgtManEndpt;var p1;var p2;var p1_i;var p2_i;if(bezier){var cpStart=[rs.ctrlpts[0],rs.ctrlpts[1]];var cpEnd=multi?[rs.ctrlpts[rs.ctrlpts.length-2],rs.ctrlpts[rs.ctrlpts.length-1]]:cpStart;p1=cpEnd;p2=cpStart}else if(lines){var srcArrowFromPt=!segments?[tgtPos.x,tgtPos.y]:rs.segpts.slice(0,2);var tgtArrowFromPt=!segments?[srcPos.x,srcPos.y]:rs.segpts.slice(rs.segpts.length-2);p1=tgtArrowFromPt;p2=srcArrowFromPt}if(tgtManEndptVal==="inside-to-node"){intersect=[tgtPos.x,tgtPos.y]}else if(tgtManEndpt.units){intersect=this.manualEndptToPx(target,tgtManEndpt)}else if(tgtManEndptVal==="outside-to-line"){intersect=rs.tgtIntn}else{if(tgtManEndptVal==="outside-to-node"||tgtManEndptVal==="outside-to-node-or-label"){p1_i=p1}else if(tgtManEndptVal==="outside-to-line"||tgtManEndptVal==="outside-to-line-or-label"){p1_i=[srcPos.x,srcPos.y]}intersect=r.nodeShapes[this.getNodeShape(target)].intersectLine(tgtPos.x,tgtPos.y,target.outerWidth(),target.outerHeight(),p1_i[0],p1_i[1],0);if(tgtManEndptVal==="outside-to-node-or-label"||tgtManEndptVal==="outside-to-line-or-label"){var trs=target._private.rscratch;var lw=trs.labelWidth;var lh=trs.labelHeight;var lx=trs.labelX;var ly=trs.labelY;var va=target.pstyle("text-valign").value;if(va==="top"){ly-=lh/2}else if(va==="bottom"){ly+=lh/2}var ha=target.pstyle("text-halign").value;if(ha==="left"){lx-=lw/2}else if(ha==="right"){lx+=lw/2}var labelIntersect=r.nodeShapes["rectangle"].intersectLine(lx,ly,lw,lh,p1_i[0],p1_i[1],0);var refPt=srcPos;var intSqdist=sqdist(refPt,array2point(intersect));var labIntSqdist=sqdist(refPt,array2point(labelIntersect));if(labIntSqdist<intSqdist){intersect=labelIntersect}}}var arrowEnd=shortenIntersection(intersect,p1,r.arrowShapes[tgtArShape].spacing(edge)+tgtDist);var edgeEnd=shortenIntersection(intersect,p1,r.arrowShapes[tgtArShape].gap(edge)+tgtDist);rs.endX=edgeEnd[0];rs.endY=edgeEnd[1];rs.arrowEndX=arrowEnd[0];rs.arrowEndY=arrowEnd[1];if(srcManEndptVal==="inside-to-node"){intersect=[srcPos.x,srcPos.y]}else if(srcManEndpt.units){intersect=this.manualEndptToPx(source,srcManEndpt)}else if(srcManEndptVal==="outside-to-line"){intersect=rs.srcIntn}else{if(srcManEndptVal==="outside-to-node"||srcManEndptVal==="outside-to-node-or-label"){p2_i=p2}else if(srcManEndptVal==="outside-to-line"||srcManEndptVal==="outside-to-line-or-label"){p2_i=[tgtPos.x,tgtPos.y]}intersect=r.nodeShapes[this.getNodeShape(source)].intersectLine(srcPos.x,srcPos.y,source.outerWidth(),source.outerHeight(),p2_i[0],p2_i[1],0);if(srcManEndptVal==="outside-to-node-or-label"||srcManEndptVal==="outside-to-line-or-label"){var srs=source._private.rscratch;var _lw=srs.labelWidth;var _lh=srs.labelHeight;var _lx=srs.labelX;var _ly=srs.labelY;var _va=source.pstyle("text-valign").value;if(_va==="top"){_ly-=_lh/2}else if(_va==="bottom"){_ly+=_lh/2}var _ha=source.pstyle("text-halign").value;if(_ha==="left"){_lx-=_lw/2}else if(_ha==="right"){_lx+=_lw/2}var _labelIntersect=r.nodeShapes["rectangle"].intersectLine(_lx,_ly,_lw,_lh,p2_i[0],p2_i[1],0);var _refPt=tgtPos;var _intSqdist=sqdist(_refPt,array2point(intersect));var _labIntSqdist=sqdist(_refPt,array2point(_labelIntersect));if(_labIntSqdist<_intSqdist){intersect=_labelIntersect}}}var arrowStart=shortenIntersection(intersect,p2,r.arrowShapes[srcArShape].spacing(edge)+srcDist);var edgeStart=shortenIntersection(intersect,p2,r.arrowShapes[srcArShape].gap(edge)+srcDist);rs.startX=edgeStart[0];rs.startY=edgeStart[1];rs.arrowStartX=arrowStart[0];rs.arrowStartY=arrowStart[1];if(hasEndpts){if(!number(rs.startX)||!number(rs.startY)||!number(rs.endX)||!number(rs.endY)){rs.badLine=true}else{rs.badLine=false}}};BRp$4.getSourceEndpoint=function(edge){var rs=edge[0]._private.rscratch;this.recalculateRenderedStyle(edge);switch(rs.edgeType){case"haystack":return{x:rs.haystackPts[0],y:rs.haystackPts[1]};default:return{x:rs.arrowStartX,y:rs.arrowStartY}}};BRp$4.getTargetEndpoint=function(edge){var rs=edge[0]._private.rscratch;this.recalculateRenderedStyle(edge);switch(rs.edgeType){case"haystack":return{x:rs.haystackPts[2],y:rs.haystackPts[3]};default:return{x:rs.arrowEndX,y:rs.arrowEndY}}};var BRp$5={};function pushBezierPts(r,edge,pts){var qbezierAt$1=function qbezierAt$1(p1,p2,p3,t){return qbezierAt(p1,p2,p3,t)};var _p=edge._private;var bpts=_p.rstyle.bezierPts;for(var i=0;i<r.bezierProjPcts.length;i++){var p=r.bezierProjPcts[i];bpts.push({x:qbezierAt$1(pts[0],pts[2],pts[4],p),y:qbezierAt$1(pts[1],pts[3],pts[5],p)})}}BRp$5.storeEdgeProjections=function(edge){var _p=edge._private;var rs=_p.rscratch;var et=rs.edgeType;_p.rstyle.bezierPts=null;_p.rstyle.linePts=null;_p.rstyle.haystackPts=null;if(et==="multibezier"||et==="bezier"||et==="self"||et==="compound"){_p.rstyle.bezierPts=[];for(var i=0;i+5<rs.allpts.length;i+=4){pushBezierPts(this,edge,rs.allpts.slice(i,i+6))}}else if(et==="segments"){var lpts=_p.rstyle.linePts=[];for(var i=0;i+1<rs.allpts.length;i+=2){lpts.push({x:rs.allpts[i],y:rs.allpts[i+1]})}}else if(et==="haystack"){var hpts=rs.haystackPts;_p.rstyle.haystackPts=[{x:hpts[0],y:hpts[1]},{x:hpts[2],y:hpts[3]}]}_p.rstyle.arrowWidth=this.getArrowWidth(edge.pstyle("width").pfValue,edge.pstyle("arrow-scale").value)*this.arrowShapeWidth};BRp$5.recalculateEdgeProjections=function(edges){this.findEdgeControlPoints(edges)};var BRp$6={};BRp$6.recalculateNodeLabelProjection=function(node){var content=node.pstyle("label").strValue;if(emptyString(content)){return}var textX,textY;var _p=node._private;var nodeWidth=node.width();var nodeHeight=node.height();var padding=node.padding();var nodePos=node.position();var textHalign=node.pstyle("text-halign").strValue;var textValign=node.pstyle("text-valign").strValue;var rs=_p.rscratch;var rstyle=_p.rstyle;switch(textHalign){case"left":textX=nodePos.x-nodeWidth/2-padding;break;case"right":textX=nodePos.x+nodeWidth/2+padding;break;default:textX=nodePos.x}switch(textValign){case"top":textY=nodePos.y-nodeHeight/2-padding;break;case"bottom":textY=nodePos.y+nodeHeight/2+padding;break;default:textY=nodePos.y}rs.labelX=textX;rs.labelY=textY;rstyle.labelX=textX;rstyle.labelY=textY;this.applyLabelDimensions(node)};var lineAngleFromDelta=function lineAngleFromDelta(dx,dy){var angle=Math.atan(dy/dx);if(dx===0&&angle<0){angle=angle*-1}return angle};var lineAngle=function lineAngle(p0,p1){var dx=p1.x-p0.x;var dy=p1.y-p0.y;return lineAngleFromDelta(dx,dy)};var bezierAngle=function bezierAngle(p0,p1,p2,t){var t0=bound(0,t-.001,1);var t1=bound(0,t+.001,1);var lp0=qbezierPtAt(p0,p1,p2,t0);var lp1=qbezierPtAt(p0,p1,p2,t1);return lineAngle(lp0,lp1)};BRp$6.recalculateEdgeLabelProjections=function(edge){var p;var _p=edge._private;var rs=_p.rscratch;var r=this;var content={mid:edge.pstyle("label").strValue,source:edge.pstyle("source-label").strValue,target:edge.pstyle("target-label").strValue};if(content.mid||content.source||content.target);else{return}p={x:rs.midX,y:rs.midY};var setRs=function setRs(propName,prefix,value){setPrefixedProperty(_p.rscratch,propName,prefix,value);setPrefixedProperty(_p.rstyle,propName,prefix,value)};setRs("labelX",null,p.x);setRs("labelY",null,p.y);var midAngle=lineAngleFromDelta(rs.midDispX,rs.midDispY);setRs("labelAutoAngle",null,midAngle);var createControlPointInfo=function createControlPointInfo(){if(createControlPointInfo.cache){return createControlPointInfo.cache}var ctrlpts=[];for(var i=0;i+5<rs.allpts.length;i+=4){var p0={x:rs.allpts[i],y:rs.allpts[i+1]};var p1={x:rs.allpts[i+2],y:rs.allpts[i+3]};var p2={x:rs.allpts[i+4],y:rs.allpts[i+5]};ctrlpts.push({p0:p0,p1:p1,p2:p2,startDist:0,length:0,segments:[]})}var bpts=_p.rstyle.bezierPts;var nProjs=r.bezierProjPcts.length;function addSegment(cp,p0,p1,t0,t1){var length=dist(p0,p1);var prevSegment=cp.segments[cp.segments.length-1];var segment={p0:p0,p1:p1,t0:t0,t1:t1,startDist:prevSegment?prevSegment.startDist+prevSegment.length:0,length:length};cp.segments.push(segment);cp.length+=length}for(var _i=0;_i<ctrlpts.length;_i++){var cp=ctrlpts[_i];var prevCp=ctrlpts[_i-1];if(prevCp){cp.startDist=prevCp.startDist+prevCp.length}addSegment(cp,cp.p0,bpts[_i*nProjs],0,r.bezierProjPcts[0]);for(var j=0;j<nProjs-1;j++){addSegment(cp,bpts[_i*nProjs+j],bpts[_i*nProjs+j+1],r.bezierProjPcts[j],r.bezierProjPcts[j+1])}addSegment(cp,bpts[_i*nProjs+nProjs-1],cp.p2,r.bezierProjPcts[nProjs-1],1)}return createControlPointInfo.cache=ctrlpts};var calculateEndProjection=function calculateEndProjection(prefix){var angle;var isSrc=prefix==="source";if(!content[prefix]){return}var offset=edge.pstyle(prefix+"-text-offset").pfValue;switch(rs.edgeType){case"self":case"compound":case"bezier":case"multibezier":{var cps=createControlPointInfo();var selected;var startDist=0;var totalDist=0;for(var i=0;i<cps.length;i++){var _cp=cps[isSrc?i:cps.length-1-i];for(var j=0;j<_cp.segments.length;j++){var _seg=_cp.segments[isSrc?j:_cp.segments.length-1-j];var lastSeg=i===cps.length-1&&j===_cp.segments.length-1;startDist=totalDist;totalDist+=_seg.length;if(totalDist>=offset||lastSeg){selected={cp:_cp,segment:_seg};break}}if(selected){break}}var cp=selected.cp;var seg=selected.segment;var tSegment=(offset-startDist)/seg.length;var segDt=seg.t1-seg.t0;var t=isSrc?seg.t0+segDt*tSegment:seg.t1-segDt*tSegment;t=bound(0,t,1);p=qbezierPtAt(cp.p0,cp.p1,cp.p2,t);angle=bezierAngle(cp.p0,cp.p1,cp.p2,t);break}case"straight":case"segments":case"haystack":{var d=0,di,d0;var p0,p1;var l=rs.allpts.length;for(var _i2=0;_i2+3<l;_i2+=2){if(isSrc){p0={x:rs.allpts[_i2],y:rs.allpts[_i2+1]};p1={x:rs.allpts[_i2+2],y:rs.allpts[_i2+3]}}else{p0={x:rs.allpts[l-2-_i2],y:rs.allpts[l-1-_i2]};p1={x:rs.allpts[l-4-_i2],y:rs.allpts[l-3-_i2]}}di=dist(p0,p1);d0=d;d+=di;if(d>=offset){break}}var pD=offset-d0;var _t=pD/di;_t=bound(0,_t,1);p=lineAt(p0,p1,_t);angle=lineAngle(p0,p1);break}}setRs("labelX",prefix,p.x);setRs("labelY",prefix,p.y);setRs("labelAutoAngle",prefix,angle)};calculateEndProjection("source");calculateEndProjection("target");this.applyLabelDimensions(edge)};BRp$6.applyLabelDimensions=function(ele){this.applyPrefixedLabelDimensions(ele);if(ele.isEdge()){this.applyPrefixedLabelDimensions(ele,"source");this.applyPrefixedLabelDimensions(ele,"target")}};BRp$6.applyPrefixedLabelDimensions=function(ele,prefix){var _p=ele._private;var text=this.getLabelText(ele,prefix);var labelDims=this.calculateLabelDimensions(ele,text);var lineHeight=ele.pstyle("line-height").pfValue;var textWrap=ele.pstyle("text-wrap").strValue;var lines=getPrefixedProperty(_p.rscratch,"labelWrapCachedLines",prefix)||[];var numLines=textWrap!=="wrap"?1:Math.max(lines.length,1);var normPerLineHeight=labelDims.height/numLines;var labelLineHeight=normPerLineHeight*lineHeight;var width=labelDims.width;var height=labelDims.height+(numLines-1)*(lineHeight-1)*normPerLineHeight;setPrefixedProperty(_p.rstyle,"labelWidth",prefix,width);setPrefixedProperty(_p.rscratch,"labelWidth",prefix,width);setPrefixedProperty(_p.rstyle,"labelHeight",prefix,height);setPrefixedProperty(_p.rscratch,"labelHeight",prefix,height);setPrefixedProperty(_p.rscratch,"labelLineHeight",prefix,labelLineHeight)};BRp$6.getLabelText=function(ele,prefix){var _p=ele._private;var pfd=prefix?prefix+"-":"";var text=ele.pstyle(pfd+"label").strValue;var textTransform=ele.pstyle("text-transform").value;var rscratch=function rscratch(propName,value){if(value){setPrefixedProperty(_p.rscratch,propName,prefix,value);return value}else{return getPrefixedProperty(_p.rscratch,propName,prefix)}};if(!text){return""}if(textTransform=="none");else if(textTransform=="uppercase"){text=text.toUpperCase()}else if(textTransform=="lowercase"){text=text.toLowerCase()}var wrapStyle=ele.pstyle("text-wrap").value;if(wrapStyle==="wrap"){var labelKey=rscratch("labelKey");if(labelKey!=null&&rscratch("labelWrapKey")===labelKey){return rscratch("labelWrapCachedText")}var zwsp="​";var lines=text.split("\n");var maxW=ele.pstyle("text-max-width").pfValue;var overflow=ele.pstyle("text-overflow-wrap").value;var overflowAny=overflow==="anywhere";var wrappedLines=[];var wordsRegex=/[\s\u200b]+/;var wordSeparator=overflowAny?"":" ";for(var l=0;l<lines.length;l++){var line=lines[l];var lineDims=this.calculateLabelDimensions(ele,line);var lineW=lineDims.width;if(overflowAny){var processedLine=line.split("").join(zwsp);line=processedLine}if(lineW>maxW){var words=line.split(wordsRegex);var subline="";for(var w=0;w<words.length;w++){var word=words[w];var testLine=subline.length===0?word:subline+wordSeparator+word;var testDims=this.calculateLabelDimensions(ele,testLine);var testW=testDims.width;if(testW<=maxW){subline+=word+wordSeparator}else{wrappedLines.push(subline);subline=word+wordSeparator}}if(!subline.match(/^[\s\u200b]+$/)){wrappedLines.push(subline)}}else{wrappedLines.push(line)}}rscratch("labelWrapCachedLines",wrappedLines);text=rscratch("labelWrapCachedText",wrappedLines.join("\n"));rscratch("labelWrapKey",labelKey)}else if(wrapStyle==="ellipsis"){var _maxW=ele.pstyle("text-max-width").pfValue;var ellipsized="";var ellipsis="…";var incLastCh=false;for(var i=0;i<text.length;i++){var widthWithNextCh=this.calculateLabelDimensions(ele,ellipsized+text[i]+ellipsis).width;if(widthWithNextCh>_maxW){break}ellipsized+=text[i];if(i===text.length-1){incLastCh=true}}if(!incLastCh){ellipsized+=ellipsis}return ellipsized}return text};BRp$6.getLabelJustification=function(ele){var justification=ele.pstyle("text-justification").strValue;var textHalign=ele.pstyle("text-halign").strValue;if(justification==="auto"){if(ele.isNode()){switch(textHalign){case"left":return"right";case"right":return"left";default:return"center"}}else{return"center"}}else{return justification}};BRp$6.calculateLabelDimensions=function(ele,text){var r=this;var cacheKey=hashString(text,ele._private.labelDimsKey);var cache=r.labelDimCache||(r.labelDimCache=[]);var existingVal=cache[cacheKey];if(existingVal!=null){return existingVal}var sizeMult=1;var fStyle=ele.pstyle("font-style").strValue;var size=sizeMult*ele.pstyle("font-size").pfValue+"px";var family=ele.pstyle("font-family").strValue;var weight=ele.pstyle("font-weight").strValue;var div=this.labelCalcDiv;if(!div){div=this.labelCalcDiv=document.createElement("div");document.body.appendChild(div)}var ds=div.style;ds.fontFamily=family;ds.fontStyle=fStyle;ds.fontSize=size;ds.fontWeight=weight;ds.position="absolute";ds.left="-9999px";ds.top="-9999px";ds.zIndex="-1";ds.visibility="hidden";ds.pointerEvents="none";ds.padding="0";ds.lineHeight="1";if(ele.pstyle("text-wrap").value==="wrap"){ds.whiteSpace="pre"}else{ds.whiteSpace="normal"}div.textContent=text;return cache[cacheKey]={width:Math.ceil(div.clientWidth/sizeMult),height:Math.ceil(div.clientHeight/sizeMult)}};BRp$6.calculateLabelAngle=function(ele,prefix){var _p=ele._private;var rs=_p.rscratch;var isEdge=ele.isEdge();var prefixDash=prefix?prefix+"-":"";var rot=ele.pstyle(prefixDash+"text-rotation");var rotStr=rot.strValue;if(rotStr==="none"){return 0}else if(isEdge&&rotStr==="autorotate"){return rs.labelAutoAngle}else if(rotStr==="autorotate"){return 0}else{return rot.pfValue}};BRp$6.calculateLabelAngles=function(ele){var r=this;var isEdge=ele.isEdge();var _p=ele._private;var rs=_p.rscratch;rs.labelAngle=r.calculateLabelAngle(ele);if(isEdge){rs.sourceLabelAngle=r.calculateLabelAngle(ele,"source");rs.targetLabelAngle=r.calculateLabelAngle(ele,"target")}};var BRp$7={};var TOO_SMALL_CUT_RECT=28;var warnedCutRect=false;BRp$7.getNodeShape=function(node){var r=this;var shape=node.pstyle("shape").value;if(shape==="cutrectangle"&&(node.width()<TOO_SMALL_CUT_RECT||node.height()<TOO_SMALL_CUT_RECT)){if(!warnedCutRect){warn("The `cutrectangle` node shape can not be used at small sizes so `rectangle` is used instead");warnedCutRect=true}return"rectangle"}if(node.isParent()){if(shape==="rectangle"||shape==="roundrectangle"||shape==="cutrectangle"||shape==="barrel"){return shape}else{return"rectangle"}}if(shape==="polygon"){var points=node.pstyle("shape-polygon-points").value;return r.nodeShapes.makePolygon(points).name}return shape};var BRp$8={};BRp$8.registerCalculationListeners=function(){var cy=this.cy;var elesToUpdate=cy.collection();var r=this;var enqueue=function enqueue(eles){var dirtyStyleCaches=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;elesToUpdate.merge(eles);if(dirtyStyleCaches){for(var i=0;i<eles.length;i++){var ele=eles[i];var _p=ele._private;var rstyle=_p.rstyle;rstyle.clean=false;rstyle.cleanConnected=false}}};r.binder(cy).on("bounds.* dirty.*",(function onDirtyBounds(e){var ele=e.target;enqueue(ele)})).on("style.* background.*",(function onDirtyStyle(e){var ele=e.target;enqueue(ele,false)}));var updateEleCalcs=function updateEleCalcs(willDraw){if(willDraw){var fns=r.onUpdateEleCalcsFns;for(var i=0;i<elesToUpdate.length;i++){var ele=elesToUpdate[i];var rstyle=ele._private.rstyle;if(ele.isNode()&&!rstyle.cleanConnected){enqueue(ele.connectedEdges());rstyle.cleanConnected=true}}if(fns){for(var i=0;i<fns.length;i++){var fn=fns[i];fn(willDraw,elesToUpdate)}}r.recalculateRenderedStyle(elesToUpdate);elesToUpdate=cy.collection()}};r.flushRenderedStyleQueue=function(){updateEleCalcs(true)};r.beforeRender(updateEleCalcs,r.beforeRenderPriorities.eleCalcs)};BRp$8.onUpdateEleCalcs=function(fn){var fns=this.onUpdateEleCalcsFns=this.onUpdateEleCalcsFns||[];fns.push(fn)};BRp$8.recalculateRenderedStyle=function(eles,useCache){var edges=[];var nodes=[];if(this.destroyed){return}if(useCache===undefined){useCache=true}for(var i=0;i<eles.length;i++){var ele=eles[i];var _p=ele._private;var rstyle=_p.rstyle;if(useCache&&rstyle.clean||ele.removed()){continue}if(ele.pstyle("display").value==="none"){continue}if(_p.group==="nodes"){nodes.push(ele)}else{edges.push(ele)}rstyle.clean=true}for(var i=0;i<nodes.length;i++){var ele=nodes[i];var _p=ele._private;var rstyle=_p.rstyle;var pos=ele.position();this.recalculateNodeLabelProjection(ele);rstyle.nodeX=pos.x;rstyle.nodeY=pos.y;rstyle.nodeW=ele.pstyle("width").pfValue;rstyle.nodeH=ele.pstyle("height").pfValue}this.recalculateEdgeProjections(edges);for(var i=0;i<edges.length;i++){var ele=edges[i];var _p=ele._private;var rstyle=_p.rstyle;var rs=_p.rscratch;rstyle.srcX=rs.arrowStartX;rstyle.srcY=rs.arrowStartY;rstyle.tgtX=rs.arrowEndX;rstyle.tgtY=rs.arrowEndY;rstyle.midX=rs.midX;rstyle.midY=rs.midY;rstyle.labelAngle=rs.labelAngle;rstyle.sourceLabelAngle=rs.sourceLabelAngle;rstyle.targetLabelAngle=rs.targetLabelAngle}};var BRp$9={};BRp$9.updateCachedGrabbedEles=function(){var eles=this.cachedZSortedEles;if(!eles){return}eles.drag=[];eles.nondrag=[];var grabTargets=[];for(var i=0;i<eles.length;i++){var ele=eles[i];var rs=ele._private.rscratch;if(ele.grabbed()&&!ele.isParent()){grabTargets.push(ele)}else if(rs.inDragLayer){eles.drag.push(ele)}else{eles.nondrag.push(ele)}}for(var i=0;i<grabTargets.length;i++){var ele=grabTargets[i];eles.drag.push(ele)}};BRp$9.invalidateCachedZSortedEles=function(){this.cachedZSortedEles=null};BRp$9.getCachedZSortedEles=function(forceRecalc){if(forceRecalc||!this.cachedZSortedEles){var eles=this.cy.mutableElements().toArray();eles.sort(zIndexSort);eles.interactive=eles.filter((function(ele){return ele.interactive()}));this.cachedZSortedEles=eles;this.updateCachedGrabbedEles()}else{eles=this.cachedZSortedEles}return eles};var BRp$a={};[BRp$1,BRp$2,BRp$3,BRp$4,BRp$5,BRp$6,BRp$7,BRp$8,BRp$9].forEach((function(props){extend(BRp$a,props)}));var BRp$b={};BRp$b.getCachedImage=function(url,crossOrigin,onLoad){var r=this;var imageCache=r.imageCache=r.imageCache||{};var cache=imageCache[url];if(cache){if(!cache.image.complete){cache.image.addEventListener("load",onLoad)}return cache.image}else{cache=imageCache[url]=imageCache[url]||{};var image=cache.image=new Image;image.addEventListener("load",onLoad);image.addEventListener("error",(function(){image.error=true}));var dataUriPrefix="data:";var isDataUri=url.substring(0,dataUriPrefix.length).toLowerCase()===dataUriPrefix;if(!isDataUri){image.crossOrigin=crossOrigin}image.src=url;return image}};var BRp$c={};BRp$c.registerBinding=function(target,event,handler,useCapture){var args=Array.prototype.slice.apply(arguments,[1]);var b=this.binder(target);return b.on.apply(b,args)};BRp$c.binder=function(tgt){var r=this;var tgtIsDom=tgt===window||tgt===document||tgt===document.body||domElement(tgt);if(r.supportsPassiveEvents==null){var supportsPassive=false;try{var opts=Object.defineProperty({},"passive",{get:function get(){supportsPassive=true;return true}});window.addEventListener("test",null,opts)}catch(err){}r.supportsPassiveEvents=supportsPassive}var on=function on(event,handler,useCapture){var args=Array.prototype.slice.call(arguments);if(tgtIsDom&&r.supportsPassiveEvents){args[2]={capture:useCapture!=null?useCapture:false,passive:false,once:false}}r.bindings.push({target:tgt,args:args});(tgt.addEventListener||tgt.on).apply(tgt,args);return this};return{on:on,addEventListener:on,addListener:on,bind:on}};BRp$c.nodeIsDraggable=function(node){return node&&node.isNode()&&!node.locked()&&node.grabbable()};BRp$c.nodeIsGrabbable=function(node){return this.nodeIsDraggable(node)&&node.interactive()};BRp$c.load=function(){var r=this;var isSelected=function isSelected(ele){return ele.selected()};var triggerEvents=function triggerEvents(target,names,e,position){if(target==null){target=r.cy}for(var i=0;i<names.length;i++){var name=names[i];target.emit({originalEvent:e,type:name,position:position})}};var isMultSelKeyDown=function isMultSelKeyDown(e){return e.shiftKey||e.metaKey||e.ctrlKey};var allowPanningPassthrough=function allowPanningPassthrough(down,downs){var allowPassthrough=true;if(r.cy.hasCompoundNodes()&&down&&down.pannable()){for(var i=0;downs&&i<downs.length;i++){var down=downs[i];if(down.isNode()&&down.isParent()){allowPassthrough=false;break}}}else{allowPassthrough=true}return allowPassthrough};var setGrabbed=function setGrabbed(ele){ele[0]._private.grabbed=true};var setFreed=function setFreed(ele){ele[0]._private.grabbed=false};var setInDragLayer=function setInDragLayer(ele){ele[0]._private.rscratch.inDragLayer=true};var setOutDragLayer=function setOutDragLayer(ele){ele[0]._private.rscratch.inDragLayer=false};var setGrabTarget=function setGrabTarget(ele){ele[0]._private.rscratch.isGrabTarget=true};var removeGrabTarget=function removeGrabTarget(ele){ele[0]._private.rscratch.isGrabTarget=false};var addToDragList=function addToDragList(ele,opts){var list=opts.addToList;var listHasEle=list.has(ele);if(!listHasEle){list.merge(ele);setGrabbed(ele)}};var addDescendantsToDrag=function addDescendantsToDrag(node,opts){if(!node.cy().hasCompoundNodes()){return}if(opts.inDragLayer==null&&opts.addToList==null){return}var innerNodes=node.descendants();if(opts.inDragLayer){innerNodes.forEach(setInDragLayer);innerNodes.connectedEdges().forEach(setInDragLayer)}if(opts.addToList){opts.addToList.unmerge(innerNodes)}};var addNodesToDrag=function addNodesToDrag(nodes,opts){opts=opts||{};var hasCompoundNodes=nodes.cy().hasCompoundNodes();if(opts.inDragLayer){nodes.forEach(setInDragLayer);nodes.neighborhood().stdFilter((function(ele){return!hasCompoundNodes||ele.isEdge()})).forEach(setInDragLayer)}if(opts.addToList){nodes.forEach((function(ele){addToDragList(ele,opts)}))}addDescendantsToDrag(nodes,opts);updateAncestorsInDragLayer(nodes,{inDragLayer:opts.inDragLayer});r.updateCachedGrabbedEles()};var addNodeToDrag=addNodesToDrag;var freeDraggedElements=function freeDraggedElements(grabbedEles){if(!grabbedEles){return}r.getCachedZSortedEles().forEach((function(ele){setFreed(ele);setOutDragLayer(ele);removeGrabTarget(ele)}));r.updateCachedGrabbedEles()};var updateAncestorsInDragLayer=function updateAncestorsInDragLayer(node,opts){if(opts.inDragLayer==null&&opts.addToList==null){return}if(!node.cy().hasCompoundNodes()){return}var parent=node.ancestors().orphans();if(parent.same(node)){return}var nodes=parent.descendants().spawnSelf().merge(parent).unmerge(node).unmerge(node.descendants());var edges=nodes.connectedEdges();if(opts.inDragLayer){edges.forEach(setInDragLayer);nodes.forEach(setInDragLayer)}if(opts.addToList){nodes.forEach((function(ele){addToDragList(ele,opts)}))}};var blurActiveDomElement=function blurActiveDomElement(){if(document.activeElement!=null&&document.activeElement.blur!=null){document.activeElement.blur()}};var haveMutationsApi=typeof MutationObserver!=="undefined";var haveResizeObserverApi=typeof ResizeObserver!=="undefined";if(haveMutationsApi){r.removeObserver=new MutationObserver((function(mutns){for(var i=0;i<mutns.length;i++){var mutn=mutns[i];var rNodes=mutn.removedNodes;if(rNodes){for(var j=0;j<rNodes.length;j++){var rNode=rNodes[j];if(rNode===r.container){r.destroy();break}}}}}));if(r.container.parentNode){r.removeObserver.observe(r.container.parentNode,{childList:true})}}else{r.registerBinding(r.container,"DOMNodeRemoved",(function(e){r.destroy()}))}var onResize=util((function(){r.cy.resize()}),100);if(haveMutationsApi){r.styleObserver=new MutationObserver(onResize);r.styleObserver.observe(r.container,{attributes:true})}r.registerBinding(window,"resize",onResize);if(haveResizeObserverApi){r.resizeObserver=new ResizeObserver(onResize);r.resizeObserver.observe(r.container)}var forEachUp=function forEachUp(domEle,fn){while(domEle!=null){fn(domEle);domEle=domEle.parentNode}};var invalidateCoords=function invalidateCoords(){r.invalidateContainerClientCoordsCache()};forEachUp(r.container,(function(domEle){r.registerBinding(domEle,"transitionend",invalidateCoords);r.registerBinding(domEle,"animationend",invalidateCoords);r.registerBinding(domEle,"scroll",invalidateCoords)}));r.registerBinding(r.container,"contextmenu",(function(e){e.preventDefault()}));var inBoxSelection=function inBoxSelection(){return r.selection[4]!==0};var eventInContainer=function eventInContainer(e){var containerPageCoords=r.findContainerClientCoords();var x=containerPageCoords[0];var y=containerPageCoords[1];var width=containerPageCoords[2];var height=containerPageCoords[3];var positions=e.touches?e.touches:[e];var atLeastOnePosInside=false;for(var i=0;i<positions.length;i++){var p=positions[i];if(x<=p.clientX&&p.clientX<=x+width&&y<=p.clientY&&p.clientY<=y+height){atLeastOnePosInside=true;break}}if(!atLeastOnePosInside){return false}var container=r.container;var target=e.target;var tParent=target.parentNode;var containerIsTarget=false;while(tParent){if(tParent===container){containerIsTarget=true;break}tParent=tParent.parentNode}if(!containerIsTarget){return false}return true};r.registerBinding(r.container,"mousedown",(function mousedownHandler(e){if(!eventInContainer(e)){return}e.preventDefault();blurActiveDomElement();r.hoverData.capture=true;r.hoverData.which=e.which;var cy=r.cy;var gpos=[e.clientX,e.clientY];var pos=r.projectIntoViewport(gpos[0],gpos[1]);var select=r.selection;var nears=r.findNearestElements(pos[0],pos[1],true,false);var near=nears[0];var draggedElements=r.dragData.possibleDragElements;r.hoverData.mdownPos=pos;r.hoverData.mdownGPos=gpos;var checkForTaphold=function checkForTaphold(){r.hoverData.tapholdCancelled=false;clearTimeout(r.hoverData.tapholdTimeout);r.hoverData.tapholdTimeout=setTimeout((function(){if(r.hoverData.tapholdCancelled){return}else{var ele=r.hoverData.down;if(ele){ele.emit({originalEvent:e,type:"taphold",position:{x:pos[0],y:pos[1]}})}else{cy.emit({originalEvent:e,type:"taphold",position:{x:pos[0],y:pos[1]}})}}}),r.tapholdDuration)};if(e.which==3){r.hoverData.cxtStarted=true;var cxtEvt={originalEvent:e,type:"cxttapstart",position:{x:pos[0],y:pos[1]}};if(near){near.activate();near.emit(cxtEvt);r.hoverData.down=near}else{cy.emit(cxtEvt)}r.hoverData.downTime=(new Date).getTime();r.hoverData.cxtDragged=false}else if(e.which==1){if(near){near.activate()}{if(near!=null){if(r.nodeIsGrabbable(near)){var makeEvent=function makeEvent(type){return{originalEvent:e,type:type,position:{x:pos[0],y:pos[1]}}};var triggerGrab=function triggerGrab(ele){ele.emit(makeEvent("grab"))};setGrabTarget(near);if(!near.selected()){draggedElements=r.dragData.possibleDragElements=cy.collection();addNodeToDrag(near,{addToList:draggedElements});near.emit(makeEvent("grabon")).emit(makeEvent("grab"))}else{draggedElements=r.dragData.possibleDragElements=cy.collection();var selectedNodes=cy.$((function(ele){return ele.isNode()&&ele.selected()&&r.nodeIsGrabbable(ele)}));addNodesToDrag(selectedNodes,{addToList:draggedElements});near.emit(makeEvent("grabon"));selectedNodes.forEach(triggerGrab)}r.redrawHint("eles",true);r.redrawHint("drag",true)}}r.hoverData.down=near;r.hoverData.downs=nears;r.hoverData.downTime=(new Date).getTime()}triggerEvents(near,["mousedown","tapstart","vmousedown"],e,{x:pos[0],y:pos[1]});if(near==null){select[4]=1;r.data.bgActivePosistion={x:pos[0],y:pos[1]};r.redrawHint("select",true);r.redraw()}else if(near.pannable()){select[4]=1}checkForTaphold()}select[0]=select[2]=pos[0];select[1]=select[3]=pos[1]}),false);r.registerBinding(window,"mousemove",(function mousemoveHandler(e){var capture=r.hoverData.capture;if(!capture&&!eventInContainer(e)){return}var preventDefault=false;var cy=r.cy;var zoom=cy.zoom();var gpos=[e.clientX,e.clientY];var pos=r.projectIntoViewport(gpos[0],gpos[1]);var mdownPos=r.hoverData.mdownPos;var mdownGPos=r.hoverData.mdownGPos;var select=r.selection;var near=null;if(!r.hoverData.draggingEles&&!r.hoverData.dragging&&!r.hoverData.selecting){near=r.findNearestElement(pos[0],pos[1],true,false)}var last=r.hoverData.last;var down=r.hoverData.down;var disp=[pos[0]-select[2],pos[1]-select[3]];var draggedElements=r.dragData.possibleDragElements;var isOverThresholdDrag;if(mdownGPos){var dx=gpos[0]-mdownGPos[0];var dx2=dx*dx;var dy=gpos[1]-mdownGPos[1];var dy2=dy*dy;var dist2=dx2+dy2;r.hoverData.isOverThresholdDrag=isOverThresholdDrag=dist2>=r.desktopTapThreshold2}var multSelKeyDown=isMultSelKeyDown(e);if(isOverThresholdDrag){r.hoverData.tapholdCancelled=true}var updateDragDelta=function updateDragDelta(){var dragDelta=r.hoverData.dragDelta=r.hoverData.dragDelta||[];if(dragDelta.length===0){dragDelta.push(disp[0]);dragDelta.push(disp[1])}else{dragDelta[0]+=disp[0];dragDelta[1]+=disp[1]}};preventDefault=true;triggerEvents(near,["mousemove","vmousemove","tapdrag"],e,{x:pos[0],y:pos[1]});var goIntoBoxMode=function goIntoBoxMode(){r.data.bgActivePosistion=undefined;if(!r.hoverData.selecting){cy.emit({originalEvent:e,type:"boxstart",position:{x:pos[0],y:pos[1]}})}select[4]=1;r.hoverData.selecting=true;r.redrawHint("select",true);r.redraw()};if(r.hoverData.which===3){if(isOverThresholdDrag){var cxtEvt={originalEvent:e,type:"cxtdrag",position:{x:pos[0],y:pos[1]}};if(down){down.emit(cxtEvt)}else{cy.emit(cxtEvt)}r.hoverData.cxtDragged=true;if(!r.hoverData.cxtOver||near!==r.hoverData.cxtOver){if(r.hoverData.cxtOver){r.hoverData.cxtOver.emit({originalEvent:e,type:"cxtdragout",position:{x:pos[0],y:pos[1]}})}r.hoverData.cxtOver=near;if(near){near.emit({originalEvent:e,type:"cxtdragover",position:{x:pos[0],y:pos[1]}})}}}}else if(r.hoverData.dragging){preventDefault=true;if(cy.panningEnabled()&&cy.userPanningEnabled()){var deltaP;if(r.hoverData.justStartedPan){var mdPos=r.hoverData.mdownPos;deltaP={x:(pos[0]-mdPos[0])*zoom,y:(pos[1]-mdPos[1])*zoom};r.hoverData.justStartedPan=false}else{deltaP={x:disp[0]*zoom,y:disp[1]*zoom}}cy.panBy(deltaP);r.hoverData.dragged=true}pos=r.projectIntoViewport(e.clientX,e.clientY)}else if(select[4]==1&&(down==null||down.pannable())){if(isOverThresholdDrag){if(!r.hoverData.dragging&&cy.boxSelectionEnabled()&&(multSelKeyDown||!cy.panningEnabled()||!cy.userPanningEnabled())){goIntoBoxMode()}else if(!r.hoverData.selecting&&cy.panningEnabled()&&cy.userPanningEnabled()){var allowPassthrough=allowPanningPassthrough(down,r.hoverData.downs);if(allowPassthrough){r.hoverData.dragging=true;r.hoverData.justStartedPan=true;select[4]=0;r.data.bgActivePosistion=array2point(mdownPos);r.redrawHint("select",true);r.redraw()}}if(down&&down.pannable()&&down.active()){down.unactivate()}}}else{if(down&&down.pannable()&&down.active()){down.unactivate()}if((!down||!down.grabbed())&&near!=last){if(last){triggerEvents(last,["mouseout","tapdragout"],e,{x:pos[0],y:pos[1]})}if(near){triggerEvents(near,["mouseover","tapdragover"],e,{x:pos[0],y:pos[1]})}r.hoverData.last=near}if(down){if(isOverThresholdDrag){if(cy.boxSelectionEnabled()&&multSelKeyDown){if(down&&down.grabbed()){freeDraggedElements(draggedElements);down.emit("freeon");draggedElements.emit("free");if(r.dragData.didDrag){down.emit("dragfreeon");draggedElements.emit("dragfree")}}goIntoBoxMode()}else if(down&&down.grabbed()&&r.nodeIsDraggable(down)){var justStartedDrag=!r.dragData.didDrag;if(justStartedDrag){r.redrawHint("eles",true)}r.dragData.didDrag=true;var toTrigger=cy.collection();if(!r.hoverData.draggingEles){addNodesToDrag(draggedElements,{inDragLayer:true})}var totalShift={x:0,y:0};if(number(disp[0])&&number(disp[1])){totalShift.x+=disp[0];totalShift.y+=disp[1];if(justStartedDrag){var dragDelta=r.hoverData.dragDelta;if(dragDelta&&number(dragDelta[0])&&number(dragDelta[1])){totalShift.x+=dragDelta[0];totalShift.y+=dragDelta[1]}}}for(var i=0;i<draggedElements.length;i++){var dEle=draggedElements[i];if(r.nodeIsDraggable(dEle)&&dEle.grabbed()){toTrigger.merge(dEle)}}r.hoverData.draggingEles=true;toTrigger.silentShift(totalShift).emit("position drag");r.redrawHint("drag",true);r.redraw()}}else{updateDragDelta()}}preventDefault=true}select[2]=pos[0];select[3]=pos[1];if(preventDefault){if(e.stopPropagation)e.stopPropagation();if(e.preventDefault)e.preventDefault();return false}}),false);r.registerBinding(window,"mouseup",(function mouseupHandler(e){var capture=r.hoverData.capture;if(!capture){return}r.hoverData.capture=false;var cy=r.cy;var pos=r.projectIntoViewport(e.clientX,e.clientY);var select=r.selection;var near=r.findNearestElement(pos[0],pos[1],true,false);var draggedElements=r.dragData.possibleDragElements;var down=r.hoverData.down;var multSelKeyDown=isMultSelKeyDown(e);if(r.data.bgActivePosistion){r.redrawHint("select",true);r.redraw()}r.hoverData.tapholdCancelled=true;r.data.bgActivePosistion=undefined;if(down){down.unactivate()}if(r.hoverData.which===3){var cxtEvt={originalEvent:e,type:"cxttapend",position:{x:pos[0],y:pos[1]}};if(down){down.emit(cxtEvt)}else{cy.emit(cxtEvt)}if(!r.hoverData.cxtDragged){var cxtTap={originalEvent:e,type:"cxttap",position:{x:pos[0],y:pos[1]}};if(down){down.emit(cxtTap)}else{cy.emit(cxtTap)}}r.hoverData.cxtDragged=false;r.hoverData.which=null}else if(r.hoverData.which===1){triggerEvents(near,["mouseup","tapend","vmouseup"],e,{x:pos[0],y:pos[1]});if(!r.dragData.didDrag&&!r.hoverData.dragged&&!r.hoverData.selecting&&!r.hoverData.isOverThresholdDrag){triggerEvents(down,["click","tap","vclick"],e,{x:pos[0],y:pos[1]})}if(down==null&&!r.dragData.didDrag&&!r.hoverData.selecting&&!r.hoverData.dragged&&!isMultSelKeyDown(e)){cy.$(isSelected).unselect(["tapunselect"]);if(draggedElements.length>0){r.redrawHint("eles",true)}r.dragData.possibleDragElements=draggedElements=cy.collection()}if(near==down&&!r.dragData.didDrag&&!r.hoverData.selecting){if(near!=null&&near._private.selectable){if(r.hoverData.dragging);else if(cy.selectionType()==="additive"||multSelKeyDown){if(near.selected()){near.unselect(["tapunselect"])}else{near.select(["tapselect"])}}else{if(!multSelKeyDown){cy.$(isSelected).unmerge(near).unselect(["tapunselect"]);near.select(["tapselect"])}}r.redrawHint("eles",true)}}if(r.hoverData.selecting){var box=cy.collection(r.getAllInBox(select[0],select[1],select[2],select[3]));r.redrawHint("select",true);if(box.length>0){r.redrawHint("eles",true)}cy.emit({type:"boxend",originalEvent:e,position:{x:pos[0],y:pos[1]}});var eleWouldBeSelected=function eleWouldBeSelected(ele){return ele.selectable()&&!ele.selected()};if(cy.selectionType()==="additive"){box.emit("box").stdFilter(eleWouldBeSelected).select().emit("boxselect")}else{if(!multSelKeyDown){cy.$(isSelected).unmerge(box).unselect()}box.emit("box").stdFilter(eleWouldBeSelected).select().emit("boxselect")}r.redraw()}if(r.hoverData.dragging){r.hoverData.dragging=false;r.redrawHint("select",true);r.redrawHint("eles",true);r.redraw()}if(!select[4]){r.redrawHint("drag",true);r.redrawHint("eles",true);var downWasGrabbed=down&&down.grabbed();freeDraggedElements(draggedElements);if(downWasGrabbed){down.emit("freeon");draggedElements.emit("free");if(r.dragData.didDrag){down.emit("dragfreeon");draggedElements.emit("dragfree")}}}}select[4]=0;r.hoverData.down=null;r.hoverData.cxtStarted=false;r.hoverData.draggingEles=false;r.hoverData.selecting=false;r.hoverData.isOverThresholdDrag=false;r.dragData.didDrag=false;r.hoverData.dragged=false;r.hoverData.dragDelta=[];r.hoverData.mdownPos=null;r.hoverData.mdownGPos=null}),false);var wheelHandler=function wheelHandler(e){if(r.scrollingPage){return}var cy=r.cy;var pos=r.projectIntoViewport(e.clientX,e.clientY);var rpos=[pos[0]*cy.zoom()+cy.pan().x,pos[1]*cy.zoom()+cy.pan().y];if(r.hoverData.draggingEles||r.hoverData.dragging||r.hoverData.cxtStarted||inBoxSelection()){e.preventDefault();return}if(cy.panningEnabled()&&cy.userPanningEnabled()&&cy.zoomingEnabled()&&cy.userZoomingEnabled()){e.preventDefault();r.data.wheelZooming=true;clearTimeout(r.data.wheelTimeout);r.data.wheelTimeout=setTimeout((function(){r.data.wheelZooming=false;r.redrawHint("eles",true);r.redraw()}),150);var diff;if(e.deltaY!=null){diff=e.deltaY/-250}else if(e.wheelDeltaY!=null){diff=e.wheelDeltaY/1e3}else{diff=e.wheelDelta/1e3}diff=diff*r.wheelSensitivity;var needsWheelFix=e.deltaMode===1;if(needsWheelFix){diff*=33}cy.zoom({level:cy.zoom()*Math.pow(10,diff),renderedPosition:{x:rpos[0],y:rpos[1]}})}};r.registerBinding(r.container,"wheel",wheelHandler,true);r.registerBinding(window,"scroll",(function scrollHandler(e){r.scrollingPage=true;clearTimeout(r.scrollingPageTimeout);r.scrollingPageTimeout=setTimeout((function(){r.scrollingPage=false}),250)}),true);r.registerBinding(r.container,"mouseout",(function mouseOutHandler(e){var pos=r.projectIntoViewport(e.clientX,e.clientY);r.cy.emit({originalEvent:e,type:"mouseout",position:{x:pos[0],y:pos[1]}})}),false);r.registerBinding(r.container,"mouseover",(function mouseOverHandler(e){var pos=r.projectIntoViewport(e.clientX,e.clientY);r.cy.emit({originalEvent:e,type:"mouseover",position:{x:pos[0],y:pos[1]}})}),false);var f1x1,f1y1,f2x1,f2y1;var distance1,distance1Sq;var center1,modelCenter1;var offsetLeft,offsetTop;var containerWidth,containerHeight;var twoFingersStartInside;var distance=function distance(x1,y1,x2,y2){return Math.sqrt((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1))};var distanceSq=function distanceSq(x1,y1,x2,y2){return(x2-x1)*(x2-x1)+(y2-y1)*(y2-y1)};var touchstartHandler;r.registerBinding(r.container,"touchstart",touchstartHandler=function touchstartHandler(e){if(!eventInContainer(e)){return}blurActiveDomElement();r.touchData.capture=true;r.data.bgActivePosistion=undefined;var cy=r.cy;var now=r.touchData.now;var earlier=r.touchData.earlier;if(e.touches[0]){var pos=r.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);now[0]=pos[0];now[1]=pos[1]}if(e.touches[1]){var pos=r.projectIntoViewport(e.touches[1].clientX,e.touches[1].clientY);now[2]=pos[0];now[3]=pos[1]}if(e.touches[2]){var pos=r.projectIntoViewport(e.touches[2].clientX,e.touches[2].clientY);now[4]=pos[0];now[5]=pos[1]}if(e.touches[1]){r.touchData.singleTouchMoved=true;freeDraggedElements(r.dragData.touchDragEles);var offsets=r.findContainerClientCoords();offsetLeft=offsets[0];offsetTop=offsets[1];containerWidth=offsets[2];containerHeight=offsets[3];f1x1=e.touches[0].clientX-offsetLeft;f1y1=e.touches[0].clientY-offsetTop;f2x1=e.touches[1].clientX-offsetLeft;f2y1=e.touches[1].clientY-offsetTop;twoFingersStartInside=0<=f1x1&&f1x1<=containerWidth&&0<=f2x1&&f2x1<=containerWidth&&0<=f1y1&&f1y1<=containerHeight&&0<=f2y1&&f2y1<=containerHeight;var pan=cy.pan();var zoom=cy.zoom();distance1=distance(f1x1,f1y1,f2x1,f2y1);distance1Sq=distanceSq(f1x1,f1y1,f2x1,f2y1);center1=[(f1x1+f2x1)/2,(f1y1+f2y1)/2];modelCenter1=[(center1[0]-pan.x)/zoom,(center1[1]-pan.y)/zoom];var cxtDistThreshold=200;var cxtDistThresholdSq=cxtDistThreshold*cxtDistThreshold;if(distance1Sq<cxtDistThresholdSq&&!e.touches[2]){var near1=r.findNearestElement(now[0],now[1],true,true);var near2=r.findNearestElement(now[2],now[3],true,true);if(near1&&near1.isNode()){near1.activate().emit({originalEvent:e,type:"cxttapstart",position:{x:now[0],y:now[1]}});r.touchData.start=near1}else if(near2&&near2.isNode()){near2.activate().emit({originalEvent:e,type:"cxttapstart",position:{x:now[0],y:now[1]}});r.touchData.start=near2}else{cy.emit({originalEvent:e,type:"cxttapstart",position:{x:now[0],y:now[1]}})}if(r.touchData.start){r.touchData.start._private.grabbed=false}r.touchData.cxt=true;r.touchData.cxtDragged=false;r.data.bgActivePosistion=undefined;r.redraw();return}}if(e.touches[2]){if(cy.boxSelectionEnabled()){e.preventDefault()}}else if(e.touches[1]);else if(e.touches[0]){var nears=r.findNearestElements(now[0],now[1],true,true);var near=nears[0];if(near!=null){near.activate();r.touchData.start=near;r.touchData.starts=nears;if(r.nodeIsGrabbable(near)){var draggedEles=r.dragData.touchDragEles=cy.collection();var selectedNodes=null;r.redrawHint("eles",true);r.redrawHint("drag",true);if(near.selected()){selectedNodes=cy.$((function(ele){return ele.selected()&&r.nodeIsGrabbable(ele)}));addNodesToDrag(selectedNodes,{addToList:draggedEles})}else{addNodeToDrag(near,{addToList:draggedEles})}setGrabTarget(near);var makeEvent=function makeEvent(type){return{originalEvent:e,type:type,position:{x:now[0],y:now[1]}}};near.emit(makeEvent("grabon"));if(selectedNodes){selectedNodes.forEach((function(n){n.emit(makeEvent("grab"))}))}else{near.emit(makeEvent("grab"))}}}triggerEvents(near,["touchstart","tapstart","vmousedown"],e,{x:now[0],y:now[1]});if(near==null){r.data.bgActivePosistion={x:pos[0],y:pos[1]};r.redrawHint("select",true);r.redraw()}r.touchData.singleTouchMoved=false;r.touchData.singleTouchStartTime=+new Date;clearTimeout(r.touchData.tapholdTimeout);r.touchData.tapholdTimeout=setTimeout((function(){if(r.touchData.singleTouchMoved===false&&!r.pinching&&!r.touchData.selecting){triggerEvents(r.touchData.start,["taphold"],e,{x:now[0],y:now[1]})}}),r.tapholdDuration)}if(e.touches.length>=1){var sPos=r.touchData.startPosition=[];for(var i=0;i<now.length;i++){sPos[i]=earlier[i]=now[i]}var touch0=e.touches[0];r.touchData.startGPosition=[touch0.clientX,touch0.clientY]}},false);var touchmoveHandler;r.registerBinding(window,"touchmove",touchmoveHandler=function touchmoveHandler(e){var capture=r.touchData.capture;if(!capture&&!eventInContainer(e)){return}var select=r.selection;var cy=r.cy;var now=r.touchData.now;var earlier=r.touchData.earlier;var zoom=cy.zoom();if(e.touches[0]){var pos=r.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);now[0]=pos[0];now[1]=pos[1]}if(e.touches[1]){var pos=r.projectIntoViewport(e.touches[1].clientX,e.touches[1].clientY);now[2]=pos[0];now[3]=pos[1]}if(e.touches[2]){var pos=r.projectIntoViewport(e.touches[2].clientX,e.touches[2].clientY);now[4]=pos[0];now[5]=pos[1]}var startGPos=r.touchData.startGPosition;var isOverThresholdDrag;if(capture&&e.touches[0]&&startGPos){var disp=[];for(var j=0;j<now.length;j++){disp[j]=now[j]-earlier[j]}var dx=e.touches[0].clientX-startGPos[0];var dx2=dx*dx;var dy=e.touches[0].clientY-startGPos[1];var dy2=dy*dy;var dist2=dx2+dy2;isOverThresholdDrag=dist2>=r.touchTapThreshold2}if(capture&&r.touchData.cxt){e.preventDefault();var f1x2=e.touches[0].clientX-offsetLeft,f1y2=e.touches[0].clientY-offsetTop;var f2x2=e.touches[1].clientX-offsetLeft,f2y2=e.touches[1].clientY-offsetTop;var distance2Sq=distanceSq(f1x2,f1y2,f2x2,f2y2);var factorSq=distance2Sq/distance1Sq;var distThreshold=150;var distThresholdSq=distThreshold*distThreshold;var factorThreshold=1.5;var factorThresholdSq=factorThreshold*factorThreshold;if(factorSq>=factorThresholdSq||distance2Sq>=distThresholdSq){r.touchData.cxt=false;r.data.bgActivePosistion=undefined;r.redrawHint("select",true);var cxtEvt={originalEvent:e,type:"cxttapend",position:{x:now[0],y:now[1]}};if(r.touchData.start){r.touchData.start.unactivate().emit(cxtEvt);r.touchData.start=null}else{cy.emit(cxtEvt)}}}if(capture&&r.touchData.cxt){var cxtEvt={originalEvent:e,type:"cxtdrag",position:{x:now[0],y:now[1]}};r.data.bgActivePosistion=undefined;r.redrawHint("select",true);if(r.touchData.start){r.touchData.start.emit(cxtEvt)}else{cy.emit(cxtEvt)}if(r.touchData.start){r.touchData.start._private.grabbed=false}r.touchData.cxtDragged=true;var near=r.findNearestElement(now[0],now[1],true,true);if(!r.touchData.cxtOver||near!==r.touchData.cxtOver){if(r.touchData.cxtOver){r.touchData.cxtOver.emit({originalEvent:e,type:"cxtdragout",position:{x:now[0],y:now[1]}})}r.touchData.cxtOver=near;if(near){near.emit({originalEvent:e,type:"cxtdragover",position:{x:now[0],y:now[1]}})}}}else if(capture&&e.touches[2]&&cy.boxSelectionEnabled()){e.preventDefault();r.data.bgActivePosistion=undefined;this.lastThreeTouch=+new Date;if(!r.touchData.selecting){cy.emit({originalEvent:e,type:"boxstart",position:{x:now[0],y:now[1]}})}r.touchData.selecting=true;r.touchData.didSelect=true;select[4]=1;if(!select||select.length===0||select[0]===undefined){select[0]=(now[0]+now[2]+now[4])/3;select[1]=(now[1]+now[3]+now[5])/3;select[2]=(now[0]+now[2]+now[4])/3+1;select[3]=(now[1]+now[3]+now[5])/3+1}else{select[2]=(now[0]+now[2]+now[4])/3;select[3]=(now[1]+now[3]+now[5])/3}r.redrawHint("select",true);r.redraw()}else if(capture&&e.touches[1]&&!r.touchData.didSelect&&cy.zoomingEnabled()&&cy.panningEnabled()&&cy.userZoomingEnabled()&&cy.userPanningEnabled()){e.preventDefault();r.data.bgActivePosistion=undefined;r.redrawHint("select",true);var draggedEles=r.dragData.touchDragEles;if(draggedEles){r.redrawHint("drag",true);for(var i=0;i<draggedEles.length;i++){var de_p=draggedEles[i]._private;de_p.grabbed=false;de_p.rscratch.inDragLayer=false}}var _start=r.touchData.start;var f1x2=e.touches[0].clientX-offsetLeft,f1y2=e.touches[0].clientY-offsetTop;var f2x2=e.touches[1].clientX-offsetLeft,f2y2=e.touches[1].clientY-offsetTop;var distance2=distance(f1x2,f1y2,f2x2,f2y2);var factor=distance2/distance1;if(twoFingersStartInside){var df1x=f1x2-f1x1;var df1y=f1y2-f1y1;var df2x=f2x2-f2x1;var df2y=f2y2-f2y1;var tx=(df1x+df2x)/2;var ty=(df1y+df2y)/2;var zoom1=cy.zoom();var zoom2=zoom1*factor;var pan1=cy.pan();var ctrx=modelCenter1[0]*zoom1+pan1.x;var ctry=modelCenter1[1]*zoom1+pan1.y;var pan2={x:-zoom2/zoom1*(ctrx-pan1.x-tx)+ctrx,y:-zoom2/zoom1*(ctry-pan1.y-ty)+ctry};if(_start&&_start.active()){var draggedEles=r.dragData.touchDragEles;freeDraggedElements(draggedEles);r.redrawHint("drag",true);r.redrawHint("eles",true);_start.unactivate().emit("freeon");draggedEles.emit("free");if(r.dragData.didDrag){_start.emit("dragfreeon");draggedEles.emit("dragfree")}}cy.viewport({zoom:zoom2,pan:pan2,cancelOnFailedZoom:true});distance1=distance2;f1x1=f1x2;f1y1=f1y2;f2x1=f2x2;f2y1=f2y2;r.pinching=true}if(e.touches[0]){var pos=r.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);now[0]=pos[0];now[1]=pos[1]}if(e.touches[1]){var pos=r.projectIntoViewport(e.touches[1].clientX,e.touches[1].clientY);now[2]=pos[0];now[3]=pos[1]}if(e.touches[2]){var pos=r.projectIntoViewport(e.touches[2].clientX,e.touches[2].clientY);now[4]=pos[0];now[5]=pos[1]}}else if(e.touches[0]&&!r.touchData.didSelect){var start=r.touchData.start;var last=r.touchData.last;var near;if(!r.hoverData.draggingEles&&!r.swipePanning){near=r.findNearestElement(now[0],now[1],true,true)}if(capture&&start!=null){e.preventDefault()}if(capture&&start!=null&&r.nodeIsDraggable(start)){if(isOverThresholdDrag){var draggedEles=r.dragData.touchDragEles;var justStartedDrag=!r.dragData.didDrag;if(justStartedDrag){addNodesToDrag(draggedEles,{inDragLayer:true})}r.dragData.didDrag=true;var totalShift={x:0,y:0};if(number(disp[0])&&number(disp[1])){totalShift.x+=disp[0];totalShift.y+=disp[1];if(justStartedDrag){r.redrawHint("eles",true);var dragDelta=r.touchData.dragDelta;if(dragDelta&&number(dragDelta[0])&&number(dragDelta[1])){totalShift.x+=dragDelta[0];totalShift.y+=dragDelta[1]}}}r.hoverData.draggingEles=true;draggedEles.silentShift(totalShift).emit("position drag");r.redrawHint("drag",true);if(r.touchData.startPosition[0]==earlier[0]&&r.touchData.startPosition[1]==earlier[1]){r.redrawHint("eles",true)}r.redraw()}else{var dragDelta=r.touchData.dragDelta=r.touchData.dragDelta||[];if(dragDelta.length===0){dragDelta.push(disp[0]);dragDelta.push(disp[1])}else{dragDelta[0]+=disp[0];dragDelta[1]+=disp[1]}}}{triggerEvents(start||near,["touchmove","tapdrag","vmousemove"],e,{x:now[0],y:now[1]});if((!start||!start.grabbed())&&near!=last){if(last){last.emit({originalEvent:e,type:"tapdragout",position:{x:now[0],y:now[1]}})}if(near){near.emit({originalEvent:e,type:"tapdragover",position:{x:now[0],y:now[1]}})}}r.touchData.last=near}if(capture){for(var i=0;i<now.length;i++){if(now[i]&&r.touchData.startPosition[i]&&isOverThresholdDrag){r.touchData.singleTouchMoved=true}}}if(capture&&(start==null||start.pannable())&&cy.panningEnabled()&&cy.userPanningEnabled()){var allowPassthrough=allowPanningPassthrough(start,r.touchData.starts);if(allowPassthrough){e.preventDefault();if(!r.data.bgActivePosistion){r.data.bgActivePosistion=array2point(r.touchData.startPosition)}if(r.swipePanning){cy.panBy({x:disp[0]*zoom,y:disp[1]*zoom})}else if(isOverThresholdDrag){r.swipePanning=true;cy.panBy({x:dx*zoom,y:dy*zoom});if(start){start.unactivate();r.redrawHint("select",true);r.touchData.start=null}}}var pos=r.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);now[0]=pos[0];now[1]=pos[1]}}for(var j=0;j<now.length;j++){earlier[j]=now[j]}if(capture&&e.touches.length>0&&!r.hoverData.draggingEles&&!r.swipePanning&&r.data.bgActivePosistion!=null){r.data.bgActivePosistion=undefined;r.redrawHint("select",true);r.redraw()}},false);var touchcancelHandler;r.registerBinding(window,"touchcancel",touchcancelHandler=function touchcancelHandler(e){var start=r.touchData.start;r.touchData.capture=false;if(start){start.unactivate()}});var touchendHandler;r.registerBinding(window,"touchend",touchendHandler=function touchendHandler(e){var start=r.touchData.start;var capture=r.touchData.capture;if(capture){if(e.touches.length===0){r.touchData.capture=false}e.preventDefault()}else{return}var select=r.selection;r.swipePanning=false;r.hoverData.draggingEles=false;var cy=r.cy;var zoom=cy.zoom();var now=r.touchData.now;var earlier=r.touchData.earlier;if(e.touches[0]){var pos=r.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);now[0]=pos[0];now[1]=pos[1]}if(e.touches[1]){var pos=r.projectIntoViewport(e.touches[1].clientX,e.touches[1].clientY);now[2]=pos[0];now[3]=pos[1]}if(e.touches[2]){var pos=r.projectIntoViewport(e.touches[2].clientX,e.touches[2].clientY);now[4]=pos[0];now[5]=pos[1]}if(start){start.unactivate()}var ctxTapend;if(r.touchData.cxt){ctxTapend={originalEvent:e,type:"cxttapend",position:{x:now[0],y:now[1]}};if(start){start.emit(ctxTapend)}else{cy.emit(ctxTapend)}if(!r.touchData.cxtDragged){var ctxTap={originalEvent:e,type:"cxttap",position:{x:now[0],y:now[1]}};if(start){start.emit(ctxTap)}else{cy.emit(ctxTap)}}if(r.touchData.start){r.touchData.start._private.grabbed=false}r.touchData.cxt=false;r.touchData.start=null;r.redraw();return}if(!e.touches[2]&&cy.boxSelectionEnabled()&&r.touchData.selecting){r.touchData.selecting=false;var box=cy.collection(r.getAllInBox(select[0],select[1],select[2],select[3]));select[0]=undefined;select[1]=undefined;select[2]=undefined;select[3]=undefined;select[4]=0;r.redrawHint("select",true);cy.emit({type:"boxend",originalEvent:e,position:{x:now[0],y:now[1]}});var eleWouldBeSelected=function eleWouldBeSelected(ele){return ele.selectable()&&!ele.selected()};box.emit("box").stdFilter(eleWouldBeSelected).select().emit("boxselect");if(box.nonempty()){r.redrawHint("eles",true)}r.redraw()}if(start!=null){start.unactivate()}if(e.touches[2]){r.data.bgActivePosistion=undefined;r.redrawHint("select",true)}else if(e.touches[1]);else if(e.touches[0]);else if(!e.touches[0]){r.data.bgActivePosistion=undefined;r.redrawHint("select",true);var draggedEles=r.dragData.touchDragEles;if(start!=null){var startWasGrabbed=start._private.grabbed;freeDraggedElements(draggedEles);r.redrawHint("drag",true);r.redrawHint("eles",true);if(startWasGrabbed){start.emit("freeon");draggedEles.emit("free");if(r.dragData.didDrag){start.emit("dragfreeon");draggedEles.emit("dragfree")}}triggerEvents(start,["touchend","tapend","vmouseup","tapdragout"],e,{x:now[0],y:now[1]});start.unactivate();r.touchData.start=null}else{var near=r.findNearestElement(now[0],now[1],true,true);triggerEvents(near,["touchend","tapend","vmouseup","tapdragout"],e,{x:now[0],y:now[1]})}var dx=r.touchData.startPosition[0]-now[0];var dx2=dx*dx;var dy=r.touchData.startPosition[1]-now[1];var dy2=dy*dy;var dist2=dx2+dy2;var rdist2=dist2*zoom*zoom;if(!r.touchData.singleTouchMoved){if(!start){cy.$(":selected").unselect(["tapunselect"])}triggerEvents(start,["tap","vclick"],e,{x:now[0],y:now[1]})}if(start!=null&&!r.dragData.didDrag&&start._private.selectable&&rdist2<r.touchTapThreshold2&&!r.pinching){if(cy.selectionType()==="single"){cy.$(isSelected).unmerge(start).unselect(["tapunselect"]);start.select(["tapselect"])}else{if(start.selected()){start.unselect(["tapunselect"])}else{start.select(["tapselect"])}}r.redrawHint("eles",true)}r.touchData.singleTouchMoved=true}for(var j=0;j<now.length;j++){earlier[j]=now[j]}r.dragData.didDrag=false;if(e.touches.length===0){r.touchData.dragDelta=[];r.touchData.startPosition=null;r.touchData.startGPosition=null;r.touchData.didSelect=false}if(e.touches.length<2){if(e.touches.length===1){r.touchData.startGPosition=[e.touches[0].clientX,e.touches[0].clientY]}r.pinching=false;r.redrawHint("eles",true);r.redraw()}},false);if(typeof TouchEvent==="undefined"){var pointers=[];var makeTouch=function makeTouch(e){return{clientX:e.clientX,clientY:e.clientY,force:1,identifier:e.pointerId,pageX:e.pageX,pageY:e.pageY,radiusX:e.width/2,radiusY:e.height/2,screenX:e.screenX,screenY:e.screenY,target:e.target}};var makePointer=function makePointer(e){return{event:e,touch:makeTouch(e)}};var addPointer=function addPointer(e){pointers.push(makePointer(e))};var removePointer=function removePointer(e){for(var i=0;i<pointers.length;i++){var p=pointers[i];if(p.event.pointerId===e.pointerId){pointers.splice(i,1);return}}};var updatePointer=function updatePointer(e){var p=pointers.filter((function(p){return p.event.pointerId===e.pointerId}))[0];p.event=e;p.touch=makeTouch(e)};var addTouchesToEvent=function addTouchesToEvent(e){e.touches=pointers.map((function(p){return p.touch}))};var pointerIsMouse=function pointerIsMouse(e){return e.pointerType==="mouse"||e.pointerType===4};r.registerBinding(r.container,"pointerdown",(function(e){if(pointerIsMouse(e)){return}e.preventDefault();addPointer(e);addTouchesToEvent(e);touchstartHandler(e)}));r.registerBinding(r.container,"pointerup",(function(e){if(pointerIsMouse(e)){return}removePointer(e);addTouchesToEvent(e);touchendHandler(e)}));r.registerBinding(r.container,"pointercancel",(function(e){if(pointerIsMouse(e)){return}removePointer(e);addTouchesToEvent(e);touchcancelHandler(e)}));r.registerBinding(r.container,"pointermove",(function(e){if(pointerIsMouse(e)){return}e.preventDefault();updatePointer(e);addTouchesToEvent(e);touchmoveHandler(e)}))}};var BRp$d={};BRp$d.generatePolygon=function(name,points){return this.nodeShapes[name]={renderer:this,name:name,points:points,draw:function draw(context,centerX,centerY,width,height){this.renderer.nodeShapeImpl("polygon",context,centerX,centerY,width,height,this.points)},intersectLine:function intersectLine(nodeX,nodeY,width,height,x,y,padding){return polygonIntersectLine(x,y,this.points,nodeX,nodeY,width/2,height/2,padding)},checkPoint:function checkPoint(x,y,padding,width,height,centerX,centerY){return pointInsidePolygon(x,y,this.points,centerX,centerY,width,height,[0,-1],padding)}}};BRp$d.generateEllipse=function(){return this.nodeShapes["ellipse"]={renderer:this,name:"ellipse",draw:function draw(context,centerX,centerY,width,height){this.renderer.nodeShapeImpl(this.name,context,centerX,centerY,width,height)},intersectLine:function intersectLine(nodeX,nodeY,width,height,x,y,padding){return intersectLineEllipse(x,y,nodeX,nodeY,width/2+padding,height/2+padding)},checkPoint:function checkPoint(x,y,padding,width,height,centerX,centerY){return checkInEllipse(x,y,width,height,centerX,centerY,padding)}}};BRp$d.generateRoundRectangle=function(){return this.nodeShapes["round-rectangle"]=this.nodeShapes["roundrectangle"]={renderer:this,name:"round-rectangle",points:generateUnitNgonPointsFitToSquare(4,0),draw:function draw(context,centerX,centerY,width,height){this.renderer.nodeShapeImpl(this.name,context,centerX,centerY,width,height)},intersectLine:function intersectLine(nodeX,nodeY,width,height,x,y,padding){return roundRectangleIntersectLine(x,y,nodeX,nodeY,width,height,padding)},checkPoint:function checkPoint(x,y,padding,width,height,centerX,centerY){var cornerRadius=getRoundRectangleRadius(width,height);var diam=cornerRadius*2;if(pointInsidePolygon(x,y,this.points,centerX,centerY,width,height-diam,[0,-1],padding)){return true}if(pointInsidePolygon(x,y,this.points,centerX,centerY,width-diam,height,[0,-1],padding)){return true}if(checkInEllipse(x,y,diam,diam,centerX-width/2+cornerRadius,centerY-height/2+cornerRadius,padding)){return true}if(checkInEllipse(x,y,diam,diam,centerX+width/2-cornerRadius,centerY-height/2+cornerRadius,padding)){return true}if(checkInEllipse(x,y,diam,diam,centerX+width/2-cornerRadius,centerY+height/2-cornerRadius,padding)){return true}if(checkInEllipse(x,y,diam,diam,centerX-width/2+cornerRadius,centerY+height/2-cornerRadius,padding)){return true}return false}}};BRp$d.generateCutRectangle=function(){return this.nodeShapes["cut-rectangle"]=this.nodeShapes["cutrectangle"]={renderer:this,name:"cut-rectangle",cornerLength:getCutRectangleCornerLength(),points:generateUnitNgonPointsFitToSquare(4,0),draw:function draw(context,centerX,centerY,width,height){this.renderer.nodeShapeImpl(this.name,context,centerX,centerY,width,height)},generateCutTrianglePts:function generateCutTrianglePts(width,height,centerX,centerY){var cl=this.cornerLength;var hh=height/2;var hw=width/2;var xBegin=centerX-hw;var xEnd=centerX+hw;var yBegin=centerY-hh;var yEnd=centerY+hh;return{topLeft:[xBegin,yBegin+cl,xBegin+cl,yBegin,xBegin+cl,yBegin+cl],topRight:[xEnd-cl,yBegin,xEnd,yBegin+cl,xEnd-cl,yBegin+cl],bottomRight:[xEnd,yEnd-cl,xEnd-cl,yEnd,xEnd-cl,yEnd-cl],bottomLeft:[xBegin+cl,yEnd,xBegin,yEnd-cl,xBegin+cl,yEnd-cl]}},intersectLine:function intersectLine(nodeX,nodeY,width,height,x,y,padding){var cPts=this.generateCutTrianglePts(width+2*padding,height+2*padding,nodeX,nodeY);var pts=[].concat.apply([],[cPts.topLeft.splice(0,4),cPts.topRight.splice(0,4),cPts.bottomRight.splice(0,4),cPts.bottomLeft.splice(0,4)]);return polygonIntersectLine(x,y,pts,nodeX,nodeY)},checkPoint:function checkPoint(x,y,padding,width,height,centerX,centerY){if(pointInsidePolygon(x,y,this.points,centerX,centerY,width,height-2*this.cornerLength,[0,-1],padding)){return true}if(pointInsidePolygon(x,y,this.points,centerX,centerY,width-2*this.cornerLength,height,[0,-1],padding)){return true}var cutTrianglePts=this.generateCutTrianglePts(width,height,centerX,centerY);return pointInsidePolygonPoints(x,y,cutTrianglePts.topLeft)||pointInsidePolygonPoints(x,y,cutTrianglePts.topRight)||pointInsidePolygonPoints(x,y,cutTrianglePts.bottomRight)||pointInsidePolygonPoints(x,y,cutTrianglePts.bottomLeft)}}};BRp$d.generateBarrel=function(){return this.nodeShapes["barrel"]={renderer:this,name:"barrel",points:generateUnitNgonPointsFitToSquare(4,0),draw:function draw(context,centerX,centerY,width,height){this.renderer.nodeShapeImpl(this.name,context,centerX,centerY,width,height)},intersectLine:function intersectLine(nodeX,nodeY,width,height,x,y,padding){var t0=.15;var t1=.5;var t2=.85;var bPts=this.generateBarrelBezierPts(width+2*padding,height+2*padding,nodeX,nodeY);var approximateBarrelCurvePts=function approximateBarrelCurvePts(pts){var m0=qbezierPtAt({x:pts[0],y:pts[1]},{x:pts[2],y:pts[3]},{x:pts[4],y:pts[5]},t0);var m1=qbezierPtAt({x:pts[0],y:pts[1]},{x:pts[2],y:pts[3]},{x:pts[4],y:pts[5]},t1);var m2=qbezierPtAt({x:pts[0],y:pts[1]},{x:pts[2],y:pts[3]},{x:pts[4],y:pts[5]},t2);return[pts[0],pts[1],m0.x,m0.y,m1.x,m1.y,m2.x,m2.y,pts[4],pts[5]]};var pts=[].concat(approximateBarrelCurvePts(bPts.topLeft),approximateBarrelCurvePts(bPts.topRight),approximateBarrelCurvePts(bPts.bottomRight),approximateBarrelCurvePts(bPts.bottomLeft));return polygonIntersectLine(x,y,pts,nodeX,nodeY)},generateBarrelBezierPts:function generateBarrelBezierPts(width,height,centerX,centerY){var hh=height/2;var hw=width/2;var xBegin=centerX-hw;var xEnd=centerX+hw;var yBegin=centerY-hh;var yEnd=centerY+hh;var curveConstants=getBarrelCurveConstants(width,height);var hOffset=curveConstants.heightOffset;var wOffset=curveConstants.widthOffset;var ctrlPtXOffset=curveConstants.ctrlPtOffsetPct*width;var pts={topLeft:[xBegin,yBegin+hOffset,xBegin+ctrlPtXOffset,yBegin,xBegin+wOffset,yBegin],topRight:[xEnd-wOffset,yBegin,xEnd-ctrlPtXOffset,yBegin,xEnd,yBegin+hOffset],bottomRight:[xEnd,yEnd-hOffset,xEnd-ctrlPtXOffset,yEnd,xEnd-wOffset,yEnd],bottomLeft:[xBegin+wOffset,yEnd,xBegin+ctrlPtXOffset,yEnd,xBegin,yEnd-hOffset]};pts.topLeft.isTop=true;pts.topRight.isTop=true;pts.bottomLeft.isBottom=true;pts.bottomRight.isBottom=true;return pts},checkPoint:function checkPoint(x,y,padding,width,height,centerX,centerY){var curveConstants=getBarrelCurveConstants(width,height);var hOffset=curveConstants.heightOffset;var wOffset=curveConstants.widthOffset;if(pointInsidePolygon(x,y,this.points,centerX,centerY,width,height-2*hOffset,[0,-1],padding)){return true}if(pointInsidePolygon(x,y,this.points,centerX,centerY,width-2*wOffset,height,[0,-1],padding)){return true}var barrelCurvePts=this.generateBarrelBezierPts(width,height,centerX,centerY);var getCurveT=function getCurveT(x,y,curvePts){var x0=curvePts[4];var x1=curvePts[2];var x2=curvePts[0];var y0=curvePts[5];var y2=curvePts[1];var xMin=Math.min(x0,x2);var xMax=Math.max(x0,x2);var yMin=Math.min(y0,y2);var yMax=Math.max(y0,y2);if(xMin<=x&&x<=xMax&&yMin<=y&&y<=yMax){var coeff=bezierPtsToQuadCoeff(x0,x1,x2);var roots=solveQuadratic(coeff[0],coeff[1],coeff[2],x);var validRoots=roots.filter((function(r){return 0<=r&&r<=1}));if(validRoots.length>0){return validRoots[0]}}return null};var curveRegions=Object.keys(barrelCurvePts);for(var i=0;i<curveRegions.length;i++){var corner=curveRegions[i];var cornerPts=barrelCurvePts[corner];var t=getCurveT(x,y,cornerPts);if(t==null){continue}var y0=cornerPts[5];var y1=cornerPts[3];var y2=cornerPts[1];var bezY=qbezierAt(y0,y1,y2,t);if(cornerPts.isTop&&bezY<=y){return true}if(cornerPts.isBottom&&y<=bezY){return true}}return false}}};BRp$d.generateBottomRoundrectangle=function(){return this.nodeShapes["bottom-round-rectangle"]=this.nodeShapes["bottomroundrectangle"]={renderer:this,name:"bottom-round-rectangle",points:generateUnitNgonPointsFitToSquare(4,0),draw:function draw(context,centerX,centerY,width,height){this.renderer.nodeShapeImpl(this.name,context,centerX,centerY,width,height)},intersectLine:function intersectLine(nodeX,nodeY,width,height,x,y,padding){var topStartX=nodeX-(width/2+padding);var topStartY=nodeY-(height/2+padding);var topEndY=topStartY;var topEndX=nodeX+(width/2+padding);var topIntersections=finiteLinesIntersect(x,y,nodeX,nodeY,topStartX,topStartY,topEndX,topEndY,false);if(topIntersections.length>0){return topIntersections}return roundRectangleIntersectLine(x,y,nodeX,nodeY,width,height,padding)},checkPoint:function checkPoint(x,y,padding,width,height,centerX,centerY){var cornerRadius=getRoundRectangleRadius(width,height);var diam=2*cornerRadius;if(pointInsidePolygon(x,y,this.points,centerX,centerY,width,height-diam,[0,-1],padding)){return true}if(pointInsidePolygon(x,y,this.points,centerX,centerY,width-diam,height,[0,-1],padding)){return true}var outerWidth=width/2+2*padding;var outerHeight=height/2+2*padding;var points=[centerX-outerWidth,centerY-outerHeight,centerX-outerWidth,centerY,centerX+outerWidth,centerY,centerX+outerWidth,centerY-outerHeight];if(pointInsidePolygonPoints(x,y,points)){return true}if(checkInEllipse(x,y,diam,diam,centerX+width/2-cornerRadius,centerY+height/2-cornerRadius,padding)){return true}if(checkInEllipse(x,y,diam,diam,centerX-width/2+cornerRadius,centerY+height/2-cornerRadius,padding)){return true}return false}}};BRp$d.registerNodeShapes=function(){var nodeShapes=this.nodeShapes={};var renderer=this;this.generateEllipse();this.generatePolygon("triangle",generateUnitNgonPointsFitToSquare(3,0));this.generatePolygon("rectangle",generateUnitNgonPointsFitToSquare(4,0));nodeShapes["square"]=nodeShapes["rectangle"];this.generateRoundRectangle();this.generateCutRectangle();this.generateBarrel();this.generateBottomRoundrectangle();this.generatePolygon("diamond",[0,1,1,0,0,-1,-1,0]);this.generatePolygon("pentagon",generateUnitNgonPointsFitToSquare(5,0));this.generatePolygon("hexagon",generateUnitNgonPointsFitToSquare(6,0));this.generatePolygon("heptagon",generateUnitNgonPointsFitToSquare(7,0));this.generatePolygon("octagon",generateUnitNgonPointsFitToSquare(8,0));var star5Points=new Array(20);{var outerPoints=generateUnitNgonPoints(5,0);var innerPoints=generateUnitNgonPoints(5,Math.PI/5);var innerRadius=.5*(3-Math.sqrt(5));innerRadius*=1.57;for(var i=0;i<innerPoints.length/2;i++){innerPoints[i*2]*=innerRadius;innerPoints[i*2+1]*=innerRadius}for(var i=0;i<20/4;i++){star5Points[i*4]=outerPoints[i*2];star5Points[i*4+1]=outerPoints[i*2+1];star5Points[i*4+2]=innerPoints[i*2];star5Points[i*4+3]=innerPoints[i*2+1]}}star5Points=fitPolygonToSquare(star5Points);this.generatePolygon("star",star5Points);this.generatePolygon("vee",[-1,-1,0,-.333,1,-1,0,1]);this.generatePolygon("rhomboid",[-1,-1,.333,-1,1,1,-.333,1]);this.nodeShapes["concavehexagon"]=this.generatePolygon("concave-hexagon",[-1,-.95,-.75,0,-1,.95,1,.95,.75,0,1,-.95]);this.generatePolygon("tag",[-1,-1,.25,-1,1,0,.25,1,-1,1]);nodeShapes.makePolygon=function(points){var key=points.join("$");var name="polygon-"+key;var shape;if(shape=this[name]){return shape}return renderer.generatePolygon(name,points)}};var BRp$e={};BRp$e.timeToRender=function(){return this.redrawTotalTime/this.redrawCount};BRp$e.redraw=function(options){options=options||staticEmptyObject();var r=this;if(r.averageRedrawTime===undefined){r.averageRedrawTime=0}if(r.lastRedrawTime===undefined){r.lastRedrawTime=0}if(r.lastDrawTime===undefined){r.lastDrawTime=0}r.requestedFrame=true;r.renderOptions=options};BRp$e.beforeRender=function(fn,priority){if(this.destroyed){return}if(priority==null){error("Priority is not optional for beforeRender")}var cbs=this.beforeRenderCallbacks;cbs.push({fn:fn,priority:priority});cbs.sort((function(a,b){return b.priority-a.priority}))};var beforeRenderCallbacks=function beforeRenderCallbacks(r,willDraw,startTime){var cbs=r.beforeRenderCallbacks;for(var i=0;i<cbs.length;i++){cbs[i].fn(willDraw,startTime)}};BRp$e.startRenderLoop=function(){var r=this;var cy=r.cy;if(r.renderLoopStarted){return}else{r.renderLoopStarted=true}var renderFn=function renderFn(requestTime){if(r.destroyed){return}if(cy.batching());else if(r.requestedFrame&&!r.skipFrame){beforeRenderCallbacks(r,true,requestTime);var startTime=performanceNow();r.render(r.renderOptions);var endTime=r.lastDrawTime=performanceNow();if(r.averageRedrawTime===undefined){r.averageRedrawTime=endTime-startTime}if(r.redrawCount===undefined){r.redrawCount=0}r.redrawCount++;if(r.redrawTotalTime===undefined){r.redrawTotalTime=0}var duration=endTime-startTime;r.redrawTotalTime+=duration;r.lastRedrawTime=duration;r.averageRedrawTime=r.averageRedrawTime/2+duration/2;r.requestedFrame=false}else{beforeRenderCallbacks(r,false,requestTime)}r.skipFrame=false;requestAnimationFrame(renderFn)};requestAnimationFrame(renderFn)};var BaseRenderer=function BaseRenderer(options){this.init(options)};var BR=BaseRenderer;var BRp$f=BR.prototype;BRp$f.clientFunctions=["redrawHint","render","renderTo","matchCanvasSize","nodeShapeImpl","arrowShapeImpl"];BRp$f.init=function(options){var r=this;r.options=options;r.cy=options.cy;var ctr=r.container=options.cy.container();if(window$1){var document=window$1.document;var head=document.head;var stylesheetId="__________cytoscape_stylesheet";var className="__________cytoscape_container";var stylesheetAlreadyExists=document.getElementById(stylesheetId)!=null;if(ctr.className.indexOf(className)<0){ctr.className=(ctr.className||"")+" "+className}if(!stylesheetAlreadyExists){var stylesheet=document.createElement("style");stylesheet.id=stylesheetId;stylesheet.innerHTML="."+className+" { position: relative; }";head.insertBefore(stylesheet,head.children[0])}var computedStyle=window$1.getComputedStyle(ctr);var position=computedStyle.getPropertyValue("position");if(position==="static"){warn("A Cytoscape container has style position:static and so can not use UI extensions properly")}}r.selection=[undefined,undefined,undefined,undefined,0];r.bezierProjPcts=[.05,.225,.4,.5,.6,.775,.95];r.hoverData={down:null,last:null,downTime:null,triggerMode:null,dragging:false,initialPan:[null,null],capture:false};r.dragData={possibleDragElements:[]};r.touchData={start:null,capture:false,startPosition:[null,null,null,null,null,null],singleTouchStartTime:null,singleTouchMoved:true,now:[null,null,null,null,null,null],earlier:[null,null,null,null,null,null]};r.redraws=0;r.showFps=options.showFps;r.debug=options.debug;r.hideEdgesOnViewport=options.hideEdgesOnViewport;r.hideLabelsOnViewport=options.hideLabelsOnViewport;r.textureOnViewport=options.textureOnViewport;r.wheelSensitivity=options.wheelSensitivity;r.motionBlurEnabled=options.motionBlur;r.forcedPixelRatio=number(options.pixelRatio)?options.pixelRatio:null;r.motionBlur=options.motionBlur;r.motionBlurOpacity=options.motionBlurOpacity;r.motionBlurTransparency=1-r.motionBlurOpacity;r.motionBlurPxRatio=1;r.mbPxRBlurry=1;r.minMbLowQualFrames=4;r.fullQualityMb=false;r.clearedForMotionBlur=[];r.desktopTapThreshold=options.desktopTapThreshold;r.desktopTapThreshold2=options.desktopTapThreshold*options.desktopTapThreshold;r.touchTapThreshold=options.touchTapThreshold;r.touchTapThreshold2=options.touchTapThreshold*options.touchTapThreshold;r.tapholdDuration=500;r.bindings=[];r.beforeRenderCallbacks=[];r.beforeRenderPriorities={animations:400,eleCalcs:300,eleTxrDeq:200,lyrTxrDeq:150,lyrTxrSkip:100};r.registerNodeShapes();r.registerArrowShapes();r.registerCalculationListeners()};BRp$f.notify=function(eventName,eles){var r=this;var cy=r.cy;if(this.destroyed){return}if(eventName==="init"){r.load();return}if(eventName==="destroy"){r.destroy();return}if(eventName==="add"||eventName==="remove"||eventName==="move"&&cy.hasCompoundNodes()||eventName==="load"||eventName==="zorder"||eventName==="mount"){r.invalidateCachedZSortedEles()}if(eventName==="viewport"){r.redrawHint("select",true)}if(eventName==="load"||eventName==="resize"||eventName==="mount"){r.invalidateContainerClientCoordsCache();r.matchCanvasSize(r.container)}r.redrawHint("eles",true);r.redrawHint("drag",true);this.startRenderLoop();this.redraw()};BRp$f.destroy=function(){var r=this;r.destroyed=true;r.cy.stopAnimationLoop();for(var i=0;i<r.bindings.length;i++){var binding=r.bindings[i];var b=binding;var tgt=b.target;(tgt.off||tgt.removeEventListener).apply(tgt,b.args)}r.bindings=[];r.beforeRenderCallbacks=[];r.onUpdateEleCalcsFns=[];if(r.removeObserver){r.removeObserver.disconnect()}if(r.styleObserver){r.styleObserver.disconnect()}if(r.resizeObserver){r.resizeObserver.disconnect()}if(r.labelCalcDiv){try{document.body.removeChild(r.labelCalcDiv)}catch(e){}}};BRp$f.isHeadless=function(){return false};[BRp,BRp$a,BRp$b,BRp$c,BRp$d,BRp$e].forEach((function(props){extend(BRp$f,props)}));var fullFpsTime=1e3/60;var defs={setupDequeueing:function setupDequeueing(opts){return function setupDequeueingImpl(){var self=this;var r=this.renderer;if(self.dequeueingSetup){return}else{self.dequeueingSetup=true}var queueRedraw=util((function(){r.redrawHint("eles",true);r.redrawHint("drag",true);r.redraw()}),opts.deqRedrawThreshold);var dequeue=function dequeue(willDraw,frameStartTime){var startTime=performanceNow();var avgRenderTime=r.averageRedrawTime;var renderTime=r.lastRedrawTime;var deqd=[];var extent=r.cy.extent();var pixelRatio=r.getPixelRatio();if(!willDraw){r.flushRenderedStyleQueue()}while(true){var now=performanceNow();var duration=now-startTime;var frameDuration=now-frameStartTime;if(renderTime<fullFpsTime){var timeAvailable=fullFpsTime-(willDraw?avgRenderTime:0);if(frameDuration>=opts.deqFastCost*timeAvailable){break}}else{if(willDraw){if(duration>=opts.deqCost*renderTime||duration>=opts.deqAvgCost*avgRenderTime){break}}else if(frameDuration>=opts.deqNoDrawCost*fullFpsTime){break}}var thisDeqd=opts.deq(self,pixelRatio,extent);if(thisDeqd.length>0){for(var i=0;i<thisDeqd.length;i++){deqd.push(thisDeqd[i])}}else{break}}if(deqd.length>0){opts.onDeqd(self,deqd);if(!willDraw&&opts.shouldRedraw(self,deqd,pixelRatio,extent)){queueRedraw()}}};var priority=opts.priority||noop;r.beforeRender(dequeue,priority(self))}}};var ElementTextureCacheLookup=function(){function ElementTextureCacheLookup(getKey){var doesEleInvalidateKey=arguments.length>1&&arguments[1]!==undefined?arguments[1]:falsify;_classCallCheck(this,ElementTextureCacheLookup);this.idsByKey=new Map$1;this.keyForId=new Map$1;this.cachesByLvl=new Map$1;this.lvls=[];this.getKey=getKey;this.doesEleInvalidateKey=doesEleInvalidateKey}_createClass(ElementTextureCacheLookup,[{key:"getIdsFor",value:function getIdsFor(key){if(key==null){error("Can not get id list for null key")}var idsByKey=this.idsByKey;var ids=this.idsByKey.get(key);if(!ids){ids=new Set$1;idsByKey.set(key,ids)}return ids}},{key:"addIdForKey",value:function addIdForKey(key,id){if(key!=null){this.getIdsFor(key).add(id)}}},{key:"deleteIdForKey",value:function deleteIdForKey(key,id){if(key!=null){this.getIdsFor(key)["delete"](id)}}},{key:"getNumberOfIdsForKey",value:function getNumberOfIdsForKey(key){if(key==null){return 0}else{return this.getIdsFor(key).size}}},{key:"updateKeyMappingFor",value:function updateKeyMappingFor(ele){var id=ele.id();var prevKey=this.keyForId.get(id);var currKey=this.getKey(ele);this.deleteIdForKey(prevKey,id);this.addIdForKey(currKey,id);this.keyForId.set(id,currKey)}},{key:"deleteKeyMappingFor",value:function deleteKeyMappingFor(ele){var id=ele.id();var prevKey=this.keyForId.get(id);this.deleteIdForKey(prevKey,id);this.keyForId["delete"](id)}},{key:"keyHasChangedFor",value:function keyHasChangedFor(ele){var id=ele.id();var prevKey=this.keyForId.get(id);var newKey=this.getKey(ele);return prevKey!==newKey}},{key:"isInvalid",value:function isInvalid(ele){return this.keyHasChangedFor(ele)||this.doesEleInvalidateKey(ele)}},{key:"getCachesAt",value:function getCachesAt(lvl){var cachesByLvl=this.cachesByLvl,lvls=this.lvls;var caches=cachesByLvl.get(lvl);if(!caches){caches=new Map$1;cachesByLvl.set(lvl,caches);lvls.push(lvl)}return caches}},{key:"getCache",value:function getCache(key,lvl){return this.getCachesAt(lvl).get(key)}},{key:"get",value:function get(ele,lvl){var key=this.getKey(ele);var cache=this.getCache(key,lvl);if(cache!=null){this.updateKeyMappingFor(ele)}return cache}},{key:"getForCachedKey",value:function getForCachedKey(ele,lvl){var key=this.keyForId.get(ele.id());var cache=this.getCache(key,lvl);return cache}},{key:"hasCache",value:function hasCache(key,lvl){return this.getCachesAt(lvl).has(key)}},{key:"has",value:function has(ele,lvl){var key=this.getKey(ele);return this.hasCache(key,lvl)}},{key:"setCache",value:function setCache(key,lvl,cache){cache.key=key;this.getCachesAt(lvl).set(key,cache)}},{key:"set",value:function set(ele,lvl,cache){var key=this.getKey(ele);this.setCache(key,lvl,cache);this.updateKeyMappingFor(ele)}},{key:"deleteCache",value:function deleteCache(key,lvl){this.getCachesAt(lvl)["delete"](key)}},{key:"delete",value:function _delete(ele,lvl){var key=this.getKey(ele);this.deleteCache(key,lvl)}},{key:"invalidateKey",value:function invalidateKey(key){var _this=this;this.lvls.forEach((function(lvl){return _this.deleteCache(key,lvl)}))}},{key:"invalidate",value:function invalidate(ele){var id=ele.id();var key=this.keyForId.get(id);this.deleteKeyMappingFor(ele);var entireKeyInvalidated=this.doesEleInvalidateKey(ele);if(entireKeyInvalidated){this.invalidateKey(key)}return entireKeyInvalidated||this.getNumberOfIdsForKey(key)===0}}]);return ElementTextureCacheLookup}();var minTxrH=25;var txrStepH=50;var minLvl=-4;var maxLvl=3;var maxZoom=7.99;var eleTxrSpacing=8;var defTxrWidth=1024;var maxTxrW=1024;var maxTxrH=1024;var minUtility=.2;var maxFullness=.8;var maxFullnessChecks=10;var deqCost=.15;var deqAvgCost=.1;var deqNoDrawCost=.9;var deqFastCost=.9;var deqRedrawThreshold=100;var maxDeqSize=1;var getTxrReasons={dequeue:"dequeue",downscale:"downscale",highQuality:"highQuality"};var initDefaults=defaults({getKey:null,doesEleInvalidateKey:falsify,drawElement:null,getBoundingBox:null,getRotationPoint:null,getRotationOffset:null,isVisible:trueify,allowEdgeTxrCaching:true,allowParentTxrCaching:true});var ElementTextureCache=function ElementTextureCache(renderer,initOptions){var self=this;self.renderer=renderer;self.onDequeues=[];var opts=initDefaults(initOptions);extend(self,opts);self.lookup=new ElementTextureCacheLookup(opts.getKey,opts.doesEleInvalidateKey);self.setupDequeueing()};var ETCp=ElementTextureCache.prototype;ETCp.reasons=getTxrReasons;ETCp.getTextureQueue=function(txrH){var self=this;self.eleImgCaches=self.eleImgCaches||{};return self.eleImgCaches[txrH]=self.eleImgCaches[txrH]||[]};ETCp.getRetiredTextureQueue=function(txrH){var self=this;var rtxtrQs=self.eleImgCaches.retired=self.eleImgCaches.retired||{};var rtxtrQ=rtxtrQs[txrH]=rtxtrQs[txrH]||[];return rtxtrQ};ETCp.getElementQueue=function(){var self=this;var q=self.eleCacheQueue=self.eleCacheQueue||new Heap((function(a,b){return b.reqs-a.reqs}));return q};ETCp.getElementKeyToQueue=function(){var self=this;var k2q=self.eleKeyToCacheQueue=self.eleKeyToCacheQueue||{};return k2q};ETCp.getElement=function(ele,bb,pxRatio,lvl,reason){var self=this;var r=this.renderer;var zoom=r.cy.zoom();var lookup=this.lookup;if(bb.w===0||bb.h===0||isNaN(bb.w)||isNaN(bb.h)||!ele.visible()){return null}if(!self.allowEdgeTxrCaching&&ele.isEdge()||!self.allowParentTxrCaching&&ele.isParent()){return null}if(lvl==null){lvl=Math.ceil(log2(zoom*pxRatio))}if(lvl<minLvl){lvl=minLvl}else if(zoom>=maxZoom||lvl>maxLvl){return null}var scale=Math.pow(2,lvl);var eleScaledH=bb.h*scale;var eleScaledW=bb.w*scale;var scaledLabelShown=r.eleTextBiggerThanMin(ele,scale);if(!this.isVisible(ele,scaledLabelShown)){return null}var eleCache=lookup.get(ele,lvl);if(eleCache&&eleCache.invalidated){eleCache.invalidated=false;eleCache.texture.invalidatedWidth-=eleCache.width}if(eleCache){return eleCache}var txrH;if(eleScaledH<=minTxrH){txrH=minTxrH}else if(eleScaledH<=txrStepH){txrH=txrStepH}else{txrH=Math.ceil(eleScaledH/txrStepH)*txrStepH}if(eleScaledH>maxTxrH||eleScaledW>maxTxrW){return null}var txrQ=self.getTextureQueue(txrH);var txr=txrQ[txrQ.length-2];var addNewTxr=function addNewTxr(){return self.recycleTexture(txrH,eleScaledW)||self.addTexture(txrH,eleScaledW)};if(!txr){txr=txrQ[txrQ.length-1]}if(!txr){txr=addNewTxr()}if(txr.width-txr.usedWidth<eleScaledW){txr=addNewTxr()}var scalableFrom=function scalableFrom(otherCache){return otherCache&&otherCache.scaledLabelShown===scaledLabelShown};var deqing=reason&&reason===getTxrReasons.dequeue;var highQualityReq=reason&&reason===getTxrReasons.highQuality;var downscaleReq=reason&&reason===getTxrReasons.downscale;var higherCache;for(var l=lvl+1;l<=maxLvl;l++){var c=lookup.get(ele,l);if(c){higherCache=c;break}}var oneUpCache=higherCache&&higherCache.level===lvl+1?higherCache:null;var downscale=function downscale(){txr.context.drawImage(oneUpCache.texture.canvas,oneUpCache.x,0,oneUpCache.width,oneUpCache.height,txr.usedWidth,0,eleScaledW,eleScaledH)};txr.context.setTransform(1,0,0,1,0,0);txr.context.clearRect(txr.usedWidth,0,eleScaledW,txrH);if(scalableFrom(oneUpCache)){downscale()}else if(scalableFrom(higherCache)){if(highQualityReq){for(var _l=higherCache.level;_l>lvl;_l--){oneUpCache=self.getElement(ele,bb,pxRatio,_l,getTxrReasons.downscale)}downscale()}else{self.queueElement(ele,higherCache.level-1);return higherCache}}else{var lowerCache;if(!deqing&&!highQualityReq&&!downscaleReq){for(var _l2=lvl-1;_l2>=minLvl;_l2--){var _c=lookup.get(ele,_l2);if(_c){lowerCache=_c;break}}}if(scalableFrom(lowerCache)){self.queueElement(ele,lvl);return lowerCache}txr.context.translate(txr.usedWidth,0);txr.context.scale(scale,scale);this.drawElement(txr.context,ele,bb,scaledLabelShown,false);txr.context.scale(1/scale,1/scale);txr.context.translate(-txr.usedWidth,0)}eleCache={x:txr.usedWidth,texture:txr,level:lvl,scale:scale,width:eleScaledW,height:eleScaledH,scaledLabelShown:scaledLabelShown};txr.usedWidth+=Math.ceil(eleScaledW+eleTxrSpacing);txr.eleCaches.push(eleCache);lookup.set(ele,lvl,eleCache);self.checkTextureFullness(txr);return eleCache};ETCp.invalidateElements=function(eles){for(var i=0;i<eles.length;i++){this.invalidateElement(eles[i])}};ETCp.invalidateElement=function(ele){var self=this;var lookup=self.lookup;var caches=[];var invalid=lookup.isInvalid(ele);if(!invalid){return}for(var lvl=minLvl;lvl<=maxLvl;lvl++){var cache=lookup.getForCachedKey(ele,lvl);if(cache){caches.push(cache)}}var noOtherElesUseCache=lookup.invalidate(ele);if(noOtherElesUseCache){for(var i=0;i<caches.length;i++){var _cache=caches[i];var txr=_cache.texture;txr.invalidatedWidth+=_cache.width;_cache.invalidated=true;self.checkTextureUtility(txr)}}self.removeFromQueue(ele)};ETCp.checkTextureUtility=function(txr){if(txr.invalidatedWidth>=minUtility*txr.width){this.retireTexture(txr)}};ETCp.checkTextureFullness=function(txr){var self=this;var txrQ=self.getTextureQueue(txr.height);if(txr.usedWidth/txr.width>maxFullness&&txr.fullnessChecks>=maxFullnessChecks){removeFromArray(txrQ,txr)}else{txr.fullnessChecks++}};ETCp.retireTexture=function(txr){var self=this;var txrH=txr.height;var txrQ=self.getTextureQueue(txrH);var lookup=this.lookup;removeFromArray(txrQ,txr);txr.retired=true;var eleCaches=txr.eleCaches;for(var i=0;i<eleCaches.length;i++){var eleCache=eleCaches[i];lookup.deleteCache(eleCache.key,eleCache.level)}clearArray(eleCaches);var rtxtrQ=self.getRetiredTextureQueue(txrH);rtxtrQ.push(txr)};ETCp.addTexture=function(txrH,minW){var self=this;var txrQ=self.getTextureQueue(txrH);var txr={};txrQ.push(txr);txr.eleCaches=[];txr.height=txrH;txr.width=Math.max(defTxrWidth,minW);txr.usedWidth=0;txr.invalidatedWidth=0;txr.fullnessChecks=0;txr.canvas=self.renderer.makeOffscreenCanvas(txr.width,txr.height);txr.context=txr.canvas.getContext("2d");return txr};ETCp.recycleTexture=function(txrH,minW){var self=this;var txrQ=self.getTextureQueue(txrH);var rtxtrQ=self.getRetiredTextureQueue(txrH);for(var i=0;i<rtxtrQ.length;i++){var txr=rtxtrQ[i];if(txr.width>=minW){txr.retired=false;txr.usedWidth=0;txr.invalidatedWidth=0;txr.fullnessChecks=0;clearArray(txr.eleCaches);txr.context.setTransform(1,0,0,1,0,0);txr.context.clearRect(0,0,txr.width,txr.height);removeFromArray(rtxtrQ,txr);txrQ.push(txr);return txr}}};ETCp.queueElement=function(ele,lvl){var self=this;var q=self.getElementQueue();var k2q=self.getElementKeyToQueue();var key=this.getKey(ele);var existingReq=k2q[key];if(existingReq){existingReq.level=Math.max(existingReq.level,lvl);existingReq.eles.merge(ele);existingReq.reqs++;q.updateItem(existingReq)}else{var req={eles:ele.spawn().merge(ele),level:lvl,reqs:1,key:key};q.push(req);k2q[key]=req}};ETCp.dequeue=function(pxRatio){var self=this;var q=self.getElementQueue();var k2q=self.getElementKeyToQueue();var dequeued=[];var lookup=self.lookup;for(var i=0;i<maxDeqSize;i++){if(q.size()>0){var req=q.pop();var key=req.key;var ele=req.eles[0];var cacheExists=lookup.hasCache(ele,req.level);k2q[key]=null;if(cacheExists){continue}dequeued.push(req);var bb=self.getBoundingBox(ele);self.getElement(ele,bb,pxRatio,req.level,getTxrReasons.dequeue)}else{break}}return dequeued};ETCp.removeFromQueue=function(ele){var self=this;var q=self.getElementQueue();var k2q=self.getElementKeyToQueue();var key=this.getKey(ele);var req=k2q[key];if(req!=null){if(req.eles.length===1){req.reqs=MAX_INT;q.updateItem(req);q.pop();k2q[key]=null}else{req.eles.unmerge(ele)}}};ETCp.onDequeue=function(fn){this.onDequeues.push(fn)};ETCp.offDequeue=function(fn){removeFromArray(this.onDequeues,fn)};ETCp.setupDequeueing=defs.setupDequeueing({deqRedrawThreshold:deqRedrawThreshold,deqCost:deqCost,deqAvgCost:deqAvgCost,deqNoDrawCost:deqNoDrawCost,deqFastCost:deqFastCost,deq:function deq(self,pxRatio,extent){return self.dequeue(pxRatio,extent)},onDeqd:function onDeqd(self,deqd){for(var i=0;i<self.onDequeues.length;i++){var fn=self.onDequeues[i];fn(deqd)}},shouldRedraw:function shouldRedraw(self,deqd,pxRatio,extent){for(var i=0;i<deqd.length;i++){var eles=deqd[i].eles;for(var j=0;j<eles.length;j++){var bb=eles[j].boundingBox();if(boundingBoxesIntersect(bb,extent)){return true}}}return false},priority:function priority(self){return self.renderer.beforeRenderPriorities.eleTxrDeq}});var defNumLayers=1;var minLvl$1=-4;var maxLvl$1=2;var maxZoom$1=3.99;var deqRedrawThreshold$1=50;var refineEleDebounceTime=50;var deqCost$1=.15;var deqAvgCost$1=.1;var deqNoDrawCost$1=.9;var deqFastCost$1=.9;var maxDeqSize$1=1;var invalidThreshold=250;var maxLayerArea=4e3*4e3;var useHighQualityEleTxrReqs=true;var LayeredTextureCache=function LayeredTextureCache(renderer){var self=this;var r=self.renderer=renderer;var cy=r.cy;self.layersByLevel={};self.firstGet=true;self.lastInvalidationTime=performanceNow()-2*invalidThreshold;self.skipping=false;self.eleTxrDeqs=cy.collection();self.scheduleElementRefinement=util((function(){self.refineElementTextures(self.eleTxrDeqs);self.eleTxrDeqs.unmerge(self.eleTxrDeqs)}),refineEleDebounceTime);r.beforeRender((function(willDraw,now){if(now-self.lastInvalidationTime<=invalidThreshold){self.skipping=true}else{self.skipping=false}}),r.beforeRenderPriorities.lyrTxrSkip);var qSort=function qSort(a,b){return b.reqs-a.reqs};self.layersQueue=new Heap(qSort);self.setupDequeueing()};var LTCp=LayeredTextureCache.prototype;var layerIdPool=0;var MAX_INT$1=Math.pow(2,53)-1;LTCp.makeLayer=function(bb,lvl){var scale=Math.pow(2,lvl);var w=Math.ceil(bb.w*scale);var h=Math.ceil(bb.h*scale);var canvas=this.renderer.makeOffscreenCanvas(w,h);var layer={id:layerIdPool=++layerIdPool%MAX_INT$1,bb:bb,level:lvl,width:w,height:h,canvas:canvas,context:canvas.getContext("2d"),eles:[],elesQueue:[],reqs:0};var cxt=layer.context;var dx=-layer.bb.x1;var dy=-layer.bb.y1;cxt.scale(scale,scale);cxt.translate(dx,dy);return layer};LTCp.getLayers=function(eles,pxRatio,lvl){var self=this;var r=self.renderer;var cy=r.cy;var zoom=cy.zoom();var firstGet=self.firstGet;self.firstGet=false;if(lvl==null){lvl=Math.ceil(log2(zoom*pxRatio));if(lvl<minLvl$1){lvl=minLvl$1}else if(zoom>=maxZoom$1||lvl>maxLvl$1){return null}}self.validateLayersElesOrdering(lvl,eles);var layersByLvl=self.layersByLevel;var scale=Math.pow(2,lvl);var layers=layersByLvl[lvl]=layersByLvl[lvl]||[];var bb;var lvlComplete=self.levelIsComplete(lvl,eles);var tmpLayers;var checkTempLevels=function checkTempLevels(){var canUseAsTmpLvl=function canUseAsTmpLvl(l){self.validateLayersElesOrdering(l,eles);if(self.levelIsComplete(l,eles)){tmpLayers=layersByLvl[l];return true}};var checkLvls=function checkLvls(dir){if(tmpLayers){return}for(var l=lvl+dir;minLvl$1<=l&&l<=maxLvl$1;l+=dir){if(canUseAsTmpLvl(l)){break}}};checkLvls(+1);checkLvls(-1);for(var i=layers.length-1;i>=0;i--){var layer=layers[i];if(layer.invalid){removeFromArray(layers,layer)}}};if(!lvlComplete){checkTempLevels()}else{return layers}var getBb=function getBb(){if(!bb){bb=makeBoundingBox();for(var i=0;i<eles.length;i++){updateBoundingBox(bb,eles[i].boundingBox())}}return bb};var makeLayer=function makeLayer(opts){opts=opts||{};var after=opts.after;getBb();var area=bb.w*scale*(bb.h*scale);if(area>maxLayerArea){return null}var layer=self.makeLayer(bb,lvl);if(after!=null){var index=layers.indexOf(after)+1;layers.splice(index,0,layer)}else if(opts.insert===undefined||opts.insert){layers.unshift(layer)}return layer};if(self.skipping&&!firstGet){return null}var layer=null;var maxElesPerLayer=eles.length/defNumLayers;var allowLazyQueueing=!firstGet;for(var i=0;i<eles.length;i++){var ele=eles[i];var rs=ele._private.rscratch;var caches=rs.imgLayerCaches=rs.imgLayerCaches||{};var existingLayer=caches[lvl];if(existingLayer){layer=existingLayer;continue}if(!layer||layer.eles.length>=maxElesPerLayer||!boundingBoxInBoundingBox(layer.bb,ele.boundingBox())){layer=makeLayer({insert:true,after:layer});if(!layer){return null}}if(tmpLayers||allowLazyQueueing){self.queueLayer(layer,ele)}else{self.drawEleInLayer(layer,ele,lvl,pxRatio)}layer.eles.push(ele);caches[lvl]=layer}if(tmpLayers){return tmpLayers}if(allowLazyQueueing){return null}return layers};LTCp.getEleLevelForLayerLevel=function(lvl,pxRatio){return lvl};LTCp.drawEleInLayer=function(layer,ele,lvl,pxRatio){var self=this;var r=this.renderer;var context=layer.context;var bb=ele.boundingBox();if(bb.w===0||bb.h===0||!ele.visible()){return}lvl=self.getEleLevelForLayerLevel(lvl,pxRatio);{r.setImgSmoothing(context,false)}{r.drawCachedElement(context,ele,null,null,lvl,useHighQualityEleTxrReqs)}{r.setImgSmoothing(context,true)}};LTCp.levelIsComplete=function(lvl,eles){var self=this;var layers=self.layersByLevel[lvl];if(!layers||layers.length===0){return false}var numElesInLayers=0;for(var i=0;i<layers.length;i++){var layer=layers[i];if(layer.reqs>0){return false}if(layer.invalid){return false}numElesInLayers+=layer.eles.length}if(numElesInLayers!==eles.length){return false}return true};LTCp.validateLayersElesOrdering=function(lvl,eles){var layers=this.layersByLevel[lvl];if(!layers){return}for(var i=0;i<layers.length;i++){var layer=layers[i];var offset=-1;for(var j=0;j<eles.length;j++){if(layer.eles[0]===eles[j]){offset=j;break}}if(offset<0){this.invalidateLayer(layer);continue}var o=offset;for(var j=0;j<layer.eles.length;j++){if(layer.eles[j]!==eles[o+j]){this.invalidateLayer(layer);break}}}};LTCp.updateElementsInLayers=function(eles,update){var self=this;var isEles=element(eles[0]);for(var i=0;i<eles.length;i++){var req=isEles?null:eles[i];var ele=isEles?eles[i]:eles[i].ele;var rs=ele._private.rscratch;var caches=rs.imgLayerCaches=rs.imgLayerCaches||{};for(var l=minLvl$1;l<=maxLvl$1;l++){var layer=caches[l];if(!layer){continue}if(req&&self.getEleLevelForLayerLevel(layer.level)!==req.level){continue}update(layer,ele,req)}}};LTCp.haveLayers=function(){var self=this;var haveLayers=false;for(var l=minLvl$1;l<=maxLvl$1;l++){var layers=self.layersByLevel[l];if(layers&&layers.length>0){haveLayers=true;break}}return haveLayers};LTCp.invalidateElements=function(eles){var self=this;if(eles.length===0){return}self.lastInvalidationTime=performanceNow();if(eles.length===0||!self.haveLayers()){return}self.updateElementsInLayers(eles,(function invalAssocLayers(layer,ele,req){self.invalidateLayer(layer)}))};LTCp.invalidateLayer=function(layer){this.lastInvalidationTime=performanceNow();if(layer.invalid){return}var lvl=layer.level;var eles=layer.eles;var layers=this.layersByLevel[lvl];removeFromArray(layers,layer);layer.elesQueue=[];layer.invalid=true;if(layer.replacement){layer.replacement.invalid=true}for(var i=0;i<eles.length;i++){var caches=eles[i]._private.rscratch.imgLayerCaches;if(caches){caches[lvl]=null}}};LTCp.refineElementTextures=function(eles){var self=this;self.updateElementsInLayers(eles,(function refineEachEle(layer,ele,req){var rLyr=layer.replacement;if(!rLyr){rLyr=layer.replacement=self.makeLayer(layer.bb,layer.level);rLyr.replaces=layer;rLyr.eles=layer.eles}if(!rLyr.reqs){for(var i=0;i<rLyr.eles.length;i++){self.queueLayer(rLyr,rLyr.eles[i])}}}))};LTCp.enqueueElementRefinement=function(ele){this.eleTxrDeqs.merge(ele);this.scheduleElementRefinement()};LTCp.queueLayer=function(layer,ele){var self=this;var q=self.layersQueue;var elesQ=layer.elesQueue;var hasId=elesQ.hasId=elesQ.hasId||{};if(layer.replacement){return}if(ele){if(hasId[ele.id()]){return}elesQ.push(ele);hasId[ele.id()]=true}if(layer.reqs){layer.reqs++;q.updateItem(layer)}else{layer.reqs=1;q.push(layer)}};LTCp.dequeue=function(pxRatio){var self=this;var q=self.layersQueue;var deqd=[];var eleDeqs=0;while(eleDeqs<maxDeqSize$1){if(q.size()===0){break}var layer=q.peek();if(layer.replacement){q.pop();continue}if(layer.replaces&&layer!==layer.replaces.replacement){q.pop();continue}if(layer.invalid){q.pop();continue}var ele=layer.elesQueue.shift();if(ele){self.drawEleInLayer(layer,ele,layer.level,pxRatio);eleDeqs++}if(deqd.length===0){deqd.push(true)}if(layer.elesQueue.length===0){q.pop();layer.reqs=0;if(layer.replaces){self.applyLayerReplacement(layer)}self.requestRedraw()}}return deqd};LTCp.applyLayerReplacement=function(layer){var self=this;var layersInLevel=self.layersByLevel[layer.level];var replaced=layer.replaces;var index=layersInLevel.indexOf(replaced);if(index<0||replaced.invalid){return}layersInLevel[index]=layer;for(var i=0;i<layer.eles.length;i++){var _p=layer.eles[i]._private;var cache=_p.imgLayerCaches=_p.imgLayerCaches||{};if(cache){cache[layer.level]=layer}}self.requestRedraw()};LTCp.requestRedraw=util((function(){var r=this.renderer;r.redrawHint("eles",true);r.redrawHint("drag",true);r.redraw()}),100);LTCp.setupDequeueing=defs.setupDequeueing({deqRedrawThreshold:deqRedrawThreshold$1,deqCost:deqCost$1,deqAvgCost:deqAvgCost$1,deqNoDrawCost:deqNoDrawCost$1,deqFastCost:deqFastCost$1,deq:function deq(self,pxRatio){return self.dequeue(pxRatio)},onDeqd:noop,shouldRedraw:trueify,priority:function priority(self){return self.renderer.beforeRenderPriorities.lyrTxrDeq}});var CRp={};var impl;function polygon(context,points){for(var i=0;i<points.length;i++){var pt=points[i];context.lineTo(pt.x,pt.y)}}function triangleBackcurve(context,points,controlPoint){var firstPt;for(var i=0;i<points.length;i++){var pt=points[i];if(i===0){firstPt=pt}context.lineTo(pt.x,pt.y)}context.quadraticCurveTo(controlPoint.x,controlPoint.y,firstPt.x,firstPt.y)}function triangleTee(context,trianglePoints,teePoints){if(context.beginPath){context.beginPath()}var triPts=trianglePoints;for(var i=0;i<triPts.length;i++){var pt=triPts[i];context.lineTo(pt.x,pt.y)}var teePts=teePoints;var firstTeePt=teePoints[0];context.moveTo(firstTeePt.x,firstTeePt.y);for(var i=1;i<teePts.length;i++){var pt=teePts[i];context.lineTo(pt.x,pt.y)}if(context.closePath){context.closePath()}}function circle(context,rx,ry,r){context.arc(rx,ry,r,0,Math.PI*2,false)}CRp.arrowShapeImpl=function(name){return(impl||(impl={polygon:polygon,"triangle-backcurve":triangleBackcurve,"triangle-tee":triangleTee,"triangle-cross":triangleTee,circle:circle}))[name]};var CRp$1={};CRp$1.drawElement=function(context,ele,shiftToOriginWithBb,showLabel,showOverlay,showOpacity){var r=this;if(ele.isNode()){r.drawNode(context,ele,shiftToOriginWithBb,showLabel,showOverlay,showOpacity)}else{r.drawEdge(context,ele,shiftToOriginWithBb,showLabel,showOverlay,showOpacity)}};CRp$1.drawElementOverlay=function(context,ele){var r=this;if(ele.isNode()){r.drawNodeOverlay(context,ele)}else{r.drawEdgeOverlay(context,ele)}};CRp$1.drawCachedElementPortion=function(context,ele,eleTxrCache,pxRatio,lvl,reason,getRotation,getOpacity){var r=this;var bb=eleTxrCache.getBoundingBox(ele);if(bb.w===0||bb.h===0){return}var eleCache=eleTxrCache.getElement(ele,bb,pxRatio,lvl,reason);if(eleCache!=null){var opacity=getOpacity(r,ele);if(opacity===0){return}var theta=getRotation(r,ele);var x1=bb.x1,y1=bb.y1,w=bb.w,h=bb.h;var x,y,sx,sy,smooth;if(theta!==0){var rotPt=eleTxrCache.getRotationPoint(ele);sx=rotPt.x;sy=rotPt.y;context.translate(sx,sy);context.rotate(theta);smooth=r.getImgSmoothing(context);if(!smooth){r.setImgSmoothing(context,true)}var off=eleTxrCache.getRotationOffset(ele);x=off.x;y=off.y}else{x=x1;y=y1}var oldGlobalAlpha;if(opacity!==1){oldGlobalAlpha=context.globalAlpha;context.globalAlpha=oldGlobalAlpha*opacity}context.drawImage(eleCache.texture.canvas,eleCache.x,0,eleCache.width,eleCache.height,x,y,w,h);if(opacity!==1){context.globalAlpha=oldGlobalAlpha}if(theta!==0){context.rotate(-theta);context.translate(-sx,-sy);if(!smooth){r.setImgSmoothing(context,false)}}}else{eleTxrCache.drawElement(context,ele)}};var getZeroRotation=function getZeroRotation(){return 0};var getLabelRotation=function getLabelRotation(r,ele){return r.getTextAngle(ele,null)};var getSourceLabelRotation=function getSourceLabelRotation(r,ele){return r.getTextAngle(ele,"source")};var getTargetLabelRotation=function getTargetLabelRotation(r,ele){return r.getTextAngle(ele,"target")};var getOpacity=function getOpacity(r,ele){return ele.effectiveOpacity()};var getTextOpacity=function getTextOpacity(e,ele){return ele.pstyle("text-opacity").pfValue*ele.effectiveOpacity()};CRp$1.drawCachedElement=function(context,ele,pxRatio,extent,lvl,requestHighQuality){var r=this;var _r$data=r.data,eleTxrCache=_r$data.eleTxrCache,lblTxrCache=_r$data.lblTxrCache,slbTxrCache=_r$data.slbTxrCache,tlbTxrCache=_r$data.tlbTxrCache;var bb=ele.boundingBox();var reason=requestHighQuality===true?eleTxrCache.reasons.highQuality:null;if(bb.w===0||bb.h===0||!ele.visible()){return}if(!extent||boundingBoxesIntersect(bb,extent)){r.drawCachedElementPortion(context,ele,eleTxrCache,pxRatio,lvl,reason,getZeroRotation,getOpacity);r.drawCachedElementPortion(context,ele,lblTxrCache,pxRatio,lvl,reason,getLabelRotation,getTextOpacity);if(ele.isEdge()){r.drawCachedElementPortion(context,ele,slbTxrCache,pxRatio,lvl,reason,getSourceLabelRotation,getTextOpacity);r.drawCachedElementPortion(context,ele,tlbTxrCache,pxRatio,lvl,reason,getTargetLabelRotation,getTextOpacity)}r.drawElementOverlay(context,ele)}};CRp$1.drawElements=function(context,eles){var r=this;for(var i=0;i<eles.length;i++){var ele=eles[i];r.drawElement(context,ele)}};CRp$1.drawCachedElements=function(context,eles,pxRatio,extent){var r=this;for(var i=0;i<eles.length;i++){var ele=eles[i];r.drawCachedElement(context,ele,pxRatio,extent)}};CRp$1.drawCachedNodes=function(context,eles,pxRatio,extent){var r=this;for(var i=0;i<eles.length;i++){var ele=eles[i];if(!ele.isNode()){continue}r.drawCachedElement(context,ele,pxRatio,extent)}};CRp$1.drawLayeredElements=function(context,eles,pxRatio,extent){var r=this;var layers=r.data.lyrTxrCache.getLayers(eles,pxRatio);if(layers){for(var i=0;i<layers.length;i++){var layer=layers[i];var bb=layer.bb;if(bb.w===0||bb.h===0){continue}context.drawImage(layer.canvas,bb.x1,bb.y1,bb.w,bb.h)}}else{r.drawCachedElements(context,eles,pxRatio,extent)}};var CRp$2={};CRp$2.drawEdge=function(context,edge,shiftToOriginWithBb){var drawLabel=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var shouldDrawOverlay=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var shouldDrawOpacity=arguments.length>5&&arguments[5]!==undefined?arguments[5]:true;var r=this;var rs=edge._private.rscratch;if(shouldDrawOpacity&&!edge.visible()){return}if(rs.badLine||rs.allpts==null||isNaN(rs.allpts[0])){return}var bb;if(shiftToOriginWithBb){bb=shiftToOriginWithBb;context.translate(-bb.x1,-bb.y1)}var opacity=shouldDrawOpacity?edge.pstyle("opacity").value:1;var lineStyle=edge.pstyle("line-style").value;var edgeWidth=edge.pstyle("width").pfValue;var lineCap=edge.pstyle("line-cap").value;var drawLine=function drawLine(){var strokeOpacity=arguments.length>0&&arguments[0]!==undefined?arguments[0]:opacity;context.lineWidth=edgeWidth;context.lineCap=lineCap;r.eleStrokeStyle(context,edge,strokeOpacity);r.drawEdgePath(edge,context,rs.allpts,lineStyle);context.lineCap="butt"};var drawOverlay=function drawOverlay(){if(!shouldDrawOverlay){return}r.drawEdgeOverlay(context,edge)};var drawArrows=function drawArrows(){var arrowOpacity=arguments.length>0&&arguments[0]!==undefined?arguments[0]:opacity;r.drawArrowheads(context,edge,arrowOpacity)};var drawText=function drawText(){r.drawElementText(context,edge,null,drawLabel)};context.lineJoin="round";var ghost=edge.pstyle("ghost").value==="yes";if(ghost){var gx=edge.pstyle("ghost-offset-x").pfValue;var gy=edge.pstyle("ghost-offset-y").pfValue;var ghostOpacity=edge.pstyle("ghost-opacity").value;var effectiveGhostOpacity=opacity*ghostOpacity;context.translate(gx,gy);drawLine(effectiveGhostOpacity);drawArrows(effectiveGhostOpacity);context.translate(-gx,-gy)}drawLine();drawArrows();drawOverlay();drawText();if(shiftToOriginWithBb){context.translate(bb.x1,bb.y1)}};CRp$2.drawEdgeOverlay=function(context,edge){if(!edge.visible()){return}var overlayOpacity=edge.pstyle("overlay-opacity").value;if(overlayOpacity===0){return}var r=this;var usePaths=r.usePaths();var rs=edge._private.rscratch;var overlayPadding=edge.pstyle("overlay-padding").pfValue;var overlayWidth=2*overlayPadding;var overlayColor=edge.pstyle("overlay-color").value;context.lineWidth=overlayWidth;if(rs.edgeType==="self"&&!usePaths){context.lineCap="butt"}else{context.lineCap="round"}r.colorStrokeStyle(context,overlayColor[0],overlayColor[1],overlayColor[2],overlayOpacity);r.drawEdgePath(edge,context,rs.allpts,"solid")};CRp$2.drawEdgePath=function(edge,context,pts,type){var rs=edge._private.rscratch;var canvasCxt=context;var path;var pathCacheHit=false;var usePaths=this.usePaths();var lineDashPattern=edge.pstyle("line-dash-pattern").pfValue;var lineDashOffset=edge.pstyle("line-dash-offset").pfValue;if(usePaths){var pathCacheKey=pts.join("$");var keyMatches=rs.pathCacheKey&&rs.pathCacheKey===pathCacheKey;if(keyMatches){path=context=rs.pathCache;pathCacheHit=true}else{path=context=new Path2D;rs.pathCacheKey=pathCacheKey;rs.pathCache=path}}if(canvasCxt.setLineDash){switch(type){case"dotted":canvasCxt.setLineDash([1,1]);break;case"dashed":canvasCxt.setLineDash(lineDashPattern);canvasCxt.lineDashOffset=lineDashOffset;break;case"solid":canvasCxt.setLineDash([]);break}}if(!pathCacheHit&&!rs.badLine){if(context.beginPath){context.beginPath()}context.moveTo(pts[0],pts[1]);switch(rs.edgeType){case"bezier":case"self":case"compound":case"multibezier":for(var i=2;i+3<pts.length;i+=4){context.quadraticCurveTo(pts[i],pts[i+1],pts[i+2],pts[i+3])}break;case"straight":case"segments":case"haystack":for(var _i=2;_i+1<pts.length;_i+=2){context.lineTo(pts[_i],pts[_i+1])}break}}context=canvasCxt;if(usePaths){context.stroke(path)}else{context.stroke()}if(context.setLineDash){context.setLineDash([])}};CRp$2.drawArrowheads=function(context,edge,opacity){var rs=edge._private.rscratch;var isHaystack=rs.edgeType==="haystack";if(!isHaystack){this.drawArrowhead(context,edge,"source",rs.arrowStartX,rs.arrowStartY,rs.srcArrowAngle,opacity)}this.drawArrowhead(context,edge,"mid-target",rs.midX,rs.midY,rs.midtgtArrowAngle,opacity);this.drawArrowhead(context,edge,"mid-source",rs.midX,rs.midY,rs.midsrcArrowAngle,opacity);if(!isHaystack){this.drawArrowhead(context,edge,"target",rs.arrowEndX,rs.arrowEndY,rs.tgtArrowAngle,opacity)}};CRp$2.drawArrowhead=function(context,edge,prefix,x,y,angle,opacity){if(isNaN(x)||x==null||isNaN(y)||y==null||isNaN(angle)||angle==null){return}var self=this;var arrowShape=edge.pstyle(prefix+"-arrow-shape").value;if(arrowShape==="none"){return}var arrowClearFill=edge.pstyle(prefix+"-arrow-fill").value==="hollow"?"both":"filled";var arrowFill=edge.pstyle(prefix+"-arrow-fill").value;var edgeWidth=edge.pstyle("width").pfValue;var edgeOpacity=edge.pstyle("opacity").value;if(opacity===undefined){opacity=edgeOpacity}var gco=context.globalCompositeOperation;if(opacity!==1||arrowFill==="hollow"){context.globalCompositeOperation="destination-out";self.colorFillStyle(context,255,255,255,1);self.colorStrokeStyle(context,255,255,255,1);self.drawArrowShape(edge,context,arrowClearFill,edgeWidth,arrowShape,x,y,angle);context.globalCompositeOperation=gco}var color=edge.pstyle(prefix+"-arrow-color").value;self.colorFillStyle(context,color[0],color[1],color[2],opacity);self.colorStrokeStyle(context,color[0],color[1],color[2],opacity);self.drawArrowShape(edge,context,arrowFill,edgeWidth,arrowShape,x,y,angle)};CRp$2.drawArrowShape=function(edge,context,fill,edgeWidth,shape,x,y,angle){var r=this;var usePaths=this.usePaths()&&shape!=="triangle-cross";var pathCacheHit=false;var path;var canvasContext=context;var translation={x:x,y:y};var scale=edge.pstyle("arrow-scale").value;var size=this.getArrowWidth(edgeWidth,scale);var shapeImpl=r.arrowShapes[shape];if(usePaths){var cache=r.arrowPathCache=r.arrowPathCache||[];var key=hashString(shape);var cachedPath=cache[key];if(cachedPath!=null){path=context=cachedPath;pathCacheHit=true}else{path=context=new Path2D;cache[key]=path}}if(context.beginPath){context.beginPath()}if(!pathCacheHit){if(usePaths){shapeImpl.draw(context,1,0,{x:0,y:0},1)}else{shapeImpl.draw(context,size,angle,translation,edgeWidth)}}if(context.closePath){context.closePath()}context=canvasContext;if(usePaths){context.translate(x,y);context.rotate(angle);context.scale(size,size)}if(fill==="filled"||fill==="both"){if(usePaths){context.fill(path)}else{context.fill()}}if(fill==="hollow"||fill==="both"){context.lineWidth=(shapeImpl.matchEdgeWidth?edgeWidth:1)/(usePaths?size:1);context.lineJoin="miter";if(usePaths){context.stroke(path)}else{context.stroke()}}if(usePaths){context.scale(1/size,1/size);context.rotate(-angle);context.translate(-x,-y)}};var CRp$3={};CRp$3.safeDrawImage=function(context,img,ix,iy,iw,ih,x,y,w,h){if(iw<=0||ih<=0||w<=0||h<=0){return}context.drawImage(img,ix,iy,iw,ih,x,y,w,h)};CRp$3.drawInscribedImage=function(context,img,node,index,nodeOpacity){var r=this;var pos=node.position();var nodeX=pos.x;var nodeY=pos.y;var styleObj=node.cy().style();var getIndexedStyle=styleObj.getIndexedStyle.bind(styleObj);var fit=getIndexedStyle(node,"background-fit","value",index);var repeat=getIndexedStyle(node,"background-repeat","value",index);var nodeW=node.width();var nodeH=node.height();var paddingX2=node.padding()*2;var nodeTW=nodeW+(getIndexedStyle(node,"background-width-relative-to","value",index)==="inner"?0:paddingX2);var nodeTH=nodeH+(getIndexedStyle(node,"background-height-relative-to","value",index)==="inner"?0:paddingX2);var rs=node._private.rscratch;var clip=getIndexedStyle(node,"background-clip","value",index);var shouldClip=clip==="node";var imgOpacity=getIndexedStyle(node,"background-image-opacity","value",index)*nodeOpacity;var imgW=img.width||img.cachedW;var imgH=img.height||img.cachedH;if(null==imgW||null==imgH){document.body.appendChild(img);imgW=img.cachedW=img.width||img.offsetWidth;imgH=img.cachedH=img.height||img.offsetHeight;document.body.removeChild(img)}var w=imgW;var h=imgH;if(getIndexedStyle(node,"background-width","value",index)!=="auto"){if(getIndexedStyle(node,"background-width","units",index)==="%"){w=getIndexedStyle(node,"background-width","pfValue",index)*nodeTW}else{w=getIndexedStyle(node,"background-width","pfValue",index)}}if(getIndexedStyle(node,"background-height","value",index)!=="auto"){if(getIndexedStyle(node,"background-height","units",index)==="%"){h=getIndexedStyle(node,"background-height","pfValue",index)*nodeTH}else{h=getIndexedStyle(node,"background-height","pfValue",index)}}if(w===0||h===0){return}if(fit==="contain"){var scale=Math.min(nodeTW/w,nodeTH/h);w*=scale;h*=scale}else if(fit==="cover"){var scale=Math.max(nodeTW/w,nodeTH/h);w*=scale;h*=scale}var x=nodeX-nodeTW/2;var posXUnits=getIndexedStyle(node,"background-position-x","units",index);var posXPfVal=getIndexedStyle(node,"background-position-x","pfValue",index);if(posXUnits==="%"){x+=(nodeTW-w)*posXPfVal}else{x+=posXPfVal}var offXUnits=getIndexedStyle(node,"background-offset-x","units",index);var offXPfVal=getIndexedStyle(node,"background-offset-x","pfValue",index);if(offXUnits==="%"){x+=(nodeTW-w)*offXPfVal}else{x+=offXPfVal}var y=nodeY-nodeTH/2;var posYUnits=getIndexedStyle(node,"background-position-y","units",index);var posYPfVal=getIndexedStyle(node,"background-position-y","pfValue",index);if(posYUnits==="%"){y+=(nodeTH-h)*posYPfVal}else{y+=posYPfVal}var offYUnits=getIndexedStyle(node,"background-offset-y","units",index);var offYPfVal=getIndexedStyle(node,"background-offset-y","pfValue",index);if(offYUnits==="%"){y+=(nodeTH-h)*offYPfVal}else{y+=offYPfVal}if(rs.pathCache){x-=nodeX;y-=nodeY;nodeX=0;nodeY=0}var gAlpha=context.globalAlpha;context.globalAlpha=imgOpacity;if(repeat==="no-repeat"){if(shouldClip){context.save();if(rs.pathCache){context.clip(rs.pathCache)}else{r.nodeShapes[r.getNodeShape(node)].draw(context,nodeX,nodeY,nodeTW,nodeTH);context.clip()}}r.safeDrawImage(context,img,0,0,imgW,imgH,x,y,w,h);if(shouldClip){context.restore()}}else{var pattern=context.createPattern(img,repeat);context.fillStyle=pattern;r.nodeShapes[r.getNodeShape(node)].draw(context,nodeX,nodeY,nodeTW,nodeTH);context.translate(x,y);context.fill();context.translate(-x,-y)}context.globalAlpha=gAlpha};var CRp$4={};CRp$4.eleTextBiggerThanMin=function(ele,scale){if(!scale){var zoom=ele.cy().zoom();var pxRatio=this.getPixelRatio();var lvl=Math.ceil(log2(zoom*pxRatio));scale=Math.pow(2,lvl)}var computedSize=ele.pstyle("font-size").pfValue*scale;var minSize=ele.pstyle("min-zoomed-font-size").pfValue;if(computedSize<minSize){return false}return true};CRp$4.drawElementText=function(context,ele,shiftToOriginWithBb,force,prefix){var useEleOpacity=arguments.length>5&&arguments[5]!==undefined?arguments[5]:true;var r=this;if(force==null){if(useEleOpacity&&!r.eleTextBiggerThanMin(ele)){return}}else if(force===false){return}if(ele.isNode()){var label=ele.pstyle("label");if(!label||!label.value){return}var justification=r.getLabelJustification(ele);context.textAlign=justification;context.textBaseline="bottom"}else{var _label=ele.pstyle("label");var srcLabel=ele.pstyle("source-label");var tgtLabel=ele.pstyle("target-label");if((!_label||!_label.value)&&(!srcLabel||!srcLabel.value)&&(!tgtLabel||!tgtLabel.value)){return}context.textAlign="center";context.textBaseline="bottom"}var applyRotation=!shiftToOriginWithBb;var bb;if(shiftToOriginWithBb){bb=shiftToOriginWithBb;context.translate(-bb.x1,-bb.y1)}if(prefix==null){r.drawText(context,ele,null,applyRotation,useEleOpacity);if(ele.isEdge()){r.drawText(context,ele,"source",applyRotation,useEleOpacity);r.drawText(context,ele,"target",applyRotation,useEleOpacity)}}else{r.drawText(context,ele,prefix,applyRotation,useEleOpacity)}if(shiftToOriginWithBb){context.translate(bb.x1,bb.y1)}};CRp$4.getFontCache=function(context){var cache;this.fontCaches=this.fontCaches||[];for(var i=0;i<this.fontCaches.length;i++){cache=this.fontCaches[i];if(cache.context===context){return cache}}cache={context:context};this.fontCaches.push(cache);return cache};CRp$4.setupTextStyle=function(context,ele){var useEleOpacity=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var labelStyle=ele.pstyle("font-style").strValue;var labelSize=ele.pstyle("font-size").pfValue+"px";var labelFamily=ele.pstyle("font-family").strValue;var labelWeight=ele.pstyle("font-weight").strValue;var opacity=useEleOpacity?ele.effectiveOpacity()*ele.pstyle("text-opacity").value:1;var outlineOpacity=ele.pstyle("text-outline-opacity").value*opacity;var color=ele.pstyle("color").value;var outlineColor=ele.pstyle("text-outline-color").value;context.font=labelStyle+" "+labelWeight+" "+labelSize+" "+labelFamily;context.lineJoin="round";this.colorFillStyle(context,color[0],color[1],color[2],opacity);this.colorStrokeStyle(context,outlineColor[0],outlineColor[1],outlineColor[2],outlineOpacity)};function roundRect(ctx,x,y,width,height){var radius=arguments.length>5&&arguments[5]!==undefined?arguments[5]:5;ctx.beginPath();ctx.moveTo(x+radius,y);ctx.lineTo(x+width-radius,y);ctx.quadraticCurveTo(x+width,y,x+width,y+radius);ctx.lineTo(x+width,y+height-radius);ctx.quadraticCurveTo(x+width,y+height,x+width-radius,y+height);ctx.lineTo(x+radius,y+height);ctx.quadraticCurveTo(x,y+height,x,y+height-radius);ctx.lineTo(x,y+radius);ctx.quadraticCurveTo(x,y,x+radius,y);ctx.closePath();ctx.fill()}CRp$4.getTextAngle=function(ele,prefix){var theta;var _p=ele._private;var rscratch=_p.rscratch;var pdash=prefix?prefix+"-":"";var rotation=ele.pstyle(pdash+"text-rotation");var textAngle=getPrefixedProperty(rscratch,"labelAngle",prefix);if(rotation.strValue==="autorotate"){theta=ele.isEdge()?textAngle:0}else if(rotation.strValue==="none"){theta=0}else{theta=rotation.pfValue}return theta};CRp$4.drawText=function(context,ele,prefix){var applyRotation=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var useEleOpacity=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var _p=ele._private;var rscratch=_p.rscratch;var parentOpacity=useEleOpacity?ele.effectiveOpacity():1;if(useEleOpacity&&(parentOpacity===0||ele.pstyle("text-opacity").value===0)){return}if(prefix==="main"){prefix=null}var textX=getPrefixedProperty(rscratch,"labelX",prefix);var textY=getPrefixedProperty(rscratch,"labelY",prefix);var orgTextX,orgTextY;var text=this.getLabelText(ele,prefix);if(text!=null&&text!==""&&!isNaN(textX)&&!isNaN(textY)){this.setupTextStyle(context,ele,useEleOpacity);var pdash=prefix?prefix+"-":"";var textW=getPrefixedProperty(rscratch,"labelWidth",prefix);var textH=getPrefixedProperty(rscratch,"labelHeight",prefix);var marginX=ele.pstyle(pdash+"text-margin-x").pfValue;var marginY=ele.pstyle(pdash+"text-margin-y").pfValue;var isEdge=ele.isEdge();var halign=ele.pstyle("text-halign").value;var valign=ele.pstyle("text-valign").value;if(isEdge){halign="center";valign="center"}textX+=marginX;textY+=marginY;var theta;if(!applyRotation){theta=0}else{theta=this.getTextAngle(ele,prefix)}if(theta!==0){orgTextX=textX;orgTextY=textY;context.translate(orgTextX,orgTextY);context.rotate(theta);textX=0;textY=0}switch(valign){case"top":break;case"center":textY+=textH/2;break;case"bottom":textY+=textH;break}var backgroundOpacity=ele.pstyle("text-background-opacity").value;var borderOpacity=ele.pstyle("text-border-opacity").value;var textBorderWidth=ele.pstyle("text-border-width").pfValue;var backgroundPadding=ele.pstyle("text-background-padding").pfValue;if(backgroundOpacity>0||textBorderWidth>0&&borderOpacity>0){var bgX=textX-backgroundPadding;switch(halign){case"left":bgX-=textW;break;case"center":bgX-=textW/2;break;case"right":break}var bgY=textY-textH-backgroundPadding;var bgW=textW+2*backgroundPadding;var bgH=textH+2*backgroundPadding;if(backgroundOpacity>0){var textFill=context.fillStyle;var textBackgroundColor=ele.pstyle("text-background-color").value;context.fillStyle="rgba("+textBackgroundColor[0]+","+textBackgroundColor[1]+","+textBackgroundColor[2]+","+backgroundOpacity*parentOpacity+")";var styleShape=ele.pstyle("text-background-shape").strValue;if(styleShape=="roundrectangle"){roundRect(context,bgX,bgY,bgW,bgH,2)}else{context.fillRect(bgX,bgY,bgW,bgH)}context.fillStyle=textFill}if(textBorderWidth>0&&borderOpacity>0){var textStroke=context.strokeStyle;var textLineWidth=context.lineWidth;var textBorderColor=ele.pstyle("text-border-color").value;var textBorderStyle=ele.pstyle("text-border-style").value;context.strokeStyle="rgba("+textBorderColor[0]+","+textBorderColor[1]+","+textBorderColor[2]+","+borderOpacity*parentOpacity+")";context.lineWidth=textBorderWidth;if(context.setLineDash){switch(textBorderStyle){case"dotted":context.setLineDash([1,1]);break;case"dashed":context.setLineDash([4,2]);break;case"double":context.lineWidth=textBorderWidth/4;context.setLineDash([]);break;case"solid":context.setLineDash([]);break}}context.strokeRect(bgX,bgY,bgW,bgH);if(textBorderStyle==="double"){var whiteWidth=textBorderWidth/2;context.strokeRect(bgX+whiteWidth,bgY+whiteWidth,bgW-whiteWidth*2,bgH-whiteWidth*2)}if(context.setLineDash){context.setLineDash([])}context.lineWidth=textLineWidth;context.strokeStyle=textStroke}}var lineWidth=2*ele.pstyle("text-outline-width").pfValue;if(lineWidth>0){context.lineWidth=lineWidth}if(ele.pstyle("text-wrap").value==="wrap"){var lines=getPrefixedProperty(rscratch,"labelWrapCachedLines",prefix);var lineHeight=getPrefixedProperty(rscratch,"labelLineHeight",prefix);var halfTextW=textW/2;var justification=this.getLabelJustification(ele);if(justification==="auto");else if(halign==="left"){if(justification==="left"){textX+=-textW}else if(justification==="center"){textX+=-halfTextW}}else if(halign==="center"){if(justification==="left"){textX+=-halfTextW}else if(justification==="right"){textX+=halfTextW}}else if(halign==="right"){if(justification==="center"){textX+=halfTextW}else if(justification==="right"){textX+=textW}}switch(valign){case"top":textY-=(lines.length-1)*lineHeight;break;case"center":case"bottom":textY-=(lines.length-1)*lineHeight;break}for(var l=0;l<lines.length;l++){if(lineWidth>0){context.strokeText(lines[l],textX,textY)}context.fillText(lines[l],textX,textY);textY+=lineHeight}}else{if(lineWidth>0){context.strokeText(text,textX,textY)}context.fillText(text,textX,textY)}if(theta!==0){context.rotate(-theta);context.translate(-orgTextX,-orgTextY)}}};var CRp$5={};CRp$5.drawNode=function(context,node,shiftToOriginWithBb){var drawLabel=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var shouldDrawOverlay=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var shouldDrawOpacity=arguments.length>5&&arguments[5]!==undefined?arguments[5]:true;var r=this;var nodeWidth,nodeHeight;var _p=node._private;var rs=_p.rscratch;var pos=node.position();if(!number(pos.x)||!number(pos.y)){return}if(shouldDrawOpacity&&!node.visible()){return}var eleOpacity=shouldDrawOpacity?node.effectiveOpacity():1;var usePaths=r.usePaths();var path;var pathCacheHit=false;var padding=node.padding();nodeWidth=node.width()+2*padding;nodeHeight=node.height()+2*padding;var bb;if(shiftToOriginWithBb){bb=shiftToOriginWithBb;context.translate(-bb.x1,-bb.y1)}var bgImgProp=node.pstyle("background-image");var urls=bgImgProp.value;var urlDefined=new Array(urls.length);var image=new Array(urls.length);var numImages=0;for(var i=0;i<urls.length;i++){var url=urls[i];var defd=urlDefined[i]=url!=null&&url!=="none";if(defd){var bgImgCrossOrigin=node.cy().style().getIndexedStyle(node,"background-image-crossorigin","value",i);numImages++;image[i]=r.getCachedImage(url,bgImgCrossOrigin,(function(){_p.backgroundTimestamp=Date.now();node.emitAndNotify("background")}))}}var darkness=node.pstyle("background-blacken").value;var borderWidth=node.pstyle("border-width").pfValue;var bgOpacity=node.pstyle("background-opacity").value*eleOpacity;var borderColor=node.pstyle("border-color").value;var borderStyle=node.pstyle("border-style").value;var borderOpacity=node.pstyle("border-opacity").value*eleOpacity;context.lineJoin="miter";var setupShapeColor=function setupShapeColor(){var bgOpy=arguments.length>0&&arguments[0]!==undefined?arguments[0]:bgOpacity;r.eleFillStyle(context,node,bgOpy)};var setupBorderColor=function setupBorderColor(){var bdrOpy=arguments.length>0&&arguments[0]!==undefined?arguments[0]:borderOpacity;r.colorStrokeStyle(context,borderColor[0],borderColor[1],borderColor[2],bdrOpy)};var styleShape=node.pstyle("shape").strValue;var shapePts=node.pstyle("shape-polygon-points").pfValue;if(usePaths){context.translate(pos.x,pos.y);var pathCache=r.nodePathCache=r.nodePathCache||[];var key=hashStrings(styleShape==="polygon"?styleShape+","+shapePts.join(","):styleShape,""+nodeHeight,""+nodeWidth);var cachedPath=pathCache[key];if(cachedPath!=null){path=cachedPath;pathCacheHit=true;rs.pathCache=path}else{path=new Path2D;pathCache[key]=rs.pathCache=path}}var drawShape=function drawShape(){if(!pathCacheHit){var npos=pos;if(usePaths){npos={x:0,y:0}}r.nodeShapes[r.getNodeShape(node)].draw(path||context,npos.x,npos.y,nodeWidth,nodeHeight)}if(usePaths){context.fill(path)}else{context.fill()}};var drawImages=function drawImages(){var nodeOpacity=arguments.length>0&&arguments[0]!==undefined?arguments[0]:eleOpacity;var prevBging=_p.backgrounding;var totalCompleted=0;for(var _i=0;_i<image.length;_i++){if(urlDefined[_i]&&image[_i].complete&&!image[_i].error){totalCompleted++;r.drawInscribedImage(context,image[_i],node,_i,nodeOpacity)}}_p.backgrounding=!(totalCompleted===numImages);if(prevBging!==_p.backgrounding){node.updateStyle(false)}};var drawPie=function drawPie(){var redrawShape=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var pieOpacity=arguments.length>1&&arguments[1]!==undefined?arguments[1]:eleOpacity;if(r.hasPie(node)){r.drawPie(context,node,pieOpacity);if(redrawShape){if(!usePaths){r.nodeShapes[r.getNodeShape(node)].draw(context,pos.x,pos.y,nodeWidth,nodeHeight)}}}};var darken=function darken(){var darkenOpacity=arguments.length>0&&arguments[0]!==undefined?arguments[0]:eleOpacity;var opacity=(darkness>0?darkness:-darkness)*darkenOpacity;var c=darkness>0?0:255;if(darkness!==0){r.colorFillStyle(context,c,c,c,opacity);if(usePaths){context.fill(path)}else{context.fill()}}};var drawBorder=function drawBorder(){if(borderWidth>0){context.lineWidth=borderWidth;context.lineCap="butt";if(context.setLineDash){switch(borderStyle){case"dotted":context.setLineDash([1,1]);break;case"dashed":context.setLineDash([4,2]);break;case"solid":case"double":context.setLineDash([]);break}}if(usePaths){context.stroke(path)}else{context.stroke()}if(borderStyle==="double"){context.lineWidth=borderWidth/3;var gco=context.globalCompositeOperation;context.globalCompositeOperation="destination-out";if(usePaths){context.stroke(path)}else{context.stroke()}context.globalCompositeOperation=gco}if(context.setLineDash){context.setLineDash([])}}};var drawOverlay=function drawOverlay(){if(shouldDrawOverlay){r.drawNodeOverlay(context,node,pos,nodeWidth,nodeHeight)}};var drawText=function drawText(){r.drawElementText(context,node,null,drawLabel)};var ghost=node.pstyle("ghost").value==="yes";if(ghost){var gx=node.pstyle("ghost-offset-x").pfValue;var gy=node.pstyle("ghost-offset-y").pfValue;var ghostOpacity=node.pstyle("ghost-opacity").value;var effGhostOpacity=ghostOpacity*eleOpacity;context.translate(gx,gy);setupShapeColor(ghostOpacity*bgOpacity);drawShape();drawImages(effGhostOpacity);drawPie(darkness!==0||borderWidth!==0);darken(effGhostOpacity);setupBorderColor(ghostOpacity*borderOpacity);drawBorder();context.translate(-gx,-gy)}setupShapeColor();drawShape();drawImages();drawPie(darkness!==0||borderWidth!==0);darken();setupBorderColor();drawBorder();if(usePaths){context.translate(-pos.x,-pos.y)}drawText();drawOverlay();if(shiftToOriginWithBb){context.translate(bb.x1,bb.y1)}};CRp$5.drawNodeOverlay=function(context,node,pos,nodeWidth,nodeHeight){var r=this;if(!node.visible()){return}var overlayPadding=node.pstyle("overlay-padding").pfValue;var overlayOpacity=node.pstyle("overlay-opacity").value;var overlayColor=node.pstyle("overlay-color").value;if(overlayOpacity>0){pos=pos||node.position();if(nodeWidth==null||nodeHeight==null){var padding=node.padding();nodeWidth=node.width()+2*padding;nodeHeight=node.height()+2*padding}r.colorFillStyle(context,overlayColor[0],overlayColor[1],overlayColor[2],overlayOpacity);r.nodeShapes["roundrectangle"].draw(context,pos.x,pos.y,nodeWidth+overlayPadding*2,nodeHeight+overlayPadding*2);context.fill()}};CRp$5.hasPie=function(node){node=node[0];return node._private.hasPie};CRp$5.drawPie=function(context,node,nodeOpacity,pos){node=node[0];pos=pos||node.position();var cyStyle=node.cy().style();var pieSize=node.pstyle("pie-size");var x=pos.x;var y=pos.y;var nodeW=node.width();var nodeH=node.height();var radius=Math.min(nodeW,nodeH)/2;var lastPercent=0;var usePaths=this.usePaths();if(usePaths){x=0;y=0}if(pieSize.units==="%"){radius=radius*pieSize.pfValue}else if(pieSize.pfValue!==undefined){radius=pieSize.pfValue/2}for(var i=1;i<=cyStyle.pieBackgroundN;i++){var size=node.pstyle("pie-"+i+"-background-size").value;var color=node.pstyle("pie-"+i+"-background-color").value;var opacity=node.pstyle("pie-"+i+"-background-opacity").value*nodeOpacity;var percent=size/100;if(percent+lastPercent>1){percent=1-lastPercent}var angleStart=1.5*Math.PI+2*Math.PI*lastPercent;var angleDelta=2*Math.PI*percent;var angleEnd=angleStart+angleDelta;if(size===0||lastPercent>=1||lastPercent+percent>1){continue}context.beginPath();context.moveTo(x,y);context.arc(x,y,radius,angleStart,angleEnd);context.closePath();this.colorFillStyle(context,color[0],color[1],color[2],opacity);context.fill();lastPercent+=percent}};var CRp$6={};var motionBlurDelay=100;CRp$6.getPixelRatio=function(){var context=this.data.contexts[0];if(this.forcedPixelRatio!=null){return this.forcedPixelRatio}var backingStore=context.backingStorePixelRatio||context.webkitBackingStorePixelRatio||context.mozBackingStorePixelRatio||context.msBackingStorePixelRatio||context.oBackingStorePixelRatio||context.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/backingStore};CRp$6.paintCache=function(context){var caches=this.paintCaches=this.paintCaches||[];var needToCreateCache=true;var cache;for(var i=0;i<caches.length;i++){cache=caches[i];if(cache.context===context){needToCreateCache=false;break}}if(needToCreateCache){cache={context:context};caches.push(cache)}return cache};CRp$6.createGradientStyleFor=function(context,shapeStyleName,ele,fill,opacity){var gradientStyle;var usePaths=this.usePaths();var colors=ele.pstyle(shapeStyleName+"-gradient-stop-colors").value,positions=ele.pstyle(shapeStyleName+"-gradient-stop-positions").pfValue;if(fill==="radial-gradient"){if(ele.isEdge()){var start=ele.sourceEndpoint(),end=ele.targetEndpoint(),mid=ele.midpoint();var d1=dist(start,mid);var d2=dist(end,mid);gradientStyle=context.createRadialGradient(mid.x,mid.y,0,mid.x,mid.y,Math.max(d1,d2))}else{var pos=usePaths?{x:0,y:0}:ele.position(),width=ele.paddedWidth(),height=ele.paddedHeight();gradientStyle=context.createRadialGradient(pos.x,pos.y,0,pos.x,pos.y,Math.max(width,height))}}else{if(ele.isEdge()){var _start=ele.sourceEndpoint(),_end=ele.targetEndpoint();gradientStyle=context.createLinearGradient(_start.x,_start.y,_end.x,_end.y)}else{var _pos=usePaths?{x:0,y:0}:ele.position(),_width=ele.paddedWidth(),_height=ele.paddedHeight(),halfWidth=_width/2,halfHeight=_height/2;var direction=ele.pstyle("background-gradient-direction").value;switch(direction){case"to-bottom":gradientStyle=context.createLinearGradient(_pos.x,_pos.y-halfHeight,_pos.x,_pos.y+halfHeight);break;case"to-top":gradientStyle=context.createLinearGradient(_pos.x,_pos.y+halfHeight,_pos.x,_pos.y-halfHeight);break;case"to-left":gradientStyle=context.createLinearGradient(_pos.x+halfWidth,_pos.y,_pos.x-halfWidth,_pos.y);break;case"to-right":gradientStyle=context.createLinearGradient(_pos.x-halfWidth,_pos.y,_pos.x+halfWidth,_pos.y);break;case"to-bottom-right":case"to-right-bottom":gradientStyle=context.createLinearGradient(_pos.x-halfWidth,_pos.y-halfHeight,_pos.x+halfWidth,_pos.y+halfHeight);break;case"to-top-right":case"to-right-top":gradientStyle=context.createLinearGradient(_pos.x-halfWidth,_pos.y+halfHeight,_pos.x+halfWidth,_pos.y-halfHeight);break;case"to-bottom-left":case"to-left-bottom":gradientStyle=context.createLinearGradient(_pos.x+halfWidth,_pos.y-halfHeight,_pos.x-halfWidth,_pos.y+halfHeight);break;case"to-top-left":case"to-left-top":gradientStyle=context.createLinearGradient(_pos.x+halfWidth,_pos.y+halfHeight,_pos.x-halfWidth,_pos.y-halfHeight);break}}}if(!gradientStyle)return null;var hasPositions=positions.length===colors.length;var length=colors.length;for(var i=0;i<length;i++){gradientStyle.addColorStop(hasPositions?positions[i]:i/(length-1),"rgba("+colors[i][0]+","+colors[i][1]+","+colors[i][2]+","+opacity+")")}return gradientStyle};CRp$6.gradientFillStyle=function(context,ele,fill,opacity){var gradientStyle=this.createGradientStyleFor(context,"background",ele,fill,opacity);if(!gradientStyle)return null;context.fillStyle=gradientStyle};CRp$6.colorFillStyle=function(context,r,g,b,a){context.fillStyle="rgba("+r+","+g+","+b+","+a+")"};CRp$6.eleFillStyle=function(context,ele,opacity){var backgroundFill=ele.pstyle("background-fill").value;if(backgroundFill==="linear-gradient"||backgroundFill==="radial-gradient"){this.gradientFillStyle(context,ele,backgroundFill,opacity)}else{var backgroundColor=ele.pstyle("background-color").value;this.colorFillStyle(context,backgroundColor[0],backgroundColor[1],backgroundColor[2],opacity)}};CRp$6.gradientStrokeStyle=function(context,ele,fill,opacity){var gradientStyle=this.createGradientStyleFor(context,"line",ele,fill,opacity);if(!gradientStyle)return null;context.strokeStyle=gradientStyle};CRp$6.colorStrokeStyle=function(context,r,g,b,a){context.strokeStyle="rgba("+r+","+g+","+b+","+a+")"};CRp$6.eleStrokeStyle=function(context,ele,opacity){var lineFill=ele.pstyle("line-fill").value;if(lineFill==="linear-gradient"||lineFill==="radial-gradient"){this.gradientStrokeStyle(context,ele,lineFill,opacity)}else{var lineColor=ele.pstyle("line-color").value;this.colorStrokeStyle(context,lineColor[0],lineColor[1],lineColor[2],opacity)}};CRp$6.matchCanvasSize=function(container){var r=this;var data=r.data;var bb=r.findContainerClientCoords();var width=bb[2];var height=bb[3];var pixelRatio=r.getPixelRatio();var mbPxRatio=r.motionBlurPxRatio;if(container===r.data.bufferCanvases[r.MOTIONBLUR_BUFFER_NODE]||container===r.data.bufferCanvases[r.MOTIONBLUR_BUFFER_DRAG]){pixelRatio=mbPxRatio}var canvasWidth=width*pixelRatio;var canvasHeight=height*pixelRatio;var canvas;if(canvasWidth===r.canvasWidth&&canvasHeight===r.canvasHeight){return}r.fontCaches=null;var canvasContainer=data.canvasContainer;canvasContainer.style.width=width+"px";canvasContainer.style.height=height+"px";for(var i=0;i<r.CANVAS_LAYERS;i++){canvas=data.canvases[i];canvas.width=canvasWidth;canvas.height=canvasHeight;canvas.style.width=width+"px";canvas.style.height=height+"px"}for(var i=0;i<r.BUFFER_COUNT;i++){canvas=data.bufferCanvases[i];canvas.width=canvasWidth;canvas.height=canvasHeight;canvas.style.width=width+"px";canvas.style.height=height+"px"}r.textureMult=1;if(pixelRatio<=1){canvas=data.bufferCanvases[r.TEXTURE_BUFFER];r.textureMult=2;canvas.width=canvasWidth*r.textureMult;canvas.height=canvasHeight*r.textureMult}r.canvasWidth=canvasWidth;r.canvasHeight=canvasHeight};CRp$6.renderTo=function(cxt,zoom,pan,pxRatio){this.render({forcedContext:cxt,forcedZoom:zoom,forcedPan:pan,drawAllLayers:true,forcedPxRatio:pxRatio})};CRp$6.render=function(options){options=options||staticEmptyObject();var forcedContext=options.forcedContext;var drawAllLayers=options.drawAllLayers;var drawOnlyNodeLayer=options.drawOnlyNodeLayer;var forcedZoom=options.forcedZoom;var forcedPan=options.forcedPan;var r=this;var pixelRatio=options.forcedPxRatio===undefined?this.getPixelRatio():options.forcedPxRatio;var cy=r.cy;var data=r.data;var needDraw=data.canvasNeedsRedraw;var textureDraw=r.textureOnViewport&&!forcedContext&&(r.pinching||r.hoverData.dragging||r.swipePanning||r.data.wheelZooming);var motionBlur=options.motionBlur!==undefined?options.motionBlur:r.motionBlur;var mbPxRatio=r.motionBlurPxRatio;var hasCompoundNodes=cy.hasCompoundNodes();var inNodeDragGesture=r.hoverData.draggingEles;var inBoxSelection=r.hoverData.selecting||r.touchData.selecting?true:false;motionBlur=motionBlur&&!forcedContext&&r.motionBlurEnabled&&!inBoxSelection;var motionBlurFadeEffect=motionBlur;if(!forcedContext){if(r.prevPxRatio!==pixelRatio){r.invalidateContainerClientCoordsCache();r.matchCanvasSize(r.container);r.redrawHint("eles",true);r.redrawHint("drag",true)}r.prevPxRatio=pixelRatio}if(!forcedContext&&r.motionBlurTimeout){clearTimeout(r.motionBlurTimeout)}if(motionBlur){if(r.mbFrames==null){r.mbFrames=0}r.mbFrames++;if(r.mbFrames<3){motionBlurFadeEffect=false}if(r.mbFrames>r.minMbLowQualFrames){r.motionBlurPxRatio=r.mbPxRBlurry}}if(r.clearingMotionBlur){r.motionBlurPxRatio=1}if(r.textureDrawLastFrame&&!textureDraw){needDraw[r.NODE]=true;needDraw[r.SELECT_BOX]=true}var style=cy.style();var zoom=cy.zoom();var effectiveZoom=forcedZoom!==undefined?forcedZoom:zoom;var pan=cy.pan();var effectivePan={x:pan.x,y:pan.y};var vp={zoom:zoom,pan:{x:pan.x,y:pan.y}};var prevVp=r.prevViewport;var viewportIsDiff=prevVp===undefined||vp.zoom!==prevVp.zoom||vp.pan.x!==prevVp.pan.x||vp.pan.y!==prevVp.pan.y;if(!viewportIsDiff&&!(inNodeDragGesture&&!hasCompoundNodes)){r.motionBlurPxRatio=1}if(forcedPan){effectivePan=forcedPan}effectiveZoom*=pixelRatio;effectivePan.x*=pixelRatio;effectivePan.y*=pixelRatio;var eles=r.getCachedZSortedEles();function mbclear(context,x,y,w,h){var gco=context.globalCompositeOperation;context.globalCompositeOperation="destination-out";r.colorFillStyle(context,255,255,255,r.motionBlurTransparency);context.fillRect(x,y,w,h);context.globalCompositeOperation=gco}function setContextTransform(context,clear){var ePan,eZoom,w,h;if(!r.clearingMotionBlur&&(context===data.bufferContexts[r.MOTIONBLUR_BUFFER_NODE]||context===data.bufferContexts[r.MOTIONBLUR_BUFFER_DRAG])){ePan={x:pan.x*mbPxRatio,y:pan.y*mbPxRatio};eZoom=zoom*mbPxRatio;w=r.canvasWidth*mbPxRatio;h=r.canvasHeight*mbPxRatio}else{ePan=effectivePan;eZoom=effectiveZoom;w=r.canvasWidth;h=r.canvasHeight}context.setTransform(1,0,0,1,0,0);if(clear==="motionBlur"){mbclear(context,0,0,w,h)}else if(!forcedContext&&(clear===undefined||clear)){context.clearRect(0,0,w,h)}if(!drawAllLayers){context.translate(ePan.x,ePan.y);context.scale(eZoom,eZoom)}if(forcedPan){context.translate(forcedPan.x,forcedPan.y)}if(forcedZoom){context.scale(forcedZoom,forcedZoom)}}if(!textureDraw){r.textureDrawLastFrame=false}if(textureDraw){r.textureDrawLastFrame=true;if(!r.textureCache){r.textureCache={};r.textureCache.bb=cy.mutableElements().boundingBox();r.textureCache.texture=r.data.bufferCanvases[r.TEXTURE_BUFFER];var cxt=r.data.bufferContexts[r.TEXTURE_BUFFER];cxt.setTransform(1,0,0,1,0,0);cxt.clearRect(0,0,r.canvasWidth*r.textureMult,r.canvasHeight*r.textureMult);r.render({forcedContext:cxt,drawOnlyNodeLayer:true,forcedPxRatio:pixelRatio*r.textureMult});var vp=r.textureCache.viewport={zoom:cy.zoom(),pan:cy.pan(),width:r.canvasWidth,height:r.canvasHeight};vp.mpan={x:(0-vp.pan.x)/vp.zoom,y:(0-vp.pan.y)/vp.zoom}}needDraw[r.DRAG]=false;needDraw[r.NODE]=false;var context=data.contexts[r.NODE];var texture=r.textureCache.texture;var vp=r.textureCache.viewport;context.setTransform(1,0,0,1,0,0);if(motionBlur){mbclear(context,0,0,vp.width,vp.height)}else{context.clearRect(0,0,vp.width,vp.height)}var outsideBgColor=style.core("outside-texture-bg-color").value;var outsideBgOpacity=style.core("outside-texture-bg-opacity").value;r.colorFillStyle(context,outsideBgColor[0],outsideBgColor[1],outsideBgColor[2],outsideBgOpacity);context.fillRect(0,0,vp.width,vp.height);var zoom=cy.zoom();setContextTransform(context,false);context.clearRect(vp.mpan.x,vp.mpan.y,vp.width/vp.zoom/pixelRatio,vp.height/vp.zoom/pixelRatio);context.drawImage(texture,vp.mpan.x,vp.mpan.y,vp.width/vp.zoom/pixelRatio,vp.height/vp.zoom/pixelRatio)}else if(r.textureOnViewport&&!forcedContext){r.textureCache=null}var extent=cy.extent();var vpManip=r.pinching||r.hoverData.dragging||r.swipePanning||r.data.wheelZooming||r.hoverData.draggingEles||r.cy.animated();var hideEdges=r.hideEdgesOnViewport&&vpManip;var needMbClear=[];needMbClear[r.NODE]=!needDraw[r.NODE]&&motionBlur&&!r.clearedForMotionBlur[r.NODE]||r.clearingMotionBlur;if(needMbClear[r.NODE]){r.clearedForMotionBlur[r.NODE]=true}needMbClear[r.DRAG]=!needDraw[r.DRAG]&&motionBlur&&!r.clearedForMotionBlur[r.DRAG]||r.clearingMotionBlur;if(needMbClear[r.DRAG]){r.clearedForMotionBlur[r.DRAG]=true}if(needDraw[r.NODE]||drawAllLayers||drawOnlyNodeLayer||needMbClear[r.NODE]){var useBuffer=motionBlur&&!needMbClear[r.NODE]&&mbPxRatio!==1;var context=forcedContext||(useBuffer?r.data.bufferContexts[r.MOTIONBLUR_BUFFER_NODE]:data.contexts[r.NODE]);var clear=motionBlur&&!useBuffer?"motionBlur":undefined;setContextTransform(context,clear);if(hideEdges){r.drawCachedNodes(context,eles.nondrag,pixelRatio,extent)}else{r.drawLayeredElements(context,eles.nondrag,pixelRatio,extent)}if(r.debug){r.drawDebugPoints(context,eles.nondrag)}if(!drawAllLayers&&!motionBlur){needDraw[r.NODE]=false}}if(!drawOnlyNodeLayer&&(needDraw[r.DRAG]||drawAllLayers||needMbClear[r.DRAG])){var useBuffer=motionBlur&&!needMbClear[r.DRAG]&&mbPxRatio!==1;var context=forcedContext||(useBuffer?r.data.bufferContexts[r.MOTIONBLUR_BUFFER_DRAG]:data.contexts[r.DRAG]);setContextTransform(context,motionBlur&&!useBuffer?"motionBlur":undefined);if(hideEdges){r.drawCachedNodes(context,eles.drag,pixelRatio,extent)}else{r.drawCachedElements(context,eles.drag,pixelRatio,extent)}if(r.debug){r.drawDebugPoints(context,eles.drag)}if(!drawAllLayers&&!motionBlur){needDraw[r.DRAG]=false}}if(r.showFps||!drawOnlyNodeLayer&&needDraw[r.SELECT_BOX]&&!drawAllLayers){var context=forcedContext||data.contexts[r.SELECT_BOX];setContextTransform(context);if(r.selection[4]==1&&(r.hoverData.selecting||r.touchData.selecting)){var zoom=r.cy.zoom();var borderWidth=style.core("selection-box-border-width").value/zoom;context.lineWidth=borderWidth;context.fillStyle="rgba("+style.core("selection-box-color").value[0]+","+style.core("selection-box-color").value[1]+","+style.core("selection-box-color").value[2]+","+style.core("selection-box-opacity").value+")";context.fillRect(r.selection[0],r.selection[1],r.selection[2]-r.selection[0],r.selection[3]-r.selection[1]);if(borderWidth>0){context.strokeStyle="rgba("+style.core("selection-box-border-color").value[0]+","+style.core("selection-box-border-color").value[1]+","+style.core("selection-box-border-color").value[2]+","+style.core("selection-box-opacity").value+")";context.strokeRect(r.selection[0],r.selection[1],r.selection[2]-r.selection[0],r.selection[3]-r.selection[1])}}if(data.bgActivePosistion&&!r.hoverData.selecting){var zoom=r.cy.zoom();var pos=data.bgActivePosistion;context.fillStyle="rgba("+style.core("active-bg-color").value[0]+","+style.core("active-bg-color").value[1]+","+style.core("active-bg-color").value[2]+","+style.core("active-bg-opacity").value+")";context.beginPath();context.arc(pos.x,pos.y,style.core("active-bg-size").pfValue/zoom,0,2*Math.PI);context.fill()}var timeToRender=r.lastRedrawTime;if(r.showFps&&timeToRender){timeToRender=Math.round(timeToRender);var fps=Math.round(1e3/timeToRender);context.setTransform(1,0,0,1,0,0);context.fillStyle="rgba(255, 0, 0, 0.75)";context.strokeStyle="rgba(255, 0, 0, 0.75)";context.lineWidth=1;context.fillText("1 frame = "+timeToRender+" ms = "+fps+" fps",0,20);var maxFps=60;context.strokeRect(0,30,250,20);context.fillRect(0,30,250*Math.min(fps/maxFps,1),20)}if(!drawAllLayers){needDraw[r.SELECT_BOX]=false}}if(motionBlur&&mbPxRatio!==1){var cxtNode=data.contexts[r.NODE];var txtNode=r.data.bufferCanvases[r.MOTIONBLUR_BUFFER_NODE];var cxtDrag=data.contexts[r.DRAG];var txtDrag=r.data.bufferCanvases[r.MOTIONBLUR_BUFFER_DRAG];var drawMotionBlur=function drawMotionBlur(cxt,txt,needClear){cxt.setTransform(1,0,0,1,0,0);if(needClear||!motionBlurFadeEffect){cxt.clearRect(0,0,r.canvasWidth,r.canvasHeight)}else{mbclear(cxt,0,0,r.canvasWidth,r.canvasHeight)}var pxr=mbPxRatio;cxt.drawImage(txt,0,0,r.canvasWidth*pxr,r.canvasHeight*pxr,0,0,r.canvasWidth,r.canvasHeight)};if(needDraw[r.NODE]||needMbClear[r.NODE]){drawMotionBlur(cxtNode,txtNode,needMbClear[r.NODE]);needDraw[r.NODE]=false}if(needDraw[r.DRAG]||needMbClear[r.DRAG]){drawMotionBlur(cxtDrag,txtDrag,needMbClear[r.DRAG]);needDraw[r.DRAG]=false}}r.prevViewport=vp;if(r.clearingMotionBlur){r.clearingMotionBlur=false;r.motionBlurCleared=true;r.motionBlur=true}if(motionBlur){r.motionBlurTimeout=setTimeout((function(){r.motionBlurTimeout=null;r.clearedForMotionBlur[r.NODE]=false;r.clearedForMotionBlur[r.DRAG]=false;r.motionBlur=false;r.clearingMotionBlur=!textureDraw;r.mbFrames=0;needDraw[r.NODE]=true;needDraw[r.DRAG]=true;r.redraw()}),motionBlurDelay)}if(!forcedContext){cy.emit("render")}};var CRp$7={};CRp$7.drawPolygonPath=function(context,x,y,width,height,points){var halfW=width/2;var halfH=height/2;if(context.beginPath){context.beginPath()}context.moveTo(x+halfW*points[0],y+halfH*points[1]);for(var i=1;i<points.length/2;i++){context.lineTo(x+halfW*points[i*2],y+halfH*points[i*2+1])}context.closePath()};CRp$7.drawRoundRectanglePath=function(context,x,y,width,height){var halfWidth=width/2;var halfHeight=height/2;var cornerRadius=getRoundRectangleRadius(width,height);if(context.beginPath){context.beginPath()}context.moveTo(x,y-halfHeight);context.arcTo(x+halfWidth,y-halfHeight,x+halfWidth,y,cornerRadius);context.arcTo(x+halfWidth,y+halfHeight,x,y+halfHeight,cornerRadius);context.arcTo(x-halfWidth,y+halfHeight,x-halfWidth,y,cornerRadius);context.arcTo(x-halfWidth,y-halfHeight,x,y-halfHeight,cornerRadius);context.lineTo(x,y-halfHeight);context.closePath()};CRp$7.drawBottomRoundRectanglePath=function(context,x,y,width,height){var halfWidth=width/2;var halfHeight=height/2;var cornerRadius=getRoundRectangleRadius(width,height);if(context.beginPath){context.beginPath()}context.moveTo(x,y-halfHeight);context.lineTo(x+halfWidth,y-halfHeight);context.lineTo(x+halfWidth,y);context.arcTo(x+halfWidth,y+halfHeight,x,y+halfHeight,cornerRadius);context.arcTo(x-halfWidth,y+halfHeight,x-halfWidth,y,cornerRadius);context.lineTo(x-halfWidth,y-halfHeight);context.lineTo(x,y-halfHeight);context.closePath()};CRp$7.drawCutRectanglePath=function(context,x,y,width,height){var halfWidth=width/2;var halfHeight=height/2;var cornerLength=getCutRectangleCornerLength();if(context.beginPath){context.beginPath()}context.moveTo(x-halfWidth+cornerLength,y-halfHeight);context.lineTo(x+halfWidth-cornerLength,y-halfHeight);context.lineTo(x+halfWidth,y-halfHeight+cornerLength);context.lineTo(x+halfWidth,y+halfHeight-cornerLength);context.lineTo(x+halfWidth-cornerLength,y+halfHeight);context.lineTo(x-halfWidth+cornerLength,y+halfHeight);context.lineTo(x-halfWidth,y+halfHeight-cornerLength);context.lineTo(x-halfWidth,y-halfHeight+cornerLength);context.closePath()};CRp$7.drawBarrelPath=function(context,x,y,width,height){var halfWidth=width/2;var halfHeight=height/2;var xBegin=x-halfWidth;var xEnd=x+halfWidth;var yBegin=y-halfHeight;var yEnd=y+halfHeight;var barrelCurveConstants=getBarrelCurveConstants(width,height);var wOffset=barrelCurveConstants.widthOffset;var hOffset=barrelCurveConstants.heightOffset;var ctrlPtXOffset=barrelCurveConstants.ctrlPtOffsetPct*wOffset;if(context.beginPath){context.beginPath()}context.moveTo(xBegin,yBegin+hOffset);context.lineTo(xBegin,yEnd-hOffset);context.quadraticCurveTo(xBegin+ctrlPtXOffset,yEnd,xBegin+wOffset,yEnd);context.lineTo(xEnd-wOffset,yEnd);context.quadraticCurveTo(xEnd-ctrlPtXOffset,yEnd,xEnd,yEnd-hOffset);context.lineTo(xEnd,yBegin+hOffset);context.quadraticCurveTo(xEnd-ctrlPtXOffset,yBegin,xEnd-wOffset,yBegin);context.lineTo(xBegin+wOffset,yBegin);context.quadraticCurveTo(xBegin+ctrlPtXOffset,yBegin,xBegin,yBegin+hOffset);context.closePath()};var sin0=Math.sin(0);var cos0=Math.cos(0);var sin={};var cos={};var ellipseStepSize=Math.PI/40;for(var i=0*Math.PI;i<2*Math.PI;i+=ellipseStepSize){sin[i]=Math.sin(i);cos[i]=Math.cos(i)}CRp$7.drawEllipsePath=function(context,centerX,centerY,width,height){if(context.beginPath){context.beginPath()}if(context.ellipse){context.ellipse(centerX,centerY,width/2,height/2,0,0,2*Math.PI)}else{var xPos,yPos;var rw=width/2;var rh=height/2;for(var i=0*Math.PI;i<2*Math.PI;i+=ellipseStepSize){xPos=centerX-rw*sin[i]*sin0+rw*cos[i]*cos0;yPos=centerY+rh*cos[i]*sin0+rh*sin[i]*cos0;if(i===0){context.moveTo(xPos,yPos)}else{context.lineTo(xPos,yPos)}}}context.closePath()};var CRp$8={};CRp$8.createBuffer=function(w,h){var buffer=document.createElement("canvas");buffer.width=w;buffer.height=h;return[buffer,buffer.getContext("2d")]};CRp$8.bufferCanvasImage=function(options){var cy=this.cy;var eles=cy.mutableElements();var bb=eles.boundingBox();var ctrRect=this.findContainerClientCoords();var width=options.full?Math.ceil(bb.w):ctrRect[2];var height=options.full?Math.ceil(bb.h):ctrRect[3];var specdMaxDims=number(options.maxWidth)||number(options.maxHeight);var pxRatio=this.getPixelRatio();var scale=1;if(options.scale!==undefined){width*=options.scale;height*=options.scale;scale=options.scale}else if(specdMaxDims){var maxScaleW=Infinity;var maxScaleH=Infinity;if(number(options.maxWidth)){maxScaleW=scale*options.maxWidth/width}if(number(options.maxHeight)){maxScaleH=scale*options.maxHeight/height}scale=Math.min(maxScaleW,maxScaleH);width*=scale;height*=scale}if(!specdMaxDims){width*=pxRatio;height*=pxRatio;scale*=pxRatio}var buffCanvas=document.createElement("canvas");buffCanvas.width=width;buffCanvas.height=height;buffCanvas.style.width=width+"px";buffCanvas.style.height=height+"px";var buffCxt=buffCanvas.getContext("2d");if(width>0&&height>0){buffCxt.clearRect(0,0,width,height);buffCxt.globalCompositeOperation="source-over";var zsortedEles=this.getCachedZSortedEles();if(options.full){buffCxt.translate(-bb.x1*scale,-bb.y1*scale);buffCxt.scale(scale,scale);this.drawElements(buffCxt,zsortedEles);buffCxt.scale(1/scale,1/scale);buffCxt.translate(bb.x1*scale,bb.y1*scale)}else{var pan=cy.pan();var translation={x:pan.x*scale,y:pan.y*scale};scale*=cy.zoom();buffCxt.translate(translation.x,translation.y);buffCxt.scale(scale,scale);this.drawElements(buffCxt,zsortedEles);buffCxt.scale(1/scale,1/scale);buffCxt.translate(-translation.x,-translation.y)}if(options.bg){buffCxt.globalCompositeOperation="destination-over";buffCxt.fillStyle=options.bg;buffCxt.rect(0,0,width,height);buffCxt.fill()}}return buffCanvas};function b64ToBlob(b64,mimeType){var bytes=atob(b64);var buff=new ArrayBuffer(bytes.length);var buffUint8=new Uint8Array(buff);for(var i=0;i<bytes.length;i++){buffUint8[i]=bytes.charCodeAt(i)}return new Blob([buff],{type:mimeType})}function b64UriToB64(b64uri){var i=b64uri.indexOf(",");return b64uri.substr(i+1)}function output(options,canvas,mimeType){var getB64Uri=function getB64Uri(){return canvas.toDataURL(mimeType,options.quality)};switch(options.output){case"blob-promise":return new Promise$1((function(resolve,reject){try{canvas.toBlob((function(blob){if(blob!=null){resolve(blob)}else{reject(new Error("`canvas.toBlob()` sent a null value in its callback"))}}),mimeType,options.quality)}catch(err){reject(err)}}));case"blob":return b64ToBlob(b64UriToB64(getB64Uri()),mimeType);case"base64":return b64UriToB64(getB64Uri());case"base64uri":default:return getB64Uri()}}CRp$8.png=function(options){return output(options,this.bufferCanvasImage(options),"image/png")};CRp$8.jpg=function(options){return output(options,this.bufferCanvasImage(options),"image/jpeg")};var CRp$9={};CRp$9.nodeShapeImpl=function(name,context,centerX,centerY,width,height,points){switch(name){case"ellipse":return this.drawEllipsePath(context,centerX,centerY,width,height);case"polygon":return this.drawPolygonPath(context,centerX,centerY,width,height,points);case"roundrectangle":case"round-rectangle":return this.drawRoundRectanglePath(context,centerX,centerY,width,height);case"cutrectangle":case"cut-rectangle":return this.drawCutRectanglePath(context,centerX,centerY,width,height);case"bottomroundrectangle":case"bottom-round-rectangle":return this.drawBottomRoundRectanglePath(context,centerX,centerY,width,height);case"barrel":return this.drawBarrelPath(context,centerX,centerY,width,height)}};var CR=CanvasRenderer;var CRp$a=CanvasRenderer.prototype;CRp$a.CANVAS_LAYERS=3;CRp$a.SELECT_BOX=0;CRp$a.DRAG=1;CRp$a.NODE=2;CRp$a.BUFFER_COUNT=3;CRp$a.TEXTURE_BUFFER=0;CRp$a.MOTIONBLUR_BUFFER_NODE=1;CRp$a.MOTIONBLUR_BUFFER_DRAG=2;function CanvasRenderer(options){var r=this;r.data={canvases:new Array(CRp$a.CANVAS_LAYERS),contexts:new Array(CRp$a.CANVAS_LAYERS),canvasNeedsRedraw:new Array(CRp$a.CANVAS_LAYERS),bufferCanvases:new Array(CRp$a.BUFFER_COUNT),bufferContexts:new Array(CRp$a.CANVAS_LAYERS)};var tapHlOffAttr="-webkit-tap-highlight-color";var tapHlOffStyle="rgba(0,0,0,0)";r.data.canvasContainer=document.createElement("div");var containerStyle=r.data.canvasContainer.style;r.data.canvasContainer.style[tapHlOffAttr]=tapHlOffStyle;containerStyle.position="relative";containerStyle.zIndex="0";containerStyle.overflow="hidden";var container=options.cy.container();container.appendChild(r.data.canvasContainer);container.style[tapHlOffAttr]=tapHlOffStyle;var styleMap={"-webkit-user-select":"none","-moz-user-select":"-moz-none","user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","outline-style":"none"};if(ms()){styleMap["-ms-touch-action"]="none";styleMap["touch-action"]="none"}for(var i=0;i<CRp$a.CANVAS_LAYERS;i++){var canvas=r.data.canvases[i]=document.createElement("canvas");r.data.contexts[i]=canvas.getContext("2d");Object.keys(styleMap).forEach((function(k){canvas.style[k]=styleMap[k]}));canvas.style.position="absolute";canvas.setAttribute("data-id","layer"+i);canvas.style.zIndex=String(CRp$a.CANVAS_LAYERS-i);r.data.canvasContainer.appendChild(canvas);r.data.canvasNeedsRedraw[i]=false}r.data.topCanvas=r.data.canvases[0];r.data.canvases[CRp$a.NODE].setAttribute("data-id","layer"+CRp$a.NODE+"-node");r.data.canvases[CRp$a.SELECT_BOX].setAttribute("data-id","layer"+CRp$a.SELECT_BOX+"-selectbox");r.data.canvases[CRp$a.DRAG].setAttribute("data-id","layer"+CRp$a.DRAG+"-drag");for(var i=0;i<CRp$a.BUFFER_COUNT;i++){r.data.bufferCanvases[i]=document.createElement("canvas");r.data.bufferContexts[i]=r.data.bufferCanvases[i].getContext("2d");r.data.bufferCanvases[i].style.position="absolute";r.data.bufferCanvases[i].setAttribute("data-id","buffer"+i);r.data.bufferCanvases[i].style.zIndex=String(-i-1);r.data.bufferCanvases[i].style.visibility="hidden"}r.pathsEnabled=true;var emptyBb=makeBoundingBox();var getBoxCenter=function getBoxCenter(bb){return{x:(bb.x1+bb.x2)/2,y:(bb.y1+bb.y2)/2}};var getCenterOffset=function getCenterOffset(bb){return{x:-bb.w/2,y:-bb.h/2}};var backgroundTimestampHasChanged=function backgroundTimestampHasChanged(ele){var _p=ele[0]._private;var same=_p.oldBackgroundTimestamp===_p.backgroundTimestamp;return!same};var getStyleKey=function getStyleKey(ele){return ele[0]._private.nodeKey};var getLabelKey=function getLabelKey(ele){return ele[0]._private.labelStyleKey};var getSourceLabelKey=function getSourceLabelKey(ele){return ele[0]._private.sourceLabelStyleKey};var getTargetLabelKey=function getTargetLabelKey(ele){return ele[0]._private.targetLabelStyleKey};var drawElement=function drawElement(context,ele,bb,scaledLabelShown,useEleOpacity){return r.drawElement(context,ele,bb,false,false,useEleOpacity)};var drawLabel=function drawLabel(context,ele,bb,scaledLabelShown,useEleOpacity){return r.drawElementText(context,ele,bb,scaledLabelShown,"main",useEleOpacity)};var drawSourceLabel=function drawSourceLabel(context,ele,bb,scaledLabelShown,useEleOpacity){return r.drawElementText(context,ele,bb,scaledLabelShown,"source",useEleOpacity)};var drawTargetLabel=function drawTargetLabel(context,ele,bb,scaledLabelShown,useEleOpacity){return r.drawElementText(context,ele,bb,scaledLabelShown,"target",useEleOpacity)};var getElementBox=function getElementBox(ele){ele.boundingBox();return ele[0]._private.bodyBounds};var getLabelBox=function getLabelBox(ele){ele.boundingBox();return ele[0]._private.labelBounds.main||emptyBb};var getSourceLabelBox=function getSourceLabelBox(ele){ele.boundingBox();return ele[0]._private.labelBounds.source||emptyBb};var getTargetLabelBox=function getTargetLabelBox(ele){ele.boundingBox();return ele[0]._private.labelBounds.target||emptyBb};var isLabelVisibleAtScale=function isLabelVisibleAtScale(ele,scaledLabelShown){return scaledLabelShown};var getElementRotationPoint=function getElementRotationPoint(ele){return getBoxCenter(getElementBox(ele))};var addTextMargin=function addTextMargin(pt,ele){return{x:pt.x+ele.pstyle("text-margin-x").pfValue,y:pt.y+ele.pstyle("text-margin-y").pfValue}};var getRsPt=function getRsPt(ele,x,y){var rs=ele[0]._private.rscratch;return{x:rs[x],y:rs[y]}};var getLabelRotationPoint=function getLabelRotationPoint(ele){return addTextMargin(getRsPt(ele,"labelX","labelY"),ele)};var getSourceLabelRotationPoint=function getSourceLabelRotationPoint(ele){return addTextMargin(getRsPt(ele,"sourceLabelX","sourceLabelY"),ele)};var getTargetLabelRotationPoint=function getTargetLabelRotationPoint(ele){return addTextMargin(getRsPt(ele,"targetLabelX","targetLabelY"),ele)};var getElementRotationOffset=function getElementRotationOffset(ele){return getCenterOffset(getElementBox(ele))};var getSourceLabelRotationOffset=function getSourceLabelRotationOffset(ele){return getCenterOffset(getSourceLabelBox(ele))};var getTargetLabelRotationOffset=function getTargetLabelRotationOffset(ele){return getCenterOffset(getTargetLabelBox(ele))};var getLabelRotationOffset=function getLabelRotationOffset(ele){var bb=getLabelBox(ele);var p=getCenterOffset(getLabelBox(ele));if(ele.isNode()){switch(ele.pstyle("text-halign").value){case"left":p.x=-bb.w;break;case"right":p.x=0;break}switch(ele.pstyle("text-valign").value){case"top":p.y=-bb.h;break;case"bottom":p.y=0;break}}return p};var eleTxrCache=r.data.eleTxrCache=new ElementTextureCache(r,{getKey:getStyleKey,doesEleInvalidateKey:backgroundTimestampHasChanged,drawElement:drawElement,getBoundingBox:getElementBox,getRotationPoint:getElementRotationPoint,getRotationOffset:getElementRotationOffset,allowEdgeTxrCaching:false,allowParentTxrCaching:false});var lblTxrCache=r.data.lblTxrCache=new ElementTextureCache(r,{getKey:getLabelKey,drawElement:drawLabel,getBoundingBox:getLabelBox,getRotationPoint:getLabelRotationPoint,getRotationOffset:getLabelRotationOffset,isVisible:isLabelVisibleAtScale});var slbTxrCache=r.data.slbTxrCache=new ElementTextureCache(r,{getKey:getSourceLabelKey,drawElement:drawSourceLabel,getBoundingBox:getSourceLabelBox,getRotationPoint:getSourceLabelRotationPoint,getRotationOffset:getSourceLabelRotationOffset,isVisible:isLabelVisibleAtScale});var tlbTxrCache=r.data.tlbTxrCache=new ElementTextureCache(r,{getKey:getTargetLabelKey,drawElement:drawTargetLabel,getBoundingBox:getTargetLabelBox,getRotationPoint:getTargetLabelRotationPoint,getRotationOffset:getTargetLabelRotationOffset,isVisible:isLabelVisibleAtScale});var lyrTxrCache=r.data.lyrTxrCache=new LayeredTextureCache(r);r.onUpdateEleCalcs((function invalidateTextureCaches(willDraw,eles){eleTxrCache.invalidateElements(eles);lblTxrCache.invalidateElements(eles);slbTxrCache.invalidateElements(eles);tlbTxrCache.invalidateElements(eles);lyrTxrCache.invalidateElements(eles);for(var _i=0;_i<eles.length;_i++){var _p=eles[_i]._private;_p.oldBackgroundTimestamp=_p.backgroundTimestamp}}));var refineInLayers=function refineInLayers(reqs){for(var i=0;i<reqs.length;i++){lyrTxrCache.enqueueElementRefinement(reqs[i].ele)}};eleTxrCache.onDequeue(refineInLayers);lblTxrCache.onDequeue(refineInLayers);slbTxrCache.onDequeue(refineInLayers);tlbTxrCache.onDequeue(refineInLayers)}CRp$a.redrawHint=function(group,bool){var r=this;switch(group){case"eles":r.data.canvasNeedsRedraw[CRp$a.NODE]=bool;break;case"drag":r.data.canvasNeedsRedraw[CRp$a.DRAG]=bool;break;case"select":r.data.canvasNeedsRedraw[CRp$a.SELECT_BOX]=bool;break}};var pathsImpld=typeof Path2D!=="undefined";CRp$a.path2dEnabled=function(on){if(on===undefined){return this.pathsEnabled}this.pathsEnabled=on?true:false};CRp$a.usePaths=function(){return pathsImpld&&this.pathsEnabled};CRp$a.setImgSmoothing=function(context,bool){if(context.imageSmoothingEnabled!=null){context.imageSmoothingEnabled=bool}else{context.webkitImageSmoothingEnabled=bool;context.mozImageSmoothingEnabled=bool;context.msImageSmoothingEnabled=bool}};CRp$a.getImgSmoothing=function(context){if(context.imageSmoothingEnabled!=null){return context.imageSmoothingEnabled}else{return context.webkitImageSmoothingEnabled||context.mozImageSmoothingEnabled||context.msImageSmoothingEnabled}};CRp$a.makeOffscreenCanvas=function(width,height){var canvas;if((typeof OffscreenCanvas==="undefined"?"undefined":_typeof(OffscreenCanvas))!=="undefined"){canvas=new OffscreenCanvas(width,height)}else{canvas=document.createElement("canvas");canvas.width=width;canvas.height=height}return canvas};[CRp,CRp$1,CRp$2,CRp$3,CRp$4,CRp$5,CRp$6,CRp$7,CRp$8,CRp$9].forEach((function(props){extend(CRp$a,props)}));var renderer=[{name:"null",impl:NullRenderer},{name:"base",impl:BR},{name:"canvas",impl:CR}];var incExts=[{type:"layout",extensions:layout},{type:"renderer",extensions:renderer}];var extensions={};var modules={};function setExtension(type,name,registrant){var ext=registrant;var overrideErr=function overrideErr(field){error("Can not register `"+name+"` for `"+type+"` since `"+field+"` already exists in the prototype and can not be overridden")};if(type==="core"){if(Core.prototype[name]){return overrideErr(name)}else{Core.prototype[name]=registrant}}else if(type==="collection"){if(Collection.prototype[name]){return overrideErr(name)}else{Collection.prototype[name]=registrant}}else if(type==="layout"){var Layout=function Layout(options){this.options=options;registrant.call(this,options);if(!plainObject(this._private)){this._private={}}this._private.cy=options.cy;this._private.listeners=[];this.createEmitter()};var layoutProto=Layout.prototype=Object.create(registrant.prototype);var optLayoutFns=[];for(var i=0;i<optLayoutFns.length;i++){var fnName=optLayoutFns[i];layoutProto[fnName]=layoutProto[fnName]||function(){return this}}if(layoutProto.start&&!layoutProto.run){layoutProto.run=function(){this.start();return this}}else if(!layoutProto.start&&layoutProto.run){layoutProto.start=function(){this.run();return this}}var regStop=registrant.prototype.stop;layoutProto.stop=function(){var opts=this.options;if(opts&&opts.animate){var anis=this.animations;if(anis){for(var _i=0;_i<anis.length;_i++){anis[_i].stop()}}}if(regStop){regStop.call(this)}else{this.emit("layoutstop")}return this};if(!layoutProto.destroy){layoutProto.destroy=function(){return this}}layoutProto.cy=function(){return this._private.cy};var getCy=function getCy(layout){return layout._private.cy};var emitterOpts={addEventFields:function addEventFields(layout,evt){evt.layout=layout;evt.cy=getCy(layout);evt.target=layout},bubble:function bubble(){return true},parent:function parent(layout){return getCy(layout)}};extend(layoutProto,{createEmitter:function createEmitter(){this._private.emitter=new Emitter(emitterOpts,this);return this},emitter:function emitter(){return this._private.emitter},on:function on(evt,cb){this.emitter().on(evt,cb);return this},one:function one(evt,cb){this.emitter().one(evt,cb);return this},once:function once(evt,cb){this.emitter().one(evt,cb);return this},removeListener:function removeListener(evt,cb){this.emitter().removeListener(evt,cb);return this},removeAllListeners:function removeAllListeners(){this.emitter().removeAllListeners();return this},emit:function emit(evt,params){this.emitter().emit(evt,params);return this}});define$3.eventAliasesOn(layoutProto);ext=Layout}else if(type==="renderer"&&name!=="null"&&name!=="base"){var BaseRenderer=getExtension("renderer","base");var bProto=BaseRenderer.prototype;var RegistrantRenderer=registrant;var rProto=registrant.prototype;var Renderer=function Renderer(){BaseRenderer.apply(this,arguments);RegistrantRenderer.apply(this,arguments)};var proto=Renderer.prototype;for(var pName in bProto){var pVal=bProto[pName];var existsInR=rProto[pName]!=null;if(existsInR){return overrideErr(pName)}proto[pName]=pVal}for(var _pName in rProto){proto[_pName]=rProto[_pName]}bProto.clientFunctions.forEach((function(name){proto[name]=proto[name]||function(){error("Renderer does not implement `renderer."+name+"()` on its prototype")}}));ext=Renderer}return setMap({map:extensions,keys:[type,name],value:ext})}function getExtension(type,name){return getMap({map:extensions,keys:[type,name]})}function setModule(type,name,moduleType,moduleName,registrant){return setMap({map:modules,keys:[type,name,moduleType,moduleName],value:registrant})}function getModule(type,name,moduleType,moduleName){return getMap({map:modules,keys:[type,name,moduleType,moduleName]})}var extension=function extension(){if(arguments.length===2){return getExtension.apply(null,arguments)}else if(arguments.length===3){return setExtension.apply(null,arguments)}else if(arguments.length===4){return getModule.apply(null,arguments)}else if(arguments.length===5){return setModule.apply(null,arguments)}else{error("Invalid extension access syntax")}};Core.prototype.extension=extension;incExts.forEach((function(group){group.extensions.forEach((function(ext){setExtension(group.type,ext.name,ext.impl)}))}));var Stylesheet=function Stylesheet(){if(!(this instanceof Stylesheet)){return new Stylesheet}this.length=0};var sheetfn=Stylesheet.prototype;sheetfn.instanceString=function(){return"stylesheet"};sheetfn.selector=function(selector){var i=this.length++;this[i]={selector:selector,properties:[]};return this};sheetfn.css=function(name,value){var i=this.length-1;if(string(name)){this[i].properties.push({name:name,value:value})}else if(plainObject(name)){var map=name;var propNames=Object.keys(map);for(var j=0;j<propNames.length;j++){var key=propNames[j];var mapVal=map[key];if(mapVal==null){continue}var prop=Style.properties[key]||Style.properties[dash2camel(key)];if(prop==null){continue}var _name=prop.name;var _value=mapVal;this[i].properties.push({name:_name,value:_value})}}return this};sheetfn.style=sheetfn.css;sheetfn.generateStyle=function(cy){var style=new Style(cy);return this.appendToStyle(style)};sheetfn.appendToStyle=function(style){for(var i=0;i<this.length;i++){var context=this[i];var selector=context.selector;var props=context.properties;style.selector(selector);for(var j=0;j<props.length;j++){var prop=props[j];style.css(prop.name,prop.value)}}return style};var version="3.10.0";var cytoscape=function cytoscape(options){if(options===undefined){options={}}if(plainObject(options)){return new Core(options)}else if(string(options)){return extension.apply(extension,arguments)}};cytoscape.use=function(ext){var args=Array.prototype.slice.call(arguments,1);args.unshift(cytoscape);ext.apply(null,args);return this};cytoscape.warnings=function(bool){return warnings(bool)};cytoscape.version=version;cytoscape.stylesheet=cytoscape.Stylesheet=Stylesheet;module.exports=cytoscape}).call(this,__webpack_require__(486).setImmediate)},function(module,exports,__webpack_require__){(function(global){var apply=Function.prototype.apply;exports.setTimeout=function(){return new Timeout(apply.call(setTimeout,window,arguments),clearTimeout)};exports.setInterval=function(){return new Timeout(apply.call(setInterval,window,arguments),clearInterval)};exports.clearTimeout=exports.clearInterval=function(timeout){if(timeout){timeout.close()}};function Timeout(id,clearFn){this._id=id;this._clearFn=clearFn}Timeout.prototype.unref=Timeout.prototype.ref=function(){};Timeout.prototype.close=function(){this._clearFn.call(window,this._id)};exports.enroll=function(item,msecs){clearTimeout(item._idleTimeoutId);item._idleTimeout=msecs};exports.unenroll=function(item){clearTimeout(item._idleTimeoutId);item._idleTimeout=-1};exports._unrefActive=exports.active=function(item){clearTimeout(item._idleTimeoutId);var msecs=item._idleTimeout;if(msecs>=0){item._idleTimeoutId=setTimeout((function onTimeout(){if(item._onTimeout)item._onTimeout()}),msecs)}};__webpack_require__(487);exports.setImmediate=typeof self!=="undefined"&&self.setImmediate||typeof global!=="undefined"&&global.setImmediate||this&&this.setImmediate;exports.clearImmediate=typeof self!=="undefined"&&self.clearImmediate||typeof global!=="undefined"&&global.clearImmediate||this&&this.clearImmediate}).call(this,__webpack_require__(106))},function(module,exports,__webpack_require__){(function(global,process){(function(global,undefined){"use strict";if(global.setImmediate){return}var nextHandle=1;var tasksByHandle={};var currentlyRunningATask=false;var doc=global.document;var registerImmediate;function setImmediate(callback){if(typeof callback!=="function"){callback=new Function(""+callback)}var args=new Array(arguments.length-1);for(var i=0;i<args.length;i++){args[i]=arguments[i+1]}var task={callback:callback,args:args};tasksByHandle[nextHandle]=task;registerImmediate(nextHandle);return nextHandle++}function clearImmediate(handle){delete tasksByHandle[handle]}function run(task){var callback=task.callback;var args=task.args;switch(args.length){case 0:callback();break;case 1:callback(args[0]);break;case 2:callback(args[0],args[1]);break;case 3:callback(args[0],args[1],args[2]);break;default:callback.apply(undefined,args);break}}function runIfPresent(handle){if(currentlyRunningATask){setTimeout(runIfPresent,0,handle)}else{var task=tasksByHandle[handle];if(task){currentlyRunningATask=true;try{run(task)}finally{clearImmediate(handle);currentlyRunningATask=false}}}}function installNextTickImplementation(){registerImmediate=function(handle){process.nextTick((function(){runIfPresent(handle)}))}}function canUsePostMessage(){if(global.postMessage&&!global.importScripts){var postMessageIsAsynchronous=true;var oldOnMessage=global.onmessage;global.onmessage=function(){postMessageIsAsynchronous=false};global.postMessage("","*");global.onmessage=oldOnMessage;return postMessageIsAsynchronous}}function installPostMessageImplementation(){var messagePrefix="setImmediate$"+Math.random()+"$";var onGlobalMessage=function(event){if(event.source===global&&typeof event.data==="string"&&event.data.indexOf(messagePrefix)===0){runIfPresent(+event.data.slice(messagePrefix.length))}};if(global.addEventListener){global.addEventListener("message",onGlobalMessage,false)}else{global.attachEvent("onmessage",onGlobalMessage)}registerImmediate=function(handle){global.postMessage(messagePrefix+handle,"*")}}function installMessageChannelImplementation(){var channel=new MessageChannel;channel.port1.onmessage=function(event){var handle=event.data;runIfPresent(handle)};registerImmediate=function(handle){channel.port2.postMessage(handle)}}function installReadyStateChangeImplementation(){var html=doc.documentElement;registerImmediate=function(handle){var script=doc.createElement("script");script.onreadystatechange=function(){runIfPresent(handle);script.onreadystatechange=null;html.removeChild(script);script=null};html.appendChild(script)}}function installSetTimeoutImplementation(){registerImmediate=function(handle){setTimeout(runIfPresent,0,handle)}}var attachTo=Object.getPrototypeOf&&Object.getPrototypeOf(global);attachTo=attachTo&&attachTo.setTimeout?attachTo:global;if({}.toString.call(global.process)==="[object process]"){installNextTickImplementation()}else if(canUsePostMessage()){installPostMessageImplementation()}else if(global.MessageChannel){installMessageChannelImplementation()}else if(doc&&"onreadystatechange"in doc.createElement("script")){installReadyStateChangeImplementation()}else{installSetTimeoutImplementation()}attachTo.setImmediate=setImmediate;attachTo.clearImmediate=clearImmediate})(typeof self==="undefined"?typeof global==="undefined"?this:global:self)}).call(this,__webpack_require__(106),__webpack_require__(220))},function(module,exports,__webpack_require__){(function(global){var FUNC_ERROR_TEXT="Expected a function";var NAN=0/0;var symbolTag="[object Symbol]";var reTrim=/^\s+|\s+$/g;var reIsBadHex=/^[-+]0x[0-9a-f]+$/i;var reIsBinary=/^0b[01]+$/i;var reIsOctal=/^0o[0-7]+$/i;var freeParseInt=parseInt;var freeGlobal=typeof global=="object"&&global&&global.Object===Object&&global;var freeSelf=typeof self=="object"&&self&&self.Object===Object&&self;var root=freeGlobal||freeSelf||Function("return this")();var objectProto=Object.prototype;var objectToString=objectProto.toString;var nativeMax=Math.max,nativeMin=Math.min;var now=function(){return root.Date.now()};function debounce(func,wait,options){var lastArgs,lastThis,maxWait,result,timerId,lastCallTime,lastInvokeTime=0,leading=false,maxing=false,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}wait=toNumber(wait)||0;if(isObject(options)){leading=!!options.leading;maxing="maxWait"in options;maxWait=maxing?nativeMax(toNumber(options.maxWait)||0,wait):maxWait;trailing="trailing"in options?!!options.trailing:trailing}function invokeFunc(time){var args=lastArgs,thisArg=lastThis;lastArgs=lastThis=undefined;lastInvokeTime=time;result=func.apply(thisArg,args);return result}function leadingEdge(time){lastInvokeTime=time;timerId=setTimeout(timerExpired,wait);return leading?invokeFunc(time):result}function remainingWait(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime,result=wait-timeSinceLastCall;return maxing?nativeMin(result,maxWait-timeSinceLastInvoke):result}function shouldInvoke(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime;return lastCallTime===undefined||timeSinceLastCall>=wait||timeSinceLastCall<0||maxing&&timeSinceLastInvoke>=maxWait}function timerExpired(){var time=now();if(shouldInvoke(time)){return trailingEdge(time)}timerId=setTimeout(timerExpired,remainingWait(time))}function trailingEdge(time){timerId=undefined;if(trailing&&lastArgs){return invokeFunc(time)}lastArgs=lastThis=undefined;return result}function cancel(){if(timerId!==undefined){clearTimeout(timerId)}lastInvokeTime=0;lastArgs=lastCallTime=lastThis=timerId=undefined}function flush(){return timerId===undefined?result:trailingEdge(now())}function debounced(){var time=now(),isInvoking=shouldInvoke(time);lastArgs=arguments;lastThis=this;lastCallTime=time;if(isInvoking){if(timerId===undefined){return leadingEdge(lastCallTime)}if(maxing){timerId=setTimeout(timerExpired,wait);return invokeFunc(lastCallTime)}}if(timerId===undefined){timerId=setTimeout(timerExpired,wait)}return result}debounced.cancel=cancel;debounced.flush=flush;return debounced}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isObjectLike(value){return!!value&&typeof value=="object"}function isSymbol(value){return typeof value=="symbol"||isObjectLike(value)&&objectToString.call(value)==symbolTag}function toNumber(value){if(typeof value=="number"){return value}if(isSymbol(value)){return NAN}if(isObject(value)){var other=typeof value.valueOf=="function"?value.valueOf():value;value=isObject(other)?other+"":other}if(typeof value!="string"){return value===0?value:+value}value=value.replace(reTrim,"");var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NAN:+value}module.exports=debounce}).call(this,__webpack_require__(106))},function(module,exports,__webpack_require__){module.exports=__webpack_require__(490)},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;(function(){var Heap,defaultCmp,floor,heapify,heappop,heappush,heappushpop,heapreplace,insort,min,nlargest,nsmallest,updateItem,_siftdown,_siftup;floor=Math.floor,min=Math.min;defaultCmp=function(x,y){if(x<y){return-1}if(x>y){return 1}return 0};insort=function(a,x,lo,hi,cmp){var mid;if(lo==null){lo=0}if(cmp==null){cmp=defaultCmp}if(lo<0){throw new Error("lo must be non-negative")}if(hi==null){hi=a.length}while(lo<hi){mid=floor((lo+hi)/2);if(cmp(x,a[mid])<0){hi=mid}else{lo=mid+1}}return[].splice.apply(a,[lo,lo-lo].concat(x)),x};heappush=function(array,item,cmp){if(cmp==null){cmp=defaultCmp}array.push(item);return _siftdown(array,0,array.length-1,cmp)};heappop=function(array,cmp){var lastelt,returnitem;if(cmp==null){cmp=defaultCmp}lastelt=array.pop();if(array.length){returnitem=array[0];array[0]=lastelt;_siftup(array,0,cmp)}else{returnitem=lastelt}return returnitem};heapreplace=function(array,item,cmp){var returnitem;if(cmp==null){cmp=defaultCmp}returnitem=array[0];array[0]=item;_siftup(array,0,cmp);return returnitem};heappushpop=function(array,item,cmp){var _ref;if(cmp==null){cmp=defaultCmp}if(array.length&&cmp(array[0],item)<0){_ref=[array[0],item],item=_ref[0],array[0]=_ref[1];_siftup(array,0,cmp)}return item};heapify=function(array,cmp){var i,_i,_j,_len,_ref,_ref1,_results,_results1;if(cmp==null){cmp=defaultCmp}_ref1=function(){_results1=[];for(var _j=0,_ref=floor(array.length/2);0<=_ref?_j<_ref:_j>_ref;0<=_ref?_j++:_j--){_results1.push(_j)}return _results1}.apply(this).reverse();_results=[];for(_i=0,_len=_ref1.length;_i<_len;_i++){i=_ref1[_i];_results.push(_siftup(array,i,cmp))}return _results};updateItem=function(array,item,cmp){var pos;if(cmp==null){cmp=defaultCmp}pos=array.indexOf(item);if(pos===-1){return}_siftdown(array,0,pos,cmp);return _siftup(array,pos,cmp)};nlargest=function(array,n,cmp){var elem,result,_i,_len,_ref;if(cmp==null){cmp=defaultCmp}result=array.slice(0,n);if(!result.length){return result}heapify(result,cmp);_ref=array.slice(n);for(_i=0,_len=_ref.length;_i<_len;_i++){elem=_ref[_i];heappushpop(result,elem,cmp)}return result.sort(cmp).reverse()};nsmallest=function(array,n,cmp){var elem,i,los,result,_i,_j,_len,_ref,_ref1,_results;if(cmp==null){cmp=defaultCmp}if(n*10<=array.length){result=array.slice(0,n).sort(cmp);if(!result.length){return result}los=result[result.length-1];_ref=array.slice(n);for(_i=0,_len=_ref.length;_i<_len;_i++){elem=_ref[_i];if(cmp(elem,los)<0){insort(result,elem,0,null,cmp);result.pop();los=result[result.length-1]}}return result}heapify(array,cmp);_results=[];for(i=_j=0,_ref1=min(n,array.length);0<=_ref1?_j<_ref1:_j>_ref1;i=0<=_ref1?++_j:--_j){_results.push(heappop(array,cmp))}return _results};_siftdown=function(array,startpos,pos,cmp){var newitem,parent,parentpos;if(cmp==null){cmp=defaultCmp}newitem=array[pos];while(pos>startpos){parentpos=pos-1>>1;parent=array[parentpos];if(cmp(newitem,parent)<0){array[pos]=parent;pos=parentpos;continue}break}return array[pos]=newitem};_siftup=function(array,pos,cmp){var childpos,endpos,newitem,rightpos,startpos;if(cmp==null){cmp=defaultCmp}endpos=array.length;startpos=pos;newitem=array[pos];childpos=2*pos+1;while(childpos<endpos){rightpos=childpos+1;if(rightpos<endpos&&!(cmp(array[childpos],array[rightpos])<0)){childpos=rightpos}array[pos]=array[childpos];pos=childpos;childpos=2*pos+1}array[pos]=newitem;return _siftdown(array,startpos,pos,cmp)};Heap=function(){Heap.push=heappush;Heap.pop=heappop;Heap.replace=heapreplace;Heap.pushpop=heappushpop;Heap.heapify=heapify;Heap.updateItem=updateItem;Heap.nlargest=nlargest;Heap.nsmallest=nsmallest;function Heap(cmp){this.cmp=cmp!=null?cmp:defaultCmp;this.nodes=[]}Heap.prototype.push=function(x){return heappush(this.nodes,x,this.cmp)};Heap.prototype.pop=function(){return heappop(this.nodes,this.cmp)};Heap.prototype.peek=function(){return this.nodes[0]};Heap.prototype.contains=function(x){return this.nodes.indexOf(x)!==-1};Heap.prototype.replace=function(x){return heapreplace(this.nodes,x,this.cmp)};Heap.prototype.pushpop=function(x){return heappushpop(this.nodes,x,this.cmp)};Heap.prototype.heapify=function(){return heapify(this.nodes,this.cmp)};Heap.prototype.updateItem=function(x){return updateItem(this.nodes,x,this.cmp)};Heap.prototype.clear=function(){return this.nodes=[]};Heap.prototype.empty=function(){return this.nodes.length===0};Heap.prototype.size=function(){return this.nodes.length};Heap.prototype.clone=function(){var heap;heap=new Heap;heap.nodes=this.nodes.slice(0);return heap};Heap.prototype.toArray=function(){return this.nodes.slice(0)};Heap.prototype.insert=Heap.prototype.push;Heap.prototype.top=Heap.prototype.peek;Heap.prototype.front=Heap.prototype.peek;Heap.prototype.has=Heap.prototype.contains;Heap.prototype.copy=Heap.prototype.clone;return Heap}();(function(root,factory){if(true){return!(__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_FACTORY__=factory,__WEBPACK_AMD_DEFINE_RESULT__=typeof __WEBPACK_AMD_DEFINE_FACTORY__==="function"?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}else{}})(this,(function(){return Heap}))}).call(this)},function(module,exports,__webpack_require__){(function webpackUniversalModuleDefinition(root,factory){if(true)module.exports=factory(__webpack_require__(492));else{}})(this,(function(__WEBPACK_EXTERNAL_MODULE_4__){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.i=function(value){return value};__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{configurable:false,enumerable:true,get:getter})}};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=3)}([function(module,exports,__webpack_require__){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var isFunction=function isFunction(o){return typeof o==="function"};var defaults=__webpack_require__(2);var assign=__webpack_require__(1);var dagre=__webpack_require__(4);function DagreLayout(options){this.options=assign({},defaults,options)}DagreLayout.prototype.run=function(){var options=this.options;var layout=this;var cy=options.cy;var eles=options.eles;var getVal=function getVal(ele,val){return isFunction(val)?val.apply(ele,[ele]):val};var bb=options.boundingBox||{x1:0,y1:0,w:cy.width(),h:cy.height()};if(bb.x2===undefined){bb.x2=bb.x1+bb.w}if(bb.w===undefined){bb.w=bb.x2-bb.x1}if(bb.y2===undefined){bb.y2=bb.y1+bb.h}if(bb.h===undefined){bb.h=bb.y2-bb.y1}var g=new dagre.graphlib.Graph({multigraph:true,compound:true});var gObj={};var setGObj=function setGObj(name,val){if(val!=null){gObj[name]=val}};setGObj("nodesep",options.nodeSep);setGObj("edgesep",options.edgeSep);setGObj("ranksep",options.rankSep);setGObj("rankdir",options.rankDir);setGObj("ranker",options.ranker);g.setGraph(gObj);g.setDefaultEdgeLabel((function(){return{}}));g.setDefaultNodeLabel((function(){return{}}));var nodes=eles.nodes();for(var i=0;i<nodes.length;i++){var node=nodes[i];var nbb=node.layoutDimensions(options);g.setNode(node.id(),{width:nbb.w,height:nbb.h,name:node.id()})}for(var _i=0;_i<nodes.length;_i++){var _node=nodes[_i];if(_node.isChild()){g.setParent(_node.id(),_node.parent().id())}}var edges=eles.edges().stdFilter((function(edge){return!edge.source().isParent()&&!edge.target().isParent()}));for(var _i2=0;_i2<edges.length;_i2++){var edge=edges[_i2];g.setEdge(edge.source().id(),edge.target().id(),{minlen:getVal(edge,options.minLen),weight:getVal(edge,options.edgeWeight),name:edge.id()},edge.id())}dagre.layout(g);var gNodeIds=g.nodes();for(var _i3=0;_i3<gNodeIds.length;_i3++){var id=gNodeIds[_i3];var n=g.node(id);cy.getElementById(id).scratch().dagre=n}var dagreBB=void 0;if(options.boundingBox){dagreBB={x1:Infinity,x2:-Infinity,y1:Infinity,y2:-Infinity};nodes.forEach((function(node){var dModel=node.scratch().dagre;dagreBB.x1=Math.min(dagreBB.x1,dModel.x);dagreBB.x2=Math.max(dagreBB.x2,dModel.x);dagreBB.y1=Math.min(dagreBB.y1,dModel.y);dagreBB.y2=Math.max(dagreBB.y2,dModel.y)}));dagreBB.w=dagreBB.x2-dagreBB.x1;dagreBB.h=dagreBB.y2-dagreBB.y1}else{dagreBB=bb}var constrainPos=function constrainPos(p){if(options.boundingBox){var xPct=dagreBB.w===0?0:(p.x-dagreBB.x1)/dagreBB.w;var yPct=dagreBB.h===0?0:(p.y-dagreBB.y1)/dagreBB.h;return{x:bb.x1+xPct*bb.w,y:bb.y1+yPct*bb.h}}else{return p}};nodes.layoutPositions(layout,options,(function(ele){ele=(typeof ele==="undefined"?"undefined":_typeof(ele))==="object"?ele:this;var dModel=ele.scratch().dagre;return constrainPos({x:dModel.x,y:dModel.y})}));return this};module.exports=DagreLayout},function(module,exports,__webpack_require__){"use strict";module.exports=Object.assign!=null?Object.assign.bind(Object):function(tgt){for(var _len=arguments.length,srcs=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){srcs[_key-1]=arguments[_key]}srcs.forEach((function(src){Object.keys(src).forEach((function(k){return tgt[k]=src[k]}))}));return tgt}},function(module,exports,__webpack_require__){"use strict";var defaults={nodeSep:undefined,edgeSep:undefined,rankSep:undefined,rankDir:undefined,ranker:undefined,minLen:function minLen(edge){return 1},edgeWeight:function edgeWeight(edge){return 1},fit:true,padding:30,spacingFactor:undefined,nodeDimensionsIncludeLabels:false,animate:false,animateFilter:function animateFilter(node,i){return true},animationDuration:500,animationEasing:undefined,boundingBox:undefined,transform:function transform(node,pos){return pos},ready:function ready(){},stop:function stop(){}};module.exports=defaults},function(module,exports,__webpack_require__){"use strict";var impl=__webpack_require__(0);var register=function register(cytoscape){if(!cytoscape){return}cytoscape("layout","dagre",impl)};if(typeof cytoscape!=="undefined"){register(cytoscape)}module.exports=register},function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE_4__}])}))},function(module,exports,__webpack_require__){module.exports={graphlib:__webpack_require__(107),layout:__webpack_require__(606),debug:__webpack_require__(667),util:{time:__webpack_require__(97).time,notime:__webpack_require__(97).notime},version:__webpack_require__(668)}},function(module,exports,__webpack_require__){var lib=__webpack_require__(494);module.exports={Graph:lib.Graph,json:__webpack_require__(596),alg:__webpack_require__(597),version:lib.version}},function(module,exports,__webpack_require__){module.exports={Graph:__webpack_require__(232),version:__webpack_require__(595)}},function(module,exports,__webpack_require__){var baseClone=__webpack_require__(305);var CLONE_SYMBOLS_FLAG=4;function clone(value){return baseClone(value,CLONE_SYMBOLS_FLAG)}module.exports=clone},function(module,exports){function listCacheClear(){this.__data__=[];this.size=0}module.exports=listCacheClear},function(module,exports,__webpack_require__){var assocIndexOf=__webpack_require__(194);var arrayProto=Array.prototype;var splice=arrayProto.splice;function listCacheDelete(key){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){return false}var lastIndex=data.length-1;if(index==lastIndex){data.pop()}else{splice.call(data,index,1)}--this.size;return true}module.exports=listCacheDelete},function(module,exports,__webpack_require__){var assocIndexOf=__webpack_require__(194);function listCacheGet(key){var data=this.__data__,index=assocIndexOf(data,key);return index<0?undefined:data[index][1]}module.exports=listCacheGet},function(module,exports,__webpack_require__){var assocIndexOf=__webpack_require__(194);function listCacheHas(key){return assocIndexOf(this.__data__,key)>-1}module.exports=listCacheHas},function(module,exports,__webpack_require__){var assocIndexOf=__webpack_require__(194);function listCacheSet(key,value){var data=this.__data__,index=assocIndexOf(data,key);if(index<0){++this.size;data.push([key,value])}else{data[index][1]=value}return this}module.exports=listCacheSet},function(module,exports,__webpack_require__){var ListCache=__webpack_require__(193);function stackClear(){this.__data__=new ListCache;this.size=0}module.exports=stackClear},function(module,exports){function stackDelete(key){var data=this.__data__,result=data["delete"](key);this.size=data.size;return result}module.exports=stackDelete},function(module,exports){function stackGet(key){return this.__data__.get(key)}module.exports=stackGet},function(module,exports){function stackHas(key){return this.__data__.has(key)}module.exports=stackHas},function(module,exports,__webpack_require__){var ListCache=__webpack_require__(193),Map=__webpack_require__(233),MapCache=__webpack_require__(234);var LARGE_ARRAY_SIZE=200;function stackSet(key,value){var data=this.__data__;if(data instanceof ListCache){var pairs=data.__data__;if(!Map||pairs.length<LARGE_ARRAY_SIZE-1){pairs.push([key,value]);this.size=++data.size;return this}data=this.__data__=new MapCache(pairs)}data.set(key,value);this.size=data.size;return this}module.exports=stackSet},function(module,exports,__webpack_require__){var isFunction=__webpack_require__(163),isMasked=__webpack_require__(509),isObject=__webpack_require__(104),toSource=__webpack_require__(307);var reRegExpChar=/[\\^$.*+?()[\]{}|]/g;var reIsHostCtor=/^\[object .+?Constructor\]$/;var funcProto=Function.prototype,objectProto=Object.prototype;var funcToString=funcProto.toString;var hasOwnProperty=objectProto.hasOwnProperty;var reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function baseIsNative(value){if(!isObject(value)||isMasked(value)){return false}var pattern=isFunction(value)?reIsNative:reIsHostCtor;return pattern.test(toSource(value))}module.exports=baseIsNative},function(module,exports,__webpack_require__){var Symbol=__webpack_require__(146);var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var nativeObjectToString=objectProto.toString;var symToStringTag=Symbol?Symbol.toStringTag:undefined;function getRawTag(value){var isOwn=hasOwnProperty.call(value,symToStringTag),tag=value[symToStringTag];try{value[symToStringTag]=undefined;var unmasked=true}catch(e){}var result=nativeObjectToString.call(value);if(unmasked){if(isOwn){value[symToStringTag]=tag}else{delete value[symToStringTag]}}return result}module.exports=getRawTag},function(module,exports){var objectProto=Object.prototype;var nativeObjectToString=objectProto.toString;function objectToString(value){return nativeObjectToString.call(value)}module.exports=objectToString},function(module,exports,__webpack_require__){var coreJsData=__webpack_require__(510);var maskSrcKey=function(){var uid=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return uid?"Symbol(src)_1."+uid:""}();function isMasked(func){return!!maskSrcKey&&maskSrcKey in func}module.exports=isMasked},function(module,exports,__webpack_require__){var root=__webpack_require__(108);var coreJsData=root["__core-js_shared__"];module.exports=coreJsData},function(module,exports){function getValue(object,key){return object==null?undefined:object[key]}module.exports=getValue},function(module,exports,__webpack_require__){var Hash=__webpack_require__(513),ListCache=__webpack_require__(193),Map=__webpack_require__(233);function mapCacheClear(){this.size=0;this.__data__={hash:new Hash,map:new(Map||ListCache),string:new Hash}}module.exports=mapCacheClear},function(module,exports,__webpack_require__){var hashClear=__webpack_require__(514),hashDelete=__webpack_require__(515),hashGet=__webpack_require__(516),hashHas=__webpack_require__(517),hashSet=__webpack_require__(518);function Hash(entries){var index=-1,length=entries==null?0:entries.length;this.clear();while(++index<length){var entry=entries[index];this.set(entry[0],entry[1])}}Hash.prototype.clear=hashClear;Hash.prototype["delete"]=hashDelete;Hash.prototype.get=hashGet;Hash.prototype.has=hashHas;Hash.prototype.set=hashSet;module.exports=Hash},function(module,exports,__webpack_require__){var nativeCreate=__webpack_require__(195);function hashClear(){this.__data__=nativeCreate?nativeCreate(null):{};this.size=0}module.exports=hashClear},function(module,exports){function hashDelete(key){var result=this.has(key)&&delete this.__data__[key];this.size-=result?1:0;return result}module.exports=hashDelete},function(module,exports,__webpack_require__){var nativeCreate=__webpack_require__(195);var HASH_UNDEFINED="__lodash_hash_undefined__";var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;function hashGet(key){var data=this.__data__;if(nativeCreate){var result=data[key];return result===HASH_UNDEFINED?undefined:result}return hasOwnProperty.call(data,key)?data[key]:undefined}module.exports=hashGet},function(module,exports,__webpack_require__){var nativeCreate=__webpack_require__(195);var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;function hashHas(key){var data=this.__data__;return nativeCreate?data[key]!==undefined:hasOwnProperty.call(data,key)}module.exports=hashHas},function(module,exports,__webpack_require__){var nativeCreate=__webpack_require__(195);var HASH_UNDEFINED="__lodash_hash_undefined__";function hashSet(key,value){var data=this.__data__;this.size+=this.has(key)?0:1;data[key]=nativeCreate&&value===undefined?HASH_UNDEFINED:value;return this}module.exports=hashSet},function(module,exports,__webpack_require__){var getMapData=__webpack_require__(196);function mapCacheDelete(key){var result=getMapData(this,key)["delete"](key);this.size-=result?1:0;return result}module.exports=mapCacheDelete},function(module,exports){function isKeyable(value){var type=typeof value;return type=="string"||type=="number"||type=="symbol"||type=="boolean"?value!=="__proto__":value===null}module.exports=isKeyable},function(module,exports,__webpack_require__){var getMapData=__webpack_require__(196);function mapCacheGet(key){return getMapData(this,key).get(key)}module.exports=mapCacheGet},function(module,exports,__webpack_require__){var getMapData=__webpack_require__(196);function mapCacheHas(key){return getMapData(this,key).has(key)}module.exports=mapCacheHas},function(module,exports,__webpack_require__){var getMapData=__webpack_require__(196);function mapCacheSet(key,value){var data=getMapData(this,key),size=data.size;data.set(key,value);this.size+=data.size==size?0:1;return this}module.exports=mapCacheSet},function(module,exports,__webpack_require__){var copyObject=__webpack_require__(164),keys=__webpack_require__(123);function baseAssign(object,source){return object&&copyObject(source,keys(source),object)}module.exports=baseAssign},function(module,exports){function baseTimes(n,iteratee){var index=-1,result=Array(n);while(++index<n){result[index]=iteratee(index)}return result}module.exports=baseTimes},function(module,exports,__webpack_require__){var baseGetTag=__webpack_require__(136),isObjectLike=__webpack_require__(113);var argsTag="[object Arguments]";function baseIsArguments(value){return isObjectLike(value)&&baseGetTag(value)==argsTag}module.exports=baseIsArguments},function(module,exports){function stubFalse(){return false}module.exports=stubFalse},function(module,exports,__webpack_require__){var baseGetTag=__webpack_require__(136),isLength=__webpack_require__(236),isObjectLike=__webpack_require__(113);var argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",weakMapTag="[object WeakMap]";var arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]";var typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=true;typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=false;function baseIsTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[baseGetTag(value)]}module.exports=baseIsTypedArray},function(module,exports,__webpack_require__){var overArg=__webpack_require__(310);var nativeKeys=overArg(Object.keys,Object);module.exports=nativeKeys},function(module,exports,__webpack_require__){var copyObject=__webpack_require__(164),keysIn=__webpack_require__(137);function baseAssignIn(object,source){return object&&copyObject(source,keysIn(source),object)}module.exports=baseAssignIn},function(module,exports,__webpack_require__){var isObject=__webpack_require__(104),isPrototype=__webpack_require__(201),nativeKeysIn=__webpack_require__(532);var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;function baseKeysIn(object){if(!isObject(object)){return nativeKeysIn(object)}var isProto=isPrototype(object),result=[];for(var key in object){if(!(key=="constructor"&&(isProto||!hasOwnProperty.call(object,key)))){result.push(key)}}return result}module.exports=baseKeysIn},function(module,exports){function nativeKeysIn(object){var result=[];if(object!=null){for(var key in Object(object)){result.push(key)}}return result}module.exports=nativeKeysIn},function(module,exports,__webpack_require__){var copyObject=__webpack_require__(164),getSymbols=__webpack_require__(239);function copySymbols(source,object){return copyObject(source,getSymbols(source),object)}module.exports=copySymbols},function(module,exports,__webpack_require__){var copyObject=__webpack_require__(164),getSymbolsIn=__webpack_require__(315);function copySymbolsIn(source,object){return copyObject(source,getSymbolsIn(source),object)}module.exports=copySymbolsIn},function(module,exports,__webpack_require__){var baseGetAllKeys=__webpack_require__(317),getSymbolsIn=__webpack_require__(315),keysIn=__webpack_require__(137);function getAllKeysIn(object){return baseGetAllKeys(object,keysIn,getSymbolsIn)}module.exports=getAllKeysIn},function(module,exports,__webpack_require__){var getNative=__webpack_require__(135),root=__webpack_require__(108);var DataView=getNative(root,"DataView");module.exports=DataView},function(module,exports,__webpack_require__){var getNative=__webpack_require__(135),root=__webpack_require__(108);var Promise=getNative(root,"Promise");module.exports=Promise},function(module,exports,__webpack_require__){var getNative=__webpack_require__(135),root=__webpack_require__(108);var WeakMap=getNative(root,"WeakMap");module.exports=WeakMap},function(module,exports){var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;function initCloneArray(array){var length=array.length,result=new array.constructor(length);if(length&&typeof array[0]=="string"&&hasOwnProperty.call(array,"index")){result.index=array.index;result.input=array.input}return result}module.exports=initCloneArray},function(module,exports,__webpack_require__){var cloneArrayBuffer=__webpack_require__(241),cloneDataView=__webpack_require__(541),cloneRegExp=__webpack_require__(542),cloneSymbol=__webpack_require__(543),cloneTypedArray=__webpack_require__(320);var boolTag="[object Boolean]",dateTag="[object Date]",mapTag="[object Map]",numberTag="[object Number]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",symbolTag="[object Symbol]";var arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]";function initCloneByTag(object,tag,isDeep){var Ctor=object.constructor;switch(tag){case arrayBufferTag:return cloneArrayBuffer(object);case boolTag:case dateTag:return new Ctor(+object);case dataViewTag:return cloneDataView(object,isDeep);case float32Tag:case float64Tag:case int8Tag:case int16Tag:case int32Tag:case uint8Tag:case uint8ClampedTag:case uint16Tag:case uint32Tag:return cloneTypedArray(object,isDeep);case mapTag:return new Ctor;case numberTag:case stringTag:return new Ctor(object);case regexpTag:return cloneRegExp(object);case setTag:return new Ctor;case symbolTag:return cloneSymbol(object)}}module.exports=initCloneByTag},function(module,exports,__webpack_require__){var cloneArrayBuffer=__webpack_require__(241);function cloneDataView(dataView,isDeep){var buffer=isDeep?cloneArrayBuffer(dataView.buffer):dataView.buffer;return new dataView.constructor(buffer,dataView.byteOffset,dataView.byteLength)}module.exports=cloneDataView},function(module,exports){var reFlags=/\w*$/;function cloneRegExp(regexp){var result=new regexp.constructor(regexp.source,reFlags.exec(regexp));result.lastIndex=regexp.lastIndex;return result}module.exports=cloneRegExp},function(module,exports,__webpack_require__){var Symbol=__webpack_require__(146);var symbolProto=Symbol?Symbol.prototype:undefined,symbolValueOf=symbolProto?symbolProto.valueOf:undefined;function cloneSymbol(symbol){return symbolValueOf?Object(symbolValueOf.call(symbol)):{}}module.exports=cloneSymbol},function(module,exports,__webpack_require__){var baseIsMap=__webpack_require__(545),baseUnary=__webpack_require__(200),nodeUtil=__webpack_require__(237);var nodeIsMap=nodeUtil&&nodeUtil.isMap;var isMap=nodeIsMap?baseUnary(nodeIsMap):baseIsMap;module.exports=isMap},function(module,exports,__webpack_require__){var getTag=__webpack_require__(148),isObjectLike=__webpack_require__(113);var mapTag="[object Map]";function baseIsMap(value){return isObjectLike(value)&&getTag(value)==mapTag}module.exports=baseIsMap},function(module,exports,__webpack_require__){var baseIsSet=__webpack_require__(547),baseUnary=__webpack_require__(200),nodeUtil=__webpack_require__(237);var nodeIsSet=nodeUtil&&nodeUtil.isSet;var isSet=nodeIsSet?baseUnary(nodeIsSet):baseIsSet;module.exports=isSet},function(module,exports,__webpack_require__){var getTag=__webpack_require__(148),isObjectLike=__webpack_require__(113);var setTag="[object Set]";function baseIsSet(value){return isObjectLike(value)&&getTag(value)==setTag}module.exports=baseIsSet},function(module,exports){function createBaseFor(fromRight){return function(object,iteratee,keysFunc){var index=-1,iterable=Object(object),props=keysFunc(object),length=props.length;while(length--){var key=props[fromRight?length:++index];if(iteratee(iterable[key],key,iterable)===false){break}}return object}}module.exports=createBaseFor},function(module,exports,__webpack_require__){var isArrayLike=__webpack_require__(119);function createBaseEach(eachFunc,fromRight){return function(collection,iteratee){if(collection==null){return collection}if(!isArrayLike(collection)){return eachFunc(collection,iteratee)}var length=collection.length,index=fromRight?length:-1,iterable=Object(collection);while(fromRight?index--:++index<length){if(iteratee(iterable[index],index,iterable)===false){break}}return collection}}module.exports=createBaseEach},function(module,exports,__webpack_require__){var baseEach=__webpack_require__(203);function baseFilter(collection,predicate){var result=[];baseEach(collection,(function(value,index,collection){if(predicate(value,index,collection)){result.push(value)}}));return result}module.exports=baseFilter},function(module,exports,__webpack_require__){var baseIsMatch=__webpack_require__(552),getMatchData=__webpack_require__(560),matchesStrictComparable=__webpack_require__(332);function baseMatches(source){var matchData=getMatchData(source);if(matchData.length==1&&matchData[0][2]){return matchesStrictComparable(matchData[0][0],matchData[0][1])}return function(object){return object===source||baseIsMatch(object,source,matchData)}}module.exports=baseMatches},function(module,exports,__webpack_require__){var Stack=__webpack_require__(192),baseIsEqual=__webpack_require__(327);var COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2;function baseIsMatch(object,source,matchData,customizer){var index=matchData.length,length=index,noCustomizer=!customizer;if(object==null){return!length}object=Object(object);while(index--){var data=matchData[index];if(noCustomizer&&data[2]?data[1]!==object[data[0]]:!(data[0]in object)){return false}}while(++index<length){data=matchData[index];var key=data[0],objValue=object[key],srcValue=data[1];if(noCustomizer&&data[2]){if(objValue===undefined&&!(key in object)){return false}}else{var stack=new Stack;if(customizer){var result=customizer(objValue,srcValue,key,object,source,stack)}if(!(result===undefined?baseIsEqual(srcValue,objValue,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG,customizer,stack):result)){return false}}}return true}module.exports=baseIsMatch},function(module,exports,__webpack_require__){var Stack=__webpack_require__(192),equalArrays=__webpack_require__(328),equalByTag=__webpack_require__(557),equalObjects=__webpack_require__(559),getTag=__webpack_require__(148),isArray=__webpack_require__(77),isBuffer=__webpack_require__(147),isTypedArray=__webpack_require__(166);var COMPARE_PARTIAL_FLAG=1;var argsTag="[object Arguments]",arrayTag="[object Array]",objectTag="[object Object]";var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;function baseIsEqualDeep(object,other,bitmask,customizer,equalFunc,stack){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=objIsArr?arrayTag:getTag(object),othTag=othIsArr?arrayTag:getTag(other);objTag=objTag==argsTag?objectTag:objTag;othTag=othTag==argsTag?objectTag:othTag;var objIsObj=objTag==objectTag,othIsObj=othTag==objectTag,isSameTag=objTag==othTag;if(isSameTag&&isBuffer(object)){if(!isBuffer(other)){return false}objIsArr=true;objIsObj=false}if(isSameTag&&!objIsObj){stack||(stack=new Stack);return objIsArr||isTypedArray(object)?equalArrays(object,other,bitmask,customizer,equalFunc,stack):equalByTag(object,other,objTag,bitmask,customizer,equalFunc,stack)}if(!(bitmask&COMPARE_PARTIAL_FLAG)){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othIsWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(objIsWrapped||othIsWrapped){var objUnwrapped=objIsWrapped?object.value():object,othUnwrapped=othIsWrapped?other.value():other;stack||(stack=new Stack);return equalFunc(objUnwrapped,othUnwrapped,bitmask,customizer,stack)}}if(!isSameTag){return false}stack||(stack=new Stack);return equalObjects(object,other,bitmask,customizer,equalFunc,stack)}module.exports=baseIsEqualDeep},function(module,exports){var HASH_UNDEFINED="__lodash_hash_undefined__";function setCacheAdd(value){this.__data__.set(value,HASH_UNDEFINED);return this}module.exports=setCacheAdd},function(module,exports){function setCacheHas(value){return this.__data__.has(value)}module.exports=setCacheHas},function(module,exports){function arraySome(array,predicate){var index=-1,length=array==null?0:array.length;while(++index<length){if(predicate(array[index],index,array)){return true}}return false}module.exports=arraySome},function(module,exports,__webpack_require__){var Symbol=__webpack_require__(146),Uint8Array=__webpack_require__(319),eq=__webpack_require__(145),equalArrays=__webpack_require__(328),mapToArray=__webpack_require__(558),setToArray=__webpack_require__(245);var COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2;var boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",mapTag="[object Map]",numberTag="[object Number]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",symbolTag="[object Symbol]";var arrayBufferTag="[object ArrayBuffer]",dataViewTag="[object DataView]";var symbolProto=Symbol?Symbol.prototype:undefined,symbolValueOf=symbolProto?symbolProto.valueOf:undefined;function equalByTag(object,other,tag,bitmask,customizer,equalFunc,stack){switch(tag){case dataViewTag:if(object.byteLength!=other.byteLength||object.byteOffset!=other.byteOffset){return false}object=object.buffer;other=other.buffer;case arrayBufferTag:if(object.byteLength!=other.byteLength||!equalFunc(new Uint8Array(object),new Uint8Array(other))){return false}return true;case boolTag:case dateTag:case numberTag:return eq(+object,+other);case errorTag:return object.name==other.name&&object.message==other.message;case regexpTag:case stringTag:return object==other+"";case mapTag:var convert=mapToArray;case setTag:var isPartial=bitmask&COMPARE_PARTIAL_FLAG;convert||(convert=setToArray);if(object.size!=other.size&&!isPartial){return false}var stacked=stack.get(object);if(stacked){return stacked==other}bitmask|=COMPARE_UNORDERED_FLAG;stack.set(object,other);var result=equalArrays(convert(object),convert(other),bitmask,customizer,equalFunc,stack);stack["delete"](object);return result;case symbolTag:if(symbolValueOf){return symbolValueOf.call(object)==symbolValueOf.call(other)}}return false}module.exports=equalByTag},function(module,exports){function mapToArray(map){var index=-1,result=Array(map.size);map.forEach((function(value,key){result[++index]=[key,value]}));return result}module.exports=mapToArray},function(module,exports,__webpack_require__){var getAllKeys=__webpack_require__(316);var COMPARE_PARTIAL_FLAG=1;var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;function equalObjects(object,other,bitmask,customizer,equalFunc,stack){var isPartial=bitmask&COMPARE_PARTIAL_FLAG,objProps=getAllKeys(object),objLength=objProps.length,othProps=getAllKeys(other),othLength=othProps.length;if(objLength!=othLength&&!isPartial){return false}var index=objLength;while(index--){var key=objProps[index];if(!(isPartial?key in other:hasOwnProperty.call(other,key))){return false}}var objStacked=stack.get(object);var othStacked=stack.get(other);if(objStacked&&othStacked){return objStacked==other&&othStacked==object}var result=true;stack.set(object,other);stack.set(other,object);var skipCtor=isPartial;while(++index<objLength){key=objProps[index];var objValue=object[key],othValue=other[key];if(customizer){var compared=isPartial?customizer(othValue,objValue,key,other,object,stack):customizer(objValue,othValue,key,object,other,stack)}if(!(compared===undefined?objValue===othValue||equalFunc(objValue,othValue,bitmask,customizer,stack):compared)){result=false;break}skipCtor||(skipCtor=key=="constructor")}if(result&&!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;if(objCtor!=othCtor&&("constructor"in object&&"constructor"in other)&&!(typeof objCtor=="function"&&objCtor instanceof objCtor&&typeof othCtor=="function"&&othCtor instanceof othCtor)){result=false}}stack["delete"](object);stack["delete"](other);return result}module.exports=equalObjects},function(module,exports,__webpack_require__){var isStrictComparable=__webpack_require__(331),keys=__webpack_require__(123);function getMatchData(object){var result=keys(object),length=result.length;while(length--){var key=result[length],value=object[key];result[length]=[key,value,isStrictComparable(value)]}return result}module.exports=getMatchData},function(module,exports,__webpack_require__){var baseIsEqual=__webpack_require__(327),get=__webpack_require__(562),hasIn=__webpack_require__(334),isKey=__webpack_require__(246),isStrictComparable=__webpack_require__(331),matchesStrictComparable=__webpack_require__(332),toKey=__webpack_require__(167);var COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2;function baseMatchesProperty(path,srcValue){if(isKey(path)&&isStrictComparable(srcValue)){return matchesStrictComparable(toKey(path),srcValue)}return function(object){var objValue=get(object,path);return objValue===undefined&&objValue===srcValue?hasIn(object,path):baseIsEqual(srcValue,objValue,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG)}}module.exports=baseMatchesProperty},function(module,exports,__webpack_require__){var baseGet=__webpack_require__(204);function get(object,path,defaultValue){var result=object==null?undefined:baseGet(object,path);return result===undefined?defaultValue:result}module.exports=get},function(module,exports,__webpack_require__){var memoizeCapped=__webpack_require__(564);var rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g;var reEscapeChar=/\\(\\)?/g;var stringToPath=memoizeCapped((function(string){var result=[];if(string.charCodeAt(0)===46){result.push("")}string.replace(rePropName,(function(match,number,quote,subString){result.push(quote?subString.replace(reEscapeChar,"$1"):number||match)}));return result}));module.exports=stringToPath},function(module,exports,__webpack_require__){var memoize=__webpack_require__(565);var MAX_MEMOIZE_SIZE=500;function memoizeCapped(func){var result=memoize(func,(function(key){if(cache.size===MAX_MEMOIZE_SIZE){cache.clear()}return key}));var cache=result.cache;return result}module.exports=memoizeCapped},function(module,exports,__webpack_require__){var MapCache=__webpack_require__(234);var FUNC_ERROR_TEXT="Expected a function";function memoize(func,resolver){if(typeof func!="function"||resolver!=null&&typeof resolver!="function"){throw new TypeError(FUNC_ERROR_TEXT)}var memoized=function(){var args=arguments,key=resolver?resolver.apply(this,args):args[0],cache=memoized.cache;if(cache.has(key)){return cache.get(key)}var result=func.apply(this,args);memoized.cache=cache.set(key,result)||cache;return result};memoized.cache=new(memoize.Cache||MapCache);return memoized}memoize.Cache=MapCache;module.exports=memoize},function(module,exports,__webpack_require__){var Symbol=__webpack_require__(146),arrayMap=__webpack_require__(206),isArray=__webpack_require__(77),isSymbol=__webpack_require__(149);var INFINITY=1/0;var symbolProto=Symbol?Symbol.prototype:undefined,symbolToString=symbolProto?symbolProto.toString:undefined;function baseToString(value){if(typeof value=="string"){return value}if(isArray(value)){return arrayMap(value,baseToString)+""}if(isSymbol(value)){return symbolToString?symbolToString.call(value):""}var result=value+"";return result=="0"&&1/value==-INFINITY?"-0":result}module.exports=baseToString},function(module,exports){function baseHasIn(object,key){return object!=null&&key in Object(object)}module.exports=baseHasIn},function(module,exports,__webpack_require__){var baseProperty=__webpack_require__(336),basePropertyDeep=__webpack_require__(569),isKey=__webpack_require__(246),toKey=__webpack_require__(167);function property(path){return isKey(path)?baseProperty(toKey(path)):basePropertyDeep(path)}module.exports=property},function(module,exports,__webpack_require__){var baseGet=__webpack_require__(204);function basePropertyDeep(path){return function(object){return baseGet(object,path)}}module.exports=basePropertyDeep},function(module,exports){var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;function baseHas(object,key){return object!=null&&hasOwnProperty.call(object,key)}module.exports=baseHas},function(module,exports,__webpack_require__){var baseKeys=__webpack_require__(238),getTag=__webpack_require__(148),isArguments=__webpack_require__(165),isArray=__webpack_require__(77),isArrayLike=__webpack_require__(119),isBuffer=__webpack_require__(147),isPrototype=__webpack_require__(201),isTypedArray=__webpack_require__(166);var mapTag="[object Map]",setTag="[object Set]";var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;function isEmpty(value){if(value==null){return true}if(isArrayLike(value)&&(isArray(value)||typeof value=="string"||typeof value.splice=="function"||isBuffer(value)||isTypedArray(value)||isArguments(value))){return!value.length}var tag=getTag(value);if(tag==mapTag||tag==setTag){return!value.size}if(isPrototype(value)){return!baseKeys(value).length}for(var key in value){if(hasOwnProperty.call(value,key)){return false}}return true}module.exports=isEmpty},function(module,exports){function arrayReduce(array,iteratee,accumulator,initAccum){var index=-1,length=array==null?0:array.length;if(initAccum&&length){accumulator=array[++index]}while(++index<length){accumulator=iteratee(accumulator,array[index],index,array)}return accumulator}module.exports=arrayReduce},function(module,exports){function baseReduce(collection,iteratee,accumulator,initAccum,eachFunc){eachFunc(collection,(function(value,index,collection){accumulator=initAccum?(initAccum=false,value):iteratee(accumulator,value,index,collection)}));return accumulator}module.exports=baseReduce},function(module,exports,__webpack_require__){var baseKeys=__webpack_require__(238),getTag=__webpack_require__(148),isArrayLike=__webpack_require__(119),isString=__webpack_require__(575),stringSize=__webpack_require__(576);var mapTag="[object Map]",setTag="[object Set]";function size(collection){if(collection==null){return 0}if(isArrayLike(collection)){return isString(collection)?stringSize(collection):collection.length}var tag=getTag(collection);if(tag==mapTag||tag==setTag){return collection.size}return baseKeys(collection).length}module.exports=size},function(module,exports,__webpack_require__){var baseGetTag=__webpack_require__(136),isArray=__webpack_require__(77),isObjectLike=__webpack_require__(113);var stringTag="[object String]";function isString(value){return typeof value=="string"||!isArray(value)&&isObjectLike(value)&&baseGetTag(value)==stringTag}module.exports=isString},function(module,exports,__webpack_require__){var asciiSize=__webpack_require__(577),hasUnicode=__webpack_require__(578),unicodeSize=__webpack_require__(579);function stringSize(string){return hasUnicode(string)?unicodeSize(string):asciiSize(string)}module.exports=stringSize},function(module,exports,__webpack_require__){var baseProperty=__webpack_require__(336);var asciiSize=baseProperty("length");module.exports=asciiSize},function(module,exports){var rsAstralRange="\\ud800-\\udfff",rsComboMarksRange="\\u0300-\\u036f",reComboHalfMarksRange="\\ufe20-\\ufe2f",rsComboSymbolsRange="\\u20d0-\\u20ff",rsComboRange=rsComboMarksRange+reComboHalfMarksRange+rsComboSymbolsRange,rsVarRange="\\ufe0e\\ufe0f";var rsZWJ="\\u200d";var reHasUnicode=RegExp("["+rsZWJ+rsAstralRange+rsComboRange+rsVarRange+"]");function hasUnicode(string){return reHasUnicode.test(string)}module.exports=hasUnicode},function(module,exports){var rsAstralRange="\\ud800-\\udfff",rsComboMarksRange="\\u0300-\\u036f",reComboHalfMarksRange="\\ufe20-\\ufe2f",rsComboSymbolsRange="\\u20d0-\\u20ff",rsComboRange=rsComboMarksRange+reComboHalfMarksRange+rsComboSymbolsRange,rsVarRange="\\ufe0e\\ufe0f";var rsAstral="["+rsAstralRange+"]",rsCombo="["+rsComboRange+"]",rsFitz="\\ud83c[\\udffb-\\udfff]",rsModifier="(?:"+rsCombo+"|"+rsFitz+")",rsNonAstral="[^"+rsAstralRange+"]",rsRegional="(?:\\ud83c[\\udde6-\\uddff]){2}",rsSurrPair="[\\ud800-\\udbff][\\udc00-\\udfff]",rsZWJ="\\u200d";var reOptMod=rsModifier+"?",rsOptVar="["+rsVarRange+"]?",rsOptJoin="(?:"+rsZWJ+"(?:"+[rsNonAstral,rsRegional,rsSurrPair].join("|")+")"+rsOptVar+reOptMod+")*",rsSeq=rsOptVar+reOptMod+rsOptJoin,rsSymbol="(?:"+[rsNonAstral+rsCombo+"?",rsCombo,rsRegional,rsSurrPair,rsAstral].join("|")+")";var reUnicode=RegExp(rsFitz+"(?="+rsFitz+")|"+rsSymbol+rsSeq,"g");function unicodeSize(string){var result=reUnicode.lastIndex=0;while(reUnicode.test(string)){++result}return result}module.exports=unicodeSize},function(module,exports,__webpack_require__){var arrayEach=__webpack_require__(235),baseCreate=__webpack_require__(322),baseForOwn=__webpack_require__(243),baseIteratee=__webpack_require__(120),getPrototype=__webpack_require__(202),isArray=__webpack_require__(77),isBuffer=__webpack_require__(147),isFunction=__webpack_require__(163),isObject=__webpack_require__(104),isTypedArray=__webpack_require__(166);function transform(object,iteratee,accumulator){var isArr=isArray(object),isArrLike=isArr||isBuffer(object)||isTypedArray(object);iteratee=baseIteratee(iteratee,4);if(accumulator==null){var Ctor=object&&object.constructor;if(isArrLike){accumulator=isArr?new Ctor:[]}else if(isObject(object)){accumulator=isFunction(Ctor)?baseCreate(getPrototype(object)):{}}else{accumulator={}}}(isArrLike?arrayEach:baseForOwn)(object,(function(value,index,object){return iteratee(accumulator,value,index,object)}));return accumulator}module.exports=transform},function(module,exports,__webpack_require__){var baseFlatten=__webpack_require__(247),baseRest=__webpack_require__(207),baseUniq=__webpack_require__(586),isArrayLikeObject=__webpack_require__(345);var union=baseRest((function(arrays){return baseUniq(baseFlatten(arrays,1,isArrayLikeObject,true))}));module.exports=union},function(module,exports,__webpack_require__){var Symbol=__webpack_require__(146),isArguments=__webpack_require__(165),isArray=__webpack_require__(77);var spreadableSymbol=Symbol?Symbol.isConcatSpreadable:undefined;function isFlattenable(value){return isArray(value)||isArguments(value)||!!(spreadableSymbol&&value&&value[spreadableSymbol])}module.exports=isFlattenable},function(module,exports){function apply(func,thisArg,args){switch(args.length){case 0:return func.call(thisArg);case 1:return func.call(thisArg,args[0]);case 2:return func.call(thisArg,args[0],args[1]);case 3:return func.call(thisArg,args[0],args[1],args[2])}return func.apply(thisArg,args)}module.exports=apply},function(module,exports,__webpack_require__){var constant=__webpack_require__(242),defineProperty=__webpack_require__(308),identity=__webpack_require__(138);var baseSetToString=!defineProperty?identity:function(func,string){return defineProperty(func,"toString",{configurable:true,enumerable:false,value:constant(string),writable:true})};module.exports=baseSetToString},function(module,exports){var HOT_COUNT=800,HOT_SPAN=16;var nativeNow=Date.now;function shortOut(func){var count=0,lastCalled=0;return function(){var stamp=nativeNow(),remaining=HOT_SPAN-(stamp-lastCalled);lastCalled=stamp;if(remaining>0){if(++count>=HOT_COUNT){return arguments[0]}}else{count=0}return func.apply(undefined,arguments)}}module.exports=shortOut},function(module,exports,__webpack_require__){var SetCache=__webpack_require__(329),arrayIncludes=__webpack_require__(587),arrayIncludesWith=__webpack_require__(591),cacheHas=__webpack_require__(330),createSet=__webpack_require__(592),setToArray=__webpack_require__(245);var LARGE_ARRAY_SIZE=200;function baseUniq(array,iteratee,comparator){var index=-1,includes=arrayIncludes,length=array.length,isCommon=true,result=[],seen=result;if(comparator){isCommon=false;includes=arrayIncludesWith}else if(length>=LARGE_ARRAY_SIZE){var set=iteratee?null:createSet(array);if(set){return setToArray(set)}isCommon=false;includes=cacheHas;seen=new SetCache}else{seen=iteratee?[]:result}outer:while(++index<length){var value=array[index],computed=iteratee?iteratee(value):value;value=comparator||value!==0?value:0;if(isCommon&&computed===computed){var seenIndex=seen.length;while(seenIndex--){if(seen[seenIndex]===computed){continue outer}}if(iteratee){seen.push(computed)}result.push(value)}else if(!includes(seen,computed,comparator)){if(seen!==result){seen.push(computed)}result.push(value)}}return result}module.exports=baseUniq},function(module,exports,__webpack_require__){var baseIndexOf=__webpack_require__(588);function arrayIncludes(array,value){var length=array==null?0:array.length;return!!length&&baseIndexOf(array,value,0)>-1}module.exports=arrayIncludes},function(module,exports,__webpack_require__){var baseFindIndex=__webpack_require__(344),baseIsNaN=__webpack_require__(589),strictIndexOf=__webpack_require__(590);function baseIndexOf(array,value,fromIndex){return value===value?strictIndexOf(array,value,fromIndex):baseFindIndex(array,baseIsNaN,fromIndex)}module.exports=baseIndexOf},function(module,exports){function baseIsNaN(value){return value!==value}module.exports=baseIsNaN},function(module,exports){function strictIndexOf(array,value,fromIndex){var index=fromIndex-1,length=array.length;while(++index<length){if(array[index]===value){return index}}return-1}module.exports=strictIndexOf},function(module,exports){function arrayIncludesWith(array,value,comparator){var index=-1,length=array==null?0:array.length;while(++index<length){if(comparator(value,array[index])){return true}}return false}module.exports=arrayIncludesWith},function(module,exports,__webpack_require__){var Set=__webpack_require__(318),noop=__webpack_require__(593),setToArray=__webpack_require__(245);var INFINITY=1/0;var createSet=!(Set&&1/setToArray(new Set([,-0]))[1]==INFINITY)?noop:function(values){return new Set(values)};module.exports=createSet},function(module,exports){function noop(){}module.exports=noop},function(module,exports,__webpack_require__){var arrayMap=__webpack_require__(206);function baseValues(object,props){return arrayMap(props,(function(key){return object[key]}))}module.exports=baseValues},function(module,exports){module.exports="2.1.8"},function(module,exports,__webpack_require__){var _=__webpack_require__(103);var Graph=__webpack_require__(232);module.exports={write:write,read:read};function write(g){var json={options:{directed:g.isDirected(),multigraph:g.isMultigraph(),compound:g.isCompound()},nodes:writeNodes(g),edges:writeEdges(g)};if(!_.isUndefined(g.graph())){json.value=_.clone(g.graph())}return json}function writeNodes(g){return _.map(g.nodes(),(function(v){var nodeValue=g.node(v);var parent=g.parent(v);var node={v:v};if(!_.isUndefined(nodeValue)){node.value=nodeValue}if(!_.isUndefined(parent)){node.parent=parent}return node}))}function writeEdges(g){return _.map(g.edges(),(function(e){var edgeValue=g.edge(e);var edge={v:e.v,w:e.w};if(!_.isUndefined(e.name)){edge.name=e.name}if(!_.isUndefined(edgeValue)){edge.value=edgeValue}return edge}))}function read(json){var g=new Graph(json.options).setGraph(json.value);_.each(json.nodes,(function(entry){g.setNode(entry.v,entry.value);if(entry.parent){g.setParent(entry.v,entry.parent)}}));_.each(json.edges,(function(entry){g.setEdge({v:entry.v,w:entry.w,name:entry.name},entry.value)}));return g}},function(module,exports,__webpack_require__){module.exports={components:__webpack_require__(598),dijkstra:__webpack_require__(347),dijkstraAll:__webpack_require__(599),findCycles:__webpack_require__(600),floydWarshall:__webpack_require__(601),isAcyclic:__webpack_require__(602),postorder:__webpack_require__(603),preorder:__webpack_require__(604),prim:__webpack_require__(605),tarjan:__webpack_require__(349),topsort:__webpack_require__(350)}},function(module,exports,__webpack_require__){var _=__webpack_require__(103);module.exports=components;function components(g){var visited={};var cmpts=[];var cmpt;function dfs(v){if(_.has(visited,v))return;visited[v]=true;cmpt.push(v);_.each(g.successors(v),dfs);_.each(g.predecessors(v),dfs)}_.each(g.nodes(),(function(v){cmpt=[];dfs(v);if(cmpt.length){cmpts.push(cmpt)}}));return cmpts}},function(module,exports,__webpack_require__){var dijkstra=__webpack_require__(347);var _=__webpack_require__(103);module.exports=dijkstraAll;function dijkstraAll(g,weightFunc,edgeFunc){return _.transform(g.nodes(),(function(acc,v){acc[v]=dijkstra(g,v,weightFunc,edgeFunc)}),{})}},function(module,exports,__webpack_require__){var _=__webpack_require__(103);var tarjan=__webpack_require__(349);module.exports=findCycles;function findCycles(g){return _.filter(tarjan(g),(function(cmpt){return cmpt.length>1||cmpt.length===1&&g.hasEdge(cmpt[0],cmpt[0])}))}},function(module,exports,__webpack_require__){var _=__webpack_require__(103);module.exports=floydWarshall;var DEFAULT_WEIGHT_FUNC=_.constant(1);function floydWarshall(g,weightFn,edgeFn){return runFloydWarshall(g,weightFn||DEFAULT_WEIGHT_FUNC,edgeFn||function(v){return g.outEdges(v)})}function runFloydWarshall(g,weightFn,edgeFn){var results={};var nodes=g.nodes();nodes.forEach((function(v){results[v]={};results[v][v]={distance:0};nodes.forEach((function(w){if(v!==w){results[v][w]={distance:Number.POSITIVE_INFINITY}}}));edgeFn(v).forEach((function(edge){var w=edge.v===v?edge.w:edge.v;var d=weightFn(edge);results[v][w]={distance:d,predecessor:v}}))}));nodes.forEach((function(k){var rowK=results[k];nodes.forEach((function(i){var rowI=results[i];nodes.forEach((function(j){var ik=rowI[k];var kj=rowK[j];var ij=rowI[j];var altDistance=ik.distance+kj.distance;if(altDistance<ij.distance){ij.distance=altDistance;ij.predecessor=kj.predecessor}}))}))}));return results}},function(module,exports,__webpack_require__){var topsort=__webpack_require__(350);module.exports=isAcyclic;function isAcyclic(g){try{topsort(g)}catch(e){if(e instanceof topsort.CycleException){return false}throw e}return true}},function(module,exports,__webpack_require__){var dfs=__webpack_require__(351);module.exports=postorder;function postorder(g,vs){return dfs(g,vs,"post")}},function(module,exports,__webpack_require__){var dfs=__webpack_require__(351);module.exports=preorder;function preorder(g,vs){return dfs(g,vs,"pre")}},function(module,exports,__webpack_require__){var _=__webpack_require__(103);var Graph=__webpack_require__(232);var PriorityQueue=__webpack_require__(348);module.exports=prim;function prim(g,weightFunc){var result=new Graph;var parents={};var pq=new PriorityQueue;var v;function updateNeighbors(edge){var w=edge.v===v?edge.w:edge.v;var pri=pq.priority(w);if(pri!==undefined){var edgeWeight=weightFunc(edge);if(edgeWeight<pri){parents[w]=v;pq.decrease(w,edgeWeight)}}}if(g.nodeCount()===0){return result}_.each(g.nodes(),(function(v){pq.add(v,Number.POSITIVE_INFINITY);result.setNode(v)}));pq.decrease(g.nodes()[0],0);var init=false;while(pq.size()>0){v=pq.removeMin();if(_.has(parents,v)){result.setEdge(v,parents[v])}else if(init){throw new Error("Input graph is not connected: "+g)}else{init=true}g.nodeEdges(v).forEach(updateNeighbors)}return result}},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(73);var acyclic=__webpack_require__(646);var normalize=__webpack_require__(649);var rank=__webpack_require__(650);var normalizeRanks=__webpack_require__(97).normalizeRanks;var parentDummyChains=__webpack_require__(652);var removeEmptyRanks=__webpack_require__(97).removeEmptyRanks;var nestingGraph=__webpack_require__(653);var addBorderSegments=__webpack_require__(654);var coordinateSystem=__webpack_require__(655);var order=__webpack_require__(656);var position=__webpack_require__(665);var util=__webpack_require__(97);var Graph=__webpack_require__(107).Graph;module.exports=layout;function layout(g,opts){var time=opts&&opts.debugTiming?util.time:util.notime;time("layout",(function(){var layoutGraph=time("  buildLayoutGraph",(function(){return buildLayoutGraph(g)}));time("  runLayout",(function(){runLayout(layoutGraph,time)}));time("  updateInputGraph",(function(){updateInputGraph(g,layoutGraph)}))}))}function runLayout(g,time){time("    makeSpaceForEdgeLabels",(function(){makeSpaceForEdgeLabels(g)}));time("    removeSelfEdges",(function(){removeSelfEdges(g)}));time("    acyclic",(function(){acyclic.run(g)}));time("    nestingGraph.run",(function(){nestingGraph.run(g)}));time("    rank",(function(){rank(util.asNonCompoundGraph(g))}));time("    injectEdgeLabelProxies",(function(){injectEdgeLabelProxies(g)}));time("    removeEmptyRanks",(function(){removeEmptyRanks(g)}));time("    nestingGraph.cleanup",(function(){nestingGraph.cleanup(g)}));time("    normalizeRanks",(function(){normalizeRanks(g)}));time("    assignRankMinMax",(function(){assignRankMinMax(g)}));time("    removeEdgeLabelProxies",(function(){removeEdgeLabelProxies(g)}));time("    normalize.run",(function(){normalize.run(g)}));time("    parentDummyChains",(function(){parentDummyChains(g)}));time("    addBorderSegments",(function(){addBorderSegments(g)}));time("    order",(function(){order(g)}));time("    insertSelfEdges",(function(){insertSelfEdges(g)}));time("    adjustCoordinateSystem",(function(){coordinateSystem.adjust(g)}));time("    position",(function(){position(g)}));time("    positionSelfEdges",(function(){positionSelfEdges(g)}));time("    removeBorderNodes",(function(){removeBorderNodes(g)}));time("    normalize.undo",(function(){normalize.undo(g)}));time("    fixupEdgeLabelCoords",(function(){fixupEdgeLabelCoords(g)}));time("    undoCoordinateSystem",(function(){coordinateSystem.undo(g)}));time("    translateGraph",(function(){translateGraph(g)}));time("    assignNodeIntersects",(function(){assignNodeIntersects(g)}));time("    reversePoints",(function(){reversePointsForReversedEdges(g)}));time("    acyclic.undo",(function(){acyclic.undo(g)}))}function updateInputGraph(inputGraph,layoutGraph){_.forEach(inputGraph.nodes(),(function(v){var inputLabel=inputGraph.node(v);var layoutLabel=layoutGraph.node(v);if(inputLabel){inputLabel.x=layoutLabel.x;inputLabel.y=layoutLabel.y;if(layoutGraph.children(v).length){inputLabel.width=layoutLabel.width;inputLabel.height=layoutLabel.height}}}));_.forEach(inputGraph.edges(),(function(e){var inputLabel=inputGraph.edge(e);var layoutLabel=layoutGraph.edge(e);inputLabel.points=layoutLabel.points;if(_.has(layoutLabel,"x")){inputLabel.x=layoutLabel.x;inputLabel.y=layoutLabel.y}}));inputGraph.graph().width=layoutGraph.graph().width;inputGraph.graph().height=layoutGraph.graph().height}var graphNumAttrs=["nodesep","edgesep","ranksep","marginx","marginy"];var graphDefaults={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"};var graphAttrs=["acyclicer","ranker","rankdir","align"];var nodeNumAttrs=["width","height"];var nodeDefaults={width:0,height:0};var edgeNumAttrs=["minlen","weight","width","height","labeloffset"];var edgeDefaults={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"};var edgeAttrs=["labelpos"];function buildLayoutGraph(inputGraph){var g=new Graph({multigraph:true,compound:true});var graph=canonicalize(inputGraph.graph());g.setGraph(_.merge({},graphDefaults,selectNumberAttrs(graph,graphNumAttrs),_.pick(graph,graphAttrs)));_.forEach(inputGraph.nodes(),(function(v){var node=canonicalize(inputGraph.node(v));g.setNode(v,_.defaults(selectNumberAttrs(node,nodeNumAttrs),nodeDefaults));g.setParent(v,inputGraph.parent(v))}));_.forEach(inputGraph.edges(),(function(e){var edge=canonicalize(inputGraph.edge(e));g.setEdge(e,_.merge({},edgeDefaults,selectNumberAttrs(edge,edgeNumAttrs),_.pick(edge,edgeAttrs)))}));return g}function makeSpaceForEdgeLabels(g){var graph=g.graph();graph.ranksep/=2;_.forEach(g.edges(),(function(e){var edge=g.edge(e);edge.minlen*=2;if(edge.labelpos.toLowerCase()!=="c"){if(graph.rankdir==="TB"||graph.rankdir==="BT"){edge.width+=edge.labeloffset}else{edge.height+=edge.labeloffset}}}))}function injectEdgeLabelProxies(g){_.forEach(g.edges(),(function(e){var edge=g.edge(e);if(edge.width&&edge.height){var v=g.node(e.v);var w=g.node(e.w);var label={rank:(w.rank-v.rank)/2+v.rank,e:e};util.addDummyNode(g,"edge-proxy",label,"_ep")}}))}function assignRankMinMax(g){var maxRank=0;_.forEach(g.nodes(),(function(v){var node=g.node(v);if(node.borderTop){node.minRank=g.node(node.borderTop).rank;node.maxRank=g.node(node.borderBottom).rank;maxRank=_.max(maxRank,node.maxRank)}}));g.graph().maxRank=maxRank}function removeEdgeLabelProxies(g){_.forEach(g.nodes(),(function(v){var node=g.node(v);if(node.dummy==="edge-proxy"){g.edge(node.e).labelRank=node.rank;g.removeNode(v)}}))}function translateGraph(g){var minX=Number.POSITIVE_INFINITY;var maxX=0;var minY=Number.POSITIVE_INFINITY;var maxY=0;var graphLabel=g.graph();var marginX=graphLabel.marginx||0;var marginY=graphLabel.marginy||0;function getExtremes(attrs){var x=attrs.x;var y=attrs.y;var w=attrs.width;var h=attrs.height;minX=Math.min(minX,x-w/2);maxX=Math.max(maxX,x+w/2);minY=Math.min(minY,y-h/2);maxY=Math.max(maxY,y+h/2)}_.forEach(g.nodes(),(function(v){getExtremes(g.node(v))}));_.forEach(g.edges(),(function(e){var edge=g.edge(e);if(_.has(edge,"x")){getExtremes(edge)}}));minX-=marginX;minY-=marginY;_.forEach(g.nodes(),(function(v){var node=g.node(v);node.x-=minX;node.y-=minY}));_.forEach(g.edges(),(function(e){var edge=g.edge(e);_.forEach(edge.points,(function(p){p.x-=minX;p.y-=minY}));if(_.has(edge,"x")){edge.x-=minX}if(_.has(edge,"y")){edge.y-=minY}}));graphLabel.width=maxX-minX+marginX;graphLabel.height=maxY-minY+marginY}function assignNodeIntersects(g){_.forEach(g.edges(),(function(e){var edge=g.edge(e);var nodeV=g.node(e.v);var nodeW=g.node(e.w);var p1,p2;if(!edge.points){edge.points=[];p1=nodeW;p2=nodeV}else{p1=edge.points[0];p2=edge.points[edge.points.length-1]}edge.points.unshift(util.intersectRect(nodeV,p1));edge.points.push(util.intersectRect(nodeW,p2))}))}function fixupEdgeLabelCoords(g){_.forEach(g.edges(),(function(e){var edge=g.edge(e);if(_.has(edge,"x")){if(edge.labelpos==="l"||edge.labelpos==="r"){edge.width-=edge.labeloffset}switch(edge.labelpos){case"l":edge.x-=edge.width/2+edge.labeloffset;break;case"r":edge.x+=edge.width/2+edge.labeloffset;break}}}))}function reversePointsForReversedEdges(g){_.forEach(g.edges(),(function(e){var edge=g.edge(e);if(edge.reversed){edge.points.reverse()}}))}function removeBorderNodes(g){_.forEach(g.nodes(),(function(v){if(g.children(v).length){var node=g.node(v);var t=g.node(node.borderTop);var b=g.node(node.borderBottom);var l=g.node(_.last(node.borderLeft));var r=g.node(_.last(node.borderRight));node.width=Math.abs(r.x-l.x);node.height=Math.abs(b.y-t.y);node.x=l.x+node.width/2;node.y=t.y+node.height/2}}));_.forEach(g.nodes(),(function(v){if(g.node(v).dummy==="border"){g.removeNode(v)}}))}function removeSelfEdges(g){_.forEach(g.edges(),(function(e){if(e.v===e.w){var node=g.node(e.v);if(!node.selfEdges){node.selfEdges=[]}node.selfEdges.push({e:e,label:g.edge(e)});g.removeEdge(e)}}))}function insertSelfEdges(g){var layers=util.buildLayerMatrix(g);_.forEach(layers,(function(layer){var orderShift=0;_.forEach(layer,(function(v,i){var node=g.node(v);node.order=i+orderShift;_.forEach(node.selfEdges,(function(selfEdge){util.addDummyNode(g,"selfedge",{width:selfEdge.label.width,height:selfEdge.label.height,rank:node.rank,order:i+ ++orderShift,e:selfEdge.e,label:selfEdge.label},"_se")}));delete node.selfEdges}))}))}function positionSelfEdges(g){_.forEach(g.nodes(),(function(v){var node=g.node(v);if(node.dummy==="selfedge"){var selfNode=g.node(node.e.v);var x=selfNode.x+selfNode.width/2;var y=selfNode.y;var dx=node.x-x;var dy=selfNode.height/2;g.setEdge(node.e,node.label);g.removeNode(v);node.label.points=[{x:x+2*dx/3,y:y-dy},{x:x+5*dx/6,y:y-dy},{x:x+dx,y:y},{x:x+5*dx/6,y:y+dy},{x:x+2*dx/3,y:y+dy}];node.label.x=node.x;node.label.y=node.y}}))}function selectNumberAttrs(obj,attrs){return _.mapValues(_.pick(obj,attrs),Number)}function canonicalize(attrs){var newAttrs={};_.forEach(attrs,(function(v,k){newAttrs[k.toLowerCase()]=v}));return newAttrs}},function(module,exports,__webpack_require__){var baseClone=__webpack_require__(305);var CLONE_DEEP_FLAG=1,CLONE_SYMBOLS_FLAG=4;function cloneDeep(value){return baseClone(value,CLONE_DEEP_FLAG|CLONE_SYMBOLS_FLAG)}module.exports=cloneDeep},function(module,exports,__webpack_require__){var baseRest=__webpack_require__(207),eq=__webpack_require__(145),isIterateeCall=__webpack_require__(208),keysIn=__webpack_require__(137);var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var defaults=baseRest((function(object,sources){object=Object(object);var index=-1;var length=sources.length;var guard=length>2?sources[2]:undefined;if(guard&&isIterateeCall(sources[0],sources[1],guard)){length=1}while(++index<length){var source=sources[index];var props=keysIn(source);var propsIndex=-1;var propsLength=props.length;while(++propsIndex<propsLength){var key=props[propsIndex];var value=object[key];if(value===undefined||eq(value,objectProto[key])&&!hasOwnProperty.call(object,key)){object[key]=source[key]}}}return object}));module.exports=defaults},function(module,exports,__webpack_require__){var createFind=__webpack_require__(610),findIndex=__webpack_require__(611);var find=createFind(findIndex);module.exports=find},function(module,exports,__webpack_require__){var baseIteratee=__webpack_require__(120),isArrayLike=__webpack_require__(119),keys=__webpack_require__(123);function createFind(findIndexFunc){return function(collection,predicate,fromIndex){var iterable=Object(collection);if(!isArrayLike(collection)){var iteratee=baseIteratee(predicate,3);collection=keys(collection);predicate=function(key){return iteratee(iterable[key],key,iterable)}}var index=findIndexFunc(collection,predicate,fromIndex);return index>-1?iterable[iteratee?collection[index]:index]:undefined}}module.exports=createFind},function(module,exports,__webpack_require__){var baseFindIndex=__webpack_require__(344),baseIteratee=__webpack_require__(120),toInteger=__webpack_require__(612);var nativeMax=Math.max;function findIndex(array,predicate,fromIndex){var length=array==null?0:array.length;if(!length){return-1}var index=fromIndex==null?0:toInteger(fromIndex);if(index<0){index=nativeMax(length+index,0)}return baseFindIndex(array,baseIteratee(predicate,3),index)}module.exports=findIndex},function(module,exports,__webpack_require__){var toFinite=__webpack_require__(352);function toInteger(value){var result=toFinite(value),remainder=result%1;return result===result?remainder?result-remainder:result:0}module.exports=toInteger},function(module,exports,__webpack_require__){var baseTrim=__webpack_require__(614),isObject=__webpack_require__(104),isSymbol=__webpack_require__(149);var NAN=0/0;var reIsBadHex=/^[-+]0x[0-9a-f]+$/i;var reIsBinary=/^0b[01]+$/i;var reIsOctal=/^0o[0-7]+$/i;var freeParseInt=parseInt;function toNumber(value){if(typeof value=="number"){return value}if(isSymbol(value)){return NAN}if(isObject(value)){var other=typeof value.valueOf=="function"?value.valueOf():value;value=isObject(other)?other+"":other}if(typeof value!="string"){return value===0?value:+value}value=baseTrim(value);var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NAN:+value}module.exports=toNumber},function(module,exports,__webpack_require__){var trimmedEndIndex=__webpack_require__(615);var reTrimStart=/^\s+/;function baseTrim(string){return string?string.slice(0,trimmedEndIndex(string)+1).replace(reTrimStart,""):string}module.exports=baseTrim},function(module,exports){var reWhitespace=/\s/;function trimmedEndIndex(string){var index=string.length;while(index--&&reWhitespace.test(string.charAt(index))){}return index}module.exports=trimmedEndIndex},function(module,exports,__webpack_require__){var baseFor=__webpack_require__(244),castFunction=__webpack_require__(325),keysIn=__webpack_require__(137);function forIn(object,iteratee){return object==null?object:baseFor(object,castFunction(iteratee),keysIn)}module.exports=forIn},function(module,exports){function last(array){var length=array==null?0:array.length;return length?array[length-1]:undefined}module.exports=last},function(module,exports,__webpack_require__){var baseAssignValue=__webpack_require__(198),baseForOwn=__webpack_require__(243),baseIteratee=__webpack_require__(120);function mapValues(object,iteratee){var result={};iteratee=baseIteratee(iteratee,3);baseForOwn(object,(function(value,key,object){baseAssignValue(result,key,iteratee(value,key,object))}));return result}module.exports=mapValues},function(module,exports,__webpack_require__){var baseExtremum=__webpack_require__(248),baseGt=__webpack_require__(620),identity=__webpack_require__(138);function max(array){return array&&array.length?baseExtremum(array,identity,baseGt):undefined}module.exports=max},function(module,exports){function baseGt(value,other){return value>other}module.exports=baseGt},function(module,exports,__webpack_require__){var baseMerge=__webpack_require__(622),createAssigner=__webpack_require__(626);var merge=createAssigner((function(object,source,srcIndex){baseMerge(object,source,srcIndex)}));module.exports=merge},function(module,exports,__webpack_require__){var Stack=__webpack_require__(192),assignMergeValue=__webpack_require__(354),baseFor=__webpack_require__(244),baseMergeDeep=__webpack_require__(623),isObject=__webpack_require__(104),keysIn=__webpack_require__(137),safeGet=__webpack_require__(355);function baseMerge(object,source,srcIndex,customizer,stack){if(object===source){return}baseFor(source,(function(srcValue,key){stack||(stack=new Stack);if(isObject(srcValue)){baseMergeDeep(object,source,key,srcIndex,baseMerge,customizer,stack)}else{var newValue=customizer?customizer(safeGet(object,key),srcValue,key+"",object,source,stack):undefined;if(newValue===undefined){newValue=srcValue}assignMergeValue(object,key,newValue)}}),keysIn)}module.exports=baseMerge},function(module,exports,__webpack_require__){var assignMergeValue=__webpack_require__(354),cloneBuffer=__webpack_require__(311),cloneTypedArray=__webpack_require__(320),copyArray=__webpack_require__(312),initCloneObject=__webpack_require__(321),isArguments=__webpack_require__(165),isArray=__webpack_require__(77),isArrayLikeObject=__webpack_require__(345),isBuffer=__webpack_require__(147),isFunction=__webpack_require__(163),isObject=__webpack_require__(104),isPlainObject=__webpack_require__(624),isTypedArray=__webpack_require__(166),safeGet=__webpack_require__(355),toPlainObject=__webpack_require__(625);function baseMergeDeep(object,source,key,srcIndex,mergeFunc,customizer,stack){var objValue=safeGet(object,key),srcValue=safeGet(source,key),stacked=stack.get(srcValue);if(stacked){assignMergeValue(object,key,stacked);return}var newValue=customizer?customizer(objValue,srcValue,key+"",object,source,stack):undefined;var isCommon=newValue===undefined;if(isCommon){var isArr=isArray(srcValue),isBuff=!isArr&&isBuffer(srcValue),isTyped=!isArr&&!isBuff&&isTypedArray(srcValue);newValue=srcValue;if(isArr||isBuff||isTyped){if(isArray(objValue)){newValue=objValue}else if(isArrayLikeObject(objValue)){newValue=copyArray(objValue)}else if(isBuff){isCommon=false;newValue=cloneBuffer(srcValue,true)}else if(isTyped){isCommon=false;newValue=cloneTypedArray(srcValue,true)}else{newValue=[]}}else if(isPlainObject(srcValue)||isArguments(srcValue)){newValue=objValue;if(isArguments(objValue)){newValue=toPlainObject(objValue)}else if(!isObject(objValue)||isFunction(objValue)){newValue=initCloneObject(srcValue)}}else{isCommon=false}}if(isCommon){stack.set(srcValue,newValue);mergeFunc(newValue,srcValue,srcIndex,customizer,stack);stack["delete"](srcValue)}assignMergeValue(object,key,newValue)}module.exports=baseMergeDeep},function(module,exports,__webpack_require__){var baseGetTag=__webpack_require__(136),getPrototype=__webpack_require__(202),isObjectLike=__webpack_require__(113);var objectTag="[object Object]";var funcProto=Function.prototype,objectProto=Object.prototype;var funcToString=funcProto.toString;var hasOwnProperty=objectProto.hasOwnProperty;var objectCtorString=funcToString.call(Object);function isPlainObject(value){if(!isObjectLike(value)||baseGetTag(value)!=objectTag){return false}var proto=getPrototype(value);if(proto===null){return true}var Ctor=hasOwnProperty.call(proto,"constructor")&&proto.constructor;return typeof Ctor=="function"&&Ctor instanceof Ctor&&funcToString.call(Ctor)==objectCtorString}module.exports=isPlainObject},function(module,exports,__webpack_require__){var copyObject=__webpack_require__(164),keysIn=__webpack_require__(137);function toPlainObject(value){return copyObject(value,keysIn(value))}module.exports=toPlainObject},function(module,exports,__webpack_require__){var baseRest=__webpack_require__(207),isIterateeCall=__webpack_require__(208);function createAssigner(assigner){return baseRest((function(object,sources){var index=-1,length=sources.length,customizer=length>1?sources[length-1]:undefined,guard=length>2?sources[2]:undefined;customizer=assigner.length>3&&typeof customizer=="function"?(length--,customizer):undefined;if(guard&&isIterateeCall(sources[0],sources[1],guard)){customizer=length<3?undefined:customizer;length=1}object=Object(object);while(++index<length){var source=sources[index];if(source){assigner(object,source,index,customizer)}}return object}))}module.exports=createAssigner},function(module,exports,__webpack_require__){var baseExtremum=__webpack_require__(248),baseLt=__webpack_require__(356),identity=__webpack_require__(138);function min(array){return array&&array.length?baseExtremum(array,identity,baseLt):undefined}module.exports=min},function(module,exports,__webpack_require__){var baseExtremum=__webpack_require__(248),baseIteratee=__webpack_require__(120),baseLt=__webpack_require__(356);function minBy(array,iteratee){return array&&array.length?baseExtremum(array,baseIteratee(iteratee,2),baseLt):undefined}module.exports=minBy},function(module,exports,__webpack_require__){var root=__webpack_require__(108);var now=function(){return root.Date.now()};module.exports=now},function(module,exports,__webpack_require__){var basePick=__webpack_require__(631),flatRest=__webpack_require__(634);var pick=flatRest((function(object,paths){return object==null?{}:basePick(object,paths)}));module.exports=pick},function(module,exports,__webpack_require__){var basePickBy=__webpack_require__(632),hasIn=__webpack_require__(334);function basePick(object,paths){return basePickBy(object,paths,(function(value,path){return hasIn(object,path)}))}module.exports=basePick},function(module,exports,__webpack_require__){var baseGet=__webpack_require__(204),baseSet=__webpack_require__(633),castPath=__webpack_require__(205);function basePickBy(object,paths,predicate){var index=-1,length=paths.length,result={};while(++index<length){var path=paths[index],value=baseGet(object,path);if(predicate(value,path)){baseSet(result,castPath(path,object),value)}}return result}module.exports=basePickBy},function(module,exports,__webpack_require__){var assignValue=__webpack_require__(197),castPath=__webpack_require__(205),isIndex=__webpack_require__(199),isObject=__webpack_require__(104),toKey=__webpack_require__(167);function baseSet(object,path,value,customizer){if(!isObject(object)){return object}path=castPath(path,object);var index=-1,length=path.length,lastIndex=length-1,nested=object;while(nested!=null&&++index<length){var key=toKey(path[index]),newValue=value;if(key==="__proto__"||key==="constructor"||key==="prototype"){return object}if(index!=lastIndex){var objValue=nested[key];newValue=customizer?customizer(objValue,key,nested):undefined;if(newValue===undefined){newValue=isObject(objValue)?objValue:isIndex(path[index+1])?[]:{}}}assignValue(nested,key,newValue);nested=nested[key]}return object}module.exports=baseSet},function(module,exports,__webpack_require__){var flatten=__webpack_require__(353),overRest=__webpack_require__(342),setToString=__webpack_require__(343);function flatRest(func){return setToString(overRest(func,undefined,flatten),func+"")}module.exports=flatRest},function(module,exports,__webpack_require__){var createRange=__webpack_require__(636);var range=createRange();module.exports=range},function(module,exports,__webpack_require__){var baseRange=__webpack_require__(637),isIterateeCall=__webpack_require__(208),toFinite=__webpack_require__(352);function createRange(fromRight){return function(start,end,step){if(step&&typeof step!="number"&&isIterateeCall(start,end,step)){end=step=undefined}start=toFinite(start);if(end===undefined){end=start;start=0}else{end=toFinite(end)}step=step===undefined?start<end?1:-1:toFinite(step);return baseRange(start,end,step,fromRight)}}module.exports=createRange},function(module,exports){var nativeCeil=Math.ceil,nativeMax=Math.max;function baseRange(start,end,step,fromRight){var index=-1,length=nativeMax(nativeCeil((end-start)/(step||1)),0),result=Array(length);while(length--){result[fromRight?length:++index]=start;start+=step}return result}module.exports=baseRange},function(module,exports,__webpack_require__){var baseFlatten=__webpack_require__(247),baseOrderBy=__webpack_require__(639),baseRest=__webpack_require__(207),isIterateeCall=__webpack_require__(208);var sortBy=baseRest((function(collection,iteratees){if(collection==null){return[]}var length=iteratees.length;if(length>1&&isIterateeCall(collection,iteratees[0],iteratees[1])){iteratees=[]}else if(length>2&&isIterateeCall(iteratees[0],iteratees[1],iteratees[2])){iteratees=[iteratees[0]]}return baseOrderBy(collection,baseFlatten(iteratees,1),[])}));module.exports=sortBy},function(module,exports,__webpack_require__){var arrayMap=__webpack_require__(206),baseGet=__webpack_require__(204),baseIteratee=__webpack_require__(120),baseMap=__webpack_require__(340),baseSortBy=__webpack_require__(640),baseUnary=__webpack_require__(200),compareMultiple=__webpack_require__(641),identity=__webpack_require__(138),isArray=__webpack_require__(77);function baseOrderBy(collection,iteratees,orders){if(iteratees.length){iteratees=arrayMap(iteratees,(function(iteratee){if(isArray(iteratee)){return function(value){return baseGet(value,iteratee.length===1?iteratee[0]:iteratee)}}return iteratee}))}else{iteratees=[identity]}var index=-1;iteratees=arrayMap(iteratees,baseUnary(baseIteratee));var result=baseMap(collection,(function(value,key,collection){var criteria=arrayMap(iteratees,(function(iteratee){return iteratee(value)}));return{criteria:criteria,index:++index,value:value}}));return baseSortBy(result,(function(object,other){return compareMultiple(object,other,orders)}))}module.exports=baseOrderBy},function(module,exports){function baseSortBy(array,comparer){var length=array.length;array.sort(comparer);while(length--){array[length]=array[length].value}return array}module.exports=baseSortBy},function(module,exports,__webpack_require__){var compareAscending=__webpack_require__(642);function compareMultiple(object,other,orders){var index=-1,objCriteria=object.criteria,othCriteria=other.criteria,length=objCriteria.length,ordersLength=orders.length;while(++index<length){var result=compareAscending(objCriteria[index],othCriteria[index]);if(result){if(index>=ordersLength){return result}var order=orders[index];return result*(order=="desc"?-1:1)}}return object.index-other.index}module.exports=compareMultiple},function(module,exports,__webpack_require__){var isSymbol=__webpack_require__(149);function compareAscending(value,other){if(value!==other){var valIsDefined=value!==undefined,valIsNull=value===null,valIsReflexive=value===value,valIsSymbol=isSymbol(value);var othIsDefined=other!==undefined,othIsNull=other===null,othIsReflexive=other===other,othIsSymbol=isSymbol(other);if(!othIsNull&&!othIsSymbol&&!valIsSymbol&&value>other||valIsSymbol&&othIsDefined&&othIsReflexive&&!othIsNull&&!othIsSymbol||valIsNull&&othIsDefined&&othIsReflexive||!valIsDefined&&othIsReflexive||!valIsReflexive){return 1}if(!valIsNull&&!valIsSymbol&&!othIsSymbol&&value<other||othIsSymbol&&valIsDefined&&valIsReflexive&&!valIsNull&&!valIsSymbol||othIsNull&&valIsDefined&&valIsReflexive||!othIsDefined&&valIsReflexive||!othIsReflexive){return-1}}return 0}module.exports=compareAscending},function(module,exports,__webpack_require__){var toString=__webpack_require__(333);var idCounter=0;function uniqueId(prefix){var id=++idCounter;return toString(prefix)+id}module.exports=uniqueId},function(module,exports,__webpack_require__){var assignValue=__webpack_require__(197),baseZipObject=__webpack_require__(645);function zipObject(props,values){return baseZipObject(props||[],values||[],assignValue)}module.exports=zipObject},function(module,exports){function baseZipObject(props,values,assignFunc){var index=-1,length=props.length,valsLength=values.length,result={};while(++index<length){var value=index<valsLength?values[index]:undefined;assignFunc(result,props[index],value)}return result}module.exports=baseZipObject},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(73);var greedyFAS=__webpack_require__(647);module.exports={run:run,undo:undo};function run(g){var fas=g.graph().acyclicer==="greedy"?greedyFAS(g,weightFn(g)):dfsFAS(g);_.forEach(fas,(function(e){var label=g.edge(e);g.removeEdge(e);label.forwardName=e.name;label.reversed=true;g.setEdge(e.w,e.v,label,_.uniqueId("rev"))}));function weightFn(g){return function(e){return g.edge(e).weight}}}function dfsFAS(g){var fas=[];var stack={};var visited={};function dfs(v){if(_.has(visited,v)){return}visited[v]=true;stack[v]=true;_.forEach(g.outEdges(v),(function(e){if(_.has(stack,e.w)){fas.push(e)}else{dfs(e.w)}}));delete stack[v]}_.forEach(g.nodes(),dfs);return fas}function undo(g){_.forEach(g.edges(),(function(e){var label=g.edge(e);if(label.reversed){g.removeEdge(e);var forwardName=label.forwardName;delete label.reversed;delete label.forwardName;g.setEdge(e.w,e.v,label,forwardName)}}))}},function(module,exports,__webpack_require__){var _=__webpack_require__(73);var Graph=__webpack_require__(107).Graph;var List=__webpack_require__(648);module.exports=greedyFAS;var DEFAULT_WEIGHT_FN=_.constant(1);function greedyFAS(g,weightFn){if(g.nodeCount()<=1){return[]}var state=buildState(g,weightFn||DEFAULT_WEIGHT_FN);var results=doGreedyFAS(state.graph,state.buckets,state.zeroIdx);return _.flatten(_.map(results,(function(e){return g.outEdges(e.v,e.w)})),true)}function doGreedyFAS(g,buckets,zeroIdx){var results=[];var sources=buckets[buckets.length-1];var sinks=buckets[0];var entry;while(g.nodeCount()){while(entry=sinks.dequeue()){removeNode(g,buckets,zeroIdx,entry)}while(entry=sources.dequeue()){removeNode(g,buckets,zeroIdx,entry)}if(g.nodeCount()){for(var i=buckets.length-2;i>0;--i){entry=buckets[i].dequeue();if(entry){results=results.concat(removeNode(g,buckets,zeroIdx,entry,true));break}}}}return results}function removeNode(g,buckets,zeroIdx,entry,collectPredecessors){var results=collectPredecessors?[]:undefined;_.forEach(g.inEdges(entry.v),(function(edge){var weight=g.edge(edge);var uEntry=g.node(edge.v);if(collectPredecessors){results.push({v:edge.v,w:edge.w})}uEntry.out-=weight;assignBucket(buckets,zeroIdx,uEntry)}));_.forEach(g.outEdges(entry.v),(function(edge){var weight=g.edge(edge);var w=edge.w;var wEntry=g.node(w);wEntry["in"]-=weight;assignBucket(buckets,zeroIdx,wEntry)}));g.removeNode(entry.v);return results}function buildState(g,weightFn){var fasGraph=new Graph;var maxIn=0;var maxOut=0;_.forEach(g.nodes(),(function(v){fasGraph.setNode(v,{v:v,in:0,out:0})}));_.forEach(g.edges(),(function(e){var prevWeight=fasGraph.edge(e.v,e.w)||0;var weight=weightFn(e);var edgeWeight=prevWeight+weight;fasGraph.setEdge(e.v,e.w,edgeWeight);maxOut=Math.max(maxOut,fasGraph.node(e.v).out+=weight);maxIn=Math.max(maxIn,fasGraph.node(e.w)["in"]+=weight)}));var buckets=_.range(maxOut+maxIn+3).map((function(){return new List}));var zeroIdx=maxIn+1;_.forEach(fasGraph.nodes(),(function(v){assignBucket(buckets,zeroIdx,fasGraph.node(v))}));return{graph:fasGraph,buckets:buckets,zeroIdx:zeroIdx}}function assignBucket(buckets,zeroIdx,entry){if(!entry.out){buckets[0].enqueue(entry)}else if(!entry["in"]){buckets[buckets.length-1].enqueue(entry)}else{buckets[entry.out-entry["in"]+zeroIdx].enqueue(entry)}}},function(module,exports){module.exports=List;function List(){var sentinel={};sentinel._next=sentinel._prev=sentinel;this._sentinel=sentinel}List.prototype.dequeue=function(){var sentinel=this._sentinel;var entry=sentinel._prev;if(entry!==sentinel){unlink(entry);return entry}};List.prototype.enqueue=function(entry){var sentinel=this._sentinel;if(entry._prev&&entry._next){unlink(entry)}entry._next=sentinel._next;sentinel._next._prev=entry;sentinel._next=entry;entry._prev=sentinel};List.prototype.toString=function(){var strs=[];var sentinel=this._sentinel;var curr=sentinel._prev;while(curr!==sentinel){strs.push(JSON.stringify(curr,filterOutLinks));curr=curr._prev}return"["+strs.join(", ")+"]"};function unlink(entry){entry._prev._next=entry._next;entry._next._prev=entry._prev;delete entry._next;delete entry._prev}function filterOutLinks(k,v){if(k!=="_next"&&k!=="_prev"){return v}}},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(73);var util=__webpack_require__(97);module.exports={run:run,undo:undo};function run(g){g.graph().dummyChains=[];_.forEach(g.edges(),(function(edge){normalizeEdge(g,edge)}))}function normalizeEdge(g,e){var v=e.v;var vRank=g.node(v).rank;var w=e.w;var wRank=g.node(w).rank;var name=e.name;var edgeLabel=g.edge(e);var labelRank=edgeLabel.labelRank;if(wRank===vRank+1)return;g.removeEdge(e);var dummy,attrs,i;for(i=0,++vRank;vRank<wRank;++i,++vRank){edgeLabel.points=[];attrs={width:0,height:0,edgeLabel:edgeLabel,edgeObj:e,rank:vRank};dummy=util.addDummyNode(g,"edge",attrs,"_d");if(vRank===labelRank){attrs.width=edgeLabel.width;attrs.height=edgeLabel.height;attrs.dummy="edge-label";attrs.labelpos=edgeLabel.labelpos}g.setEdge(v,dummy,{weight:edgeLabel.weight},name);if(i===0){g.graph().dummyChains.push(dummy)}v=dummy}g.setEdge(v,w,{weight:edgeLabel.weight},name)}function undo(g){_.forEach(g.graph().dummyChains,(function(v){var node=g.node(v);var origLabel=node.edgeLabel;var w;g.setEdge(node.edgeObj,origLabel);while(node.dummy){w=g.successors(v)[0];g.removeNode(v);origLabel.points.push({x:node.x,y:node.y});if(node.dummy==="edge-label"){origLabel.x=node.x;origLabel.y=node.y;origLabel.width=node.width;origLabel.height=node.height}v=w;node=g.node(v)}}))}},function(module,exports,__webpack_require__){"use strict";var rankUtil=__webpack_require__(209);var longestPath=rankUtil.longestPath;var feasibleTree=__webpack_require__(357);var networkSimplex=__webpack_require__(651);module.exports=rank;function rank(g){switch(g.graph().ranker){case"network-simplex":networkSimplexRanker(g);break;case"tight-tree":tightTreeRanker(g);break;case"longest-path":longestPathRanker(g);break;default:networkSimplexRanker(g)}}var longestPathRanker=longestPath;function tightTreeRanker(g){longestPath(g);feasibleTree(g)}function networkSimplexRanker(g){networkSimplex(g)}},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(73);var feasibleTree=__webpack_require__(357);var slack=__webpack_require__(209).slack;var initRank=__webpack_require__(209).longestPath;var preorder=__webpack_require__(107).alg.preorder;var postorder=__webpack_require__(107).alg.postorder;var simplify=__webpack_require__(97).simplify;module.exports=networkSimplex;networkSimplex.initLowLimValues=initLowLimValues;networkSimplex.initCutValues=initCutValues;networkSimplex.calcCutValue=calcCutValue;networkSimplex.leaveEdge=leaveEdge;networkSimplex.enterEdge=enterEdge;networkSimplex.exchangeEdges=exchangeEdges;function networkSimplex(g){g=simplify(g);initRank(g);var t=feasibleTree(g);initLowLimValues(t);initCutValues(t,g);var e,f;while(e=leaveEdge(t)){f=enterEdge(t,g,e);exchangeEdges(t,g,e,f)}}function initCutValues(t,g){var vs=postorder(t,t.nodes());vs=vs.slice(0,vs.length-1);_.forEach(vs,(function(v){assignCutValue(t,g,v)}))}function assignCutValue(t,g,child){var childLab=t.node(child);var parent=childLab.parent;t.edge(child,parent).cutvalue=calcCutValue(t,g,child)}function calcCutValue(t,g,child){var childLab=t.node(child);var parent=childLab.parent;var childIsTail=true;var graphEdge=g.edge(child,parent);var cutValue=0;if(!graphEdge){childIsTail=false;graphEdge=g.edge(parent,child)}cutValue=graphEdge.weight;_.forEach(g.nodeEdges(child),(function(e){var isOutEdge=e.v===child,other=isOutEdge?e.w:e.v;if(other!==parent){var pointsToHead=isOutEdge===childIsTail,otherWeight=g.edge(e).weight;cutValue+=pointsToHead?otherWeight:-otherWeight;if(isTreeEdge(t,child,other)){var otherCutValue=t.edge(child,other).cutvalue;cutValue+=pointsToHead?-otherCutValue:otherCutValue}}}));return cutValue}function initLowLimValues(tree,root){if(arguments.length<2){root=tree.nodes()[0]}dfsAssignLowLim(tree,{},1,root)}function dfsAssignLowLim(tree,visited,nextLim,v,parent){var low=nextLim;var label=tree.node(v);visited[v]=true;_.forEach(tree.neighbors(v),(function(w){if(!_.has(visited,w)){nextLim=dfsAssignLowLim(tree,visited,nextLim,w,v)}}));label.low=low;label.lim=nextLim++;if(parent){label.parent=parent}else{delete label.parent}return nextLim}function leaveEdge(tree){return _.find(tree.edges(),(function(e){return tree.edge(e).cutvalue<0}))}function enterEdge(t,g,edge){var v=edge.v;var w=edge.w;if(!g.hasEdge(v,w)){v=edge.w;w=edge.v}var vLabel=t.node(v);var wLabel=t.node(w);var tailLabel=vLabel;var flip=false;if(vLabel.lim>wLabel.lim){tailLabel=wLabel;flip=true}var candidates=_.filter(g.edges(),(function(edge){return flip===isDescendant(t,t.node(edge.v),tailLabel)&&flip!==isDescendant(t,t.node(edge.w),tailLabel)}));return _.minBy(candidates,(function(edge){return slack(g,edge)}))}function exchangeEdges(t,g,e,f){var v=e.v;var w=e.w;t.removeEdge(v,w);t.setEdge(f.v,f.w,{});initLowLimValues(t);initCutValues(t,g);updateRanks(t,g)}function updateRanks(t,g){var root=_.find(t.nodes(),(function(v){return!g.node(v).parent}));var vs=preorder(t,root);vs=vs.slice(1);_.forEach(vs,(function(v){var parent=t.node(v).parent,edge=g.edge(v,parent),flipped=false;if(!edge){edge=g.edge(parent,v);flipped=true}g.node(v).rank=g.node(parent).rank+(flipped?edge.minlen:-edge.minlen)}))}function isTreeEdge(tree,u,v){return tree.hasEdge(u,v)}function isDescendant(tree,vLabel,rootLabel){return rootLabel.low<=vLabel.lim&&vLabel.lim<=rootLabel.lim}},function(module,exports,__webpack_require__){var _=__webpack_require__(73);module.exports=parentDummyChains;function parentDummyChains(g){var postorderNums=postorder(g);_.forEach(g.graph().dummyChains,(function(v){var node=g.node(v);var edgeObj=node.edgeObj;var pathData=findPath(g,postorderNums,edgeObj.v,edgeObj.w);var path=pathData.path;var lca=pathData.lca;var pathIdx=0;var pathV=path[pathIdx];var ascending=true;while(v!==edgeObj.w){node=g.node(v);if(ascending){while((pathV=path[pathIdx])!==lca&&g.node(pathV).maxRank<node.rank){pathIdx++}if(pathV===lca){ascending=false}}if(!ascending){while(pathIdx<path.length-1&&g.node(pathV=path[pathIdx+1]).minRank<=node.rank){pathIdx++}pathV=path[pathIdx]}g.setParent(v,pathV);v=g.successors(v)[0]}}))}function findPath(g,postorderNums,v,w){var vPath=[];var wPath=[];var low=Math.min(postorderNums[v].low,postorderNums[w].low);var lim=Math.max(postorderNums[v].lim,postorderNums[w].lim);var parent;var lca;parent=v;do{parent=g.parent(parent);vPath.push(parent)}while(parent&&(postorderNums[parent].low>low||lim>postorderNums[parent].lim));lca=parent;parent=w;while((parent=g.parent(parent))!==lca){wPath.push(parent)}return{path:vPath.concat(wPath.reverse()),lca:lca}}function postorder(g){var result={};var lim=0;function dfs(v){var low=lim;_.forEach(g.children(v),dfs);result[v]={low:low,lim:lim++}}_.forEach(g.children(),dfs);return result}},function(module,exports,__webpack_require__){var _=__webpack_require__(73);var util=__webpack_require__(97);module.exports={run:run,cleanup:cleanup};function run(g){var root=util.addDummyNode(g,"root",{},"_root");var depths=treeDepths(g);var height=_.max(_.values(depths))-1;var nodeSep=2*height+1;g.graph().nestingRoot=root;_.forEach(g.edges(),(function(e){g.edge(e).minlen*=nodeSep}));var weight=sumWeights(g)+1;_.forEach(g.children(),(function(child){dfs(g,root,nodeSep,weight,height,depths,child)}));g.graph().nodeRankFactor=nodeSep}function dfs(g,root,nodeSep,weight,height,depths,v){var children=g.children(v);if(!children.length){if(v!==root){g.setEdge(root,v,{weight:0,minlen:nodeSep})}return}var top=util.addBorderNode(g,"_bt");var bottom=util.addBorderNode(g,"_bb");var label=g.node(v);g.setParent(top,v);label.borderTop=top;g.setParent(bottom,v);label.borderBottom=bottom;_.forEach(children,(function(child){dfs(g,root,nodeSep,weight,height,depths,child);var childNode=g.node(child);var childTop=childNode.borderTop?childNode.borderTop:child;var childBottom=childNode.borderBottom?childNode.borderBottom:child;var thisWeight=childNode.borderTop?weight:2*weight;var minlen=childTop!==childBottom?1:height-depths[v]+1;g.setEdge(top,childTop,{weight:thisWeight,minlen:minlen,nestingEdge:true});g.setEdge(childBottom,bottom,{weight:thisWeight,minlen:minlen,nestingEdge:true})}));if(!g.parent(v)){g.setEdge(root,top,{weight:0,minlen:height+depths[v]})}}function treeDepths(g){var depths={};function dfs(v,depth){var children=g.children(v);if(children&&children.length){_.forEach(children,(function(child){dfs(child,depth+1)}))}depths[v]=depth}_.forEach(g.children(),(function(v){dfs(v,1)}));return depths}function sumWeights(g){return _.reduce(g.edges(),(function(acc,e){return acc+g.edge(e).weight}),0)}function cleanup(g){var graphLabel=g.graph();g.removeNode(graphLabel.nestingRoot);delete graphLabel.nestingRoot;_.forEach(g.edges(),(function(e){var edge=g.edge(e);if(edge.nestingEdge){g.removeEdge(e)}}))}},function(module,exports,__webpack_require__){var _=__webpack_require__(73);var util=__webpack_require__(97);module.exports=addBorderSegments;function addBorderSegments(g){function dfs(v){var children=g.children(v);var node=g.node(v);if(children.length){_.forEach(children,dfs)}if(_.has(node,"minRank")){node.borderLeft=[];node.borderRight=[];for(var rank=node.minRank,maxRank=node.maxRank+1;rank<maxRank;++rank){addBorderNode(g,"borderLeft","_bl",v,node,rank);addBorderNode(g,"borderRight","_br",v,node,rank)}}}_.forEach(g.children(),dfs)}function addBorderNode(g,prop,prefix,sg,sgNode,rank){var label={width:0,height:0,rank:rank,borderType:prop};var prev=sgNode[prop][rank-1];var curr=util.addDummyNode(g,"border",label,prefix);sgNode[prop][rank]=curr;g.setParent(curr,sg);if(prev){g.setEdge(prev,curr,{weight:1})}}},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(73);module.exports={adjust:adjust,undo:undo};function adjust(g){var rankDir=g.graph().rankdir.toLowerCase();if(rankDir==="lr"||rankDir==="rl"){swapWidthHeight(g)}}function undo(g){var rankDir=g.graph().rankdir.toLowerCase();if(rankDir==="bt"||rankDir==="rl"){reverseY(g)}if(rankDir==="lr"||rankDir==="rl"){swapXY(g);swapWidthHeight(g)}}function swapWidthHeight(g){_.forEach(g.nodes(),(function(v){swapWidthHeightOne(g.node(v))}));_.forEach(g.edges(),(function(e){swapWidthHeightOne(g.edge(e))}))}function swapWidthHeightOne(attrs){var w=attrs.width;attrs.width=attrs.height;attrs.height=w}function reverseY(g){_.forEach(g.nodes(),(function(v){reverseYOne(g.node(v))}));_.forEach(g.edges(),(function(e){var edge=g.edge(e);_.forEach(edge.points,reverseYOne);if(_.has(edge,"y")){reverseYOne(edge)}}))}function reverseYOne(attrs){attrs.y=-attrs.y}function swapXY(g){_.forEach(g.nodes(),(function(v){swapXYOne(g.node(v))}));_.forEach(g.edges(),(function(e){var edge=g.edge(e);_.forEach(edge.points,swapXYOne);if(_.has(edge,"x")){swapXYOne(edge)}}))}function swapXYOne(attrs){var x=attrs.x;attrs.x=attrs.y;attrs.y=x}},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(73);var initOrder=__webpack_require__(657);var crossCount=__webpack_require__(658);var sortSubgraph=__webpack_require__(659);var buildLayerGraph=__webpack_require__(663);var addSubgraphConstraints=__webpack_require__(664);var Graph=__webpack_require__(107).Graph;var util=__webpack_require__(97);module.exports=order;function order(g){var maxRank=util.maxRank(g),downLayerGraphs=buildLayerGraphs(g,_.range(1,maxRank+1),"inEdges"),upLayerGraphs=buildLayerGraphs(g,_.range(maxRank-1,-1,-1),"outEdges");var layering=initOrder(g);assignOrder(g,layering);var bestCC=Number.POSITIVE_INFINITY,best;for(var i=0,lastBest=0;lastBest<4;++i,++lastBest){sweepLayerGraphs(i%2?downLayerGraphs:upLayerGraphs,i%4>=2);layering=util.buildLayerMatrix(g);var cc=crossCount(g,layering);if(cc<bestCC){lastBest=0;best=_.cloneDeep(layering);bestCC=cc}}assignOrder(g,best)}function buildLayerGraphs(g,ranks,relationship){return _.map(ranks,(function(rank){return buildLayerGraph(g,rank,relationship)}))}function sweepLayerGraphs(layerGraphs,biasRight){var cg=new Graph;_.forEach(layerGraphs,(function(lg){var root=lg.graph().root;var sorted=sortSubgraph(lg,root,cg,biasRight);_.forEach(sorted.vs,(function(v,i){lg.node(v).order=i}));addSubgraphConstraints(lg,cg,sorted.vs)}))}function assignOrder(g,layering){_.forEach(layering,(function(layer){_.forEach(layer,(function(v,i){g.node(v).order=i}))}))}},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(73);module.exports=initOrder;function initOrder(g){var visited={};var simpleNodes=_.filter(g.nodes(),(function(v){return!g.children(v).length}));var maxRank=_.max(_.map(simpleNodes,(function(v){return g.node(v).rank})));var layers=_.map(_.range(maxRank+1),(function(){return[]}));function dfs(v){if(_.has(visited,v))return;visited[v]=true;var node=g.node(v);layers[node.rank].push(v);_.forEach(g.successors(v),dfs)}var orderedVs=_.sortBy(simpleNodes,(function(v){return g.node(v).rank}));_.forEach(orderedVs,dfs);return layers}},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(73);module.exports=crossCount;function crossCount(g,layering){var cc=0;for(var i=1;i<layering.length;++i){cc+=twoLayerCrossCount(g,layering[i-1],layering[i])}return cc}function twoLayerCrossCount(g,northLayer,southLayer){var southPos=_.zipObject(southLayer,_.map(southLayer,(function(v,i){return i})));var southEntries=_.flatten(_.map(northLayer,(function(v){return _.sortBy(_.map(g.outEdges(v),(function(e){return{pos:southPos[e.w],weight:g.edge(e).weight}})),"pos")})),true);var firstIndex=1;while(firstIndex<southLayer.length)firstIndex<<=1;var treeSize=2*firstIndex-1;firstIndex-=1;var tree=_.map(new Array(treeSize),(function(){return 0}));var cc=0;_.forEach(southEntries.forEach((function(entry){var index=entry.pos+firstIndex;tree[index]+=entry.weight;var weightSum=0;while(index>0){if(index%2){weightSum+=tree[index+1]}index=index-1>>1;tree[index]+=entry.weight}cc+=entry.weight*weightSum})));return cc}},function(module,exports,__webpack_require__){var _=__webpack_require__(73);var barycenter=__webpack_require__(660);var resolveConflicts=__webpack_require__(661);var sort=__webpack_require__(662);module.exports=sortSubgraph;function sortSubgraph(g,v,cg,biasRight){var movable=g.children(v);var node=g.node(v);var bl=node?node.borderLeft:undefined;var br=node?node.borderRight:undefined;var subgraphs={};if(bl){movable=_.filter(movable,(function(w){return w!==bl&&w!==br}))}var barycenters=barycenter(g,movable);_.forEach(barycenters,(function(entry){if(g.children(entry.v).length){var subgraphResult=sortSubgraph(g,entry.v,cg,biasRight);subgraphs[entry.v]=subgraphResult;if(_.has(subgraphResult,"barycenter")){mergeBarycenters(entry,subgraphResult)}}}));var entries=resolveConflicts(barycenters,cg);expandSubgraphs(entries,subgraphs);var result=sort(entries,biasRight);if(bl){result.vs=_.flatten([bl,result.vs,br],true);if(g.predecessors(bl).length){var blPred=g.node(g.predecessors(bl)[0]),brPred=g.node(g.predecessors(br)[0]);if(!_.has(result,"barycenter")){result.barycenter=0;result.weight=0}result.barycenter=(result.barycenter*result.weight+blPred.order+brPred.order)/(result.weight+2);result.weight+=2}}return result}function expandSubgraphs(entries,subgraphs){_.forEach(entries,(function(entry){entry.vs=_.flatten(entry.vs.map((function(v){if(subgraphs[v]){return subgraphs[v].vs}return v})),true)}))}function mergeBarycenters(target,other){if(!_.isUndefined(target.barycenter)){target.barycenter=(target.barycenter*target.weight+other.barycenter*other.weight)/(target.weight+other.weight);target.weight+=other.weight}else{target.barycenter=other.barycenter;target.weight=other.weight}}},function(module,exports,__webpack_require__){var _=__webpack_require__(73);module.exports=barycenter;function barycenter(g,movable){return _.map(movable,(function(v){var inV=g.inEdges(v);if(!inV.length){return{v:v}}else{var result=_.reduce(inV,(function(acc,e){var edge=g.edge(e),nodeU=g.node(e.v);return{sum:acc.sum+edge.weight*nodeU.order,weight:acc.weight+edge.weight}}),{sum:0,weight:0});return{v:v,barycenter:result.sum/result.weight,weight:result.weight}}}))}},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(73);module.exports=resolveConflicts;function resolveConflicts(entries,cg){var mappedEntries={};_.forEach(entries,(function(entry,i){var tmp=mappedEntries[entry.v]={indegree:0,in:[],out:[],vs:[entry.v],i:i};if(!_.isUndefined(entry.barycenter)){tmp.barycenter=entry.barycenter;tmp.weight=entry.weight}}));_.forEach(cg.edges(),(function(e){var entryV=mappedEntries[e.v];var entryW=mappedEntries[e.w];if(!_.isUndefined(entryV)&&!_.isUndefined(entryW)){entryW.indegree++;entryV.out.push(mappedEntries[e.w])}}));var sourceSet=_.filter(mappedEntries,(function(entry){return!entry.indegree}));return doResolveConflicts(sourceSet)}function doResolveConflicts(sourceSet){var entries=[];function handleIn(vEntry){return function(uEntry){if(uEntry.merged){return}if(_.isUndefined(uEntry.barycenter)||_.isUndefined(vEntry.barycenter)||uEntry.barycenter>=vEntry.barycenter){mergeEntries(vEntry,uEntry)}}}function handleOut(vEntry){return function(wEntry){wEntry["in"].push(vEntry);if(--wEntry.indegree===0){sourceSet.push(wEntry)}}}while(sourceSet.length){var entry=sourceSet.pop();entries.push(entry);_.forEach(entry["in"].reverse(),handleIn(entry));_.forEach(entry.out,handleOut(entry))}return _.map(_.filter(entries,(function(entry){return!entry.merged})),(function(entry){return _.pick(entry,["vs","i","barycenter","weight"])}))}function mergeEntries(target,source){var sum=0;var weight=0;if(target.weight){sum+=target.barycenter*target.weight;weight+=target.weight}if(source.weight){sum+=source.barycenter*source.weight;weight+=source.weight}target.vs=source.vs.concat(target.vs);target.barycenter=sum/weight;target.weight=weight;target.i=Math.min(source.i,target.i);source.merged=true}},function(module,exports,__webpack_require__){var _=__webpack_require__(73);var util=__webpack_require__(97);module.exports=sort;function sort(entries,biasRight){var parts=util.partition(entries,(function(entry){return _.has(entry,"barycenter")}));var sortable=parts.lhs,unsortable=_.sortBy(parts.rhs,(function(entry){return-entry.i})),vs=[],sum=0,weight=0,vsIndex=0;sortable.sort(compareWithBias(!!biasRight));vsIndex=consumeUnsortable(vs,unsortable,vsIndex);_.forEach(sortable,(function(entry){vsIndex+=entry.vs.length;vs.push(entry.vs);sum+=entry.barycenter*entry.weight;weight+=entry.weight;vsIndex=consumeUnsortable(vs,unsortable,vsIndex)}));var result={vs:_.flatten(vs,true)};if(weight){result.barycenter=sum/weight;result.weight=weight}return result}function consumeUnsortable(vs,unsortable,index){var last;while(unsortable.length&&(last=_.last(unsortable)).i<=index){unsortable.pop();vs.push(last.vs);index++}return index}function compareWithBias(bias){return function(entryV,entryW){if(entryV.barycenter<entryW.barycenter){return-1}else if(entryV.barycenter>entryW.barycenter){return 1}return!bias?entryV.i-entryW.i:entryW.i-entryV.i}}},function(module,exports,__webpack_require__){var _=__webpack_require__(73);var Graph=__webpack_require__(107).Graph;module.exports=buildLayerGraph;function buildLayerGraph(g,rank,relationship){var root=createRootNode(g),result=new Graph({compound:true}).setGraph({root:root}).setDefaultNodeLabel((function(v){return g.node(v)}));_.forEach(g.nodes(),(function(v){var node=g.node(v),parent=g.parent(v);if(node.rank===rank||node.minRank<=rank&&rank<=node.maxRank){result.setNode(v);result.setParent(v,parent||root);_.forEach(g[relationship](v),(function(e){var u=e.v===v?e.w:e.v,edge=result.edge(u,v),weight=!_.isUndefined(edge)?edge.weight:0;result.setEdge(u,v,{weight:g.edge(e).weight+weight})}));if(_.has(node,"minRank")){result.setNode(v,{borderLeft:node.borderLeft[rank],borderRight:node.borderRight[rank]})}}}));return result}function createRootNode(g){var v;while(g.hasNode(v=_.uniqueId("_root")));return v}},function(module,exports,__webpack_require__){var _=__webpack_require__(73);module.exports=addSubgraphConstraints;function addSubgraphConstraints(g,cg,vs){var prev={},rootPrev;_.forEach(vs,(function(v){var child=g.parent(v),parent,prevChild;while(child){parent=g.parent(child);if(parent){prevChild=prev[parent];prev[parent]=child}else{prevChild=rootPrev;rootPrev=child}if(prevChild&&prevChild!==child){cg.setEdge(prevChild,child);return}child=parent}}))}},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(73);var util=__webpack_require__(97);var positionX=__webpack_require__(666).positionX;module.exports=position;function position(g){g=util.asNonCompoundGraph(g);positionY(g);_.forEach(positionX(g),(function(x,v){g.node(v).x=x}))}function positionY(g){var layering=util.buildLayerMatrix(g);var rankSep=g.graph().ranksep;var prevY=0;_.forEach(layering,(function(layer){var maxHeight=_.max(_.map(layer,(function(v){return g.node(v).height})));_.forEach(layer,(function(v){g.node(v).y=prevY+maxHeight/2}));prevY+=maxHeight+rankSep}))}},function(module,exports,__webpack_require__){"use strict";var _=__webpack_require__(73);var Graph=__webpack_require__(107).Graph;var util=__webpack_require__(97);module.exports={positionX:positionX,findType1Conflicts:findType1Conflicts,findType2Conflicts:findType2Conflicts,addConflict:addConflict,hasConflict:hasConflict,verticalAlignment:verticalAlignment,horizontalCompaction:horizontalCompaction,alignCoordinates:alignCoordinates,findSmallestWidthAlignment:findSmallestWidthAlignment,balance:balance};function findType1Conflicts(g,layering){var conflicts={};function visitLayer(prevLayer,layer){var k0=0,scanPos=0,prevLayerLength=prevLayer.length,lastNode=_.last(layer);_.forEach(layer,(function(v,i){var w=findOtherInnerSegmentNode(g,v),k1=w?g.node(w).order:prevLayerLength;if(w||v===lastNode){_.forEach(layer.slice(scanPos,i+1),(function(scanNode){_.forEach(g.predecessors(scanNode),(function(u){var uLabel=g.node(u),uPos=uLabel.order;if((uPos<k0||k1<uPos)&&!(uLabel.dummy&&g.node(scanNode).dummy)){addConflict(conflicts,u,scanNode)}}))}));scanPos=i+1;k0=k1}}));return layer}_.reduce(layering,visitLayer);return conflicts}function findType2Conflicts(g,layering){var conflicts={};function scan(south,southPos,southEnd,prevNorthBorder,nextNorthBorder){var v;_.forEach(_.range(southPos,southEnd),(function(i){v=south[i];if(g.node(v).dummy){_.forEach(g.predecessors(v),(function(u){var uNode=g.node(u);if(uNode.dummy&&(uNode.order<prevNorthBorder||uNode.order>nextNorthBorder)){addConflict(conflicts,u,v)}}))}}))}function visitLayer(north,south){var prevNorthPos=-1,nextNorthPos,southPos=0;_.forEach(south,(function(v,southLookahead){if(g.node(v).dummy==="border"){var predecessors=g.predecessors(v);if(predecessors.length){nextNorthPos=g.node(predecessors[0]).order;scan(south,southPos,southLookahead,prevNorthPos,nextNorthPos);southPos=southLookahead;prevNorthPos=nextNorthPos}}scan(south,southPos,south.length,nextNorthPos,north.length)}));return south}_.reduce(layering,visitLayer);return conflicts}function findOtherInnerSegmentNode(g,v){if(g.node(v).dummy){return _.find(g.predecessors(v),(function(u){return g.node(u).dummy}))}}function addConflict(conflicts,v,w){if(v>w){var tmp=v;v=w;w=tmp}var conflictsV=conflicts[v];if(!conflictsV){conflicts[v]=conflictsV={}}conflictsV[w]=true}function hasConflict(conflicts,v,w){if(v>w){var tmp=v;v=w;w=tmp}return _.has(conflicts[v],w)}function verticalAlignment(g,layering,conflicts,neighborFn){var root={},align={},pos={};_.forEach(layering,(function(layer){_.forEach(layer,(function(v,order){root[v]=v;align[v]=v;pos[v]=order}))}));_.forEach(layering,(function(layer){var prevIdx=-1;_.forEach(layer,(function(v){var ws=neighborFn(v);if(ws.length){ws=_.sortBy(ws,(function(w){return pos[w]}));var mp=(ws.length-1)/2;for(var i=Math.floor(mp),il=Math.ceil(mp);i<=il;++i){var w=ws[i];if(align[v]===v&&prevIdx<pos[w]&&!hasConflict(conflicts,v,w)){align[w]=v;align[v]=root[v]=root[w];prevIdx=pos[w]}}}}))}));return{root:root,align:align}}function horizontalCompaction(g,layering,root,align,reverseSep){var xs={},blockG=buildBlockGraph(g,layering,root,reverseSep),borderType=reverseSep?"borderLeft":"borderRight";function iterate(setXsFunc,nextNodesFunc){var stack=blockG.nodes();var elem=stack.pop();var visited={};while(elem){if(visited[elem]){setXsFunc(elem)}else{visited[elem]=true;stack.push(elem);stack=stack.concat(nextNodesFunc(elem))}elem=stack.pop()}}function pass1(elem){xs[elem]=blockG.inEdges(elem).reduce((function(acc,e){return Math.max(acc,xs[e.v]+blockG.edge(e))}),0)}function pass2(elem){var min=blockG.outEdges(elem).reduce((function(acc,e){return Math.min(acc,xs[e.w]-blockG.edge(e))}),Number.POSITIVE_INFINITY);var node=g.node(elem);if(min!==Number.POSITIVE_INFINITY&&node.borderType!==borderType){xs[elem]=Math.max(xs[elem],min)}}iterate(pass1,blockG.predecessors.bind(blockG));iterate(pass2,blockG.successors.bind(blockG));_.forEach(align,(function(v){xs[v]=xs[root[v]]}));return xs}function buildBlockGraph(g,layering,root,reverseSep){var blockGraph=new Graph,graphLabel=g.graph(),sepFn=sep(graphLabel.nodesep,graphLabel.edgesep,reverseSep);_.forEach(layering,(function(layer){var u;_.forEach(layer,(function(v){var vRoot=root[v];blockGraph.setNode(vRoot);if(u){var uRoot=root[u],prevMax=blockGraph.edge(uRoot,vRoot);blockGraph.setEdge(uRoot,vRoot,Math.max(sepFn(g,v,u),prevMax||0))}u=v}))}));return blockGraph}function findSmallestWidthAlignment(g,xss){return _.minBy(_.values(xss),(function(xs){var max=Number.NEGATIVE_INFINITY;var min=Number.POSITIVE_INFINITY;_.forIn(xs,(function(x,v){var halfWidth=width(g,v)/2;max=Math.max(x+halfWidth,max);min=Math.min(x-halfWidth,min)}));return max-min}))}function alignCoordinates(xss,alignTo){var alignToVals=_.values(alignTo),alignToMin=_.min(alignToVals),alignToMax=_.max(alignToVals);_.forEach(["u","d"],(function(vert){_.forEach(["l","r"],(function(horiz){var alignment=vert+horiz,xs=xss[alignment],delta;if(xs===alignTo)return;var xsVals=_.values(xs);delta=horiz==="l"?alignToMin-_.min(xsVals):alignToMax-_.max(xsVals);if(delta){xss[alignment]=_.mapValues(xs,(function(x){return x+delta}))}}))}))}function balance(xss,align){return _.mapValues(xss.ul,(function(ignore,v){if(align){return xss[align.toLowerCase()][v]}else{var xs=_.sortBy(_.map(xss,v));return(xs[1]+xs[2])/2}}))}function positionX(g){var layering=util.buildLayerMatrix(g);var conflicts=_.merge(findType1Conflicts(g,layering),findType2Conflicts(g,layering));var xss={};var adjustedLayering;_.forEach(["u","d"],(function(vert){adjustedLayering=vert==="u"?layering:_.values(layering).reverse();_.forEach(["l","r"],(function(horiz){if(horiz==="r"){adjustedLayering=_.map(adjustedLayering,(function(inner){return _.values(inner).reverse()}))}var neighborFn=(vert==="u"?g.predecessors:g.successors).bind(g);var align=verticalAlignment(g,adjustedLayering,conflicts,neighborFn);var xs=horizontalCompaction(g,adjustedLayering,align.root,align.align,horiz==="r");if(horiz==="r"){xs=_.mapValues(xs,(function(x){return-x}))}xss[vert+horiz]=xs}))}));var smallestWidth=findSmallestWidthAlignment(g,xss);alignCoordinates(xss,smallestWidth);return balance(xss,g.graph().align)}function sep(nodeSep,edgeSep,reverseSep){return function(g,v,w){var vLabel=g.node(v);var wLabel=g.node(w);var sum=0;var delta;sum+=vLabel.width/2;if(_.has(vLabel,"labelpos")){switch(vLabel.labelpos.toLowerCase()){case"l":delta=-vLabel.width/2;break;case"r":delta=vLabel.width/2;break}}if(delta){sum+=reverseSep?delta:-delta}delta=0;sum+=(vLabel.dummy?edgeSep:nodeSep)/2;sum+=(wLabel.dummy?edgeSep:nodeSep)/2;sum+=wLabel.width/2;if(_.has(wLabel,"labelpos")){switch(wLabel.labelpos.toLowerCase()){case"l":delta=wLabel.width/2;break;case"r":delta=-wLabel.width/2;break}}if(delta){sum+=reverseSep?delta:-delta}delta=0;return sum}}function width(g,v){return g.node(v).width}},function(module,exports,__webpack_require__){var _=__webpack_require__(73);var util=__webpack_require__(97);var Graph=__webpack_require__(107).Graph;module.exports={debugOrdering:debugOrdering};function debugOrdering(g){var layerMatrix=util.buildLayerMatrix(g);var h=new Graph({compound:true,multigraph:true}).setGraph({});_.forEach(g.nodes(),(function(v){h.setNode(v,{label:v});h.setParent(v,"layer"+g.node(v).rank)}));_.forEach(g.edges(),(function(e){h.setEdge(e.v,e.w,{},e.name)}));_.forEach(layerMatrix,(function(layer,i){var layerV="layer"+i;h.setNode(layerV,{rank:"same"});_.reduce(layer,(function(u,v){h.setEdge(u,v,{style:"invis"});return v}))}));return h}},function(module,exports){module.exports="0.8.5"},function(module,exports){module.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIiBmaWxsPSIjMzQzNzQxIj4KICA8cGF0aCBkPSJNNi45OTk4NSAxNnY1LjAwMDJIOS4wMzc5QzkuMDEyOCAyMS4zMzAxIDkgMjEuNjYzNiA5IDIyYzAgLjMzNjQuMDEyOC42Njk5LjAzNzkuOTk5OEg2Ljk5OTg1VjI4aC0xLjk5OTd2LTUuMDAwMkgwdi0xLjk5OTZoNS4wMDAxNVYxNmgxLjk5OTd6bTAtMTZ2NS4wMDAxNUgxMnYxLjk5OTdINi45OTk4NVYxMmgtMS45OTk3VjYuOTk5ODVIMHYtMS45OTk3aDUuMDAwMTVWMGgxLjk5OTd6TTIyLjk5OTggMHY1LjAwMDE1SDI4djEuOTk5N2gtNS4wMDAyVjkuMDM3OUMyMi42Njk5IDkuMDEyOCAyMi4zMzY0IDkgMjIgOWMtLjMzNjQgMC0uNjY5OS4wMTI4LS45OTk4LjAzNzlWNi45OTk4NUgxNnYtMS45OTk3aDUuMDAwMlYwaDEuOTk5NnoiIC8+CiAgICA8cGF0aAogICAgICBmaWxsPSIjMDE3RDczIgogICAgICBkPSJNMjIgMTBjMy4wNzM0IDAgNS44NzcgMS4xNTU0IDggMy4wNTU2djMuMjUyNWMtLjMxNS0uNDQyNy0uNjY4Mi0uODYxMy0xLjA1NzUtMS4yNTA2LTEuODQxMy0xLjg0MTMtNC4zMzg2LTIuODc1Ny02Ljk0MjUtMi44NzU3LTUuNDIyNCAwLTkuODE4MiA0LjM5NTgtOS44MTgyIDkuODE4MiAwIDMuMzAwMSAxLjYyODIgNi4yMTk5IDQuMTI1MSA4aC0zLjI1MTNDMTEuMTU1NCAyNy44NzcgMTAgMjUuMDczNCAxMCAyMmMwLTYuNjI3NCA1LjM3MjYtMTIgMTItMTJ6bS45OTk4IDh2My4wMDAySDI2djEuOTk5NmgtMy4wMDAyVjI2aC0xLjk5OTZ2LTMuMDAwMkgxOHYtMS45OTk2aDMuMDAwMlYxOGgxLjk5OTZ6IgogICAgLz4KPC9zdmc+Cg=="},function(module,exports){module.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIiBmaWxsPSIjMzQzNzQxIj4KICAgIDxwYXRoIGQ9Ik0yIDEydjZoNnYySDB2LThoMnptMTggMHY4aC04di0yaDZ2LTZoMnpNOCAwdjJIMnY2SDBWMGg4em0xMiAwdjhoLTJWMmgtNlYwaDh6IiAvPgogICAgPHBhdGgKICAgICAgZmlsbD0iIzAxN0Q3MyIKICAgICAgZD0iTTE2IDI0YzIuMjA5MSAwIDQgMS43OTA5IDQgNCAwIDIuMjA5MS0xLjc5MDkgNC00IDQtMi4yMDkxIDAtNC0xLjc5MDktNC00IDAtMi4yMDkxIDEuNzkwOS00IDQtNHptMTIgMGMyLjIwOTEgMCA0IDEuNzkwOSA0IDQgMCAyLjIwOTEtMS43OTA5IDQtNCA0LTIuMjA5MSAwLTQtMS43OTA5LTQtNCAwLTIuMjA5MSAxLjc5MDktNCA0LTR6bS0xMiAxLjc1Yy0xLjI0MjYgMC0yLjI1IDEuMDA3NC0yLjI1IDIuMjVzMS4wMDc0IDIuMjUgMi4yNSAyLjI1IDIuMjUtMS4wMDc0IDIuMjUtMi4yNS0xLjAwNzQtMi4yNS0yLjI1LTIuMjV6bTEyIDBjLTEuMjQyNiAwLTIuMjUgMS4wMDc0LTIuMjUgMi4yNXMxLjAwNzQgMi4yNSAyLjI1IDIuMjUgMi4yNS0xLjAwNzQgMi4yNS0yLjI1LTEuMDA3NC0yLjI1LTIuMjUtMi4yNXpNMjggMTJjMi4yMDkxIDAgNCAxLjc5MDkgNCA0IDAgMi4yMDkxLTEuNzkwOSA0LTQgNC0yLjIwOTEgMC00LTEuNzkwOS00LTQgMC0yLjIwOTEgMS43OTA5LTQgNC00em0wIDEuNzVjLTEuMjQyNiAwLTIuMjUgMS4wMDc0LTIuMjUgMi4yNXMxLjAwNzQgMi4yNSAyLjI1IDIuMjUgMi4yNS0xLjAwNzQgMi4yNS0yLjI1LTEuMDA3NC0yLjI1LTIuMjUtMi4yNXpNMTAgNmMyLjIwOTEgMCA0IDEuNzkwODYgNCA0IDAgMi4yMDkxLTEuNzkwOSA0LTQgNC0yLjIwOTE0IDAtNC0xLjc5MDktNC00IDAtMi4yMDkxNCAxLjc5MDg2LTQgNC00em0wIDEuNzVjLTEuMjQyNjQgMC0yLjI1IDEuMDA3MzYtMi4yNSAyLjI1IDAgMS4yNDI2IDEuMDA3MzYgMi4yNSAyLjI1IDIuMjUgMS4yNDI2IDAgMi4yNS0xLjAwNzQgMi4yNS0yLjI1IDAtMS4yNDI2NC0xLjAwNzQtMi4yNS0yLjI1LTIuMjV6IgogICAgLz4KPC9zdmc+Cg=="},function(module,exports){module.exports="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIiBmaWxsPSIjMzQzNzQxIj4KICA8cGF0aCBkPSJNMjQgMGM0LjQxODMgMCA4IDMuNTgxNzIgOCA4IDAgMi4xMjE3LS44NDI5IDQuMTU2Ni0yLjM0MzEgNS42NTY5QzI4LjE1NjYgMTUuMTU3MSAyNi4xMjE3IDE2IDI0IDE2Yy0xLjg0ODcgMC0zLjU1MDktLjYyNzEtNC45MDU2LTEuNjgwMWwtNC43NzQ1IDQuNzc0NUMxNS4zNzI5IDIwLjQ0OTEgMTYgMjIuMTUxMyAxNiAyNGMwIDIuMTIxNy0uODQyOSA0LjE1NjYtMi4zNDMxIDUuNjU2OUMxMi4xNTY2IDMxLjE1NzEgMTAuMTIxNyAzMiA4IDMyYy00LjQxODI4IDAtOC0zLjU4MTctOC04czMuNTgxNzItOCA4LThjMS44NDg3MiAwIDMuNTUxLjYyNzEgNC45MDU3IDEuNjgwMmw0Ljc3NDUtNC43NzQ1QzE2LjYyNzEgMTEuNTUxIDE2IDkuODQ4NzIgMTYgOGMwLTQuNDE4MjggMy41ODE3LTggOC04ek04IDE4Yy0zLjMxMzcxIDAtNiAyLjY4NjMtNiA2czIuNjg2MjkgNiA2IDZjMy4zMTM3IDAgNi0yLjY4NjMgNi02IDAtMS41OTEzLS42MzIxLTMuMTE3NC0xLjc1NzQtNC4yNDI2QzExLjExNzQgMTguNjMyMSA5LjU5MTMgMTggOCAxOHpNMjQgMmMtMy4zMTM3IDAtNiAyLjY4NjI5LTYgNiAwIDMuMzEzNyAyLjY4NjMgNiA2IDZzNi0yLjY4NjMgNi02YzAtMS41OTEzLS42MzIxLTMuMTE3NDItMS43NTc0LTQuMjQyNjRDMjcuMTE3NCAyLjYzMjE0IDI1LjU5MTMgMiAyNCAyeiIvPgogIDxwYXRoIGZpbGw9IiMwMTdENzMiICBkPSJNMzIgMjB2MTJIMjBWMjBoMTJ6bS0yIDJoLTh2OGg4di04ek0xMiAwdjEySDBWMGgxMnptLTIgMkgydjhoOFYyeiIvPgo8L3N2Zz4K"},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tslib_1=__webpack_require__(38);var react_1=__webpack_require__(10);var useRafState_1=tslib_1.__importDefault(__webpack_require__(673));var util_1=__webpack_require__(675);var useWindowSize=function(initialWidth,initialHeight){if(initialWidth===void 0){initialWidth=Infinity}if(initialHeight===void 0){initialHeight=Infinity}var _a=useRafState_1.default({width:util_1.isClient?window.innerWidth:initialWidth,height:util_1.isClient?window.innerHeight:initialHeight}),state=_a[0],setState=_a[1];react_1.useEffect((function(){if(util_1.isClient){var handler_1=function(){setState({width:window.innerWidth,height:window.innerHeight})};window.addEventListener("resize",handler_1);return function(){window.removeEventListener("resize",handler_1)}}}),[]);return state};exports.default=useWindowSize},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tslib_1=__webpack_require__(38);var react_1=__webpack_require__(10);var useUnmount_1=tslib_1.__importDefault(__webpack_require__(674));var useRafState=function(initialState){var frame=react_1.useRef(0);var _a=react_1.useState(initialState),state=_a[0],setState=_a[1];var setRafState=react_1.useCallback((function(value){cancelAnimationFrame(frame.current);frame.current=requestAnimationFrame((function(){setState(value)}))}),[]);useUnmount_1.default((function(){cancelAnimationFrame(frame.current)}));return[state,setRafState]};exports.default=useRafState},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var tslib_1=__webpack_require__(38);var react_1=__webpack_require__(10);var useEffectOnce_1=tslib_1.__importDefault(__webpack_require__(249));var useUnmount=function(fn){var fnRef=react_1.useRef(fn);fnRef.current=fn;useEffectOnce_1.default((function(){return function(){return fnRef.current()}}))};exports.default=useUnmount},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isDeepEqual=exports.off=exports.on=exports.isClient=void 0;var tslib_1=__webpack_require__(38);var react_1=tslib_1.__importDefault(__webpack_require__(676));exports.isClient=typeof window==="object";exports.on=function(obj){var args=[];for(var _i=1;_i<arguments.length;_i++){args[_i-1]=arguments[_i]}return obj.addEventListener.apply(obj,args)};exports.off=function(obj){var args=[];for(var _i=1;_i<arguments.length;_i++){args[_i-1]=arguments[_i]}return obj.removeEventListener.apply(obj,args)};exports.isDeepEqual=react_1.default},function(module,exports,__webpack_require__){"use strict";module.exports=function equal(a,b){if(a===b)return true;if(a&&b&&typeof a=="object"&&typeof b=="object"){if(a.constructor!==b.constructor)return false;var length,i,keys;if(Array.isArray(a)){length=a.length;if(length!=b.length)return false;for(i=length;i--!==0;)if(!equal(a[i],b[i]))return false;return true}if(a.constructor===RegExp)return a.source===b.source&&a.flags===b.flags;if(a.valueOf!==Object.prototype.valueOf)return a.valueOf()===b.valueOf();if(a.toString!==Object.prototype.toString)return a.toString()===b.toString();keys=Object.keys(a);length=keys.length;if(length!==Object.keys(b).length)return false;for(i=length;i--!==0;)if(!Object.prototype.hasOwnProperty.call(b,keys[i]))return false;for(i=length;i--!==0;){var key=keys[i];if(key==="_owner"&&a.$$typeof){continue}if(!equal(a[key],b[key]))return false}return true}return a!==a&&b!==b}},function(module,exports,__webpack_require__){switch(window.__kbnThemeTag__){case"v7dark":return __webpack_require__(678);case"v7light":return __webpack_require__(680);case"v8dark":return __webpack_require__(682);case"v8light":return __webpack_require__(684)}},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(679);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".mlScatterplotMatrix {\n  overflow-x: auto; }\n  .mlScatterplotMatrix .vega-bind span {\n    font-size: 12px;\n    padding: 0 4px; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(681);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".mlScatterplotMatrix {\n  overflow-x: auto; }\n  .mlScatterplotMatrix .vega-bind span {\n    font-size: 12px;\n    padding: 0 4px; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(683);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".mlScatterplotMatrix {\n  overflow-x: auto; }\n  .mlScatterplotMatrix .vega-bind span {\n    font-size: 12px;\n    padding: 0 4px; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(685);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".mlScatterplotMatrix {\n  overflow-x: auto; }\n  .mlScatterplotMatrix .vega-bind span {\n    font-size: 12px;\n    padding: 0 4px; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(687);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".mlExpandableSection {\n  padding: 0 8px 8px 8px; }\n\n.mlExpandableSection-contentPadding {\n  padding: 8px; }\n\n[id^='echTooltipPortal'] {\n  z-index: 9000 !important; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(689);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".mlExpandableSection {\n  padding: 0 8px 8px 8px; }\n\n.mlExpandableSection-contentPadding {\n  padding: 8px; }\n\n[id^='echTooltipPortal'] {\n  z-index: 9000 !important; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(691);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".mlExpandableSection {\n  padding: 0 8px 8px 8px; }\n\n.mlExpandableSection-contentPadding {\n  padding: 8px; }\n\n[id^='echTooltipPortal'] {\n  z-index: 9000 !important; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(693);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".mlExpandableSection {\n  padding: 0 8px 8px 8px; }\n\n.mlExpandableSection-contentPadding {\n  padding: 8px; }\n\n[id^='echTooltipPortal'] {\n  z-index: 9000 !important; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var react_1=__webpack_require__(10);var useFirstMountState_1=__webpack_require__(695);var useUpdateEffect=function(effect,deps){var isFirstMount=useFirstMountState_1.useFirstMountState();react_1.useEffect((function(){if(!isFirstMount){return effect()}}),deps)};exports.default=useUpdateEffect},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.useFirstMountState=void 0;var react_1=__webpack_require__(10);function useFirstMountState(){var isFirst=react_1.useRef(true);if(isFirst.current){isFirst.current=false;return true}return isFirst.current}exports.useFirstMountState=useFirstMountState},function(module,exports,__webpack_require__){switch(window.__kbnThemeTag__){case"v7dark":return __webpack_require__(697);case"v7light":return __webpack_require__(699);case"v8dark":return __webpack_require__(701);case"v8light":return __webpack_require__(703)}},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(698);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,"/* Fixed width so we can align it with the padding of the AUC ROC chart. */\n/*\n  Workaround for EuiDataGrid within a Flex Layout,\n  this tricks browsers treating the width as a px value instead of %\n*/\n.mlDataFrameAnalyticsClassification {\n  width: 100%; }\n\n.mlDataFrameAnalyticsClassification__evaluateSectionContent {\n  padding: 0 5%; }\n\n/*\n  The following two classes are a workaround to avoid having EuiDataGrid in a flex layout\n  and just uses a legacy approach for a two column layout so we don't break IE11.\n*/\n.mlDataFrameAnalyticsClassification__evaluateSectionContent:after {\n  content: '';\n  display: table;\n  clear: both; }\n\n.mlDataFrameAnalyticsClassification__actualLabel {\n  float: left;\n  width: 80px;\n  padding-top: 64px; }\n\n/*\n  Gives EuiDataGrid a min-width of 480px, otherwise the columns options will disappear if you hide all columns.\n*/\n.mlDataFrameAnalyticsClassification__dataGridMinWidth {\n  float: left;\n  min-width: 480px;\n  width: calc(100% - 80px); }\n  .mlDataFrameAnalyticsClassification__dataGridMinWidth .euiDataGridRowCell--boolean {\n    text-transform: none; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(700);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,"/* Fixed width so we can align it with the padding of the AUC ROC chart. */\n/*\n  Workaround for EuiDataGrid within a Flex Layout,\n  this tricks browsers treating the width as a px value instead of %\n*/\n.mlDataFrameAnalyticsClassification {\n  width: 100%; }\n\n.mlDataFrameAnalyticsClassification__evaluateSectionContent {\n  padding: 0 5%; }\n\n/*\n  The following two classes are a workaround to avoid having EuiDataGrid in a flex layout\n  and just uses a legacy approach for a two column layout so we don't break IE11.\n*/\n.mlDataFrameAnalyticsClassification__evaluateSectionContent:after {\n  content: '';\n  display: table;\n  clear: both; }\n\n.mlDataFrameAnalyticsClassification__actualLabel {\n  float: left;\n  width: 80px;\n  padding-top: 64px; }\n\n/*\n  Gives EuiDataGrid a min-width of 480px, otherwise the columns options will disappear if you hide all columns.\n*/\n.mlDataFrameAnalyticsClassification__dataGridMinWidth {\n  float: left;\n  min-width: 480px;\n  width: calc(100% - 80px); }\n  .mlDataFrameAnalyticsClassification__dataGridMinWidth .euiDataGridRowCell--boolean {\n    text-transform: none; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(702);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,"/* Fixed width so we can align it with the padding of the AUC ROC chart. */\n/*\n  Workaround for EuiDataGrid within a Flex Layout,\n  this tricks browsers treating the width as a px value instead of %\n*/\n.mlDataFrameAnalyticsClassification {\n  width: 100%; }\n\n.mlDataFrameAnalyticsClassification__evaluateSectionContent {\n  padding: 0 5%; }\n\n/*\n  The following two classes are a workaround to avoid having EuiDataGrid in a flex layout\n  and just uses a legacy approach for a two column layout so we don't break IE11.\n*/\n.mlDataFrameAnalyticsClassification__evaluateSectionContent:after {\n  content: '';\n  display: table;\n  clear: both; }\n\n.mlDataFrameAnalyticsClassification__actualLabel {\n  float: left;\n  width: 80px;\n  padding-top: 64px; }\n\n/*\n  Gives EuiDataGrid a min-width of 480px, otherwise the columns options will disappear if you hide all columns.\n*/\n.mlDataFrameAnalyticsClassification__dataGridMinWidth {\n  float: left;\n  min-width: 480px;\n  width: calc(100% - 80px); }\n  .mlDataFrameAnalyticsClassification__dataGridMinWidth .euiDataGridRowCell--boolean {\n    text-transform: none; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(704);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,"/* Fixed width so we can align it with the padding of the AUC ROC chart. */\n/*\n  Workaround for EuiDataGrid within a Flex Layout,\n  this tricks browsers treating the width as a px value instead of %\n*/\n.mlDataFrameAnalyticsClassification {\n  width: 100%; }\n\n.mlDataFrameAnalyticsClassification__evaluateSectionContent {\n  padding: 0 5%; }\n\n/*\n  The following two classes are a workaround to avoid having EuiDataGrid in a flex layout\n  and just uses a legacy approach for a two column layout so we don't break IE11.\n*/\n.mlDataFrameAnalyticsClassification__evaluateSectionContent:after {\n  content: '';\n  display: table;\n  clear: both; }\n\n.mlDataFrameAnalyticsClassification__actualLabel {\n  float: left;\n  width: 80px;\n  padding-top: 64px; }\n\n/*\n  Gives EuiDataGrid a min-width of 480px, otherwise the columns options will disappear if you hide all columns.\n*/\n.mlDataFrameAnalyticsClassification__dataGridMinWidth {\n  float: left;\n  min-width: 480px;\n  width: calc(100% - 80px); }\n  .mlDataFrameAnalyticsClassification__dataGridMinWidth .euiDataGridRowCell--boolean {\n    text-transform: none; }\n",""]);module.exports=exports},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var react_1=__webpack_require__(10);function usePrevious(state){var ref=react_1.useRef();react_1.useEffect((function(){ref.current=state}));return ref.current}exports.default=usePrevious},,,,,,,,,,function(module,exports,__webpack_require__){switch(window.__kbnThemeTag__){case"v7dark":return __webpack_require__(754);case"v7light":return __webpack_require__(756);case"v8dark":return __webpack_require__(758);case"v8light":return __webpack_require__(760)}},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(755);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".ml-explorer-chart-eui-icon-tip {\n  max-width: none; }\n\n.ml-explorer-chart-label-badges {\n  margin-top: 3px; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(757);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".ml-explorer-chart-eui-icon-tip {\n  max-width: none; }\n\n.ml-explorer-chart-label-badges {\n  margin-top: 3px; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(759);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".ml-explorer-chart-eui-icon-tip {\n  max-width: none; }\n\n.ml-explorer-chart-label-badges {\n  margin-top: 3px; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(761);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".ml-explorer-chart-eui-icon-tip {\n  max-width: none; }\n\n.ml-explorer-chart-label-badges {\n  margin-top: 3px; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){switch(window.__kbnThemeTag__){case"v7dark":return __webpack_require__(763);case"v7light":return __webpack_require__(765);case"v8dark":return __webpack_require__(767);case"v8light":return __webpack_require__(769)}},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(764);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".ml-explorer-chart-info-tooltip {\n  max-width: 384px; }\n\n.ml-explorer-chart-description {\n  font-size: 12px;\n  font-style: italic; }\n\n.ml-explorer-chart-info-tooltip .mlDescriptionList > * {\n  margin-top: 3px; }\n\n.ml-explorer-chart-info-tooltip .mlDescriptionList {\n  display: grid;\n  grid-template-columns: max-content auto; }\n  .ml-explorer-chart-info-tooltip .mlDescriptionList .mlDescriptionList__title {\n    color: #FFF;\n    font-size: 12px;\n    font-weight: normal;\n    white-space: nowrap;\n    grid-column-start: 1; }\n  .ml-explorer-chart-info-tooltip .mlDescriptionList .mlDescriptionList__description {\n    color: #FFF;\n    font-size: 12px;\n    font-weight: bold;\n    padding-left: 8px;\n    max-width: 256px;\n    grid-column-start: 2; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(766);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".ml-explorer-chart-info-tooltip {\n  max-width: 384px; }\n\n.ml-explorer-chart-description {\n  font-size: 12px;\n  font-style: italic; }\n\n.ml-explorer-chart-info-tooltip .mlDescriptionList > * {\n  margin-top: 3px; }\n\n.ml-explorer-chart-info-tooltip .mlDescriptionList {\n  display: grid;\n  grid-template-columns: max-content auto; }\n  .ml-explorer-chart-info-tooltip .mlDescriptionList .mlDescriptionList__title {\n    color: #FFF;\n    font-size: 12px;\n    font-weight: normal;\n    white-space: nowrap;\n    grid-column-start: 1; }\n  .ml-explorer-chart-info-tooltip .mlDescriptionList .mlDescriptionList__description {\n    color: #FFF;\n    font-size: 12px;\n    font-weight: bold;\n    padding-left: 8px;\n    max-width: 256px;\n    grid-column-start: 2; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(768);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".ml-explorer-chart-info-tooltip {\n  max-width: 384px; }\n\n.ml-explorer-chart-description {\n  font-size: 12px;\n  font-style: italic; }\n\n.ml-explorer-chart-info-tooltip .mlDescriptionList > * {\n  margin-top: 3px; }\n\n.ml-explorer-chart-info-tooltip .mlDescriptionList {\n  display: grid;\n  grid-template-columns: max-content auto; }\n  .ml-explorer-chart-info-tooltip .mlDescriptionList .mlDescriptionList__title {\n    color: #FFF;\n    font-size: 12px;\n    font-weight: normal;\n    white-space: nowrap;\n    grid-column-start: 1; }\n  .ml-explorer-chart-info-tooltip .mlDescriptionList .mlDescriptionList__description {\n    color: #FFF;\n    font-size: 12px;\n    font-weight: bold;\n    padding-left: 8px;\n    max-width: 256px;\n    grid-column-start: 2; }\n",""]);module.exports=exports},function(module,exports,__webpack_require__){var api=__webpack_require__(60);var content=__webpack_require__(770);content=content.__esModule?content.default:content;if(typeof content==="string"){content=[[module.i,content,""]]}var options={};options.insert="head";options.singleton=false;var update=api(content,options);module.exports=content.locals||{}},function(module,exports,__webpack_require__){var ___CSS_LOADER_API_IMPORT___=__webpack_require__(61);exports=___CSS_LOADER_API_IMPORT___(false);exports.push([module.i,".ml-explorer-chart-info-tooltip {\n  max-width: 384px; }\n\n.ml-explorer-chart-description {\n  font-size: 12px;\n  font-style: italic; }\n\n.ml-explorer-chart-info-tooltip .mlDescriptionList > * {\n  margin-top: 3px; }\n\n.ml-explorer-chart-info-tooltip .mlDescriptionList {\n  display: grid;\n  grid-template-columns: max-content auto; }\n  .ml-explorer-chart-info-tooltip .mlDescriptionList .mlDescriptionList__title {\n    color: #FFF;\n    font-size: 12px;\n    font-weight: normal;\n    white-space: nowrap;\n    grid-column-start: 1; }\n  .ml-explorer-chart-info-tooltip .mlDescriptionList .mlDescriptionList__description {\n    color: #FFF;\n    font-size: 12px;\n    font-weight: bold;\n    padding-left: 8px;\n    max-width: 256px;\n    grid-column-start: 2; }\n",""]);module.exports=exports}])]);